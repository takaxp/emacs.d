<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2020-06-25 Thu 23:03 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Configurations for GNU Emacs</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="Takaaki Ishikawa" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/styles/readtheorg/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/styles/readtheorg/css/readtheorg.css"/>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/styles/lib/js/jquery.stickytableheaders.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/styles/readtheorg/js/readtheorg.js"></script>
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2020 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">Configurations for GNU Emacs</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgda9120c8">1. はじめに</a></li>
<li><a href="#org2a411a2e">2. 起動設定</a>
<ul>
<li><a href="#orgdb94bf6d">2.1. Spacemacs</a></li>
<li><a href="#org2db575a1">2.2. init.el のヘッダ</a></li>
<li><a href="#org3c4d5a7a">2.3. initファイルの読み込み時間計測</a>
<ul>
<li><a href="#org715ba410">2.3.1. Emacs 起動時の呼び出し順</a></li>
</ul>
</li>
<li><a href="#orga09727ae">2.4. 起動時間の計測</a></li>
<li><a href="#org4c3e9f59">2.5. GCサイズの最適化</a></li>
<li><a href="#orgc7901a57">2.6. Common Lisp を使う</a></li>
<li><a href="#org8b967ce1">2.7. 警告の抑制</a></li>
<li><a href="#org0ea7dbaf">2.8. エラー表示の抑制</a></li>
<li><a href="#org8d718626">2.9. バッファの保存を静かにする</a></li>
<li><a href="#org660ba5e8">2.10. [my-load-package-p] 設定の読み込みフラグを確認する</a></li>
<li><a href="#orgc0921cdc">2.11. [autoload-if-found] 関数をリストで渡すautoload設定</a></li>
<li><a href="#orga2859651">2.12. [postpone.el] Emacs起動してから使い始めるタイミングで実行する</a></li>
<li><a href="#org124f13e2">2.13. [future-time-p] 指定時刻が本日の未来の時刻かを判定</a></li>
<li><a href="#orgcea06248">2.14. <span class="done DONE">DONE</span> [window-focus-p] フォーカス判定</a></li>
<li><a href="#org30c47759">2.15. [library-p] load-path にライブラリがあるかを判定</a></li>
<li><a href="#orgfca510d8">2.16. [shut-up.el] Messages 出力を封じる（制御する）</a>
<ul>
<li><a href="#orgb6593164">2.16.1. with-suppressed-message&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></a></li>
</ul>
</li>
<li><a href="#orgb59612b6">2.17. [exec-path-from-shell.el] PATH設定をシェルから継承する&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></a></li>
<li><a href="#org0b7d9710">2.18. [eval-after-autoload-if-found] 遅延読み込み&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></a>
<ul>
<li><a href="#org42722212">2.18.1. 関数版</a></li>
<li><a href="#org1498f6ce">2.18.2. マクロ版</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org8e58f563">3. コア設定</a>
<ul>
<li><a href="#org218fe598">3.1. 言語／文字コード</a></li>
<li><a href="#org08c6f620">3.2. 日本語入力</a></li>
<li><a href="#org532e1f02">3.3. 基本キーバインド</a></li>
<li><a href="#org62c41327">3.4. ナローイングするか</a></li>
<li><a href="#org162dbe4a">3.5. バッファの終わりでのnewlineを禁止する</a></li>
<li><a href="#orgff941e69">3.6. 常に最終行に一行追加する</a></li>
<li><a href="#org7a9614cc">3.7. 長い文章を右端で常に折り返す</a></li>
<li><a href="#org8dd417a4">3.8. マウスで選択した領域を自動コピー</a></li>
<li><a href="#org1b2d3cc0">3.9. compilation buffer でのデータ表示で自動するスクロールする</a></li>
<li><a href="#orgb26cd017">3.10. 水平方向の自動スクロール調整</a></li>
<li><a href="#org68d1750d">3.11. C-x C-c で容易にEmacsを終了させないように質問する</a></li>
<li><a href="#orgd7b8f4e2">3.12. パッケージ管理</a>
<ul>
<li><a href="#orgf6f05dc9">3.12.1. [cask-mode.el] モード設定</a></li>
<li><a href="#org02669d67">3.12.2. Cask のセットアップ</a></li>
<li><a href="#orgec66ea31">3.12.3. load-path を一箇所にして起動を高速化</a></li>
<li><a href="#orgda4ef167">3.12.4. [paradox.el] パッケージ選択画面の改善</a></li>
<li><a href="#org6c5717fc">3.12.5. [el-get.el] パッケージ管理（GUI，CUI）</a></li>
</ul>
</li>
<li><a href="#org03555a6a">3.13. インデント</a></li>
<li><a href="#orgfc7cc004">3.14. ファイルリンクを辿る時に確認のメッセージを出さない</a></li>
<li><a href="#orgc2257142">3.15. バッファが外部から編集された場合に自動で再読み込みする</a></li>
<li><a href="#org4ea9e5f1">3.16. マウススクロールをピクセル単位にする</a></li>
<li><a href="#org6a9f8b88">3.17. デフォルトディレクトリ</a></li>
<li><a href="#orgb5cd55a9">3.18. [aggressive-indent.el] 即時バッファ整形</a></li>
<li><a href="#org723e2b73">3.19. [uniquify.el] 同じバッファ名が開かれた場合に区別する</a></li>
<li><a href="#org982c69d7">3.20. [ws-butler.el] 不要なスペースを自動除去</a></li>
<li><a href="#orge014847e">3.21. [epa.el] GPGを使う</a></li>
<li><a href="#orge44eded5">3.22. NSビルド用設定&#xa0;&#xa0;&#xa0;<span class="tag"><span class="macOS">macOS</span></span></a></li>
<li><a href="#org53a63301">3.23. EMPビルド用設定&#xa0;&#xa0;&#xa0;<span class="tag"><span class="macOS">macOS</span></span></a></li>
</ul>
</li>
<li><a href="#org35f3bbc9">4. カーソル移動</a>
<ul>
<li><a href="#org2a46a2bd">4.1. バッファ内のカーソル移動</a></li>
<li><a href="#org3bebf489">4.2. バッファ間のカーソル移動</a></li>
<li><a href="#orgc4c0ed9a">4.3. 対応するカッコを選択（逆方向）</a></li>
<li><a href="#orgb8c57f30">4.4. スクロールを制御</a></li>
<li><a href="#org5f40f030">4.5. スクロールで表示を重複させる行数</a></li>
<li><a href="#org9811c7e8">4.6. マーク箇所を遡る</a></li>
<li><a href="#org7ea97f70">4.7. [ah.el] カーソル移動に反応するフック</a></li>
<li><a href="#orgc62cc9bf">4.8. [smooth-scroll.el] 滑らかなスクロール</a></li>
<li><a href="#org768c06a0">4.9. [bs.el] 続・カレントバッファの表示切り替え</a></li>
<li><a href="#orgd5942d14">4.10. [bm.el] カーソル位置をブックマークして追う</a></li>
<li><a href="#orgfa2bad61">4.11. [centered-cursor-mode.el] カーソル位置をバッファ中央に固定</a></li>
<li><a href="#orgadf36a14">4.12. [smart-mark] C-g後に元の場所へカーソルを戻す</a></li>
<li><a href="#orgf75f443a">4.13. [syntax-subword.el] M-f で移動する位置をより密にする</a></li>
<li><a href="#org8435eae2">4.14. [goto-chg.el] 編集箇所を簡単に辿る</a></li>
<li><a href="#org3901456e">4.15. [expand-region.el] カーソル箇所を起点に選択範囲を賢く広げる</a></li>
<li><a href="#org27e3241e">4.16. <span class="done DONE">DONE</span> [cycle-buffer.el] カレントバッファの表示切り替え&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></a></li>
<li><a href="#orgd906e864">4.17. <span class="done DONE">DONE</span> [back-button] マークをたどる&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></a></li>
<li><a href="#org42db9464">4.18. <span class="done DONE">DONE</span> [point-undo.el] カーソル位置を簡単にたどる&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></a></li>
<li><a href="#org1af5f062">4.19. <span class="done DONE">DONE</span> [SmoothScroll.el] カーソル固定でスクロールする&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></a></li>
</ul>
</li>
<li><a href="#org36bb3b1a">5. 編集サポート</a>
<ul>
<li><a href="#org6f2cf1cd">5.1. エンターキーの挙動</a></li>
<li><a href="#org4c4fe29c">5.2. Yank時に装飾を取る</a></li>
<li><a href="#orgf6cb5849">5.3. 矩形編集／連番入力</a></li>
<li><a href="#org9dba91d0">5.4. ファイル保存時に時間を記録する</a></li>
<li><a href="#orge62264fe">5.5. 選択リージョンを使って検索</a></li>
<li><a href="#org7cb03523">5.6. ChangeLog モード</a></li>
<li><a href="#org1bd5d8ee">5.7. テキストモード</a></li>
<li><a href="#org92da42b4">5.8. C/C++モード</a></li>
<li><a href="#orga6184922">5.9. C#モード</a></li>
<li><a href="#org743f2508">5.10. Infoモード</a></li>
<li><a href="#orgd2a57328">5.11. Rモード</a></li>
<li><a href="#org8c99f06c">5.12. nXMLモード</a></li>
<li><a href="#orgbfa6c13b">5.13. yamlモード</a></li>
<li><a href="#org34a54f82">5.14. jsonモード</a></li>
<li><a href="#orgc35f66fb">5.15. javascriptモード</a></li>
<li><a href="#orga7d86e03">5.16. csvモード</a></li>
<li><a href="#orgba009928">5.17. asciiモード</a></li>
<li><a href="#orgc5b5891d">5.18. javaモード</a></li>
<li><a href="#orgf0c39e0f">5.19. esモード</a></li>
<li><a href="#org2a14728f">5.20. gnuplotモード</a></li>
<li><a href="#orga6fc6cf7">5.21. markdown-modeモード</a></li>
<li><a href="#org29328dcd">5.22. cmakeモード</a></li>
<li><a href="#org41da658e">5.23. logviewモード</a></li>
<li><a href="#org6b6c1c11">5.24. viewモード</a></li>
<li><a href="#orgfdeec1c5">5.25. Web/HTMLモード&#xa0;&#xa0;&#xa0;<span class="tag"><span class="web">web</span></span></a></li>
<li><a href="#orge1eeb2a1">5.26. POモード</a></li>
<li><a href="#org58f62c66">5.27. Goモード</a></li>
<li><a href="#orge727dabc">5.28. スペルチェック</a></li>
<li><a href="#orgdd65fc08">5.29. リアルタイムスペルチェック</a></li>
<li><a href="#org9317ee6f">5.30. リージョン内の文字をカウントする</a></li>
<li><a href="#org863cfc2a">5.31. 世界時計を使う</a></li>
<li><a href="#orgee372b48">5.32. [counsel-world-clock.el] ivy でタイムゾーンの情報を選択する</a></li>
<li><a href="#org66e1952c">5.33. 読書モード</a></li>
<li><a href="#orgab4f9bf0">5.34. [latex-math-preview.el] TeX数式をプレビュー&#xa0;&#xa0;&#xa0;<span class="tag"><span class="tex">tex</span></span></a></li>
<li><a href="#org770fb4ec">5.35. [yatex.el] YaTeXでTex編集&#xa0;&#xa0;&#xa0;<span class="tag"><span class="tex">tex</span></span></a></li>
<li><a href="#org9b92b6f8">5.36. [auxtex.el] AUCTEXでTex編集&#xa0;&#xa0;&#xa0;<span class="tag"><span class="tex">tex</span></span></a></li>
<li><a href="#org2e5c6e4f">5.37. [yasnippet.el] Emacs用のテンプレートシステム</a>
<ul>
<li><a href="#org8166015d">5.37.1. [ivy-yasnippet.el] yasnippet.el の ivy インターフェイス</a></li>
</ul>
</li>
<li><a href="#orgbea14b16">5.38. [osx-dictionary.el] macOSのdictionary.appで辞書をひく</a></li>
<li><a href="#orgca044d69">5.39. [describe-number.el] 16進数などを確認</a></li>
<li><a href="#org98d5c1aa">5.40. [emmet-mode.el] zencoding の後継&#xa0;&#xa0;&#xa0;<span class="tag"><span class="web">web</span></span></a></li>
<li><a href="#orgc885e502">5.41. [web-beautify.el] ソースコード整形&#xa0;&#xa0;&#xa0;<span class="tag"><span class="web">web</span></span></a></li>
<li><a href="#orgc3ce60f5">5.42. [smartparens.el] 対応するカッコの挿入をアシスト</a></li>
<li><a href="#org69748b72">5.43. [replace-from-region.el] 選択領域を別の文字列に置き換える</a></li>
<li><a href="#orgbc8501cf">5.44. [selected.el] リージョン選択時のアクションを制御</a></li>
<li><a href="#org98897862">5.45. [helm-selected.el] selecte.el のアクション候補を絞り込み</a></li>
<li><a href="#orgeafa82dd">5.46. [counsel-selected.el] 続・selected.el のアクション候補絞り込み</a></li>
<li><a href="#org9e3510c2">5.47. <span class="todo TODO">TODO</span> [multiple-cursors.el] 指定箇所を同時編集</a></li>
<li><a href="#orge18cb840">5.48. <span class="todo TODO">TODO</span> [isolate.el] ブラケット等の入力をアシスト</a></li>
<li><a href="#orgc6f37d6d">5.49. <span class="todo TODO">TODO</span> [git-complete.el] GIT grep を使う補完エンジン</a></li>
<li><a href="#orgab8a7bee">5.50. <span class="todo TODO">TODO</span> [tiny.el] 連番入力をサポート</a></li>
<li><a href="#org12a087af">5.51. <span class="todo TODO">TODO</span> [bratex.el] LaTeX 数式のブラケット入力をサポート</a></li>
<li><a href="#orgb3d87116">5.52. <span class="done DONE">DONE</span> [iedit.el] バッファ内の同じ文字列を一度に編集する&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></a></li>
<li><a href="#orgf18160de">5.53. <span class="done DONE">DONE</span> [lookup.el] 辞書&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></a></li>
<li><a href="#org903987d3">5.54. <span class="done DONE">DONE</span> [cacoo] Cacoo で描く&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></a></li>
<li><a href="#org56cbbb36">5.55. <span class="done DONE">DONE</span> [zencoding-mode] HTML編集の高速化&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></a></li>
<li><a href="#org7e84aa55">5.56. <span class="done DONE">DONE</span> [sdic.el] 英辞郎で英単語を調べる&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></a></li>
<li><a href="#org52c2a77d">5.57. <span class="done DONE">DONE</span> [dictionary.app] macOSのdictionary.appでCOBUILD5をひく&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></a>
<ul>
<li><a href="#org34b20ea7">5.57.1. マイナーモード化</a></li>
<li><a href="#org34f10f81">5.57.2. キーバインド</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org94c7bd73">6. 表示サポート</a>
<ul>
<li><a href="#orgf6a240ab">6.1. キーコマンド入力中に入力過程をミニバッファに反映する</a></li>
<li><a href="#org581a32ab">6.2. <span class="todo TODO">TODO</span> モードラインの色をナローイングで変える</a></li>
<li><a href="#org3368625d">6.3. <span class="todo TODO">TODO</span> モードラインのNarrowを短くする</a></li>
<li><a href="#org5fd3a668">6.4. モードラインの節約（VC-mode編）</a></li>
<li><a href="#orgb577af83">6.5. モードラインの色をカスタマイズする</a>
<ul>
<li><a href="#org21b30e75">6.5.1. 色セット例</a></li>
</ul>
</li>
<li><a href="#org19cbc9b3">6.6. 行番号の表示制限を拡張する</a></li>
<li><a href="#org328bb797">6.7. visible-bell のカスタマイズ</a></li>
<li><a href="#org91a9f893">6.8. 常に <b>scratch</b> を表示して起動する</a></li>
<li><a href="#orgdf6d1ea2">6.9. スクロールバーを非表示にする</a></li>
<li><a href="#orgdd0a9c41">6.10. ツールバーを非表示にする</a></li>
<li><a href="#org52e500e2">6.11. メニューバーを非表示にする</a></li>
<li><a href="#orgd432e8ff">6.12. 起動時のスプラッシュ画面を表示しない</a></li>
<li><a href="#org4a736379">6.13. default.el を探索させない</a></li>
<li><a href="#org8d729190">6.14. カーソル行の行数をモードラインに表示する</a></li>
<li><a href="#orge456e19c">6.15. カーソル行の関数名をモードラインに表示する</a></li>
<li><a href="#orga76ec530">6.16. 行番号をバッファに表示する</a></li>
<li><a href="#org5117762c">6.17. 時刻をモードラインに表示する</a></li>
<li><a href="#orga734802e">6.18. 対応するカッコをハイライトする</a></li>
<li><a href="#orgd1e62da7">6.19. 全角スペースと行末タブ／半角スペースを強調表示する</a></li>
<li><a href="#orgc93741fa">6.20. バッファの終わりをフリンジで明示</a></li>
<li><a href="#orgec7835e0">6.21. 文字エンコードの表示を明確化</a></li>
<li><a href="#org0e59b85f">6.22. [delight.el] モードラインのモード名を短縮する</a></li>
<li><a href="#org74bad2de">6.23. [migemo.el] ローマ字入力で日本語を検索する</a></li>
<li><a href="#org6332fe92">6.24. [git-gutter-fringe] 編集差分をフレーム端で視覚化</a></li>
<li><a href="#orgd6308db6">6.25. [japanese-holidays] カレンダーをカラフルにする</a></li>
<li><a href="#org12f72886">6.26. [calendar.el] カレンダーで週番号を表示する</a></li>
<li><a href="#orgc45b24d4">6.27. [which-key] キーバインドの選択肢をポップアップする</a></li>
<li><a href="#org467accb9">6.28. [highlight-symbol] 同じ名前のシンボルをハイライトする</a></li>
<li><a href="#org962224ff">6.29. [all-the-icons.el] フォントでアイコン表示</a></li>
<li><a href="#orgd92b50db">6.30. [all-the-icons-dired] dired でアイコンを表示</a></li>
<li><a href="#org402f1293">6.31. [eldoc.el] コンテクストに応じてヘルプを表示</a></li>
<li><a href="#org138fda77">6.32. [go-eldoc.el] Go用の eldoc</a></li>
<li><a href="#org7cab354d">6.33. [keycast.el] 入力しているキーとコマンドをモードラインに表示</a></li>
<li><a href="#orgfa7d126f">6.34. [ivy.el] 続々・何でも絞り込みインターフェイス</a></li>
<li><a href="#org9c962eaf">6.35. [ivy.el] プロンプトをカスタマイズ</a></li>
<li><a href="#org45b3667a">6.36. [imenu-list.el] サイドバー的にファイル内容の目次要素を表示</a></li>
<li><a href="#org29951da5">6.37. [prescient.el] リスト項目の並び替えとイニシャル入力機能（ivy and company）</a></li>
<li><a href="#orgf0e91c5a">6.38. <span class="todo TODO">TODO</span> [swiper.el] 文字列探索とプレビューを同時に行う</a></li>
<li><a href="#org3d431f2e">6.39. <span class="todo TODO">TODO</span> [all-the-icons-ivy] ivy インターフェイスでアイコンを表示する</a></li>
<li><a href="#org5eaeb687">6.40. <span class="todo TODO">TODO</span> [rainbow-delimiters.el] 対応するカッコに色を付ける</a></li>
<li><a href="#org7270262d">6.41. <span class="todo TODO">TODO</span> [yascroll.el] フリンジにスクロールバーを出す</a></li>
<li><a href="#org8ba0784e">6.42. <span class="todo TODO">TODO</span> [dimmer.el] 現在のバッファ以外の輝度を落とす</a></li>
<li><a href="#org1e701627">6.43. <span class="todo TODO">TODO</span> [hydra.el] コマンドディスパッチャを構築する</a></li>
<li><a href="#org56d8bf9d">6.44. <span class="done DONE">DONE</span> [helm.el] 続・何でも絞り込みインターフェイス&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></a></li>
<li><a href="#orgc00267d7">6.45. <span class="done DONE">DONE</span> バッテリー情報をモードラインに表示する&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></a></li>
<li><a href="#org205dbe20">6.46. <span class="done DONE">DONE</span> [mode-icons] 使用中のモード表示をアイコンで代替&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></a></li>
<li><a href="#org6e56a94f">6.47. <span class="done DONE">DONE</span> [stock-ticker] 株価をモードラインに表示&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></a></li>
<li><a href="#org0ed58559">6.48. <span class="done DONE">DONE</span> [zlc.el] find-file バッファを zsh ライクにする&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></a></li>
<li><a href="#org5cc37356">6.49. <span class="done DONE">DONE</span> [stripe-buffer.el] テーブルの色をストライプにする&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></a></li>
<li><a href="#org62c6f085">6.50. <span class="done DONE">DONE</span> [guide-key] キーバインドの選択肢をポップアップする&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></a></li>
<li><a href="#orgdf971702">6.51. <span class="done DONE">DONE</span> [anything.el] 何でも絞り込みインターフェイス&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></a></li>
<li><a href="#org83eaaf3a">6.52. <span class="done DONE">DONE</span> [diminish.el] モードラインのモード名を短くする&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></a></li>
</ul>
</li>
<li><a href="#org9ff300b4">7. メディアサポート</a>
<ul>
<li><a href="#orgcf4022fd">7.1. [emms.el] メディアプレーヤー</a></li>
<li><a href="#orgca126930">7.2. [GoogleMaps.el] GoogleMaps を Emacs 内で使う</a></li>
<li><a href="#org41faa552">7.3. [japanlaw.el] Emacs 電子六法</a></li>
<li><a href="#org8e8f85ec">7.4. [sunshine.el] 天気を知る</a></li>
<li><a href="#orgb77ecd7a">7.5. [org-google-weather.el] org-agenda に天気を表示する&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></a></li>
<li><a href="#org474263ad">7.6. [bongo.el] Emacsのバッファで音楽ライブラリを管理する&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></a></li>
</ul>
</li>
<li><a href="#orgd5aed515">8. 履歴／ファイル管理</a>
<ul>
<li><a href="#org0f46c991">8.1. 履歴サイズを大きくする</a></li>
<li><a href="#org9736b2f0">8.2. Undoバッファを無限に取る</a></li>
<li><a href="#orgf2cd8961">8.3. 最近開いたファイルリストを保持</a></li>
<li><a href="#org9f20061e">8.4. C-g した場所をブックマークする</a></li>
<li><a href="#org300e8f70">8.5. バッファ保存時にバックアップを生成させない&#xa0;&#xa0;&#xa0;<span class="tag"><span class="backup">backup</span></span></a></li>
<li><a href="#org89e64435">8.6. 特定のファイルを Dropbox 以下にバックアップする&#xa0;&#xa0;&#xa0;<span class="tag"><span class="backup">backup</span></span></a></li>
<li><a href="#org9b0e7066">8.7. [backup-each-save.el] クラッシュに備える&#xa0;&#xa0;&#xa0;<span class="tag"><span class="backup">backup</span></span></a></li>
<li><a href="#orge2f78ad3">8.8. [dired] ファイラのサポートツール&#xa0;&#xa0;&#xa0;<span class="tag"><span class="dired">dired</span></span></a></li>
<li><a href="#org7c53511f">8.9. [dired-recent.el] 訪問したディレクトリの履歴を取る&#xa0;&#xa0;&#xa0;<span class="tag"><span class="dired">dired</span></span></a></li>
<li><a href="#orga3cbefa8">8.10. [osx-trash] system-move-file-to-trash を有効にする</a></li>
<li><a href="#org6e71b562">8.11. [undo-fu.el] シンプルな redo を提供してくる</a></li>
<li><a href="#orgb8c01946">8.12. [auto-save-buffers.el] 一定間隔でバッファを保存する</a></li>
<li><a href="#orgab837e6a">8.13. [session.el] 様々な履歴を保存し復元に利用する</a></li>
<li><a href="#org92404bbd">8.14. [neotree.el] ディレクトリ情報をツリー表示</a></li>
<li><a href="#orgf2d47943">8.15. [helpful.el] リッチなヘルプページ</a></li>
<li><a href="#orgc08799d2">8.16. [facecheck.el] クリックしてfaceをチェック</a></li>
<li><a href="#org0d952d68">8.17. [keyfreq.el] コマンドログ</a></li>
<li><a href="#orged77c483">8.18. [disk-usage.el] ディスク利用率を調べる</a></li>
<li><a href="#orgdd1e03ec">8.19. [uptimes.el] Emacsの起動時間を記録する</a></li>
<li><a href="#orgfd3c67b9">8.20. [ag.el] 検索</a></li>
<li><a href="#org29c7b6b7">8.21. [counsel-ag.el] 高速全文検索</a></li>
<li><a href="#org24fd7b68">8.22. [counsel-fzf.el] 高速ファイル検索</a></li>
<li><a href="#org694ee426">8.23. <span class="done DONE">DONE</span> [undo-propose] undo を編集不可モードで辿る&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></a></li>
<li><a href="#org82bd942f">8.24. <span class="done DONE">DONE</span> [undo-tree] 編集履歴をわかりやすくたどる&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></a></li>
<li><a href="#orgc47c1e75">8.25. <span class="done DONE">DONE</span> [wakatime-mode.el] WakaTime を利用して作業記録する&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></a></li>
<li><a href="#orgc470d5a3">8.26. <span class="done DONE">DONE</span> [backup-dir.el] バックアップファイルを一箇所に集める&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></a></li>
<li><a href="#org8b2fe680">8.27. <span class="done DONE">DONE</span> バッファ保存時にバックアップファイルを生成する&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></a></li>
<li><a href="#orgdba35c9f">8.28. <span class="done DONE">DONE</span> ミニバッファの履歴を保存しリストアする&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></a></li>
<li><a href="#orgead91174">8.29. <span class="done DONE">DONE</span> Emacs終了時に開いていたバッファを起動時に復元する&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></a></li>
<li><a href="#org63e50e2c">8.30. <span class="done DONE">DONE</span> 深夜にバッファを自動整理する&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></a></li>
</ul>
</li>
<li><a href="#orgf1b8fa63">9. 開発サポート</a>
<ul>
<li><a href="#org9f988c12">9.1. 便利キーバインド</a></li>
<li><a href="#orgac7d1689">9.2. [gist.el] Gist インターフェイス</a></li>
<li><a href="#org7baba8dd">9.3. [doxymacs.el] Doxygen のコメントを簡単に入力する</a></li>
<li><a href="#org0e27778c">9.4. [matlab.el] Matlab用の設定</a></li>
<li><a href="#org966da7c1">9.5. [flycheck.el] 構文エラー表示</a></li>
<li><a href="#org2bf4fb77">9.6. [origami.el] 関数の折りたたみ</a></li>
<li><a href="#org291c6055">9.7. [auto-complete-clang.el] オムニ補完</a>
<ul>
<li><a href="#org3d08c27d">9.7.1. References</a></li>
</ul>
</li>
<li><a href="#orgabd9abb3">9.8. [quickrun.el] お手軽ビルド</a></li>
<li><a href="#org034bbf9f">9.9. [ggtags.el] タグジャンプ</a></li>
<li><a href="#org216e9539">9.10. [0xc.el] N進数変換</a></li>
<li><a href="#orge830f6b0">9.11. [hexl.el] バイナリファイルを開く</a></li>
<li><a href="#org9ffc2142">9.12. [uuid.el] UUID の生成</a></li>
<li><a href="#orga1d9863f">9.13. [package-lint.el] MEPLA登録用Lint</a></li>
<li><a href="#org7d18b489">9.14. [projectile.el] ディレクトリ単位でファイル群をプロジェクト扱いする</a></li>
<li><a href="#org1c672519">9.15. [relint.el] elispの正規表現用のlinter</a></li>
<li><a href="#org7d969237">9.16. [magit.el] Gitクライアント</a></li>
<li><a href="#orgaa25b74c">9.17. <span class="todo TODO">TODO</span> [EditorConfig] コードスタイルの強制</a></li>
<li><a href="#orgae4ecac7">9.18. <span class="todo TODO">TODO</span> [cov] カバレッジの状態をフリンジで確認</a></li>
<li><a href="#orgbf790f4d">9.19. <span class="todo TODO">TODO</span> [format-all.el] コード整形</a></li>
<li><a href="#orgac7d24d7">9.20. <span class="todo TODO">TODO</span> [emr.el] リファクタリング</a></li>
<li><a href="#org4e23f079">9.21. <span class="todo TODO">TODO</span> [rmsbolt.el] アセンブリをバッファにリアルタイム表示</a></li>
<li><a href="#org9547f772">9.22. <span class="todo TODO">TODO</span> [semantic-refactor.el] リファクタリングツール</a></li>
<li><a href="#orgea32afad">9.23. <span class="todo TODO">TODO</span> [company.el] 続・自動補完機能</a></li>
<li><a href="#org09687b9c">9.24. <span class="done DONE">DONE</span> [auto-complete.el] 自動補完機能&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></a></li>
<li><a href="#orgcde881ad">9.25. <span class="done DONE">DONE</span> [hideshowvis.el] 関数の表示／非表示&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></a></li>
</ul>
</li>
<li><a href="#org47616d05">10. Org Mode</a>
<ul>
<li><a href="#orgf66bb6fe">10.1. 基本設定</a></li>
<li><a href="#orgebb1fbe4">10.2. contribution を使う</a></li>
<li><a href="#org4da0cefd">10.3. iCal との連携</a></li>
<li><a href="#org739cd53d">10.4. スピードコマンド</a></li>
<li><a href="#org480c9b8b">10.5. face 関連</a></li>
<li><a href="#orgdec24da2">10.6. TODOキーワードのカスタマイズ</a></li>
<li><a href="#org55076fa0">10.7. ImageMagick を使って様々な画像をインライン表示する</a></li>
<li><a href="#org53663ca9">10.8. README を常に org-mode で開く</a></li>
<li><a href="#org907cb9db">10.9. ソースブロック等の大文字記述を一括で小文字に変える</a></li>
<li><a href="#orgdae2d9e7">10.10. イベント通知</a></li>
<li><a href="#orga58b21fc">10.11. org-mode でアラーム管理</a></li>
<li><a href="#org49e5d185">10.12. カウントダウンタイマー</a></li>
<li><a href="#orga3d0c218">10.13. リンクをエコーエリアに表示する</a></li>
<li><a href="#org30aecedf">10.14. [org-capture] 高速にメモを取る</a></li>
<li><a href="#orgc3302e41">10.15. [org-agenda] タスク／予定管理</a></li>
<li><a href="#org735f32e3">10.16. [org-onit.el] org-clock-in の自動化</a></li>
<li><a href="#org20c40e77">10.17. [orgbox.el] スケジュール追加のわかりやすい入力</a></li>
<li><a href="#org5790e981">10.18. [appt.el] アラーム設定</a></li>
<li><a href="#orgf5236175">10.19. [org-refile] orgツリーの高速移動</a></li>
<li><a href="#org49ca5eb9">10.20. [org-babel] Orgバッファでソースコードを扱う</a></li>
<li><a href="#orgc0ed68a2">10.21. [org-babel] ソースブロックの入力キーをカスタマイズ</a></li>
<li><a href="#org556eb376">10.22. [org-babel] ソースブロックの配色</a></li>
<li><a href="#org89c34f23">10.23. [org-tree-slide] Org Modeでプレゼンテーション</a>
<ul>
<li><a href="#org2e94f804">10.23.1. doom-modeline との共存</a></li>
</ul>
</li>
<li><a href="#org264a37c5">10.24. [org-tree-slide] クロックインとアウトを自動化する</a></li>
<li><a href="#orga7162e8c">10.25. [org-tree-slide] 特定のツリーをプロポーショナルフォントで表示する</a></li>
<li><a href="#orgf5c603e5">10.26. [org-tree-slide] ヘッドラインをリッチにする</a></li>
<li><a href="#orgae555619">10.27. [calfw-org.el] calfw に org の予定を表示する</a></li>
<li><a href="#org02100a39">10.28. [org-odt] ODT形式に出力</a></li>
<li><a href="#org02d2c3de">10.29. [ox-twbs] Twitter Bootstrap 互換のHTML出力</a></li>
<li><a href="#org5a1cb1a1">10.30. [org-crypt] ツリーを暗号化する</a></li>
<li><a href="#org01951291">10.31. [org-mac-link] 外部アプリから情報を取る</a></li>
<li><a href="#orgb3ae0aea">10.32. [org-download] org バッファにD&amp;Dでファイルを保存</a></li>
<li><a href="#org97c39f96">10.33. [org-grep] org ファイルを grep する</a></li>
<li><a href="#org1a7c192b">10.34. [ox-reveal] ナイスなHTML5プレゼンテーション出力</a></li>
<li><a href="#org383ff638">10.35. [org-dashboard] 進捗をプログレスバーで確認</a></li>
<li><a href="#orgfa6df2ce">10.36. [org-clock-today] 今日の総作業時間をモードラインに表示</a></li>
<li><a href="#org56b60c02">10.37. [org-random-todo] ランダムにタスクを選ぶ</a></li>
<li><a href="#org0cba1e62">10.38. [ox-hugo] OrgファイルからHogoの記事をエクスポートする</a></li>
<li><a href="#org32e931e3">10.39. [ox-html] HTML見出しへのリンクを固定する</a></li>
<li><a href="#orga114da46">10.40. [org-id.el] プロパティに ID を入れる</a></li>
<li><a href="#org5cc51a8d">10.41. [orglink.el] Orgファイル以外でリンクを使う</a></li>
<li><a href="#org8480b85f">10.42. [org-trello.el] Trello と双方向同期する</a></li>
<li><a href="#orge01f4572">10.43. [ox.el] ディスパッチャを水平方向の分割画面に表示</a></li>
<li><a href="#org992326f6">10.44. <span class="todo TODO">TODO</span> [ob-async] ソースブロックの非同期実行</a></li>
<li><a href="#org9cbb15f3">10.45. <span class="todo TODO">TODO</span> [org-tree-slide] BEGIN<sub>SRCとEND</sub><sub>SRCを消して背景色を変える</sub></a></li>
<li><a href="#org3ee441c6">10.46. <span class="todo TODO">TODO</span> [org-fstree] ディレクトリ構造を読み取る</a></li>
<li><a href="#orgbb452f44">10.47. <span class="todo TODO">TODO</span> [ox.el] 出力形式の拡張</a></li>
<li><a href="#org4142d8c3">10.48. <span class="todo TODO">TODO</span> Parers3.app からリンクを取得する</a></li>
<li><a href="#org47b1ee67">10.49. <span class="todo TODO">TODO</span> Papers3.app のリンクを開けるようにする</a></li>
<li><a href="#orgd14388c1">10.50. <span class="todo TODO">TODO</span> [org-attach] 外部ファイルを紐付ける</a></li>
<li><a href="#org1926ab44">10.51. <span class="todo TODO">TODO</span> [org-recent-headings] 訪問したツリーを記録し簡単に再訪問可能にする</a></li>
<li><a href="#orgfcfd3f34">10.52. <span class="todo TODO">TODO</span> [orgnav] ツリーの検索インタフェース</a></li>
<li><a href="#org5fce13fa">10.53. <span class="todo TODO">TODO</span> [toc-org] 目次の挿入</a></li>
<li><a href="#org4ca4749d">10.54. <span class="todo TODO">TODO</span> [org-review.el] レビューフローのサポート</a></li>
<li><a href="#org0b29fe80">10.55. REV2 [org-screenshot] スクリーンショットを貼り付ける</a></li>
<li><a href="#org0f4b6016">10.56. <span class="done DONE">DONE</span> [org-autolist] ブリッツの入力を簡単に&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></a></li>
<li><a href="#org39530542">10.57. <span class="done DONE">DONE</span> [MobileOrg] iOS との連携&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></a></li>
<li><a href="#orgfb20898b">10.58. <span class="done DONE">DONE</span> [org-export-generic] エクスポート機能を拡張する&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></a></li>
<li><a href="#org563f7076">10.59. <span class="done DONE">DONE</span> org-mode の latex エクスポート関数をオーバーライド&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></a></li>
</ul>
</li>
<li><a href="#org5fd484a3">11. フレーム／ウィンドウ制御</a>
<ul>
<li><a href="#orgd05fc75a">11.1. 起動時の設定</a></li>
<li><a href="#org5f12ba92">11.2. [moom.el] キーボードでフレームの場所を移す</a>
<ul>
<li><a href="#org6e3c20dd">11.2.1. 最大化時にモードラインを消す</a></li>
</ul>
</li>
<li><a href="#org33fd785f">11.3. [winner.el] ウィンドウ構成の履歴を辿る</a></li>
<li><a href="#orga9be167a">11.4. <span class="todo TODO">TODO</span> [shackle.el] ポップアップウィンドウの制御&#xa0;&#xa0;&#xa0;<span class="tag"><span class="Ongoing">Ongoing</span></span></a>
<ul>
<li><a href="#org32b579df">11.4.1. checkdoc.el 用の追加設定</a></li>
</ul>
</li>
<li><a href="#orgdca5e7c2">11.5. <span class="todo TODO">TODO</span> [doom-modeline.el] モードラインをリッチにする</a></li>
<li><a href="#org4dd0671c">11.6. [e2wm.el] 二画面表示&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></a></li>
<li><a href="#org0c556404">11.7. [tabbar-ruler] バッファをタブ切り替え可能に&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></a></li>
<li><a href="#org6474a498">11.8. [elscreen.el] Emacs バッファをタブ化&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></a></li>
<li><a href="#org750d9aa5">11.9. [popwin.el] ポップアップウィンドウの制御&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></a></li>
<li><a href="#org7a20b311">11.10. <span class="done DONE">DONE</span> [olivetti.el] ウィンドウを中央寄せで配置&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></a></li>
</ul>
</li>
<li><a href="#orgf57ce845">12. フォント／配色関連</a>
<ul>
<li><a href="#orgbbb079d3">12.1. 正規表現を見やすくする</a></li>
<li><a href="#orgc98c6fff">12.2. 設定ファイルを見やすくする</a></li>
<li><a href="#org7858d806">12.3. カーソル行に色をつける</a></li>
<li><a href="#org29d5304f">12.4. カーソルの点滅を制御</a></li>
<li><a href="#orgf36a8366">12.5. カーソル位置のフォントを確認</a></li>
<li><a href="#org919a945a">12.6. フォント設定</a>
<ul>
<li><a href="#orgb94aa5b3">12.6.1. フォントのインストール方法</a></li>
<li><a href="#org66fa6b98">12.6.2. フォントチェック用コード</a></li>
</ul>
</li>
<li><a href="#org2bcbc1db">12.7. 行間を制御する</a></li>
<li><a href="#org372b184d">12.8. パッチをカラフルに表示する</a></li>
<li><a href="#org009dc6e3">12.9. 背景を黒系色にする</a></li>
<li><a href="#org92d26c4b">12.10. 日中と夜中でテーマを切り替える</a></li>
<li><a href="#org7c97dce0">12.11. 時間帯を指定して起動時にテーマを切り替える</a></li>
<li><a href="#org6d79c76a">12.12. [hl-todo.el] 特定キーワードの配色を変える</a></li>
<li><a href="#org9ce2fd45">12.13. [rainbow-mode.el] 配色のリアルタイム確認</a>
<ul>
<li><a href="#org19538af3">12.13.1. 色一覧</a></li>
</ul>
</li>
<li><a href="#orgcc116051">12.14. [edit-color-stamp] Qt経由でカラーピッカーを使う</a></li>
<li><a href="#orge836aa4d">12.15. [ivy.el] インターフェイスの配色</a></li>
<li><a href="#org4b927009">12.16. [ivy.el] 選択行をアイコンで強調</a></li>
<li><a href="#org36a28b28">12.17. [volatile-highlights] コピペした領域を強調</a></li>
</ul>
</li>
<li><a href="#orgb8e84b9a">13. ユーティリティ関数</a>
<ul>
<li><a href="#orgbfb695e1">13.1. [pomodoro.el] ポモドーロの実践</a></li>
<li><a href="#orgc09c0be3">13.2. [pomodoro.el] 続・ポモドーロの実践</a></li>
<li><a href="#org98f153af">13.3. [google-this.el] 単語をグーグル検索</a></li>
<li><a href="#orgc6fce61d">13.4. [multi-term.el] ターミナル</a></li>
<li><a href="#org96f7a2a3">13.5. [osx-lib.el] macOS用ユーティリティ&#xa0;&#xa0;&#xa0;<span class="tag"><span class="macOS">macOS</span></span></a></li>
<li><a href="#org72d850dc">13.6. iTerm2 を Emacs から呼び出したい&#xa0;&#xa0;&#xa0;<span class="tag"><span class="macOS">macOS</span></span></a></li>
<li><a href="#org4d91e973">13.7. [counsel-osx-app.el] macOSのアプリケーションを呼び出す&#xa0;&#xa0;&#xa0;<span class="tag"><span class="macOS">macOS</span></span></a></li>
<li><a href="#org32e35e60">13.8. カレントバッファのあるディレクトリをターミナルで表示</a></li>
<li><a href="#org2906cf09">13.9. [gif-screencast.el] ユーザアクションのたびにスクショを取る</a></li>
<li><a href="#orged473d8d">13.10. [utility.el] 自作してテスト中の便利関数群</a></li>
<li><a href="#org72dab3c6">13.11. [manage-minor-mode.el] マイナーモードの視覚的な管理</a></li>
<li><a href="#org2adaf11c">13.12. 検索語を変えずに counsel-fzf に接続する</a></li>
<li><a href="#org409d5d63">13.13. [gitter.el] Gitter にログイン</a></li>
<li><a href="#orgc75ab540">13.14. <span class="todo TODO">TODO</span> [password-store.el] パスワード管理</a></li>
<li><a href="#org1141e95f">13.15. <span class="todo TODO">TODO</span> [network-watch.el] ネットワークインターフェイスの状態を監視</a></li>
<li><a href="#org71c49002">13.16. <span class="done DONE">DONE</span> [lingr.el] チャットルームに自動参加&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></a></li>
<li><a href="#org2be833d3">13.17. <span class="done DONE">DONE</span> [lingr.el] lingr にログインする&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></a></li>
</ul>
</li>
<li><a href="#org362fb2dc">14. おわりに</a></li>
</ul>
</div>
</div>

<div id="outline-container-orgda9120c8" class="outline-2">
<h2 id="orgda9120c8"><span class="section-number-2">1</span> はじめに</h2>
<div class="outline-text-2" id="text-orgda9120c8">
<ul class="org-ul">
<li><a href="https://github.com/takaxp/emacs.d/blob/master/init.org">init.org</a> から <a href="https://github.com/takaxp/emacs.d/blob/master/init.el">init.el</a>，<a href="https://takaxp.github.io/init.html">init.html</a>，<a href="https://github.com/takaxp/emacs.d/raw/master/init.pdf">init.pdf</a>，<a href="https://github.com/takaxp/emacs.d/raw/master/init.odt">init.odt</a> を生成しています．</li>
<li>一部の関数定義を <a href="https://github.com/takaxp/emacs.d/blob/master/utility.el">utility.el</a> に分離しています．</li>
<li>Org Modeに関する設定は， <a href="https://github.com/takaxp/emacs.d/blob/master/init-org.el">init-org.el</a> に分離しています．</li>
<li><a href="https://github.com/takaxp/postpone">postpone.el</a> で遅延読み込みするパッケージを，<a href="https://github.com/takaxp/emacs.d/blob/master/late-init.el">late-init.el</a> に分離しています．</li>
<li><a href="https://github.com/takaxp/emacs.d/blob/master/init.el">init.el</a> 本体は，<a href="https://github.com/takaxp/emacs.d/">GitHub</a> に公開しています．</li>
<li>コピペだけで動かなかった場合は，気軽に <a href="https://twitter.com/takaxp">@takaxp</a> までご意見をどうぞ．</li>
<li><code>notinuse</code> タグのある設定は，あくまで個人的に不使用になったものです．</li>
</ul>
</div>
</div>

<div id="outline-container-org2a411a2e" class="outline-2">
<h2 id="org2a411a2e"><span class="section-number-2">2</span> 起動設定</h2>
<div class="outline-text-2" id="text-org2a411a2e">
<p>
基本的な設定群です．一部の関数は記述しておかないと動かない可能性があります．
</p>

<p>
普通は <code>init.el</code> に様々な設定をEmacsに読ませますが，私は諸事情から次のようにブートシーケンスを制御しています．
</p>

<ol class="org-ol">
<li><code>.emacs</code> の読み込み</li>
<li><code>init-env.el</code> の読み込み</li>
<li><code>init.el</code> の読み込み</li>
<li><code>init-async.el</code> の読み込み</li>
<li><code>late-init.el</code> の読み込み</li>
</ol>

<p>
<code>.emacs</code> は，基本的に <code>init-env.el</code> を読み込むだけです．ただ，ちょっとしたコードを試したい時は， <code>.emacs</code> に書いてしまいます．気に入ったら， <code>init.el</code> に移します．
</p>

<p>
Org Mode の設定がかなり肥大化したため， <code>init-org.el</code> として分離して，遅延読み込みの対象にしています．設定ファイルの分離は， <code>.el</code> ファイルを <code>tangle</code> する時に自動的に実行されるように設定しています． <code>postpone.el</code> で遅延読み込みさせる設定を， <code>late-init.el</code> に分離しています．
</p>

<p>
<code>init-env.el</code> には，パスの設定，起動時間計測のためのフラグ群，パッケージ管理用の補助関数を設定しています．そして， <code>init-env.el</code> の最後に <code>init.el</code> を <code>require</code> しています．
</p>

<p>
<code>init-async.el</code> は，起動時に非同期で実行する関数を格納していますが，バイトコンパイルすると動作が怪しいので， <code>init.el</code> に格納せず分離しています． <code>async.el</code> 依存です．
</p>

<p>
これ以外に，バッチモードでバイトコンパイルするための <code>init-eval.el</code> も使います．このファイルには，バイトコンパイル時だけ必要なパッケージを列挙しています．
</p>

<ul class="org-ul">
<li><a href="https://github.com/takaxp/emacs.d/blob/master/.emacs">emacs.d/.emacs at master · takaxp/emacs.d</a></li>
<li><a href="https://github.com/takaxp/emacs.d/blob/master/elget-config.el">emacs.d/elget-config.el at master · takaxp/emacs.d</a></li>
<li><a href="https://github.com/takaxp/emacs.d/blob/master/init-env.el">emacs.d/init-env.el at master · takaxp/emacs.d</a></li>
<li><a href="https://github.com/takaxp/emacs.d/blob/master/init.el">emacs.d/init.el at master · takaxp/emacs.d</a></li>
<li><a href="https://github.com/takaxp/emacs.d/blob/master/late-init.el">emacs.d/late-init.el at master · takaxp/emacs.d</a></li>
<li><a href="https://github.com/takaxp/emacs.d/blob/master/init-async.el">emacs.d/init-async.el at master · takaxp/emacs.d</a></li>
<li><a href="https://github.com/takaxp/emacs.d/blob/master/init-eval.el">emacs.d/init-eval.el at master · takaxp/emacs.d</a></li>
<li><a href="https://github.com/takaxp/emacs.d/blob/master/init-ad.el">emacs.d/init-ad.el at master · takaxp/emacs.d</a></li>
</ul>
</div>

<div id="outline-container-orgdb94bf6d" class="outline-3">
<h3 id="orgdb94bf6d"><span class="section-number-3">2.1</span> Spacemacs</h3>
<div class="outline-text-3" id="text-orgdb94bf6d">
<ul class="org-ul">
<li><a href="https://www.spacemacs.org/">Spacemacs: Emacs advanced Kit focused on Evil</a></li>
</ul>

<p>
たまに使いたくなるので，起動時に読み込む <code>init.el</code> を変えるだけで Spacemacs を読み込めるようにしています．
</p>

<p>
（Setup手順）
</p>
<ol class="org-ol">
<li>ln -s ~/Dropbox/emacs.d/config/.spacemacs ~/</li>
<li>git clone <a href="https://github.com/syl20bnr/spacemacs">https://github.com/syl20bnr/spacemacs</a> ~/.spacemacs.d</li>
</ol>
<p>
Then load the following at startup
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(load (concat (setq user-emacs-directory "~/.spacemacs.d/") "init.el"))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org2db575a1" class="outline-3">
<h3 id="org2db575a1"><span class="section-number-3">2.2</span> init.el のヘッダ</h3>
<div class="outline-text-3" id="text-org2db575a1">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">init.el --- My init.el -*- lexical-binding: t -*-</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Configurations for Emacs</span>
<span style="font-weight: bold; font-style: italic;">;;                                         </span><span style="font-weight: bold; font-style: italic;">Takaaki ISHIKAWA  <a href="mailto:takaxp%40ieee.org">&lt;takaxp@ieee.org&gt;</a></span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">see also https://takaxp.github.io/init.html</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org3c4d5a7a" class="outline-3">
<h3 id="org3c4d5a7a"><span class="section-number-3">2.3</span> initファイルの読み込み時間計測</h3>
<div class="outline-text-3" id="text-org3c4d5a7a">
<p>
次の関数を <code>init.el</code> の最初に記載して，オプション付きで <code>after-init-hook</code> に追加します．すると，initファイルの読み込み時間を計測できます（GUIのフレーム生成を含まない）．別途設定する <code>emacs-init-time</code> の派生関数とは違い， <code>after-init-hook</code> で実行される処理の時間もわかります．また，ほかの処理も微妙に入るので，あくまで目安です．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defconst</span> <span style="font-weight: bold; font-style: italic;">my-before-load-init-time</span> (current-time))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-load-init-time</span> ()
  <span style="font-style: italic;">"Loading time of user init files including time for `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">after-init-hook</span><span style="font-style: italic;">'."</span>
  (<span style="font-weight: bold;">let</span> ((time1 (float-time
                (time-subtract after-init-time my-before-load-init-time)))
        (time2 (float-time
                (time-subtract (current-time) my-before-load-init-time))))
    (message (concat <span style="font-style: italic;">"Loading init files: %.0f [msec], "</span>
                     <span style="font-style: italic;">"of which %.f [msec] for `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">after-init-hook</span><span style="font-style: italic;">'."</span>)
             (* 1000 time1) (* 1000 (- time2 time1)))))

(add-hook 'after-init-hook #'my-load-init-time t)

(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my-tick-previous-time</span> my-before-load-init-time)
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-tick-init-time</span> (msg)
  <span style="font-style: italic;">"Tick boot sequence at loading MSG."</span>
  (<span style="font-weight: bold;">when</span> my-loading-profile-p
    (<span style="font-weight: bold;">let</span> ((ctime (current-time)))
      (message <span style="font-style: italic;">"---- %5.2f[ms] %s"</span>
               (* 1000 (float-time
                        (time-subtract ctime my-tick-previous-time)))
               msg)
      (<span style="font-weight: bold;">setq</span> my-tick-previous-time ctime))))
</pre>
</div>

<p>
<code>after-init-hook</code> の値をチェックして， <code>my-load-init-time</code> が最後に配置されていることに留意します．以下は， <code>after-init-hook</code> の値の例です．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(session-initialize recentf-mode my-emacs-init-time my-load-init-time)
</pre>
</div>
</div>

<div id="outline-container-org715ba410" class="outline-4">
<h4 id="org715ba410"><span class="section-number-4">2.3.1</span> Emacs 起動時の呼び出し順</h4>
<div class="outline-text-4" id="text-org715ba410">
<p>
Emacsは，以下の順番で起動します．
</p>

<ol class="org-ol">
<li>Set before-init-time = (current-time) and Set after-init-time = nil</li>
<li>Initializes the window</li>
<li>Run before-init-hook</li>
<li>Set my-before-load-init-time = (current-time) =&gt; 独自変数で計測</li>
<li>Load user's init files</li>
<li>Set after-init-time = (current-time)</li>
<li>Run after-init-hook</li>
<li>Run emacs-startup-hook</li>
</ol>

<p>
<code>emacs-init-time</code> は，GUI生成と，GUI関連elの読み込み， <code>before-init-hook</code> で実行する関数の実行時間，およびユーザ定義のinitファイル群の読み込み時間の合計値となる．
</p>

<p>
すでに <code>after-init-time</code> で時間計測が完了しているので，その後に続く <code>after-init-hook</code> と <code>emacs-startup-hook</code> に登録された関数の実行時間は <code>emacs-init-time</code> の値に含まれない．
</p>

<p>
より端的に言えば， <code>emacs-init-time</code> = <code>before-init-time</code> - <code>after-init-time</code> である．
</p>

<p>
一方， <code>my-before-load-init-time</code> と <code>after-init-time</code> を使って計算する算出する起動時間には，GUI生成とGUI関連elの読み込み，before-init-hook にある関数の実行が含まれていない．
</p>

<p>
see also <a href="https://www.gnu.org/software/emacs/manual/html_node/elisp/Startup-Summary.html">Startup Summary - GNU Emacs Lisp Reference Manual</a>
</p>
</div>
</div>
</div>

<div id="outline-container-orga09727ae" class="outline-3">
<h3 id="orga09727ae"><span class="section-number-3">2.4</span> 起動時間の計測</h3>
<div class="outline-text-3" id="text-orga09727ae">
<p>
<code>M-x emacs-init-time</code> を実行すると，Emacsの起動にかかった時間が表示されます．個人的にはミリ秒表示が好きなので，手を加えて表示を変えます．元ネタは<a href="http://d.hatena.ne.jp/sugyan/20120120/1327037494">すぎゃーんメモ</a>からです．感謝．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-emacs-init-time</span> ()
  <span style="font-style: italic;">"Emacs booting time in msec."</span>
  (message <span style="font-style: italic;">"Emacs booting time: %.0f [msec] = `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">emacs-init-time</span><span style="font-style: italic;">'."</span>
           (* 1000
              (float-time (time-subtract
                           after-init-time
                           before-init-time)))))

(add-hook 'after-init-hook #'my-emacs-init-time)
</pre>
</div>

<p>
ついでに， <code>%.1f</code> で出力されるいつもの <code>emacs-init-time</code> をハック．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"time"</span>
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">ad:emacs-init-time</span> ()
    <span style="font-style: italic;">"Return a string giving the duration of the Emacs initialization."</span>
    (<span style="font-weight: bold;">interactive</span>)
    (<span style="font-weight: bold;">let</span> ((str
           (format <span style="font-style: italic;">"%.3f seconds"</span>
                   (float-time
                    (time-subtract after-init-time before-init-time)))))
      (<span style="font-weight: bold;">if</span> (called-interactively-p 'interactive)
          (message <span style="font-style: italic;">"%s"</span> str)
        str)))

  (advice-add 'emacs-init-time <span style="font-weight: bold;">:override</span> #'ad:emacs-init-time))
</pre>
</div>
</div>
</div>

<div id="outline-container-org4c3e9f59" class="outline-3">
<h3 id="org4c3e9f59"><span class="section-number-3">2.5</span> GCサイズの最適化</h3>
<div class="outline-text-3" id="text-org4c3e9f59">
<p>
起動時に発生するガベージコレクトを防きます．起動後に使用しているメモリサイズを超えていれば良さ気． <code>garbage-collection-messages</code> を設定しておくと，ガベージコレクトが生じる時にメッセージが出るようになります．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setq</span> gc-cons-threshold (* 128 1024 1024)) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">128MB</span>
(<span style="font-weight: bold;">setq</span> garbage-collection-messages t)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc7901a57" class="outline-3">
<h3 id="orgc7901a57"><span class="section-number-3">2.6</span> Common Lisp を使う</h3>
<div class="outline-text-3" id="text-orgc7901a57">
<ul class="org-ul">
<li><a href="http://lisperblog.blogspot.com/2008/12/blog-post_18.html">http://lisperblog.blogspot.com/2008/12/blog-post_18.html</a></li>
</ul>

<p>
一般的には次のように記載すればOKです．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">eval-when-compile</span>
  (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">cl-lib</span> nil t))
</pre>
</div>

<p>
しかし，いくつかのパッケージは，バイトパイル時の警告を回避するために， <code>cl-lib</code> と同様に <code>eval-when-compile</code> の中に記述する必要が出てきます． <code>init.el</code> の成長に伴い，対象パッケージが増えたので，別ファイル(<a href="https://github.com/takaxp/emacs.d/blob/master/init-eval.el">init-eval.el</a>)に括り出しました．バイトコンパイルするときだけ， <code>init-eval.el</code> を読み込みます．
</p>

<p>
例えば， <code>init.el</code> のコンパイルを次のようにします．
</p>

<div class="org-src-container">
<pre class="src src-sh">/Applications/Emacs.app/Contents/MacOS/Emacs -l ~/.emacs -l ~/Dropbox/emacs.d/config/init-eval.el -batch -f batch-byte-compile-if-not-done ~/Dropbox/emacs.d/config/init.el
</pre>
</div>

<p>
これなら <code>init.el</code> に <code>eval-when-compile</code> を書くのと同じに見えますが，そうしてしまうと，バイトコンパイルしない状態の <code>init.el</code> を読み込む場合に， <code>eval-when-compile</code> の中身がすべて実行されてしまい，起動が重くなってしまいます．
</p>

<p>
そもそも <code>init.org</code> を編集対象にしていて， <code>init.el</code> を手動でバイトコンパイルすることはないので，私のフローには合っています.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">eval-when-compile</span>
  (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">init-eval</span> nil t))
</pre>
</div>
</div>
</div>

<div id="outline-container-org8b967ce1" class="outline-3">
<h3 id="org8b967ce1"><span class="section-number-3">2.7</span> 警告の抑制</h3>
<div class="outline-text-3" id="text-org8b967ce1">
<p>
起動時に警告が出てうっとうしい場合に使います．起動直後に呼ばれるように， <code>.emacs</code> の上の方に書いておくとよいと思います．
</p>

<ul class="org-ul">
<li><a href="http://d.hatena.ne.jp/kitokitoki/20100425/p1">http://d.hatena.ne.jp/kitokitoki/20100425/p1</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setq</span> byte-compile-warnings
      '(not free-vars unresolved callargs redefine obsolete noruntime
            cl-functions interactive-only make-local))
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(setq byte-compile-warnings '(not obsolete))</span>
(<span style="font-weight: bold;">setq</span> ad-redefinition-action 'accept)
</pre>
</div>
</div>
</div>

<div id="outline-container-org0ea7dbaf" class="outline-3">
<h3 id="org0ea7dbaf"><span class="section-number-3">2.8</span> エラー表示の抑制</h3>
<div class="outline-text-3" id="text-org0ea7dbaf">
<p>
普段使いでは要らないので抑制します．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setq</span> debug-on-error nil)
</pre>
</div>
</div>
</div>

<div id="outline-container-org8d718626" class="outline-3">
<h3 id="org8d718626"><span class="section-number-3">2.9</span> バッファの保存を静かにする</h3>
<div class="outline-text-3" id="text-org8d718626">
<p>
ビルトインの <code>file.el</code> にある変数を使うと，バッファ保存時に表示されるメッセージが減り "Saving file &#x2026;" がメッセージバッファに記録されなくなります．バッファ保存時以外で，メッセージ出力を抑制したい場合は， <code>shut-up.el</code> が便利です．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setq</span> save-silently t) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">No need shut-up.el for saving files.</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org660ba5e8" class="outline-3">
<h3 id="org660ba5e8"><span class="section-number-3">2.10</span> [my-load-package-p] 設定の読み込みフラグを確認する</h3>
<div class="outline-text-3" id="text-org660ba5e8">
<p>
<code>autoload-if-found</code> のサポート関数です．
</p>

<p>
<code>my-loading-packages</code> 変数に，設定を無視するパッケージを記述しておくと， <code>autoload-if-found</code> 内でそれらを読み込まないようにします．読み込まなかったパッケージは，Messages バッファにそのことを報告します． <code>autoload-if-found</code> は本来の実装ではなく， <code>my-loading-packages</code> を参照するように手を加えています．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-load-package-p</span> (file)
  (<span style="font-weight: bold;">let</span> ((enabled t))
    (<span style="font-weight: bold;">when</span> (boundp 'my-loading-packages)
      (<span style="font-weight: bold;">dolist</span> (package my-loading-packages)
        (<span style="font-weight: bold;">let</span> ((name (car package))
              (flag (cdr package)))
          (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">and</span> (stringp name)
                     (equal file name)
                     (not flag))
            (<span style="font-weight: bold;">setq</span> enabled nil)
            (message <span style="font-style: italic;">"--- `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">%s</span><span style="font-style: italic;">' was NOT loaded intentionally"</span> name)))))
    enabled))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc0921cdc" class="outline-3">
<h3 id="orgc0921cdc"><span class="section-number-3">2.11</span> [autoload-if-found] 関数をリストで渡すautoload設定</h3>
<div class="outline-text-3" id="text-orgc0921cdc">
<p>
この <code>autoload-if-found</code> の初出は，<a href="http://www.sodan.org/~knagano/emacs/dotemacs.html">dot.emacs</a> です．
</p>

<p>
<code>autoload-if-found</code> と <code>with-eval-after-load</code> の組み合わせが基本です．最初に <code>when</code> 判定をすることで，パッケージが未インストールの状態に各種設定をスキップするので安全です．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my-skip-check-autoload-file</span> t)
(<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">bound-and-true-p</span> my-loading-packages)
  (<span style="font-weight: bold;">setq</span> my-skip-check-autoload-file nil))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">autoload-if-found</span> (functions file <span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> docstring interactive type)
  <span style="font-style: italic;">"set autoload iff. FILE has found."</span>
  (<span style="font-weight: bold;">when</span> (boundp 'my-required-libraries)
    (add-to-list 'my-required-libraries file))
  (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">or</span> my-skip-check-autoload-file
            (<span style="font-weight: bold;">and</span> (my-load-package-p file)
                 (locate-library file)))
    (<span style="font-weight: bold;">dolist</span> (f functions)
      (autoload f file docstring interactive type))
    t))
</pre>
</div>

<p>
この <code>init.el</code> は，基本的にこの <code>autoload-if-found</code> に依存しています．遅延ロードに基づく高速化において必須の関数ですが，特にこだわらない人は <code>use-package.el</code> に依存するのをオススメします．以下， <code>autoload-if-found</code> を使った設定のテンプレートです．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(f1 f2) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#38306;&#25968;&#12522;&#12473;&#12488;&#65294;&#35201;&#32032;&#12398;&#38306;&#25968;&#12434;&#21628;&#12406;&#26178;&#12395;&#65292;&#12497;&#12483;&#12465;&#12540;&#12472;&#12364;&#35501;&#12415;&#36796;&#12414;&#12428;&#12427;</span>
       <span style="font-style: italic;">"package-name"</span> nil t) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#31532;4&#24341;&#25968;&#12414;&#12391;&#25351;&#23450;&#12377;&#12427;&#12392;&#65292;M-x &#12391;&#35036;&#23436;&#23550;&#35937;&#12395;&#12394;&#12427;&#65294;</span>

  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(0) &#12496;&#12452;&#12488;&#12467;&#12531;&#12497;&#12452;&#12523;&#26178;&#12395;&#35686;&#21578;&#12364;&#12391;&#12383;&#12425;&#65292;&#23550;&#24540;&#12377;&#12427;&#12497;&#12483;&#12465;&#12540;&#12472;&#12434;&#35352;&#36617;</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#29694;&#22312;&#12399;&#65292;&#12496;&#12452;&#12488;&#12467;&#12531;&#12497;&#12452;&#12523;&#26178;&#12384;&#12369;&#65292;&#24517;&#35201;&#12394;&#12497;&#12483;&#12465;&#12540;&#12472;&#12398; require &#12434;&#20840;&#12390;&#35352;&#36617;&#12375;&#12383;</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">init-eval.el &#12434;&#35501;&#12415;&#36796;&#12416;&#26041;&#24335;&#12395;&#22793;&#26356;&#65294;&#12371;&#12371;&#12391;&#12399; eval-when-compile &#12434;&#20351;&#12431;&#12394;&#12356;&#65294;</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(eval-when-compile</span>
  <span style="font-weight: bold; font-style: italic;">;;   </span><span style="font-weight: bold; font-style: italic;">(require 'package-name nil t))</span>

  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(1) &#12497;&#12483;&#12465;&#12540;&#12472;&#12364;&#23384;&#22312;&#12377;&#12428;&#12400;&#65292; Emacs &#36215;&#21205;&#26178;&#12395;&#35501;&#12415;&#36796;&#12416;&#35373;&#23450;&#32676;</span>
  (<span style="font-weight: bold;">push</span> '(<span style="font-style: italic;">"\\.hoge$"</span> . package-name-mode) auto-mode-alist)
  (add-hook 'after-init-hook #'f1)
  (global-set-key (kbd <span style="font-style: italic;">"r"</span>) 'f2)
  (autoload-if-found '(hoge1 hoge2) <span style="font-style: italic;">"hoge"</span> nil t)

  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(2) &#36933;&#24310;&#35501;&#12415;&#36796;&#12415;&#12377;&#12427;&#35373;&#23450;&#32676;</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">autoload-if-found &#12391;&#36933;&#24310;&#12525;&#12540;&#12489;&#12377;&#12427;&#38306;&#25968;</span>
  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"package-name"</span>
    (<span style="font-weight: bold;">setq</span> v1 t)
    (<span style="font-weight: bold;">setq</span> v2 nil)
    (define-key package-name-map (kbd <span style="font-style: italic;">"q"</span>) 'f1))

  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#38306;&#36899;&#12377;&#12427;&#12497;&#12483;&#12465;&#12540;&#12472;&#12398;&#36933;&#24310;&#12525;&#12540;&#12489;</span>
  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"package-name2"</span>
    (<span style="font-weight: bold;">setq</span> v3 t)
    (<span style="font-weight: bold;">setq</span> v4 nil))

  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#36215;&#21205;&#26178;&#12395;&#23455;&#34892;&#12379;&#12378;&#65292;&#26368;&#21021;&#12395;&#20219;&#24847;&#12398;&#30330;&#34892;&#12377;&#12427;&#12467;&#12510;&#12531;&#12489;&#12414;&#12391;&#36933;&#24310;&#12525;&#12540;&#12489;&#12373;&#12379;&#12427;</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">see https://github.com/takaxp/postpone</span>
  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"postpone"</span>
    (<span style="font-weight: bold;">setq</span> v5 nil)))
</pre>
</div>

<p>
このカスタマイズされた <code>autoload-if-found</code> は引数にリストのみを受け付けます．欠点は，リスト内の全て関数に個別の <code>docstring</code> を設定できないため，ヘルプ画面で何の関数なのかの情報があまり表示されないことです．ただ， <code>require</code> でパッケージを読み込んでしまえば，本来の <code>docstring</code> の内容が正しく反映されるので，すべての情報を確認できるようになります．また， <code>interactive</code> を <code>t</code> にすれば， <code>M-x</code> で当該関数がリストアップされるようになります．したがって， <code>(docstring interactive) = (nil t)</code> をデフォルトで指定すればOKです． <code>type</code> には， <code>macro</code> や <code>keymap</code> を指定して，関数以外の情報をオートロード対象にします．
</p>

<p>
コンパイル時に <code>Warning: the function ‘google-this’ is not known to be defined.</code> のようなメッセージが出る時には， <code>autoload-if-found</code> の <code>functions</code> に当該関数を追加すると，警告されなくなります． <code>declare-function</code> を追記せずに済みます．
</p>

<p>
<code>locate-library</code> は，高速化を求める状況では，意外と高コストです．なので，それらを評価しないためのフラグ <code>skip-file-checking</code> を追加しました．各パッケージの設定は，基本的に <code>with-eval-after-load</code> に括られていることを前提にすれば，起動が停止する自体は避けられるので，悪くない選択です．もし変なことになってしまっても， <code>skip-file-checking</code> を <code>nil</code> にすれば，従来のようにパッケージの存在を確認し，安全に起動できます．
</p>
</div>
</div>

<div id="outline-container-orga2859651" class="outline-3">
<h3 id="orga2859651"><span class="section-number-3">2.12</span> [postpone.el] Emacs起動してから使い始めるタイミングで実行する</h3>
<div class="outline-text-3" id="text-orga2859651">
<ul class="org-ul">
<li><a href="https://github.com/takaxp/postpone">takaxp/postpone: Call functions just one time at your first action in Emacs</a></li>
</ul>

<p>
<code>helm-config</code> に紐付けていた遅延呼び出し関数および設定を，自作の <code>postpone.el</code> に紐付けました． <code>helm-config</code> に紐付けていた時は， <code>M-x</code> を初めて使う時に複数の設定が読み込まれましたが，今回の設定では，Emacs起動後の最初のアクション時に読み込まれます（一部のコマンドを除く）．これには <code>M-x</code> も含まれます．この <code>init.el</code> に記載された遅延読み込みは約660[ms]にも及びます．通常起動では約400[ms]を要している（コンソール起動の場合は，約100[ms]）ので，もし遅延読み込みしなければ，Emacsの起動が1秒を超えてしまうことになります．
</p>

<p>
起動後，即座にEmacs終了するシーンでは， <code>postpone.el</code> に紐付けた設定が活性化すると無駄になります．それを回避するために， <code>this-command</code> の値を確認して，条件に合う場合だけ <code>postpone.el</code> が読み込まれる（結果的に紐付いている全ての設定が活性化する）ようにしています．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">if</span> (not (locate-library <span style="font-style: italic;">"postpone"</span>))
    (message <span style="font-style: italic;">"postpone.el is NOT installed."</span>)
  (autoload 'postpone-kicker <span style="font-style: italic;">"postpone"</span> nil t)
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-postpone-kicker</span> ()
    (<span style="font-weight: bold;">interactive</span>)
    (<span style="font-weight: bold;">unless</span> (memq this-command <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">specify commands for exclusion</span>
                  '(self-insert-command
                    newline
                    delete-backward-char
                    save-buffer
                    save-buffers-kill-terminal
                    electric-newline-and-maybe-indent
                    exit-minibuffer))
      (message <span style="font-style: italic;">"Activating postponed packages..."</span>)
      (<span style="font-weight: bold;">let</span> ((t1 (current-time)))
        (postpone-kicker 'my-postpone-kicker)
        (<span style="font-weight: bold;">setq</span> postpone-init-time (float-time
                                  (time-subtract (current-time) t1))))
      (message <span style="font-style: italic;">"Activating postponed packages...done (%.3f seconds)"</span>
               postpone-init-time)))
  (add-hook 'pre-command-hook #'my-postpone-kicker))
</pre>
</div>
</div>
</div>

<div id="outline-container-org124f13e2" class="outline-3">
<h3 id="org124f13e2"><span class="section-number-3">2.13</span> [future-time-p] 指定時刻が本日の未来の時刻かを判定</h3>
<div class="outline-text-3" id="text-org124f13e2">
<p>
今日の時刻に限定して，指定時刻が過去の時間かどうかを判定します． <code>run-at-time</code> が想定通りに動かず，起動時に <code>run-at-time</code> に登録した関数が走ってしまうので，この判定が <code>non-nil</code> の時だけタイマー登録します． <code>time</code> を <code>HH:MM</code> の書式で与えます．指定時刻と現在時刻が同じ場合は，過去とみなします．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">future-time-p</span> (time)
  <span style="font-style: italic;">"Return non-nil if provided TIME formed of \"10:00\" is the future time."</span>
  (not (time-less-p
        (apply 'encode-time
               (<span style="font-weight: bold;">let</span> ((t1 (decode-time))
                     (t2 (parse-time-string time)))
                 (<span style="font-weight: bold;">setf</span> (nth 0 t1) 0)
                 (<span style="font-weight: bold;">setf</span> (nth 1 t1) (nth 1 t2))
                 (<span style="font-weight: bold;">setf</span> (nth 2 t1) (nth 2 t2))
                 t1))
        (current-time))))
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(when (future-time-p "10:00") (run-at-time...))</span>
</pre>
</div>

<p>
以下は古い実装．指定時刻と現在時刻が同じ場合は，タイマー登録の動作確認が楽だったこともあり，未来とみなしていた．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">passed-clock-p</span> (target)
  (<span style="font-weight: bold;">let</span> ((hour nil)
        (min nil)
        (current-hour nil)
        (current-min nil))
    (<span style="font-weight: bold;">when</span> (string-match <span style="font-style: italic;">"</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">[0-2]?[0-9]</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">:</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">[0-5][0-9]</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">"</span> target)
      (<span style="font-weight: bold;">setq</span> hour (substring target (match-beginning 1) (match-end 1)))
      (<span style="font-weight: bold;">setq</span> min (substring target (match-beginning 2) (match-end 2)))
      (<span style="font-weight: bold;">setq</span> current-hour (format-time-string <span style="font-style: italic;">"%H"</span> (current-time)))
      (<span style="font-weight: bold;">setq</span> current-min (format-time-string <span style="font-style: italic;">"%M"</span> (current-time)))
      (&lt; (+ (* (string-to-number hour) 60)
            (string-to-number min))
         (+ (* (string-to-number current-hour) 60)
            (string-to-number current-min))))))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgcea06248" class="outline-3">
<h3 id="orgcea06248"><span class="section-number-3">2.14</span> <span class="done DONE">DONE</span> [window-focus-p] フォーカス判定</h3>
<div class="outline-text-3" id="text-orgcea06248">
<p>
フォーカスが当たっているのかを判定するための関数です．
</p>

<p>
(2020-06-04) <code>frame-focus-state</code> という標準関数がありました．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"postpone"</span>
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">window-focus-p</span> ()
    (frame-parameter (selected-frame) 'last-focus-update)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org30c47759" class="outline-3">
<h3 id="org30c47759"><span class="section-number-3">2.15</span> [library-p] load-path にライブラリがあるかを判定</h3>
<div class="outline-text-3" id="text-org30c47759">
<p>
パッケージが <code>load-path</code> に存在していて使える状態にあるかを調べます．もし存在しなければ，メッセージバッファに [NOT FOUND] を刻みます．
</p>

<p>
<code>libraries</code> には複数のパッケージ名を指定でき，すべてが使える状態の場合のみ <code>t</code> が返ります．
</p>

<p>
<code>"org"</code> を渡したり， <code>'("org" "helm")</code> を渡したりできます．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###</span><span style="font-weight: bold; font-style: italic;">autoload</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">library-p</span> (libraries)
  <span style="font-style: italic;">"Return t when every specified library can be located. "</span>
  (<span style="font-weight: bold;">let</span> ((result t))
    (mapc (<span style="font-weight: bold;">lambda</span> (library)
            (<span style="font-weight: bold;">unless</span> (locate-library library)
              (message <span style="font-style: italic;">"--- NOT FOUND: %s"</span> library)
              (<span style="font-weight: bold;">setq</span> result nil)))
          (<span style="font-weight: bold;">if</span> (listp libraries)
              libraries
            (list libraries)))
    result))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfca510d8" class="outline-3">
<h3 id="orgfca510d8"><span class="section-number-3">2.16</span> [shut-up.el] Messages 出力を封じる（制御する）</h3>
<div class="outline-text-3" id="text-orgfca510d8">
<p>
<code>shut-up.el</code> というマクロがあり，現在はそちらを使っています．非常に強力です．
</p>

<ul class="org-ul">
<li><a href="https://github.com/cask/shut-up">cask/shut-up: Emacs, shut up would you!</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setq</span> message-log-max 5000) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#12513;&#12483;&#12475;&#12540;&#12472;&#12496;&#12483;&#12501;&#12449;&#12398;&#38263;&#12373;</span>
(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">shutup-p</span> nil)
(<span style="font-weight: bold;">setq</span> shutup-p (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">shut-up</span> nil t) t))
</pre>
</div>
</div>

<div id="outline-container-orgb6593164" class="outline-4">
<h4 id="orgb6593164"><span class="section-number-4">2.16.1</span> with-suppressed-message&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></h4>
<div class="outline-text-4" id="text-orgb6593164">
<p>
以下はそれ以前のアプローチ． <code>recentf-save-list</code> を <code>find-file-hook</code> にぶら下げていますが，そのままだと <code>org-agenda</code> の初回実行時にたくさんのメッセージが出てしまうところ，このマクロを介すだけで抑制可能です． <code>message-log-max</code> で制御できるのがすごい．
</p>

<ul class="org-ul">
<li><a href="http://qiita.com/itiut@github/items/d917eafd6ab255629346">Emacs - エコーエリアや <b>Messages</b> バッファにメッセージを表示させたくない - Qiita</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defmacro</span> <span style="font-weight: bold;">with-suppressed-message</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;rest</span> body)
  <span style="font-style: italic;">"Suppress new messages temporarily in the echo area and the `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">*Messages*</span><span style="font-style: italic;">' buffer while BODY is evaluated."</span>
  (<span style="font-weight: bold;">declare</span> (indent 0))
  (<span style="font-weight: bold;">let</span> ((message-log-max nil))
    `(<span style="font-weight: bold;">with-temp-message</span> (<span style="font-weight: bold;">or</span> (current-message) <span style="font-style: italic;">""</span>) ,@body)))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgb59612b6" class="outline-3">
<h3 id="orgb59612b6"><span class="section-number-3">2.17</span> [exec-path-from-shell.el] PATH設定をシェルから継承する&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></h3>
<div class="outline-text-3" id="text-orgb59612b6">
<ul class="org-ul">
<li><a href="https://github.com/purcell/exec-path-from-shell">purcell/exec-path-from-shell: Make Emacs use the $PATH set up by the user's shell</a></li>
</ul>

<p>
外部プログラムのサポートを得て動くパッケージは，設定の過程で「プログラムが見つからない」と怒られることがしばしばあります． <code>exec-path-from-shell</code> は，シェルに設定した <code>PATH</code> の情報を継承して <code>exec-path</code> や <code>PATH</code> を設定してくれます．私は起動時に環境を切り替えることがあるので使ってませんが，使われている方は多いようです．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">and</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">exec-path-from-shell</span> nil t)
           (memq window-system '(mac ns)))
  (exec-path-from-shell-initialize))
</pre>
</div>
</div>
</div>

<div id="outline-container-org0b7d9710" class="outline-3">
<h3 id="org0b7d9710"><span class="section-number-3">2.18</span> [eval-after-autoload-if-found] 遅延読み込み&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></h3>
<div class="outline-text-3" id="text-org0b7d9710">
<p>
<b>現在は使っていません．非推奨です．</b>
</p>

<p>
<code>with-eval-after-load</code> とのペアでマクロ化したバージョンです．ただ，生成されるバイトコードに問題がありそうなので，最近は使っています．長らくお世話になっております．になりましたが，現在は， <code>autoload-if-found</code> と <code>with-eval-after-load</code> の組み合わせを使っています．
</p>

<p>
Twitterでぼやいていたら <a href="https://twitter.com/cvmat">@cvmat</a>さんが降臨して次のマクロを作ってくださいました．感謝感謝．
</p>

<ul class="org-ul">
<li><a href="https://gist.github.com/3513287">https://gist.github.com/3513287</a></li>
</ul>

<p>
autoload-if-found で遅延読み込みすると，eval-after-load と組み合わせるので，どうしてもインデントが増えてしまうのが欠点です．
</p>

<p>
例えば，cycle-buffer を遅延読み込みしたい場合， <code>setq</code> で変数を書き換えするために随分とインデントが進んでいます．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(cycle-buffer cycle-buffer-backward) <span style="font-style: italic;">"cycle-buffer"</span> nil t)

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"cycle-buffer"</span>
    (<span style="font-weight: bold;">setq</span> cycle-buffer-allow-visible t)
    (<span style="font-weight: bold;">setq</span> cycle-buffer-show-length 12)
    (<span style="font-weight: bold;">setq</span> cycle-buffer-show-format '(<span style="font-style: italic;">" [ %s ]"</span> . <span style="font-style: italic;">" %s"</span>))))
</pre>
</div>

<p>
これをスッキリさせるために <code>eval-after-autoload-if-found</code> を導入します．記述がシンプルになり，行数も桁数もスッキリです．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(eval-after-autoload-if-found
 '(cycle-buffer cycle-buffer-backward) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">autoload &#12391;&#21453;&#24540;&#12373;&#12379;&#12427;&#38306;&#25968;</span>
 <span style="font-style: italic;">"cycle-buffer"</span> nil t nil      <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#21453;&#24540;&#12373;&#12379;&#12383;&#38306;&#25968;&#12398;&#12467;&#12540;&#12523;&#12391;&#35501;&#12416;&#12497;&#12483;&#12465;&#12540;&#12472;&#25351;&#23450;</span>
 '(<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#12497;&#12483;&#12465;&#12540;&#12472;&#35501;&#12415;&#36796;&#12415;&#24460;&#12398;&#35373;&#23450;</span>
   (<span style="font-weight: bold;">setq</span> cycle-buffer-allow-visible t)
   (<span style="font-weight: bold;">setq</span> cycle-buffer-show-length 12)
   (<span style="font-weight: bold;">setq</span> cycle-buffer-show-format '(<span style="font-style: italic;">" &lt; %s &gt;"</span> . <span style="font-style: italic;">" %s"</span>))))
</pre>
</div>

<p>
さらに戻り値を判定して，グローバルなキーアサインもできます．存在しないパッケージの関数呼び出しを明示的に防ぐために有効です． <code>hook</code> 系の登録も同様です．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (eval-after-autoload-if-found
       '(cycle-buffer cycle-buffer-backward) <span style="font-style: italic;">"cycle-buffer"</span> nil t nil
       '((<span style="font-weight: bold;">setq</span> cycle-buffer-allow-visible t)
         (<span style="font-weight: bold;">setq</span> cycle-buffer-show-length 12)
         (<span style="font-weight: bold;">setq</span> cycle-buffer-show-format '(<span style="font-style: italic;">" &lt; %s &gt;"</span> . <span style="font-style: italic;">" %s"</span>))
         <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#12497;&#12483;&#12465;&#12540;&#12472;&#12398;&#12461;&#12540;&#12450;&#12469;&#12452;&#12531;&#12399;&#12371;&#12385;&#12425;</span>
         <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(define-key xxx-map (kbd "q") 'hoge)</span>
         ))
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#12464;&#12525;&#12540;&#12496;&#12523;&#12399;&#12371;&#12385;&#12425;</span>
  (global-set-key (kbd <span style="font-style: italic;">"M-]"</span>) 'cycle-buffer)
  (<span style="font-weight: bold;">when</span> (display-graphic-p)
    (global-set-key (kbd <span style="font-style: italic;">"M-["</span>) 'cycle-buffer-backward))
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#12497;&#12483;&#12465;&#12540;&#12472;&#12395;&#32016;&#20184;&#12356;&#12383;&#12501;&#12483;&#12463;&#12399;&#12371;&#12385;&#12425;&#12408;</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(add-hook 'xxx-hook #'hogehoge)</span>
  <span style="font-weight: bold; font-style: italic;">;;</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#12499;&#12523;&#12489;&#12452;&#12531;&#12391;&#12399;&#12394;&#12356;mode&#12398; auto-mode-alist &#35373;&#23450;&#12418;&#24517;&#35201;&#12394;&#12425;&#12371;&#12385;&#12395;&#35352;&#36848;</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(push '("\\.hoge$" . hoge-mode) auto-mode-alist)</span>
  )
</pre>
</div>

<p>
なお，第四引数 <code>(functions file docstring interactive)</code> まで指定すれば， <code>M-x</code> の呼び出し候補に functions で指定した関数が補完表示されます．
</p>
</div>

<div id="outline-container-org42722212" class="outline-4">
<h4 id="org42722212"><span class="section-number-4">2.18.1</span> 関数版</h4>
<div class="outline-text-4" id="text-org42722212">
<p>
関数版にリスト <code>my-loading-packages</code> を追加しました．このリストに事前に Lisp ファイル名を入れておくと，一切の設定をスキップするものです． <code>eval-after-atoload-if-found</code> を定義する前に次のような変数を設定しておきます．バイトコンパイルしていないファイルに書いておけば，パッケージのON/OFFを簡単に制御できます．
</p>

<p>
ただ問題点として，最後の引数に入れる関数がバイトコンパイル時に展開されないようで，出来上がったバイトコードが高速化に寄与しているのか不明です．簡易的な実験ではだいぶ差があるようで，最近は <code>autoload-if-found</code> ， <code>with-eval-after-load</code> ， <code>eval-when-compile</code> の組み合わせで設定を書いて，遅延ロードと高速読み込みを実現しています． <code>my-loading-packages</code> は <code>autoload-if-found</code> に組み込みました．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setq</span> my-loading-packages <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#36861;&#21152;&#12373;&#12428;&#12390;&#12356;&#12394;&#12356;&#22580;&#21512;&#12399;&#27161;&#28310;&#12391;&#35501;&#12415;&#36796;&#12416;</span>
      '((<span style="font-style: italic;">"web-mode"</span> . nil) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#35501;&#12415;&#36796;&#12414;&#12394;&#12356;</span>
        (<span style="font-style: italic;">"org"</span> . t))) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#35501;&#12415;&#36796;&#12416;</span>
</pre>
</div>

<p>
<a href="https://gist.github.com/3513287">https://gist.github.com/3513287</a>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">https://github.com/zk-phi/setup</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(when (require 'setup nil t)</span>
<span style="font-weight: bold; font-style: italic;">;;   </span><span style="font-weight: bold; font-style: italic;">(setup-initialize))</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">eval-after-autoload-if-found</span>
    (functions file <span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> docstring interactive type after-body)
  <span style="font-style: italic;">"Set up autoload and eval-after-load for FUNCTIONS iff. FILE has found."</span>
  (<span style="font-weight: bold;">let</span> ((enabled t)
        (package nil))
    (message <span style="font-style: italic;">"--- %s"</span> file)
    (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">bound-and-true-p</span> my-loading-packages)
      (<span style="font-weight: bold;">dolist</span> (package my-loading-packages)
        (<span style="font-weight: bold;">let</span> ((name (car package))
              (flag (cdr package)))
          (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">and</span> (stringp name) (equal file name))
            (<span style="font-weight: bold;">unless</span> flag
              (<span style="font-weight: bold;">setq</span> enabled nil)
              (message <span style="font-style: italic;">"--- A setting for `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">%s</span><span style="font-style: italic;">' was NOT loaded explicitly"</span>
                       name))))))
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">if disabled then return nil.</span>
    (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">and</span> enabled (locate-library file))
      (mapc (<span style="font-weight: bold;">lambda</span> (func)
              (autoload func file docstring interactive type))
            (<span style="font-weight: bold;">if</span> (listp functions)
                functions
              (list functions)))
      (<span style="font-weight: bold;">when</span> after-body
        (eval-after-load file `(<span style="font-weight: bold;">progn</span> ,@after-body)))
      t)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org1498f6ce" class="outline-4">
<h4 id="org1498f6ce"><span class="section-number-4">2.18.2</span> マクロ版</h4>
<div class="outline-text-4" id="text-org1498f6ce">
<p>
以下はマクロ版です．引数の渡し方が関数と少し違うので要注意です．
</p>

<p>
<a href="https://gist.github.com/3499459">https://gist.github.com/3499459</a>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defmacro</span> <span style="font-weight: bold;">eval-after-autoload-if-found</span>
    (functions file <span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> docstring interactive type <span style="font-weight: bold; text-decoration: underline;">&amp;rest</span> after-body)
  <span style="font-style: italic;">"Set up autoload and eval-after-load for FUNCTIONS iff. FILE has found."</span>
  `(<span style="font-weight: bold;">let*</span> ((functions ,functions)
          (docstring ,docstring)
          (<span style="font-weight: bold;">interactive</span> ,interactive)
          (type ,type)
          (file ,file))
     (<span style="font-weight: bold;">when</span> (locate-library file)
       (mapc (<span style="font-weight: bold;">lambda</span> (func)
               (autoload func file docstring interactive type))
             (<span style="font-weight: bold;">if</span> (listp functions)
                 functions
               (list functions)))
       ,@(<span style="font-weight: bold;">when</span> after-body
           `((eval-after-load file '(<span style="font-weight: bold;">progn</span> ,@after-body))))
       t)))
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-org8e58f563" class="outline-2">
<h2 id="org8e58f563"><span class="section-number-2">3</span> コア設定</h2>
<div class="outline-text-2" id="text-org8e58f563">
<p>
Emacs を操作して文書編集する上で欠かせない設定です．
</p>
</div>

<div id="outline-container-org218fe598" class="outline-3">
<h3 id="org218fe598"><span class="section-number-3">3.1</span> 言語／文字コード</h3>
<div class="outline-text-3" id="text-org218fe598">
<p>
徹底的にUTF-8に合わせます．
</p>

<p>
<code>save-buffer-coding-system</code> を設定すると， <code>buffer-file-coding-system</code> の値を無視して，指定した <code>save-buffer-coding-system</code> の値でバッファを保存する．つまり， <code>buffer-file-coding-system</code> に統一するなら設定不要．
</p>

<p>
<code>set-default-coding-systems</code> か <code>prefer-coding-system</code> を設定すると，同時に <code>file-name-coding-system=，=set-terminal-coding-system=，=set-keyboard-coding-system</code> も設定される． <code>prefer-coding-system</code> は，文字コード自動判定の最上位判定項目を設定する．
</p>

<p>
<code>set-buffer-file-coding-system</code> は，Xとのデータやりとりを設定する．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(prefer-coding-system 'utf-8-unix)
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(set-language-environment "Japanese") ;; will take 20-30[ms]</span>
(set-locale-environment <span style="font-style: italic;">"en_US.UTF-8"</span>) <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">"ja_JP.UTF-8"</span>
(set-default-coding-systems 'utf-8-unix)
(set-selection-coding-system 'utf-8-unix)
(set-buffer-file-coding-system 'utf-8-unix)
</pre>
</div>
</div>
</div>

<div id="outline-container-org08c6f620" class="outline-3">
<h3 id="org08c6f620"><span class="section-number-3">3.2</span> 日本語入力</h3>
<div class="outline-text-3" id="text-org08c6f620">
<p>
NSビルド用のインラインパッチを適用している場合に使います．Lion でも使える自分用にカスタマイズした <a href="https://gist.github.com/1532344">inline-patch</a> を使っています．
</p>

<ul class="org-ul">
<li>Emacs24用には，Mavericks対応した<a href="https://gist.github.com/takaxp/9658281">パッチ</a>を使っています．</li>
<li>Emacs24.5用は<a href="https://gist.github.com/takaxp/1d91107b311b63b57529">こちら</a>．</li>
<li>Emacs25.2用は<a href="https://gist.github.com/takaxp/3314a153f6d02d82ef1833638d338ecf">こちら</a>．</li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (fboundp 'mac-add-key-passed-to-system)
  (<span style="font-weight: bold;">setq</span> default-input-method <span style="font-style: italic;">"MacOSX"</span>)
  (mac-add-key-passed-to-system 'shift))

(<span style="font-weight: bold;">when</span> (eq system-type 'gnu/linux)
  (global-set-key (kbd <span style="font-style: italic;">"&lt;hiragana-katakana&gt;"</span>) 'toggle-input-method)
  (<span style="font-weight: bold;">push</span> <span style="font-style: italic;">"/usr/share/emacs/site-lisp/anthy"</span> load-path)
  (<span style="font-weight: bold;">push</span> <span style="font-style: italic;">"/usr/share/emacs/site-lisp/emacs-mozc"</span> load-path)
  (set-language-environment <span style="font-style: italic;">"Japanese"</span>)

  (<span style="font-weight: bold;">if</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">mozc</span> nil t)
      (<span style="font-weight: bold;">progn</span>
        (<span style="font-weight: bold;">setq</span> default-input-method <span style="font-style: italic;">"japanese-mozc"</span>)
        (custom-set-variables
         '(mozc-candidate-style 'overlay)))

    (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">anthy</span> nil t) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">sudo yum install emacs-anthy-el</span>
      <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">if get error</span>
      (load-file <span style="font-style: italic;">"/usr/share/emacs/site-lisp/anthy/leim-list.el"</span>)
      (<span style="font-weight: bold;">setq</span> default-input-method 'japanese-anthy))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org532e1f02" class="outline-3">
<h3 id="org532e1f02"><span class="section-number-3">3.3</span> 基本キーバインド</h3>
<div class="outline-text-3" id="text-org532e1f02">
<p>
次の機能にキーバインドを設定する．
</p>

<ul class="org-ul">
<li>Cmd+V でペースト（Mac用）</li>
<li>Cmd と Option を逆にする（Mac用）</li>
<li>削除</li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (eq system-type 'darwin)
  (<span style="font-weight: bold;">when</span> (boundp 'ns-command-modifier)
    (<span style="font-weight: bold;">setq</span> ns-command-modifier 'meta))
  (<span style="font-weight: bold;">when</span> (boundp 'ns-alternate-modifier)
    (<span style="font-weight: bold;">setq</span> ns-alternate-modifier 'super))
  (<span style="font-weight: bold;">when</span> (boundp 'ns-pop-up-frames)
    (<span style="font-weight: bold;">setq</span> ns-pop-up-frames nil))
  (global-set-key (kbd <span style="font-style: italic;">"M-v"</span>) 'yank)
  (global-set-key [ns-drag-file] 'ns-find-file))
(global-set-key [delete] 'delete-char)
(global-set-key [kp-delete] 'delete-char)
</pre>
</div>
</div>
</div>

<div id="outline-container-org62c41327" class="outline-3">
<h3 id="org62c41327"><span class="section-number-3">3.4</span> ナローイングするか</h3>
<div class="outline-text-3" id="text-org62c41327">
<p>
ナローイングを有効にします．ナローイングを知らないユーザが「データが消えた！」と勘違いしないように，デフォルトでは無効になっています．
</p>

<p>
Org Mode でナローイングを使う場合は，特に設定しなくてもOKです．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(put 'narrow-to-region 'disabled nil)
</pre>
</div>

<p>
<code>fancy-narrow</code> を使うと，通常のナローイングではバッファ上で表示しなくなる領域を目立たないように残すことができます．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(autoload-if-found
 '(fancy-narrow-to-region
   fancy-widen
   org-fancy-narrow-to-block
   org-fancy-narrow-to-element
   org-fancy-narrow-to-subtree)
 <span style="font-style: italic;">"fancy-narrow"</span> nil t)
</pre>
</div>
</div>
</div>

<div id="outline-container-org162dbe4a" class="outline-3">
<h3 id="org162dbe4a"><span class="section-number-3">3.5</span> バッファの終わりでのnewlineを禁止する</h3>
<div class="outline-text-3" id="text-org162dbe4a">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Avoid adding a new line at the end of buffer</span>
(<span style="font-weight: bold;">setq</span> next-line-add-newlines nil)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgff941e69" class="outline-3">
<h3 id="orgff941e69"><span class="section-number-3">3.6</span> 常に最終行に一行追加する</h3>
<div class="outline-text-3" id="text-orgff941e69">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Limit the final word to a line break code (automatically correct)</span>
(<span style="font-weight: bold;">setq</span> require-final-newline t)
</pre>
</div>
</div>
</div>

<div id="outline-container-org7a9614cc" class="outline-3">
<h3 id="org7a9614cc"><span class="section-number-3">3.7</span> 長い文章を右端で常に折り返す</h3>
<div class="outline-text-3" id="text-org7a9614cc">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setq</span> truncate-lines nil)
(<span style="font-weight: bold;">setq</span> truncate-partial-width-windows nil)
</pre>
</div>
</div>
</div>

<div id="outline-container-org8dd417a4" class="outline-3">
<h3 id="org8dd417a4"><span class="section-number-3">3.8</span> マウスで選択した領域を自動コピー</h3>
<div class="outline-text-3" id="text-org8dd417a4">
<p>
マウスで選択すると，勝手にペーストボードにデータが流れます．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setq</span> mouse-drag-copy-region t)
</pre>
</div>
</div>
</div>

<div id="outline-container-org1b2d3cc0" class="outline-3">
<h3 id="org1b2d3cc0"><span class="section-number-3">3.9</span> compilation buffer でのデータ表示で自動するスクロールする</h3>
<div class="outline-text-3" id="text-org1b2d3cc0">
<p>
<code>nil</code> のままだと，出力が続いてもスクロールされないので，自動的にスクロールされるように設定．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setq</span> compilation-scroll-output t)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb26cd017" class="outline-3">
<h3 id="orgb26cd017"><span class="section-number-3">3.10</span> 水平方向の自動スクロール調整</h3>
<div class="outline-text-3" id="text-orgb26cd017">
<ul class="org-ul">
<li>違和感なく水平方向にスクロールさせる．</li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setq</span> hscroll-margin 40)
</pre>
</div>
</div>
</div>

<div id="outline-container-org68d1750d" class="outline-3">
<h3 id="org68d1750d"><span class="section-number-3">3.11</span> C-x C-c で容易にEmacsを終了させないように質問する</h3>
<div class="outline-text-3" id="text-org68d1750d">
<p>
<code>y-or-n-p</code> もしくは <code>yes-or-no-p</code> を指定するだけです．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setq</span> confirm-kill-emacs 'y-or-n-p)
</pre>
</div>

<p>
以前は， <code>C-x C-c</code> を以下の関数に割り当てて，任意の質問文で入力を求めていました．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">A simple solution is (setq confirm-kill-emacs 'y-or-n-p).</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">confirm-save-buffers-kill-emacs</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> arg)
  <span style="font-style: italic;">"Show yes or no when you try to kill Emacs"</span>
  (<span style="font-weight: bold;">interactive</span> <span style="font-style: italic;">"P"</span>)
  (<span style="font-weight: bold;">cond</span> (arg (save-buffers-kill-emacs))
        (t
         (<span style="font-weight: bold;">when</span> (yes-or-no-p <span style="font-style: italic;">"Are you sure to quit Emacs now? "</span>)
           (save-buffers-kill-emacs)))))

(global-set-key (kbd <span style="font-style: italic;">"C-x C-c"</span>) 'confirm-save-buffers-kill-emacs)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd7b8f4e2" class="outline-3">
<h3 id="orgd7b8f4e2"><span class="section-number-3">3.12</span> パッケージ管理</h3>
<div class="outline-text-3" id="text-orgd7b8f4e2">
<p>
<a href="https://github.com/cask/cask">Cask</a>+Palletの環境を採用しました．それまでは，特定のディレクトリに必要な elisp をダウンロードしておいたり，git から取り寄せて，それらをload-pathに設定するスクリプトを準備するなど，個人的なルールで運用してきましたが，希望の機能をCaskが提供しているので，Emacs24.4になるタイミングで移行しました．
</p>

<p>
ただし，頒布元が危ういようなファイルはやはり個人で管理しておきたいので，Caskで管理する対象は，MEPLA経由で入手可能なメンテナンスが行き届いたパッケージに限定しています．また，普通の使い方（casl.elを読み込んで初期化）をしていると，起動時に少し時間を要するので，所定のディレクトリにCaskで取り寄せたすべてのファイルをコピーして，そのディレクトリだけをload-pathで指定するという使い方もしています．今のところ大きな問題は生じていません．
</p>
</div>

<div id="outline-container-orgf6f05dc9" class="outline-4">
<h4 id="orgf6f05dc9"><span class="section-number-4">3.12.1</span> [cask-mode.el] モード設定</h4>
<div class="outline-text-4" id="text-orgf6f05dc9">
<ul class="org-ul">
<li><a href="https://github.com/Wilfred/cask-mode">Wilfred/cask-mode: Major mode for editing Cask files</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found '(cask-mode) <span style="font-style: italic;">"cask-mode"</span> nil t)
  (<span style="font-weight: bold;">push</span> '(<span style="font-style: italic;">"/Cask\\'"</span> . cask-mode) auto-mode-alist))
</pre>
</div>
</div>
</div>

<div id="outline-container-org02669d67" class="outline-4">
<h4 id="org02669d67"><span class="section-number-4">3.12.2</span> Cask のセットアップ</h4>
<div class="outline-text-4" id="text-org02669d67">
<p>
以下は自分用のメモです．
</p>

<ol class="org-ol">
<li>curl -fsSkL <a href="https://raw.github.com/cask/cask/master/go">https://raw.github.com/cask/cask/master/go</a> | python</li>
<li>~/.cask/bin に PATH を通す (see .zshenv, export PATH="${HOME}/.cask/bin:{$PATH}")</li>
<li>cask upgrade</li>
<li>cd ~/.emacs.d</li>
<li>cask init            ;; ~/.emacs.d/Cask が存在しない場合だけ実行</li>
<li>cask install</li>
</ol>
</div>
</div>

<div id="outline-container-orgec66ea31" class="outline-4">
<h4 id="orgec66ea31"><span class="section-number-4">3.12.3</span> load-path を一箇所にして起動を高速化</h4>
<div class="outline-text-4" id="text-orgec66ea31">
<p>
Caskを使うと，個々のパッケージが独立にload-pathに設定されます．これにより依存関係がスッキリするわけですが，数が増えると起動時間が遅くなります．重いです．自分の例では，800[ms]のオーバーヘッドでした．これを避けるには，load-pathを一箇所に集約することが効きます．オーバーヘッドは約100[ms]まで削減できました．場合によっては依存関係に問題が生じる可能性がありますが，今のところは問題になっていません．
</p>

<ol class="org-ol">
<li><code>~/.emacs.d/.cask/package/&lt;emacs-version&gt;</code> なるフォルダを作る</li>
<li><code>~/.emacs.d/.cask/24.4.1/elpa/*/*</code> と <code>~/.emacs.d/.cask/24.4.1/elpa/*/lisp/*</code> をすべて上記フォルダにコピー</li>
<li><code>~/.emacs</code> で， <code>~/.emacs.d/.cask/package/&lt;emacs-version&gt;</code> を load-path に設定し，Caskは読み込まない</li>
</ol>

<p>
<code>M-x lis-packges</code> を使って新しいパッケージをインストールする時だけ，以下のフラグを nil に書き換えてEmacsを起動します． <code>load-path-setter</code> は独自関数です（普通に <code>add-to-list</code> で追加するのと同じです）
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defconst</span> <span style="font-weight: bold; font-style: italic;">cask-package-dir</span>
  (format <span style="font-style: italic;">"~/.emacs.d/.cask/package/%s"</span> emacs-version))
(<span style="font-weight: bold;">if</span> t
    (load-path-setter `(,cask-package-dir) 'load-path)
  (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">or</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">cask</span> <span style="font-style: italic;">"~/.cask/cask.el"</span> t)
            (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">cask</span> <span style="font-style: italic;">"/usr/local/opt/cask/cask.el"</span> t)) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Homebrew</span>
    (<span style="font-weight: bold;">when</span> (fboundp 'cask-initialize) (cask-initialize))) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">800[ms]</span>
  (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">pallet</span> nil t)
    (<span style="font-weight: bold;">when</span> (fboundp 'pallet-mode) (pallet-mode t))))
</pre>
</div>

<p>
Cask で新しいパッケージを導入したり，既存のパッケージを更新したら，その都度，package ディレクトリにコピーします．手動でやると面倒なので，次のようなスクリプトで対処します．アルファリリースなどに対応するときなど，少し調整が必要です．
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">!/bin/</span><span style="font-weight: bold;">sh</span>

<span style="font-weight: bold; font-style: italic;">LOADPATH</span>=$<span style="font-weight: bold; font-style: italic;">HOME</span>/.emacs.d/lisp
<span style="font-weight: bold; font-style: italic;">SOURCEPATH</span>=$<span style="font-weight: bold; font-style: italic;">HOME</span>/Dropbox/emacs.d
<span style="font-weight: bold; font-style: italic;">EVALWCOMPILE</span>=<span style="font-style: italic;">"$SOURCEPATH/config/init-eval.el"</span>

<span style="font-weight: bold;">while </span><span style="font-weight: bold;">getopts</span> t:hd opt
<span style="font-weight: bold;">do</span>
<span style="font-weight: bold;">case</span> ${<span style="font-weight: bold; font-style: italic;">opt</span>} <span style="font-weight: bold;">in</span>
t)
<span style="font-weight: bold; font-style: italic;">TARGET</span>=${<span style="font-weight: bold; font-style: italic;">OPTARG</span>};;
d)
<span style="font-weight: bold;">echo</span> <span style="font-style: italic;">"--- Remove byte compiled files."</span>
rm -rf $<span style="font-weight: bold; font-style: italic;">LOADPATH</span>/*.elc
rm -rf $<span style="font-weight: bold; font-style: italic;">SOURCEPATH</span>/config/*.elc
rm -rf ${<span style="font-weight: bold; font-style: italic;">HOME</span>}/devel/git/org-mode/lisp/*.elc
<span style="font-weight: bold;">exit</span> 1;;
h)
<span style="font-weight: bold;">echo</span> <span style="font-style: italic;">"TARGET LIST:"</span>;
<span style="font-weight: bold;">echo</span> <span style="font-style: italic;">"  actex"</span>;
<span style="font-weight: bold;">echo</span> <span style="font-style: italic;">"  org-sync"</span>;
<span style="font-weight: bold;">echo</span> <span style="font-style: italic;">"  yatex"</span>;
<span style="font-weight: bold;">echo</span> <span style="font-style: italic;">"e.g."</span>
<span style="font-weight: bold;">echo</span> <span style="font-style: italic;">"&gt; $0 -t anything"</span>
<span style="font-weight: bold;">exit</span> 1;;
<span style="font-style: italic;">\?</span>)
<span style="font-weight: bold;">exit</span> 1;;
<span style="font-weight: bold;">esac</span>
<span style="font-weight: bold;">exit</span> 0
<span style="font-weight: bold;">done</span>

<span style="font-weight: bold;">if</span> [ ! -f $<span style="font-weight: bold; font-style: italic;">HOME</span>/.zsh.local ]; <span style="font-weight: bold;">then</span>
    <span style="font-weight: bold;">echo</span> <span style="font-style: italic;">"~/.zsh.local does NOT exist."</span>
    <span style="font-weight: bold;">exit</span> 0
<span style="font-weight: bold;">fi</span>

<span style="font-weight: bold;">if</span> [ ! -d $<span style="font-weight: bold; font-style: italic;">HOME</span>/.emacs.d ]; <span style="font-weight: bold;">then</span>
    <span style="font-weight: bold;">echo</span> <span style="font-style: italic;">"~/.emacs.d does NOT exist."</span>
    <span style="font-weight: bold;">exit</span> 0
<span style="font-weight: bold;">fi</span>

<span style="font-weight: bold; font-style: italic;">EMACS</span>=<span style="font-weight: bold;">`which emacs`</span>
<span style="font-weight: bold;">if</span> [ $<span style="font-weight: bold; font-style: italic;">HOSTTYPE</span> = <span style="font-style: italic;">"intel-mac"</span> ]; <span style="font-weight: bold;">then</span>
    <span style="font-weight: bold; font-style: italic;">TARGETV</span>=head <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">25.1, 25.2, 25.3, 26.1, head</span>
    <span style="font-weight: bold; font-style: italic;">EMACS</span>=<span style="font-style: italic;">"/Users/taka/devel/emacs/bin/$TARGETV/Emacs.app/Contents/MacOS/Emacs"</span>
    <span style="font-weight: bold;">if</span> [ $<span style="font-weight: bold; font-style: italic;">TARGETV</span> = <span style="font-style: italic;">"head"</span> ]; <span style="font-weight: bold;">then</span>
        <span style="font-weight: bold; font-style: italic;">EMACS</span>=<span style="font-style: italic;">'/Applications/Emacs.app/Contents/MacOS/Emacs'</span>
    <span style="font-weight: bold;">fi</span>
<span style="font-weight: bold;">fi</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">$EMACS -l ~/.emacs --script ~/Dropbox/config/tangle.el</span>
$<span style="font-weight: bold; font-style: italic;">EMACS</span> -q --script ~/Dropbox/config/tangle.el

<span style="font-weight: bold;">echo</span> <span style="font-style: italic;">"--- Starting batch-byte-compiles with GNU Emacs ($TARGETV)."</span>

<span style="font-weight: bold; font-style: italic;">COMMAND</span>=<span style="font-style: italic;">"$EMACS -l ~/.emacs -l $EVALWCOMPILE -batch -f batch-byte-compile-if-not-done"</span>

rm -rf $<span style="font-weight: bold; font-style: italic;">LOADPATH</span>/*.elc
rm -rf $<span style="font-weight: bold; font-style: italic;">LOADPATH</span>/utility-autoloads.el
rm -rf $<span style="font-weight: bold; font-style: italic;">SOURCEPATH</span>/config/*.elc

cp -rf $<span style="font-weight: bold; font-style: italic;">SOURCEPATH</span>/*.el $<span style="font-weight: bold; font-style: italic;">LOADPATH</span>
cp -rf $<span style="font-weight: bold; font-style: italic;">SOURCEPATH</span>/config/init.el $<span style="font-weight: bold; font-style: italic;">LOADPATH</span>
cp -rf $<span style="font-weight: bold; font-style: italic;">SOURCEPATH</span>/config/utility.el $<span style="font-weight: bold; font-style: italic;">LOADPATH</span>

$<span style="font-weight: bold; font-style: italic;">COMMAND</span> $<span style="font-weight: bold; font-style: italic;">LOADPATH</span>/init.el
$<span style="font-weight: bold; font-style: italic;">COMMAND</span> $<span style="font-weight: bold; font-style: italic;">LOADPATH</span>/utility.el
<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">$COMMAND $SOURCEPATH/config/init.el $SOURCEPATH/config/utility.el $SOURCEPATH/*.el</span>
$<span style="font-weight: bold; font-style: italic;">EMACS</span> -Q --batch --eval=<span style="font-style: italic;">"(update-file-autoloads \"$LOADPATH/utility.el\" t \"$LOADPATH/utility-autoloads.el\")"</span>

<span style="font-weight: bold;">if</span> [ ! -f <span style="font-style: italic;">"$LOADPATH/utility-autoloads.el"</span> ]; <span style="font-weight: bold;">then</span>
    <span style="font-weight: bold;">echo</span> <span style="font-style: italic;">"--- missing $LOADPATH/utility-autoloads.el!"</span>
<span style="font-weight: bold;">fi</span>

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">raw</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">/Applications/Emacs.app/Contents/MacOS/Emacs -l ~/.emacs -l ~/Dropbox/emacs.d/config/init-eval.el -batch -f batch-byte-compile-if-not-done</span>

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">mv $SOURCEPATH/config/init.elc $HOME/.emacs.d</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">mv $SOURCEPATH/config/utility.elc $HOME/.emacs.d</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">mv $SOURCEPATH/*.elc $HOME/.emacs.d</span>

<span style="font-weight: bold;">echo</span> <span style="font-style: italic;">"--- done."</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgda4ef167" class="outline-4">
<h4 id="orgda4ef167"><span class="section-number-4">3.12.4</span> [paradox.el] パッケージ選択画面の改善</h4>
<div class="outline-text-4" id="text-orgda4ef167">
<p>
パッケージインストール用のバッファが多機能になります．スターが表示されたり，ミニバッファには様々な情報が表示されるようになります．基本の操作系は同じで，拡張部分は <code>h</code> を押すとミニバッファにディスパッチャが表示されます．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(paradox-list-packages
         my-list-packages my-setup-cask
         my-reset-load-path
         advice:paradox-quit-and-close)
       <span style="font-style: italic;">"paradox"</span> nil t)

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"paradox"</span>
    (<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my-default-load-path</span> nil)
    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-list-packages</span> ()
      <span style="font-style: italic;">"Call paradox-list-packages if available instead of list-packages."</span>
      (<span style="font-weight: bold;">interactive</span>)
      (<span style="font-weight: bold;">setq</span> my-default-load-path load-path)
      (my-setup-cask)
      (<span style="font-weight: bold;">if</span> (fboundp 'paradox-list-packages)
          (paradox-list-packages nil)
        (list-packages nil)))

    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-reset-load-path</span> ()
      <span style="font-style: italic;">"Revert `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">load-path</span><span style="font-style: italic;">' to `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">my-default-load-path</span><span style="font-style: italic;">'."</span>
      (shell-command-to-string <span style="font-style: italic;">"update-cask.sh link"</span>))
    (<span style="font-weight: bold;">setq</span> load-path my-default-load-path)
    (message <span style="font-style: italic;">"--- Reverted to the original `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">load-path</span><span style="font-style: italic;">'."</span>))

  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(declare-function advice:paradox-quit-and-close "init" (kill))</span>

  (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">and</span> (fboundp 'cask-load-path)
             (fboundp 'cask-initialize))
    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-setup-cask</span> ()
      <span style="font-style: italic;">"Override `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">load-path</span><span style="font-style: italic;">' to use cask."</span>
      (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">or</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">cask</span> <span style="font-style: italic;">"/usr/local/opt/cask/cask.el"</span> t)
                (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">cask</span> <span style="font-style: italic;">"~/.cask/cask.el"</span> t))
        (<span style="font-weight: bold;">setq</span> load-path (cask-load-path (cask-initialize))))))

  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">advice:paradox-quit-and-close</span> (_kill)
    (my-reset-load-path))
  (advice-add 'paradox-quit-and-close <span style="font-weight: bold;">:after</span>
              #'advice:paradox-quit-and-close)

  (custom-set-variables
   '(paradox-github-token t))

  (<span style="font-weight: bold;">unless</span> noninteractive
    (<span style="font-weight: bold;">when</span> (fboundp 'paradox-enable)
      (paradox-enable))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org6c5717fc" class="outline-4">
<h4 id="org6c5717fc"><span class="section-number-4">3.12.5</span> [el-get.el] パッケージ管理（GUI，CUI）</h4>
<div class="outline-text-4" id="text-org6c5717fc">
<p>
密かに <code>el-get</code> に移行．コマンドラインからも効率よく管理可能．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(autoload-if-found
 '(el-get-version
   my-elget-list my-elget-reset-links el-get-cd el-get-install el-get-remove)
 <span style="font-style: italic;">"elget-config"</span> nil t)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org03555a6a" class="outline-3">
<h3 id="org03555a6a"><span class="section-number-3">3.13</span> インデント</h3>
<div class="outline-text-3" id="text-org03555a6a">
<p>
オープンソース等で他の人のコードを修正する場合は，以下のような設定は良くないかもしれません．例えば差分を取ると見た目は変わらないのに，タブとスペースの違いから差分ありと判定されてしまい，意図しない編集履歴が残ることがあります．ただこの問題は，修正対象のファイルが限定されているならば， <code>M-x tabify</code> や <code>M-x untabify</code> で回避できそうです．
</p>

<p>
一方， <code>org-mode</code> のソースブロックは半角スペース統一されているため，この設定のほうが都合が良いです．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setq-default</span> tab-width 2)
(<span style="font-weight: bold;">setq-default</span> indent-tabs-mode nil)
(<span style="font-weight: bold;">setq</span> indent-line-function 'insert-tab)

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(add-hook 'emacs-lisp-mode-hook</span>
<span style="font-weight: bold; font-style: italic;">;;           </span><span style="font-weight: bold; font-style: italic;">(lambda ()</span>
<span style="font-weight: bold; font-style: italic;">;;              </span><span style="font-weight: bold; font-style: italic;">(setq indent-tabs-mode t)</span>
<span style="font-weight: bold; font-style: italic;">;;              </span><span style="font-weight: bold; font-style: italic;">(setq tab-width 8)</span>
<span style="font-weight: bold; font-style: italic;">;;              </span><span style="font-weight: bold; font-style: italic;">(setq indent-line-function 'lisp-indent-line)))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfc7cc004" class="outline-3">
<h3 id="orgfc7cc004"><span class="section-number-3">3.14</span> ファイルリンクを辿る時に確認のメッセージを出さない</h3>
<div class="outline-text-3" id="text-orgfc7cc004">
<p>
そのまま辿ってファイルオープンします．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setq</span> vc-follow-symlinks t)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc2257142" class="outline-3">
<h3 id="orgc2257142"><span class="section-number-3">3.15</span> バッファが外部から編集された場合に自動で再読み込みする</h3>
<div class="outline-text-3" id="text-orgc2257142">
<p>
<code>auto-save-buffers</code> を使っていれば，バッファは常に保存された状態になるため， revert が即座に反映されます．適宜バックアップツールと組み合わせないと，バッファが自動更新されてしまうので不安かもしれません．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">unless</span> noninteractive
  (global-auto-revert-mode 1))
</pre>
</div>
</div>
</div>

<div id="outline-container-org4ea9e5f1" class="outline-3">
<h3 id="org4ea9e5f1"><span class="section-number-3">3.16</span> マウススクロールをピクセル単位にする</h3>
<div class="outline-text-3" id="text-org4ea9e5f1">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">unless</span> noninteractive
  (<span style="font-weight: bold;">when</span> (fboundp 'pixel-scroll-mode)
    (pixel-scroll-mode 1))) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">26.1</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org6a9f8b88" class="outline-3">
<h3 id="org6a9f8b88"><span class="section-number-3">3.17</span> デフォルトディレクトリ</h3>
<div class="outline-text-3" id="text-org6a9f8b88">
<p>
Version 27 から <code>C-x C-f</code> のデフォルトが変わったようなので， <code>~/</code> に矯正する．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (version&lt; <span style="font-style: italic;">"27.0"</span> emacs-version)
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">ad:find-file-read-args</span> (f prompt mustmatch)
    (<span style="font-weight: bold;">when</span> (equal default-directory <span style="font-style: italic;">"/"</span>)
      (<span style="font-weight: bold;">setq</span> default-directory <span style="font-style: italic;">"~/"</span>))
    (funcall f prompt mustmatch))
  (advice-add 'find-file-read-args <span style="font-weight: bold;">:around</span> #'ad:find-file-read-args))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb5cd55a9" class="outline-3">
<h3 id="orgb5cd55a9"><span class="section-number-3">3.18</span> [aggressive-indent.el] 即時バッファ整形</h3>
<div class="outline-text-3" id="text-orgb5cd55a9">
<p>
特定のメジャーモードで，とにかく整形しまくります． <code>python-mode</code> では意図しないインデントになったりします． <code>web-mode</code> だと異常に重かったりします．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(aggressive-indent-mode)
       <span style="font-style: italic;">"aggressive-indent"</span> nil t)

  (<span style="font-weight: bold;">dolist</span> (hook
           '(<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">python-mode-hook</span>
             <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">nxml-mode-hook</span>
             <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">web-mode-hook</span>
             emacs-lisp-mode-hook
             lisp-mode-hook perl-mode-hook c-mode-common-hook))

    (add-hook hook #'aggressive-indent-mode)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org723e2b73" class="outline-3">
<h3 id="org723e2b73"><span class="section-number-3">3.19</span> [uniquify.el] 同じバッファ名が開かれた場合に区別する</h3>
<div class="outline-text-3" id="text-org723e2b73">
<p>
ビルトインの <code>uniquify</code> を使います．モードラインの表示が変わります．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setq</span> uniquify-buffer-name-style 'post-forward-angle-brackets)
</pre>
</div>
</div>
</div>

<div id="outline-container-org982c69d7" class="outline-3">
<h3 id="org982c69d7"><span class="section-number-3">3.20</span> [ws-butler.el] 不要なスペースを自動除去</h3>
<div class="outline-text-3" id="text-org982c69d7">
<p>
行末の不要なスペース等が残るのを回避できます．バッファ保存時の自動処理です．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(ws-butler-mode ws-butler-global-mode)
       <span style="font-style: italic;">"ws-butler"</span> nil t)

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"ws-butler"</span>
    (custom-set-variables
     '(ws-butler-global-exempt-modes
       (append '(org-mode empty-booting-mode diff-mode change-log-mode)
               ws-butler-global-exempt-modes))))

  (<span style="font-weight: bold;">unless</span> noninteractive
    (ws-butler-global-mode)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orge014847e" class="outline-3">
<h3 id="orge014847e"><span class="section-number-3">3.21</span> [epa.el] GPGを使う</h3>
<div class="outline-text-3" id="text-orge014847e">
<p>
<code>w32</code> の MSYS2 で gpg を使うと，バージョン情報が "2.2.19-unknown" などとなる．その状況で <code>epg-find-configuration</code> が呼ばれると，内部で生じるエラーが報告されず nil となり， <code>epg.el</code> が以下を報告する．
</p>

<div class="org-src-container">
<pre class="src src-sh">GPG error: <span style="font-style: italic;">"no usable configuration,"</span> OpenPGP
</pre>
</div>

<p>
しかし実際には， <code>epg-find-configuration</code> が <code>epg-check-configuration</code> のエラーを正しく処理していないのが原因であり，この関数のハックが必要となる．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"epa"</span>
  (<span style="font-weight: bold;">when</span> (eq window-system 'w32)
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">with export GNUPGHOME="/home/taka/.gnupg" in .bashrc</span>
    (<span style="font-weight: bold;">setq</span> epg-gpg-home-directory <span style="font-style: italic;">".gnupg"</span>))

  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-epg-check-configuration</span> (config <span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> minimum-version)
    <span style="font-style: italic;">"Verify that a sufficient version of GnuPG is installed."</span>
    (<span style="font-weight: bold;">let</span> ((version (alist-get 'version config)))
      (<span style="font-weight: bold;">unless</span> (stringp version)
        (<span style="font-weight: bold;">error</span> <span style="font-style: italic;">"Undetermined version: %S"</span> version))
      <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">hack for w32</span>
      (<span style="font-weight: bold;">when</span> (eq window-system 'w32)
        (<span style="font-weight: bold;">setq</span> version (<span style="font-weight: bold;">or</span> minimum-version
                          epg-gpg-minimum-version)))
      <span style="font-weight: bold; font-style: italic;">;;</span>
      (<span style="font-weight: bold;">unless</span> (version&lt;= (<span style="font-weight: bold;">or</span> minimum-version
                             epg-gpg-minimum-version)
                         version)
        (<span style="font-weight: bold;">error</span> <span style="font-style: italic;">"Unsupported version: %s"</span> version))))
  (advice-add 'epg-check-configuration <span style="font-weight: bold;">:override</span> #'my-epg-check-configuration))
</pre>
</div>
</div>
</div>
<div id="outline-container-orge44eded5" class="outline-3">
<h3 id="orge44eded5"><span class="section-number-3">3.22</span> NSビルド用設定&#xa0;&#xa0;&#xa0;<span class="tag"><span class="macOS">macOS</span></span></h3>
<div class="outline-text-3" id="text-orge44eded5">
<p>
インラインパッチの適用が前提の設定です． <code>M-SPC/S-SPC</code> で日本語IMEのON/OFFができるようになります．インラインパッチの情報はリンク先にあります．
</p>

<ul class="org-ul">
<li><a href="http://qiita.com/takaxp/items/e07bb286d80fa9dd8e05">emacs-25.2 をインラインパッチをあてて使う（OSX） - Qiita</a></li>
<li><a href="https://gist.github.com/takaxp/3314a153f6d02d82ef1833638d338ecf">An inline-patch for Emacs-25.2</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (memq window-system '(ns nil))
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">toggle-input-method</span>
  (<span style="font-weight: bold;">declare-function</span> my-ns-org-heading-auto-ascii <span style="font-style: italic;">"init"</span> nil)
  (<span style="font-weight: bold;">declare-function</span> my-ns-ime-restore <span style="font-style: italic;">"init"</span> nil)
  (<span style="font-weight: bold;">declare-function</span> my-ime-active-p <span style="font-style: italic;">"init"</span> nil)

  (<span style="font-weight: bold;">if</span> (version&lt; emacs-version <span style="font-style: italic;">"27.0"</span>)
      (<span style="font-weight: bold;">progn</span>
        (global-set-key (kbd <span style="font-style: italic;">"M-SPC"</span>) 'my-toggle-ime-ns)
        (global-set-key (kbd <span style="font-style: italic;">"S-SPC"</span>) 'my-toggle-ime-ns))
    (global-set-key (kbd <span style="font-style: italic;">"M-SPC"</span>) 'mac-ime-toggle)
    (global-set-key (kbd <span style="font-style: italic;">"S-SPC"</span>) 'mac-ime-toggle)))

(<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">and</span> (memq window-system '(ns nil))
           (fboundp 'mac-get-current-input-source))

  (<span style="font-weight: bold;">when</span> (version&lt; <span style="font-style: italic;">"27.0"</span> emacs-version)
    (custom-set-variables
     '(mac-default-input-source <span style="font-style: italic;">"com.google.inputmethod.Japanese.base"</span>))
    (mac-input-method-mode 1)

    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">FIXME Conflict with migemo...</span>
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">To fix this issue, you need to update migemo.el to support minor-mode.</span>
    (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">migemo</span> nil t)
      (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-isearch-ime-deactivate-sticky</span> ()
        (<span style="font-weight: bold;">unless</span> (region-active-p)
          (mac-ime-deactivate-sticky)))
      <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">see also activate-mark-hook, deactivate-mark-hook</span>
      (add-hook 'isearch-mode-hook #'my-isearch-ime-deactivate-sticky)
      (add-hook 'isearch-mode-end-hook #'mac-ime-activate-sticky)))

  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-toggle-ime-ns</span> ()
    <span style="font-style: italic;">"Toggle IME."</span>
    (<span style="font-weight: bold;">interactive</span>)
    (<span style="font-weight: bold;">if</span> (my-ime-active-p) (my-ime-off) (my-ime-on)))

  (<span style="font-weight: bold;">if</span> (version&lt; emacs-version <span style="font-style: italic;">"27.0"</span>)
      (<span style="font-weight: bold;">progn</span>
        (define-key isearch-mode-map (kbd <span style="font-style: italic;">"M-SPC"</span>) 'my-toggle-ime-ns)
        (define-key isearch-mode-map (kbd <span style="font-style: italic;">"S-SPC"</span>) 'my-toggle-ime-ns))
    (define-key isearch-mode-map (kbd <span style="font-style: italic;">"M-SPC"</span>) 'mac-ime-toggle)
    (define-key isearch-mode-map (kbd <span style="font-style: italic;">"S-SPC"</span>) 'mac-ime-toggle))

  (<span style="font-weight: bold;">if</span> (version&lt; emacs-version <span style="font-style: italic;">"27.0"</span>)
      (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-ns-org-heading-auto-ascii</span> ()
        <span style="font-style: italic;">"IME off, when the cursor on org headings."</span>
        (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">and</span> (frame-focus-state)
                   (eq major-mode 'org-mode)
                   (<span style="font-weight: bold;">or</span> (looking-at org-heading-regexp)
                       (equal (buffer-name) org-agenda-buffer-name))
                   (my-ime-active-p))
          (my-ime-off)))
    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-ns-org-heading-auto-ascii</span> ()
      <span style="font-style: italic;">"IME off, when the cursor on org headings."</span>
      (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">and</span> (frame-focus-state)
                 (eq major-mode 'org-mode)
                 (<span style="font-weight: bold;">or</span> (looking-at org-heading-regexp)
                     (equal (buffer-name) org-agenda-buffer-name))
                 (fboundp 'mac-ime-active-p)
                 (mac-ime-active-p))
        (mac-ime-deactivate))))

  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#12459;&#12540;&#12477;&#12523;&#31227;&#21205;&#12391; heading &#12395;&#30041;&#12414;&#12387;&#12383;&#26178;&#12395;IME&#12434;OFF&#12395;&#12377;&#12427;</span>
  (run-with-idle-timer 0.4 t #'my-ns-org-heading-auto-ascii)

  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#12459;&#12540;&#12477;&#12523;&#31227;&#21205;&#12391; heading &#12395;&#26469;&#12383;&#12392;&#12365;&#12399;&#21363;&#24231;&#12395;IME&#12434;OFF&#12395;&#12377;&#12427;</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(add-hook 'after-move-cursor-hook #'my-ns-org-heading-auto-ascii)</span>

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"hl-line"</span>
    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-working-text-face-on</span> ()
      (<span style="font-weight: bold;">if</span> (<span style="font-weight: bold;">or</span> isearch-mode
              (minibufferp))
          (custom-set-faces
           '(ns-working-text-face nil))
        (custom-set-faces
         '(ns-working-text-face
           ((((background dark)) <span style="font-weight: bold;">:background</span> <span style="font-style: italic;">"#594d5d"</span> <span style="font-weight: bold;">:underline</span> <span style="font-style: italic;">"LightSlateBlue"</span>)
            (t (<span style="font-weight: bold;">:background</span> <span style="font-style: italic;">"#fff0de"</span> <span style="font-weight: bold;">:underline</span> <span style="font-style: italic;">"gray20"</span>)))))))

    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-working-text-face-off</span> ()
      (<span style="font-weight: bold;">if</span> (<span style="font-weight: bold;">or</span> isearch-mode
              (minibufferp))
          (custom-set-faces
           '(ns-working-text-face nil))
        (custom-set-faces
         '(ns-working-text-face
           ((((background dark)) <span style="font-weight: bold;">:background</span> <span style="font-style: italic;">"#484c5c"</span> <span style="font-weight: bold;">:underline</span> <span style="font-style: italic;">"white"</span>)
            (t (<span style="font-weight: bold;">:background</span> <span style="font-style: italic;">"#DEEDFF"</span> <span style="font-weight: bold;">:underline</span> <span style="font-style: italic;">"DarkOrchid3"</span>)))))))

    (add-hook 'input-method-activate-hook #'my-working-text-face-on)
    (add-hook 'input-method-deactivate-hook #'my-working-text-face-off))

  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-ns-ime-restore</span> ()
    <span style="font-style: italic;">"Restore the last IME status changed in Emacs."</span>
    (<span style="font-weight: bold;">if</span> my-ime-last (my-ime-on) (my-ime-off)))
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(add-hook 'focus-in-hook #'my-ns-ime-restore)</span>
  )
</pre>
</div>
</div>
</div>

<div id="outline-container-org53a63301" class="outline-3">
<h3 id="org53a63301"><span class="section-number-3">3.23</span> EMPビルド用設定&#xa0;&#xa0;&#xa0;<span class="tag"><span class="macOS">macOS</span></span></h3>
<div class="outline-text-3" id="text-org53a63301">
<p>
NSビルド版で生じた日本語入力時のチラつきを避けるために，EMP版ビルドに(一時期)浮気しました．以下はその時にNSビルドの振る舞いに近づけるためにがんばった設定です．詳細な情報は，リンク先の記事にあります．
</p>

<ul class="org-ul">
<li><a href="http://qiita.com/takaxp/items/a86ee2aacb27c7c3a902">Emacs 25.1/25.2 を EMP版で快適に使う - Qiita</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (eq window-system 'mac)
  (global-set-key (kbd <span style="font-style: italic;">"M-SPC"</span>) 'mac-win-toggle-ime)
  (global-set-key (kbd <span style="font-style: italic;">"S-SPC"</span>) 'mac-win-toggle-ime)
  (<span style="font-weight: bold;">declare-function</span> mac-win-save-last-ime-status <span style="font-style: italic;">"init"</span> nil)
  (<span style="font-weight: bold;">declare-function</span> ad:mac-auto-ascii-setup-input-source <span style="font-style: italic;">"init"</span> nil)
  (<span style="font-weight: bold;">declare-function</span> mac-win-restore-ime <span style="font-style: italic;">"init"</span> nil)
  (<span style="font-weight: bold;">declare-function</span> mac-win-restore-ime-target-commands <span style="font-style: italic;">"init"</span> nil))

(<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">and</span> (eq window-system 'mac)
           (fboundp 'mac-select-input-source)
           (fboundp 'mac-auto-ascii-select-input-source)
           (fboundp 'mac-auto-ascii-setup-input-source)
           (fboundp 'mac-input-source)
           (fboundp 'mac-auto-ascii-mode))

  (<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">mac-win-last-ime-status</span> 'off) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">{'off|'on}</span>
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">mac-win-save-last-ime-status</span> ()
    (<span style="font-weight: bold;">setq</span> mac-win-last-ime-status
          (<span style="font-weight: bold;">if</span> (string-match <span style="font-style: italic;">"\\.</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">Roman</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">|</span><span style="font-style: italic;">US</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">$"</span> (mac-input-source))
              'off 'on)))
  (mac-win-save-last-ime-status) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#21021;&#26399;&#21270;</span>

  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">mac-win-restore-ime</span> ()
    (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">and</span> (<span style="font-weight: bold;">bound-and-true-p</span> mac-auto-ascii-mode)
               (eq mac-win-last-ime-status 'on))
      (mac-select-input-source
       <span style="font-style: italic;">"com.google.inputmethod.Japanese.base"</span>)))

  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">ad:mac-auto-ascii-setup-input-source</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> _prompt)
    <span style="font-style: italic;">"Extension to store IME status"</span>
    (mac-win-save-last-ime-status))
  (advice-add 'mac-auto-ascii-setup-input-source <span style="font-weight: bold;">:before</span>
              #'ad:mac-auto-ascii-setup-input-source)

  (<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">mac-win-target-commands</span>
    '(find-file save-buffer other-window delete-window split-window))

  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">mac-win-restore-ime-target-commands</span> ()
    (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">and</span> (<span style="font-weight: bold;">bound-and-true-p</span> mac-auto-ascii-mode)
               (eq mac-win-last-ime-status 'on))
      (mapc (<span style="font-weight: bold;">lambda</span> (command)
              (<span style="font-weight: bold;">when</span> (string-match
                     (format <span style="font-style: italic;">"^%s"</span> command) (format <span style="font-style: italic;">"%s"</span> this-command))
                (mac-select-input-source
                 <span style="font-style: italic;">"com.google.inputmethod.Japanese.base"</span>)))
            mac-win-target-commands)))
  (add-hook 'pre-command-hook #'mac-win-restore-ime-target-commands)

  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#12496;&#12483;&#12501;&#12449;&#12522;&#12473;&#12488;&#12434;&#35211;&#12427;&#12392;&#12365;</span>
  (add-to-list 'mac-win-target-commands 'counsel-ibuffer)
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">ChangeLog&#12395;&#34892;&#12367;&#12392;&#12365;</span>
  (add-to-list 'mac-win-target-commands 'add-change-log-entry-other-window)
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#20491;&#20154;&#29992;&#12398;&#38306;&#25968;&#12434;&#20351;&#12358;&#12392;&#12365;</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(add-to-list 'mac-win-target-commands 'my-)</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#33258;&#20998;&#12391;&#20316;&#12387;&#12383;&#12497;&#12483;&#12465;&#12540;&#12472;&#32676;&#12398;&#38306;&#25968;&#12434;&#20351;&#12358;&#12392;&#12365;</span>
  (add-to-list 'mac-win-target-commands 'change-frame)
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">org-mode &#12391;&#32224;&#12417;&#20999;&#12426;&#12434;&#35373;&#23450;&#12377;&#12427;&#12392;&#12365;&#65294;</span>
  (add-to-list 'mac-win-target-commands 'org-deadline)
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">org-mode &#12391;&#32224;&#12417;&#20999;&#12426;&#12434;&#35373;&#23450;&#12377;&#12427;&#12392;&#12365;&#65294;</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(add-to-list 'mac-win-target-commands 'org-capture)</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">query-replace &#12391;&#22793;&#25563;&#12377;&#12427;&#12392;&#12365;</span>
  (add-to-list 'mac-win-target-commands 'query-replace)

  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#12511;&#12491;&#12496;&#12483;&#12501;&#12449;&#21033;&#29992;&#24460;&#12395;IME&#12434;&#25147;&#12377;</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">M-x &#12391;&#12398;&#12467;&#12510;&#12531;&#12489;&#36984;&#25246;&#12391;IME&#12434;&#25147;&#12379;&#12427;&#65294;</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#12371;&#12428;&#31227;&#21205;&#20808;&#12391; q &#12364;&#21177;&#12363;&#12394;&#12356;&#12371;&#12392;&#12364;&#12354;&#12427;</span>
  (add-hook 'minibuffer-setup-hook #'mac-win-save-last-ime-status)
  (add-hook 'minibuffer-exit-hook #'mac-win-restore-ime)

  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#12479;&#12452;&#12488;&#12523;&#12496;&#12540;&#12398;&#25391;&#12427;&#33310;&#12356;&#12434; NS&#29256;&#12395;&#21512;&#12431;&#12379;&#12427;&#65294;</span>
  (<span style="font-weight: bold;">setq</span> frame-title-format (format (<span style="font-weight: bold;">if</span> (buffer-file-name) <span style="font-style: italic;">"%%f"</span> <span style="font-style: italic;">"%%b"</span>)))

  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#12394;&#12362;&#12486;&#12540;&#12510;&#12434;&#20999;&#12426;&#26367;&#12360;&#12383;&#12425;&#65292;face &#12398;&#35373;&#23450;&#12434;&#12522;&#12525;&#12540;&#12489;&#12375;&#12394;&#12356;&#12392;&#26399;&#24453;&#36890;&#12426;&#12395;&#12394;&#12425;&#12394;&#12356;</span>
  (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">hl-line</span> nil t)
    (custom-set-faces
     <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#22793;&#25563;&#21069;&#20837;&#21147;&#26178;&#12398;&#25991;&#23383;&#21015;&#29992; face</span>
     `(mac-ts-converted-text
       ((((background dark)) <span style="font-weight: bold;">:underline</span> <span style="font-style: italic;">"orange"</span>
         <span style="font-weight: bold;">:background</span> ,(face-attribute 'hl-line <span style="font-weight: bold;">:background</span>))
        (t (<span style="font-weight: bold;">:underline</span> <span style="font-style: italic;">"orange"</span>
                       <span style="font-weight: bold;">:background</span>
                       ,(face-attribute 'hl-line <span style="font-weight: bold;">:background</span>)))))
     <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#22793;&#25563;&#23550;&#35937;&#12398;&#25991;&#23383;&#21015;&#29992; face</span>
     `(mac-ts-selected-converted-text
       ((((background dark)) <span style="font-weight: bold;">:underline</span> <span style="font-style: italic;">"orange"</span>
         <span style="font-weight: bold;">:background</span> ,(face-attribute 'hl-line <span style="font-weight: bold;">:background</span>))
        (t (<span style="font-weight: bold;">:underline</span> <span style="font-style: italic;">"orange"</span>
                       <span style="font-weight: bold;">:background</span>
                       ,(face-attribute 'hl-line <span style="font-weight: bold;">:background</span>)))))))

  (<span style="font-weight: bold;">when</span> (fboundp 'mac-input-source)
    (run-with-idle-timer 3 t 'my-mac-keyboard-input-source))


  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#12354;&#12414;&#12426;&#12424;&#12356;&#12450;&#12503;&#12525;&#12540;&#12481;&#12391;&#12399;&#28961;&#12356;&#27671;&#12364;&#12377;&#12427;&#12369;&#12393;&#65292;org-heading &#19978;&#12392;agenda&#12391;&#12399;</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">1&#31186;&#12450;&#12452;&#12489;&#12523;&#12377;&#12427;&#12392;&#65292;&#33258;&#21205;&#30340;&#12395; IME &#12434; OFF &#12395;&#12377;&#12427;</span>
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-mac-win-org-heading-auto-ascii</span> ()
    (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">and</span> (eq major-mode 'org-mode)
               (<span style="font-weight: bold;">or</span> (looking-at org-heading-regexp)
                   (equal (buffer-name) org-agenda-buffer-name)))
      (<span style="font-weight: bold;">setq</span> mac-win-last-ime-status 'off)
      (mac-auto-ascii-select-input-source)))
  (<span style="font-weight: bold;">when</span> (fboundp 'mac-auto-ascii-select-input-source)
    (run-with-idle-timer 1 t 'my-mac-win-org-heading-auto-ascii))

  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">EMP&#29256;Emacs&#12398;&#37326;&#33391;&#12499;&#12523;&#12489;&#29992;&#29420;&#33258;&#35373;&#23450;&#32676;</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">IME toggle&#12434; Emacs&#20869;&#12391;&#26377;&#21177;&#12395;&#12377;&#12427;</span>
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">mac-win-toggle-ime</span> ()
    (<span style="font-weight: bold;">interactive</span>)
    (<span style="font-weight: bold;">when</span> (fboundp 'mac-input-source)
      (mac-select-input-source
       (concat <span style="font-style: italic;">"com.google.inputmethod.Japanese"</span>
               (<span style="font-weight: bold;">if</span> (string-match <span style="font-style: italic;">"\\.base$"</span> (mac-input-source))
                   <span style="font-style: italic;">".Roman"</span> <span style="font-style: italic;">".base"</span>)))))

  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">isearch &#20013;&#12395;IME&#12434;&#20999;&#12426;&#26367;&#12360;&#12427;&#12392;&#65292;[I-Search] &#12398;&#34920;&#31034;&#12364;&#28040;&#12360;&#12427;&#65294;</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(define-key isearch-mode-map (kbd "M-SPC") 'mac-win-toggle-ime)</span>
  (define-key isearch-mode-map (kbd <span style="font-style: italic;">"S-SPC"</span>) 'mac-win-toggle-ime)

  (<span style="font-weight: bold;">when</span> (boundp 'mac-win-ime-cursor-type) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Need update</span>
    (<span style="font-weight: bold;">setq</span> mac-win-ime-cursor-type (plist-get my-cur-type-ime <span style="font-weight: bold;">:on</span>)))
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">minibuffer &#12391;&#12399;&#8593;&#12398;&#32972;&#26223;&#33394;&#12434;&#28961;&#21177;&#12395;&#12377;&#12427;</span>
  (<span style="font-weight: bold;">when</span> (fboundp 'mac-min--minibuffer-setup)
    (add-hook 'minibuffer-setup-hook #'mac-min--minibuffer-setup))
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">echo-area &#12391;&#12418;&#32972;&#26223;&#33394;&#12434;&#28961;&#21177;&#12395;&#12377;&#12427;</span>
  (<span style="font-weight: bold;">when</span> (boundp 'mac-win-default-background-echo-area)
    (<span style="font-weight: bold;">setq</span> mac-win-default-background-echo-area t))<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">*-text&#12398;background&#12434;&#28961;&#35222;</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#12487;&#12496;&#12483;&#12464;&#29992;</span>
  (<span style="font-weight: bold;">when</span> (boundp 'mac-win-debug-log)
    (<span style="font-weight: bold;">setq</span> mac-win-debug-log nil))
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Testing...</span>
  (<span style="font-weight: bold;">when</span> (boundp 'mac-win-apply-org-heading-face)
    (<span style="font-weight: bold;">setq</span> mac-win-apply-org-heading-face t))

  (<span style="font-weight: bold;">unless</span> noninteractive
    (mac-auto-ascii-mode 1)))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org35f3bbc9" class="outline-2">
<h2 id="org35f3bbc9"><span class="section-number-2">4</span> カーソル移動</h2>
<div class="outline-text-2" id="text-org35f3bbc9">
<p>
カーソルの移動は，次のポリシーに従っています．デフォルトでは <code>C-v/M-v</code> で上下移動になっていますが， <code>M-v</code> は windows のペーストに対応するので混乱を招くので使っていません．
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">行移動</td>
<td class="org-left">C-n/C-p</td>
</tr>

<tr>
<td class="org-left">ページ移動（スクロール）</td>
<td class="org-left">M-n/M-p</td>
</tr>

<tr>
<td class="org-left">ウィンドウ移動</td>
<td class="org-left">C-M-n/C-M-p</td>
</tr>

<tr>
<td class="org-left">バッファ切り替え</td>
<td class="org-left">M-]/M-[</td>
</tr>

<tr>
<td class="org-left">バッファ先頭・末尾</td>
<td class="org-left">C-M-t/C-M-b</td>
</tr>

<tr>
<td class="org-left">編集点の移動</td>
<td class="org-left">C-,/C-.</td>
</tr>

<tr>
<td class="org-left">タグジャンプ</td>
<td class="org-left">M-,/M-.</td>
</tr>
</tbody>
</table>

<p>
なお， <code>C-M-b</code>, <code>C-M-n</code>, <code>C-M-p</code>, はそれぞれ，本来S式の移動(<code>backward-sexp</code>, <code>forward-list</code>, <code>backward-list</code>)に割り振られています．また， <code>C-M-t</code> は，本来，2つのS式の入れ替え(<code>transpose-sexps</code>)に割り振られています．
</p>
</div>

<div id="outline-container-org2a46a2bd" class="outline-3">
<h3 id="org2a46a2bd"><span class="section-number-3">4.1</span> バッファ内のカーソル移動</h3>
<div class="outline-text-3" id="text-org2a46a2bd">
<p>
先頭に移動，最終行に移動，ページ単位の進む，ページ単位の戻る，行数を指定して移動．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(global-set-key (kbd <span style="font-style: italic;">"C-M-t"</span>) 'beginning-of-buffer)
(global-set-key (kbd <span style="font-style: italic;">"C-M-b"</span>) 'end-of-buffer)
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Backward page scrolling instead of M-v</span>
(global-set-key (kbd <span style="font-style: italic;">"M-p"</span>) 'scroll-down)
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Frontward page scrolling instead of C-v</span>
(global-set-key (kbd <span style="font-style: italic;">"M-n"</span>) 'scroll-up)
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Move cursor to a specific line</span>
(global-set-key (kbd <span style="font-style: italic;">"C-c g"</span>) 'goto-line)
</pre>
</div>
</div>
</div>

<div id="outline-container-org3bebf489" class="outline-3">
<h3 id="org3bebf489"><span class="section-number-3">4.2</span> バッファ間のカーソル移動</h3>
<div class="outline-text-3" id="text-org3bebf489">
<p>
<code>C-c o</code> でもいいですが，ワンアクションで移動できるようが楽です．次のように双方向で使えるように設定しています．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(global-set-key (kbd <span style="font-style: italic;">"C-M-p"</span>) (<span style="font-weight: bold;">lambda</span> () (<span style="font-weight: bold;">interactive</span>) (other-window -1)))
(global-set-key (kbd <span style="font-style: italic;">"C-M-n"</span>) (<span style="font-weight: bold;">lambda</span> () (<span style="font-weight: bold;">interactive</span>) (other-window 1)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc4c0ed9a" class="outline-3">
<h3 id="orgc4c0ed9a"><span class="section-number-3">4.3</span> 対応するカッコを選択（逆方向）</h3>
<div class="outline-text-3" id="text-orgc4c0ed9a">
<ul class="org-ul">
<li><code>C-M-SPC</code> (mark-sexp) は，カーソル位置から順方向に選択．</li>
<li><code>C-M-U</code> (backward-up-list) は，一つ外のカッコの先頭にポイントを移す．</li>
</ul>

<p>
<del>- <code>C-M-9</code> (my-mark-sexp) は，カーソル位置から逆方向に選択．</del> 以前は <code>my-mark-sexp</code> を定義して使っていましたが， <code>mark-sexp</code> を advice する方法に変えました．カーソルが行末だったり，後ろが空白文字の場合にのみ， <code>mark-sexp</code> に <code>-1</code> がわたるようにしました．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-mark-sexp</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> arg)
  <span style="font-style: italic;">"Move backward across one balanced expression and select it."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (mark-sexp (<span style="font-weight: bold;">or</span> arg -1)))
(global-set-key (kbd <span style="font-style: italic;">"C-M-9"</span>) #'my-mark-sexp)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">ad:mark-sexp</span> (f <span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> arg allow-extend)
  <span style="font-style: italic;">"Set mark ARG sexps from point.</span>
<span style="font-style: italic;">When the cursor is at the end of line or before a whitespace, set ARG -1."</span>
  (<span style="font-weight: bold;">interactive</span> <span style="font-style: italic;">"P\np"</span>)
  (funcall f (<span style="font-weight: bold;">if</span> (<span style="font-weight: bold;">and</span> (not (bolp))
                      (not (eq (preceding-char) ?\ ))
                      (<span style="font-weight: bold;">or</span> (eolp)
                          (eq (following-char) ?\ )
                          (memq (preceding-char) '(?\) ?\&gt; ?\] ?\}))))
                 -1 arg)
           allow-extend))
(advice-add 'mark-sexp <span style="font-weight: bold;">:around</span> #'ad:mark-sexp)

(<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"expand-region"</span>
    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">ad:er:mark-sexp</span> (f <span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> arg allow-extend)
      <span style="font-style: italic;">"If the cursor is on a symbol, expand the region along the symbol."</span>
      (<span style="font-weight: bold;">interactive</span> <span style="font-style: italic;">"P\np"</span>)
      (<span style="font-weight: bold;">if</span> (<span style="font-weight: bold;">and</span> (not (use-region-p))
               (symbol-at-point))
          (er/mark-symbol)
        (funcall f arg allow-extend)))
  (advice-add 'mark-sexp <span style="font-weight: bold;">:around</span> #'ad:er:mark-sexp))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb8c57f30" class="outline-3">
<h3 id="orgb8c57f30"><span class="section-number-3">4.4</span> スクロールを制御</h3>
<div class="outline-text-3" id="text-orgb8c57f30">
<p>
一行づつスクロールさせます．デフォルトではバッファの端でスクロールすると，半画面移動します．また，上下の端にカーソルがどのくらい近づいたらスクロールとみなすかも指定できます．
</p>

<ul class="org-ul">
<li><a href="http://marigold.sakura.ne.jp/devel/emacs/scroll/index.html">http://marigold.sakura.ne.jp/devel/emacs/scroll/index.html</a></li>
</ul>

<p>
非ASCII文字を扱っているときに一行づつスクロールしない場合は，scroll-conservatively の値を1ではなく大きい数字にすると直るかもしれません．マニュアルでは，100より大きい数値とあります．
</p>

<ul class="org-ul">
<li><a href="http://www.emacswiki.org/emacs/SmoothScrolling">http://www.emacswiki.org/emacs/SmoothScrolling</a></li>
</ul>

<p>
scroll-margin を指定すると，カーソルがウィンドウの端から離れた状態でスクロールされます．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Scroll window on a line-by-line basis</span>
(<span style="font-weight: bold;">setq</span> scroll-conservatively 1000)
(<span style="font-weight: bold;">setq</span> scroll-step 1)
(<span style="font-weight: bold;">setq</span> scroll-preserve-screen-position t) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#12473;&#12463;&#12525;&#12540;&#12523;&#26178;&#12395;&#12473;&#12463;&#12522;&#12540;&#12531;&#20869;&#12391;&#22266;&#23450;</span>
<span style="font-weight: bold; font-style: italic;">;;  </span><span style="font-weight: bold; font-style: italic;">(setq scroll-margin 0) ; default=0</span>
</pre>
</div>

<p>
スクロール時のジャンプが気になる場合は次のパッケージを使うとよいです．
</p>

<ul class="org-ul">
<li><a href="http://adamspiers.org/computing/elisp/smooth-scrolling.el">http://adamspiers.org/computing/elisp/smooth-scrolling.el</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">smooth-scrolling</span> nil t)
  (<span style="font-weight: bold;">setq</span> smooth-scroll-margin 1))
</pre>
</div>
</div>
</div>

<div id="outline-container-org5f40f030" class="outline-3">
<h3 id="org5f40f030"><span class="section-number-3">4.5</span> スクロールで表示を重複させる行数</h3>
<div class="outline-text-3" id="text-org5f40f030">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Scroll window on a page-by-page basis with N line overlapping</span>
(<span style="font-weight: bold;">setq</span> next-screen-context-lines 1)
</pre>
</div>
</div>
</div>

<div id="outline-container-org9811c7e8" class="outline-3">
<h3 id="org9811c7e8"><span class="section-number-3">4.6</span> マーク箇所を遡る</h3>
<div class="outline-text-3" id="text-org9811c7e8">
<p>
<code>C-u C-SPC</code> で辿れるようになります．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setq</span> set-mark-command-repeat-pop t)
(<span style="font-weight: bold;">setq</span> mark-ring-max 32)
(<span style="font-weight: bold;">setq</span> global-mark-ring-max 64)
</pre>
</div>
</div>
</div>

<div id="outline-container-org7ea97f70" class="outline-3">
<h3 id="org7ea97f70"><span class="section-number-3">4.7</span> [ah.el] カーソル移動に反応するフック</h3>
<div class="outline-text-3" id="text-org7ea97f70">
<p>
カーソルを移動するインタラクティブ関数に反応する <code>ah-before-move-cursor-hook</code> と <code>ah-after-move-cursor-hook</code> を使います． <a href="https://github.com/takaxp/ah">ah.el</a> に関数定義を切り出しました．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">ah</span> nil t)
  (<span style="font-weight: bold;">setq</span> ah-lighter <span style="font-style: italic;">""</span>)
  (<span style="font-weight: bold;">unless</span> noninteractive
    (ah-mode 1)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc62cc9bf" class="outline-3">
<h3 id="orgc62cc9bf"><span class="section-number-3">4.8</span> [smooth-scroll.el] 滑らかなスクロール</h3>
<div class="outline-text-3" id="text-orgc62cc9bf">
<p>
良い感じです．スススっとスクロールします．最初にスクロールする時にパッケージを読み込みます．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(smooth-scroll-mode)
       <span style="font-style: italic;">"smooth-scroll"</span> nil t)

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"smooth-scroll"</span>
    (custom-set-variables
     '(smooth-scroll/vscroll-step-size 6)
     '(smooth-scroll/hscroll-step-size 6)))
  (smooth-scroll-mode t))
</pre>
</div>
</div>
</div>

<div id="outline-container-org768c06a0" class="outline-3">
<h3 id="org768c06a0"><span class="section-number-3">4.9</span> [bs.el] 続・カレントバッファの表示切り替え</h3>
<div class="outline-text-3" id="text-org768c06a0">
<p>
古くから <code>cycle-buffer</code> がありますが，基本機能だけで満足するようになったので，ビルトインの <code>bs.el</code> に移行しました． <code>bs-cycle-next</code> あるいは <code>bs-cycle-previous</code> でバッファを切り替えられます．
</p>

<p>
切り替えるときにミニバッファにバッファ名が列挙されますが，できればセパレータを表示したいところです．FontAwesome を使えば，だいぶ見やすくなるかも．
</p>

<p>
<code>bs.el</code> が表示するバッファリストが横長で見にくいので，縦表示する拡張パッケージを作りました．表示中のリストには番号を割り当てられていて，番号に対応するキーを押すとそのバッファに移動できます． <code>bs.el</code> のコマンドを <code>advice</code> しているだけなので，それを解けばオリジナルの <code>bs.el</code> の振る舞いに戻ります．そのための関数(<code>M-x bsv-disable-advices</code>)も準備しておきました．
</p>

<ul class="org-ul">
<li><a href="https://github.com/takaxp/bsv">https://github.com/takaxp/bsv</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(global-set-key (kbd <span style="font-style: italic;">"M-]"</span>) 'bs-cycle-next)
(<span style="font-weight: bold;">when</span> (display-graphic-p)
  (global-set-key (kbd <span style="font-style: italic;">"M-["</span>) 'bs-cycle-previous))

(<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"bs"</span>
  (custom-set-variables
   '(bs-cycle-configuration-name <span style="font-style: italic;">"files-and-scratch"</span>)
   '(bs-max-window-height 10))

  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#12522;&#12473;&#12488;&#12434;&#32294;&#34920;&#31034;&#12377;&#12427;</span>
  (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">bsv</span> nil t)
    (<span style="font-weight: bold;">setq</span> bsv-max-height 5
          bsv-message-timeout 10)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd5942d14" class="outline-3">
<h3 id="orgd5942d14"><span class="section-number-3">4.10</span> [bm.el] カーソル位置をブックマークして追う</h3>
<div class="outline-text-3" id="text-orgd5942d14">
<p>
<a href="https://github.com/joodland/bm">bm.el</a>は，カーソル位置をブックマークしておくためのツールです． <code>point-undo</code> と比較して，ユーザが明示的に位置を保存でき，見た目にも使いやすいです．以下の例では， <code>org-mode</code> のツリー内にブックマークがある時にも，上手い具合に表示ができるように調整してあります．カーソル移動は，順方向（ <code>bm-next</code> ）にだけ使っています．
</p>

<p>
org-mode との連携には， <a href="https://github.com/alphapapa/org-bookmark-heading">org-bookmark-heading</a> があります．ただ，私は下記の設定だけでそれほど不自由していません．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(my-toggle-bm
         my-bm-next bm-buffer-save bm-buffer-restore bm-buffer-save-all
         bm-repository-save bm-repository-load counsel-bm)
       <span style="font-style: italic;">"bm"</span> nil t)

  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#12501;&#12449;&#12452;&#12523;&#12458;&#12540;&#12503;&#12531;&#26178;&#12395;&#12502;&#12483;&#12463;&#12510;&#12540;&#12463;&#12434;&#24489;&#24112;</span>
  (global-set-key (kbd <span style="font-style: italic;">"&lt;f10&gt;"</span>) 'my-toggle-bm)
  (global-set-key (kbd <span style="font-style: italic;">"&lt;C-f10&gt;"</span>) 'my-bm-next)
  (global-set-key (kbd <span style="font-style: italic;">"&lt;S-f10&gt;"</span>) 'bm-show-all)
  (add-hook 'find-file-hook #'bm-buffer-restore)

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"ivy"</span>
    (global-set-key (kbd <span style="font-style: italic;">"&lt;S-f10&gt;"</span>) 'counsel-bm))

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"bm"</span>
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(setq bm-annotation-width 30)</span>
    (<span style="font-weight: bold;">setq-default</span> bm-buffer-persistence t)
    (<span style="font-weight: bold;">setq</span> bm-restore-repository-on-load t)
    (<span style="font-weight: bold;">setq</span> bm-cycle-all-buffers t)
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(setq bm-toggle-buffer-persistence t)</span>
    (<span style="font-weight: bold;">setq</span> bm-buffer-persistence t)
    (<span style="font-weight: bold;">setq</span> bm-persistent-face 'bm-face)
    (<span style="font-weight: bold;">setq</span> bm-repository-file
          (expand-file-name
           (concat (getenv <span style="font-style: italic;">"SYNCROOT"</span>) <span style="font-style: italic;">"/emacs.d/.bm-repository"</span>)))

    (<span style="font-weight: bold;">unless</span> noninteractive
      (bm-repository-load)
      (add-hook 'kill-buffer-hook 'bm-buffer-save)
      (add-hook 'after-save-hook 'bm-buffer-save)
      (add-hook 'after-revert-hook 'bm-buffer-restore)
      (add-hook 'kill-emacs-hook #'my-bm-save-all))

    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">ad:bm-show-mode</span> ()
      <span style="font-style: italic;">"Enable truncate mode when showing bm list."</span>
      (toggle-truncate-lines 1))
    (advice-add 'bm-show-mode <span style="font-weight: bold;">:after</span> #'ad:bm-show-mode)

    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-bm-save-all</span> ()
      (bm-buffer-save-all)
      (bm-repository-save))

    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-toggle-bm</span> ()
      <span style="font-style: italic;">"bm-toggle with updating history"</span>
      (<span style="font-weight: bold;">interactive</span>)
      (<span style="font-weight: bold;">let</span> ((bm (concat
                 (buffer-name) <span style="font-style: italic;">"::"</span>
                 (<span style="font-weight: bold;">if</span> (<span style="font-weight: bold;">and</span> (equal major-mode 'org-mode)
                          (not (org-before-first-heading-p)))
                     (nth 4 (org-heading-components))
                   (format <span style="font-style: italic;">"%s"</span> (line-number-at-pos))))))
        (<span style="font-weight: bold;">if</span> (bm-bookmark-at (point))
            (bookmark-delete bm)
          (bookmark-set bm)))
      (bm-toggle)
      (bm-buffer-save-all)
      (bm-repository-save))

    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-bm-next</span> ()
      <span style="font-style: italic;">"bm-next with org-mode"</span>
      (<span style="font-weight: bold;">interactive</span>)
      (bm-next)
      (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">and</span> (equal major-mode 'org-mode)
                 (not (org-before-first-heading-p)))
        (widen)
        (org-overview)
        (org-reveal)
        (org-cycle-hide-drawers 'all)
        (org-show-entry)
        (show-children)
        (org-show-siblings)))

    (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">ivy</span> nil t)
      (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">counsel-bm-get-list</span> (bookmark-overlays)
        (-map (<span style="font-weight: bold;">lambda</span> (bm)
                (<span style="font-weight: bold;">with-current-buffer</span> (overlay-buffer bm)
                  (<span style="font-weight: bold;">let*</span> ((line (replace-regexp-in-string
                                <span style="font-style: italic;">"\n$"</span> <span style="font-style: italic;">""</span>
                                (buffer-substring (overlay-start bm)
                                                  (overlay-end bm))))
                         <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">line numbers start on 1</span>
                         (line-num
                          (+ 1 (count-lines (point-min) (overlay-start bm))))
                         (name (format <span style="font-style: italic;">"%s:%d - %s"</span> (buffer-name) line-num line)))
                    `(,name . ,bm))))
              bookmark-overlays))

      (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">counsel-bm</span> ()
        (<span style="font-weight: bold;">interactive</span>)
        (<span style="font-weight: bold;">let*</span> ((bm-list (counsel-bm-get-list (bm-overlays-lifo-order t)))
               (bm-hash-table (make-hash-table <span style="font-weight: bold;">:test</span> 'equal))
               (search-list (-map (<span style="font-weight: bold;">lambda</span> (bm) (car bm)) bm-list)))
          (-each bm-list (<span style="font-weight: bold;">lambda</span> (bm)
                           (puthash (car bm) (cdr bm) bm-hash-table)
                           ))
          (ivy-read <span style="font-style: italic;">"Find bookmark(bm.el): "</span>
                    search-list
                    <span style="font-weight: bold;">:require-match</span> t
                    <span style="font-weight: bold;">:keymap</span> counsel-describe-map
                    <span style="font-weight: bold;">:action</span> (<span style="font-weight: bold;">lambda</span> (chosen)
                              (<span style="font-weight: bold;">let</span> ((bookmark (gethash chosen bm-hash-table)))
                                (switch-to-buffer (overlay-buffer bookmark))
                                (bm-goto bookmark)
                                ))
                    <span style="font-weight: bold;">:sort</span> t))))))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfa2bad61" class="outline-3">
<h3 id="orgfa2bad61"><span class="section-number-3">4.11</span> [centered-cursor-mode.el] カーソル位置をバッファ中央に固定</h3>
<div class="outline-text-3" id="text-orgfa2bad61">
<p>
<code>isearch-mode</code> の時だけ有効にしています．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(centered-cursor-mode)
       <span style="font-style: italic;">"centered-cursor-mode"</span> nil t)

  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">isearch &#12398;&#26178;&#12399;OFF&#12395;&#12377;&#12427;</span>
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-centered-cursor-activate</span> () (centered-cursor-mode 1))
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-centered-cursor-deactivate</span> () (centered-cursor-mode -1))
  (add-hook 'isearch-mode-hook #'my-centered-cursor-activate)
  (add-hook 'isearch-mode-end-hook #'my-centered-cursor-deactivate))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgadf36a14" class="outline-3">
<h3 id="orgadf36a14"><span class="section-number-3">4.12</span> [smart-mark] C-g後に元の場所へカーソルを戻す</h3>
<div class="outline-text-3" id="text-orgadf36a14">
<p>
すぐわかる例は， <code>C-x h</code> で全選択して何もせず， <code>C-g</code> する場合です．通常だとバッファの先頭にカーソルが置き去りにされますが， <code>smart-mark</code> を使うと，全選択を実行した時の位置に自動的に戻してくれます．
</p>

<ul class="org-ul">
<li><a href="https://github.com/zhangkaiyulw/smart-mark">zhangkaiyulw/smart-mark: Emacs package to restore point after C-g when mark</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">smart-mark</span> nil t)
  (<span style="font-weight: bold;">progn</span> <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">C-M-SPC SPC SPC ... C-g &#12398;&#22580;&#21512;&#12395;&#27491;&#12375;&#12367;&#12459;&#12540;&#12477;&#12523;&#12392;&#20803;&#12395;&#25147;&#12377;&#65294;</span>
    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">ad:smart-mark-set-restore-before-mark</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;rest</span> _arg)
      (<span style="font-weight: bold;">unless</span> (memq this-command
                    '(er/expand-region er/mark-symbol er/contract-region))
        (<span style="font-weight: bold;">setq</span> smart-mark-point-before-mark (point))))
    (advice-add 'smart-mark-set-restore-before-mark <span style="font-weight: bold;">:override</span>
                #'ad:smart-mark-set-restore-before-mark)
    (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">expand-region-core</span> nil t)
      <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(defun ad:er:keyboard-quit ()</span>
      <span style="font-weight: bold; font-style: italic;">;;   </span><span style="font-weight: bold; font-style: italic;">(when (memq last-command '(er/expand-region er/contract-region))</span>
      <span style="font-weight: bold; font-style: italic;">;;     </span><span style="font-weight: bold; font-style: italic;">(when smart-mark-point-before-mark</span>
      <span style="font-weight: bold; font-style: italic;">;;       </span><span style="font-weight: bold; font-style: italic;">(goto-char smart-mark-point-before-mark))))</span>
      <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(advice-add 'keyboard-quit :after #'ad:er:keyboard-quit)</span>
      (<span style="font-weight: bold;">defadvice</span> <span style="font-weight: bold;">keyboard-quit</span> (before collapse-region activate)
        (<span style="font-weight: bold;">when</span> (memq last-command '(er/expand-region er/contract-region))
          (er/contract-region 0)
          (<span style="font-weight: bold;">when</span> smart-mark-point-before-mark
            (goto-char smart-mark-point-before-mark))))))

  (<span style="font-weight: bold;">unless</span> noninteractive
    (smart-mark-mode 1)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf75f443a" class="outline-3">
<h3 id="orgf75f443a"><span class="section-number-3">4.13</span> [syntax-subword.el] M-f で移動する位置をより密にする</h3>
<div class="outline-text-3" id="text-orgf75f443a">
<ul class="org-ul">
<li><a href="https://bitbucket.org/jpkotta/syntax-subword">https://bitbucket.org/jpkotta/syntax-subword</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">syntax-subword</span> nil t)
  (<span style="font-weight: bold;">unless</span> noninteractive
    (global-syntax-subword-mode 1)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org8435eae2" class="outline-3">
<h3 id="org8435eae2"><span class="section-number-3">4.14</span> [goto-chg.el] 編集箇所を簡単に辿る</h3>
<div class="outline-text-3" id="text-org8435eae2">
<p>
編集結果を保持したまま編集箇所にカーソルを移すことができます． <code>C-/</code> の Undo のような操作で，簡単かつ高速にカーソルを移動できます．ただ <code>undo-tree</code> 依存です．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(goto-last-change goto-last-change-reverse)
       <span style="font-style: italic;">"goto-chg"</span> nil t)

  (global-set-key (kbd <span style="font-style: italic;">"C-,"</span>) 'goto-last-change)
  (global-set-key (kbd <span style="font-style: italic;">"C-."</span>) 'goto-last-change-reverse)

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"flyspell"</span>
    (define-key flyspell-mode-map (kbd <span style="font-style: italic;">"C-,"</span>) 'goto-last-change)
    (define-key flyspell-mode-map (kbd <span style="font-style: italic;">"C-."</span>) 'goto-last-change-reverse)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org3901456e" class="outline-3">
<h3 id="org3901456e"><span class="section-number-3">4.15</span> [expand-region.el] カーソル箇所を起点に選択範囲を賢く広げる</h3>
<div class="outline-text-3" id="text-org3901456e">
<ul class="org-ul">
<li><a href="https://github.com/magnars/expand-region.el">magnars/expand-region.el: Emacs extension to increase selected region by semantic units.</a></li>
</ul>

<p>
<code>er/expand-region</code> を呼ぶと，カーソル位置を起点として前後に選択範囲を広げてくれます．2回以上呼ぶと，読んだ回数だけ賢く選択範囲が広がりますが，2回目は設定したキーバインドの最後の一文字を連打すればOKです．その場合，選択範囲を狭める時は <code>-</code> を押し， <code>0</code> を押せばリセットされます．
</p>

<p>
自分は <code>selected.el</code> とペアで使うように設定していて， <code>C-SPC</code> か <code>C-M-SPC</code> から <code>SPC</code> を押すことで <code>er/expand-region</code> が呼ばれるように設定しています．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"selected"</span>
  (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">expand-region</span> nil t)
    (define-key selected-keymap (kbd <span style="font-style: italic;">"SPC"</span>) #'er/expand-region)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org27e3241e" class="outline-3">
<h3 id="org27e3241e"><span class="section-number-3">4.16</span> <span class="done DONE">DONE</span> [cycle-buffer.el] カレントバッファの表示切り替え&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></h3>
<div class="outline-text-3" id="text-org27e3241e">
<p>
<a href="http://www.emacswiki.org/emacs/download/cycle-buffer.el">http://www.emacswiki.org/emacs/download/cycle-buffer.el</a>
</p>

<p>
cycle-buffer を使うと，バッファの履歴をスライドショーのようにたどれます．ミニバッファに前後の履歴が表示されるので，何回キーを押せばいいかの目安になります．それを超える場合には，おとなしくバッファリストを使います．直近数件のバッファをたどるのに便利です． <code>cycle-buffer</code> は古めですが，個人的には気に入っています．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(cycle-buffer cycle-buffer-backward)
       <span style="font-style: italic;">"cycle-buffer"</span> nil t)

  (global-set-key (kbd <span style="font-style: italic;">"M-]"</span>) 'cycle-buffer)
  (global-set-key (kbd <span style="font-style: italic;">"M-["</span>) 'cycle-buffer-backward)

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"cycle-buffer"</span>
    (custom-set-variables
     '(cycle-buffer-allow-visible t)
     '(cycle-buffer-show-length 12)
     '(cycle-buffer-show-format '(<span style="font-style: italic;">" &lt; %s &gt;"</span> . <span style="font-style: italic;">" %s"</span>)))))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd906e864" class="outline-3">
<h3 id="orgd906e864"><span class="section-number-3">4.17</span> <span class="done DONE">DONE</span> [back-button] マークをたどる&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></h3>
<div class="outline-text-3" id="text-orgd906e864">
<p>
現在のバッファと開いている全てのバッファのマークを辿ることができます．いま注目している位置が，マーク全体でどのあたりに位置するのかをミニバッファに表示してくれます．ツールバーを表示している場合は，マークを付けたり辿る用のボタンが追加されます． <code>global-mark-ring-max</code> を設定して，辿れるマークの数を拡張しておきます．
</p>

<p>
ただ <code>C-x &lt;SPC&gt;</code> が潰れるので要注意です．矩形選択で用いる <code>rectangle-mark-mode</code> に当てられているキーバインドです．
</p>

<ul class="org-ul">
<li><a href="https://github.com/rolandwalker/back-button">rolandwalker/back-button: Visual navigation through mark rings in Emacs 🔊</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(back-button-mode
         back-button-local-forward back-button-global-forward)
       <span style="font-style: italic;">"back-button"</span> nil t)

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"back-button"</span>
    (<span style="font-weight: bold;">setq</span> global-mark-ring-max 64)
    (<span style="font-weight: bold;">setq</span> back-button-local-forward-keystrokes '(<span style="font-style: italic;">"&lt;f10&gt;"</span>))
    (<span style="font-weight: bold;">setq</span> back-button-global-forward-keystrokes '(<span style="font-style: italic;">"C-&lt;f10&gt;"</span>))
    (define-key back-button-mode-map
      (kbd (car back-button-local-forward-keystrokes))
      'back-button-local-forward)
    (define-key back-button-mode-map
      (kbd (car back-button-global-forward-keystrokes))
      'back-button-global-forward)
    (<span style="font-weight: bold;">setq</span> back-button-mode-lighter nil)
    (<span style="font-weight: bold;">setq</span> back-button-index-timeout 0))

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"postpone"</span>
    (<span style="font-weight: bold;">unless</span> noninteractive
      (back-button-mode 1))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org42db9464" class="outline-3">
<h3 id="org42db9464"><span class="section-number-3">4.18</span> <span class="done DONE">DONE</span> [point-undo.el] カーソル位置を簡単にたどる&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></h3>
<div class="outline-text-3" id="text-org42db9464">
<p>
<code>autoload</code> や <code>autoload-if-found</code> で定義すると，使いたい時に履歴が取れていないのでよろしくないです．起動時に有効化します． bm.el で明示的にマーカーを残して履歴をたどる方が気に入っているので，最近は point-undo を使っていません．シングルキーを割り当てておくと使いやすいです．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">point-undo</span> nil t)
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">[point-undo.el] Move the cursor to the previous position</span>
  (global-set-key (kbd <span style="font-style: italic;">"&lt;f7&gt;"</span>) 'point-undo)
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">[point-undo.el] Redo of point-undo</span>
  (global-set-key (kbd <span style="font-style: italic;">"S-&lt;f7&gt;"</span>) 'point-redo))
</pre>
</div>
</div>
</div>

<div id="outline-container-org1af5f062" class="outline-3">
<h3 id="org1af5f062"><span class="section-number-3">4.19</span> <span class="done DONE">DONE</span> [SmoothScroll.el] カーソル固定でスクロールする&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></h3>
<div class="outline-text-3" id="text-org1af5f062">
<p>
<a href="https://raw.github.com/takaxp/EmacsScripts/master/SmoothScroll.el">https://raw.github.com/takaxp/EmacsScripts/master/SmoothScroll.el</a>
<a href="https://github.com/pglotov/EmacsScripts/blob/master/SmoothScroll.el">https://github.com/pglotov/EmacsScripts/blob/master/SmoothScroll.el</a>
</p>

<p>
カーソル位置と行を固定してバッファを背景スクロールできます．
</p>

<p>
オリジナルのままだとコンパイル時に警告がでるので， <code>line-move-visual</code> で書き換えています．残念ながら最近は使っていません．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(scroll-one-up scroll-one-down)
       <span style="font-style: italic;">"smoothscroll"</span> nil t)

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"postpone"</span>
    (global-set-key (kbd <span style="font-style: italic;">"s-&lt;up&gt;"</span>) 'scroll-one-down)
    (global-set-key (kbd <span style="font-style: italic;">"s-&lt;down&gt;"</span>) 'scroll-one-up)))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org36bb3b1a" class="outline-2">
<h2 id="org36bb3b1a"><span class="section-number-2">5</span> 編集サポート</h2>
<div class="outline-text-2" id="text-org36bb3b1a">
</div>
<div id="outline-container-org6f2cf1cd" class="outline-3">
<h3 id="org6f2cf1cd"><span class="section-number-3">5.1</span> エンターキーの挙動</h3>
<div class="outline-text-3" id="text-org6f2cf1cd">
<p>
好みの問題ですかね．標準では <code>C-j</code> が当てられています．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(global-set-key (kbd <span style="font-style: italic;">"RET"</span>) 'electric-newline-and-maybe-indent)
</pre>
</div>
</div>
</div>

<div id="outline-container-org4c4fe29c" class="outline-3">
<h3 id="org4c4fe29c"><span class="section-number-3">5.2</span> Yank時に装飾を取る</h3>
<div class="outline-text-3" id="text-org4c4fe29c">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setq</span> yank-excluded-properties t)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf6cb5849" class="outline-3">
<h3 id="orgf6cb5849"><span class="section-number-3">5.3</span> 矩形編集／連番入力</h3>
<div class="outline-text-3" id="text-orgf6cb5849">
<p>
24.4 からは， <code>rectangle-mark-mode</code> が使えるようになり， <code>C-x SPC</code> を押下すると矩形モードに入り直感的に矩形選択ができる．
</p>

<p>
標準の rect.el に以下の機能が実装されている．
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">矩形切り取り</td>
<td class="org-left">C-x r k</td>
</tr>

<tr>
<td class="org-left">矩形削除</td>
<td class="org-left">C-x r d</td>
</tr>

<tr>
<td class="org-left">矩形貼り付け</td>
<td class="org-left">C-x r y</td>
</tr>

<tr>
<td class="org-left">矩形先頭に文字を挿入</td>
<td class="org-left">C-x r t</td>
</tr>

<tr>
<td class="org-left">矩形を空白に変換する</td>
<td class="org-left">C-x r c</td>
</tr>
</tbody>
</table>

<p>
Built-in の cua-base.el（CUA-mode）を使うと，矩形選択は，領域選択後 <code>cua-toggle-rectangle-mark</code> でもできる．また，矩形選択した後に， <code>M-n</code> を押すと，連番をふれる．開始値，増加値を入力してから，hoge%03d.pgm などとすれば，hoge001，hoge002，，，と入力される．これと，org-mode の表機能（ <code>C-c |</code> で選択部分を簡単に表にできる）を組み合わせれば，連番で数値をふったテーブルを容易に作れる．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">cua-base</span>)
  (cua-mode 1)
  (<span style="font-weight: bold;">setq</span> cua-enable-cua-keys nil))
</pre>
</div>
</div>
</div>

<div id="outline-container-org9dba91d0" class="outline-3">
<h3 id="org9dba91d0"><span class="section-number-3">5.4</span> ファイル保存時に時間を記録する</h3>
<div class="outline-text-3" id="text-org9dba91d0">
<p>
Built-in の time-stamp.el を使う．
</p>

<p>
バッファの保存時にタイムスタンプを記録する．以下の設定では，バッファの先頭から10行以内に，"#+date:" があると，"#+date: 2011-12-31" のようにタイムスタンプが記録される．Org Mode 用には "<span class="timestamp-wrapper"><span class="timestamp">[2018-10-08 Mon 10:00]</span></span>" のような形式でタイムスタンプを記録するようにしている．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(time-stamp my-time-stamp)
       <span style="font-style: italic;">"time-stamp"</span> nil t)

  (add-hook 'before-save-hook #'my-time-stamp)

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"time-stamp"</span>
    (<span style="font-weight: bold;">setq</span> time-stamp-start <span style="font-style: italic;">"#\\+date:[ \t]*"</span>)
    (<span style="font-weight: bold;">setq</span> time-stamp-end <span style="font-style: italic;">"$"</span>)
    (<span style="font-weight: bold;">setq</span> time-stamp-line-limit 10) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">def=8</span>
    (<span style="font-weight: bold;">setq</span> time-stamp-default-format <span style="font-style: italic;">"%Y-%02m-%02d"</span>)

    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-time-stamp</span> ()
      (<span style="font-weight: bold;">setq</span> time-stamp-format
            (<span style="font-weight: bold;">if</span> (eq major-mode 'org-mode)
                <span style="font-style: italic;">"[%Y-%02m-%02d %3a %02H:%02M]"</span> <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">"%04y"</span>
              time-stamp-default-format))
      (<span style="font-weight: bold;">if</span> (boundp 'org-tree-slide-mode)
          (<span style="font-weight: bold;">unless</span> org-tree-slide-mode
            (time-stamp))
        (time-stamp)))))
</pre>
</div>
</div>
</div>

<div id="outline-container-orge62264fe" class="outline-3">
<h3 id="orge62264fe"><span class="section-number-3">5.5</span> 選択リージョンを使って検索</h3>
<div class="outline-text-3" id="text-orge62264fe">
<p>
検索語をミニバッファに入力するのが面倒なので，リージョンをそのまま検索語として利用します．
</p>

<ul class="org-ul">
<li><a href="http://dev.ariel-networks.com/articles/emacs/part5/">http://dev.ariel-networks.com/articles/emacs/part5/</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defadvice</span> <span style="font-weight: bold;">isearch-mode</span>
    (around isearch-mode-default-string
            (forward <span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> regexp op-fun recursive-edit word-p) activate)
  (<span style="font-weight: bold;">if</span> (<span style="font-weight: bold;">and</span> transient-mark-mode mark-active (not (eq (mark) (point))))
      (<span style="font-weight: bold;">progn</span>
        (isearch-update-ring (buffer-substring-no-properties (mark) (point)))
        (deactivate-mark)
        ad-do-it
        (<span style="font-weight: bold;">if</span> (not forward)
            (isearch-repeat-backward)
          (goto-char (mark))
          (isearch-repeat-forward)))
    ad-do-it))
</pre>
</div>
</div>
</div>

<div id="outline-container-org7cb03523" class="outline-3">
<h3 id="org7cb03523"><span class="section-number-3">5.6</span> ChangeLog モード</h3>
<div class="outline-text-3" id="text-org7cb03523">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">see private.el</span>
(<span style="font-weight: bold;">setq</span> user-full-name <span style="font-style: italic;">"Your NAME"</span>)
(<span style="font-weight: bold;">setq</span> user-mail-address <span style="font-style: italic;">"your@address.com"</span>)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-orgalist-activate</span> ()
  (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">orgalist</span> nil t)
    (orgalist-mode 1))) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">originally orgstruct-mode</span>

(add-hook 'change-log-mode-hook
          (<span style="font-weight: bold;">lambda</span> ()
            (my-orgalist-activate)
            (view-mode)
            (<span style="font-weight: bold;">setq</span> tab-width 4)
            (<span style="font-weight: bold;">setq</span> left-margin 4)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">ad:add-change-log-entry-other-window</span> ()
  (<span style="font-weight: bold;">when</span> view-mode
    (view-mode-disable)))

(advice-add 'add-change-log-entry-other-window
            <span style="font-weight: bold;">:before</span> #'ad:add-change-log-entry-other-window)
</pre>
</div>
</div>
</div>

<div id="outline-container-org1bd5d8ee" class="outline-3">
<h3 id="org1bd5d8ee"><span class="section-number-3">5.7</span> テキストモード</h3>
<div class="outline-text-3" id="text-org1bd5d8ee">
<p>
<a href="http://d.hatena.ne.jp/NeoCat/20080211">http://d.hatena.ne.jp/NeoCat/20080211</a>
</p>

<p>
とは言っても，Org-modeを知ってから <code>.txt</code> もテキストモードで開かなくなったので，ほぼ無意味な設定となりました．しかも， <code>nxml-mode</code> で <code>TAB</code> が効かなくなる現象が起きているので，以下の設定はしない方がよさげ．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(add-hook 'text-mode-hook
          (<span style="font-weight: bold;">lambda</span>()
              (<span style="font-weight: bold;">setq</span> tab-width 4)
              (<span style="font-weight: bold;">setq</span> indent-line-function 'tab-to-tab-stop)
              (<span style="font-weight: bold;">setq</span> tab-stop-list
                    '(4 8 12 16 20 24 28 32 36 40 44 48 52 56 60
                        64 68 72 76 80))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org92da42b4" class="outline-3">
<h3 id="org92da42b4"><span class="section-number-3">5.8</span> C/C++モード</h3>
<div class="outline-text-3" id="text-org92da42b4">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(modern-c++-font-lock-mode)
       <span style="font-style: italic;">"modern-cpp-font-lock"</span> nil t)
  (<span style="font-weight: bold;">push</span> '(<span style="font-style: italic;">"\\.[hm]$"</span> . c++-mode) auto-mode-alist)
  (add-hook 'c-mode-hook #'modern-c++-font-lock-mode)
  (add-hook 'c++-mode-hook #'modern-c++-font-lock-mode))
</pre>
</div>
</div>
</div>

<div id="outline-container-orga6184922" class="outline-3">
<h3 id="orga6184922"><span class="section-number-3">5.9</span> C#モード</h3>
<div class="outline-text-3" id="text-orga6184922">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(csharp-mode)
       <span style="font-style: italic;">"csharp-mode"</span> <span style="font-style: italic;">"Major mode for editing C# mode."</span> nil t)

  (<span style="font-weight: bold;">push</span> '(<span style="font-style: italic;">"\\.cs$"</span> . csharp-mode) auto-mode-alist))
</pre>
</div>
</div>
</div>

<div id="outline-container-org743f2508" class="outline-3">
<h3 id="org743f2508"><span class="section-number-3">5.10</span> Infoモード</h3>
<div class="outline-text-3" id="text-org743f2508">
<p>
Org-mode の日本語翻訳済みinfoを読むための設定．<a href="https://github.com/org-mode-doc-ja/org-ja">翻訳プロジェクト</a>で頒布しています．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(info org-info-ja)
       <span style="font-style: italic;">"info"</span> nil t)

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"info"</span>
    (add-to-list 'Info-additional-directory-list
                 (expand-file-name <span style="font-style: italic;">"~/devel/mygit/org-ja/work/"</span>))

    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">org-info-ja</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> node)
      <span style="font-style: italic;">"(Japanese) Read documentation for Org-mode in the info system.</span>
<span style="font-style: italic;">    With optional NODE, go directly to that node."</span>
      (<span style="font-weight: bold;">interactive</span>)
      (info (format <span style="font-style: italic;">"(org-ja)%s"</span> (<span style="font-weight: bold;">or</span> node <span style="font-style: italic;">""</span>))))))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd2a57328" class="outline-3">
<h3 id="orgd2a57328"><span class="section-number-3">5.11</span> Rモード</h3>
<div class="outline-text-3" id="text-orgd2a57328">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(R-mode R)
       <span style="font-style: italic;">"ess-site"</span> <span style="font-style: italic;">"Emacs Speaks Statistics mode"</span> nil t)

  (<span style="font-weight: bold;">push</span> '(<span style="font-style: italic;">"\\.[rR]$"</span> . R-mode) auto-mode-alist))
</pre>
</div>
</div>
</div>

<div id="outline-container-org8c99f06c" class="outline-3">
<h3 id="org8c99f06c"><span class="section-number-3">5.12</span> nXMLモード</h3>
<div class="outline-text-3" id="text-org8c99f06c">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(add-hook 'nxml-mode-hook
          (<span style="font-weight: bold;">lambda</span> ()
            (define-key nxml-mode-map <span style="font-style: italic;">"\r"</span> 'newline-and-indent)
            (auto-fill-mode -1)
            (<span style="font-weight: bold;">setq</span> indent-tabs-mode t)
            (<span style="font-weight: bold;">setq</span> nxml-slash-auto-complete-flag t)
            (<span style="font-weight: bold;">setq</span> tab-width 1)
            (<span style="font-weight: bold;">setq</span> nxml-child-indent 1)
            (<span style="font-weight: bold;">setq</span> nxml-attribute-indent 0)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbfa6c13b" class="outline-3">
<h3 id="orgbfa6c13b"><span class="section-number-3">5.13</span> yamlモード</h3>
<div class="outline-text-3" id="text-orgbfa6c13b">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(yaml-mode)
       <span style="font-style: italic;">"yaml-mode"</span> nil t)

  (<span style="font-weight: bold;">push</span> '(<span style="font-style: italic;">"\\.yml$"</span> . yaml-mode) auto-mode-alist))
</pre>
</div>
</div>
</div>

<div id="outline-container-org34a54f82" class="outline-3">
<h3 id="org34a54f82"><span class="section-number-3">5.14</span> jsonモード</h3>
<div class="outline-text-3" id="text-org34a54f82">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(json-mode)
       <span style="font-style: italic;">"json-mode"</span> nil t)

  (<span style="font-weight: bold;">push</span> '(<span style="font-style: italic;">"\\.json$"</span> . json-mode) auto-mode-alist))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc35f66fb" class="outline-3">
<h3 id="orgc35f66fb"><span class="section-number-3">5.15</span> javascriptモード</h3>
<div class="outline-text-3" id="text-orgc35f66fb">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(js2-mode)
       <span style="font-style: italic;">"js2-mode"</span> nil t)

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"js2-mode"</span>
    (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">js2-refactor</span> nil t)
    (<span style="font-weight: bold;">push</span> '(<span style="font-style: italic;">"\\.js$"</span> . js2-mode) auto-mode-alist)

    (<span style="font-weight: bold;">when</span> (autoload-if-found
           '(ac-js2-mode ac-js2-setup-auto-complete-mode)
           <span style="font-style: italic;">"ac-js2"</span> nil t)
      (add-hook 'js2-mode-hook #'ac-js2-mode))

    (<span style="font-weight: bold;">if</span> (executable-find <span style="font-style: italic;">"tern"</span>)
        (<span style="font-weight: bold;">when</span> (autoload-if-found
               '(tern-mode)
               <span style="font-style: italic;">"tern"</span> nil t)
          (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"tern"</span>
            (tern-mode 1)
            <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">tern-command shall be overwritten by actual path</span>
            (<span style="font-weight: bold;">setq</span> tern-command `(<span style="font-style: italic;">"node"</span> ,(executable-find <span style="font-style: italic;">"tern"</span>)))
            (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">tern-auto-complete</span> nil t)
              (tern-ac-setup)))
          (add-hook 'js2-mode-hook #'tern-mode))
      (message <span style="font-style: italic;">"--- tern is NOT installed in this system."</span>))))
</pre>
</div>
</div>
</div>

<div id="outline-container-orga7d86e03" class="outline-3">
<h3 id="orga7d86e03"><span class="section-number-3">5.16</span> csvモード</h3>
<div class="outline-text-3" id="text-orga7d86e03">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(csv-mode)
       <span style="font-style: italic;">"csv-mode"</span> nil t)

  (<span style="font-weight: bold;">push</span> '(<span style="font-style: italic;">"\\.csv$"</span> . csv-mode) auto-mode-alist))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgba009928" class="outline-3">
<h3 id="orgba009928"><span class="section-number-3">5.17</span> asciiモード</h3>
<div class="outline-text-3" id="text-orgba009928">
<p>
カーソル下の文字のアスキーコードを別ウィンドウでリアルタイムに確認できます．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(autoload-if-found '(ascii-on ascii-off) <span style="font-style: italic;">"ascii"</span> nil t)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc5b5891d" class="outline-3">
<h3 id="orgc5b5891d"><span class="section-number-3">5.18</span> javaモード</h3>
<div class="outline-text-3" id="text-orgc5b5891d">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(cc-mode)
       <span style="font-style: italic;">"cc-mode"</span> nil t)

  (<span style="font-weight: bold;">push</span> '(<span style="font-style: italic;">"\\.pde$"</span> . java-mode) auto-mode-alist) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Processing</span>
  (<span style="font-weight: bold;">push</span> '(<span style="font-style: italic;">"\\.java$"</span> . java-mode) auto-mode-alist))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf0c39e0f" class="outline-3">
<h3 id="orgf0c39e0f"><span class="section-number-3">5.19</span> esモード</h3>
<div class="outline-text-3" id="text-orgf0c39e0f">
<ul class="org-ul">
<li><a href="https://github.com/dakrone/es-mode">https://github.com/dakrone/es-mode</a></li>
</ul>

<p>
<a href="https://www.elastic.co/products/elasticsearch">ElasticSearch</a> のクエリを編集します．org-mode との連携もできます．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(es-mode)
       <span style="font-style: italic;">"es-mode"</span> nil t)

  (<span style="font-weight: bold;">push</span> '(<span style="font-style: italic;">"\\.es$"</span> . es-mode) auto-mode-alist))
</pre>
</div>
</div>
</div>

<div id="outline-container-org2a14728f" class="outline-3">
<h3 id="org2a14728f"><span class="section-number-3">5.20</span> gnuplotモード</h3>
<div class="outline-text-3" id="text-org2a14728f">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(gnuplot-mode)
       <span style="font-style: italic;">"gnuplot-mode"</span> nil t)

  (<span style="font-weight: bold;">push</span> '(<span style="font-style: italic;">"\\.plt$"</span> . gnuplot-mode) auto-mode-alist))
</pre>
</div>
</div>
</div>

<div id="outline-container-orga6fc6cf7" class="outline-3">
<h3 id="orga6fc6cf7"><span class="section-number-3">5.21</span> markdown-modeモード</h3>
<div class="outline-text-3" id="text-orga6fc6cf7">
<ul class="org-ul">
<li><a href="http://jblevins.org/projects/markdown-mode/">http://jblevins.org/projects/markdown-mode/</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(markdown-mode)
       <span style="font-style: italic;">"markdown-mode"</span> nil t)

  (<span style="font-weight: bold;">push</span> '(<span style="font-style: italic;">"\\.markdown$"</span> . markdown-mode) auto-mode-alist)
  (<span style="font-weight: bold;">push</span> '(<span style="font-style: italic;">"\\.md$"</span> . markdown-mode) auto-mode-alist))
</pre>
</div>
</div>
</div>

<div id="outline-container-org29328dcd" class="outline-3">
<h3 id="org29328dcd"><span class="section-number-3">5.22</span> cmakeモード</h3>
<div class="outline-text-3" id="text-org29328dcd">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">if</span> (executable-find <span style="font-style: italic;">"cmake"</span>)
    (<span style="font-weight: bold;">when</span> (autoload-if-found
           '(cmake-mode)
           <span style="font-style: italic;">"cmake-mode"</span> nil t)

      (add-to-list 'auto-mode-alist '(<span style="font-style: italic;">"CMakeLists\\.txt\\'"</span> . cmake-mode))
      (add-to-list 'auto-mode-alist '(<span style="font-style: italic;">"\\.cmake\\'"</span> . cmake-mode)))
  (message <span style="font-style: italic;">"--- cmake is NOT installed."</span>))
</pre>
</div>
</div>
</div>

<div id="outline-container-org41da658e" class="outline-3">
<h3 id="org41da658e"><span class="section-number-3">5.23</span> logviewモード</h3>
<div class="outline-text-3" id="text-org41da658e">
<ul class="org-ul">
<li><a href="https://github.com/doublep/logview">doublep/logview: Emacs mode for viewing log files.</a></li>
</ul>

<p>
ログファイルが見やすくなり， <code>n/p</code> で移動可能になります．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(logview-mode)
       <span style="font-style: italic;">"logview"</span> nil t)
  (<span style="font-weight: bold;">push</span> '(<span style="font-style: italic;">"\\.log$"</span> . logview-mode) auto-mode-alist))
</pre>
</div>
</div>
</div>

<div id="outline-container-org6b6c1c11" class="outline-3">
<h3 id="org6b6c1c11"><span class="section-number-3">5.24</span> viewモード</h3>
<div class="outline-text-3" id="text-org6b6c1c11">
<p>
gzされた elisp ソースを見るときに， <code>view-mode</code> を使います．また下記の設定では， <code>my-auto-view-dirs</code> に追加したディレクトリのファイルを開くと， <code>view-mode</code> が常に有効になります．
</p>

<p>
さらなる細かい制御が必要な場合は，<a href="https://www.emacswiki.org/emacs/viewer.el">viewer.el</a> がおすすめです．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#29305;&#23450;&#12398;&#25313;&#24373;&#23376;&#12539;&#12487;&#12451;&#12524;&#12463;&#12488;&#12522;</span>
(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my-auto-view-regexp</span> <span style="font-style: italic;">"\\.el.gz$</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">|</span><span style="font-style: italic;">\\.patch$</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">|</span><span style="font-style: italic;">\\.emacs.d/[</span><span style="font-style: italic;">^</span><span style="font-style: italic;">/]+/el-get"</span>)

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#29305;&#23450;&#12398;&#12487;&#12451;&#12524;&#12463;&#12488;&#12522;&#65288;&#32118;&#23550;&#12497;&#12473;&#12539;&#12507;&#12540;&#12512;&#12487;&#12451;&#12524;&#12463;&#12488;&#12522;&#20197;&#19979;&#65289;</span>
(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my-auto-view-dirs</span> nil)
(add-to-list 'my-auto-view-dirs <span style="font-style: italic;">"~/devel/emacs-head/emacs/"</span>)
(<span style="font-weight: bold;">when</span> (eq window-system 'w32)
  (add-to-list 'my-auto-view-dirs <span style="font-style: italic;">"c:/msys64/mingw64"</span>))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-auto-view</span> ()
  (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">and</span> my-auto-view-regexp
             (string-match my-auto-view-regexp buffer-file-name))
    (view-mode 1))
  (<span style="font-weight: bold;">dolist</span> (dir my-auto-view-dirs)
    (<span style="font-weight: bold;">when</span> (eq 0 (string-match (expand-file-name dir) buffer-file-name))
      (view-mode 1))))
(add-hook 'find-file-hook #'my-auto-view)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfdeec1c5" class="outline-3">
<h3 id="orgfdeec1c5"><span class="section-number-3">5.25</span> Web/HTMLモード&#xa0;&#xa0;&#xa0;<span class="tag"><span class="web">web</span></span></h3>
<div class="outline-text-3" id="text-orgfdeec1c5">
<p>
HTML編集をするなら <a href="http://web-mode.org/">web-mode</a> がお勧めです．古いHTMLモードを使っている方は，移行時期です．以下の <code>my-web-indent-fold</code> では， タブキーを打つたびにタグでくくられた領域を展開／非表示して整形します．Org-mode っぽい動作になりますが，操作の度にバッファに変更が加わったと判断されるので好みが分かれると思います．自動保存を有効にしているとそれほど気になりません．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(web-mode)
       <span style="font-style: italic;">"web-mode"</span> <span style="font-style: italic;">"web-mode"</span> t)

  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">web-mode &#12391;&#38283;&#12367;&#12501;&#12449;&#12452;&#12523;&#12398;&#25313;&#24373;&#23376;&#12434;&#25351;&#23450;</span>
  (<span style="font-weight: bold;">push</span> '(<span style="font-style: italic;">"\\.phtml\\'"</span> . web-mode) auto-mode-alist)
  (<span style="font-weight: bold;">push</span> '(<span style="font-style: italic;">"\\.tpl\\.php\\'"</span> . web-mode) auto-mode-alist)
  (<span style="font-weight: bold;">push</span> '(<span style="font-style: italic;">"\\.jsp\\'"</span> . web-mode) auto-mode-alist)
  (<span style="font-weight: bold;">push</span> '(<span style="font-style: italic;">"\\.as[cp]x\\'"</span> . web-mode) auto-mode-alist)
  (<span style="font-weight: bold;">push</span> '(<span style="font-style: italic;">"\\.erb\\'"</span> . web-mode) auto-mode-alist)
  (<span style="font-weight: bold;">push</span> '(<span style="font-style: italic;">"\\.mustache\\'"</span> . web-mode) auto-mode-alist)
  (<span style="font-weight: bold;">push</span> '(<span style="font-style: italic;">"\\.djhtml\\'"</span> . web-mode) auto-mode-alist)
  (<span style="font-weight: bold;">push</span> '(<span style="font-style: italic;">"\\.html?\\'"</span> . web-mode) auto-mode-alist)

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"web-mode"</span>
    (define-key web-mode-map (kbd <span style="font-style: italic;">"S-&lt;tab&gt;"</span>) 'my-web-indent-fold)

    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-web-indent-fold</span> ()
      (<span style="font-weight: bold;">interactive</span>)
      (web-mode-fold-or-unfold)
      (web-mode-buffer-indent)
      (indent-for-tab-command))

    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">indent</span>
    (<span style="font-weight: bold;">setq</span> web-mode-markup-indent-offset 1)

    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#33394;&#12398;&#35373;&#23450;</span>
    (custom-set-faces
     <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">custom-set-faces was added by Custom.</span>
     <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">If you edit it by hand, you could mess it up, so be careful.</span>
     <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Your init file should contain only one such instance.</span>
     <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">If there is more than one, they won't work right.</span>
     '(web-mode-comment-face ((t (<span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#D9333F"</span>))))
     '(web-mode-css-at-rule-face ((t (<span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#FF7F00"</span>))))
     '(web-mode-css-pseudo-class-face ((t (<span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#FF7F00"</span>))))
     '(web-mode-css-rule-face ((t (<span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#A0D8EF"</span>))))
     '(web-mode-doctype-face ((t (<span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#82AE46"</span>))))
     '(web-mode-html-attr-name-face ((t (<span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#C97586"</span>))))
     '(web-mode-html-attr-value-face ((t (<span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#82AE46"</span>))))
     '(web-mode-html-tag-face ((t (<span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"##4682ae"</span> <span style="font-weight: bold;">:weight</span> bold))))
     '(web-mode-server-comment-face ((t (<span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#D9333F"</span>)))))))
</pre>
</div>
</div>
</div>

<div id="outline-container-orge1eeb2a1" class="outline-3">
<h3 id="orge1eeb2a1"><span class="section-number-3">5.26</span> POモード</h3>
<div class="outline-text-3" id="text-orge1eeb2a1">
<ul class="org-ul">
<li><a href="http://www.emacswiki.org/emacs/PoMode">http://www.emacswiki.org/emacs/PoMode</a></li>
<li><a href="http://www.emacswiki.org/emacs/po-mode+.el">http://www.emacswiki.org/emacs/po-mode+.el</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;</span><span style="font-weight: bold; font-style: italic;">(autoload 'po-mode "po-mode+" nil nil)</span>
<span style="font-weight: bold; font-style: italic;">;;</span><span style="font-weight: bold; font-style: italic;">(autoload 'po-mode "po-mode" nil t)</span>
(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(po-mode)
       <span style="font-style: italic;">"po-mode"</span> nil t)

  (<span style="font-weight: bold;">push</span> '(<span style="font-style: italic;">"\\.po[tx]?\\'</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">|</span><span style="font-style: italic;">\\.po\\$"</span> . po-mode) auto-mode-alist))
</pre>
</div>
</div>
</div>

<div id="outline-container-org58f62c66" class="outline-3">
<h3 id="org58f62c66"><span class="section-number-3">5.27</span> Goモード</h3>
<div class="outline-text-3" id="text-org58f62c66">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(go-mode) <span style="font-style: italic;">"go-mode"</span> nil t)
  (<span style="font-weight: bold;">push</span> '(<span style="font-style: italic;">"\\.go\\'"</span> . go-mode) auto-mode-alist))
</pre>
</div>
</div>
</div>

<div id="outline-container-orge727dabc" class="outline-3">
<h3 id="orge727dabc"><span class="section-number-3">5.28</span> スペルチェック</h3>
<div class="outline-text-3" id="text-orge727dabc">
<p>
Built-in の ispell を使う．チェックエンジンは，aspell を利用する．そして， <code>hunspell</code> に移行した．
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">'ns</td>
<td class="org-left">sudo port install aspell aspell-dict-en</td>
</tr>

<tr>
<td class="org-left">'x32</td>
<td class="org-left">installer.exe and aspell-en from <a href="http://aspell.net/win32/">http://aspell.net/win32/</a></td>
</tr>
</tbody>
</table>

<ul class="org-ul">
<li><a href="http://qiita.com/YutakakINJO/items/2c891aff66ef45251893">英語の文章を aspell でスペルチェック - Qiita</a></li>
</ul>

<p>
コマンドラインから <code>aspell</code> を使う時は，
</p>

<div class="org-src-container">
<pre class="src src-sh">aspell -l en -c &lt;file&gt;
</pre>
</div>

<p>
とすると， <code>~/.aspell.en.pws</code> を個人辞書として暗黙的に設定し，スペルチェックをしてくれる． <code>hunspell</code> が使える環境ならば，優先して使います．さらに， <code>~/.aspell.conf</code> に，次を書いておきます．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">lang en_US
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(ispell-region ispell-complete-word)
       <span style="font-style: italic;">"ispell"</span> nil t)

  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Spell checking within a specified region</span>
  (global-set-key (kbd <span style="font-style: italic;">"C-c f 7"</span>) 'ispell-region)
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#35036;&#23436;&#20505;&#35036;&#12398;&#34920;&#31034;&#65288;flyspell &#12364;&#20351;&#12360;&#12427;&#26178;&#12399;&#12381;&#12385;&#12425;&#12434;&#20778;&#20808;&#12375;&#12390; &lt;f7&gt; &#12395;&#12377;&#12427;&#65294;</span>
  (global-set-key (kbd <span style="font-style: italic;">"&lt;f7&gt;"</span>) 'ispell-word)

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"ispell"</span>
    (<span style="font-weight: bold;">setq</span> ispell-encoding8-command t)
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">for English and Japanese mixed</span>
    (add-to-list 'ispell-skip-region-alist '(<span style="font-style: italic;">"[</span><span style="font-style: italic;">^</span><span style="font-style: italic;">\000-\377]+"</span>))
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">http://endlessparentheses.com/ispell-and-org-mode.html</span>
    (add-to-list 'ispell-skip-region-alist '(<span style="font-style: italic;">"^#\\+begin_src"</span> . <span style="font-style: italic;">"^#\\+end_src"</span>))
    (add-to-list 'ispell-skip-region-alist '(<span style="font-style: italic;">"~"</span> <span style="font-style: italic;">"~"</span>))
    (add-to-list 'ispell-skip-region-alist '(<span style="font-style: italic;">"="</span> <span style="font-style: italic;">"="</span>))
    (add-to-list 'ispell-skip-region-alist '(org-property-drawer-re))

    (<span style="font-weight: bold;">cond</span>
     ((executable-find <span style="font-style: italic;">"hunspell"</span>)
      (setenv <span style="font-style: italic;">"LC_ALL"</span> <span style="font-style: italic;">"en_US"</span>)
      <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(message "--- hunspell loaded.")</span>
      <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(setenv "DICPATH" "/Applications/LibreOffice.app/Contents/Resources/extensions/dict-en")</span>
      (setenv <span style="font-style: italic;">"DICPATH"</span> (concat (getenv <span style="font-style: italic;">"SYNCROOT"</span>) <span style="font-style: italic;">"/emacs.d/hunspell/dict-en"</span>))
      (<span style="font-weight: bold;">setq</span> ispell-local-dictionary-alist
            '((<span style="font-style: italic;">"ja_JP"</span> <span style="font-style: italic;">"[[:alpha:]]"</span> <span style="font-style: italic;">"[</span><span style="font-style: italic;">^</span><span style="font-style: italic;">[:alpha:]]"</span> <span style="font-style: italic;">"[']"</span> nil
               (<span style="font-style: italic;">"-d"</span> <span style="font-style: italic;">"en_US"</span>) nil utf-8)
              (<span style="font-style: italic;">"en_US"</span> <span style="font-style: italic;">"[[:alpha:]]"</span> <span style="font-style: italic;">"[</span><span style="font-style: italic;">^</span><span style="font-style: italic;">[:alpha:]]"</span> <span style="font-style: italic;">"[']"</span> nil
               (<span style="font-style: italic;">"-d"</span> <span style="font-style: italic;">"en_US"</span>) nil utf-8)))
      (<span style="font-weight: bold;">setq</span> ispell-local-dictionary <span style="font-style: italic;">"en_US"</span>)
      (<span style="font-weight: bold;">setq</span> ispell-dictionary ispell-local-dictionary)
      (<span style="font-weight: bold;">if</span> shutup-p
          <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#24517;&#35201;&#65294;&#12375;&#12363;&#12418; ispell-program-name &#25351;&#23450;&#12398;&#21069;&#12391;&#65294;</span>
          <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#12383;&#12384;&#12375;&#65292;ispell-local-dictionary-alist &#12398;&#24460;&#12391;&#65294;</span>
          (shut-up (ispell-change-dictionary <span style="font-style: italic;">"en_US"</span> t))
        (ispell-change-dictionary <span style="font-style: italic;">"en_US"</span> t))
      (<span style="font-weight: bold;">setq-default</span> ispell-program-name (executable-find <span style="font-style: italic;">"hunspell"</span>))
      <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Not regal way, but it's OK (usually ispell-local-dictionary-alist)</span>

      (<span style="font-weight: bold;">setq</span> ispell-hunspell-dictionary-alist ispell-local-dictionary-alist)
      (<span style="font-weight: bold;">setq</span> ispell-personal-dictionary
            (concat (getenv <span style="font-style: italic;">"SYNCROOT"</span>) <span style="font-style: italic;">"/emacs.d/.hunspell.en.dic"</span>)))

     ((executable-find <span style="font-style: italic;">"aspell"</span>)
      <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(message "--- aspell loaded.")</span>
      (<span style="font-weight: bold;">setq-default</span> ispell-program-name <span style="font-style: italic;">"aspell"</span>)
      <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(when (eq window-system 'w32)</span>
      <span style="font-weight: bold; font-style: italic;">;;   </span><span style="font-weight: bold; font-style: italic;">(setq-default ispell-program-name</span>
      <span style="font-weight: bold; font-style: italic;">;;                 </span><span style="font-weight: bold; font-style: italic;">"C:/Program Files/Aspell/bin/aspell.exe"))</span>
      (<span style="font-weight: bold;">setq</span> ispell-dictionary <span style="font-style: italic;">"english"</span>)
      <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">This will also avoid an IM-OFF issue for flyspell-mode.</span>
      <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(setq ispell-aspell-supports-utf8 t) ;; Obsolete</span>
      (<span style="font-weight: bold;">setq</span> ispell-local-dictionary-alist
            '((nil <span style="font-style: italic;">"[a-zA-Z]"</span> <span style="font-style: italic;">"[</span><span style="font-style: italic;">^</span><span style="font-style: italic;">a-zA-Z]"</span> <span style="font-style: italic;">"'"</span> t
                   (<span style="font-style: italic;">"-d"</span> <span style="font-style: italic;">"en"</span> <span style="font-style: italic;">"--encoding=utf-8"</span>) nil utf-8)))
      (<span style="font-weight: bold;">setq</span> ispell-personal-dictionary
            (concat (getenv <span style="font-style: italic;">"SYNCROOT"</span>) <span style="font-style: italic;">"/emacs.d/config/aspell.en.pws"</span>)))
     (t
      nil))))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdd65fc08" class="outline-3">
<h3 id="orgdd65fc08"><span class="section-number-3">5.29</span> リアルタイムスペルチェック</h3>
<div class="outline-text-3" id="text-orgdd65fc08">
<p>
Built-in の <a href="http://www.emacswiki.org/emacs/FlySpell">flyspell.el</a> を使います．flyspell は内部で <code>ispell</code> を読み込んでいるので，辞書機能自体はそちらの設定が使われます．
</p>

<p>
<a href="http://www.morishima.net/~naoto/fragments/archives/2005/12/20/flyspell/">http://www.morishima.net/~naoto/fragments/archives/2005/12/20/flyspell/</a>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(flyspell-prog-mode flyspell-mode)
       <span style="font-style: italic;">"flyspell"</span> nil t)

  (<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">major-mode-with-flyspell</span>
    '(text-mode change-log-mode latex-mode yatex-mode
                git-commit-mode org-mode))
  (<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">major-mode-with-flyspell-prog</span>
    '(c-mode-common emacs-lisp-mode perl-mode python-mode))
  (<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my-flyspell-target-modes</span>
    (append major-mode-with-flyspell
            major-mode-with-flyspell-prog))

  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#12496;&#12483;&#12501;&#12449;&#20869;&#12398;&#20840;&#12390;&#12434;&#12481;&#12455;&#12483;&#12463;&#23550;&#35937;&#12395;&#12377;&#12427;&#12514;&#12540;&#12489;&#12398; hook &#12395; flyspell &#36215;&#21205;&#12434;&#30331;&#37682;</span>
  (<span style="font-weight: bold;">dolist</span> (hook major-mode-with-flyspell)
    (add-hook (intern (format <span style="font-style: italic;">"%s-hook"</span> hook))
              (<span style="font-weight: bold;">lambda</span> () (flyspell-mode 1))))

  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#12467;&#12513;&#12531;&#12488;&#34892;&#12398;&#12415;&#12434;&#12481;&#12455;&#12483;&#12463;&#23550;&#35937;&#12395;&#12377;&#12427;</span>
  (<span style="font-weight: bold;">dolist</span> (hook major-mode-with-flyspell-prog)
    (add-hook (intern (format <span style="font-style: italic;">"%s-hook"</span> hook))
              #'flyspell-prog-mode))

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"flyspell"</span>
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">C-; &#12434;&#12458;&#12540;&#12496;&#12540;&#12521;&#12452;&#12489;</span>
    (define-key flyspell-mode-map (kbd <span style="font-style: italic;">"C-;"</span>) 'comment-dwim)
    (<span style="font-weight: bold;">setq</span> flyspell-duplicate-distance 0)
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(setq flyspell-mode-line-string " F")</span>
    (<span style="font-weight: bold;">setq</span> flyspell-mode-line-string <span style="font-style: italic;">""</span>)
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(setq flyspell-large-region 200)</span>
    (set-face-attribute 'flyspell-duplicate nil
                        <span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#EA5506"</span> <span style="font-weight: bold;">:bold</span> t
                        <span style="font-weight: bold;">:background</span> nil <span style="font-weight: bold;">:underline</span> t)
    (set-face-attribute 'flyspell-incorrect nil
                        <span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#BA2636"</span> <span style="font-weight: bold;">:bold</span> nil
                        <span style="font-weight: bold;">:background</span> nil <span style="font-weight: bold;">:underline</span> t)

    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">ispell-complete-word &#12398;&#12461;&#12540;&#12496;&#12452;&#12531;&#12489;&#12434;&#19978;&#26360;&#12365;</span>
    (global-set-key (kbd <span style="font-style: italic;">"&lt;f7&gt;"</span>) 'flyspell-correct-at-point)

    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">ivy &#12434;&#29992;&#12356;&#12427;</span>
    (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">flyspell-correct-ivy</span> nil t)
      (<span style="font-weight: bold;">setq</span> flyspell-correct-interface #'flyspell-correct-ivy))

    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Auto complete &#12392;&#12398;&#34909;&#31361;&#12434;&#22238;&#36991;</span>
    (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"auto-complete"</span>
      (ac-flyspell-workaround))

    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-flyspell-ignore-nonascii</span> (beg end _info)
      <span style="font-style: italic;">"incorrect&#21028;&#23450;&#12434;ASCII&#12395;&#38480;&#23450;"</span>
      (string-match <span style="font-style: italic;">"[</span><span style="font-style: italic;">^</span><span style="font-style: italic;">!-~]"</span> (buffer-substring beg end)))
    (add-hook 'flyspell-incorrect-hook #'my-flyspell-ignore-nonascii)

    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-flyspell-on</span> ()
      (<span style="font-weight: bold;">cond</span>
       ((memq major-mode major-mode-with-flyspell)
        (turn-on-flyspell))
       ((memq major-mode major-mode-with-flyspell-prog)
        (flyspell-prog-mode))
       (t
        nil)))

    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-flyspell-off</span> ()
      (<span style="font-weight: bold;">when</span> (memq major-mode my-flyspell-target-modes)
        (turn-off-flyspell)))

    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">[FIXME] nextstep+inline-patch&#29256;&#12391; flyspell &#12377;&#12427;&#12392;&#65292;&#26085;&#26412;&#35486;nyuu&#12398;&#12424;&#12358;&#12395;&#12394;&#12427;&#22580;&#21512;&#12364;&#12354;&#12427;&#12398;&#12391;&#65292;&#12381;&#12428;&#12434;&#22238;&#36991;&#65288;IME &#12364; ON&#12395;&#12394;&#12387;&#12383;&#12425;&#19968;&#26178;&#30340;&#12395; flyspell &#12434;&#27490;&#12417;&#12427;&#65289;</span>
    (add-hook 'input-method-activate-hook #'my-flyspell-off)
    (add-hook 'input-method-deactivate-hook #'my-flyspell-on)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org9317ee6f" class="outline-3">
<h3 id="org9317ee6f"><span class="section-number-3">5.30</span> リージョン内の文字をカウントする</h3>
<div class="outline-text-3" id="text-org9317ee6f">
<p>
ビルドインの simple.el に十分な機能なのがある．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(global-set-key (kbd <span style="font-style: italic;">"M-="</span>) 'count-words)
</pre>
</div>

<p>
以前は，<a href="http://www.emacswiki.org/emacs/WordCount">word-count.el</a> を使用していた．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(word-count-mode)
       <span style="font-style: italic;">"word-count"</span> <span style="font-style: italic;">"Minor mode to count words."</span> t)

  (global-set-key (kbd <span style="font-style: italic;">"M-="</span>) 'word-count-mode))
</pre>
</div>
</div>
</div>

<div id="outline-container-org863cfc2a" class="outline-3">
<h3 id="org863cfc2a"><span class="section-number-3">5.31</span> 世界時計を使う</h3>
<div class="outline-text-3" id="text-org863cfc2a">
<p>
<code>M-x display-time-world</code> で表示されます．次の設定を施して， <code>shackle.el</code> と組み合わせれば，表示後に <code>q</code> 押下でウィンドウを閉じてカーソルを元のバッファに戻せます．
</p>

<p>
世界の時刻を確認するために wclock.el がありました（参考：<a href="https://pxaka.tokyo/wiki/doku.php?id=emacs">https://pxaka.tokyo/wiki/doku.php?id=emacs</a>）が，現在はビルトインの <code>time.el</code> に <code>display-time-world-mode</code> として吸収されているようです． <code>display-time-world-buffer-name</code> に wclock が設定されているところが名残と思われます．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"time"</span>
  (define-key display-time-world-mode-map <span style="font-style: italic;">"q"</span> 'delete-window))
</pre>
</div>

<p>
<code>tz</code> の値は，システム内部 <code>/usr/share/zoneinfo</code> を見るか，<a href="https://en.wikipedia.org/wiki/List_of_tz_database_time_zones">公開情報</a>から確認できます．
</p>
</div>
</div>

<div id="outline-container-orgee372b48" class="outline-3">
<h3 id="orgee372b48"><span class="section-number-3">5.32</span> [counsel-world-clock.el] ivy でタイムゾーンの情報を選択する</h3>
<div class="outline-text-3" id="text-orgee372b48">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(autoload-if-found '(counsel-world-clock) <span style="font-style: italic;">"counsel-world-clock"</span> nil t)
</pre>
</div>
</div>
</div>

<div id="outline-container-org66e1952c" class="outline-3">
<h3 id="org66e1952c"><span class="section-number-3">5.33</span> 読書モード</h3>
<div class="outline-text-3" id="text-org66e1952c">
<p>
<code>view-mode</code> と <code>origami.el</code> を使い，読書モードにします．書き込みが禁止されるので，安心して読めることに加え， <code>origami.el</code> の FOLD機能を使い，関数を簡略表示して Org Modeのように，注目するものだけ読むことが可能です． <code>M-x view-mode</code> で起動します．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"view"</span>
  (define-key view-mode-map (kbd <span style="font-style: italic;">"n"</span>) 'next-line)
  (define-key view-mode-map (kbd <span style="font-style: italic;">"p"</span>) 'previous-line)
  (define-key view-mode-map (kbd <span style="font-style: italic;">"f"</span>) 'forward-char)
  (define-key view-mode-map (kbd <span style="font-style: italic;">"b"</span>) 'backward-char)
  (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">origami</span> nil t)
    (define-key view-mode-map (kbd <span style="font-style: italic;">"&lt;tab&gt;"</span>) 'origami-toggle-node)
    (define-key view-mode-map (kbd <span style="font-style: italic;">"S-&lt;tab&gt;"</span>) 'origami-toggle-all-nodes))

  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">ad:view--enable</span> () (my-mode-line-on))
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">ad:view--disable</span> () (my-mode-line-off))
  (<span style="font-weight: bold;">unless</span> my-toggle-modeline-global
    (advice-add 'view--enable <span style="font-weight: bold;">:before</span> #'ad:view--enable)
    (advice-add 'view--disable <span style="font-weight: bold;">:before</span> #'ad:view--disable)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgab4f9bf0" class="outline-3">
<h3 id="orgab4f9bf0"><span class="section-number-3">5.34</span> [latex-math-preview.el] TeX数式をプレビュー&#xa0;&#xa0;&#xa0;<span class="tag"><span class="tex">tex</span></span></h3>
<div class="outline-text-3" id="text-orgab4f9bf0">
<ul class="org-ul">
<li><a href="https://gitlab.com/latex-math-preview/latex-math-preview/tree/775887a89447dd19541b121161cc02e9799d0d3a">Files · 775887a89447dd19541b121161cc02e9799d0d3a · latex-math-preview / Latex Math Preview · GitLab</a></li>
<li><a href="http://www.emacswiki.org/emacs/latex-math-preview.el">http://www.emacswiki.org/emacs/latex-math-preview.el</a></li>
<li><a href="http://transitive.info/software/latex-math-preview/">http://transitive.info/software/latex-math-preview/</a></li>
</ul>

<p>
以下の設定では， 数式で <code>&lt;f6&gt;</code> を押すとプレビューが走り，さらに <code>&lt;f6&gt;</code> を押すとプレビューウィンドウを閉じるように動作します．通常， <code>q</code> でプレビューを閉じられます．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(latex-math-preview-expression
         latex-math-preview-insert-symbol
         latex-math-preview-save-image-file
         latex-math-preview-beamer-frame)
       <span style="font-style: italic;">"latex-math-preview"</span> nil t nil)

  (global-set-key (kbd <span style="font-style: italic;">"&lt;f6&gt;"</span>) 'latex-math-preview-expression)

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"latex-math-preview"</span>
    (<span style="font-weight: bold;">setq</span> latex-math-preview-command-path-alist
          '((latex . <span style="font-style: italic;">"latex"</span>)
            (dvipng . <span style="font-style: italic;">"dvipng"</span>)
            (dvips . <span style="font-style: italic;">"dvips"</span>)))
    (define-key latex-math-preview-expression-mode-map (kbd <span style="font-style: italic;">"&lt;f6&gt;"</span>)
      'latex-math-preview-delete-buffer)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org770fb4ec" class="outline-3">
<h3 id="org770fb4ec"><span class="section-number-3">5.35</span> [yatex.el] YaTeXでTex編集&#xa0;&#xa0;&#xa0;<span class="tag"><span class="tex">tex</span></span></h3>
<div class="outline-text-3" id="text-org770fb4ec">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(yatex-mode)
       <span style="font-style: italic;">"yatex"</span> <span style="font-style: italic;">"Yet Another LaTeX mode"</span> t)

  (<span style="font-weight: bold;">push</span> '(<span style="font-style: italic;">"\\.tex$"</span> . yatex-mode) auto-mode-alist)

  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Disable auto line break</span>
  (add-hook 'yatex-mode-hook
            (<span style="font-weight: bold;">lambda</span> ()
                (<span style="font-weight: bold;">setq</span> auto-fill-function nil)))

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"yatex"</span>
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">1=Shift JIS, 2=JIS, 3=EUC, 4=UTF-8</span>
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(setq YaTeX-kanji-code nil)</span>
    (modify-coding-system-alist 'file <span style="font-style: italic;">"\\.tex$'"</span> 'utf-8)))
</pre>
</div>

<p>
ショートカットの利用を強制するメッセージが出るので，抑制します．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"yatex"</span>
  (put 'YaTeX-insert-braces 'begend-guide 2)

  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">ad:YaTeX-insert-begin-end</span> (env region-mode)
    <span style="font-style: italic;">"Insert \\begin{mode-name} and \\end{mode-name}.</span>
<span style="font-style: italic;">This works also for other defined begin/end tokens to define the structure."</span>
    (<span style="font-weight: bold;">setq</span> YaTeX-current-completion-type 'begin)
    (<span style="font-weight: bold;">let*</span>((ccol (current-column)) beg beg2 exchange
          (_arg region-mode)    <span style="font-weight: bold; font-style: italic;">;</span><span style="font-weight: bold; font-style: italic;">for old compatibility</span>
          (indent-column (+ ccol YaTeX-environment-indent))(_i 1) _func)
      (<span style="font-weight: bold;">if</span> (<span style="font-weight: bold;">and</span> region-mode (&gt; (point) (mark)))
          (<span style="font-weight: bold;">progn</span> (exchange-point-and-mark)
                 (<span style="font-weight: bold;">setq</span> exchange t
                       ccol (current-column)
                       indent-column (+ ccol YaTeX-environment-indent))))
      <span style="font-weight: bold; font-style: italic;">;;</span><span style="font-weight: bold; font-style: italic;">VER2 (insert "\\begin{" env "}" (YaTeX-addin env))</span>
      (<span style="font-weight: bold;">setq</span> beg (point))
      (YaTeX-insert-struc 'begin env)
      (<span style="font-weight: bold;">setq</span> beg2 (point))
      (insert <span style="font-style: italic;">"\n"</span>)
      (indent-to indent-column)
      (<span style="font-weight: bold;">save-excursion</span>
        <span style="font-weight: bold; font-style: italic;">;;</span><span style="font-weight: bold; font-style: italic;">indent optional argument of \begin{env}, if any</span>
        (<span style="font-weight: bold;">while</span> (&gt; (point-beginning-of-line) beg)
          (skip-chars-forward <span style="font-style: italic;">"\\s "</span> (point-end-of-line))
          (indent-to indent-column)
          (forward-line -1)))
      (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">yatexenv</span>)
      (<span style="font-weight: bold;">if</span> region-mode
          <span style="font-weight: bold; font-style: italic;">;;</span><span style="font-weight: bold; font-style: italic;">if region-mode, indent all text in the region</span>
          (<span style="font-weight: bold;">save-excursion</span>
            (<span style="font-weight: bold;">if</span> (fboundp (intern-soft (concat <span style="font-style: italic;">"YaTeX-enclose-"</span> env)))
                (funcall (intern-soft (concat <span style="font-style: italic;">"YaTeX-enclose-"</span> env))
                         (point) (mark))
              (<span style="font-weight: bold;">while</span> (&lt; (<span style="font-weight: bold;">progn</span> (forward-line 1) (point)) (mark))
                (<span style="font-weight: bold;">if</span> (eolp) nil
                  (skip-chars-forward <span style="font-style: italic;">" \t\n"</span>)
                  (indent-to indent-column))))))
      (<span style="font-weight: bold;">if</span> region-mode (exchange-point-and-mark))
      (indent-to ccol)
      <span style="font-weight: bold; font-style: italic;">;;</span><span style="font-weight: bold; font-style: italic;">VER2 (insert "\\end{" env "}\n")</span>
      (YaTeX-insert-struc 'end env)
      (YaTeX-reindent ccol)
      (<span style="font-weight: bold;">if</span> region-mode
          (<span style="font-weight: bold;">progn</span>
            (insert <span style="font-style: italic;">"\n"</span>)
            (<span style="font-weight: bold;">or</span> exchange (exchange-point-and-mark)))
        (goto-char beg2)
        (YaTeX-intelligent-newline nil)
        (YaTeX-indent-line))
      (YaTeX-package-auto-usepackage env 'env)
      (<span style="font-weight: bold;">if</span> YaTeX-current-position-register
          (point-to-register YaTeX-current-position-register))))

  (advice-add 'YaTeX-insert-begin-end
              <span style="font-weight: bold;">:override</span> #'ad:YaTeX-insert-begin-end))
</pre>
</div>
</div>
</div>

<div id="outline-container-org9b92b6f8" class="outline-3">
<h3 id="org9b92b6f8"><span class="section-number-3">5.36</span> [auxtex.el] AUCTEXでTex編集&#xa0;&#xa0;&#xa0;<span class="tag"><span class="tex">tex</span></span></h3>
<div class="outline-text-3" id="text-org9b92b6f8">
<p>
実践未投入です．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(autotex-latexmk)
       <span style="font-style: italic;">"autotex-latexmk"</span> nil t)

  (<span style="font-weight: bold;">push</span> '(<span style="font-style: italic;">"\\.tex$"</span> . autotex-latexmk) auto-mode-alist)

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"autotex-latexmk"</span>
    (<span style="font-weight: bold;">setq-default</span> TeX-master nil)
    (<span style="font-weight: bold;">setq</span> TeX-auto-save t)
    (<span style="font-weight: bold;">setq</span> TeX-parse-self t)
    (<span style="font-weight: bold;">setq</span> TeX-PDF-mode t)
    (auctex-latexmk-setup)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org2e5c6e4f" class="outline-3">
<h3 id="org2e5c6e4f"><span class="section-number-3">5.37</span> [yasnippet.el] Emacs用のテンプレートシステム</h3>
<div class="outline-text-3" id="text-org2e5c6e4f">
<p>
実は余り使いこなせていません&#x2026;
</p>

<ul class="org-ul">
<li><a href="https://github.com/capitaomorte/yasnippet">https://github.com/capitaomorte/yasnippet</a></li>
<li><a href="http://yasnippet-doc-jp.googlecode.com/svn/trunk/doc-jp/index.html">http://yasnippet-doc-jp.googlecode.com/svn/trunk/doc-jp/index.html</a></li>
<li><a href="http://d.hatena.ne.jp/IMAKADO/20080401/1206715770">http://d.hatena.ne.jp/IMAKADO/20080401/1206715770</a></li>
<li><a href="http://coderepos.org/share/browser/config/yasnippet">http://coderepos.org/share/browser/config/yasnippet</a></li>
<li><a href="https://github.com/RickMoynihan/yasnippet-org-mode">https://github.com/RickMoynihan/yasnippet-org-mode</a></li>
</ul>

<p>
<a href="http://orgmode.org/manual/Conflicts.html">Org-modeとの衝突を避ける</a>
</p>

<p>
↑のサイトで紹介されている回避策とは異なり，新たな <code>my-yas-expand</code> を作ることで，orgバッファのソースブロック中で <code>TAB</code> 押下してもエラーを受けないようにしました．ソースコードは <code>C-c '</code> で開く別バッファで編集します．
</p>

<p>
↑どうやら<a href="https://github.com/joaotavora/yasnippet/commit/0041efedf9f06bfe427d36547f7c4a73ab7405ba">本家で対応</a>がなされたようです． <code>my-yas-expand</code> なしで所望の動作になりました．ありがたや，ありがたや．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">late-init.el</span>
(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(yas-minor-mode yas-global-mode)
       <span style="font-style: italic;">"yasnippet"</span> nil t)

  (<span style="font-weight: bold;">dolist</span> (hook
           (list
            'perl-mode-hook 'c-mode-common-hook 'js2-mode-hook 'org-mode-hook
            'python-mode-hook 'emacs-lisp-mode-hook))
    (add-hook hook #'yas-minor-mode))

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"yasnippet"</span>
    (<span style="font-weight: bold;">setq</span> yas-verbosity 2)
    (<span style="font-weight: bold;">setq</span> yas-snippet-dirs `(,(concat (getenv <span style="font-style: italic;">"SYNCROOT"</span>) <span style="font-style: italic;">"/emacs.d/yas-dict"</span>)))
    (<span style="font-weight: bold;">unless</span> noninteractive
      (yas-global-mode 1))))
</pre>
</div>

<p>
以下は，本家できちんと対応されたので，不要になった．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"yasnippet"</span>
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-yas-expand-src-edit</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> field)
    <span style="font-style: italic;">"Override `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">yas-expand</span><span style="font-style: italic;">'. Kick `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">org-edit-special</span><span style="font-style: italic;">' directly in src-block."</span>
    (<span style="font-weight: bold;">interactive</span>)
    (<span style="font-weight: bold;">cond</span> ((<span style="font-weight: bold;">and</span> (equal major-mode 'org-mode)
                (org-in-src-block-p t))
           (org-edit-special))
          (t
           (yas-expand field))))

  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-yas-expand</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> field)
    <span style="font-style: italic;">"Disable `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">yas-expand</span><span style="font-style: italic;">' in src-block."</span>
    (<span style="font-weight: bold;">interactive</span>)
    (<span style="font-weight: bold;">cond</span> ((<span style="font-weight: bold;">and</span> (equal major-mode 'org-mode)
                (org-at-heading-p))
           (org-cycle))
          ((<span style="font-weight: bold;">and</span> (equal major-mode 'org-mode)
                (org-in-src-block-p t)
                (not (<span style="font-weight: bold;">and</span> (fboundp 'org-src-edit-buffer-p)
                          (org-src-edit-buffer-p))))
           (org-cycle))
          (t (yas-expand field))))
  (define-key yas-minor-mode-map (kbd <span style="font-style: italic;">"&lt;tab&gt;"</span>) 'my-yas-expand))
</pre>
</div>
</div>

<div id="outline-container-org8166015d" class="outline-4">
<h4 id="org8166015d"><span class="section-number-4">5.37.1</span> [ivy-yasnippet.el] yasnippet.el の ivy インターフェイス</h4>
<div class="outline-text-4" id="text-org8166015d">
<p>
<code>M-x ivy-yasnippet</code> でスニペットを絞り込めます．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"yasnippet"</span>
  (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">ivy-yasnippet</span> nil t))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgbea14b16" class="outline-3">
<h3 id="orgbea14b16"><span class="section-number-3">5.38</span> [osx-dictionary.el] macOSのdictionary.appで辞書をひく</h3>
<div class="outline-text-3" id="text-orgbea14b16">
<p>
<code>osx-dictionary</code> なるパッケージが存在します．さくさくと高速に動作します．なお， <code>C-M-w</code> は，本来，削除文字の連結(<code>append-next-kill</code>)にアサインされています．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(osx-dictionary-search-pointer osx-dictionary-search-input)
       <span style="font-style: italic;">"osx-dictionary"</span> nil t)

  (global-set-key (kbd <span style="font-style: italic;">"C-M-w"</span>) #'osx-dictionary-search-pointer)
  (global-set-key (kbd <span style="font-style: italic;">"C-c f w"</span>) #'osx-dictionary-search-input)

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"osx-dictionary"</span>
    (custom-set-variables
     '(osx-dictionary-dictionary-choice <span style="font-style: italic;">"&#33521;&#36766;&#37070; &#31532;&#19971;&#29256;"</span>))))
</pre>
</div>

<p>
COBUILD5をデフォルトで使うには，次のサイト参照してください．
</p>

<ul class="org-ul">
<li><a href="http://safx-dev.blogspot.jp/2012/02/collins-cobuld-5dictionaryapp.html">Collins COBULD 5をDictionary.appで利用できるようにする</a></li>
</ul>

<p>
私の場合は，できあがった辞書を <code>/Library/Dictionaries/</code> 以下に置いています．その状態で dictionary.app の設定で辞書の優先順位を変えることで，常にCOBUILD5の情報を引っ張り出せます．もしくは， <code>osx-dictionary-dictionary-choice</code> で辞書名を指定します．
</p>
</div>
</div>

<div id="outline-container-orgca044d69" class="outline-3">
<h3 id="orgca044d69"><span class="section-number-3">5.39</span> [describe-number.el] 16進数などを確認</h3>
<div class="outline-text-3" id="text-orgca044d69">
<p>
<code>describe-number.el</code> を使うと，16進数表示や文字コードを確認できます．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(autoload-if-found
 '(describe-number describe-number-at-point)
 <span style="font-style: italic;">"describe-number"</span> nil t)
</pre>
</div>
</div>
</div>

<div id="outline-container-org98d5c1aa" class="outline-3">
<h3 id="org98d5c1aa"><span class="section-number-3">5.40</span> [emmet-mode.el] zencoding の後継&#xa0;&#xa0;&#xa0;<span class="tag"><span class="web">web</span></span></h3>
<div class="outline-text-3" id="text-org98d5c1aa">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">yes</span>
(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(emmet-mode)
       <span style="font-style: italic;">"emmet-mode"</span> nil t nil)

  (<span style="font-weight: bold;">push</span> '(<span style="font-style: italic;">"\\.xml\\'"</span> . nxml-mode) auto-mode-alist)
  (<span style="font-weight: bold;">push</span> '(<span style="font-style: italic;">"\\.rdf\\'"</span> . nxml-mode) auto-mode-alist)
  (<span style="font-weight: bold;">dolist</span> (hook
           '(sgml-mode-hook
             nxml-mode-hook css-mode-hook html-mode-hook web-mode-hook))
    (add-hook hook #'emmet-mode))

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"emmet-mode"</span>
    (<span style="font-weight: bold;">setq</span> emmet-indentation 2)
    (<span style="font-weight: bold;">setq</span> emmet-move-cursor-between-quotes t)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc885e502" class="outline-3">
<h3 id="orgc885e502"><span class="section-number-3">5.41</span> [web-beautify.el] ソースコード整形&#xa0;&#xa0;&#xa0;<span class="tag"><span class="web">web</span></span></h3>
<div class="outline-text-3" id="text-orgc885e502">
<p>
ソースコードを読みやすい表示に整形します．バッファの自動時に自動で整形を実施するには， <code>after-save-hook</code> を使えばOKですね．
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">JavaScript</td>
<td class="org-left">M-x web-beautify-js</td>
</tr>

<tr>
<td class="org-left">HTML</td>
<td class="org-left">M-x web-beautify-html</td>
</tr>

<tr>
<td class="org-left">CSS</td>
<td class="org-left">M-x web-beautify-css</td>
</tr>
</tbody>
</table>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">if</span> (executable-find <span style="font-style: italic;">"js-beautify"</span>)
    (<span style="font-weight: bold;">when</span> (autoload-if-found
           '(js2-mode)
           <span style="font-style: italic;">"js2-mode"</span> nil t)

      (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"js2-mode"</span>
        (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">web-beautify</span> nil t)
          (define-key js2-mode-map (kbd <span style="font-style: italic;">"C-c b"</span>) 'web-beautify-js)
          (define-key js2-mode-map (kbd <span style="font-style: italic;">"C-c b"</span>) 'web-beautify-css))))

  (message <span style="font-style: italic;">"--- js-beautify is NOT installed."</span>)
  (message <span style="font-style: italic;">"--- Note: npm -g install js-beautify"</span>))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc3ce60f5" class="outline-3">
<h3 id="orgc3ce60f5"><span class="section-number-3">5.42</span> [smartparens.el] 対応するカッコの挿入をアシスト</h3>
<div class="outline-text-3" id="text-orgc3ce60f5">
<ul class="org-ul">
<li><a href="http://smartparens.readthedocs.io/">http://smartparens.readthedocs.io/</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(smartparens-global-mode turn-on-show-smartparens-mode)
       <span style="font-style: italic;">"smartparens"</span> nil t)

  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-smartparens-mode</span> ()
    (smartparens-global-mode)
    (remove-hook 'yatex-mode-hook #'my-smartparens-mode)
    (remove-hook 'org-mode-hook #'my-smartparens-mode))
  (add-hook 'yatex-mode-hook #'my-smartparens-mode)
  (add-hook 'org-mode-hook #'my-smartparens-mode)

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"smartparens"</span>
    (<span style="font-weight: bold;">setq-default</span> sp-highlight-pair-overlay nil)
    (<span style="font-weight: bold;">setq-default</span> sp-highlight-wrap-overlay nil)
    (<span style="font-weight: bold;">setq-default</span> sp-highlight-wrap-tag-overlay nil)
    (sp-local-pair 'org-mode <span style="font-style: italic;">"$"</span> <span style="font-style: italic;">"$"</span>)
    (sp-local-pair 'org-mode <span style="font-style: italic;">"~"</span> <span style="font-style: italic;">"~"</span>)
    (sp-local-pair 'org-mode <span style="font-style: italic;">"+"</span> <span style="font-style: italic;">"+"</span>)
    (sp-local-pair 'org-mode <span style="font-style: italic;">"="</span> <span style="font-style: italic;">"="</span>)
    (sp-local-pair 'org-mode <span style="font-style: italic;">"_"</span> <span style="font-style: italic;">"_"</span>)
    (sp-local-pair 'yatex-mode <span style="font-style: italic;">"$"</span> <span style="font-style: italic;">"$"</span>)
    (sp-pair <span style="font-style: italic;">"`"</span> nil <span style="font-weight: bold;">:actions</span> <span style="font-weight: bold;">:rem</span>)
    (sp-pair <span style="font-style: italic;">"'"</span> nil <span style="font-weight: bold;">:actions</span> <span style="font-weight: bold;">:rem</span>)
    (sp-pair <span style="font-style: italic;">"["</span> nil <span style="font-weight: bold;">:actions</span> <span style="font-weight: bold;">:rem</span>)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org69748b72" class="outline-3">
<h3 id="org69748b72"><span class="section-number-3">5.43</span> [replace-from-region.el] 選択領域を別の文字列に置き換える</h3>
<div class="outline-text-3" id="text-org69748b72">
<p>
通常の <code>query-replace</code> は，変更前と変更後の文字列を両方入力しますが， <code>query-replace-from-region</code> は，変更前の文字列を選択領域から自動抽出し，さらに同じ単語を変更後の文字列の候補として事前入力してくれます．したがって，文字列選択， <code>query-replace-from-region</code> 呼び出し，文字列を一部変更，実行，というフローになり簡略化されます．さらに， <code>selected.el</code> を使うことで，文字列選択後の <code>query-replace-from-region</code> 呼び出しは，シングルキーの押下で実現できます（私の場合は <code>5</code> の押下）．
</p>

<p>
文字列選択は， <code>C-M-SPC</code> で簡単にできるので，つまり， <code>C-M-SPC</code>, <code>5</code> , 文字列を一部変更，実行となり，通常の <code>query-replace</code> よりもタイプ量を圧倒的に減らせます．
</p>

<p>
<code>iedit.el</code> の方が好みの人が多いかもしれません．
</p>

<ul class="org-ul">
<li><a href="https://www.emacswiki.org/emacs/replace-from-region.el">https://www.emacswiki.org/emacs/replace-from-region.el</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(autoload-if-found
 '(query-replace-from-region query-replace-regexp-from-region)
 <span style="font-style: italic;">"replace-from-region"</span> nil t)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbc8501cf" class="outline-3">
<h3 id="orgbc8501cf"><span class="section-number-3">5.44</span> [selected.el] リージョン選択時のアクションを制御</h3>
<div class="outline-text-3" id="text-orgbc8501cf">
<p>
選択した後に右クリック的な感じでリージョンに対するアクションを制御できます．選択領域に対するスピードコマンドですね．普通にシングルキーを割り当てると，日本語IMEが有効な時に上手くいかないので， <code>activate-mark-hook</code> と <code>deactivate-mark-hook</code> に細工しています．
</p>

<ul class="org-ul">
<li><a href="https://github.com/Kungsgeten/selected.el">Kungsgeten/selected.el: Keymap for when region is active</a></li>
<li><a href="https://www.reddit.com/r/emacs/comments/4fxnss/selectedel_keymap_for_when_region_is_active/">selected.el - Keymap for when region is active : emacs</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(selected-global-mode my-helpful)
       <span style="font-style: italic;">"selected"</span> nil t)

  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-activate-selected</span> ()
    (selected-global-mode 1)
    (selected--on) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">must call expclitly here</span>
    (remove-hook 'activate-mark-hook #'my-activate-selected))
  (add-hook 'activate-mark-hook #'my-activate-selected)

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"selected"</span>
    (define-key selected-keymap (kbd <span style="font-style: italic;">";"</span>) #'comment-dwim)
    (define-key selected-keymap (kbd <span style="font-style: italic;">"e"</span>) #'my-eval-region)
    (define-key selected-keymap (kbd <span style="font-style: italic;">"E"</span>) #'my-eval-region-as-function)
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(define-key selected-keymap (kbd "=") #'count-words-region)</span>
    (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">helpful</span> nil t)
      (define-key selected-keymap (kbd <span style="font-style: italic;">"h"</span>) #'my-helpful)
      <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(define-key selected-keymap (kbd "f") #'my-helpful) ;; will be deleted</span>
      (define-key selected-keymap (kbd <span style="font-style: italic;">"v"</span>) #'my-helpful-variable))
    (define-key selected-keymap (kbd <span style="font-style: italic;">"w"</span>) #'osx-dictionary-search-pointer)
    (define-key selected-keymap (kbd <span style="font-style: italic;">"5"</span>) #'query-replace-from-region)
    (define-key selected-keymap (kbd <span style="font-style: italic;">"g"</span>) #'my-google-this)
    (define-key selected-keymap (kbd <span style="font-style: italic;">"s"</span>) #'osx-lib-say-region)
    (define-key selected-keymap (kbd <span style="font-style: italic;">"q"</span>) #'selected-off)
    (define-key selected-keymap (kbd <span style="font-style: italic;">"x"</span>) #'my-hex-to-decimal)
    (define-key selected-keymap (kbd <span style="font-style: italic;">"X"</span>) #'my-decimal-to-hex)

    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-helpful</span> ()
      (<span style="font-weight: bold;">interactive</span>)
      (<span style="font-weight: bold;">let</span> ((thing (symbol-at-point)))
        (<span style="font-weight: bold;">cond</span> ((functionp thing)
               (helpful-function thing))
              ((helpful--variable-p thing)
               (helpful-variable thing))
              ((macrop thing)
               (helpful-macro thing))
              ((symbolp thing)
               (helpful-symbol thing))
              (t
               (call-interactively 'helpful-function)))))

    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-helpful-variable</span> ()
      (<span style="font-weight: bold;">interactive</span>)
      (<span style="font-weight: bold;">let</span> ((thing (symbol-at-point)))
        (<span style="font-weight: bold;">if</span> (helpful--variable-p thing)
            (helpful-variable thing)
          (call-interactively 'helpful-variable))))

    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-eval-region</span> ()
      (<span style="font-weight: bold;">interactive</span>)
      (<span style="font-weight: bold;">when</span> (use-region-p)
        (<span style="font-weight: bold;">unless</span> (<span style="font-weight: bold;">ignore-errors</span> (eval-region (region-beginning) (region-end) t))
          (<span style="font-weight: bold;">let</span> ((region (intern (buffer-substring-no-properties
                                 (region-beginning) (region-end)))))
            (<span style="font-weight: bold;">when</span> (functionp region)
              (call-interactively region))))))

    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-eval-region-as-function</span> ()
      (<span style="font-weight: bold;">interactive</span>)
      (<span style="font-weight: bold;">when</span> (use-region-p)
        (<span style="font-weight: bold;">let</span> ((region (intern (buffer-substring-no-properties
                               (region-beginning) (region-end)))))
          (<span style="font-weight: bold;">when</span> (functionp region)
            (funcall region)))))
    (<span style="font-weight: bold;">setq</span> selected-org-mode-map (make-sparse-keymap))

    (define-key selected-org-mode-map (kbd <span style="font-style: italic;">"t"</span>) #'org-table-convert-region)
    (define-key selected-keymap (kbd <span style="font-style: italic;">"-"</span>) #'my-org-list-insert-items)
    (define-key selected-keymap (kbd <span style="font-style: italic;">"_"</span>)
      #'my-org-list-insert-checkbox-into-items)

    (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">expand-region</span> nil t)
      (define-key selected-keymap (kbd <span style="font-style: italic;">"SPC"</span>) #'er/expand-region))

    (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">counsel-selected</span> nil t)
      (define-key selected-keymap (kbd <span style="font-style: italic;">"l"</span>) 'counsel-selected))

    (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">help-fns+</span> nil t)
      (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-describe-selected-keymap</span> ()
        (<span style="font-weight: bold;">interactive</span>)
        (describe-keymap 'selected-keymap))
      (define-key selected-keymap (kbd <span style="font-style: italic;">"H"</span>) #'my-describe-selected-keymap))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org98897862" class="outline-3">
<h3 id="org98897862"><span class="section-number-3">5.45</span> [helm-selected.el] selecte.el のアクション候補を絞り込み</h3>
<div class="outline-text-3" id="text-org98897862">
<ul class="org-ul">
<li><a href="https://qiita.com/takaxp/items/00245794d46c3a5fcaa8">記事</a>にしました．</li>
<li><a href="https://github.com/takaxp/counsel-selected">counsel-selected</a> に移行しました．</li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"selected"</span>
  (<span style="font-weight: bold;">when</span> (autoload-if-found '(helm-selected) <span style="font-style: italic;">"helm-selected"</span> nil t)
    (define-key selected-keymap (kbd <span style="font-style: italic;">"h"</span>) 'helm-selected)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgeafa82dd" class="outline-3">
<h3 id="orgeafa82dd"><span class="section-number-3">5.46</span> [counsel-selected.el] 続・selected.el のアクション候補絞り込み</h3>
<div class="outline-text-3" id="text-orgeafa82dd">
<p>
<code>ivy</code> でも絞り込めるように拡張を作りました．
</p>

<ul class="org-ul">
<li><a href="https://github.com/takaxp/counsel-selected">https://github.com/takaxp/counsel-selected</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"selected"</span>
  (<span style="font-weight: bold;">when</span> (autoload-if-found '(counsel-selected) <span style="font-style: italic;">"counsel-selected"</span> nil t)
    (define-key selected-keymap (kbd <span style="font-style: italic;">"l"</span>) 'counsel-selected)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org9e3510c2" class="outline-3">
<h3 id="org9e3510c2"><span class="section-number-3">5.47</span> <span class="todo TODO">TODO</span> [multiple-cursors.el] 指定箇所を同時編集</h3>
<div class="outline-text-3" id="text-org9e3510c2">
<ul class="org-ul">
<li><a href="http://emacsrocks.com/e08.html">http://emacsrocks.com/e08.html</a></li>
<li><a href="https://github.com/magnars/multiple-cursors.el">magnars/multiple-cursors.el: Multiple cursors for emacs.</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(mc/num-cursors
         mc/edit-lines
         hydra-multi-cursors/body)
       <span style="font-style: italic;">"multiple-cursors"</span> nil t)

  (global-set-key (kbd <span style="font-style: italic;">"C-c h m"</span>) #'hydra-multi-cursors/body)

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"multiple-cursors"</span>
    (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">hydra</span> nil t)
      <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">see https://github.com/abo-abo/hydra/wiki/multiple-cursors</span>
      (<span style="font-weight: bold;">defhydra</span> hydra-multi-cursors (<span style="font-weight: bold;">:hint</span> nil)
        <span style="font-style: italic;">"</span>
<span style="font-style: italic;">==================================================================</span>
<span style="font-style: italic;"> Up^^             Down^^           Miscellaneous           % 2(mc/num-cursors) cursor%s(if (&gt; (mc/num-cursors) 1) \"s\" \"\")</span>
<span style="font-style: italic;">------------------------------------------------------------------</span>
<span style="font-style: italic;"> [_p_]   Next     [_n_]   Next     [_l_] Edit lines  [_0_] Insert numbers</span>
<span style="font-style: italic;"> [_P_]   Skip     [_N_]   Skip     [_a_] Mark all    [_A_] Insert letters</span>
<span style="font-style: italic;"> [_M-p_] Unmark   [_M-n_] Unmark   [_s_] Search</span>
<span style="font-style: italic;"> [Click] Cursor at point       [_q_] Quit"</span>
        (<span style="font-style: italic;">"l"</span> mc/edit-lines) <span style="font-weight: bold; font-style: italic;">;;  </span><span style="font-weight: bold; font-style: italic;">:exit t</span>
        (<span style="font-style: italic;">"a"</span> mc/mark-all-like-this) <span style="font-weight: bold; font-style: italic;">;;  </span><span style="font-weight: bold; font-style: italic;">:exit t</span>
        (<span style="font-style: italic;">"n"</span> mc/mark-next-like-this)
        (<span style="font-style: italic;">"N"</span> mc/skip-to-next-like-this)
        (<span style="font-style: italic;">"M-n"</span> mc/unmark-next-like-this)
        (<span style="font-style: italic;">"p"</span> mc/mark-previous-like-this)
        (<span style="font-style: italic;">"P"</span> mc/skip-to-previous-like-this)
        (<span style="font-style: italic;">"M-p"</span> mc/unmark-previous-like-this)
        (<span style="font-style: italic;">"s"</span> mc/mark-all-in-region-regexp) <span style="font-weight: bold; font-style: italic;">;;  </span><span style="font-weight: bold; font-style: italic;">:exit t</span>
        (<span style="font-style: italic;">"0"</span> mc/insert-numbers) <span style="font-weight: bold; font-style: italic;">;;  </span><span style="font-weight: bold; font-style: italic;">:exit t</span>
        (<span style="font-style: italic;">"A"</span> mc/insert-letters) <span style="font-weight: bold; font-style: italic;">;;  </span><span style="font-weight: bold; font-style: italic;">:exit t</span>
        (<span style="font-style: italic;">"&lt;mouse-1&gt;"</span> mc/add-cursor-on-click)
        <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Help with click recognition in this hydra</span>
        (<span style="font-style: italic;">"&lt;down-mouse-1&gt;"</span> ignore)
        (<span style="font-style: italic;">"&lt;drag-mouse-1&gt;"</span> ignore)
        (<span style="font-style: italic;">"q"</span> nil)))))
</pre>
</div>
</div>
</div>

<div id="outline-container-orge18cb840" class="outline-3">
<h3 id="orge18cb840"><span class="section-number-3">5.48</span> <span class="todo TODO">TODO</span> [isolate.el] ブラケット等の入力をアシスト</h3>
<div class="outline-text-3" id="text-orge18cb840">
<ul class="org-ul">
<li><a href="https://github.com/casouri/isolate">casouri/isolate: Surrounding magics, extensible</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">late-init.el</span>
(autoload-if-found
 '(isolate-quick-add
   isolate-long-add isolate-quick-delete
   isolate-quick-chnge isolate-long-change)
 <span style="font-style: italic;">"isolate"</span> nil t)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc6f37d6d" class="outline-3">
<h3 id="orgc6f37d6d"><span class="section-number-3">5.49</span> <span class="todo TODO">TODO</span> [git-complete.el] GIT grep を使う補完エンジン</h3>
<div class="outline-text-3" id="text-orgc6f37d6d">
<ul class="org-ul">
<li><a href="https://github.com/zk-phi/git-complete">zk-phi/git-complete: {Emacs} Yet another completion engine powered by "git grep"</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(git-complete)
       <span style="font-style: italic;">"git-complete"</span> nil t)

  (global-set-key (kbd <span style="font-style: italic;">"C-c f &lt;tab&gt;"</span>) 'git-complete))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgab8a7bee" class="outline-3">
<h3 id="orgab8a7bee"><span class="section-number-3">5.50</span> <span class="todo TODO">TODO</span> [tiny.el] 連番入力をサポート</h3>
<div class="outline-text-3" id="text-orgab8a7bee">
<ul class="org-ul">
<li><a href="https://github.com/abo-abo/tiny">abo-abo/tiny: Quickly generate linear ranges in Emacs</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">tiny</span> nil t)
  (tiny-setup-default))
</pre>
</div>
</div>
</div>

<div id="outline-container-org12a087af" class="outline-3">
<h3 id="org12a087af"><span class="section-number-3">5.51</span> <span class="todo TODO">TODO</span> [bratex.el] LaTeX 数式のブラケット入力をサポート</h3>
<div class="outline-text-3" id="text-org12a087af">
<ul class="org-ul">
<li><a href="https://github.com/sbrisard/bratex">sbrisard/bratex: Emacs package for manipulation of brackets in LaTeX mode</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(bratex-config)
       <span style="font-style: italic;">"bratex"</span> nil t)

  (add-hook 'yatex-mode-hook #'bratex-config))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb3d87116" class="outline-3">
<h3 id="orgb3d87116"><span class="section-number-3">5.52</span> <span class="done DONE">DONE</span> [iedit.el] バッファ内の同じ文字列を一度に編集する&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></h3>
<div class="outline-text-3" id="text-orgb3d87116">
<p>
<code>replace-from-region.el</code> を <code>selected.el</code> で呼び出すので満足しています．表示色の点では， <code>highlight-symbol.el</code> があるので，今からどれが編集されるのかもわかりやすいです．
</p>

<p>
<a href="http://emacswiki.org/emacs/iedit.el">iedit.el</a> を使うと，バッファ内の同じ文字列を一度に編集することができる．部分重複のない変数名を置き換えるときに有用な場合がある．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">iedit</span> nil t)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf18160de" class="outline-3">
<h3 id="orgf18160de"><span class="section-number-3">5.53</span> <span class="done DONE">DONE</span> [lookup.el] 辞書&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></h3>
<div class="outline-text-3" id="text-orgf18160de">
<p>
最近使っていません．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">.lookup/cache.el</span>
(<span style="font-weight: bold;">setq</span> lookup-init-directory <span style="font-style: italic;">"~/env/dot_files/.lookup"</span>)

(autoload 'lookup <span style="font-style: italic;">"lookup"</span> nil t)
(autoload 'lookup-region <span style="font-style: italic;">"lookup"</span> nil t)
(autoload 'lookup-word <span style="font-style: italic;">"lookup"</span> nil t)
(autoload 'lookup-select-dictionaries <span style="font-style: italic;">"lookup"</span> nil t)

(<span style="font-weight: bold;">setq</span> lookup-search-modules
      '((<span style="font-style: italic;">"default"</span>
         (<span style="font-style: italic;">"ndeb:/Users/taka/Dropbox/Dic/COBUILD5/cobuild"</span> <span style="font-weight: bold;">:priority</span> t)
         (<span style="font-style: italic;">"ndeb:/Users/taka/Dropbox/Dic/COBUILD5/wordbank"</span> <span style="font-weight: bold;">:priority</span> t)
         (<span style="font-style: italic;">"ndeb:/Users/taka/Dropbox/Dic/LDOCE4/ldoce4"</span> <span style="font-weight: bold;">:priority</span> t)
         (<span style="font-style: italic;">"ndeb:/Users/taka/Dropbox/Dic/LDOCE4/bank"</span> <span style="font-weight: bold;">:priority</span> t)
         (<span style="font-style: italic;">"ndeb:/Users/taka/Dropbox/Dic/LDOCE4/colloc"</span> <span style="font-weight: bold;">:priority</span> t)
         (<span style="font-style: italic;">"ndeb:/Users/taka/Dropbox/Dic/LDOCE4/activ"</span> <span style="font-weight: bold;">:priority</span> t))))

(<span style="font-weight: bold;">setq</span> lookup-agent-attributes
      '((<span style="font-style: italic;">"ndeb:/Users/taka/Dropbox/Dic/COBUILD5"</span>
         (dictionaries <span style="font-style: italic;">"cobuild"</span> <span style="font-style: italic;">"wordbank"</span>))
        (<span style="font-style: italic;">"ndeb:/Users/taka/Dropbox/Dic/LDOCE4"</span>
         (dictionaries <span style="font-style: italic;">"ldoce4"</span> <span style="font-style: italic;">"bank"</span> <span style="font-style: italic;">"colloc"</span> <span style="font-style: italic;">"activ"</span>))))

(<span style="font-weight: bold;">setq</span> lookup-dictionary-attributes
      '((<span style="font-style: italic;">"ndeb:/Users/taka/Dropbox/Dic/COBUILD5/cobuild"</span>
         (title . <span style="font-style: italic;">"COBUILD 5th Edition"</span>)
         (methods exact prefix))
        (<span style="font-style: italic;">"ndeb:/Users/taka/Dropbox/Dic/COBUILD5/wordbank"</span>
         (title . <span style="font-style: italic;">"Wordbank"</span>)
         (methods))
        (<span style="font-style: italic;">"ndeb:/Users/taka/Dropbox/Dic/LDOCE4/ldoce4"</span>
         (title . <span style="font-style: italic;">"Longman 4th Edition"</span>)
         (methods exact prefix))
        (<span style="font-style: italic;">"ndeb:/Users/taka/Dropbox/Dic/LDOCE4/bank"</span>
         (title . <span style="font-style: italic;">"LDOCE4 Examples and Phrases"</span>)
         (methods exact prefix menu))
        (<span style="font-style: italic;">"ndeb:/Users/taka/Dropbox/Dic/LDOCE4/colloc"</span>
         (title . <span style="font-style: italic;">"LDOCE4 Collocation"</span>)
         (methods exact prefix))
        (<span style="font-style: italic;">"ndeb:/Users/taka/Dropbox/Dic/LDOCE4/activ"</span>
         (title . <span style="font-style: italic;">"Longman Activator"</span>)
         (methods exact prefix menu))))

(<span style="font-weight: bold;">setq</span> lookup-default-dictionary-options
      '((<span style="font-weight: bold;">:stemmer</span> .  stem-english)))
(<span style="font-weight: bold;">setq</span> lookup-use-kakasi nil)
(global-set-key (kbd <span style="font-style: italic;">"&lt;f6&gt;"</span>) 'lookup-word)

<span style="font-weight: bold; font-style: italic;">;;; </span><span style="font-weight: bold; font-style: italic;">lookup for dictionary (require EB Library, eblook, and lookup.el)</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">package download: http://sourceforge.net/projects/lookup</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">http://lookup.sourceforge.net/docs/ja/index.shtml#Top</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">http://www.bookshelf.jp/texi/lookup/lookup-guide.html#SEC_Top</span>
<span style="font-weight: bold; font-style: italic;">;;</span><span style="font-weight: bold; font-style: italic;">(load "lookup-autoloads") ; for 1.99</span>
<span style="font-weight: bold; font-style: italic;">;;</span><span style="font-weight: bold; font-style: italic;">(autoload 'lookup "lookup" nil t)</span>
<span style="font-weight: bold; font-style: italic;">;;</span><span style="font-weight: bold; font-style: italic;">(autoload 'lookup-region "lookup" nil t)</span>
<span style="font-weight: bold; font-style: italic;">;;</span><span style="font-weight: bold; font-style: italic;">(autoload 'lookup-word "lookup" nil t)</span>
<span style="font-weight: bold; font-style: italic;">;;</span><span style="font-weight: bold; font-style: italic;">(autoload 'lookup-select-dictionaries "lookup" nil t)</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Search Agents</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">ndeb option requries "eblook" command</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Use expand-file-name!</span>
<span style="font-weight: bold; font-style: italic;">;;</span><span style="font-weight: bold; font-style: italic;">(setq lookup-search-agents `((ndeb ,(concat homedir "/Dropbox/Dic/COBUILD5"))</span>
<span style="font-weight: bold; font-style: italic;">;;                            </span><span style="font-weight: bold; font-style: italic;">(ndeb ,(concat homedir "/Dropbox/Dic/LDOCE4"))))</span>
<span style="font-weight: bold; font-style: italic;">;;</span><span style="font-weight: bold; font-style: italic;">(setq lookup-use-bitmap nil)</span>
<span style="font-weight: bold; font-style: italic;">;;</span><span style="font-weight: bold; font-style: italic;">(setq ndeb-program-name "/usr/bin/eblook")</span>
<span style="font-weight: bold; font-style: italic;">;;</span><span style="font-weight: bold; font-style: italic;">(when (eq window-system 'ns)</span>
<span style="font-weight: bold; font-style: italic;">;;  </span><span style="font-weight: bold; font-style: italic;">(setq ndeb-program-name "/opt/local/bin/eblook")</span>
<span style="font-weight: bold; font-style: italic;">;;  </span><span style="font-weight: bold; font-style: italic;">(setq ndeb-program-arguments '("-q" "-e" "euc-jp"))</span>
<span style="font-weight: bold; font-style: italic;">;;  </span><span style="font-weight: bold; font-style: italic;">(setq ndeb-process-coding-system 'utf-8)) ; utf-8-hfs</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org903987d3" class="outline-3">
<h3 id="org903987d3"><span class="section-number-3">5.54</span> <span class="done DONE">DONE</span> [cacoo] Cacoo で描く&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></h3>
<div class="outline-text-3" id="text-org903987d3">
<p>
画像をリサイズしてバッファに表示する用途にも使える．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(toggle-cacoo-minor-mode)
       <span style="font-style: italic;">"cacoo"</span> nil t)

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"cacoo"</span>
    (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">cacoo-plugins</span>))

  (global-set-key (kbd <span style="font-style: italic;">"M--"</span>) 'toggle-cacoo-minor-mode))
</pre>
</div>
</div>
</div>

<div id="outline-container-org56cbbb36" class="outline-3">
<h3 id="org56cbbb36"><span class="section-number-3">5.55</span> <span class="done DONE">DONE</span> [zencoding-mode] HTML編集の高速化&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></h3>
<div class="outline-text-3" id="text-org56cbbb36">
<p>
zencoding でタグ打ちを効率化します．今は emmet-mode を使います．
</p>

<ul class="org-ul">
<li><a href="http://www.emacswiki.org/emacs/ZenCoding">http://www.emacswiki.org/emacs/ZenCoding</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(zencoding-mode zencoding-expand-line)
       <span style="font-style: italic;">"zencoding-mode"</span> <span style="font-style: italic;">"Zen-coding"</span> t)

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"zencoding-mode"</span>
    (define-key zencoding-mode-keymap
      (kbd <span style="font-style: italic;">"M-&lt;return&gt;"</span>) 'zencoding-expand-line))

  (add-hook 'sgml-mode-hook #'zencoding-mode)
  (add-hook 'html-mode-hook #'zencoding-mode)
  (add-hook 'web-mode-hook #'zencoding-mode))
</pre>
</div>
</div>
</div>

<div id="outline-container-org7e84aa55" class="outline-3">
<h3 id="org7e84aa55"><span class="section-number-3">5.56</span> <span class="done DONE">DONE</span> [sdic.el] 英辞郎で英単語を調べる&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></h3>
<div class="outline-text-3" id="text-org7e84aa55">
<ul class="org-ul">
<li>osx-directory.el に移行しました．</li>
</ul>

<p>
<a href="http://www.namazu.org/~tsuchiya/sdic/index.html">http://www.namazu.org/~tsuchiya/sdic/index.html</a>
</p>

<p>
Emacs から辞書を使う．lookup を使う方法もあるが，Emacsから使うのは英辞郎に限定．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(sdic-describe-word sdic-describe-word-at-point)
       <span style="font-style: italic;">"sdic"</span> nil t)

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"sdic"</span>
    (<span style="font-weight: bold;">setq</span> sdic-face-color <span style="font-style: italic;">"#3333FF"</span>)
    (<span style="font-weight: bold;">setq</span> sdic-default-coding-system 'utf-8)
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Dictionary (English =&gt; Japanese)</span>
    (<span style="font-weight: bold;">setq</span> sdic-eiwa-dictionary-list
          '((sdicf-client <span style="font-style: italic;">"~/Dropbox/Dic/EIJIRO6/EIJI-128.sdic"</span>)))
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Dictionary (Japanese =&gt; English)</span>
    (<span style="font-weight: bold;">setq</span> sdic-waei-dictionary-list
          '((sdicf-client <span style="font-style: italic;">"~/Dropbox/Dic/EIJIRO6/WAEI-128.sdic"</span>))))

  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#12459;&#12540;&#12477;&#12523;&#12398;&#20301;&#32622;&#12398;&#33521;&#21336;&#35486;&#12398;&#24847;&#21619;&#12434;&#35519;&#12409;&#12427;</span>
  (global-set-key (kbd <span style="font-style: italic;">"C-M-w"</span>) 'sdic-describe-word-at-point)
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#12511;&#12491;&#12496;&#12483;&#12501;&#12449;&#12395;&#33521;&#21336;&#35486;&#12434;&#20837;&#12428;&#12390;&#33521;&#36766;&#37070;&#12434;&#20351;&#12358;</span>
  (global-set-key (kbd <span style="font-style: italic;">"C-c w"</span>) 'sdic-describe-word))
</pre>
</div>
</div>
</div>

<div id="outline-container-org52c2a77d" class="outline-3">
<h3 id="org52c2a77d"><span class="section-number-3">5.57</span> <span class="done DONE">DONE</span> [dictionary.app] macOSのdictionary.appでCOBUILD5をひく&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></h3>
<div class="outline-text-3" id="text-org52c2a77d">
<p>
OS標準の辞書アプリ（dictionary.app）を経由して，バッファにCOBUILD5のデータを流し込むことができます．
</p>

<ul class="org-ul">
<li><a href="http://sakito.jp/mac/dictionary.html#emacs">辞書(Dictionary).appを使い倒そう</a></li>
</ul>

<p>
以下の関数を準備します．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">dictionary</span> ()
  <span style="font-style: italic;">"dictionary.app"</span>
  (<span style="font-weight: bold;">interactive</span>)

  (<span style="font-weight: bold;">let</span> ((editable (not buffer-read-only))
        (pt (<span style="font-weight: bold;">save-excursion</span> (mouse-set-point last-nonmenu-event)))
        beg end)

    (<span style="font-weight: bold;">if</span> (<span style="font-weight: bold;">and</span> mark-active
             (&lt;= (region-beginning) pt) (&lt;= pt (region-end)) )
        (<span style="font-weight: bold;">setq</span> beg (region-beginning)
              end (region-end))
      (<span style="font-weight: bold;">save-excursion</span>
        (goto-char pt)
        (<span style="font-weight: bold;">setq</span> end (<span style="font-weight: bold;">progn</span> (forward-word) (point)))
        (<span style="font-weight: bold;">setq</span> beg (<span style="font-weight: bold;">progn</span> (backward-word) (point)))
        ))

    (<span style="font-weight: bold;">let</span> ((word (buffer-substring-no-properties beg end))
          <span style="font-weight: bold; font-style: italic;">;;            </span><span style="font-weight: bold; font-style: italic;">(win (selected-window))</span>
          (tmpbuf <span style="font-style: italic;">" * dict-process*"</span>))
      (pop-to-buffer tmpbuf)
      (erase-buffer)
      (insert <span style="font-style: italic;">"Query: "</span> word <span style="font-style: italic;">"\n\n"</span>)
      (start-process <span style="font-style: italic;">"dict-process"</span> tmpbuf <span style="font-style: italic;">"dict.py"</span> word)
      (goto-char 0)
      <span style="font-weight: bold; font-style: italic;">;;        </span><span style="font-weight: bold; font-style: italic;">(select-window win)</span>
      )))
</pre>
</div>

<p>
これでカーソル以下の単語の情報が別ウィンドウに出ます．チェックし終わったら <code>C-x 1</code> (delete-other-windows) で表示を閉じます． <code>q</code> で閉じられるようにしたり，ツールチップで表示したりもできるはずです．
</p>

<p>
マスタカさんのナイスソリューションをまだ試していないので，こちらの方がエレガントかもしれません．
</p>

<ul class="org-ul">
<li><a href="http://masutaka.net/chalow/2011-05-18-1.html">Emacs で Mac の辞書を sdic っぽく使う </a></li>
<li><a href="http://masutaka.net/chalow/2012-09-17-1.html">EmacsからMacの辞書をお手軽に使う</a></li>
</ul>

<p>
なお，COBUILD5の辞書データをdictionary.appで引けるようにするには以下の操作が必要です．
</p>

<ul class="org-ul">
<li><a href="http://safx-dev.blogspot.jp/2012/02/collins-cobuld-5dictionaryapp.html">Collins COBULD 5をDictionary.appで利用できるようにする</a></li>
</ul>

<p>
私の場合は，できあがった辞書を <code>/Library/Dictionaries/</code> 以下に置いています．その状態で dictionary.app の設定で辞書の優先順位を変えることで，常にCOBUILD5の情報を引っ張り出せます．
</p>
</div>

<div id="outline-container-org34b20ea7" class="outline-4">
<h4 id="org34b20ea7"><span class="section-number-4">5.57.1</span> マイナーモード化</h4>
<div class="outline-text-4" id="text-org34b20ea7">
<p>
<code>q</code> で閉じたくなったのでマイナーモードを作りました．これまで通り， <code>C-M-w</code> でカーソル下の単語を調べてポップアップで表示．カーソルはその新しいバッファに移しておき， <code>q</code> で閉じられます．新しいバッファ内で別な単語を <code>C-M-w</code> で調べると，同じバッファに結果を再描画します．
</p>

<p>
マイナーモード化した elisp は，<a href="https://gist.github.com/takaxp/9786376">gist</a>で公開しています．
</p>
</div>
</div>

<div id="outline-container-org34f10f81" class="outline-4">
<h4 id="org34f10f81"><span class="section-number-4">5.57.2</span> キーバインド</h4>
<div class="outline-text-4" id="text-org34f10f81">
<p>
マイナーモード化した dict-app を使う場合は以下のようにします．sdic を使っている人は，sdic 用の設定と衝突しないように気をつけます．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(dict-app-search)
       <span style="font-style: italic;">"dict-app"</span> nil t)

  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#12459;&#12540;&#12477;&#12523;&#12398;&#20301;&#32622;&#12398;&#33521;&#21336;&#35486;&#12398;&#24847;&#21619;&#12434;&#35519;&#12409;&#12427;</span>
  (global-set-key (kbd <span style="font-style: italic;">"C-M-w"</span>) 'dict-app-search))
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-org94c7bd73" class="outline-2">
<h2 id="org94c7bd73"><span class="section-number-2">6</span> 表示サポート</h2>
<div class="outline-text-2" id="text-org94c7bd73">
</div>
<div id="outline-container-orgf6a240ab" class="outline-3">
<h3 id="orgf6a240ab"><span class="section-number-3">6.1</span> キーコマンド入力中に入力過程をミニバッファに反映する</h3>
<div class="outline-text-3" id="text-orgf6a240ab">
<p>
標準値は <code>1</code> です．例えば， <code>C-c f r</code> で発動する関数があるとき， <code>C-c</code> を入力するとその直後にはミニバッファに何も表示されませんが， <code>echo-keystrokes</code> だけ経過すると， <code>C-c</code> が表示されます． <code>0</code> に設定すると，いくら経過しても何も表示しません． <code>which-key.el</code> の設定で表示を <code>1.0</code> にすると，時系列的に， <code>0.5</code> 秒でキー入力の状態を表示し， <code>1.0</code> 秒で続くキーで入力可能なコマンドがリストアップ表示されます．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setq</span> echo-keystrokes 0.5)
</pre>
</div>
</div>
</div>

<div id="outline-container-org581a32ab" class="outline-3">
<h3 id="org581a32ab"><span class="section-number-3">6.2</span> <span class="todo TODO">TODO</span> モードラインの色をナローイングで変える</h3>
<div class="outline-text-3" id="text-org581a32ab">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my-narrow-modeline</span> '(<span style="font-style: italic;">"#426EBB"</span> <span style="font-style: italic;">"#FFFFFF"</span>))
(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my-selected-window-last</span> nil)
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-update-modeline-face</span> ()
  (<span style="font-weight: bold;">setq</span> my-selected-window-last (frame-selected-window))
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(message "--- %s" my-selected-window-last)</span>
  (<span style="font-weight: bold;">unless</span> (minibufferp)
    (my-modeline-face (buffer-narrowed-p))))
(add-hook 'buffer-list-update-hook #'my-update-modeline-face)

(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my-buffer-narrowed-last</span> nil)
(make-local-variable 'my-buffer-narrowed-last)
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-modeline-face</span> (buffer-narrowed)
  <span style="font-style: italic;">"Update modeline color.</span>
<span style="font-style: italic;">If BUFFER-NARROWED is nil, then change the color to indicating `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">widen</span><span style="font-style: italic;">'.</span>
<span style="font-style: italic;">Otherwise, indicating narrowing."</span>
  (<span style="font-weight: bold;">unless</span> (eq my-buffer-narrowed-last
              buffer-narrowed) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">block unnecessary request</span>
    (<span style="font-weight: bold;">setq</span> my-buffer-narrowed-last buffer-narrowed)
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(message "--- %s %s %s" this-command last-command buffer-narrowed)</span>
    (<span style="font-weight: bold;">when</span> (not (memq this-command '(save-buffer))) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">FIXME</span>
      (<span style="font-weight: bold;">if</span> buffer-narrowed
          (custom-set-faces
           `(mode-line ((t (<span style="font-weight: bold;">:background</span>
                            ,(nth 0 my-narrow-modeline)
                            <span style="font-weight: bold;">:foreground</span>
                            ,(nth 1 my-narrow-modeline))))))
        (custom-set-faces '(mode-line ((t nil))))))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-update-modeline-color</span> ()
  <span style="font-style: italic;">"Update modeline face of the current selected window.</span>
<span style="font-style: italic;">Call this function at updating `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">mode-line-mode</span><span style="font-style: italic;">'."</span>
  (<span style="font-weight: bold;">when</span> (eq my-selected-window-last (frame-selected-window))
    (my-modeline-face (buffer-narrowed-p))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org3368625d" class="outline-3">
<h3 id="org3368625d"><span class="section-number-3">6.3</span> <span class="todo TODO">TODO</span> モードラインのNarrowを短くする</h3>
<div class="outline-text-3" id="text-org3368625d">
<p>
標準では「Narrow」と表示されますが，「N」に短縮します． <code>all-the-icons</code> を使って，画像に置き換えることも可能です．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setq</span> mode-line-modes
      (mapcar
       (<span style="font-weight: bold;">lambda</span> (entry)
         (<span style="font-weight: bold;">if</span> (equal entry <span style="font-style: italic;">"%n"</span>)
             '(<span style="font-weight: bold;">:eval</span> (<span style="font-weight: bold;">progn</span>
                       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">org &#12364; widen &#12434;&#20081;&#30330;&#12377;&#12427;&#12398;&#12391;&#12371;&#12385;&#12425;&#12434;&#12488;&#12522;&#12460;&#12540;&#12395;&#12377;&#12427;&#65294;</span>
                       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#33394;&#12398;&#22793;&#26356;</span>
                       (my-update-modeline-color)
                       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">"Narrow" &#12434; "N" &#12395;&#30701;&#32302;&#34920;&#31034;</span>
                       (<span style="font-weight: bold;">if</span> (buffer-narrowed-p)
                           (concat <span style="font-style: italic;">" "</span>
                                   (all-the-icons-octicon <span style="font-style: italic;">"fold"</span> <span style="font-weight: bold;">:v-adjust</span> 0.0))
                         <span style="font-style: italic;">""</span>)
                       ))
           entry))
       mode-line-modes))
</pre>
</div>
</div>
</div>

<div id="outline-container-org5fd3a668" class="outline-3">
<h3 id="org5fd3a668"><span class="section-number-3">6.4</span> モードラインの節約（VC-mode編）</h3>
<div class="outline-text-3" id="text-org5fd3a668">
<p>
定形で表示されている <code>Git</code> を消します．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"vc-hooks"</span>
  (setcdr (assq 'vc-mode mode-line-format)
          '((<span style="font-weight: bold;">:eval</span> (replace-regexp-in-string <span style="font-style: italic;">"^ Git"</span> <span style="font-style: italic;">" "</span> vc-mode)))))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb577af83" class="outline-3">
<h3 id="orgb577af83"><span class="section-number-3">6.5</span> モードラインの色をカスタマイズする</h3>
<div class="outline-text-3" id="text-orgb577af83">
<p>
配色は定期的に変えています．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">mode-line</span>
(set-face-attribute 'mode-line nil
                    <span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#FFFFFF"</span>
                    <span style="font-weight: bold;">:background</span> <span style="font-style: italic;">"#a46398"</span>
                    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">:overline "#9d5446"</span>
                    <span style="font-weight: bold;">:box</span> nil)
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">mode-line-inactive</span>
(set-face-attribute 'mode-line-inactive nil
                    <span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#FFFFFF"</span>
                    <span style="font-weight: bold;">:background</span> <span style="font-style: italic;">"#c8a1b7"</span>
                    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">:overline "#FFFFFF"</span>
                    <span style="font-weight: bold;">:box</span> nil)
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Terminal</span>
(<span style="font-weight: bold;">unless</span> (display-graphic-p)
  (set-face-foreground 'mode-line <span style="font-style: italic;">"#96CBFE"</span>)
  (set-face-background 'mode-line <span style="font-style: italic;">"#21252B"</span>))
</pre>
</div>
</div>

<div id="outline-container-org21b30e75" class="outline-4">
<h4 id="org21b30e75"><span class="section-number-4">6.5.1</span> 色セット例</h4>
<div class="outline-text-4" id="text-org21b30e75">
<ul class="org-ul">
<li>青／白</li>
</ul>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">background</td>
<td class="org-left">foreground</td>
<td class="org-left">overline</td>
</tr>

<tr>
<td class="org-left">active</td>
<td class="org-left">558BE2</td>
<td class="org-left">FFFFFF</td>
<td class="org-left">566f99</td>
</tr>

<tr>
<td class="org-left">inactive</td>
<td class="org-left">94bbf9</td>
<td class="org-left">EFEFEF</td>
<td class="org-left">a4bfea</td>
</tr>
</tbody>
</table>

<ul class="org-ul">
<li>青</li>
</ul>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">background</td>
<td class="org-left">foreground</td>
<td class="org-left">overline</td>
</tr>

<tr>
<td class="org-left">active</td>
<td class="org-left">b2cefb</td>
<td class="org-left">203e6f</td>
<td class="org-left">203e6f</td>
</tr>

<tr>
<td class="org-left">inactive</td>
<td class="org-left">94bbf9</td>
<td class="org-left">94bbf9</td>
<td class="org-left">94bbf9</td>
</tr>
</tbody>
</table>

<ul class="org-ul">
<li>緑</li>
</ul>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">background</td>
<td class="org-left">foreground</td>
<td class="org-left">overline</td>
</tr>

<tr>
<td class="org-left">active</td>
<td class="org-left">b1fbd6</td>
<td class="org-left">206f47</td>
<td class="org-left">206f47</td>
</tr>

<tr>
<td class="org-left">inactive</td>
<td class="org-left">95f9c7</td>
<td class="org-left">95f9c7</td>
<td class="org-left">95f9c7</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>

<div id="outline-container-org19cbc9b3" class="outline-3">
<h3 id="org19cbc9b3"><span class="section-number-3">6.6</span> 行番号の表示制限を拡張する</h3>
<div class="outline-text-3" id="text-org19cbc9b3">
<p>
デフォルトだと200桁までしか把握しないので，いつも表示されるように拡張します．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setq</span> line-number-display-limit-width 100000)
</pre>
</div>
</div>
</div>

<div id="outline-container-org328bb797" class="outline-3">
<h3 id="org328bb797"><span class="section-number-3">6.7</span> visible-bell のカスタマイズ</h3>
<div class="outline-text-3" id="text-org328bb797">
<p>
最近は鬱陶しくなってしまい，ビープ音も無しかつ視覚効果も無しにしています．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;  </span><span style="font-weight: bold; font-style: italic;">(setq visible-bell nil) ;; default=nil</span>
(<span style="font-weight: bold;">setq</span> ring-bell-function 'ignore)
</pre>
</div>

<p>
see <a href="http://yohshiy.blog.fc2.com/blog-entry-171.html">http://yohshiy.blog.fc2.com/blog-entry-171.html</a>
</p>

<p>
以前は，<a href="http://www.emacswiki.org/emacs/MilesBader">http://www.emacswiki.org/emacs/MilesBader</a> を参考にカスタマイズしていました．現在は後継パッケージ（<a href="http://www.emacswiki.org/emacs/echo-bell.el">http://www.emacswiki.org/emacs/echo-bell.el</a>）があり，MELPAから取れます．
</p>

<p>
visibl-bell を使うと，操作ミスで発生するビープ音を，視覚的な表示に入れ替えられます．ただ，デフォルトではバッファ中央に黒い四角が表示されて少々鬱陶しいので，ミニバッファの点滅に変更します．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(echo-area-bell)
       <span style="font-style: italic;">"echo-area-bell"</span> nil t)

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"echo-area-bell"</span>
    (<span style="font-weight: bold;">setq</span> visible-bell t)
    (<span style="font-weight: bold;">setq</span> ring-bell-function 'echo-area-bell)))

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#12497;&#12483;&#12465;&#12540;&#12472;&#65288;echo-bell&#65289;&#12398;&#22580;&#21512;</span>
(<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">echo-bell</span> nil t)
  (<span style="font-weight: bold;">setq</span> echo-bell-string <span style="font-style: italic;">""</span>)
  (<span style="font-weight: bold;">setq</span> echo-bell-background <span style="font-style: italic;">"#FFDCDC"</span>)
  (<span style="font-weight: bold;">setq</span> echo-bell-delay 0.1)
  (echo-bell-mode 1))
</pre>
</div>
</div>
</div>

<div id="outline-container-org91a9f893" class="outline-3">
<h3 id="org91a9f893"><span class="section-number-3">6.8</span> 常に <b>scratch</b> を表示して起動する</h3>
<div class="outline-text-3" id="text-org91a9f893">
<p>
最近は，起動用にメジャーモードを書いて対応しています．詳しくはリンク先にて．
</p>

<ul class="org-ul">
<li><a href="http://qiita.com/takaxp/items/12c01bff4c687b3f242b">高速起動用ミニマム*scratch*バッファ - Qiita</a></li>
</ul>

<p>
なお， <code>C-M-s</code> をスクラッチバッファを表示するために使用していますが，本来は，正規表現での検索(<code>isearch-forward-regexp</code>)に割り振られています．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">empty-booting</span> nil t)
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(setq initial-buffer-choice t) ;; &#24341;&#25968;&#20184;&#12365;&#36215;&#21205;&#12377;&#12427;&#12392;&#30011;&#38754;&#20998;&#21106;&#12373;&#12428;&#12427;</span>
  (<span style="font-weight: bold;">setq</span> initial-scratch-message nil)
  (<span style="font-weight: bold;">setq</span> initial-major-mode 'empty-booting-mode)
  <span style="font-weight: bold; font-style: italic;">;;  </span><span style="font-weight: bold; font-style: italic;">:underline "#203e6f"</span>
  (set-face-foreground 'header-line <span style="font-style: italic;">"#FFFFFF"</span>) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">"#203e6f" #333333 "#FFFFFF"</span>
  (set-face-background 'header-line <span style="font-style: italic;">"#a46398"</span>) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">"#ffb08c" "#7e59b5" ##5F7DB7</span>
  (set-face-attribute 'header-line nil
                      <span style="font-weight: bold;">:inherit</span> nil
                      <span style="font-weight: bold;">:overline</span> nil
                      <span style="font-weight: bold;">:underline</span> nil)
  (<span style="font-weight: bold;">setq</span> header-line-format
        (concat
         <span style="font-style: italic;">" No day is a good day.                                       "</span>
         (format-time-string <span style="font-style: italic;">"     %Y-%m-%d %a."</span>))))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">ad:split-window-below</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> _size)
  <span style="font-style: italic;">"An extention to switch to </span><span style="font-weight: bold; font-style: italic;">\</span><span style="font-style: italic;">*scratch</span><span style="font-weight: bold; font-style: italic;">\</span><span style="font-style: italic;">* buffer after splitting window."</span>
  (my-open-scratch))
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(advice-add 'split-window-below :after #'ad:split-window-below)</span>

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-open-scratch</span> ()
  <span style="font-style: italic;">"Switch the current buffer to </span><span style="font-weight: bold; font-style: italic;">\</span><span style="font-style: italic;">*scratch</span><span style="font-weight: bold; font-style: italic;">\</span><span style="font-style: italic;">* buffer."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (switch-to-buffer <span style="font-style: italic;">"*scratch*"</span>))
(global-set-key (kbd <span style="font-style: italic;">"C-M-s"</span>) #'my-open-scratch)
</pre>
</div>

<p>
<code>session.el</code> や <code>desktop.el</code> を使っていても，いつも <code>*scratch*</code> バッファを表示する．そうじゃないと安心できない人向け．
</p>

<p>
使われるメジャーモードと表示する文字列も制御できます．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Start Emacs with scratch buffer even though it call session.el/desktop.el</span>
(add-hook 'emacs-startup-hook (<span style="font-weight: bold;">lambda</span> () (switch-to-buffer <span style="font-style: italic;">"*scratch*"</span>)))
(<span style="font-weight: bold;">setq</span> initial-major-mode 'text-mode)
(<span style="font-weight: bold;">setq</span> initial-scratch-message
      (concat <span style="font-style: italic;">"                                                              "</span>
              (format-time-string <span style="font-style: italic;">"%Y-%m-%d (%a.)"</span>) <span style="font-style: italic;">"\n"</span>
              <span style="font-style: italic;">"-----------------------------------------------------"</span>
              <span style="font-style: italic;">"--------------------------\n"</span>))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdf6d1ea2" class="outline-3">
<h3 id="orgdf6d1ea2"><span class="section-number-3">6.9</span> スクロールバーを非表示にする</h3>
<div class="outline-text-3" id="text-orgdf6d1ea2">
<p>
スクロールバーを非表示にするには，nil を指定します．
右側に表示したい場合は，'right とします．
スクロールバーの非表示は起動後に実施されるため，フレームがチラつきます．それを解消するために，現在は，ソースコードレベルでオフにしています．パッチに興味がある場合は，<a href="https://gist.github.com/takaxp/01ff965361d70de93e9aba3795193cc7">こちら</a>．以下は，MBPビルド向けに設定しています．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Show scroll bar or not</span>
(<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">and</span> (display-graphic-p)
           (memq window-system '(ns mac)))
  (set-scroll-bar-mode nil)) <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">'right</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdd0a9c41" class="outline-3">
<h3 id="orgdd0a9c41"><span class="section-number-3">6.10</span> ツールバーを非表示にする</h3>
<div class="outline-text-3" id="text-orgdd0a9c41">
<p>
ツールバーは使わないので非表示にします．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Disable to show the tool bar.</span>
(<span style="font-weight: bold;">when</span> (display-graphic-p)
  (tool-bar-mode -1))
</pre>
</div>
</div>
</div>

<div id="outline-container-org52e500e2" class="outline-3">
<h3 id="org52e500e2"><span class="section-number-3">6.11</span> メニューバーを非表示にする</h3>
<div class="outline-text-3" id="text-org52e500e2">
<p>
特にターミナルでは不要です．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">unless</span> (display-graphic-p)
  (menu-bar-mode -1))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd432e8ff" class="outline-3">
<h3 id="orgd432e8ff"><span class="section-number-3">6.12</span> 起動時のスプラッシュ画面を表示しない</h3>
<div class="outline-text-3" id="text-orgd432e8ff">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Disable to show the splash window at startup</span>
(<span style="font-weight: bold;">setq</span> inhibit-startup-screen t)
</pre>
</div>
</div>
</div>

<div id="outline-container-org4a736379" class="outline-3">
<h3 id="org4a736379"><span class="section-number-3">6.13</span> default.el を探索させない</h3>
<div class="outline-text-3" id="text-org4a736379">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setq</span> inhibit-default-init t)
</pre>
</div>
</div>
</div>

<div id="outline-container-org8d729190" class="outline-3">
<h3 id="org8d729190"><span class="section-number-3">6.14</span> カーソル行の行数をモードラインに表示する</h3>
<div class="outline-text-3" id="text-org8d729190">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Show line number in the mode line.</span>
(<span style="font-weight: bold;">unless</span> noninteractive
  (line-number-mode 1))
</pre>
</div>
</div>
</div>

<div id="outline-container-orge456e19c" class="outline-3">
<h3 id="orge456e19c"><span class="section-number-3">6.15</span> カーソル行の関数名をモードラインに表示する</h3>
<div class="outline-text-3" id="text-orge456e19c">
<ul class="org-ul">
<li>emacs24.3 で重く感じるので外している．</li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Show function name in the mode line.</span>
(which-function-mode t)
</pre>
</div>
</div>
</div>

<div id="outline-container-orga76ec530" class="outline-3">
<h3 id="orga76ec530"><span class="section-number-3">6.16</span> 行番号をバッファに表示する</h3>
<div class="outline-text-3" id="text-orga76ec530">
<p>
Emacs Version 26.1 からネイティブ実装に切り替わった <code>display-line-numbers.el</code> を使います．普段は使わないので，必要に応じてグローバルにトグルできるようにしてあります．現在行の番号について <code>face</code> を変更したい場合は， <code>line-number-current-line</code> をカスタマイズすればOKです．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(my-toggle-display-line-numbers-mode)
       <span style="font-style: italic;">"display-line-numbers"</span> nil t)

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"hl-line"</span>
    (custom-set-faces
     `(line-number-current-line
       ((t (<span style="font-weight: bold;">:bold</span> t <span style="font-weight: bold;">:background</span> ,(face-attribute 'hl-line <span style="font-weight: bold;">:background</span>)))))))

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"display-line-numbers"</span>
    (custom-set-faces
     '(line-number-current-line
       ((t (<span style="font-weight: bold;">:bold</span> t)))))

    (custom-set-variables
     '(display-line-numbers-width-start t))

    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-toggle-display-line-numbers-mode</span> ()
      <span style="font-style: italic;">"Toggle variable `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">global-display-line-numbers-mode</span><span style="font-style: italic;">'."</span>
      (<span style="font-weight: bold;">interactive</span>)
      (<span style="font-weight: bold;">if</span> (fboundp 'global-display-line-numbers-mode) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">26.1 or later</span>
          (<span style="font-weight: bold;">let</span> ((flag (<span style="font-weight: bold;">if</span> global-display-line-numbers-mode -1 1)))
            (global-display-line-numbers-mode flag))
        (<span style="font-weight: bold;">user-error</span> <span style="font-style: italic;">"The display-line-numbers is NOT supported"</span>)))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org5117762c" class="outline-3">
<h3 id="org5117762c"><span class="section-number-3">6.17</span> 時刻をモードラインに表示する</h3>
<div class="outline-text-3" id="text-org5117762c">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Show clock in in the mode line</span>
(<span style="font-weight: bold;">setq</span> display-time-format <span style="font-style: italic;">"%H:%M"</span>) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">%y%m%d. ;; "%H%M.%S"</span>
(<span style="font-weight: bold;">setq</span> display-time-interval 1)
(<span style="font-weight: bold;">setq</span> display-time-default-load-average nil)
(<span style="font-weight: bold;">unless</span> noninteractive
  (display-time-mode 1))
</pre>
</div>
</div>
</div>

<div id="outline-container-orga734802e" class="outline-3">
<h3 id="orga734802e"><span class="section-number-3">6.18</span> 対応するカッコをハイライトする</h3>
<div class="outline-text-3" id="text-orga734802e">
<p>
Built-in の paren.el が利用できる．拡張版として <a href="http://www.emacswiki.org/emacs/mic-paren.el">mic-paren.el</a> があり，現在はこれを利用している．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">mic-paren</span> nil t)
  (<span style="font-weight: bold;">setq</span> paren-sexp-mode nil)
  (set-face-foreground 'paren-face-match <span style="font-style: italic;">"#FFFFFF"</span>)
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Deep blue: #6666CC, orange: #FFCC66</span>
  (set-face-background 'paren-face-match <span style="font-style: italic;">"#66CC66"</span>)

  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">for ivy-mode, "Matches" &#12392;&#34920;&#31034;&#12373;&#12428;&#12427;&#38306;&#25968;&#12392;&#12398;&#34909;&#31361;&#12434;&#12373;&#12369;&#12427;</span>
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">ad:mic-paren-highlight</span> (f)
    (<span style="font-weight: bold;">if</span> (active-minibuffer-window)
        (<span style="font-weight: bold;">let</span> ((paren-display-message 'never))
          (funcall f))
      (funcall f)))
  (advice-add 'mic-paren-highlight <span style="font-weight: bold;">:around</span> #'ad:mic-paren-highlight)

  (<span style="font-weight: bold;">unless</span> noninteractive
    (paren-activate)))
</pre>
</div>

<p>
paren.el の場合は以下の設定．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setq</span> show-paren-delay 0)
(show-paren-mode t)
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(setq show-paren-style 'expression) ; &#12459;&#12483;&#12467;&#20869;&#12418;&#24375;&#35519;</span>
<span style="font-weight: bold; font-style: italic;">;;</span><span style="font-weight: bold; font-style: italic;">(set-face-background 'show-paren-match-face "#5DA4ff") ; &#12459;&#12540;&#12477;&#12523;&#12424;&#12426;&#28611;&#12356;&#38738;</span>
(set-face-background 'show-paren-match-face <span style="font-style: italic;">"#a634ff"</span>)
(set-face-foreground 'show-paren-match-face <span style="font-style: italic;">"#FFFFFF"</span>)
(set-face-underline-p 'show-paren-match-face nil)
(<span style="font-weight: bold;">setq</span> show-paren-style 'parenthesis)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd1e62da7" class="outline-3">
<h3 id="orgd1e62da7"><span class="section-number-3">6.19</span> 全角スペースと行末タブ／半角スペースを強調表示する</h3>
<div class="outline-text-3" id="text-orgd1e62da7">
<ul class="org-ul">
<li><a href="http://ubulog.blogspot.jp/2007/09/emacs_09.html">http://ubulog.blogspot.jp/2007/09/emacs_09.html</a></li>
<li><a href="https://beiznotes.org/200906031244034052-2/">emacsでタブとEOFと全角空白の表示を。</a></li>
<li><a href="http://qiita.com/itiut@github/items/4d74da2412a29ef59c3a">whitespace-modeを使って、ファイルの保存時に行末のスペースや末尾の改行を削除する - Qiita</a></li>
</ul>

<p>
英語で原稿を書く時に全角スペースが入っているを苦労するので，強調表示して編集中でも気づくようにします．また，行末のタブや半角スペースも無駄なので，入り込まないように強調しています．パッケージを使うと too much かなという印象があったので，個別の設定だけを使わせてもらっています．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#12473;&#12506;&#12540;&#12473;</span>
(<span style="font-weight: bold;">defface</span> <span style="font-weight: bold; font-style: italic;">my-face-b-1</span>
  '((t (<span style="font-weight: bold;">:background</span> <span style="font-style: italic;">"gray"</span> <span style="font-weight: bold;">:bold</span> t <span style="font-weight: bold;">:underline</span> <span style="font-style: italic;">"red"</span>)))
  nil <span style="font-weight: bold;">:group</span> 'font-lock-highlighting-faces)
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#12479;&#12502;&#12384;&#12369;&#12398;&#34892;</span>
(<span style="font-weight: bold;">defface</span> <span style="font-weight: bold; font-style: italic;">my-face-b-2</span>
  '((t (<span style="font-weight: bold;">:background</span> <span style="font-style: italic;">"orange"</span> <span style="font-weight: bold;">:bold</span> t <span style="font-weight: bold;">:underline</span> <span style="font-style: italic;">"red"</span>)))
  nil <span style="font-weight: bold;">:group</span> 'font-lock-highlighting-faces)
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#21322;&#35282;&#12473;&#12506;&#12540;&#12473;</span>
(<span style="font-weight: bold;">defface</span> <span style="font-weight: bold; font-style: italic;">my-face-b-3</span> '((t (<span style="font-weight: bold;">:background</span> <span style="font-style: italic;">"orange"</span>)))
  nil <span style="font-weight: bold;">:group</span> 'font-lock-highlighting-faces)

(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my-face-b-1</span> 'my-face-b-1)
(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my-face-b-2</span> 'my-face-b-2)
(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my-face-b-3</span> 'my-face-b-3)
(<span style="font-weight: bold;">defadvice</span> <span style="font-weight: bold;">font-lock-mode</span> (before my-font-lock-mode ())
  (font-lock-add-keywords
   major-mode
   <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">"[\t]+$" &#34892;&#26411;&#12398;&#12479;&#12502;</span>
   '((<span style="font-style: italic;">"&#12288;"</span> 0 my-face-b-1 append)
     (<span style="font-style: italic;">"[ ]+$"</span> 0 my-face-b-3 append)
     (<span style="font-style: italic;">"[\t]+$"</span> 0 my-face-b-2 append))))
(ad-enable-advice 'font-lock-mode 'before 'my-font-lock-mode)
(ad-activate 'font-lock-mode)

<span style="font-weight: bold; font-style: italic;">;;</span><span style="font-weight: bold; font-style: italic;">show EOF</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(defun set-buffer-end-mark()</span>
<span style="font-weight: bold; font-style: italic;">;;   </span><span style="font-weight: bold; font-style: italic;">(let ((overlay (make-overlay (point-max) (point-max))))</span>
<span style="font-weight: bold; font-style: italic;">;;     </span><span style="font-weight: bold; font-style: italic;">(overlay-put overlay 'before-string #("[EOF]" 0 5 (face highlight)))</span>
<span style="font-weight: bold; font-style: italic;">;;     </span><span style="font-weight: bold; font-style: italic;">(overlay-put overlay 'insert-behind-hooks</span>
<span style="font-weight: bold; font-style: italic;">;;                  </span><span style="font-weight: bold; font-style: italic;">'((lambda (overlay after beg end &amp;optional len)</span>
<span style="font-weight: bold; font-style: italic;">;;                      </span><span style="font-weight: bold; font-style: italic;">(when after</span>
<span style="font-weight: bold; font-style: italic;">;;                        </span><span style="font-weight: bold; font-style: italic;">(move-overlay overlay (point-max) (point-max))))))))</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(add-hook 'find-file-hooks #'set-buffer-end-mark)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc93741fa" class="outline-3">
<h3 id="orgc93741fa"><span class="section-number-3">6.20</span> バッファの終わりをフリンジで明示</h3>
<div class="outline-text-3" id="text-orgc93741fa">
<p>
以下の設定では，ウィンドウ以下にバッファが続いているかを表す矢印と，続いていないことを示すカギカッコをフリンジに表示します．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setq-default</span> indicate-buffer-boundaries
              '((top . nil) (bottom . right) (down . left)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgec7835e0" class="outline-3">
<h3 id="orgec7835e0"><span class="section-number-3">6.21</span> 文字エンコードの表示を明確化</h3>
<div class="outline-text-3" id="text-orgec7835e0">
<p>
デフォルトの表示は略されすぎていてわかりにくいので，表示内容を具体化します．
</p>

<ul class="org-ul">
<li><a href="https://qiita.com/kai2nenobu/items/ddf94c0e5a36919bc6db">モードラインの文字エンコーディング表示をわかりやすくする - Qiita</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#25913;&#34892;&#25991;&#23383;&#12398;&#25991;&#23383;&#21015;&#34920;&#29694;</span>
(set 'eol-mnemonic-dos <span style="font-style: italic;">"(CRLF)"</span>)
(set 'eol-mnemonic-unix <span style="font-style: italic;">"(LF)"</span>)
(set 'eol-mnemonic-mac <span style="font-style: italic;">"(CR)"</span>)
(set 'eol-mnemonic-undecided <span style="font-style: italic;">"(?)"</span>)

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#25991;&#23383;&#12456;&#12531;&#12467;&#12540;&#12487;&#12451;&#12531;&#12464;&#12398;&#25991;&#23383;&#21015;&#34920;&#29694;</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-coding-system-name-mnemonic</span> (coding-system)
  (<span style="font-weight: bold;">let*</span> ((base (coding-system-base coding-system))
         (name (symbol-name base)))
    (<span style="font-weight: bold;">cond</span> ((string-prefix-p <span style="font-style: italic;">"utf-8"</span> name) <span style="font-style: italic;">"U8"</span>)
          ((string-prefix-p <span style="font-style: italic;">"utf-16"</span> name) <span style="font-style: italic;">"U16"</span>)
          ((string-prefix-p <span style="font-style: italic;">"utf-7"</span> name) <span style="font-style: italic;">"U7"</span>)
          ((string-prefix-p <span style="font-style: italic;">"japanese-shift-jis"</span> name) <span style="font-style: italic;">"SJIS"</span>)
          ((string-match <span style="font-style: italic;">"cp</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">[0-9]+</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">"</span> name) (match-string 1 name))
          ((string-match <span style="font-style: italic;">"japanese-iso-8bit"</span> name) <span style="font-style: italic;">"EUC"</span>)
          (t <span style="font-style: italic;">"???"</span>)
          )))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-coding-system-bom-mnemonic</span> (coding-system)
  (<span style="font-weight: bold;">let</span> ((name (symbol-name coding-system)))
    (<span style="font-weight: bold;">cond</span> ((string-match <span style="font-style: italic;">"be-with-signature"</span> name) <span style="font-style: italic;">"[BE]"</span>)
          ((string-match <span style="font-style: italic;">"le-with-signature"</span> name) <span style="font-style: italic;">"[LE]"</span>)
          ((string-match <span style="font-style: italic;">"-with-signature"</span> name) <span style="font-style: italic;">"[BOM]"</span>)
          (t <span style="font-style: italic;">""</span>))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-buffer-coding-system-mnemonic</span> ()
  <span style="font-style: italic;">"Return a mnemonic for `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">buffer-file-coding-system</span><span style="font-style: italic;">'."</span>
  (<span style="font-weight: bold;">let*</span> ((code buffer-file-coding-system)
         (name (my-coding-system-name-mnemonic code))
         (bom (my-coding-system-bom-mnemonic code)))
    (format <span style="font-style: italic;">"%s%s"</span> name bom)))

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">`</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">mode-line-mule-info</span><span style="font-weight: bold; font-style: italic;">' &#12398;&#25991;&#23383;&#12456;&#12531;&#12467;&#12540;&#12487;&#12451;&#12531;&#12464;&#12398;&#25991;&#23383;&#21015;&#34920;&#29694;&#12434;&#24046;&#12375;&#26367;&#12360;&#12427;</span>
(<span style="font-weight: bold;">setq-default</span> mode-line-mule-info
              (cl-substitute '(<span style="font-weight: bold;">:eval</span> (my-buffer-coding-system-mnemonic))
                             <span style="font-style: italic;">"%z"</span> mode-line-mule-info <span style="font-weight: bold;">:test</span> 'equal))
</pre>
</div>
</div>
</div>

<div id="outline-container-org0e59b85f" class="outline-3">
<h3 id="org0e59b85f"><span class="section-number-3">6.22</span> [delight.el] モードラインのモード名を短縮する</h3>
<div class="outline-text-3" id="text-org0e59b85f">
<ul class="org-ul">
<li><a href="https://elpa.gnu.org/packages/delight.html">GNU ELPA - delight</a></li>
</ul>

<p>
以前は <code>diminish.el</code> を使用していましたが，ELPA配布のパッケージに移行しました．メジャーモードの短縮表示もマイナーモードの場合と同様に設定できます．この点で，設定がスッキリしました．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-delight-activate</span> ()
  (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">delight</span> nil t)
  (remove-hook 'find-file-hook #'my-delight-activate))
(add-hook 'find-file-hook #'my-delight-activate)

(<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"delight"</span>
  (delight
   '(<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Major modes</span>
     <span style="font-weight: bold; font-style: italic;">;;     </span><span style="font-weight: bold; font-style: italic;">(c-mode "C" :major)</span>
     <span style="font-weight: bold; font-style: italic;">;;     </span><span style="font-weight: bold; font-style: italic;">(c++mode "C++" :major)</span>
     (js2-mode <span style="font-style: italic;">"JS"</span> <span style="font-weight: bold;">:major</span>)
     (<span style="font-weight: bold;">csharp-mode</span> <span style="font-style: italic;">"C#"</span> <span style="font-weight: bold;">:major</span>)
     (prog-mode <span style="font-style: italic;">"Pr"</span> <span style="font-weight: bold;">:major</span>)
     (emacs-lisp-mode <span style="font-style: italic;">"El"</span> <span style="font-weight: bold;">:major</span>)
     (python-mode <span style="font-style: italic;">"Py"</span> <span style="font-weight: bold;">:major</span>)
     (perl-mode <span style="font-style: italic;">"Pl"</span> <span style="font-weight: bold;">:major</span>)
     (web-mode <span style="font-style: italic;">"W"</span> <span style="font-weight: bold;">:major</span>)
     (change-log-mode <span style="font-style: italic;">"ChangeLog"</span> <span style="font-weight: bold;">:major</span>)
     (lisp-interaction-mode <span style="font-style: italic;">"Lisp"</span> <span style="font-weight: bold;">:major</span>)

     <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Shorten for minor modes</span>
     (ggtags-mode <span style="font-style: italic;">" G"</span> <span style="font-style: italic;">"ggtags"</span>)
     <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(orgstruct-mode " OrgS" "org")</span>
     (orgalist-mode <span style="font-style: italic;">" ol"</span> <span style="font-style: italic;">"orgalist"</span>)

     <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Stop to display for minor modes</span>
     (org-fancy-priorities-mode nil <span style="font-style: italic;">"org-fancy-priorities"</span>)
     (smooth-scroll-mode nil <span style="font-style: italic;">"smooth-scroll"</span>)
     (eldoc-mode nil <span style="font-style: italic;">"eldoc"</span>)
     (ivy-mode nil <span style="font-style: italic;">"ivy"</span>)
     (counsel-mode nil <span style="font-style: italic;">"counsel"</span>)
     (centered-cursor-mode nil <span style="font-style: italic;">"centered-cursor-mode"</span>)
     (volatile-highlights-mode nil <span style="font-style: italic;">"volatile-highlights"</span>)
     (aggressive-indent-mode nil <span style="font-style: italic;">"aggressive-indent"</span>)
     (all-the-icons-dired-mode nil <span style="font-style: italic;">"all-the-icons-dired"</span>)
     (yas-minor-mode nil <span style="font-style: italic;">"yasnippet"</span>)
     (auto-complete-mode nil <span style="font-style: italic;">"auto-complete"</span>)
     (company-mode nil <span style="font-style: italic;">"company"</span>)
     (ws-butler-mode nil <span style="font-style: italic;">"ws-butler"</span>)
     (isearch-mode nil <span style="font-style: italic;">"isearch"</span>)
     (auto-revert-mode nil <span style="font-style: italic;">"autorevert"</span>)
     (global-whitespace-mode nil <span style="font-style: italic;">"whitespace"</span>)
     (emmet-mode nil <span style="font-style: italic;">"emmet-mode"</span>)
     (abbrev-mode nil <span style="font-style: italic;">"abbrev"</span>)
     (doxymacs-mode nil <span style="font-style: italic;">"doxymacs"</span>)
     (editorconfig-mode nil <span style="font-style: italic;">"editorconfig"</span>)
     (rainbow-mode nil <span style="font-style: italic;">"rainbow-mode"</span>)
     (highlight-symbol-mode nil <span style="font-style: italic;">"highlight-symbol"</span>)
     (which-key-mode nil <span style="font-style: italic;">"which-key"</span>)
     (fancy-narrow-mode nil <span style="font-style: italic;">"fancy-narrow"</span>)
     (smartparens-mode nil <span style="font-style: italic;">"smartparens"</span>)
     (projectile-mode nil <span style="font-style: italic;">"projectile"</span>)
     (selected-minor-mode nil <span style="font-style: italic;">"selected"</span>))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org74bad2de" class="outline-3">
<h3 id="org74bad2de"><span class="section-number-3">6.23</span> [migemo.el] ローマ字入力で日本語を検索する</h3>
<div class="outline-text-3" id="text-org74bad2de">
<ul class="org-ul">
<li><a href="http://0xcc.net/migemo/#download">http://0xcc.net/migemo/#download</a></li>
<li><a href="https://github.com/emacs-jp/migemo">emacs-jp/migemo: emacs migemo client</a></li>
</ul>

<p>
以下は，<a href="http://www.kaoriya.net/software/cmigemo">cmigemo</a> を使う設定です．正直なところ，それほどメリットを感じていません．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">if</span> (executable-find <span style="font-style: italic;">"cmigemo"</span>)
    (<span style="font-weight: bold;">when</span> (autoload-if-found
           '(migemo-init)
           <span style="font-style: italic;">"migemo"</span> nil t)

      (<span style="font-weight: bold;">when</span> (locate-library <span style="font-style: italic;">"migemo"</span>) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">overhead but should be checked here</span>
        (add-hook 'isearch-mode-hook #'migemo-init))

      (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"migemo"</span>
        (custom-set-variables
         '(completion-ignore-case t) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">case-independent</span>
         '(migemo-command <span style="font-style: italic;">"cmigemo"</span>)
         '(migemo-options '(<span style="font-style: italic;">"-q"</span> <span style="font-style: italic;">"--emacs"</span> <span style="font-style: italic;">"-i"</span> <span style="font-style: italic;">"\a"</span>))
         '(migemo-dictionary <span style="font-style: italic;">"/usr/local/share/migemo/utf-8/migemo-dict"</span>)
         '(migemo-user-dictionary nil)
         '(migemo-regex-dictionary nil)
         '(migemo-use-pattern-alist t)
         '(migemo-use-frequent-pattern-alist t)
         '(migemo-pattern-alist-length 1024)
         '(migemo-coding-system 'utf-8-unix))))
  (message <span style="font-style: italic;">"--- cmigemo is NOT installed."</span>))
</pre>
</div>
</div>
</div>

<div id="outline-container-org6332fe92" class="outline-3">
<h3 id="org6332fe92"><span class="section-number-3">6.24</span> [git-gutter-fringe] 編集差分をフレーム端で視覚化</h3>
<div class="outline-text-3" id="text-org6332fe92">
<p>
編集差分の視覚化は，元々 git-gutter が提供している機能です．しかし有効にするとフレームの幅が若干広がってしまうので，気になる人は git-gutter-fringe を使えばよいです．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(git-gutter-mode)
       <span style="font-style: italic;">"git-gutter"</span> nil t)

  (<span style="font-weight: bold;">dolist</span> (hook
           '(emacs-lisp-mode-hook
             lisp-mode-hook perl-mode-hook python-mode-hook
             c-mode-common-hook nxml-mode-hook web-mode-hook))
    (add-hook hook #'git-gutter-mode))

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"git-gutter"</span>
    (custom-set-variables
     '(git-gutter:lighter <span style="font-style: italic;">""</span>))

    (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">git-gutter-fringe</span> nil t)
      (custom-set-variables
       '(git-gutter-fr:side 'left-fringe))

      <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(require 'fringe-helper nil t) ;; byte-compile &#26178;&#12395;&#26126;&#31034;&#30340;&#12395;&#25351;&#23450;&#12364;&#24517;&#35201;&#65294;</span>
      <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">"!"</span>
      (fringe-helper-define 'git-gutter-fr:modified nil
        <span style="font-style: italic;">"...XX..."</span>
        <span style="font-style: italic;">"...XX..."</span>
        <span style="font-style: italic;">"...XX..."</span>
        <span style="font-style: italic;">"...XX..."</span>
        <span style="font-style: italic;">"...XX..."</span>
        <span style="font-style: italic;">"........"</span>
        <span style="font-style: italic;">"...XX..."</span>
        <span style="font-style: italic;">"...XX..."</span>)
      <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">"+"</span>
      (fringe-helper-define 'git-gutter-fr:added nil
        <span style="font-style: italic;">"........"</span>
        <span style="font-style: italic;">"...XX..."</span>
        <span style="font-style: italic;">"...XX..."</span>
        <span style="font-style: italic;">".XXXXXX."</span>
        <span style="font-style: italic;">".XXXXXX."</span>
        <span style="font-style: italic;">"...XX..."</span>
        <span style="font-style: italic;">"...XX..."</span>
        <span style="font-style: italic;">"........"</span>)
      <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">"-"</span>
      (fringe-helper-define 'git-gutter-fr:deleted nil
        <span style="font-style: italic;">"........"</span>
        <span style="font-style: italic;">"........"</span>
        <span style="font-style: italic;">"........"</span>
        <span style="font-style: italic;">".XXXXXX."</span>
        <span style="font-style: italic;">".XXXXXX."</span>
        <span style="font-style: italic;">"........"</span>
        <span style="font-style: italic;">"........"</span>
        <span style="font-style: italic;">"........"</span>)
      (set-face-foreground 'git-gutter-fr:added    <span style="font-style: italic;">"#FF2600"</span>)
      (set-face-foreground 'git-gutter-fr:modified <span style="font-style: italic;">"orange"</span>)
      (set-face-foreground 'git-gutter-fr:deleted  <span style="font-style: italic;">"medium sea green"</span>))))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd6308db6" class="outline-3">
<h3 id="orgd6308db6"><span class="section-number-3">6.25</span> [japanese-holidays] カレンダーをカラフルにする</h3>
<div class="outline-text-3" id="text-orgd6308db6">
<p>
ビルドインの <code>holidays</code> と， <code>japanese-holidays</code> を使います．土日祝日に色を着けます．土曜日と日曜祝日で異なる配色にできます．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"calendar"</span>

  (add-hook 'calendar-today-visible-hook #'calendar-mark-today)

  (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">japanese-holidays</span> nil t)
    (<span style="font-weight: bold;">setq</span> calendar-holidays
          (append japanese-holidays
                  holiday-local-holidays holiday-other-holidays))
    (<span style="font-weight: bold;">setq</span> mark-holidays-in-calendar t)
    (<span style="font-weight: bold;">setq</span> japanese-holiday-weekend-marker
          '(holiday nil nil nil nil nil japanese-holiday-saturday))
    (<span style="font-weight: bold;">setq</span> japanese-holiday-weekend '(0 6))

    (add-hook 'calendar-today-visible-hook #'japanese-holiday-mark-weekend)
    (add-hook 'calendar-today-invisible-hook #'japanese-holiday-mark-weekend)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org12f72886" class="outline-3">
<h3 id="org12f72886"><span class="section-number-3">6.26</span> [calendar.el] カレンダーで週番号を表示する</h3>
<div class="outline-text-3" id="text-org12f72886">
<p>
ビルドインの <code>calendar.el</code> にある <code>calendar-intermonth-text</code> をカスタマイズすると，カレンダーに週番号を表示させることが可能です．ただ， <code>calendar.el</code> に記載されている例だと， <code>calendar-week-start-day</code> が <code>1</code> 以外の時に計算結果がおかしくなるので，次のように <code>calendar-absolute-from-gregorian</code> に渡す値を補正する必要があります．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"calendar"</span>
  (<span style="font-weight: bold;">setq</span> calendar-week-start-day 1)
  (copy-face 'default 'calendar-iso-week-header-face)
  (set-face-attribute 'calendar-iso-week-header-face nil
                      <span style="font-weight: bold;">:height</span> 1.0 <span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#1010FF"</span>
                      <span style="font-weight: bold;">:background</span> (face-background 'default))
  (<span style="font-weight: bold;">setq</span> calendar-intermonth-header
        (propertize <span style="font-style: italic;">" w"</span>
                    'font-lock-face 'calendar-iso-week-header-face))

  (copy-face font-lock-constant-face 'calendar-iso-week-face)
  (set-face-attribute 'calendar-iso-week-face nil
                      <span style="font-weight: bold;">:height</span> 1.0 <span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"orange"</span>
                      <span style="font-weight: bold;">:background</span> (face-background 'default))

  (<span style="font-weight: bold;">setq</span> calendar-intermonth-text
        '(propertize
          (format <span style="font-style: italic;">"%02d"</span>
                  (car
                   (calendar-iso-from-absolute
                    (calendar-absolute-from-gregorian
                     (list month
                           (- day (1- calendar-week-start-day)) year)))))
          'font-lock-face 'calendar-iso-week-face))

  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-get-week-number</span> ()
    <span style="font-style: italic;">"Return the current week number."</span>
    (format <span style="font-style: italic;">"%02d"</span>
            (car
             (calendar-iso-from-absolute
              (calendar-absolute-from-gregorian
               (list (string-to-number (format-time-string <span style="font-style: italic;">"%m"</span>))
                     (- (string-to-number (format-time-string <span style="font-style: italic;">"%d"</span>))
                        (1- calendar-week-start-day))
                     (string-to-number (format-time-string <span style="font-style: italic;">"%y"</span>))))))))
  (<span style="font-weight: bold;">setq</span> header-line-format
        (concat
         <span style="font-style: italic;">" No day is a good day.                                       "</span>
         (format <span style="font-style: italic;">"W%s: "</span> (my-get-week-number))
         (format-time-string <span style="font-style: italic;">"%Y-%m-%d %a."</span>))))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc45b24d4" class="outline-3">
<h3 id="orgc45b24d4"><span class="section-number-3">6.27</span> [which-key] キーバインドの選択肢をポップアップする</h3>
<div class="outline-text-3" id="text-orgc45b24d4">
<p>
<code>guide-key.el</code> の後発． <code>guide-key.el</code> の改良でもあり，ディスパッチャが見やすく，直感的でとても使いやすい．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(which-key-mode)
       <span style="font-style: italic;">"which-key"</span> nil t)

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"which-key"</span>
    (custom-set-variables
     '(which-key-idle-delay 1.0)))

  (<span style="font-weight: bold;">unless</span> noninteractive
    (which-key-mode 1)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org467accb9" class="outline-3">
<h3 id="org467accb9"><span class="section-number-3">6.28</span> [highlight-symbol] 同じ名前のシンボルをハイライトする</h3>
<div class="outline-text-3" id="text-org467accb9">
<p>
一定時間が過ぎると，カーソル下のワードをバッファ内で検索し，ハイライトしてくれる．殺風景なバッファに動きが出て良い．また， <code>highlight-symbol-nav-mode</code> を使うと，シンボル間を <code>M-n/M-p</code> で移動できるので，毎度検索しなくてよい．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(highlight-symbol-mode highlight-symbol-nav-mode)
       <span style="font-style: italic;">"highlight-symbol"</span> nil t)

  (<span style="font-weight: bold;">dolist</span> (hook '(emacs-lisp-mode-hook c-mode-common-hook prog-mode-hook))
    (add-hook hook #'highlight-symbol-mode))

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"highlight-symbol"</span>
    (custom-set-variables
     '(highlight-symbol-idle-delay 0.5))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org962224ff" class="outline-3">
<h3 id="org962224ff"><span class="section-number-3">6.29</span> [all-the-icons.el] フォントでアイコン表示</h3>
<div class="outline-text-3" id="text-org962224ff">
<p>
<code>all-the-icons.el</code> を使うと，バッファ内やモードライン，ミニバッファでアイコンを表示できるようになります．
</p>

<p>
<a href="https://github.com/domtronn/all-the-icons.el">domtronn/all-the-icons.el: A utility package to collect various Icon Fonts and propertize them within Emacs.</a>
</p>

<p>
パッケージを使えるようにした後， <code>M-x all-the-icons-install-fonts</code> すると自動的にフォントがインストールされます．続いて <code>fc-cache -f -v</code> を発行すればフォントが使えるようになります．
</p>
</div>
</div>

<div id="outline-container-orgd92b50db" class="outline-3">
<h3 id="orgd92b50db"><span class="section-number-3">6.30</span> [all-the-icons-dired] dired でアイコンを表示</h3>
<div class="outline-text-3" id="text-orgd92b50db">
<p>
<code>dired</code> で，ファイルのアイコンを表示します． <code>all-the-icons</code> をインストール後に， <code>M-x all-the-icons-install-fonts</code> を忘れずに実行する必要があります． <code>neotree</code> の設定は別セクションに記載しています．
</p>

<p>
<code>M-x all-the-icons-install-fonts</code> をしてもうまくアイコンが表示されない場合は， <code>~/Library/Fonts/</code> 以下にある <code>all-the-icons.ttf</code> のサイズを確認してください．もしゼロバイトならインストールに失敗しています．その場合は，パッケージの <code>all-the-icons/fonts</code> 以下にあるフォントを直接インストールすればOKです．
</p>

<p>
<code>font-lock-mode</code> が無効の場合に，意図しないアイコンが表示されることがあります．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(all-the-icons-dired-mode ad:all-the-icons-dired--display)
       <span style="font-style: italic;">"all-the-icons-dired"</span> nil t)

  (add-hook 'dired-mode-hook #'all-the-icons-dired-mode)

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"all-the-icons"</span>
    (<span style="font-weight: bold;">setq</span> all-the-icons-scale-factor 1.0)
    (add-to-list 'all-the-icons-dir-icon-alist
                 '(<span style="font-style: italic;">"google[ _-]drive"</span> all-the-icons-alltheicon <span style="font-style: italic;">"google-drive"</span>
                   <span style="font-weight: bold;">:height</span> 1.0 <span style="font-weight: bold;">:v-adjust</span> -0.1)))

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"all-the-icons-dired"</span>
    (<span style="font-weight: bold;">unless</span> noninteractive
      (<span style="font-weight: bold;">unless</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">font-lock+</span> nil t)
        (<span style="font-weight: bold;">user-error</span> <span style="font-style: italic;">"font-lock+ is NOT installed for all-the-icons."</span>))

      <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(defun ad:all-the-icons-dired--display ()</span>
      <span style="font-weight: bold; font-style: italic;">;;   </span><span style="font-weight: bold; font-style: italic;">"Display the icons of files in a dired buffer."</span>
      <span style="font-weight: bold; font-style: italic;">;;   </span><span style="font-weight: bold; font-style: italic;">(when (and (not all-the-icons-dired-displayed) dired-subdir-alist)</span>
      <span style="font-weight: bold; font-style: italic;">;;     </span><span style="font-weight: bold; font-style: italic;">(setq-local all-the-icons-dired-displayed t)</span>
      <span style="font-weight: bold; font-style: italic;">;;     </span><span style="font-weight: bold; font-style: italic;">(let ((inhibit-read-only t)</span>
      <span style="font-weight: bold; font-style: italic;">;;           </span><span style="font-weight: bold; font-style: italic;">(file-remote-p (and (fboundp 'tramp-tramp-file-p)</span>
      <span style="font-weight: bold; font-style: italic;">;;                               </span><span style="font-weight: bold; font-style: italic;">(tramp-tramp-file-p default-directory))))</span>
      <span style="font-weight: bold; font-style: italic;">;;       </span><span style="font-weight: bold; font-style: italic;">(save-excursion</span>
      <span style="font-weight: bold; font-style: italic;">;;         </span><span style="font-weight: bold; font-style: italic;">(goto-char (point-min))</span>
      <span style="font-weight: bold; font-style: italic;">;;         </span><span style="font-weight: bold; font-style: italic;">(setq tab-width 1)</span>
      <span style="font-weight: bold; font-style: italic;">;;         </span><span style="font-weight: bold; font-style: italic;">(while (not (eobp))</span>
      <span style="font-weight: bold; font-style: italic;">;;           </span><span style="font-weight: bold; font-style: italic;">(when (dired-move-to-filename nil)</span>
      <span style="font-weight: bold; font-style: italic;">;;             </span><span style="font-weight: bold; font-style: italic;">(let ((file (dired-get-filename 'verbatim t)))</span>
      <span style="font-weight: bold; font-style: italic;">;;               </span><span style="font-weight: bold; font-style: italic;">(unless (member file '("." ".."))</span>
      <span style="font-weight: bold; font-style: italic;">;;                 </span><span style="font-weight: bold; font-style: italic;">(let ((filename (dired-get-filename nil t)))</span>
      <span style="font-weight: bold; font-style: italic;">;;                   </span><span style="font-weight: bold; font-style: italic;">(if (file-directory-p filename)</span>
      <span style="font-weight: bold; font-style: italic;">;;                       </span><span style="font-weight: bold; font-style: italic;">(let* ((matcher (all-the-icons-match-to-alist file all-the-icons-dir-icon-alist))</span>
      <span style="font-weight: bold; font-style: italic;">;;                              </span><span style="font-weight: bold; font-style: italic;">(icon (cond</span>
      <span style="font-weight: bold; font-style: italic;">;;                                     </span><span style="font-weight: bold; font-style: italic;">(remote-p</span>
      <span style="font-weight: bold; font-style: italic;">;;                                      </span><span style="font-weight: bold; font-style: italic;">(all-the-icons-octicon "file-directory" :v-adjust all-the-icons-dired-v-adjust :face 'all-the-icons-dired-dir-face))</span>
      <span style="font-weight: bold; font-style: italic;">;;                                     </span><span style="font-weight: bold; font-style: italic;">((file-symlink-p filename)</span>
      <span style="font-weight: bold; font-style: italic;">;;                                      </span><span style="font-weight: bold; font-style: italic;">(all-the-icons-octicon "file-symlink-directory" :v-adjust all-the-icons-dired-v-adjust :face 'all-the-icons-dired-dir-face))</span>
      <span style="font-weight: bold; font-style: italic;">;;                                     </span><span style="font-weight: bold; font-style: italic;">((all-the-icons-dir-is-submodule filename)</span>
      <span style="font-weight: bold; font-style: italic;">;;                                      </span><span style="font-weight: bold; font-style: italic;">(all-the-icons-octicon "file-submodule" :v-adjust all-the-icons-dired-v-adjust :face 'all-the-icons-dired-dir-face))</span>
      <span style="font-weight: bold; font-style: italic;">;;                                     </span><span style="font-weight: bold; font-style: italic;">((file-exists-p (format "%s/.git" filename))</span>
      <span style="font-weight: bold; font-style: italic;">;;                                      </span><span style="font-weight: bold; font-style: italic;">(all-the-icons-octicon "repo" :v-adjust all-the-icons-dired-v-adjust :face 'all-the-icons-dired-dir-face))</span>
      <span style="font-weight: bold; font-style: italic;">;;                                     </span><span style="font-weight: bold; font-style: italic;">(t (apply (car matcher) (list (cadr matcher) :face 'all-the-icons-dired-dir-face :v-adjust all-the-icons-dired-v-adjust))))))</span>
      <span style="font-weight: bold; font-style: italic;">;;                         </span><span style="font-weight: bold; font-style: italic;">(insert (concat icon "\t")))</span>
      <span style="font-weight: bold; font-style: italic;">;;                     </span><span style="font-weight: bold; font-style: italic;">(insert (concat (all-the-icons-icon-for-file file :v-adjust all-the-icons-dired-v-adjust) "\t"))))))) ;; :height 0.9</span>
      <span style="font-weight: bold; font-style: italic;">;;           </span><span style="font-weight: bold; font-style: italic;">(forward-line 1))))))</span>
      <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(advice-add 'all-the-icons-dired--display :override #'ad:all-the-icons-dired--display)</span>
      )))
</pre>
</div>
</div>
</div>

<div id="outline-container-org402f1293" class="outline-3">
<h3 id="org402f1293"><span class="section-number-3">6.31</span> [eldoc.el] コンテクストに応じてヘルプを表示</h3>
<div class="outline-text-3" id="text-org402f1293">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(turn-on-eldoc-mode)
       <span style="font-style: italic;">"eldoc"</span> nil t)

  (<span style="font-weight: bold;">dolist</span> (hook '(emacs-lisp-mode-hook org-mode-hook c-mode-common-hook))
    (add-hook hook #'turn-on-eldoc-mode))

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"eldoc"</span>
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">for ivy-mode</span>
    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">ad:eldoc-message</span> (f <span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> string)
      (<span style="font-weight: bold;">unless</span> (active-minibuffer-window)
        (funcall f string)))
    (advice-add 'eldoc-message <span style="font-weight: bold;">:around</span> #'ad:eldoc-message)

    (custom-set-variables
     '(eldoc-idle-delay 1.0))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org138fda77" class="outline-3">
<h3 id="org138fda77"><span class="section-number-3">6.32</span> [go-eldoc.el] Go用の eldoc</h3>
<div class="outline-text-3" id="text-org138fda77">
<div class="org-src-container">
<pre class="src src-go">go get -v github.com/mdempsky/gocode
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">if</span> (executable-find <span style="font-style: italic;">"gocode"</span>)
    (<span style="font-weight: bold;">when</span> (autoload-if-found
           '(go-mode)
           <span style="font-style: italic;">"go-eldoc"</span> nil t)
      (add-hook 'go-mode-hook #'go-eldoc-setup))
  (message <span style="font-style: italic;">"--- gocode is NOT installed."</span>))
</pre>
</div>
</div>
</div>

<div id="outline-container-org7cab354d" class="outline-3">
<h3 id="org7cab354d"><span class="section-number-3">6.33</span> [keycast.el] 入力しているキーとコマンドをモードラインに表示</h3>
<div class="outline-text-3" id="text-org7cab354d">
<ul class="org-ul">
<li>入力した文字や発行したコマンドキーをモードラインに表示．コマンドの名前もリアルタイムに表示される．</li>
<li><a href="https://github.com/tarsius/keycast">tarsius/keycast: Show current command and its key in the mode line</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(autoload-if-found '(keycast-mode) <span style="font-style: italic;">"keycast"</span> nil t)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfa7d126f" class="outline-3">
<h3 id="orgfa7d126f"><span class="section-number-3">6.34</span> [ivy.el] 続々・何でも絞り込みインターフェイス</h3>
<div class="outline-text-3" id="text-orgfa7d126f">
<p>
<code>helm</code> から <code>ivy</code> に乗り換えました．移行話は Qiita で（長編）記事にしました．
</p>

<ul class="org-ul">
<li><a href="https://qiita.com/takaxp/items/2fde2c119e419713342b">https://qiita.com/takaxp/items/2fde2c119e419713342b</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(ivy-hydra-read-action)
       <span style="font-style: italic;">"ivy-hydra"</span> nil t)

  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">ivy-dispatching-done-hydra was depreciated in ivy 0.13</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(with-eval-after-load "ivy-hydra"</span>
  <span style="font-weight: bold; font-style: italic;">;;   </span><span style="font-weight: bold; font-style: italic;">(defun ad:ivy-dispatching-done-hydra (f)</span>
  <span style="font-weight: bold; font-style: italic;">;;     </span><span style="font-weight: bold; font-style: italic;">(when (&gt; ivy--length 0)</span>
  <span style="font-weight: bold; font-style: italic;">;;       </span><span style="font-weight: bold; font-style: italic;">(funcall f)))</span>
  <span style="font-weight: bold; font-style: italic;">;;   </span><span style="font-weight: bold; font-style: italic;">(advice-add 'ivy-dispatching-done-hydra</span>
  <span style="font-weight: bold; font-style: italic;">;;               </span><span style="font-weight: bold; font-style: italic;">:around #'ad:ivy-dispatching-done-hydra))</span>
  )

(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(counsel-ibuffer counsel-M-x counsel-yank-pop)
       <span style="font-style: italic;">"counsel"</span> nil t)

  (global-set-key (kbd <span style="font-style: italic;">"M-x"</span>) 'counsel-M-x)
  (global-set-key (kbd <span style="font-style: italic;">"M-y"</span>) 'counsel-yank-pop)
  (global-set-key (kbd <span style="font-style: italic;">"C-,"</span>) 'counsel-mark-ring)
  (global-set-key (kbd <span style="font-style: italic;">"C-x C-b"</span>) 'counsel-ibuffer)
  (global-set-key (kbd <span style="font-style: italic;">"C-c i r"</span>) 'ivy-resume)

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"flyspell"</span>
    (define-key flyspell-mode-map (kbd <span style="font-style: italic;">"C-,"</span>) 'goto-last-change))

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"ivy"</span>

    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">M-o &#12434; ivy-dispatching-done-hydra &#12395;&#21106;&#12426;&#24403;&#12390;&#12427;&#65294;</span>
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(define-key ivy-minibuffer-map (kbd "M-o") 'ivy-dispatching-done-hydra)</span>
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">ivy-dispatching-done &#12434;&#20351;&#12358;&#65294;</span>
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(define-key ivy-minibuffer-map (kbd "M-o") 'ivy-dispatching-done)</span>
    (<span style="font-weight: bold;">setq</span> ivy-read-action-function #'ivy-hydra-read-action)

    (<span style="font-weight: bold;">setq</span> ivy-use-virtual-buffers nil)
    (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">setq</span> enable-recursive-minibuffers t)
      (minibuffer-depth-indicate-mode 1))
    (define-key ivy-minibuffer-map (kbd <span style="font-style: italic;">"&lt;escape&gt;"</span>) 'minibuffer-keyboard-quit)
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(setq ivy-truncate-lines nil) ;; &#36984;&#25246;&#20505;&#35036;&#12418;&#25240;&#12426;&#36820;&#12373;&#12428;&#12390;&#12375;&#12414;&#12358;&#65294;</span>
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(setq ivy-wrap t)</span>

    (ivy-mode 1))

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"counsel"</span>
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">counsel-M-x, see also prescient.el section</span>
    (<span style="font-weight: bold;">setq</span> ivy-initial-inputs-alist
          '((org-agenda-refile . <span style="font-style: italic;">"^"</span>)
            (org-capture-refile . <span style="font-style: italic;">"^"</span>)
            (counsel-describe-function . <span style="font-style: italic;">"^"</span>)
            (counsel-describe-variable . <span style="font-style: italic;">"^"</span>)
            (Man-completion-table . <span style="font-style: italic;">"^"</span>)
            (woman . <span style="font-style: italic;">"^"</span>)))

    (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">smex</span> nil t)
      (<span style="font-weight: bold;">setq</span> smex-history-length 35)
      (<span style="font-weight: bold;">setq</span> smex-completion-method 'ivy))

    (<span style="font-weight: bold;">unless</span> (fboundp 'seq-sort-by) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">emacs25</span>
      (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">seq-sort-by</span> (<span style="font-weight: bold;">function</span> pred sequence)
        <span style="font-style: italic;">"Sort SEQUENCE using PRED as a comparison function.</span>
<span style="font-style: italic;">Elements of SEQUENCE are transformed by FUNCTION before being</span>
<span style="font-style: italic;">sorted.  FUNCTION must be a function of one argument."</span>
        (seq-sort (<span style="font-weight: bold;">lambda</span> (a b)
                    (funcall pred
                             (funcall function a)
                             (funcall function b)))
                  sequence)))

    <span style="font-weight: bold; font-style: italic;">;;  </span><span style="font-weight: bold; font-style: italic;">https://github.com/abo-abo/swiper/issues/1294</span>
    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">ivy--sort-by-len</span> (name candidates)
      <span style="font-style: italic;">"Sort CANDIDATES based on similarity of their length with NAME."</span>
      (<span style="font-weight: bold;">let</span> ((name-len (length name))
            (candidates-count (length candidates)))
        (<span style="font-weight: bold;">if</span> (&lt; 500 candidates-count)
            candidates
          (seq-sort-by #'length
                       (<span style="font-weight: bold;">lambda</span> (a b)
                         (&lt; (abs (- name-len a))
                            (abs (- name-len b))))
                       candidates))))
    (<span style="font-weight: bold;">setf</span> (alist-get 'counsel-M-x ivy-sort-matches-functions-alist)
          #'ivy--sort-by-len)

    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Disable counsel-find-file</span>
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">https://emacs.stackexchange.com/questions/45929/disable-ivy-for-find-file</span>
    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-disable-counsel-find-file</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;rest</span> args)
      <span style="font-style: italic;">"Disable `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">counsel-find-file</span><span style="font-style: italic;">' and use the original `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">find-file</span><span style="font-style: italic;">' with ARGS."</span>
      (<span style="font-weight: bold;">let</span> ((completing-read-function #'completing-read-default)
            (completion-in-region-function #'completion--in-region))
        (apply #'read-file-name-default args)))
    (<span style="font-weight: bold;">setq</span> read-file-name-function #'my-disable-counsel-find-file)
    (define-key counsel-mode-map [remap find-file]  nil)

    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#12458;&#12522;&#12472;&#12490;&#12523;&#12434;&#38750;&#12452;&#12531;&#12479;&#12521;&#12463;&#12486;&#12451;&#12502;&#21270;</span>
    (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">find-func</span> nil t)
      (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">find-library</span> (library)
        <span style="font-style: italic;">"Override the original `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">find-library</span><span style="font-style: italic;">' to hide in command list."</span>
        (<span style="font-weight: bold;">prog1</span>
            (switch-to-buffer (find-file-noselect (find-library-name library)))
          (run-hooks 'find-function-after-hook))))

    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Common actions for counsel-ag, counsel-fzf, and counsel-recentf</span>
    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-counsel-fzf-in-default-dir</span> (_arg)
      <span style="font-style: italic;">"Search the current directory with fzf."</span>
      (counsel-fzf ivy-text default-directory))
    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-counsel-fzf-in-dir</span> (_arg)
      <span style="font-style: italic;">"Search again with new root directory."</span>
      (counsel-fzf ivy-text
                   (read-directory-name
                    (concat (car (split-string counsel-fzf-cmd))
                            <span style="font-style: italic;">" in directory: "</span>))))
    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-counsel-ag-in-dir</span> (_arg)
      <span style="font-style: italic;">"Search again with new root directory."</span>
      (<span style="font-weight: bold;">let</span> ((current-prefix-arg '(4)))
        (counsel-ag ivy-text nil <span style="font-style: italic;">""</span>))) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">also disable extra-ag-args</span>
    ))
</pre>
</div>
</div>
</div>

<div id="outline-container-org9c962eaf" class="outline-3">
<h3 id="org9c962eaf"><span class="section-number-3">6.35</span> [ivy.el] プロンプトをカスタマイズ</h3>
<div class="outline-text-3" id="text-org9c962eaf">
<p>
<code>ivy-pre-prompt-function</code> に文字列を返す任意の関数を与えると，プロンプトの前を修飾できます．好みの情報を出力しましょう．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#12503;&#12525;&#12531;&#12503;&#12488;&#12434;&#12459;&#12473;&#12479;&#12510;&#12452;&#12474;&#65288;&#12514;&#12540;&#12489;&#12521;&#12452;&#12531;&#38750;&#34920;&#31034;&#27966;&#21521;&#12369;&#65289;</span>
(<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"ivy"</span>
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-pre-prompt-function</span> ()
    (<span style="font-weight: bold;">if</span> window-system
        (format <span style="font-style: italic;">"%s%s "</span>
                (<span style="font-weight: bold;">if</span> my-toggle-modeline-global <span style="font-style: italic;">""</span> <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">FIXME</span>
                  (concat (make-string (frame-width) ?\x5F) <span style="font-style: italic;">"\n"</span>)) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">"__"</span>
                (all-the-icons-faicon <span style="font-style: italic;">"sort-amount-asc"</span>)) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">"&#61792;"</span>
      (format <span style="font-style: italic;">"%s\n"</span> (make-string (1- (frame-width)) ?\x2D))))
  (<span style="font-weight: bold;">setq</span> ivy-pre-prompt-function #'my-pre-prompt-function))
</pre>
</div>
</div>
</div>

<div id="outline-container-org45b3667a" class="outline-3">
<h3 id="org45b3667a"><span class="section-number-3">6.36</span> [imenu-list.el] サイドバー的にファイル内容の目次要素を表示</h3>
<div class="outline-text-3" id="text-org45b3667a">
<ul class="org-ul">
<li><a href="https://github.com/takaxp/imenu-list">takaxp/imenu-list: Emacs plugin to show the current buffer's imenu entries in a seperate buffer</a></li>
</ul>

<p>
↑のリポジトリは，オリジナルのコードに対して次の修正を加えています．
</p>
<ol class="org-ol">
<li>トップレベルのツリーで ENT する時，カーソルが imenu-list 側に残さない</li>
<li>最初の試行で imenu-list のバッファを生成できない時に以後のフローを正しく動かす</li>
</ol>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(imenu-list)
       <span style="font-style: italic;">"imenu-list"</span> nil t)

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"imenu-list"</span>
    (<span style="font-weight: bold;">setq</span> imenu-list-size 40)
    (<span style="font-weight: bold;">setq</span> imenu-list-position 'left)

    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-truncate-lines-activate</span> ()
      <span style="font-style: italic;">"Truncate lines on `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">imenu-list</span><span style="font-style: italic;">' buffer."</span>
      (toggle-truncate-lines 1))
    (add-hook 'imenu-list-major-mode-hook #'my-truncate-lines-activate)

    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-imenu-list-update</span> ()
      <span style="font-style: italic;">"Expand frame width by `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">moom-change-frame-width</span><span style="font-style: italic;">'."</span>
      (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">and</span> (memq imenu-list-position '(right left))
                 (not (get-buffer-window imenu-list-buffer-name t)))
        (moom-change-frame-width (+ (frame-width) imenu-list-size))))

    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-imenu-list-quit-window</span> ()
      <span style="font-style: italic;">"Shrink frame width by `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">moom-change-frame-width</span><span style="font-style: italic;">'."</span>
      (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">and</span> (memq imenu-list-position '(right left))
                 (not (get-buffer-window imenu-list-buffer-name t)))
        (moom-change-frame-width (- (frame-width) imenu-list-size))))

    (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">moom</span> nil t)
      (add-hook 'imenu-list-update-hook #'my-imenu-list-update)
      (advice-add 'imenu-list-quit-window <span style="font-weight: bold;">:after</span> #'my-imenu-list-quit-window))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org29951da5" class="outline-3">
<h3 id="org29951da5"><span class="section-number-3">6.37</span> [prescient.el] リスト項目の並び替えとイニシャル入力機能（ivy and company）</h3>
<div class="outline-text-3" id="text-org29951da5">
<p>
コマンド履歴を保存．コマンドのイニシャル入力を可能にする．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"prescient"</span>
  (<span style="font-weight: bold;">setq</span> prescient-aggressive-file-save t) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Merged!</span>
  (<span style="font-weight: bold;">setq</span> prescient-save-file
        (expand-file-name <span style="font-style: italic;">"~/.emacs.d/prescient-save.el"</span>))
  (prescient-persist-mode 1))

(<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"ivy"</span>
  (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">and</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">prescient</span> nil t)
             (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">ivy-prescient</span> nil t))
    (<span style="font-weight: bold;">setq</span> ivy-prescient-retain-classic-highlighting t)
    (<span style="font-weight: bold;">dolist</span> (command '(counsel-world-clock <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Merged!</span>
                       counsel-app))
      (add-to-list 'ivy-prescient-sort-commands command))
    (ivy-prescient-mode 1)
    (<span style="font-weight: bold;">setf</span> (alist-get 'counsel-M-x ivy-re-builders-alist)
          #'ivy-prescient-re-builder)
    (<span style="font-weight: bold;">setf</span> (alist-get t ivy-re-builders-alist) #'ivy--regex-ignore-order)))

(<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"company"</span>
  (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">and</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">prescient</span> nil t)
             (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">company-prescient</span> nil t))
    (company-prescient-mode 1)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf0e91c5a" class="outline-3">
<h3 id="orgf0e91c5a"><span class="section-number-3">6.38</span> <span class="todo TODO">TODO</span> [swiper.el] 文字列探索とプレビューを同時に行う</h3>
<div class="outline-text-3" id="text-orgf0e91c5a">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(swiper-thing-at-point swiper-all-thing-at-point)
       <span style="font-style: italic;">"swiper"</span> nil t)

  (global-set-key (kbd <span style="font-style: italic;">"M-s M-s"</span>) 'swiper-thing-at-point)
  (global-set-key (kbd <span style="font-style: italic;">"M-s M-a"</span>) 'swiper-all-thing-at-point)

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"swiper"</span>
    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">ad:swiper-thing-at-point</span> ()
      <span style="font-style: italic;">"`</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">swiper</span><span style="font-style: italic;">' with `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">ivy-thing-at-point</span><span style="font-style: italic;">'."</span>
      (<span style="font-weight: bold;">interactive</span>)
      (<span style="font-weight: bold;">let</span> ((thing (<span style="font-weight: bold;">if</span> (thing-at-point-looking-at <span style="font-style: italic;">"^\\*+"</span>) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">org heading &#12434;&#38500;&#22806;</span>
                       nil
                     (ivy-thing-at-point))))
        (<span style="font-weight: bold;">when</span> (use-region-p)
          (deactivate-mark))
        (swiper thing)))
    (advice-add 'swiper-thing-at-point <span style="font-weight: bold;">:override</span> #'ad:swiper-thing-at-point)))
</pre>
</div>
</div>
</div>
<div id="outline-container-org3d431f2e" class="outline-3">
<h3 id="org3d431f2e"><span class="section-number-3">6.39</span> <span class="todo TODO">TODO</span> [all-the-icons-ivy] ivy インターフェイスでアイコンを表示する</h3>
<div class="outline-text-3" id="text-org3d431f2e">
<ul class="org-ul">
<li><a href="https://github.com/asok/all-the-icons-ivy">https://github.com/asok/all-the-icons-ivy</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> window-system
  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"ivy"</span>
    (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">all-the-icons-ivy</span> nil t)
      (<span style="font-weight: bold;">dolist</span> (command '(counsel-projectile-switch-project
                         counsel-ibuffer))
        (add-to-list 'all-the-icons-ivy-buffer-commands command))
      (all-the-icons-ivy-setup))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org5eaeb687" class="outline-3">
<h3 id="org5eaeb687"><span class="section-number-3">6.40</span> <span class="todo TODO">TODO</span> [rainbow-delimiters.el] 対応するカッコに色を付ける</h3>
<div class="outline-text-3" id="text-org5eaeb687">
<p>
複数のカッコが重なる言語では，カッコの対応関係がひと目で理解し難い場合があります． <code>rainbow-delimiters</code> を使うと，対応するカッコを七色に色付けして見やすくできます．デフォルトだと色がパステル調で薄いので，パラメータを追加して調整します．
</p>

<p>
<code>org-block</code> 内でうまく動かないようなので，本格導入は様子見中です．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"rainbow-delimiters"</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">https://yoo2080.wordpress.com/2013/12/21/small-rainbow-delimiters-tutorial/</span>
  (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">cl-lib</span>)
  (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">color</span>)
  (<span style="font-weight: bold;">cl-loop</span>
   for index from 1 to rainbow-delimiters-max-face-count
   do
   (<span style="font-weight: bold;">let</span> ((face (intern (format <span style="font-style: italic;">"rainbow-delimiters-depth-%d-face"</span> index))))
     (<span style="font-weight: bold;">cl-callf</span> color-saturate-name (face-foreground face) 50))))

(add-hook 'prog-mode-hook
          (<span style="font-weight: bold;">lambda</span> ()
              (<span style="font-weight: bold;">unless</span> (equal (buffer-name) <span style="font-style: italic;">"*scratch*"</span>)
                (rainbow-delimiters-mode))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org7270262d" class="outline-3">
<h3 id="org7270262d"><span class="section-number-3">6.41</span> <span class="todo TODO">TODO</span> [yascroll.el] フリンジにスクロールバーを出す</h3>
<div class="outline-text-3" id="text-org7270262d">
<p>
<code>yascroll</code> を使います．
</p>

<ul class="org-ul">
<li><a href="http://d.hatena.ne.jp/m2ym/20110401/1301617991">http://d.hatena.ne.jp/m2ym/20110401/1301617991</a></li>
<li>2015-03-15: smooth-scroll との組み合わせで重いのを確認．</li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"postpone"</span>
  (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">yascroll</span> nil t)
    (<span style="font-weight: bold;">setq</span> yascroll:delay-to-hide 2)
    (<span style="font-weight: bold;">setq</span> yascroll:disabled-modes '(org-mode))
    (set-face-foreground 'yascroll:thumb-fringe <span style="font-style: italic;">"#b2cefb"</span>)
    (set-face-background 'yascroll:thumb-fringe <span style="font-style: italic;">"#b2cefb"</span>)
    (<span style="font-weight: bold;">unless</span> noninteractive
      (global-yascroll-bar-mode 1))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org8ba0784e" class="outline-3">
<h3 id="org8ba0784e"><span class="section-number-3">6.42</span> <span class="todo TODO">TODO</span> [dimmer.el] 現在のバッファ以外の輝度を落とす</h3>
<div class="outline-text-3" id="text-org8ba0784e">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(dimmer-mode dimmer-process-all dimmer-off dimmer-on
                     my-toggle-dimmer dimmer-permanent-off
                     ad:dimmer-org-agenda--quit)
       <span style="font-style: italic;">"dimmer"</span> nil t)

  (<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my-dimmer-mode</span> nil)

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"dimmer"</span>
    (custom-set-variables
     '(dimmer-exclusion-regexp
       <span style="font-style: italic;">"^\\*[Hh]elm</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">|</span><span style="font-style: italic;">^ \\*Minibuf</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">|</span><span style="font-style: italic;">^\\*scratch</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">|</span><span style="font-style: italic;">^ \\*Neo</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">|</span><span style="font-style: italic;">^ \\*Echo</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">|</span><span style="font-style: italic;">^\\*Calendar</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">|</span><span style="font-style: italic;">*Org</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">|</span><span style="font-style: italic;">^ \\*LV*"</span>)
     '(dimmer-fraction 0.6))

    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-toggle-dimmer</span> ()
      (<span style="font-weight: bold;">interactive</span>)
      (<span style="font-weight: bold;">if</span> (<span style="font-weight: bold;">setq</span> my-dimmer-mode (not my-dimmer-mode))
          (dimmer-on) (dimmer-off)))

    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">dimmer-permanent-off</span> ()
      (<span style="font-weight: bold;">setq</span> my-dimmer-mode nil)
      (dimmer-off))

    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">dimmer-off</span> ()
      (dimmer-process-all)
      (dimmer-mode -1))

    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">dimmer-on</span> ()
      (<span style="font-weight: bold;">when</span> my-dimmer-mode
        (dimmer-mode 1)
        (dimmer-process-all)))

    (add-hook 'focus-out-hook #'dimmer-off)
    (add-hook 'focus-in-hook #'dimmer-on)

    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">for org-agenda</span>
    (add-hook 'org-agenda-mode-hook #'dimmer-permanent-off)
    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">ad:dimmer-org-agenda--quit</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> _bury)
      (<span style="font-weight: bold;">when</span> (fboundp 'dimmer-on)
        (<span style="font-weight: bold;">setq</span> my-dimmer-mode t)
        (dimmer-on)
        (redraw-frame)))
    (advice-add 'org-agenda--quit <span style="font-weight: bold;">:after</span> #'ad:dimmer-org-agenda--quit)

    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">for swiper/helm-swoop</span>
    (add-hook 'minibuffer-setup-hook #'dimmer-off)
    (add-hook 'minibuffer-exit-hook #'dimmer-on))

  (<span style="font-weight: bold;">unless</span> noninteractive
    (<span style="font-weight: bold;">setq</span> my-dimmer-mode (dimmer-mode 1))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org1e701627" class="outline-3">
<h3 id="org1e701627"><span class="section-number-3">6.43</span> <span class="todo TODO">TODO</span> [hydra.el] コマンドディスパッチャを構築する</h3>
<div class="outline-text-3" id="text-org1e701627">
<ul class="org-ul">
<li><a href="https://www.wisdomandwonder.com/article/10763/emacsorg-mode-hydra-to-insert-timestamps">(Emacs+Org-Mode) Hydra To Insert Timestamps | Wisdom and Wonder</a></li>
<li><a href="https://oremacs.com/2016/04/04/hydra-doc-syntax/">Extended syntax for hydra docstrings · (or emacs</a></li>
</ul>

<p>
ディスパッチャ内の <code>docstring</code> には， <code>?x?</code> の形式で評価値を反映できる．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(hydra-timestamp/body)
       <span style="font-style: italic;">"hydra"</span> nil t)

  (global-set-key (kbd <span style="font-style: italic;">"C-c h t"</span>) #'hydra-timestamp/body)

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"hydra"</span>
    (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">org</span> nil t)
    (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">hydra</span> nil t)
    (global-set-key (kbd <span style="font-style: italic;">"C-c 0"</span>) #'help/insert-datestamp)
    (custom-set-faces
     '(hydra-face-blue
       ((((background light))
         <span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"orange red"</span> <span style="font-weight: bold;">:bold</span> t)
        (((background dark))
         <span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"orange"</span> <span style="font-weight: bold;">:bold</span> t))))

    (<span style="font-weight: bold;">defhydra</span> hydra-timestamp (<span style="font-weight: bold;">:color</span> blue <span style="font-weight: bold;">:hint</span> none)
      <span style="font-style: italic;">"</span>
<span style="font-style: italic;">   === Timestamp ===</span>
<span style="font-style: italic;">0. <i class="far fa-hand-point-right"></i> ?i? (_i_so 8601)   <i class="far fa-hand-point-right"></i> ?n? (_n_ow)   <i class="far fa-hand-point-right"></i> ?w? (_w_eek)   <i class="far fa-hand-point-right"></i> ?a? (week-d_a_y)</span>
<span style="font-style: italic;">_1_. <i class="far fa-hand-point-right"></i> ?t? (ISO 8601 including _t_imezone)</span>
<span style="font-style: italic;">_2_. <i class="far fa-hand-point-right"></i> ?r?    (Org Mode: _r_ight now)</span>
<span style="font-style: italic;">_3_. <i class="far fa-hand-point-right"></i> ?s?          (Org Mode: by _s_elect)                             _q_uit</span>
<span style="font-style: italic;">"</span>
      (<span style="font-style: italic;">"q"</span> nil)
      (<span style="font-style: italic;">"i"</span> help/insert-datestamp (format-time-string <span style="font-style: italic;">"%F"</span>))
      (<span style="font-style: italic;">"n"</span> help/insert-currenttime (format-time-string <span style="font-style: italic;">"%H:%M"</span>))
      (<span style="font-style: italic;">"w"</span> help/insert-week (format-time-string <span style="font-style: italic;">"%W"</span>))
      (<span style="font-style: italic;">"a"</span> help/insert-month-and-day (format-time-string <span style="font-style: italic;">"%m%d"</span>))
      (<span style="font-style: italic;">"t"</span> help/insert-timestamp (help/get-timestamp))
      (<span style="font-style: italic;">"r"</span> help/org-time-stamp-with-seconds-now
       (format-time-string <span style="font-style: italic;">"&lt;%F %a %H:%M&gt;"</span>))
      (<span style="font-style: italic;">"s"</span> org-time-stamp (format-time-string <span style="font-style: italic;">"&lt;%F %a&gt;"</span>))
      (<span style="font-style: italic;">"0"</span> help/show-my-date)
      (<span style="font-style: italic;">"1"</span> help/insert-timestamp)
      (<span style="font-style: italic;">"2"</span> help/org-time-stamp-with-seconds-now)
      (<span style="font-style: italic;">"3"</span> org-time-stamp))
    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">help/show-my-date</span> ()
      <span style="font-style: italic;">"Produces and show date and time in preferred format."</span>
      (<span style="font-weight: bold;">interactive</span>)
      (message (format-time-string <span style="font-style: italic;">"%Y-%m-%d (%a.) W:%W @%H:%M"</span>))
      (hydra-keyboard-quit))
    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">help/insert-currenttime</span> ()
      <span style="font-style: italic;">"Produces and inserts the current time."</span>
      (<span style="font-weight: bold;">interactive</span>)
      (insert (format-time-string <span style="font-style: italic;">"%H:%M"</span>)))
    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">help/insert-week</span> ()
      <span style="font-style: italic;">"Produces and inserts the week number."</span>
      (<span style="font-weight: bold;">interactive</span>)
      (insert (format-time-string <span style="font-style: italic;">"%W"</span>)))
    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">help/insert-month-and-day</span> ()
      <span style="font-style: italic;">"Inserts a month and day pair in 4-degits."</span>
      (<span style="font-weight: bold;">interactive</span>)
      (insert (format-time-string <span style="font-style: italic;">"%m%d"</span>)))
    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">help/insert-datestamp</span> ()
      <span style="font-style: italic;">"Produces and inserts a partial ISO 8601 format timestamp."</span>
      (<span style="font-weight: bold;">interactive</span>)
      (insert (format-time-string <span style="font-style: italic;">"%F"</span>)))
    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">help/insert-timestamp</span> ()
      <span style="font-style: italic;">"Inserts a full ISO 8601 format timestamp."</span>
      (<span style="font-weight: bold;">interactive</span>)
      (insert (help/get-timestamp)))
    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">help/org-time-stamp-with-seconds-now</span> ()
      (<span style="font-weight: bold;">interactive</span>)
      (<span style="font-weight: bold;">let</span> ((current-prefix-arg '(16)))
        (call-interactively 'org-time-stamp)))
    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">help/get-timestamp</span> ()
      <span style="font-style: italic;">"Produces a full ISO 8601 format timestamp."</span>
      (<span style="font-weight: bold;">interactive</span>)
      (<span style="font-weight: bold;">let*</span> ((timestamp-without-timezone (format-time-string <span style="font-style: italic;">"%Y-%m-%dT%T"</span>))
             (timezone-name-in-numeric-form (format-time-string <span style="font-style: italic;">"%z"</span>))
             (timezone-utf-offset
              (concat (substring timezone-name-in-numeric-form 0 3)
                      <span style="font-style: italic;">":"</span>
                      (substring timezone-name-in-numeric-form 3 5)))
             (timestamp (concat timestamp-without-timezone
                                timezone-utf-offset)))
        timestamp))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org56d8bf9d" class="outline-3">
<h3 id="org56d8bf9d"><span class="section-number-3">6.44</span> <span class="done DONE">DONE</span> [helm.el] 続・何でも絞り込みインターフェイス&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></h3>
<div class="outline-text-3" id="text-org56d8bf9d">
<p>
ivyに移行しました．
</p>

<p>
<code>M-s</code> を <code>helm-swoop</code> にあてていましたが， <code>M-s</code> を入り口にたくさんの検索系コマンドが割り振られているため <code>M-s M-s</code> に変えました．なお， <code>C-M-r</code> は本来，正規表現での逆検索(<code>isearch-backward-regexp</code>)に割り振らています．また， <code>C-M-l</code> は本来， <code>reposition-window</code> に割り当てられています．
</p>

<p>
以下の設定では， <code>helm</code> に関連するモジュールも多数含まれます． <code>helm</code> がキックされるタイミングで有効化させます．
</p>

<ul class="org-ul">
<li>helm-google</li>
<li>helm-swoop</li>
<li>helm-projectile</li>
<li>helm-bm</li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(helm-google)
       <span style="font-style: italic;">"helm-google"</span> nil t)

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"helm-google"</span>
    (custom-set-variables
     '(helm-google-tld <span style="font-style: italic;">"co.jp"</span>))))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(helm-swoop)
       <span style="font-style: italic;">"helm-swoop"</span> nil t)

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"postpone"</span>
        (global-set-key (kbd <span style="font-style: italic;">"M-s M-s"</span>) 'helm-swoop))

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"helm-swoop"</span>
    (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">helm-config</span> nil t)
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#12459;&#12540;&#12477;&#12523;&#12398;&#21336;&#35486;&#12364; org &#12398;&#35211;&#20986;&#12375;&#65288;*&#12398;&#38598;&#12414;&#12426;&#65289;&#12394;&#12425;&#26908;&#32034;&#23550;&#35937;&#12395;&#12375;&#12394;&#12356;&#65294;</span>
    (<span style="font-weight: bold;">setq</span> helm-swoop-pre-input-function
          (<span style="font-weight: bold;">lambda</span>()
            (<span style="font-weight: bold;">unless</span> (thing-at-point-looking-at <span style="font-style: italic;">"^\\*+"</span>)
              (thing-at-point 'symbol))))
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#37197;&#33394;&#35373;&#23450;</span>
    (set-face-attribute
     'helm-swoop-target-line-face nil <span style="font-weight: bold;">:background</span> <span style="font-style: italic;">"#FFEDDC"</span>)
    (set-face-attribute
     'helm-swoop-target-word-face nil <span style="font-weight: bold;">:background</span> <span style="font-style: italic;">"#FF5443"</span>)))

(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(helm-M-x
         helm-buffers-list helm-recentf
         helm-locate helm-descbinds
         helm-occur helm-flycheck helm-bookmarks)
       <span style="font-style: italic;">"helm-config"</span> nil t)

  (global-set-key (kbd <span style="font-style: italic;">"C-x C-b"</span>) 'helm-buffers-list)
  (global-set-key (kbd <span style="font-style: italic;">"C-M-r"</span>) 'helm-recentf)
  (global-set-key (kbd <span style="font-style: italic;">"M-x"</span>) 'helm-M-x)

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"postpone"</span>

    (global-set-key (kbd <span style="font-style: italic;">"C-M-l"</span>) 'helm-locate)
    (global-set-key (kbd <span style="font-style: italic;">"C-c f b"</span>) 'helm-bookmarks)
    (global-set-key (kbd <span style="font-style: italic;">"C-c o"</span>) 'helm-occur)
    (global-set-key (kbd <span style="font-style: italic;">"C-h d"</span>) 'helm-descbinds))

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"projectile"</span>
    (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">helm-projectile</span> nil t)
      <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">M-x helm-projectile-find-file (C-c p f)</span>
      (<span style="font-weight: bold;">setq</span> projectile-completion-system 'helm)
      <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">projectile.el &#12398;&#12461;&#12540;&#12496;&#12452;&#12531;&#12489;&#12434;&#12458;&#12540;&#12496;&#12540;&#12521;&#12452;&#12489;</span>
      (helm-projectile-toggle 1)))

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"helm-config"</span>
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(when (require 'helm-files nil t)</span>
    <span style="font-weight: bold; font-style: italic;">;;   </span><span style="font-weight: bold; font-style: italic;">(define-key helm-find-files-map</span>
    <span style="font-weight: bold; font-style: italic;">;;     </span><span style="font-weight: bold; font-style: italic;">(kbd "&lt;tab&gt;") 'helm-execute-persistent-action)</span>
    <span style="font-weight: bold; font-style: italic;">;;   </span><span style="font-weight: bold; font-style: italic;">(define-key helm-read-file-map</span>
    <span style="font-weight: bold; font-style: italic;">;;     </span><span style="font-weight: bold; font-style: italic;">(kbd "&lt;tab&gt;") 'helm-execute-persistent-action))</span>

    (<span style="font-weight: bold;">when</span> (memq window-system '(mac ns))
      (<span style="font-weight: bold;">setq</span> helm-locate-command <span style="font-style: italic;">"mdfind -name %s %s"</span>))

    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(require 'helm-css-scss nil t)</span>
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(require 'helm-emmet nil t)</span>
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(require 'helm-descbinds nil t)</span>

    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Configure helm-completing-read-handlers-alist after `(helm-mode 1)'</span>
    (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">helm</span> nil t)
      (helm-mode 1))

    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">helm-find-files &#12434;&#21628;&#12400;&#12379;&#12394;&#12356;</span>
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(add-to-list 'helm-completing-read-handlers-alist '(find-file . nil))</span>
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">helm-mode-ag &#12434;&#21628;&#12400;&#12379;&#12394;&#12356;</span>
    (add-to-list 'helm-completing-read-handlers-alist '(ag . nil))
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">helm-mode-org-set-tags &#12434;&#21628;&#12400;&#12379;&#12394;&#12356;</span>
    (add-to-list 'helm-completing-read-handlers-alist '(org-set-tags . nil))

    (<span style="font-weight: bold;">setq</span> helm-display-source-at-screen-top nil)
    <span style="font-weight: bold; font-style: italic;">;;         </span><span style="font-weight: bold; font-style: italic;">(setq helm-display-header-line nil)</span>
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">helm-autoresize-mode &#12434;&#26377;&#21177;&#12395;&#12375;&#12388;&#12388; 30% &#12395;&#22266;&#23450;</span>
    (<span style="font-weight: bold;">setq</span> helm-autoresize-max-height 30)
    (<span style="font-weight: bold;">setq</span> helm-autoresize-min-height 30)
    (set-face-attribute 'helm-source-header nil
                        <span style="font-weight: bold;">:height</span> 1.0 <span style="font-weight: bold;">:family</span> <span style="font-style: italic;">"Verdana"</span> <span style="font-weight: bold;">:weight</span> 'normal
                        <span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#666666"</span> <span style="font-weight: bold;">:background</span> <span style="font-style: italic;">"#DADADA"</span>)
    (helm-autoresize-mode 1)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc00267d7" class="outline-3">
<h3 id="orgc00267d7"><span class="section-number-3">6.45</span> <span class="done DONE">DONE</span> バッテリー情報をモードラインに表示する&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></h3>
<div class="outline-text-3" id="text-orgc00267d7">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Show battery information on the mode line.</span>
(display-battery-mode t)
</pre>
</div>
</div>
</div>

<div id="outline-container-org205dbe20" class="outline-3">
<h3 id="org205dbe20"><span class="section-number-3">6.46</span> <span class="done DONE">DONE</span> [mode-icons] 使用中のモード表示をアイコンで代替&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></h3>
<div class="outline-text-3" id="text-org205dbe20">
<p>
しばらく使ってみたが，統一感が失われるので使用停止中．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">mode-icons</span> nil t)
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#12450;&#12452;&#12467;&#12531;&#12434;&#20445;&#23384;&#12375;&#12390;&#12356;&#12427;&#12487;&#12451;&#12524;&#12463;&#12488;&#12522;&#12434;&#25351;&#23450;</span>
  (<span style="font-weight: bold;">setq</span> mode-icons--directory
        (expand-file-name <span style="font-style: italic;">"~/.emacs.d/.cask/package/icons"</span>))
  (mode-icons-mode 1))
</pre>
</div>
</div>
</div>

<div id="outline-container-org6e56a94f" class="outline-3">
<h3 id="org6e56a94f"><span class="section-number-3">6.47</span> <span class="done DONE">DONE</span> [stock-ticker] 株価をモードラインに表示&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></h3>
<div class="outline-text-3" id="text-org6e56a94f">
<p>
季節が過ぎ去りました．不使用です．
</p>

<p>
日経平均やダウ平均の状況をモードラインに表示します．表示が長くなる傾向があるので， <code>stock-ticker--parse</code> を再定義して，銘柄（3桁のみ）と変動率だけを表示しています．
</p>

<p>
起動時には不要なので，ウィンドウにフォーカスが移った時に開始して，さらに1分でモードラインから消えるようにしています．
</p>

<p>
色々と不安定になってきたので，最近は使っていません．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(my-activate-stock-ticker stock-ticker-global-mode)
       <span style="font-style: italic;">"stock-ticker"</span> nil t)

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"stock-ticker"</span>
    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">stock-ticker--parse</span> (data)
      <span style="font-style: italic;">"Parse financial DATA into list of display strings."</span>
      (<span style="font-weight: bold;">let</span> ((qs (assoc-default
                 'quote (assoc-default
                         'results (assoc-default 'query data)))))
        (mapcar
         (<span style="font-weight: bold;">lambda</span> (q)
           (<span style="font-weight: bold;">let</span> ((percent (assoc-default 'PercentChange q))
                 (name (assoc-default 'Name q))
                 (symbol (assoc-default 'Symbol q))
                 (change (assoc-default 'Change q)))
             (format <span style="font-style: italic;">" %s:%s"</span>
                     (substring
                      (<span style="font-weight: bold;">if</span> (<span style="font-weight: bold;">or</span>
                           (string-match <span style="font-style: italic;">"="</span> symbol)
                           (string-match <span style="font-style: italic;">"\\^"</span> symbol))
                          name symbol) <span style="font-weight: bold;">0 3)</span>
                     (<span style="font-weight: bold;">if</span> percent percent <span style="font-style: italic;">""</span>))))
         qs)))
    (<span style="font-weight: bold;">setq</span> stock-ticker-display-interval 5)
    (<span style="font-weight: bold;">setq</span> stock-ticker-symbols '(<span style="font-style: italic;">"^N225"</span> <span style="font-style: italic;">"DOW"</span>))
    (<span style="font-weight: bold;">setq</span> stock-ticker-update-interval 300)

    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-activate-stock-ticker</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> duration)
      <span style="font-style: italic;">"Activate stock-ticker within the given duration."</span>
      (stock-ticker-global-mode 1)
      (<span style="font-weight: bold;">unless</span> (numberp duration)
        (<span style="font-weight: bold;">setq</span> duration 90))
      (run-with-timer duration nil 'stock-ticker-global-mode -1)))

  (add-hook 'focus-in-hook #'my-activate-stock-ticker))
</pre>
</div>
</div>
</div>

<div id="outline-container-org0ed58559" class="outline-3">
<h3 id="org0ed58559"><span class="section-number-3">6.48</span> <span class="done DONE">DONE</span> [zlc.el] find-file バッファを zsh ライクにする&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></h3>
<div class="outline-text-3" id="text-org0ed58559">
<p>
ファイル選択を zsh ライクに変更できます．しっくりこないので不使用．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">zlc</span> nil t)
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">http://d.hatena.ne.jp/mooz/20101003/p1</span>
  (set-face-attribute 'zlc-selected-completion-face nil
                      <span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#000000"</span> <span style="font-weight: bold;">:background</span> <span style="font-style: italic;">"#9DFFD2"</span> <span style="font-weight: bold;">:bold</span> t)
  <span style="font-weight: bold; font-style: italic;">;;    </span><span style="font-weight: bold; font-style: italic;">(setq zlc-select-completion-immediately t)</span>
  (<span style="font-weight: bold;">let</span> ((map minibuffer-local-map))
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">like menu select</span>
    (define-key map (kbd <span style="font-style: italic;">"C-n"</span>) 'zlc-select-next-vertical)
    (define-key map (kbd <span style="font-style: italic;">"C-p"</span>) 'zlc-select-previous-vertical)
    (define-key map (kbd <span style="font-style: italic;">"C-f"</span>) 'zlc-select-next)
    (define-key map (kbd <span style="font-style: italic;">"C-b"</span>) 'zlc-select-previous)
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">reset selection</span>
    (define-key map (kbd <span style="font-style: italic;">"C-c"</span>) 'zlc-reset))

  (zlc-mode 1))
</pre>
</div>
</div>
</div>

<div id="outline-container-org5cc37356" class="outline-3">
<h3 id="org5cc37356"><span class="section-number-3">6.49</span> <span class="done DONE">DONE</span> [stripe-buffer.el] テーブルの色をストライプにする&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></h3>
<div class="outline-text-3" id="text-org5cc37356">
<p>
<a href="https://github.com/sabof/stripe-buffer/blob/master/stripe-buffer.el">stripe-buffer.el</a>を使います．重くツリーが多いOrgバッファだと激重になる可能性があります．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(turn-on-stripe-table-mode)
       <span style="font-style: italic;">"stripe-buffer"</span> nil t)

  (add-hook 'org-mode-hook #'turn-on-stripe-table-mode))
</pre>
</div>
</div>
</div>

<div id="outline-container-org62c6f085" class="outline-3">
<h3 id="org62c6f085"><span class="section-number-3">6.50</span> <span class="done DONE">DONE</span> [guide-key] キーバインドの選択肢をポップアップする&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></h3>
<div class="outline-text-3" id="text-org62c6f085">
<p>
<code>which-key</code> に移行しました．
</p>

<p>
自分用の関数にキーバインドを付けたのはいいけど，覚えられない時に使っています．以下の例では， <code>helm</code> もしくは <code>org</code> が読み込まれた時についでに有効化し， <code>C-c f</code> を押して， 0.5秒経つと，その後ろに続くキーの一覧がポップします．すでに覚えたキーバインドならば，0.5秒以内に打てるでしょうから，ポップ表示無しで通常通りにコマンドが発行します．色分けも効くのでわかりやすいです．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(guide-key-mode)
       <span style="font-style: italic;">"guide-key"</span> nil t)

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"guide-key"</span>
    (<span style="font-weight: bold;">setq</span> guide-key/guide-key-sequence '(<span style="font-style: italic;">"C-c f"</span> <span style="font-style: italic;">"C-c f c"</span>))
    (<span style="font-weight: bold;">setq</span> guide-key/popup-window-position 'bottom)
    (<span style="font-weight: bold;">setq</span> guide-key/idle-delay 0.5)
    (<span style="font-weight: bold;">setq</span> guide-key/highlight-command-regexp
          '((<span style="font-style: italic;">"my-"</span> . <span style="font-style: italic;">"red"</span>)
            (<span style="font-style: italic;">"takaxp:"</span> . <span style="font-style: italic;">"blue"</span>))))

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"org"</span>
    (guide-key-mode 1))

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"postpone"</span>
    (<span style="font-weight: bold;">unless</span> noninteractive
      (guide-key-mode 1))))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdf971702" class="outline-3">
<h3 id="orgdf971702"><span class="section-number-3">6.51</span> <span class="done DONE">DONE</span> [anything.el] 何でも絞り込みインターフェイス&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></h3>
<div class="outline-text-3" id="text-orgdf971702">
<ul class="org-ul">
<li>helm に移行しました．</li>
</ul>

<p>
<a href="http://svn.coderepos.org/share/lang/elisp/anything-c-moccur/trunk/anything-c-moccur.el">http://svn.coderepos.org/share/lang/elisp/anything-c-moccur/trunk/anything-c-moccur.el</a>
<a href="http://d.hatena.ne.jp/IMAKADO/20080724/1216882563">http://d.hatena.ne.jp/IMAKADO/20080724/1216882563</a>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(anything-other-buffer
         anything-complete anything-M-x
         anything-c-moccur-occur-by-moccur)
       <span style="font-style: italic;">"anything-startup"</span> nil t)

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"anything-startup"</span>
    (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">anything-c-moccur</span> nil t)
    <span style="font-weight: bold; font-style: italic;">;;  </span><span style="font-weight: bold; font-style: italic;">(setq moccur-split-word t)</span>
    <span style="font-weight: bold; font-style: italic;">;;  </span><span style="font-weight: bold; font-style: italic;">(setq anything-c-locate-options `("locate" "-w"))</span>

    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">M-x install-elisp-from-emacswiki recentf-ext.el</span>
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">http://www.emacswiki.org/cgi-bin/wiki/download/recentf-ext.el</span>
    <span style="font-weight: bold; font-style: italic;">;;  </span><span style="font-weight: bold; font-style: italic;">(autoload-if-found 'recentf-ext "recentf-ext" nil t)</span>
    <span style="font-weight: bold; font-style: italic;">;;              </span><span style="font-weight: bold; font-style: italic;">(require 'recentf-ext nil t)</span>

    (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">migemo</span> nil t)
      (<span style="font-weight: bold;">setq</span> moccur-use-migemo t))
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">M-x anything-grep-by-name</span>
    (<span style="font-weight: bold;">setq</span> anything-grep-alist
          '((<span style="font-style: italic;">"Org-files"</span> (<span style="font-style: italic;">"egrep -Hin %s *.org"</span> <span style="font-style: italic;">"~/Dropbox/org/"</span>))
            (<span style="font-style: italic;">".emacs.d"</span> (<span style="font-style: italic;">"egrep -Hin %s *.el"</span> <span style="font-style: italic;">"~/.emacs.d/"</span>))
            (<span style="font-style: italic;">"ChangeLog"</span> (<span style="font-style: italic;">"egrep -Hin %s ChangeLog"</span> <span style="font-style: italic;">"~/"</span>))))
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">("Spotlight" ("mdfind %s -onlyin ~/Dropbox/Documents/Library/" ""))))</span>

    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-anything</span> ()
      (<span style="font-weight: bold;">interactive</span>)
      (anything-other-buffer
       '(anything-c-source-recentf
         anything-c-source-file-name-history
         anything-c-source-buffers
         anything-c-source-emacs-commands
         anything-c-source-locate)
       <span style="font-style: italic;">" *my-anything*"</span>))

    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-anything-buffer</span> ()
      (<span style="font-weight: bold;">interactive</span>)
      (anything-other-buffer
       '(anything-c-source-buffers)
       <span style="font-style: italic;">" *my-anthing-buffer*"</span>))

    (<span style="font-weight: bold;">when</span> (memq window-system '(mac ns))
      (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-anything-spotlight</span> ()
        <span style="font-style: italic;">"Spotlight search with anything.el"</span>
        (<span style="font-weight: bold;">interactive</span>)
        (anything-other-buffer
         '(anything-c-source-mac-spotlight)
         <span style="font-style: italic;">" *anything-spotlight*"</span>)))

    (<span style="font-weight: bold;">setq</span> anything-candidate-number-limit 50) <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">50</span>
    (<span style="font-weight: bold;">setq</span> anything-input-idle-delay 0.1)      <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">0.1</span>
    (<span style="font-weight: bold;">setq</span> anything-idle-delay 0.5)            <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">0.5</span>
    (<span style="font-weight: bold;">setq</span> anything-quick-update nil))        <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">nil</span>

  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Show ibuffer powered by anything</span>
  <span style="font-weight: bold; font-style: italic;">;;  </span><span style="font-weight: bold; font-style: italic;">(with-eval-after-load "anything-startup"</span>
  (global-set-key (kbd <span style="font-style: italic;">"M-x"</span>) 'anything-M-x)
  (global-set-key (kbd <span style="font-style: italic;">"C-c o"</span>) 'anything-c-moccur-occur-by-moccur)
  (global-set-key (kbd <span style="font-style: italic;">"C-M-r"</span>) 'my-anything)
  (global-set-key (kbd <span style="font-style: italic;">"C-M-s"</span>) 'my-anything-spotlight)
  (global-set-key (kbd <span style="font-style: italic;">"C-x C-b"</span>) 'my-anything-buffer))
</pre>
</div>
</div>
</div>

<div id="outline-container-org83eaaf3a" class="outline-3">
<h3 id="org83eaaf3a"><span class="section-number-3">6.52</span> <span class="done DONE">DONE</span> [diminish.el] モードラインのモード名を短くする&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></h3>
<div class="outline-text-3" id="text-org83eaaf3a">
<p>
以前は自作したパッケージを使っていましたが，不具合も多く，調べると <code>diminish.el</code> という素晴らしいパッケージがあったので移行しました．これはマイナーモードの短縮表示なので，メジャーモードは個別にフックで <code>mode-name</code> を書き換えて対応します． <code>use-package.el</code> を使っていると依存関係から自動的にインストールされます．
</p>

<p>
<code>diminish.el</code> を使えば，短縮名に書き換えることも，存在自体を消してしまうこともできます．helm だけ行儀が悪いので，後段での設定時に diminish を呼ぶようにしています．代替パッケージに，<a href="https://github.com/Malabarba/rich-minority">rich-minority-mode</a>があります．
</p>

<p>
メジャーモードの短縮表示は <code>diminish</code> に頼らず，単純に各モードの <code>hook</code> で対処します．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"postpone"</span>
  (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">diminish</span> nil t)
    (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"ggtags"</span> (diminish 'ggtags-mode <span style="font-style: italic;">" G"</span>))
    (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"org"</span> (diminish 'orgstruct-mode <span style="font-style: italic;">" OrgS"</span>))
    (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"centered-cursor-mode"</span>
      (diminish 'centered-cursor-mode))
    (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"volatile-highlights"</span>
      (diminish 'volatile-highlights-mode))
    (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"aggressive-indent"</span>
      (diminish 'aggressive-indent-mode))
    (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"all-the-icons-dired"</span>
      (diminish 'all-the-icons-dired-mode))
    (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"yasnippet"</span> (diminish 'yas-minor-mode))
    (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"auto-complete"</span> (diminish 'auto-complete-mode))
    (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"ws-butler"</span> (diminish 'ws-butler-mode))
    (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"isearch"</span> (diminish 'isearch-mode))
    (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"autorevert"</span> (diminish 'auto-revert-mode))
    (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"smooth-scroll"</span> (diminish 'smooth-scroll-mode))
    (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"whitespace"</span> (diminish 'global-whitespace-mode))
    (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"emmet-mode"</span> (diminish 'emmet-mode))
    (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"abbrev"</span> (diminish 'abbrev-mode))
    (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"doxymacs"</span> (diminish 'doxymacs-mode))
    (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"editorconfig"</span> (diminish 'editorconfig-mode))
    (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"rainbow-mode"</span> (diminish 'rainbow-mode))
    (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"guide-key"</span> (diminish 'guide-key-mode))
    (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"highlight-symbol"</span> (diminish 'highlight-symbol-mode))
    (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"which-key"</span> (diminish 'which-key-mode))
    (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"fancy-narrow"</span> (diminish 'fancy-narrow-mode))
    (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"smartparens"</span> (diminish 'smartparens-mode))
    (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"selected"</span> (diminish 'selected-minor-mode))
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(with-eval-after-load "org-autolist" (diminish 'org-autolist-mode))</span>
   <span style="font-weight: bold; font-style: italic;">;;;  </span><span style="font-weight: bold; font-style: italic;">(with-eval-after-load "helm" (diminish 'helm-mode " H"))</span>
    ))

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#12513;&#12472;&#12515;&#12540;&#12514;&#12540;&#12489;&#12398;&#30701;&#32302;</span>
(add-hook 'c-mode-hook (<span style="font-weight: bold;">lambda</span> () (<span style="font-weight: bold;">setq</span> mode-name <span style="font-style: italic;">"C"</span>)))
(add-hook 'js2-mode-hook (<span style="font-weight: bold;">lambda</span> () (<span style="font-weight: bold;">setq</span> mode-name <span style="font-style: italic;">"JS"</span>)))
(add-hook 'c++-mode-hook (<span style="font-weight: bold;">lambda</span> () (<span style="font-weight: bold;">setq</span> mode-name <span style="font-style: italic;">"C++"</span>)))
(add-hook 'csharp-mode-hook (<span style="font-weight: bold;">lambda</span> () (<span style="font-weight: bold;">setq</span> mode-name <span style="font-style: italic;">"C#"</span>)))
(add-hook 'prog-mode-hook (<span style="font-weight: bold;">lambda</span> () (<span style="font-weight: bold;">setq</span> mode-name <span style="font-style: italic;">"Pr"</span>)))
(add-hook 'emacs-lisp-mode-hook (<span style="font-weight: bold;">lambda</span> () (<span style="font-weight: bold;">setq</span> mode-name <span style="font-style: italic;">"El"</span>)))
(add-hook 'python-mode-hook (<span style="font-weight: bold;">lambda</span> () (<span style="font-weight: bold;">setq</span> mode-name <span style="font-style: italic;">"Py"</span>)))
(add-hook 'perl-mode-hook (<span style="font-weight: bold;">lambda</span> () (<span style="font-weight: bold;">setq</span> mode-name <span style="font-style: italic;">"Pl"</span>)))
(add-hook 'web-mode-hook (<span style="font-weight: bold;">lambda</span> () (<span style="font-weight: bold;">setq</span> mode-name <span style="font-style: italic;">"W"</span>)))
(add-hook 'change-log-mode-hook (<span style="font-weight: bold;">lambda</span> () (<span style="font-weight: bold;">setq</span> mode-name <span style="font-style: italic;">"ChangeLog"</span>)))
(add-hook 'lisp-interaction-mode-hook (<span style="font-weight: bold;">lambda</span> () (<span style="font-weight: bold;">setq</span> mode-name <span style="font-style: italic;">"Lisp"</span>)))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org9ff300b4" class="outline-2">
<h2 id="org9ff300b4"><span class="section-number-2">7</span> メディアサポート</h2>
<div class="outline-text-2" id="text-org9ff300b4">
</div>
<div id="outline-container-orgcf4022fd" class="outline-3">
<h3 id="orgcf4022fd"><span class="section-number-3">7.1</span> [emms.el] メディアプレーヤー</h3>
<div class="outline-text-3" id="text-orgcf4022fd">
<p>
<code>mpv</code> を使い，emacs からメディアファイルを再生します． <code>bongo.el</code> よりも使いやすい印象．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(emms-play-file
         emms-play-playlist emms-play-directory my-play-bgm
         emms-next emms-previous emms-stop emms-pause)
       <span style="font-style: italic;">"emms"</span> nil t)

  (global-set-key (kbd <span style="font-style: italic;">"C-c e b"</span>) 'my-play-bgm)
  (<span style="font-weight: bold;">let</span> ((base <span style="font-style: italic;">"C-c e "</span>))
    (global-set-key (kbd (concat base <span style="font-style: italic;">"n"</span>)) 'emms-next)
    (global-set-key (kbd (concat base <span style="font-style: italic;">"p"</span>)) 'emms-previous)
    (global-set-key (kbd (concat base <span style="font-style: italic;">"s"</span>)) 'emms-stop)
    (global-set-key (kbd (concat base <span style="font-style: italic;">"SPC"</span>)) 'emms-pause))

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"emms-mode-line"</span>
    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">ad:emms-mode-line-playlist-current</span> ()
      <span style="font-style: italic;">"Display filename in mode-line, not full-path."</span>
      (format emms-mode-line-format
              (file-name-nondirectory
               (emms-track-description
                (emms-playlist-current-selected-track)))))
    (advice-add 'emms-mode-line-playlist-current <span style="font-weight: bold;">:override</span>
                #'ad:emms-mode-line-playlist-current))

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"emms-mode-line-icon"</span>
    (<span style="font-weight: bold;">setq</span> emms-mode-line-format <span style="font-style: italic;">"%s"</span>)
    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">ad:emms-mode-line-icon-function</span> ()
      <span style="font-style: italic;">"Replace the default musical note icon with a Unicode character."</span>
      (concat <span style="font-style: italic;">" "</span>
              emms-mode-line-icon-before-format
              <span style="font-style: italic;">"&#9834;"</span>
              (emms-mode-line-playlist-current)))
    (advice-add 'emms-mode-line-icon-function <span style="font-weight: bold;">:override</span>
                #'ad:emms-mode-line-icon-function))

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"emms"</span>
    (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">emms-setup</span> nil t)
      (emms-standard)
      (emms-default-players))

    (<span style="font-weight: bold;">unless</span> noninteractive
      (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">org-emms</span> nil t)) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">emms &#12398;&#12522;&#12531;&#12463;&#12395;&#23550;&#24540;&#12373;&#12379;&#12427;</span>
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(require 'helm-emms nil t)</span>

    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-play-bgm</span> ()
      (<span style="font-weight: bold;">interactive</span>)
      (<span style="font-weight: bold;">let</span> ((file <span style="font-style: italic;">"~/Dropbox/12-audio/ffximusic104.m4a"</span>))
        (<span style="font-weight: bold;">when</span> (file-exists-p file)
          (emms-play-file file)
          (emms-toggle-repeat-track))))

    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">setup an additional player</span>
    (<span style="font-weight: bold;">if</span> (executable-find <span style="font-style: italic;">"mpv"</span>)
        (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">emms-player-mpv</span> nil t)
          (add-to-list 'emms-player-list 'emms-player-mpv)

          <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(defvar emms-player-mpv-ontop nil)</span>
          <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(defun emms-player-mpv-toggle-ontop ()</span>
          <span style="font-weight: bold; font-style: italic;">;;   </span><span style="font-weight: bold; font-style: italic;">"Toggle float on top."</span>
          <span style="font-weight: bold; font-style: italic;">;;   </span><span style="font-weight: bold; font-style: italic;">(interactive)</span>
          <span style="font-weight: bold; font-style: italic;">;;   </span><span style="font-weight: bold; font-style: italic;">(if emms-player-mpv-ontop</span>
          <span style="font-weight: bold; font-style: italic;">;;       </span><span style="font-weight: bold; font-style: italic;">(emms-player-mpv-disable-ontop)</span>
          <span style="font-weight: bold; font-style: italic;">;;     </span><span style="font-weight: bold; font-style: italic;">(emms-player-mpv-enable-ontop)))</span>

          <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(defun emms-player-mpv-enable-ontop ()</span>
          <span style="font-weight: bold; font-style: italic;">;;   </span><span style="font-weight: bold; font-style: italic;">"Enable float on top."</span>
          <span style="font-weight: bold; font-style: italic;">;;   </span><span style="font-weight: bold; font-style: italic;">(let ((cmd (emms-player-mpv--format-command "set ontop yes")))</span>
          <span style="font-weight: bold; font-style: italic;">;;     </span><span style="font-weight: bold; font-style: italic;">(call-process-shell-command cmd nil nil nil))</span>
          <span style="font-weight: bold; font-style: italic;">;;   </span><span style="font-weight: bold; font-style: italic;">(setq emms-player-mpv-ontop t))</span>

          <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(defun emms-player-mpv-disable-ontop ()</span>
          <span style="font-weight: bold; font-style: italic;">;;   </span><span style="font-weight: bold; font-style: italic;">"Disable float on top."</span>
          <span style="font-weight: bold; font-style: italic;">;;   </span><span style="font-weight: bold; font-style: italic;">(let ((cmd (emms-player-mpv--format-command "set ontop no")))</span>
          <span style="font-weight: bold; font-style: italic;">;;     </span><span style="font-weight: bold; font-style: italic;">(call-process-shell-command cmd nil nil nil))</span>
          <span style="font-weight: bold; font-style: italic;">;;   </span><span style="font-weight: bold; font-style: italic;">(setq emms-player-mpv-ontop nil))</span>

          <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(global-set-key (kbd "C-c e t") 'emms-player-mpv-toggle-ontop)</span>
          )

      (message <span style="font-style: italic;">"--- mpv is NOT installed."</span>))))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgca126930" class="outline-3">
<h3 id="orgca126930"><span class="section-number-3">7.2</span> [GoogleMaps.el] GoogleMaps を Emacs 内で使う</h3>
<div class="outline-text-3" id="text-orgca126930">
<ul class="org-ul">
<li>ネタとして最高の出来</li>
</ul>

<p>
<a href="http://julien.danjou.info/software/google-maps.el">http://julien.danjou.info/software/google-maps.el</a>
</p>

<p>
<code>M-x google-maps</code> で起動します．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(google-maps)
       <span style="font-style: italic;">"google-maps"</span> nil t)

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"google-maps"</span>
    (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">org-location-google-maps</span> nil t)))
</pre>
</div>

<p>
<code>+/-</code> でズーム， <code>矢印</code> で移動， <code>q</code> で終了します．また， <code>w</code> でURLを取得してコピー， <code>t</code> で地図の種別を変更できます．
</p>

<p>
Org-mode を使っている場合には， <code>C-c M-L</code> で表示されるプロンプトで検索すると，プロパティにそのキーワードが記録されます．後から <code>C-c M-l</code> すれば，いつでも地図を表示できるようになります．
</p>
</div>
</div>

<div id="outline-container-org41faa552" class="outline-3">
<h3 id="org41faa552"><span class="section-number-3">7.3</span> [japanlaw.el] Emacs 電子六法</h3>
<div class="outline-text-3" id="text-org41faa552">
<p>
Emacs で総務省の「<a href="http://law.e-gov.go.jp/">法令データ提供システム</a>」に登録された法令データを閲覧します． <code>w3m</code> が必要です．
</p>

<ul class="org-ul">
<li><a href="http://www.ne.jp/asahi/alpha/kazu/laws.html">Emacs 電子六法</a></li>
<li><a href="https://github.com/mhayashi1120/japanlaw.el">mhayashi1120/japanlaw.el: Emacs 電子六法</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">if</span> (executable-find <span style="font-style: italic;">"w3m"</span>)
    (autoload-if-found
     '(japanlaw)
     <span style="font-style: italic;">"japanlaw"</span> nil t)

  (message <span style="font-style: italic;">"--- w3m is NOT installed."</span>))
</pre>
</div>
</div>
</div>

<div id="outline-container-org8e8f85ec" class="outline-3">
<h3 id="org8e8f85ec"><span class="section-number-3">7.4</span> [sunshine.el] 天気を知る</h3>
<div class="outline-text-3" id="text-org8e8f85ec">
<ul class="org-ul">
<li><a href="https://openweathermap.org/">https://openweathermap.org/</a> にアカウントを作り，APIを呼び出すための専用IDを発行する必要があります．取得した idを， <code>sunshine-appid</code> に格納し， <code>sunshine-location</code> で対象地域を設定すれば， <code>M-x sunshine-forecast</code> で天気が表示されます． <code>M-x sunshine-quick-format</code> を使うと，結果がミニバッファに表示されます．</li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(sunshine-forecast sunshine-quick-forecast)
       <span style="font-style: italic;">"sunshine"</span> nil t)

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"sunshine"</span>
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(setq sunshine-location "Tokyo, Japan")</span>
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(setq sunshine-appid "................................")</span>
    (custom-set-variables
     '(sunshine-show-icons t)
     '(sunshine-units 'metric))))
</pre>
</div>
</div>
</div>
<div id="outline-container-orgb77ecd7a" class="outline-3">
<h3 id="orgb77ecd7a"><span class="section-number-3">7.5</span> [org-google-weather.el] org-agenda に天気を表示する&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></h3>
<div class="outline-text-3" id="text-orgb77ecd7a">
<p>
残念ながら Google API が変更になり動かなくなったそうです．
</p>

<p>
<a href="http://julien.danjou.info/software/google-weather.el">http://julien.danjou.info/software/google-weather.el</a>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">google-weather</span> nil t)
(<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">org-google-weather</span> nil t)
  '(org-google-weather-use-google-icons t))
</pre>
</div>
</div>
</div>
<div id="outline-container-org474263ad" class="outline-3">
<h3 id="org474263ad"><span class="section-number-3">7.6</span> [bongo.el] Emacsのバッファで音楽ライブラリを管理する&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></h3>
<div class="outline-text-3" id="text-org474263ad">
<p>
<a href="https://pxaka.tokyo/wiki/doku.php?id=emacs">iTunes の代わりに Emacs を使う</a>
</p>

<p>
autoload を設定すると， <code>*.bango-playlist</code> や <code>*.bongo-library</code> から起動できないので，明示的に require している．なお，bongo-mplayer を使う場合，bongo を先にrequireするとうまく動作しない（bongo.el の最後で，bongo-mplayer が provide されているからだと思われる）．
</p>

<p>
以下の設定では，autoload で使いつつ，=M-x init-bongo= でプレイリストを読み込んでいる．これならば，Emacs起動時は軽量で，かつ，プレイリストの訪問で Bongo を開始できる．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(bongo)
       <span style="font-style: italic;">"bongo-mplayer"</span> nil t)

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"bongo-mplayer"</span>
    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">init-bongo</span> ()
      (<span style="font-weight: bold;">interactive</span>)
      (bongo)
      (find-file <span style="font-style: italic;">"~/Desktop/next/Tidy/hoge.bongo-playlist"</span>))

    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Volume control</span>
    <span style="font-weight: bold; font-style: italic;">;;         </span><span style="font-weight: bold; font-style: italic;">(require volume.el nil t)</span>
    (<span style="font-weight: bold;">setq</span> bongo-mplayer-extra-arguments '(<span style="font-style: italic;">"-volume"</span> <span style="font-style: italic;">"1"</span>))
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Avoid error when editing bongo buffers</span>
    (<span style="font-weight: bold;">setq</span> yank-excluded-properties nil)
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Use mplayer</span>
    (<span style="font-weight: bold;">setq</span> bongo-enabled-backends '(mplayer))))
</pre>
</div>

<p>
org-player.el を使えば，org-mode のバッファから Bongo を操作できる．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"org"</span>
  (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">org-player</span> nil t))
</pre>
</div>

<p>
音量コントロールには，<a href="https://github.com/dbrock/volume-el">volume.el</a>が必要です．設定がうまくいかないので保留中
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(autoload 'volume <span style="font-style: italic;">"volume"</span> <span style="font-style: italic;">"Tweak your sound card volume."</span> t)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgd5aed515" class="outline-2">
<h2 id="orgd5aed515"><span class="section-number-2">8</span> 履歴／ファイル管理</h2>
<div class="outline-text-2" id="text-orgd5aed515">
</div>
<div id="outline-container-org0f46c991" class="outline-3">
<h3 id="org0f46c991"><span class="section-number-3">8.1</span> 履歴サイズを大きくする</h3>
<div class="outline-text-3" id="text-org0f46c991">
<p>
<code>t</code> で無限大に指定できる．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setq</span> history-length 2000)
</pre>
</div>
</div>
</div>

<div id="outline-container-org9736b2f0" class="outline-3">
<h3 id="org9736b2f0"><span class="section-number-3">8.2</span> Undoバッファを無限に取る</h3>
<div class="outline-text-3" id="text-org9736b2f0">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setq</span> undo-outer-limit nil)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf2cd8961" class="outline-3">
<h3 id="orgf2cd8961"><span class="section-number-3">8.3</span> 最近開いたファイルリストを保持</h3>
<div class="outline-text-3" id="text-orgf2cd8961">
<p>
Built-in の <a href="http://www.emacswiki.org/emacs/RecentFiles">recentf.el</a> を使う．
</p>

<ul class="org-ul">
<li><a href="http://d.hatena.ne.jp/tomoya/20110217/1297928222">http://d.hatena.ne.jp/tomoya/20110217/1297928222</a></li>
</ul>

<p>
recentf-auto-cleanup を <code>'mode</code> などにすると起動時にファイルのクリーニングが行われるてしまうので， <code>'never</code> で回避し，アイドルタイマーなどで対応する．これだけで50[ms]ほど起動を高速化できる．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(rencetf-mode
         my-recentf-save-list-silence
         my-recentf-cleanup-silence
         recentf-open-files)
       <span style="font-style: italic;">"recentf"</span> nil t)

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"recentf"</span>
    (custom-set-variables
     '(recentf-max-saved-items 2000)
     '(recentf-save-file (expand-file-name <span style="font-style: italic;">"~/.emacs.d/recentf"</span>))
     '(recentf-auto-cleanup 'never)
     '(recentf-exclude
       '(<span style="font-style: italic;">".recentf"</span> <span style="font-style: italic;">"bookmarks"</span> <span style="font-style: italic;">"org-recent-headings.dat"</span> <span style="font-style: italic;">"^/tmp\\.*"</span>
         <span style="font-style: italic;">"^/private\\.*"</span> <span style="font-style: italic;">"^/var/folders\\.*"</span> <span style="font-style: italic;">"/TAGS$"</span>)))

    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-recentf-save-list-silence</span> ()
      (<span style="font-weight: bold;">interactive</span>)
      (<span style="font-weight: bold;">let</span> ((message-log-max nil))
        (<span style="font-weight: bold;">if</span> (fboundp 'shut-up)
            (shut-up (recentf-save-list))
          (recentf-save-list)))
      (message <span style="font-style: italic;">""</span>))

    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-recentf-cleanup-silence</span> ()
      (<span style="font-weight: bold;">interactive</span>)
      (<span style="font-weight: bold;">when</span> (file-exists-p <span style="font-style: italic;">"/Volumes/orzHDn"</span>)
        (<span style="font-weight: bold;">let</span> ((message-log-max nil))
          (<span style="font-weight: bold;">if</span> shutup-p
              (shut-up (recentf-cleanup))
            (recentf-cleanup)))
        (message <span style="font-style: italic;">""</span>)))
    (add-hook 'focus-out-hook #'my-recentf-save-list-silence)
    (add-hook 'focus-out-hook #'my-recentf-cleanup-silence))

  (<span style="font-weight: bold;">unless</span> noninteractive
    (<span style="font-weight: bold;">let</span> ((message-log-max nil))
      (recentf-mode 1)))

  (<span style="font-weight: bold;">when</span> (autoload-if-found '(counsel-recentf) <span style="font-style: italic;">"counsel"</span> nil t)
    (global-set-key (kbd <span style="font-style: italic;">"C-M-r"</span>) 'counsel-recentf))

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"counsel"</span>
    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">ad:counsel-recentf</span> ()
      <span style="font-style: italic;">"Find a file on `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">recentf-list</span><span style="font-style: italic;">'."</span>
      (<span style="font-weight: bold;">interactive</span>)
      (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">recentf</span>)
      (recentf-mode)
      (ivy-read <span style="font-style: italic;">"Recentf: "</span>
                (mapcar (<span style="font-weight: bold;">lambda</span> (x) (abbreviate-file-name  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">~/</span>
                                     (substring-no-properties x)))
                        recentf-list)
                <span style="font-weight: bold;">:action</span> (<span style="font-weight: bold;">lambda</span> (f)
                          (<span style="font-weight: bold;">with-ivy-window</span>
                            (find-file f)))
                <span style="font-weight: bold;">:require-match</span> t
                <span style="font-weight: bold;">:caller</span> 'counsel-recentf))
    (advice-add 'counsel-recentf <span style="font-weight: bold;">:override</span> #'ad:counsel-recentf)
    (ivy-add-actions
     'counsel-recentf
     '((<span style="font-style: italic;">"g"</span> my-counsel-ag-in-dir <span style="font-style: italic;">"switch to ag"</span>)
       (<span style="font-style: italic;">"r"</span> my-counsel-fzf-in-dir <span style="font-style: italic;">"switch to fzf (in dir.)"</span>)
       (<span style="font-style: italic;">"z"</span> my-counsel-fzf-in-default-dir <span style="font-style: italic;">"switch to fzf (default)"</span>)))))

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(add-hook 'after-init-hook #'recentf-mode))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org9f20061e" class="outline-3">
<h3 id="org9f20061e"><span class="section-number-3">8.4</span> C-g した場所をブックマークする</h3>
<div class="outline-text-3" id="text-org9f20061e">
<p>
<code>C-g</code> でカーソルが飛んだ時，元の場所へブックマークから戻れます．
</p>

<ul class="org-ul">
<li><a href="https://pxaka.tokyo/blog/2019/7f6518aa-bab0-91a4-53b3-ba3b8f02a481/">C-g した場所をブックマークする - imadenale</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my-cg-bookmark</span> <span style="font-style: italic;">"c-g-point-last"</span>)
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-cg-bookmark</span> ()
  (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">and</span> buffer-file-name
             isearch-mode)
    (bookmark-set my-cg-bookmark)))
(<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">ah</span> nil t)
  (add-hook 'ah-before-c-g-hook #'my-cg-bookmark))
</pre>
</div>
</div>
</div>

<div id="outline-container-org300e8f70" class="outline-3">
<h3 id="org300e8f70"><span class="section-number-3">8.5</span> バッファ保存時にバックアップを生成させない&#xa0;&#xa0;&#xa0;<span class="tag"><span class="backup">backup</span></span></h3>
<div class="outline-text-3" id="text-org300e8f70">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">*.~</span>
(<span style="font-weight: bold;">setq</span> make-backup-files nil)
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">.#*</span>
(<span style="font-weight: bold;">setq</span> auto-save-default nil)
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">auto-save-list</span>
(<span style="font-weight: bold;">setq</span> auto-save-list-file-prefix nil)
</pre>
</div>
</div>
</div>

<div id="outline-container-org89e64435" class="outline-3">
<h3 id="org89e64435"><span class="section-number-3">8.6</span> 特定のファイルを Dropbox 以下にバックアップする&#xa0;&#xa0;&#xa0;<span class="tag"><span class="backup">backup</span></span></h3>
<div class="outline-text-3" id="text-org89e64435">
<p>
複数の端末でEmacsを使うと，稀に端末の環境に依存した設定ファイルが必要になります．それを共有してそのまま使うことはできないないので，所定の場所での同期を避ける必要があります．私の場合は， <code>recentf</code> がそれに該当します．とは言えバックアップしていないのは不安なので，なんとかします．引数にバックアップ対象のファイルリストを渡せます．
</p>

<p>
事前に <code>~/Dropbox/backup</code> の下に， <code>system-name</code> で得られる値のディレクトリを作成する必要があります． <code>my-backup</code> は <a href="./utility.el">./utility.el</a> で実装しています．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"recentf"</span>
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-backup-recentf</span> ()
    (<span style="font-weight: bold;">interactive</span>)
    (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">utility</span> nil t)
      (my-backup recentf-save-file))) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">"~/.emacs.d/recentf"</span>
  (run-with-idle-timer 180 t 'my-backup-recentf))
</pre>
</div>
</div>
</div>

<div id="outline-container-org9b0e7066" class="outline-3">
<h3 id="org9b0e7066"><span class="section-number-3">8.7</span> [backup-each-save.el] クラッシュに備える&#xa0;&#xa0;&#xa0;<span class="tag"><span class="backup">backup</span></span></h3>
<div class="outline-text-3" id="text-org9b0e7066">
<p>
直近のファイルを常にバックアップします． <code>backup-dir.el</code> でも良いですが，バックアップの目的が，バッファ編集中に <code>emacs</code> が落ちる時の保険ならば， <code>backup-each-save</code> の方が適切な場合があります．以下の例では，すべてのファイルを保存の度に保存し， <code>emacs</code> 起動後に postpone モードが有効になる時点で7日前までのバックアップファイルをすべて削除するようにしています．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(backup-each-save my-auto-backup)
       <span style="font-style: italic;">"backup-each-save"</span> nil t)

  (add-hook 'after-save-hook #'my-auto-backup)

  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">%y-%m-%d_%M-%S &#12391;&#32066;&#12431;&#12427;&#12501;&#12449;&#12452;&#12523;&#12434;&#26412;&#26469;&#12398;&#12513;&#12472;&#12515;&#12540;&#12514;&#12540;&#12489;&#12391;&#38283;&#12367;</span>
  (add-to-list 'auto-mode-alist '(<span style="font-style: italic;">"-[0-9-]\\{8\\}_[0-9-]\\{5\\}$"</span> nil t))

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"backup-each-save"</span>
    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-auto-backup</span> ()
      (<span style="font-weight: bold;">unless</span> (equal (buffer-name) <span style="font-style: italic;">"recentf"</span>)
        (backup-each-save)))
    (<span style="font-weight: bold;">setq</span> backup-each-save-mirror-location <span style="font-style: italic;">"~/.emacs.d/backup"</span>)
    (<span style="font-weight: bold;">setq</span> backup-each-save-time-format <span style="font-style: italic;">"%y-%m-%d_%M-%S"</span>) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">do not use ":" for w32</span>
    (<span style="font-weight: bold;">setq</span> backup-each-save-size-limit 1048576))

  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-backup-each-save-compute-location</span> (filename)
    (<span style="font-weight: bold;">let*</span> ((containing-dir (file-name-directory filename))
           (basename (file-name-nondirectory filename))
           (backup-container
            (format <span style="font-style: italic;">"%s/%s"</span>
                    backup-each-save-mirror-location
                    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">"c:" is not allowed</span>
                    (replace-regexp-in-string <span style="font-style: italic;">":"</span> <span style="font-style: italic;">""</span> containing-dir))))
      (<span style="font-weight: bold;">when</span> (not (file-exists-p backup-container))
        (make-directory backup-container t))
      (format <span style="font-style: italic;">"%s/%s-%s"</span> backup-container basename
              (format-time-string backup-each-save-time-format))))

  (<span style="font-weight: bold;">when</span> (eq window-system 'w32)
    (advice-add 'backup-each-save-compute-location <span style="font-weight: bold;">:override</span>
                #'my-backup-each-save-compute-location)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orge2f78ad3" class="outline-3">
<h3 id="orge2f78ad3"><span class="section-number-3">8.8</span> [dired] ファイラのサポートツール&#xa0;&#xa0;&#xa0;<span class="tag"><span class="dired">dired</span></span></h3>
<div class="outline-text-3" id="text-orge2f78ad3">
<p>
<code>dired.el</code> をリッチに使うツール群です．
</p>

<ul class="org-ul">
<li>gited</li>
<li>dired-x</li>
<li>dired-narrow</li>
<li>dired-du</li>
<li>helm-dired-history or ivy-dired-history</li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">ad:find-file-noselect</span> (_filename <span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> _nowarn _rawfile _wildcards)
  (<span style="font-weight: bold;">unless</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">init-dired</span> nil t)
    (<span style="font-weight: bold;">user-error</span> <span style="font-style: italic;">"init-dired.el doesn't exist"</span>))
  (advice-remove 'find-file-noselect #'ad:find-file-noselect)
  (advice-remove 'dired #'ad:dired-activate))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">ad:dired-activate</span> (_dirname <span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> _switches)
  (<span style="font-weight: bold;">unless</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">init-dired</span> nil t)
    (<span style="font-weight: bold;">user-error</span> <span style="font-style: italic;">"init-dired.el doesn't exist"</span>))
  (advice-remove 'find-file-noselect #'ad:find-file-noselect)
  (advice-remove 'dired #'ad:dired-activate))

(advice-add 'find-file-noselect <span style="font-weight: bold;">:before</span> #'ad:find-file-noselect)
(advice-add 'dired <span style="font-weight: bold;">:before</span> #'ad:dired-activate)
</pre>
</div>

<p>
明示的に <code>dired</code> を呼ばなくても， <code>ibuffer</code> が <code>dired</code> を読み込むことがわかったので， <code>dired</code> に関係する以下の設定は， <code>init-dired.el</code> に分離しました．下記の設定は， <code>M-x dired</code> と <code>M-x find-file-noselect</code> を実行したタイミングで1回だけ読み込まれません．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setq</span> completion-ignored-extensions
      (append completion-ignored-extensions
              '(<span style="font-style: italic;">"./"</span> <span style="font-style: italic;">"../"</span> <span style="font-style: italic;">".xlsx"</span> <span style="font-style: italic;">".docx"</span> <span style="font-style: italic;">".pptx"</span> <span style="font-style: italic;">".DS_Store"</span>)))

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Use build-in `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">wdired-mode</span><span style="font-weight: bold; font-style: italic;">'.</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(define-key dired-mode-map (kbd "R") 'wdired-change-to-wdired-mode)</span>

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">http://elpa.gnu.org/packages/gited.html</span>
(<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">gited</span> nil t)
  (define-key dired-mode-map (kbd <span style="font-style: italic;">"C-x C-g"</span>) 'gited-list-branches))

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">https://github.com/Fuco1/dired-hacks</span>
(<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">dired-narrow</span> nil t)
  (define-key dired-mode-map (kbd <span style="font-style: italic;">"/"</span>) 'dired-narrow))
(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">dired-du</span> nil t)
(<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">ivy-dired-history</span> nil t)
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">ivy-dired-history-variable &#12399;&#65292;session.el &#12391;&#26126;&#31034;&#30340;&#12395;&#31649;&#29702;&#20013;&#65294;</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">check session-globals-include</span>
  (define-key dired-mode-map <span style="font-style: italic;">","</span> 'dired))

(<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">dired-x</span> nil t)
  (dired-extra-startup))
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-reveal-in-finder</span> ()
  <span style="font-style: italic;">"Reveal the current buffer in Finder."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (shell-command-to-string <span style="font-style: italic;">"open ."</span>))
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">dired-x &#12434;&#35501;&#12415;&#36796;&#12435;&#12384;&#12354;&#12392;&#12376;&#12419;&#12394;&#12356;&#12392;&#12384;&#12417;</span>
(define-key dired-mode-map (kbd <span style="font-style: italic;">"F"</span>) 'my-reveal-in-finder)

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">https://github.com/xuchunyang/emacs.d</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">type "!" or "X" in dired</span>
(<span style="font-weight: bold;">when</span> (eq system-type 'darwin)
  (<span style="font-weight: bold;">setq</span> dired-guess-shell-alist-user
        (list
         (list (<span style="font-weight: bold;">rx</span> (<span style="font-weight: bold;">and</span> <span style="font-style: italic;">"."</span>
                        (<span style="font-weight: bold;">or</span>
                         <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Videos</span>
                         <span style="font-style: italic;">"mp4"</span> <span style="font-style: italic;">"avi"</span> <span style="font-style: italic;">"mkv"</span> <span style="font-style: italic;">"rmvb"</span>
                         <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Torrent</span>
                         <span style="font-style: italic;">"torrent"</span>
                         <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">PDF</span>
                         <span style="font-style: italic;">"pdf"</span>
                         <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Image</span>
                         <span style="font-style: italic;">"gif"</span> <span style="font-style: italic;">"png"</span> <span style="font-style: italic;">"jpg"</span> <span style="font-style: italic;">"jpeg"</span>)
                        string-end)) <span style="font-style: italic;">"open"</span>))))

(<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">and</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">hydra</span> nil t)
           (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">dired-recent</span> nil t))
  (define-key dired-mode-map <span style="font-style: italic;">"h"</span> 'hydra-dired/body)
  (define-key dired-mode-map <span style="font-style: italic;">"r"</span> 'dired-recent-open)

  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">https://github.com/abo-abo/hydra/wiki/Dired</span>
  (<span style="font-weight: bold;">defhydra</span> hydra-dired (<span style="font-weight: bold;">:hint</span> nil <span style="font-weight: bold;">:color</span> pink)
    <span style="font-style: italic;">"</span>
<span style="font-style: italic;">_+_ mkdir        _v_iew        _m_ark            _(_ details       _i_nsert-subdir</span>
<span style="font-style: italic;">_C_opy           View _O_ther  _U_nmark all      _)_ omit-mode</span>
<span style="font-style: italic;">_D_elete         _o_pen other  _u_nmark          _l_ redisplay     _w_ kill-subdir</span>
<span style="font-style: italic;">_R_ename         _M_ chmod     _t_oggle          _g_ revert buf</span>
<span style="font-style: italic;">_Y_ rel symlink  _G_ chgrp     _E_xtension mark  _s_ort            _r_ dired-recent-open</span>
<span style="font-style: italic;">_S_ymlink        ^ ^           _F_ind marked     _._ toggle hydra  _?_ summary</span>
<span style="font-style: italic;">_A_ find regexp  _Z_ compress  T - tag prefix</span>
<span style="font-style: italic;">_Q_ repl regexp   [wdired] C-x C-q : edit / C-c C-c : commit / C-c ESC : abort</span>
<span style="font-style: italic;">"</span>
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">("\\" dired-do-ispell)</span>
    (<span style="font-style: italic;">"("</span> dired-hide-details-mode)
    (<span style="font-style: italic;">")"</span> dired-omit-mode)
    (<span style="font-style: italic;">"+"</span> dired-create-directory)
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">("=" diredp-ediff)         ;; smart diff</span>
    (<span style="font-style: italic;">"?"</span> dired-summary)
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">("$" diredp-hide-subdir-nomove)</span>
    (<span style="font-style: italic;">"A"</span> dired-do-find-regexp)
    (<span style="font-style: italic;">"C"</span> dired-do-copy)        <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Copy all marked files</span>
    (<span style="font-style: italic;">"D"</span> dired-do-delete)
    (<span style="font-style: italic;">"E"</span> dired-mark-extension)
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">("e" dired-ediff-files)</span>
    (<span style="font-style: italic;">"F"</span> dired-do-find-marked-files)
    (<span style="font-style: italic;">"G"</span> dired-do-chgrp)
    (<span style="font-style: italic;">"g"</span> revert-buffer)        <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">read all directories again (refresh)</span>
    (<span style="font-style: italic;">"i"</span> dired-maybe-insert-subdir)
    (<span style="font-style: italic;">"l"</span> dired-do-redisplay)   <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">relist the marked or singel directory</span>
    (<span style="font-style: italic;">"M"</span> dired-do-chmod)
    (<span style="font-style: italic;">"m"</span> dired-mark)
    (<span style="font-style: italic;">"O"</span> dired-display-file)
    (<span style="font-style: italic;">"o"</span> dired-find-file-other-window)
    (<span style="font-style: italic;">"Q"</span> dired-do-find-regexp-and-replace)
    (<span style="font-style: italic;">"R"</span> dired-do-rename)
    (<span style="font-style: italic;">"r"</span> dired-recent-open)
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">("r" dired-do-rsynch)</span>
    (<span style="font-style: italic;">"S"</span> dired-do-symlink)
    (<span style="font-style: italic;">"s"</span> dired-sort-toggle-or-edit)
    (<span style="font-style: italic;">"t"</span> dired-toggle-marks)
    (<span style="font-style: italic;">"U"</span> dired-unmark-all-marks)
    (<span style="font-style: italic;">"u"</span> dired-unmark)
    (<span style="font-style: italic;">"v"</span> dired-view-file)      <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">q to exit, s to search, = gets line #</span>
    (<span style="font-style: italic;">"w"</span> dired-kill-subdir)
    (<span style="font-style: italic;">"Y"</span> dired-do-relsymlink)
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">("z" diredp-compress-this-file)</span>
    (<span style="font-style: italic;">"Z"</span> dired-do-compress)
    (<span style="font-style: italic;">"q"</span> nil)
    (<span style="font-style: italic;">"."</span> nil <span style="font-weight: bold;">:color</span> blue))
  )
</pre>
</div>
</div>
</div>

<div id="outline-container-org7c53511f" class="outline-3">
<h3 id="org7c53511f"><span class="section-number-3">8.9</span> [dired-recent.el] 訪問したディレクトリの履歴を取る&#xa0;&#xa0;&#xa0;<span class="tag"><span class="dired">dired</span></span></h3>
<div class="outline-text-3" id="text-org7c53511f">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(dired-recent-open dired-recent-mode)
       <span style="font-style: italic;">"dired-recent"</span> nil t)

  (global-set-key (kbd <span style="font-style: italic;">"C-x C-d"</span>) 'dired-recent-open)

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"dired-recent"</span>
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(require 'helm-config nil t)</span>
    (dired-recent-mode 1)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orga3cbefa8" class="outline-3">
<h3 id="orga3cbefa8"><span class="section-number-3">8.10</span> [osx-trash] system-move-file-to-trash を有効にする</h3>
<div class="outline-text-3" id="text-orga3cbefa8">
<p>
<a href="https://github.com/lunaryorn/osx-trash.el">osx-trash</a> は，OSXで <code>system-move-file-to-trash</code> を使えるようにする．単独で使うのはあまり考えられないので，読み込みを <code>dired</code> に紐付けます．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"dired"</span>
  (<span style="font-weight: bold;">setq</span> dired-use-ls-dired nil)
  (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">osx-trash</span> nil t)
    (<span style="font-weight: bold;">setq</span> delete-by-moving-to-trash t)
    (osx-trash-setup)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org6e71b562" class="outline-3">
<h3 id="org6e71b562"><span class="section-number-3">8.11</span> [undo-fu.el] シンプルな redo を提供してくる</h3>
<div class="outline-text-3" id="text-org6e71b562">
<ul class="org-ul">
<li><a href="https://gitlab.com/ideasman42/emacs-undo-fu">Campbell Barton / emacs-undo-fu · GitLab</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(undo-fu-only-undo undo-fu-only-redo)
       <span style="font-style: italic;">"undo-fu"</span> nil t)

  (global-set-key (kbd <span style="font-style: italic;">"C-/"</span>) 'undo-fu-only-undo)
  (global-set-key (kbd <span style="font-style: italic;">"C-M-/"</span>) 'undo-fu-only-redo))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb8c01946" class="outline-3">
<h3 id="orgb8c01946"><span class="section-number-3">8.12</span> [auto-save-buffers.el] 一定間隔でバッファを保存する</h3>
<div class="outline-text-3" id="text-orgb8c01946">
<ul class="org-ul">
<li><a href="http://0xcc.net/misc/auto-save/">http://0xcc.net/misc/auto-save/</a></li>
</ul>

<p>
同じ機能で比較的新しいパッケージに， <a href="https://github.com/ChillarAnand/real-auto-save">real-auto-save.el</a> があります．ただ，私の場合は，以下のようなモードごとの制御がうまくできなかったので移行していません．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">auto-save-buffers</span> nil t)

  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-ox-hugo-auto-saving-p</span> ()
    (<span style="font-weight: bold;">when</span> (eq major-mode 'org-mode)
      (<span style="font-weight: bold;">or</span> (<span style="font-weight: bold;">bound-and-true-p</span> org-capture-mode) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">when activating org-capture</span>
          (<span style="font-weight: bold;">and</span> (fboundp 'org-entry-get)
               (equal <span style="font-style: italic;">""</span> (org-entry-get (point) <span style="font-style: italic;">"EXPORT_FILE_NAME"</span>))))))

  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-auto-save-buffers</span> ()
    (<span style="font-weight: bold;">cond</span> ((eq major-mode 'undo-tree-visualizer-mode) nil)
          ((eq major-mode 'diff-mode) nil)
          ((string-match <span style="font-style: italic;">"Org Src"</span> (buffer-name)) nil)
          ((my-ox-hugo-auto-saving-p) nil)
          (t
           (auto-save-buffers))))

  (run-with-idle-timer 1.6 t #'my-auto-save-buffers))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgab837e6a" class="outline-3">
<h3 id="orgab837e6a"><span class="section-number-3">8.13</span> [session.el] 様々な履歴を保存し復元に利用する</h3>
<div class="outline-text-3" id="text-orgab837e6a">
<p>
<a href="http://emacs-session.sourceforge.net/">http://emacs-session.sourceforge.net/</a>
</p>

<ul class="org-ul">
<li>入力履歴の保持（検索語，表示したバッファ履歴）</li>
<li>保存時のカーソル位置の保持</li>
<li>キルリングの保持</li>
<li>変更が加えられたファイル履歴の保持</li>
<li><code>session-initialize</code> の呼び出しタイミングに注意．前回終了時の状況を保存しているため，他のパッケージの初期化が終った後に呼び出すと，パッケージが想定している初期化を上書きしてしまい，不安定になる． <code>after-init-hook</code> 推奨．</li>
</ul>
<ul class="org-ul">
<li class="off"><code>[&#xa0;]</code> <code>M-x session-save-session</code></li>
</ul>

<p>
session-undo-check を指定していると，保存時ではなくバッファを閉じるときの状態を保持する．
</p>

<p>
Org Mode と併用する場合は， my-org-reveal-session-jump の設定が必須．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(session-initialize)
       <span style="font-style: italic;">"session"</span> nil t)

  (<span style="font-weight: bold;">unless</span> noninteractive
    (add-hook 'after-init-hook #'session-initialize))

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"session"</span>
    (custom-set-variables
     '(session-set-file-name-exclude-regexp <span style="font-style: italic;">"[/\\]\\.overview</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">|</span><span style="font-style: italic;">[/\\]\\.session</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">|</span><span style="font-style: italic;">News[/\\]</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">|</span><span style="font-style: italic;">COMMIT_EDITMSG"</span>)) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">FIXME: not activated</span>
    (add-to-list 'session-globals-exclude 'org-mark-ring)
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Change save point of session.el</span>
    (<span style="font-weight: bold;">setq</span> session-save-file
          (expand-file-name (concat (getenv <span style="font-style: italic;">"SYNCROOT"</span>) <span style="font-style: italic;">"/emacs.d/.session"</span>)))
    (<span style="font-weight: bold;">setq</span> session-initialize '(de-saveplace session keys menus places)
          session-globals-include '((kill-ring 100)
                                    (session-file-alist 100 t)
                                    (file-name-history 200)
                                    ivy-dired-history-variable
                                    search-ring
                                    regexp-search-ring))
    (add-to-list 'session-globals-include 'ivy-dired-history-variable)
    (<span style="font-weight: bold;">setq</span> session-undo-check -1)))

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">FIXME</span>
<span style="font-weight: bold; font-style: italic;">;;  </span><span style="font-weight: bold; font-style: italic;">(setq session-set-file-name-exclude-regexp</span>
<span style="font-weight: bold; font-style: italic;">;;        </span><span style="font-weight: bold; font-style: italic;">"^/private/\\.\\*"))</span>
<span style="font-weight: bold; font-style: italic;">;;          </span><span style="font-weight: bold; font-style: italic;">"[/\\]\\.overview\\|[/\\]\\.session\\|News[/\\]\\|^/private\\.*\\|^/var/folders\\.*"))</span>
</pre>
</div>

<p>
次はテスト中．orgバッファを開いたらカーソル位置をorg-revealしたいが，time-stampなどと組み合わせたり，org-tree-slideと組み合わせていると，うまくいかない．バッファを表示した時に org-reveal (C-c C-r) を打つのをサボりたいだけなのだが．．．
</p>

<p>
<a href="http://www.emacswiki.org/emacs/EmacsSession">http://www.emacswiki.org/emacs/EmacsSession</a>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(session-initialize)
       <span style="font-style: italic;">"session"</span> nil t)

  (add-hook 'after-init-hook #'session-initialize)
  (eval-after-load <span style="font-style: italic;">"session"</span>
    '(<span style="font-weight: bold;">progn</span>
       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">For Org-mode</span>
       (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-maybe-reveal</span> ()
         (<span style="font-weight: bold;">interactive</span>)
         (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">and</span> (<span style="font-weight: bold;">or</span> (memq major-mode '(org-mode outline-mode))
                        (<span style="font-weight: bold;">and</span> (boundp 'outline-minor-mominor-de)
                             outline-minor-mode))
                    (outline-invisible-p))
           (<span style="font-weight: bold;">if</span> (eq major-mode 'org-mode)
               (org-reveal)
             (show-subtree))))

       (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-org-reveal-session-jump</span> ()
         (message <span style="font-style: italic;">"call!"</span>)
         (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">and</span> (eq major-mode 'org-mode)
                    (outline-invisible-p))
           (org-reveal)))

       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">C-x C-/</span>
       (add-hook 'session-after-jump-to-last-change-hook
                 #'my-maybe-reveal))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org92404bbd" class="outline-3">
<h3 id="org92404bbd"><span class="section-number-3">8.14</span> [neotree.el] ディレクトリ情報をツリー表示</h3>
<div class="outline-text-3" id="text-org92404bbd">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(neotree neotree-toggle)
       <span style="font-style: italic;">"neotree"</span> nil t)

  (global-set-key (kbd <span style="font-style: italic;">"C-c n"</span>) #'neotree-toggle)

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"neotree"</span>
    (custom-set-variables
     '(neo-show-hidden-files t)
     '(neo-theme 'arrow)
     '(neo-smart-open t)
     '(neo-window-width 25)
     '(neo-show-hidden-files nil)
     '(neo-window-position 'left))
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(setq neo-vc-integration '(face char)) ;; It's heavy at 2017-08-31</span>

    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#12450;&#12452;&#12467;&#12531;&#34920;&#31034;</span>
    (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">all-the-icons-dired</span> nil t)
      (<span style="font-weight: bold;">setq</span> neo-theme (<span style="font-weight: bold;">if</span> (display-graphic-p) 'icons 'arrow)))

    (<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my-neo-activated</span> nil) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">fail save</span>
    (<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my-neo-adjusted-window-width</span> (+ 3 neo-window-width))
    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">ad:neotree-show</span> ()
      <span style="font-style: italic;">"Extension to support change frame width when opening neotree."</span>
      (<span style="font-weight: bold;">unless</span> (neo-global--window-exists-p)
        (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">and</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">moom</span> nil t)
                   (not my-neo-activated))
          (<span style="font-weight: bold;">setq</span> moom-frame-width-single
                (+ moom-frame-width-single my-neo-adjusted-window-width))
          (<span style="font-weight: bold;">setq</span> moom-frame-width-double
                (+ moom-frame-width-double my-neo-adjusted-window-width)))
        (set-frame-width nil (+ (frame-width) my-neo-adjusted-window-width))
        (<span style="font-weight: bold;">setq</span> my-neo-activated t)))
    (advice-add 'neotree-show <span style="font-weight: bold;">:before</span> #'ad:neotree-show)

    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">ad:neotree-hide</span> ()
      <span style="font-style: italic;">"Extension to support change frame width when closing neotree."</span>
      (<span style="font-weight: bold;">when</span> (neo-global--window-exists-p)
        (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">and</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">moom</span> nil t)
                   my-neo-activated)
          (<span style="font-weight: bold;">setq</span> moom-frame-width-single
                (- moom-frame-width-single my-neo-adjusted-window-width))
          (<span style="font-weight: bold;">setq</span> moom-frame-width-double
                (- moom-frame-width-double my-neo-adjusted-window-width)))
        (set-frame-width nil (- (frame-width) my-neo-adjusted-window-width))
        (<span style="font-weight: bold;">when</span> (&gt; 80 (frame-width)) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">fail safe</span>
          (set-frame-width nil 80))
        (<span style="font-weight: bold;">setq</span> my-neo-activated nil)))
    (advice-add 'neotree-hide <span style="font-weight: bold;">:before</span> #'ad:neotree-hide)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf2d47943" class="outline-3">
<h3 id="orgf2d47943"><span class="section-number-3">8.15</span> [helpful.el] リッチなヘルプページ</h3>
<div class="outline-text-3" id="text-orgf2d47943">
<p>
ヘルプの内容を見やすく構造化して表示してくれます．関数や変数のヘルプだけでなく，キーやマクロなども見やすく表示してくれます．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(helpful-key helpful-function helpful-variable helpful-at-point
                     helpful-symbol)
       <span style="font-style: italic;">"helpful"</span> nil t)

  (global-set-key (kbd <span style="font-style: italic;">"C-h k"</span>) 'helpful-key)
  (global-set-key (kbd <span style="font-style: italic;">"C-h @"</span>) 'helpful-at-point)
  (global-set-key (kbd <span style="font-style: italic;">"C-h o"</span>) 'helpful-symbol)
  (global-set-key (kbd <span style="font-style: italic;">"C-h f"</span>) 'helpful-function)
  (global-set-key (kbd <span style="font-style: italic;">"C-h v"</span>) 'helpful-variable)

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"helpful"</span>
    (define-key helpful-mode-map (kbd <span style="font-style: italic;">"@"</span>) #'helpful-at-point)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc08799d2" class="outline-3">
<h3 id="orgc08799d2"><span class="section-number-3">8.16</span> [facecheck.el] クリックしてfaceをチェック</h3>
<div class="outline-text-3" id="text-orgc08799d2">
<p>
マウスクリックでface情報を表示する．マイナーモードを有効にして使います．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(facecheck-at-point facecheck-mode)
       <span style="font-style: italic;">"facecheck"</span> nil t)
  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"facecheck"</span>
    (facecheck-mode 1)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org0d952d68" class="outline-3">
<h3 id="org0d952d68"><span class="section-number-3">8.17</span> [keyfreq.el] コマンドログ</h3>
<div class="outline-text-3" id="text-org0d952d68">
<p>
発行しているコマンドの使用頻度を記録し確認できます．デフォルトで， <code>~/.emacs.keyfreq</code> に情報が記録されます．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(keyfreq-mode keyfreq-autosave-mode ad:keyfreq-show)
       <span style="font-style: italic;">"keyfreq"</span> nil t) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">will require 'cl and 'gv (10-20[ms])</span>

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"keyfreq"</span>
    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">ad:keyfreq-show</span> ()
      <span style="font-style: italic;">"Extension to make the buffer view-only."</span>
      (<span style="font-weight: bold;">interactive</span>)
      (<span style="font-weight: bold;">if</span> shutup-p
          (shut-up (view-buffer keyfreq-buffer))
        (view-buffer keyfreq-buffer)))
    (advice-add 'keyfreq-show <span style="font-weight: bold;">:after</span> #'ad:keyfreq-show)
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(define-key keyfreq-mode-map (kbd "q")</span>
    <span style="font-weight: bold; font-style: italic;">;;   </span><span style="font-weight: bold; font-style: italic;">(lambda () (interactive)</span>
    <span style="font-weight: bold; font-style: italic;">;;       </span><span style="font-weight: bold; font-style: italic;">(when (string= (buffer-name) keyfreq-buffer)</span>
    <span style="font-weight: bold; font-style: italic;">;;         </span><span style="font-weight: bold; font-style: italic;">(kill-buffer-and-window))))</span>
    (<span style="font-weight: bold;">setq</span> keyfreq-file
          (expand-file-name (concat (getenv <span style="font-style: italic;">"SYNCROOT"</span>) <span style="font-style: italic;">"/emacs.d/.keyfreq"</span>)))
    (keyfreq-autosave-mode 1))

  (<span style="font-weight: bold;">unless</span> noninteractive
    (keyfreq-mode 1)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orged77c483" class="outline-3">
<h3 id="orged77c483"><span class="section-number-3">8.18</span> [disk-usage.el] ディスク利用率を調べる</h3>
<div class="outline-text-3" id="text-orged77c483">
<p>
<code>ncdu</code> コマンドのように，システムのディスク利用率を調べてバッファに一覧表示します．ただ，非同期に対応していないので，普通にシェルで <code>ncdu</code> コマンドを使う方が良い気がします．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(disk-usage)
       <span style="font-style: italic;">"disk-usage"</span> nil t)

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"disk-usage"</span>
    (<span style="font-weight: bold;">when</span> (eq system-type 'darwin)
      (custom-set-variables
       '(disk-usage-du-command <span style="font-style: italic;">"du"</span>)))))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdd1e03ec" class="outline-3">
<h3 id="orgdd1e03ec"><span class="section-number-3">8.19</span> [uptimes.el] Emacsの起動時間を記録する</h3>
<div class="outline-text-3" id="text-orgdd1e03ec">
<p>
<a href="https://github.com/davep/uptimes.el">davep/uptimes.el: Uptime tracking system for emacs.</a> を使うと，過去数回の起動・稼働・終了履歴がわかります．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">uptimes</span> nil t)
</pre>
</div>

<p>
<code>M-x uptimes</code> すると，以下のような履歴が表示されます．
</p>

<div class="org-src-container">
<pre class="src src-text">Last 10 uptimes

Boot                Endtime             Uptime       This emacs
=================== =================== ============ ==========
2019-04-17 12:28:14 2019-04-17 12:29:37   0.00:01:23 &lt;--
2019-04-17 12:28:18 2019-04-17 12:28:25   0.00:00:06
2019-04-17 11:47:13 2019-04-17 12:10:39   0.00:23:26
2019-04-17 11:13:13 2019-04-17 11:21:05   0.00:07:51

Top 10 uptimes

Boot                Endtime             Uptime       This emacs
=================== =================== ============ ==========
2019-04-17 11:47:13 2019-04-17 12:10:39   0.00:23:26
2019-04-17 11:13:13 2019-04-17 11:21:05   0.00:07:51
2019-04-17 12:28:14 2019-04-17 12:29:37   0.00:01:23 &lt;--
2019-04-17 12:28:18 2019-04-17 12:28:25   0.00:00:06
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfd3c67b9" class="outline-3">
<h3 id="orgfd3c67b9"><span class="section-number-3">8.20</span> [ag.el] 検索</h3>
<div class="outline-text-3" id="text-orgfd3c67b9">
<p>
検索には <code>The Silver Searcher</code> を使います．あらかじめインストールしておく必要があります．MacPorts の場合，the<sub>silver</sub><sub>searcher</sub> の名称で頒布されています． <code>exec-path</code> に <code>/opt/local/bin</code> が含まれていることを確認してください．
</p>

<div class="org-src-container">
<pre class="src src-sh">the_silver_searcher @0.18.1 (textproc)
 A code-searching tool similar to ack, but faster.
</pre>
</div>

<p>
カスタマイズした関数を <code>C-M-f</code> にぶら下げています．helm インタフェースを使う <code>helm-ag</code> や ivy インターフェイスを使う <code>counsel-ag</code> もあります． <code>C-M-f</code> は，本来，S式の移動(<code>forward-sexp</code>)に使われています．
</p>

<p>
最近は， <code>counsel-ag</code> に移行しました．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">if</span> (executable-find <span style="font-style: italic;">"ag"</span>)
    (<span style="font-weight: bold;">when</span> (autoload-if-found
           '(my-ag ag)
           <span style="font-style: italic;">"ag"</span> nil t)

      (autoload-if-found '(helm-ag) <span style="font-style: italic;">"helm-ag"</span> nil t)
      (global-set-key (kbd <span style="font-style: italic;">"C-M-f"</span>) 'my-ag)

      (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"ag"</span>
        (custom-set-variables
         '(ag-highlight-search t)
         '(ag-reuse-buffers t)    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">nil: &#21029;&#12454;&#12451;&#12531;&#12489;&#12454;&#12364;&#38283;&#12367;</span>
         '(ag-reuse-window nil))  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">nil: &#32080;&#26524;&#12434;&#36984;&#25246;&#26178;&#12395;&#21029;&#12454;&#12451;&#12531;&#12489;&#12454;&#12395;&#32080;&#26524;&#12434;&#20986;&#12377;</span>

        <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">q &#12391;&#12454;&#12451;&#12531;&#12489;&#12454;&#12434;&#25244;&#12369;&#12427;</span>
        <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(define-key ag-mode-map (kbd "q") 'delete-window)</span>
        (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-ag</span> ()
          <span style="font-style: italic;">"Switch to search result."</span>
          (<span style="font-weight: bold;">interactive</span>)
          (call-interactively 'ag)
          (switch-to-buffer-other-frame <span style="font-style: italic;">"*ag search*"</span>))))

  (<span style="font-weight: bold;">unless</span> noninteractive
    (message <span style="font-style: italic;">"--- ag is NOT installed in this system."</span>)))
</pre>
</div>
</div>
</div>
<div id="outline-container-org29c7b6b7" class="outline-3">
<h3 id="org29c7b6b7"><span class="section-number-3">8.21</span> [counsel-ag.el] 高速全文検索</h3>
<div class="outline-text-3" id="text-org29c7b6b7">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found '(counsel-ag) <span style="font-style: italic;">"counsel"</span> nil t)
  (global-set-key (kbd <span style="font-style: italic;">"C-M-f"</span>) 'counsel-ag))

(<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"counsel"</span>
  (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">thingatpt</span> nil t)
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">ad:counsel-ag</span> (f <span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> initial-input initial-directory extra-ag-args ag-prompt caller)
    (apply f (<span style="font-weight: bold;">or</span> initial-input
                 (<span style="font-weight: bold;">and</span> (not (thing-at-point-looking-at <span style="font-style: italic;">"^\\*+"</span>))
                      (ivy-thing-at-point)))
           (<span style="font-weight: bold;">unless</span> current-prefix-arg
             (<span style="font-weight: bold;">or</span> initial-directory default-directory))
           extra-ag-args ag-prompt caller))
  (advice-add 'counsel-ag <span style="font-weight: bold;">:around</span> #'ad:counsel-ag)

  (ivy-add-actions
   'counsel-ag
   '((<span style="font-style: italic;">"r"</span> my-counsel-ag-in-dir <span style="font-style: italic;">"search in directory"</span>))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org24fd7b68" class="outline-3">
<h3 id="org24fd7b68"><span class="section-number-3">8.22</span> [counsel-fzf.el] 高速ファイル検索</h3>
<div class="outline-text-3" id="text-org24fd7b68">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(counsel-fzf)
       <span style="font-style: italic;">"counsel"</span> nil t)

  (global-set-key (kbd <span style="font-style: italic;">"C-M-z"</span>) 'counsel-fzf)

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"counsel"</span>
    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">ad:counsel-fzf</span> (f <span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> initial-input initial-directory fzf-prompt)
      (apply f (<span style="font-weight: bold;">or</span> initial-input
                   (<span style="font-weight: bold;">if</span> (thing-at-point-looking-at <span style="font-style: italic;">"^\\*+"</span>) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">org heading &#12434;&#38500;&#22806;</span>
                       nil
                     (ivy-thing-at-point)))
             (<span style="font-weight: bold;">or</span> initial-directory default-directory)
             fzf-prompt))
    (advice-add 'counsel-fzf <span style="font-weight: bold;">:around</span> #'ad:counsel-fzf)

    (ivy-add-actions
     'counsel-fzf
     '((<span style="font-style: italic;">"r"</span> my-counsel-fzf-in-dir <span style="font-style: italic;">"search in directory"</span>)))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org694ee426" class="outline-3">
<h3 id="org694ee426"><span class="section-number-3">8.23</span> <span class="done DONE">DONE</span> [undo-propose] undo を編集不可モードで辿る&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></h3>
<div class="outline-text-3" id="text-org694ee426">
<p>
最近は <b>undo-fu.el</b> を使っています．
</p>

<ul class="org-ul">
<li><a href="https://github.com/jackkamm/undo-propose-el">jackkamm/undo-propose-el: Navigate the emacs undo history by staging undo's in a temporary buffer</a></li>
</ul>

<p>
<code>undo</code> する時に，バッファに意図しない変更が加わると面倒なことになります．そこで <code>org-capture</code> なキーバインドで動作する <code>undo-propose</code> を使います．
</p>

<p>
<code>undo-propose</code> でモードに入ったら， <code>C-/</code> で <code>undo</code> して，確定するなら <code>C-c C-c</code> ，キャンセルするなら <code>C-c C-k</code> します．オリジナルのバッファを直接変更せず，一時的なバッファで <code>undo</code> してから反映させるのでより安全です．
</p>

<p>
次の設定では，標準の <code>undo</code> をオーバーライドするように <code>undo-propose</code> を使います．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">late-init.el</span>
(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(undo-propose)
       <span style="font-style: italic;">"undo-propose"</span> nil t)

  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-undo-propose</span> ()
    (<span style="font-weight: bold;">interactive</span>)
    (<span style="font-weight: bold;">if</span> (<span style="font-weight: bold;">or</span> (buffer-narrowed-p)
            (eq major-mode 'org-mode))
        (undo)
      (undo-propose)))

  (global-set-key (kbd <span style="font-style: italic;">"C-/"</span>) 'my-undo-propose)

  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">located here intended to share this command with `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">undo-tree</span><span style="font-weight: bold; font-style: italic;">'</span>
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-org-reveal-and-focus</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> _arg)
    <span style="font-style: italic;">"Reveal a heading and focus on the content."</span>
    (<span style="font-weight: bold;">when</span> (eq major-mode 'org-mode)
      (org-overview)
      (<span style="font-weight: bold;">unless</span> (org-before-first-heading-p)
        (org-reveal)
        (org-cycle-hide-drawers 'all)
        (org-show-entry)
        (show-children)
        (org-show-siblings))))
  (advice-add 'undo <span style="font-weight: bold;">:after</span> #'my-org-reveal-and-focus)

  (<span style="font-weight: bold;">eval-when-compile</span>
    (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">undo-propose</span> nil t)) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">for `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">undo-propose-wrap</span><span style="font-weight: bold; font-style: italic;">'</span>

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"undo-propose"</span>
    (add-hook 'undo-propose-entry-hook #'undo) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">immediate undo</span>
    (undo-propose-wrap redo)

    (define-key undo-propose-mode-map (kbd <span style="font-style: italic;">"/"</span>) 'undo)
    (define-key undo-propose-mode-map (kbd <span style="font-style: italic;">"q"</span>) 'undo-propose-cancel)
    (advice-add 'undo-propose-commit <span style="font-weight: bold;">:after</span> #'my-org-reveal-and-focus)
    (advice-add 'undo-propose-squash-commit <span style="font-weight: bold;">:after</span> #'my-org-reveal-and-focus)

    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Moving coursor in `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">undo-propose-mode</span><span style="font-weight: bold; font-style: italic;">' will also commit changes.</span>
    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-undo-propose-commit</span> ()
      (<span style="font-weight: bold;">when</span> undo-propose-mode
        (undo-propose-commit)))

    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-undo-propose-autocommit-on</span> ()
      (add-hook 'ah-after-move-cursor-hook 'my-undo-propose-commit))
    (advice-add 'undo-propose <span style="font-weight: bold;">:after</span> #'my-undo-propose-autocommit-on)

    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-undo-propose-autocommit-off</span> ()
      (remove-hook 'ah-after-move-cursor-hook 'my-undo-propose-commit))
    (add-hook 'undo-propose-done-hook #'my-undo-propose-autocommit-off)

    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">SPC and RET in `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">undo-propose-mode</span><span style="font-weight: bold; font-style: italic;">' will commit changes.</span>
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Additionally, the commands will be executed.</span>
    (define-key undo-propose-mode-map (kbd <span style="font-style: italic;">"SPC"</span>) 'undo-propose-commit)
    (define-key undo-propose-mode-map (kbd <span style="font-style: italic;">"RET"</span>) 'undo-propose-commit)
    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-undo-propose-key-through</span> ()
      <span style="font-style: italic;">"Through SPC and RET."</span>
      (<span style="font-weight: bold;">let</span> ((command (this-command-keys)))
        (<span style="font-weight: bold;">cond</span> ((equal (kbd <span style="font-style: italic;">"SPC"</span>) command)
               (insert <span style="font-style: italic;">" "</span>))
              ((equal (kbd <span style="font-style: italic;">"RET"</span>) command)
               (electric-newline-and-maybe-indent)))))
    (advice-add 'undo-propose-commit <span style="font-weight: bold;">:after</span> #'my-undo-propose-key-through)

    (<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my-undo-propose-modeline</span> '(<span style="font-style: italic;">"#FF5d5d"</span> <span style="font-style: italic;">"#FFFFFF"</span>))
    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-undo-propose-mode-line</span> ()
      (custom-set-faces
       `(mode-line ((t (<span style="font-weight: bold;">:background</span>
                        ,(nth 0 my-undo-propose-modeline)
                        <span style="font-weight: bold;">:foreground</span>
                        ,(nth 1 my-undo-propose-modeline)))))))

    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-undo-propose-mode-line-restore</span> ()
      (custom-set-faces '(mode-line ((t nil)))))

    (add-hook 'undo-propose-entry-hook #'my-undo-propose-mode-line)
    (add-hook 'undo-propose-done-hook #'my-undo-propose-mode-line-restore)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org82bd942f" class="outline-3">
<h3 id="org82bd942f"><span class="section-number-3">8.24</span> <span class="done DONE">DONE</span> [undo-tree] 編集履歴をわかりやすくたどる&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></h3>
<div class="outline-text-3" id="text-org82bd942f">
<p>
最近は <b>undo-fu.el</b> を使っています．
</p>

<p>
Undoのツリーが表示され，履歴をたどれます． <code>C-x u</code> と <code>q</code> に対して，フレームサイズの変更を紐付けています．また， <code>auto-save-buffers</code> が org-files をどんどん保存して記録してしまうので，ツリーを選んでいる時に auto-save-buffers が発動するのを別途抑制しています．加えて， <code>org-tree-slide</code> でナローイングしていると，タイムスタンプが記録される時に履歴が辿れなくなるので， <code>org-tree-slide</code> が有効の時は，タイムスタンプを押させないように別途制限を加えています．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">late-init.el</span>
(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(my-undo-tree-visualize)
       <span style="font-style: italic;">"undo-tree"</span> nil t)

  (global-set-key (kbd <span style="font-style: italic;">"C-x u"</span>) 'my-undo-tree-visualize)

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"undo-tree"</span>
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(global-undo-tree-mode)</span>
    (<span style="font-weight: bold;">setq</span> undo-tree-mode-lighter nil) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#12514;&#12540;&#12489;&#12521;&#12452;&#12531;&#38936;&#22495;&#12434;&#31680;&#32004;</span>

    (<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my-undo-tree-active</span> nil)
    (<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my-undo-tree-width</span> 90)

    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-undo-tree-visualize</span> ()
      (<span style="font-weight: bold;">interactive</span>)
      (undo-tree-mode 1)
      (<span style="font-weight: bold;">if</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">moom</span> nil t)
          (moom-change-frame-width-double)
        (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">and</span> (not my-undo-tree-active)
                   (not (eq buffer-undo-list t)))
          (set-frame-width nil (+ (frame-width) my-undo-tree-width))
          (<span style="font-weight: bold;">setq</span> my-undo-tree-active t)))
      (undo-tree-visualize))

    (define-key undo-tree-map (kbd <span style="font-style: italic;">"C-x u"</span>) 'my-undo-tree-visualize)

    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-undo-tree-visualizer-quit</span> ()
      (<span style="font-weight: bold;">interactive</span>)
      (undo-tree-visualizer-quit)
      (<span style="font-weight: bold;">if</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">moom</span> nil t)
          (moom-change-frame-width-single)
        (delete-window)
        (<span style="font-weight: bold;">when</span> my-undo-tree-active
          (set-frame-width nil (- (frame-width) my-undo-tree-width))
          (<span style="font-weight: bold;">setq</span> my-undo-tree-active nil)))
      (<span style="font-weight: bold;">when</span> (&lt; (frame-width) 80)
        (set-frame-width nil 80))
      (undo-tree-mode -1))

    (define-key undo-tree-visualizer-mode-map (kbd <span style="font-style: italic;">"q"</span>)
      'my-undo-tree-visualizer-quit))

  (advice-add 'undo-tree-undo-1 <span style="font-weight: bold;">:after</span> #'my-org-reveal-and-focus)
  (advice-add 'undo-tree-redo-1 <span style="font-weight: bold;">:after</span> #'my-org-reveal-and-focus))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc47c1e75" class="outline-3">
<h3 id="orgc47c1e75"><span class="section-number-3">8.25</span> <span class="done DONE">DONE</span> [wakatime-mode.el] WakaTime を利用して作業記録する&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></h3>
<div class="outline-text-3" id="text-orgc47c1e75">
<ol class="org-ol">
<li><a href="https://www.wakati.me/">https://www.wakati.me/</a>（API発行とログGUI表示）</li>
<li><a href="https://github.com/wakatime/wakatime">https://github.com/wakatime/wakatime</a>（ログ記録用スクリプト）</li>
<li><a href="https://github.com/nyuhuhuu/wakatime-mode">https://github.com/nyuhuhuu/wakatime-mode</a>（Emacs用プラグイン）</li>
</ol>

<p>
利用開始前に，ログ表示サイトでルールをカスタマイズしておくとよい．例えば，拡張子が <code>.org</code> なファイルの場合，言語設定を <code>Text</code> にする，という具合に．すると，グラフ表示がわかりやすくなる．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">wakatime-mode</span> nil t)
  (<span style="font-weight: bold;">setq</span> wakatime-api-key <span style="font-style: italic;">"&lt;insert your own api key&gt;"</span>)
  (<span style="font-weight: bold;">setq</span> wakatime-cli-path <span style="font-style: italic;">"/Users/taka/Dropbox/emacs.d/bin/wakatime-cli.py"</span>)
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#12377;&#12409;&#12390;&#12398;&#12496;&#12483;&#12501;&#12449;&#12391;&#35370;&#21839;&#26178;&#12395;&#35352;&#37682;&#12434;&#38283;&#22987;</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(global-wakatime-mode)</span>
    )
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc470d5a3" class="outline-3">
<h3 id="orgc470d5a3"><span class="section-number-3">8.26</span> <span class="done DONE">DONE</span> [backup-dir.el] バックアップファイルを一箇所に集める&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></h3>
<div class="outline-text-3" id="text-orgc470d5a3">
<p>
<code>backup-each-save</code> を使うようになりました．
</p>

<ul class="org-ul">
<li><a href="http://www.emacswiki.org/emacs/BackupDirectory">http://www.emacswiki.org/emacs/BackupDirectory</a></li>
<li><a href="http://www.northbound-train.com/emacs-hosted/backup-dir.el">http://www.northbound-train.com/emacs-hosted/backup-dir.el</a></li>
<li><a href="http://www.northbound-train.com/emacs.html">http://www.northbound-train.com/emacs.html</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(make-variable-buffer-local 'backup-inhibited)
(<span style="font-weight: bold;">setq</span> backup-files-store-dir <span style="font-style: italic;">"~/.emacs.d/backup"</span>)
(<span style="font-weight: bold;">unless</span> (file-directory-p backup-files-store-dir)
  (message <span style="font-style: italic;">"!!! %s does not exist. !!!"</span> backup-files-store-dir)
  (sleep-for 1))
(<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">backup-dir</span> nil t)
  (<span style="font-weight: bold;">when</span> (file-directory-p backup-files-store-dir)
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">backup path</span>
    (<span style="font-weight: bold;">setq</span> bkup-backup-directory-info '((t <span style="font-style: italic;">"~/.emacs.d/backup"</span> ok-create)))
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">for tramp</span>
    (<span style="font-weight: bold;">setq</span> tramp-bkup-backup-directory-info bkup-backup-directory-info)
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">generation properties</span>
    (<span style="font-weight: bold;">setq</span> delete-old-versions t
          kept-old-versions 0
          kept-new-versions 5
          version-control t)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org8b2fe680" class="outline-3">
<h3 id="org8b2fe680"><span class="section-number-3">8.27</span> <span class="done DONE">DONE</span> バッファ保存時にバックアップファイルを生成する&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></h3>
<div class="outline-text-3" id="text-org8b2fe680">
<p>
バッファが保存されるとき，必ずバックアップを生成する．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Backup the buffer whenever the buffer is saved</span>
(global-set-key (kbd <span style="font-style: italic;">"C-x C-s"</span>)
                (<span style="font-weight: bold;">lambda</span> () (<span style="font-weight: bold;">interactive</span>) (save-buffer 16)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdba35c9f" class="outline-3">
<h3 id="orgdba35c9f"><span class="section-number-3">8.28</span> <span class="done DONE">DONE</span> ミニバッファの履歴を保存しリストアする&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></h3>
<div class="outline-text-3" id="text-orgdba35c9f">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">savehist</span> nil t)
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#12498;&#12473;&#12488;&#12522;&#12501;&#12449;&#12452;&#12523;&#12434;&#26126;&#31034;&#30340;&#12395;&#25351;&#23450;</span>
  (<span style="font-weight: bold;">setq</span> savehist-file <span style="font-style: italic;">"~/Dropbox/emacs.d/.history"</span>)
  (savehist-mode 1))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgead91174" class="outline-3">
<h3 id="orgead91174"><span class="section-number-3">8.29</span> <span class="done DONE">DONE</span> Emacs終了時に開いていたバッファを起動時に復元する&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></h3>
<div class="outline-text-3" id="text-orgead91174">
<p>
Built-in の <a href="http://www.emacswiki.org/emacs/DeskTop">desktop.el</a> を使う．
</p>

<p>
org バッファを CONTENT view で大量に開いていると，再起動が非常に遅くなるので利用を中止した．代替手段として， <code>session.el</code> と <code>recentf</code> の組み合わせがある．最近利用したファイルとそのカーソル位置が保持されるため，最後に訪問していたファイルを比較的簡単に復元できる．頻繁に復元するバッファには，別途キーバインドを割り当てておけば問題ない．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"postpone"</span>
  (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">desktop</span> nil t)
    (<span style="font-weight: bold;">setq</span> desktop-files-not-to-save <span style="font-style: italic;">"</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">^/tmp</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">|</span><span style="font-style: italic;">^/var</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">|</span><span style="font-style: italic;">^/ssh:</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">"</span>)
    (<span style="font-weight: bold;">unless</span> noninteractive
      (postpone-message <span style="font-style: italic;">"desktop"</span>)
      (desktop-save-mode 1))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org63e50e2c" class="outline-3">
<h3 id="org63e50e2c"><span class="section-number-3">8.30</span> <span class="done DONE">DONE</span> 深夜にバッファを自動整理する&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></h3>
<div class="outline-text-3" id="text-org63e50e2c">
<p>
私は頻繁に再起動する派なので，使っていません．
</p>

<ul class="org-ul">
<li><a href="http://www.emacswiki.org/emacs-zh/CleanBufferList">http://www.emacswiki.org/emacs-zh/CleanBufferList</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">midnight</span> nil t)
  (<span style="font-weight: bold;">setq</span> clean-buffer-list-buffer-names
        (append clean-buffer-list-kill-buffer-names
                '(<span style="font-style: italic;">"note.txt"</span>)))
  (<span style="font-weight: bold;">setq</span> clean-buffer-list-delay-general 1)
  (<span style="font-weight: bold;">setq</span> clean-buffer-list-delay-special 10))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgf1b8fa63" class="outline-2">
<h2 id="orgf1b8fa63"><span class="section-number-2">9</span> 開発サポート</h2>
<div class="outline-text-2" id="text-orgf1b8fa63">
</div>
<div id="outline-container-org9f988c12" class="outline-3">
<h3 id="org9f988c12"><span class="section-number-3">9.1</span> 便利キーバインド</h3>
<div class="outline-text-3" id="text-org9f988c12">
<p>
コメントアウトとコンパイルをすぐ呼べるようにします．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(global-set-key (kbd <span style="font-style: italic;">"C-;"</span>) 'comment-dwim) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">M-; is the defualt</span>
(global-set-key (kbd <span style="font-style: italic;">"C-c c"</span>) 'compile)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgac7d1689" class="outline-3">
<h3 id="orgac7d1689"><span class="section-number-3">9.2</span> [gist.el] Gist インターフェイス</h3>
<div class="outline-text-3" id="text-orgac7d1689">
<ul class="org-ul">
<li><a href="https://github.com/defunkt/gist.el">defunkt/gist.el: Yet another Emacs paste mode, this one for Gist.</a></li>
</ul>

<p>
事前に <code>github.user</code> と <code>github.oauth-token</code> を設定します．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(autoload-if-found '(gist-mode) <span style="font-style: italic;">"gist"</span> nil t)
</pre>
</div>
</div>
</div>

<div id="outline-container-org7baba8dd" class="outline-3">
<h3 id="org7baba8dd"><span class="section-number-3">9.3</span> [doxymacs.el] Doxygen のコメントを簡単に入力する</h3>
<div class="outline-text-3" id="text-org7baba8dd">
<ul class="org-ul">
<li><a href="http://doxymacs.sourceforge.net/">http://doxymacs.sourceforge.net/</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(doxymacs-mode)
       <span style="font-style: italic;">"doxymacs"</span> nil t)

  (add-hook 'c-mode-common-hook #'doxymacs-mode)

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"doxymacs"</span>
    (<span style="font-weight: bold;">setq</span> doxymacs-doxygen-style <span style="font-style: italic;">"JavaDoc"</span>)
    (add-hook 'font-lock-mode-hook
              (<span style="font-weight: bold;">lambda</span> ()
                  (<span style="font-weight: bold;">when</span> (memq major-mode '(c-mode c++-mode))
                    (doxymacs-font-lock))))
    (define-key doxymacs-mode-map (kbd <span style="font-style: italic;">"C-c C-s"</span>) 'ff-find-other-file)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org0e27778c" class="outline-3">
<h3 id="org0e27778c"><span class="section-number-3">9.4</span> [matlab.el] Matlab用の設定</h3>
<div class="outline-text-3" id="text-org0e27778c">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">late-init.el</span>
(<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">and</span> (memq window-system '(mac ns))
           (&gt; emacs-major-version 23))
  (<span style="font-weight: bold;">when</span> (autoload-if-found
         '(matlab-mode matlab-shell)
         <span style="font-style: italic;">"matlab"</span> nil t)
    (<span style="font-weight: bold;">push</span> '(<span style="font-style: italic;">"\\.m$"</span> . matlab-mode) auto-mode-alist)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org966da7c1" class="outline-3">
<h3 id="org966da7c1"><span class="section-number-3">9.5</span> [flycheck.el] 構文エラー表示</h3>
<div class="outline-text-3" id="text-org966da7c1">
<ul class="org-ul">
<li>auto-complete より前に hook設定しておくと余計なエラーが出ないようです．</li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(flycheck-mode)
       <span style="font-style: italic;">"flycheck"</span> nil t)

  (<span style="font-weight: bold;">dolist</span> (hook
           '(go-mode-hook
             js2-mode-hook
             c-mode-common-hook
             perl-mode-hook
             python-mode-hook))
    (add-hook hook #'flycheck-mode))

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"flycheck"</span>
    (<span style="font-weight: bold;">setq</span> flycheck-gcc-language-standard <span style="font-style: italic;">"c++14"</span>)
    (<span style="font-weight: bold;">setq</span> flycheck-clang-language-standard <span style="font-style: italic;">"c++14"</span>)
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">TODO: really needed?</span>
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(when (require 'flycheck-clang-tidy nil t)</span>
    <span style="font-weight: bold; font-style: italic;">;;   </span><span style="font-weight: bold; font-style: italic;">(add-hook 'flycheck-mode-hook #'flycheck-clang-tidy-setup))</span>
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">http://qiita.com/senda-akiha/items/cddb02cfdbc0c8c7bc2b</span>
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(when (require 'flycheck-pos-tip nil t)</span>
    <span style="font-weight: bold; font-style: italic;">;;   </span><span style="font-weight: bold; font-style: italic;">'(custom-set-variables</span>
    <span style="font-weight: bold; font-style: italic;">;;     </span><span style="font-weight: bold; font-style: italic;">'(flycheck-display-errors-function</span>
    <span style="font-weight: bold; font-style: italic;">;;       </span><span style="font-weight: bold; font-style: italic;">#'flycheck-pos-tip-error-messages)))</span>

    (<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">counsel-flycheck-history</span> nil
      <span style="font-style: italic;">"History for `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">counsel-flycheck</span><span style="font-style: italic;">'"</span>)

    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">counsel-flycheck-action</span> (obj <span style="font-weight: bold; text-decoration: underline;">&amp;rest</span> _)
      (<span style="font-weight: bold;">-when-let*</span> ((<span style="font-weight: bold;">error</span> (get-text-property 0 'tabulated-list-id obj))
                   (pos (flycheck-error-pos error)) )
        (goto-char (flycheck-error-pos error))))

    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">counsel-flycheck</span> ()
      (<span style="font-weight: bold;">interactive</span>)
      (<span style="font-weight: bold;">if</span> (not (<span style="font-weight: bold;">bound-and-true-p</span> flycheck-mode))
          (message <span style="font-style: italic;">"Flycheck mode is not available or enabled"</span>)
        (ivy-read <span style="font-style: italic;">"Error: "</span>
                  (<span style="font-weight: bold;">let</span> ((source-buffer (current-buffer)))
                    (<span style="font-weight: bold;">with-current-buffer</span>
                        (<span style="font-weight: bold;">or</span> (get-buffer flycheck-error-list-buffer)
                            (<span style="font-weight: bold;">progn</span>
                              (<span style="font-weight: bold;">with-current-buffer</span>
                                  (get-buffer-create flycheck-error-list-buffer)
                                (flycheck-error-list-mode)
                                (current-buffer))))
                      (flycheck-error-list-set-source source-buffer)
                      (flycheck-error-list-reset-filter)
                      (revert-buffer t t t)
                      (split-string (buffer-string) <span style="font-style: italic;">"\n"</span> t <span style="font-style: italic;">" *"</span>)))
                  <span style="font-weight: bold;">:action</span> 'counsel-flycheck-action <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(lambda (s &amp;rest _))</span>
                  <span style="font-weight: bold;">:history</span> 'counsel-flycheck-history
                  <span style="font-weight: bold;">:caller</span> 'counsel-flycheck)))
    ))

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(flycheck-add-next-checker 'javascript-jshint</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">'javascript-gjslint)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org2bf4fb77" class="outline-3">
<h3 id="org2bf4fb77"><span class="section-number-3">9.6</span> [origami.el] 関数の折りたたみ</h3>
<div class="outline-text-3" id="text-org2bf4fb77">
<ul class="org-ul">
<li><code>hideshowvis.el</code> よりも軽い印象なので，現在は <code>origami.el</code> を使用中．</li>
<li><a href="https://github.com/gregsexton/origami.el">gregsexton/origami.el: A folding minor mode for Emacs</a></li>
<li><a href="https://github.com/zenozeng/yafolding.el">zenozeng/yafolding.el: Yet another folding extension for Emacs</a></li>
<li><a href="https://github.com/tj64/outline-magic/blob/master/outline-magic.el">outline-magic/outline-magic.el at master · tj64/outline-magic</a></li>
<li>後発として <a href="https://github.com/tarsius/bicycle">bicycle.el</a> があります．</li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(origami-mode origami-toggle-node)
       <span style="font-style: italic;">"origami"</span> nil t)

  (<span style="font-weight: bold;">dolist</span> (hook '(emacs-lisp-mode-hook c-mode-common-hook yatex-mode-hook))
    (add-hook hook #'origami-mode))

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"origami"</span>
    (define-key origami-mode-map (kbd <span style="font-style: italic;">"C-t"</span>) #'origami-toggle-node)
    (define-key origami-mode-map (kbd <span style="font-style: italic;">"C-u C-t"</span>)
      #'origami-toggle-all-nodes)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org291c6055" class="outline-3">
<h3 id="org291c6055"><span class="section-number-3">9.7</span> [auto-complete-clang.el] オムニ補完</h3>
<div class="outline-text-3" id="text-org291c6055">
<p>
C++バッファでメソッドを補完対象とする．try-catch を使っている場合， <code>-fcxx-exceptions</code> オプションが必要で，これはプリコンパイルヘッダを生成する時も同じだ．ここ示す設定では， <code>~/.emacs.d/</code> 以下に <code>stdafx.pch</code> を生成する必要があり，以下のコマンドを用いてプリコンパイルヘッダを生成する．ヘッダファイルのパスを適切に与えれば，Boostや自作のライブラリも補完対象に設定できる．
</p>

<p>
現状では，補完直後にデフォルトの引数がすべて書き込まれてしまう．なんかうまいことしたいものだ．
</p>

<div class="org-src-container">
<pre class="src src-sh">clang -cc1 -x c++-header -fcxx-exceptions -std=c++11 -stdlib=libc++ -emit-pch ~/.emacs.d/stdafx.h -o ~/.emacs.d/stdafx.pch -I/opt/local/include -I/opt/local/include/netpbm -I/Users/taka/devel/icp/lib
</pre>
</div>

<p>
以下の設定は，先に <code>auto-complete.el</code> に関する設定を読み込んでいることを前提としている． <code>ac-clang-flags</code> の値は， <code>stdafx.pch</code> の作成で使用したパラメータと合わせないとエラーが生じる可能性があります．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(auto-complete ac-cc-mode-setup)
       <span style="font-style: italic;">"auto-complete"</span> nil t)

  (add-hook 'c-mode-common-hook #'ac-cc-mode-setup)

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"auto-complete"</span>
    (<span style="font-weight: bold;">if</span> (not (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">auto-complete-clang</span> nil t))
        (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">ac-cc-mode-setup</span> ()
          (<span style="font-weight: bold;">warn</span> <span style="font-style: italic;">"auto-complete-clang is NOT installed"</span>))
      (<span style="font-weight: bold;">setq</span> ac-clang-executable (executable-find <span style="font-style: italic;">"clang"</span>))
      <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">ac-cc-mode-setup &#12398;&#12458;&#12540;&#12496;&#12540;&#12521;&#12452;&#12489;</span>
      <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">"-w" "-ferror-limit" "1"</span>
      (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">ac-cc-mode-setup</span> ()
        (<span style="font-weight: bold;">setq</span> ac-clang-auto-save t)
        (<span style="font-weight: bold;">setq</span> ac-clang-prefix-header <span style="font-style: italic;">"~/.emacs.d/stdafx.pch"</span>)
        (<span style="font-weight: bold;">setq</span> ac-clang-flags '(<span style="font-style: italic;">"-x"</span> <span style="font-style: italic;">"c++-header"</span> <span style="font-style: italic;">"-fcxx-exceptions"</span>
                               <span style="font-style: italic;">"-std=c++14"</span> <span style="font-style: italic;">"-stdlib=libc++"</span>
                               <span style="font-style: italic;">"-I/opt/local/include"</span>
                               <span style="font-style: italic;">"-I/opt/local/include/netpbm"</span>
                               <span style="font-style: italic;">"-I/Users/taka/devel/icp/lib"</span>))
        (<span style="font-weight: bold;">setq</span> ac-sources '(ac-source-clang
                           ac-source-yasnippet
                           ac-source-gtags))))))
</pre>
</div>

<p>
次のコードを hoge.cpp として保存し， <code>v</code> と <code>t</code> について補完できれば， <code>STL</code> と <code>Boost</code> のプリコンパイルヘッダが有効になっていることを確認できる．
</p>

<div class="org-src-container">
<pre class="src src-cpp"><span style="font-weight: bold;">#include</span> <span style="font-style: italic;">&lt;iostream&gt;</span>
<span style="font-weight: bold;">#include</span> <span style="font-style: italic;">&lt;vector&gt;</span>
<span style="font-weight: bold;">#include</span> <span style="font-style: italic;">&lt;boost/timer.hpp&gt;</span>

<span style="font-weight: bold; text-decoration: underline;">int</span> <span style="font-weight: bold;">main</span>(){
  <span style="font-weight: bold; text-decoration: underline;">std</span>::<span style="font-weight: bold; text-decoration: underline;">vector</span>&lt;<span style="font-weight: bold; text-decoration: underline;">int</span>&gt; <span style="font-weight: bold; font-style: italic;">v</span>;
  v; <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">&#12371;&#12371;</span>
  <span style="font-weight: bold; text-decoration: underline;">boost</span>::<span style="font-weight: bold; text-decoration: underline;">timer</span> <span style="font-weight: bold; font-style: italic;">t</span>;
  cout &lt;&lt; t; <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">&#12371;&#12371;</span>
  <span style="font-weight: bold;">return</span> 1;
}
</pre>
</div>
</div>

<div id="outline-container-org3d08c27d" class="outline-4">
<h4 id="org3d08c27d"><span class="section-number-4">9.7.1</span> References</h4>
<div class="outline-text-4" id="text-org3d08c27d">
<ul class="org-ul">
<li><a href="http://d.hatena.ne.jp/kenbell1988/20120428/1335609313">http://d.hatena.ne.jp/kenbell1988/20120428/1335609313</a></li>
<li><a href="http://d.hatena.ne.jp/whitypig/20110306/1299416655">http://d.hatena.ne.jp/whitypig/20110306/1299416655</a></li>
<li><a href="http://d.hatena.ne.jp/yano-htn/?of=30">http://d.hatena.ne.jp/yano-htn/?of=30</a></li>
<li><a href="http://www.nomtats.com/2010/11/auto-completeelemacs.html">http://www.nomtats.com/2010/11/auto-completeelemacs.html</a></li>
<li><a href="http://www.plugmasters.com.br/plugfeed/post/73768/awesome-cc-autocompletion-in-emacs">http://www.plugmasters.com.br/plugfeed/post/73768/awesome-cc-autocompletion-in-emacs</a></li>
</ul>
</div>
</div>
</div>

<div id="outline-container-orgabd9abb3" class="outline-3">
<h3 id="orgabd9abb3"><span class="section-number-3">9.8</span> [quickrun.el] お手軽ビルド</h3>
<div class="outline-text-3" id="text-orgabd9abb3">
<p>
カレントバッファで編集中のソースコードをビルド・実行して，別バッファに結果を得ます．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(quickrun)
       <span style="font-style: italic;">"quickrun"</span> nil t)

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"go-mode"</span>
    (define-key go-mode-map (kbd <span style="font-style: italic;">"&lt;f5&gt;"</span>) 'quickrun))
  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"c++-mode"</span>
    (define-key c++-mode-map (kbd <span style="font-style: italic;">"&lt;f5&gt;"</span>) 'quickrun))
  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"python-mode"</span>
    (define-key python-mode-map (kbd <span style="font-style: italic;">"&lt;f5&gt;"</span>) 'quickrun))
  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"perl-mode"</span>
    (define-key perl-mode-map (kbd <span style="font-style: italic;">"&lt;f5&gt;"</span>) 'quickrun))
  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"gnuplot-mode"</span>
    (define-key gnuplot-mode-map (kbd <span style="font-style: italic;">"&lt;f5&gt;"</span>) 'quickrun)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org034bbf9f" class="outline-3">
<h3 id="org034bbf9f"><span class="section-number-3">9.9</span> [ggtags.el] タグジャンプ</h3>
<div class="outline-text-3" id="text-org034bbf9f">
<ul class="org-ul">
<li><a href="http://tasuwo.github.io/blog/2016/03/04/c-c-plus-plus/">EmacsにおけるC,C++の環境を整える - tasuwo blog</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">if</span> (not (executable-find <span style="font-style: italic;">"gtags"</span>))
    (message <span style="font-style: italic;">"--- global is NOT installed in this system."</span>)

  (<span style="font-weight: bold;">when</span> (autoload-if-found
         '(ggtags-mode)
         <span style="font-style: italic;">"ggtags"</span> nil t)

    (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"ggtags"</span>
      <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(setq ggtags-completing-read-function t) ;; nil for helm</span>
      (define-key ggtags-mode-map (kbd <span style="font-style: italic;">"M-]"</span>) nil))

    (<span style="font-weight: bold;">dolist</span> (hook (list 'c-mode-common-hook 'python-mode-hook))
      (add-hook hook (<span style="font-weight: bold;">lambda</span> () (ggtags-mode 1)))))

  (<span style="font-weight: bold;">when</span> (autoload-if-found
         '(counsel-gtags-mode)
         <span style="font-style: italic;">"counsel-gtags"</span> nil t)
    (<span style="font-weight: bold;">dolist</span> (hook '(c-mode-hook c++-mode-hook))
      (add-hook hook 'counsel-gtags-mode))
    (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"counsel-gtags"</span>
      (custom-set-variables
       '(counsel-gtags-update-interval-second 10)))))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
         '(helm-gtags-mode)
         <span style="font-style: italic;">"helm-gtags"</span> nil t)

    (add-hook 'c-mode-common-hook #'helm-gtags-mode)
    (add-hook 'python-mode-hook #'helm-gtags-mode)

    (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"helm-gtags"</span>
      (custom-set-variables
       '(helm-gtags-mode-name <span style="font-style: italic;">""</span>))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org216e9539" class="outline-3">
<h3 id="org216e9539"><span class="section-number-3">9.10</span> [0xc.el] N進数変換</h3>
<div class="outline-text-3" id="text-org216e9539">
<ul class="org-ul">
<li>実施頻度の高い16進数と10進数の相互変換に重宝します．</li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(0xc-convert 0xc-convert-point my-decimal-to-hex my-hex-to-decimal)
       <span style="font-style: italic;">"0xc"</span> nil t)

  (global-set-key (kbd <span style="font-style: italic;">"C-c f h"</span>) '0xc-convert)

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"0xc"</span>
    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-decimal-to-hex</span> ()
      (<span style="font-weight: bold;">interactive</span>)
      (0xc-convert 16 (word-at-point)))
    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-hex-to-decimal</span> ()
      (<span style="font-weight: bold;">interactive</span>)
      (0xc-convert 10 (word-at-point)))))
</pre>
</div>
</div>
</div>

<div id="outline-container-orge830f6b0" class="outline-3">
<h3 id="orge830f6b0"><span class="section-number-3">9.11</span> [hexl.el] バイナリファイルを開く</h3>
<div class="outline-text-3" id="text-orge830f6b0">
<p>
ビルトインの <code>hexl-mode</code> を使います．
</p>

<ul class="org-ul">
<li><a href="https://ayatakesi.github.io/emacs/24.5/Editing-Binary-Files.html">GNU Emacs Manual(Japanese Translation): Editing Binary Files</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"hexl"</span>
  (custom-set-variables
   '(hexl-bits 8)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org9ffc2142" class="outline-3">
<h3 id="org9ffc2142"><span class="section-number-3">9.12</span> [uuid.el] UUID の生成</h3>
<div class="outline-text-3" id="text-org9ffc2142">
<ul class="org-ul">
<li><a href="https://github.com/nicferrier/emacs-uuid">nicferrier/emacs-uuid: The UUID module from the EmacsWiki, initially by someone called James Mastros.</a></li>
</ul>

<p>
新しい <code>UUID</code> を生成してカーソル位置に書き出すように <code>my-uuid-string</code> を定義しています．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(uuid-string my-uuid-string)
       <span style="font-style: italic;">"uuid"</span> nil t)

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"uuid"</span>
    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-uuid-string</span> ()
      (<span style="font-weight: bold;">interactive</span>)
      (insert (uuid-string)))))
</pre>
</div>
</div>
</div>

<div id="outline-container-orga1d9863f" class="outline-3">
<h3 id="orga1d9863f"><span class="section-number-3">9.13</span> [package-lint.el] MEPLA登録用Lint</h3>
<div class="outline-text-3" id="text-orga1d9863f">
<p>
MELPAへの登録を目指す emacslisp パッケージの実装で，所定の書式で記述されているかを確認できます． <code>docstring</code> のチェックは， <code>M-x checkdoc</code> でできます．
</p>

<ul class="org-ul">
<li><a href="https://github.com/purcell/package-lint">https://github.com/purcell/package-lint</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(autoload-if-found '(package-lint-current-buffer) <span style="font-style: italic;">"package-lint"</span> nil t)
</pre>
</div>
</div>
</div>

<div id="outline-container-org7d18b489" class="outline-3">
<h3 id="org7d18b489"><span class="section-number-3">9.14</span> [projectile.el] ディレクトリ単位でファイル群をプロジェクト扱いする</h3>
<div class="outline-text-3" id="text-org7d18b489">
<ul class="org-ul">
<li>プロジェクト内に限定して検索をかける時に重宝する．</li>
<li>カレントバッファがプロジェクト内のファイルの場合は，タイトルバーにプロジェクト名を出すように設定しています．</li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(projectile-mode)
       <span style="font-style: italic;">"projectile"</span> nil t)

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"neotree"</span>
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">M-x helm-projectile-switch-project (C-c p p)</span>
    (<span style="font-weight: bold;">setq</span> projectile-switch-project-action 'neotree-projectile-action)

    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">ad:neotree-dir</span> (path)
      <span style="font-style: italic;">"Extension to change the frame width automatically."</span>
      (<span style="font-weight: bold;">interactive</span> <span style="font-style: italic;">"DDirectory: "</span>)
      (<span style="font-weight: bold;">unless</span> (neo-global--window-exists-p)
        (neotree-show))
      (neo-global--open-dir path)
      (neo-global--select-window))
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(advice-add 'neotree-dir :override #'ad:neotree-dir) ;; FIXME</span>
    )

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"projectile"</span>
    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">ad:projectile-visit-project-tags-table</span> ()
      <span style="font-style: italic;">"Extensions to skip calling `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">visit-tags-table</span><span style="font-style: italic;">'."</span>
      nil)
    (advice-add 'projectile-visit-project-tags-table <span style="font-weight: bold;">:override</span>
                #'ad:projectile-visit-project-tags-table)

    (<span style="font-weight: bold;">setq</span> projectile-mode-line-lighter <span style="font-style: italic;">""</span>)
    (<span style="font-weight: bold;">setq</span> projectile-dynamic-mode-line nil)
    (<span style="font-weight: bold;">setq</span> projectile-tags-command <span style="font-style: italic;">"gtags"</span>)
    (<span style="font-weight: bold;">setq</span> projectile-tags-backend 'ggtags)
    (<span style="font-weight: bold;">setq</span> projectile-tags-file-name <span style="font-style: italic;">"GTAGS"</span>)

    (<span style="font-weight: bold;">setq</span> projectile-use-git-grep t)
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(setq projectile-mode-line</span>
    <span style="font-weight: bold; font-style: italic;">;;       </span><span style="font-weight: bold; font-style: italic;">'(:eval (format " P:%s" (projectile-project-name))))</span>
    (<span style="font-weight: bold;">setq</span> projectile-mode-line <span style="font-style: italic;">""</span>)

    (<span style="font-weight: bold;">setq</span> icon-title-format
          (<span style="font-weight: bold;">setq</span> frame-title-format
                '((<span style="font-weight: bold;">:eval</span>
                   (<span style="font-weight: bold;">let</span> ((project-name (projectile-project-name)))
                     (<span style="font-weight: bold;">unless</span> (string= <span style="font-style: italic;">"-"</span> project-name)
                       (format <span style="font-style: italic;">"(%s) - "</span> project-name))))
                  <span style="font-style: italic;">"%b"</span>)))

    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">counsel-projectile</span>
    (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">counsel-projectile</span> nil t)
      (add-to-list 'counsel-projectile-switch-project-action
                   '(<span style="font-style: italic;">"z"</span> my-counsel-fzf-in-default-dir
                     <span style="font-style: italic;">"switch to fzf"</span>) <span style="font-weight: bold;">t)</span>
      (add-to-list 'counsel-projectile-find-file-action
                   '(<span style="font-style: italic;">"z"</span> my-counsel-fzf-in-default-dir
                     <span style="font-style: italic;">"switch to fzf"</span>) <span style="font-weight: bold;">t)</span>

      (<span style="font-weight: bold;">setq</span> projectile-completion-system 'ivy)
      (<span style="font-weight: bold;">setq</span> counsel-projectile-sort-files t) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#24403;&#35442;&#12503;&#12525;&#12472;&#12455;&#12463;&#12488;&#20869;&#12522;&#12473;&#12488;&#12434;&#12477;&#12540;&#12488;</span>
      (<span style="font-weight: bold;">setq</span> counsel-projectile-sort-projects t) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#12503;&#12525;&#12472;&#12455;&#12463;&#12488;&#12522;&#12473;&#12488;&#12434;&#12477;&#12540;&#12488;</span>
      (define-key projectile-mode-map (kbd <span style="font-style: italic;">"C-c p"</span>) 'projectile-command-map)
      (counsel-projectile-mode 1)))

  (<span style="font-weight: bold;">unless</span> noninteractive
    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-projectile-activate</span> ()
      (<span style="font-weight: bold;">interactive</span>)
      (<span style="font-weight: bold;">setq</span> projectile-keymap-prefix (kbd <span style="font-style: italic;">"C-c p"</span>))
      (projectile-mode 1)
      (remove-hook 'find-file-hook #'my-projectile-activate))
    (add-hook 'find-file-hook #'my-projectile-activate)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org1c672519" class="outline-3">
<h3 id="org1c672519"><span class="section-number-3">9.15</span> [relint.el] elispの正規表現用のlinter</h3>
<div class="outline-text-3" id="text-org1c672519">
<p>
正規表現をチェックしてくれます．
</p>

<ul class="org-ul">
<li><a href="https://github.com/mattiase/relint">mattiase/relint: Elisp regexp lint tool</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(autoload-if-found '(relint-current-buffer) <span style="font-style: italic;">"relint"</span> nil t)
</pre>
</div>
</div>
</div>

<div id="outline-container-org7d969237" class="outline-3">
<h3 id="org7d969237"><span class="section-number-3">9.16</span> [magit.el] Gitクライアント</h3>
<div class="outline-text-3" id="text-org7d969237">
<p>
Emacs の中で Git リポジトリを操作できます． <code>magit-repository-directories</code> を設定しておけば，管理しているリポジトリの一覧を表示できます． <code>helm</code> や <code>ivy</code> と連携していれば，絞り込みも簡単です．さらに， <code>M-x magit-list-repositories</code> を実行すれば，各リポジトリのステータス全体を一覧表示できます．ただし，調査対象のリポジトリ数が多ければ，一覧表示に時間がかかります．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(magit-status ad:magit-mode-bury-buffer)
       <span style="font-style: italic;">"magit"</span> nil t)

  (global-set-key (kbd <span style="font-style: italic;">"C-c m"</span>) 'magit-status)

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"magit"</span>
    (<span style="font-weight: bold;">when</span> (fboundp 'dimmer-off)
      (add-hook 'magit-status-mode-hook 'dimmer-off))
    (<span style="font-weight: bold;">when</span> (fboundp 'magit-mode-bury-buffer)
      (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">ad:magit-mode-bury-buffer</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> _bury)
        (<span style="font-weight: bold;">when</span> (fboundp 'dimmer-on)
          (<span style="font-weight: bold;">setq</span> my-dimmer-mode t)
          (dimmer-on)
          (redraw-frame)))
      (advice-add 'magit-mode-bury-buffer <span style="font-weight: bold;">:before</span> #'ad:magit-mode-bury-buffer))
    (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">and</span> (boundp 'magit-completing-read-function)
               (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">ivy</span> nil t))
      <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">ivy &#12434;&#20351;&#12358;</span>
      (<span style="font-weight: bold;">setq</span> magit-completing-read-function 'ivy-completing-read))
    (<span style="font-weight: bold;">when</span> (boundp 'magit-repository-directories)
      (<span style="font-weight: bold;">setq</span> magit-repository-directories
            '((<span style="font-style: italic;">"~/devel/git"</span> . 1)
              (<span style="font-style: italic;">"~/devel/mygit"</span> . 1))))))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgaa25b74c" class="outline-3">
<h3 id="orgaa25b74c"><span class="section-number-3">9.17</span> <span class="todo TODO">TODO</span> [EditorConfig] コードスタイルの強制</h3>
<div class="outline-text-3" id="text-orgaa25b74c">
<ul class="org-ul">
<li><a href="http://editorconfig.org/#contributing">EditorConfig</a></li>
<li><a href="https://github.com/editorconfig/editorconfig-emacs#readme">editorconfig/editorconfig-emacs: EditorConfig plugin for emacs</a></li>
<li><a href="https://github.com/10sr/editorconfig-charset-extras-el">10sr/editorconfig-charset-extras-el: Extra EditorConfig Charset Support</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">if</span> (executable-find <span style="font-style: italic;">"editorconfig"</span>)
    (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">and</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">editorconfig</span> nil t)
               (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">editorconfig-core</span> nil t))
      (<span style="font-weight: bold;">unless</span> noninteractive
        <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(add-to-list 'editorconfig-exclude-modes 'org-mode)</span>
        <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(when (require 'editorconfig-charset-extras nil t)</span>
        <span style="font-weight: bold; font-style: italic;">;;   </span><span style="font-weight: bold; font-style: italic;">(add-hook 'editorconfig-custom-hooks</span>
        <span style="font-weight: bold; font-style: italic;">;;             </span><span style="font-weight: bold; font-style: italic;">#'editorconfig-charset-extras))</span>
        (editorconfig-mode 1)))
  (message <span style="font-style: italic;">"--- editorconfig is NOT installed."</span>))
</pre>
</div>

<p>
例えば，次のようなファイルを共有プロジェクトに保存しておきます． <code>.editorconfig</code> として配置します．
</p>

<div class="org-src-container">
<pre class="src src-conf"><span style="font-weight: bold; font-style: italic;">root</span> = true

[<span style="font-weight: bold; text-decoration: underline;">*</span>]
<span style="font-weight: bold; font-style: italic;">charset</span> = utf-8
<span style="font-weight: bold; font-style: italic;">end_of_line</span> = lf
<span style="font-weight: bold; font-style: italic;">insert_final_newline</span> = true
<span style="font-weight: bold; font-style: italic;">indent_style</span> = space
<span style="font-weight: bold; font-style: italic;">indent_size</span> = 2
<span style="font-weight: bold; font-style: italic;">trim_trailing_whitespace</span> = true
</pre>
</div>
</div>
</div>

<div id="outline-container-orgae4ecac7" class="outline-3">
<h3 id="orgae4ecac7"><span class="section-number-3">9.18</span> <span class="todo TODO">TODO</span> [cov] カバレッジの状態をフリンジで確認</h3>
<div class="outline-text-3" id="text-orgae4ecac7">
<p>
<code>gcov</code> の結果をフリンジに表示します．
</p>

<ul class="org-ul">
<li><a href="https://github.com/adamniederer/cov">https://github.com/adamniederer/cov</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(autoload-if-found '(cov-mode) <span style="font-style: italic;">"cov"</span> nil t)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbf790f4d" class="outline-3">
<h3 id="orgbf790f4d"><span class="section-number-3">9.19</span> <span class="todo TODO">TODO</span> [format-all.el] コード整形</h3>
<div class="outline-text-3" id="text-orgbf790f4d">
<ul class="org-ul">
<li><a href="https://melpa.org/#/format-all">format-all - MELPA</a></li>
</ul>

<p>
様々なプログラミング言語に対して，共通のコード整形のトリガー（ <code>M-x format-all-buffer</code> ）を提供します．整形するために使うフォーマッタは，原則的に言語ごとに異なる外部ツールを呼び出すので，必要に応じてそれらのツールを別途インストールします．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(autoload-if-found '(format-all-mode) <span style="font-style: italic;">"format-all"</span> nil t)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgac7d24d7" class="outline-3">
<h3 id="orgac7d24d7"><span class="section-number-3">9.20</span> <span class="todo TODO">TODO</span> [emr.el] リファクタリング</h3>
<div class="outline-text-3" id="text-orgac7d24d7">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"postpone"</span>
  (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">emr</span> nil t)
    (define-key prog-mode-map (kbd <span style="font-style: italic;">"M-RET"</span>) 'emr-show-refactor-menu)
    (emr-initialize)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org4e23f079" class="outline-3">
<h3 id="org4e23f079"><span class="section-number-3">9.21</span> <span class="todo TODO">TODO</span> [rmsbolt.el] アセンブリをバッファにリアルタイム表示</h3>
<div class="outline-text-3" id="text-org4e23f079">
<ul class="org-ul">
<li><a href="https://gitlab.com/jgkamat/rmsbolt">https://gitlab.com/jgkamat/rmsbolt</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(autoload-if-found '(rmsbolt-mode) <span style="font-style: italic;">"rmsbolt"</span> nil t)
</pre>
</div>
</div>
</div>

<div id="outline-container-org9547f772" class="outline-3">
<h3 id="org9547f772"><span class="section-number-3">9.22</span> <span class="todo TODO">TODO</span> [semantic-refactor.el] リファクタリングツール</h3>
<div class="outline-text-3" id="text-org9547f772">
<ul class="org-ul">
<li><a href="https://github.com/tuhdo/semantic-refactor">tuhdo/semantic-refactor: Semantic Refactor is a refactoring tool based on Semantic parser framework</a></li>
</ul>
</div>
</div>
<div id="outline-container-orgea32afad" class="outline-3">
<h3 id="orgea32afad"><span class="section-number-3">9.23</span> <span class="todo TODO">TODO</span> [company.el] 続・自動補完機能</h3>
<div class="outline-text-3" id="text-orgea32afad">
<p>
<code>auto-complete.el</code> がメンテナンスモードに入ったので <code>company</code> に移行しました．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-company-activate</span> ()
  (remove-hook 'emacs-lisp-mode-hook #'my-company-activate)
  (remove-hook 'org-mode-hook #'my-company-activate)
  (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">company</span> nil t))
(add-hook 'emacs-lisp-mode-hook #'my-company-activate)
(add-hook 'org-mode-hook #'my-company-activate)

(<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"company"</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">http://xenodium.com/emacs-org-block-company-completion/</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(require 'map)</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(require 'org)</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(require 'seq)</span>
  (<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">company-org-block-bol-p</span> t <span style="font-style: italic;">"If t, detect completion when at</span>
<span style="font-style: italic;">begining of line, otherwise detect completion anywhere."</span>)

  (<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">company-org--regexp</span> <span style="font-style: italic;">"&lt;</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">[</span><span style="font-style: italic;">^</span><span style="font-style: italic;"> ]*</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">"</span>)

  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">company-org-block</span> (command <span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> arg <span style="font-weight: bold; text-decoration: underline;">&amp;rest</span> ignored)
    <span style="font-style: italic;">"Complete org babel languages into source blocks."</span>
    (<span style="font-weight: bold;">interactive</span> (list 'interactive))
    (<span style="font-weight: bold;">cl-case</span> command
      (<span style="font-weight: bold;">interactive</span> (company-begin-backend 'company-org-block))
      (prefix (<span style="font-weight: bold;">when</span> (derived-mode-p 'org-mode)
                (company-org-block--grab-symbol-cons)))
      (candidates (company-org-block--candidates arg))
      (post-completion
       (company-org-block--expand arg))))

  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">company-org-block--candidates</span> (prefix)
    <span style="font-style: italic;">"Return a list of org babel languages matching PREFIX."</span>
    (seq-filter (<span style="font-weight: bold;">lambda</span> (language)
                  (string-prefix-p prefix language))
                <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Flatten `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">org-babel-load-languages</span><span style="font-weight: bold; font-style: italic;">' and</span>
                <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">`</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">org-structure-template-alist</span><span style="font-weight: bold; font-style: italic;">', join, and sort.</span>
                (seq-sort
                 #'string-lessp
                 (append
                  (mapcar #'prin1-to-string
                          (map-keys org-babel-load-languages))
                  (map-values org-structure-template-alist)))))

  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">company-org-block--template-p</span> (template)
    (seq-contains (map-values org-structure-template-alist)
                  template))

  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">company-org-block--expand</span> (insertion)
    <span style="font-style: italic;">"Replace INSERTION with actual source block."</span>
    (delete-region (point) (- (point) (1+ <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Include "&lt;" in length.</span>
                                       (length insertion))))
    (<span style="font-weight: bold;">if</span> (company-org-block--template-p insertion)
        (company-org-block--wrap-point insertion
                                       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">May be multiple words.</span>
                                       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Take the first one.</span>
                                       (nth 0 (split-string insertion)))
      (company-org-block--wrap-point (format <span style="font-style: italic;">"src %s"</span> insertion)
                                     <span style="font-style: italic;">"src"</span>)))

  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">company-org-block--wrap-point</span> (begin end)
    <span style="font-style: italic;">"Wrap point with block using BEGIN and END.  For example:</span>
<span style="font-style: italic;">#+begin_BEGIN</span>
<span style="font-style: italic;">  |</span>
<span style="font-style: italic;">#+end_END"</span>
    (insert (format <span style="font-style: italic;">"#+begin_%s\n"</span> begin))
    (insert (make-string org-edit-src-content-indentation ?\s))
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Saving excursion restores point to location inside code block.</span>
    (<span style="font-weight: bold;">save-excursion</span>
      (insert (format <span style="font-style: italic;">"\n#+end_%s"</span> end))))

  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">company-org-block--grab-symbol-cons</span> ()
    <span style="font-style: italic;">"Return cons with symbol and t whenever prefix of &lt; is found.</span>
<span style="font-style: italic;">For example: \"&lt;e\" -&gt; (\"e\" . t)"</span>
    (<span style="font-weight: bold;">when</span> (looking-back (<span style="font-weight: bold;">if</span> company-org-block-bol-p
                            (concat <span style="font-style: italic;">"^"</span> company-org--regexp)
                          company-org--regexp)
                        (line-beginning-position))
      (cons (match-string-no-properties 1) t)))

  (add-to-list 'company-backends 'company-org-block))

(<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"company"</span>
  (define-key company-active-map (kbd <span style="font-style: italic;">"C-n"</span>) 'company-select-next)
  (define-key company-active-map (kbd <span style="font-style: italic;">"C-p"</span>) 'company-select-previous)
  (define-key company-search-map (kbd <span style="font-style: italic;">"C-n"</span>) 'company-select-next)
  (define-key company-search-map (kbd <span style="font-style: italic;">"C-p"</span>) 'company-select-previous)
  (define-key company-active-map (kbd <span style="font-style: italic;">"&lt;tab&gt;"</span>) 'company-complete-selection)
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">To complete file path, move `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">company-files</span><span style="font-weight: bold; font-style: italic;">' to the fist item of the list</span>
  (delq 'company-files company-backends)


  (add-to-list 'company-backends 'company-files)

  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#35036;&#23436;&#20505;&#35036;&#12395;&#30058;&#21495;&#12434;&#34920;&#31034;</span>
  (<span style="font-weight: bold;">setq</span> company-show-numbers t)
  (global-company-mode)
  (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">company-quickhelp</span> nil t)
    (company-quickhelp-mode)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org09687b9c" class="outline-3">
<h3 id="org09687b9c"><span class="section-number-3">9.24</span> <span class="done DONE">DONE</span> [auto-complete.el] 自動補完機能&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></h3>
<div class="outline-text-3" id="text-org09687b9c">
<p>
<a href="http://cx4a.org/software/auto-complete/manual.ja.html">http://cx4a.org/software/auto-complete/manual.ja.html</a>
</p>

<ul class="org-ul">
<li>辞書データを使う（ <code>ac-dictionary-directories</code> ）</li>
<li>auto-complete.el, auto-complete-config.el, fuzzy.el, popup.el を使う．</li>
<li><a href="http://cx4a.org/software/auto-complete/manual.ja.html">日本語マニュアル</a></li>
<li>ac-auto-start を 4 にしておけば，3文字までは TAB を yasnippet に渡せる．</li>
</ul>

<p>
Org-mode ユーザにとって <code>TAB</code> は非常に重要なコマンド．そこに <code>auto-complete</code> と <code>yasnippet</code> が <code>TAB</code> を奪いに来るので，住み分けが重要になる．=ac-auto-start= を=4=にすると，&lt;s=TAB= によるソースブロックの短縮入力を <code>yasnippet</code> で実行できる（この目的だけならば=3=を指定してもいい）．&lt;sys などと4文字入力すると，=auto-complete= が動いて &lt;system&gt; などを補完してくれる．もちろん，見出しで <code>TAB</code> を押すときには，ツリーの表示／非表示の切り替えになる．
</p>

<p>
情報源については，<a href="http://cx4a.org/software/auto-complete/manual.ja.html#.E6.A8.99.E6.BA.96.E6.83.85.E5.A0.B1.E6.BA.90">オンラインマニュアル</a>を参照のこと．
</p>

<p>
auto-complete が正しく効いているかは，バッファ内で適当にパスを打ち込んで，補完候補が表示されるかで判定判定できると思います（ <code>/home</code> を入力とか）
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(ac-default-setup ac-org-mode-setup)
       <span style="font-style: italic;">"auto-complete"</span> nil t)

  (<span style="font-weight: bold;">dolist</span> (hook
           (list 'org-mode-hook 'python-mode-hook
                 'perl-mode-hook 'objc-mode-hook))
    (add-hook hook #'ac-default-setup))

  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">*scratch* &#12496;&#12483;&#12501;&#12449;&#12391;&#12399;&#28961;&#21177;&#21270;</span>
  (add-hook 'lisp-mode-hook
            (<span style="font-weight: bold;">lambda</span> () (<span style="font-weight: bold;">unless</span> (equal <span style="font-style: italic;">"*scratch*"</span> (buffer-name))
                         (ac-default-setup))))
  (add-hook 'org-mode-hook #'ac-org-mode-setup)

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"auto-complete"</span>
    (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">auto-complete-config</span> nil t)
    (ac-config-default)
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#36861;&#21152;&#12398;&#12513;&#12472;&#12515;&#12540;&#12514;&#12540;&#12489;&#12434;&#35373;&#23450;</span>
    (add-to-list 'ac-modes 'objc-mode)
    (add-to-list 'ac-modes 'org-mode)
    (add-to-list 'ac-modes 'latex-mode)
    (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">ac-math</span> nil t)

    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">ac-modes &#12395;&#12354;&#12427;&#12513;&#12472;&#12515;&#12540;&#12514;&#12540;&#12489;&#12391;&#26377;&#21177;&#12395;&#12377;&#12427;</span>
    <span style="font-weight: bold; font-style: italic;">;;</span><span style="font-weight: bold; font-style: italic;">lisp, c, c++, java, perl, cperl, python, makefile, sh, fortran, f90</span>
    (global-auto-complete-mode t)
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#36766;&#26360;</span>
    (add-to-list 'ac-dictionary-directories <span style="font-style: italic;">"~/.emacs.d/ac-dict"</span>)
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">history</span>
    (<span style="font-weight: bold;">setq</span> ac-comphist-file <span style="font-style: italic;">"~/Dropbox/config/ac-comphist.dat"</span>)
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">n&#25991;&#23383;&#20197;&#19978;&#12391;&#35036;&#23436;&#34920;&#31034;&#12377;&#12427;&#65288;"&lt;s TAB" &#12398;&#22580;&#21512; yasnippet &#12364;&#21628;&#12400;&#12428;&#12427;&#65289;</span>
    (<span style="font-weight: bold;">setq</span> ac-auto-start 4)
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">n&#31186;&#24460;&#12395;&#12513;&#12491;&#12517;&#12540;&#12434;&#34920;&#31034;</span>
    (<span style="font-weight: bold;">setq</span> ac-auto-show-menu 2.0)
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#12484;&#12540;&#12523;&#12481;&#12483;&#12503;&#12398;&#34920;&#31034;</span>
    (<span style="font-weight: bold;">setq</span> ac-use-quick-help t)
    (<span style="font-weight: bold;">setq</span> ac-quick-help-delay 2.0)
    (<span style="font-weight: bold;">setq</span> ac-quick-help-height 10)
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">C-n/C-p &#12391;&#12513;&#12491;&#12517;&#12540;&#12434;&#12383;&#12393;&#12427;</span>
    (<span style="font-weight: bold;">setq</span> ac-use-menu-map t)
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">TAB &#12391;&#35036;&#23436;&#65288;org-mode &#12391;&#12418;&#21177;&#12367;&#12424;&#12358;&#12395;&#12377;&#12427;&#65289;</span>
    (define-key ac-completing-map [tab] 'ac-complete)
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">RET &#12391;&#12398;&#35036;&#23436;&#12434;&#31105;&#27490;</span>
    (define-key ac-completing-map <span style="font-style: italic;">"\r"</span> nil)
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#35036;&#23436;&#12513;&#12491;&#12517;&#12540;&#12398;&#34920;&#31034;&#31934;&#24230;&#12434;&#39640;&#12417;&#12427;</span>
    (<span style="font-weight: bold;">setq</span> popup-use-optimized-column-computation nil)
    <span style="font-weight: bold; font-style: italic;">;;</span><span style="font-weight: bold; font-style: italic;">(setq ac-candidate-max 10)</span>

    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">ac-org-mode-setup</span> ()
      <span style="font-weight: bold; font-style: italic;">;;            </span><span style="font-weight: bold; font-style: italic;">(message " &gt;&gt; ac-org-mode-setup")</span>
      (<span style="font-weight: bold;">setq</span> ac-sources '(
                         ac-source-abbrev <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">Emacs &#12398;&#30053;&#35486;</span>
                         <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">ac-source-css-property ; heavy</span>
                         ac-source-dictionary <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">&#36766;&#26360;</span>
                         ac-source-features
                         ac-source-filename
                         ac-source-files-in-current-dir
                         ac-source-functions
                         <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">ac-source-gtags</span>
                         <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">ac-source-imenu</span>
                         <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">ac-source-semantic</span>
                         ac-source-symbols
                         ac-source-variables
                         <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">ac-source-yasnippet</span>
                         )))

    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">ac-default-setup</span> ()
      <span style="font-weight: bold; font-style: italic;">;;            </span><span style="font-weight: bold; font-style: italic;">(message " &gt;&gt; ac-default-setup")</span>
      <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">ac-source-words-in-same-mode-buffers</span>
      (<span style="font-weight: bold;">setq</span> ac-sources '(ac-source-filename
                         ac-source-abbrev
                         ac-source-dictionary
                         )))))
</pre>
</div>
</div>
</div>
<div id="outline-container-orgcde881ad" class="outline-3">
<h3 id="orgcde881ad"><span class="section-number-3">9.25</span> <span class="done DONE">DONE</span> [hideshowvis.el] 関数の表示／非表示&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></h3>
<div class="outline-text-3" id="text-orgcde881ad">
<ul class="org-ul">
<li><a href="http://www.emacswiki.org/emacs/hideshowvis.el">http://www.emacswiki.org/emacs/hideshowvis.el</a></li>
<li>org.el（約2万行）を開くために約2分必要なため，最近は使っていません．</li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">and</span> (memq window-system '(mac ns))
           (&gt; emacs-major-version 23))
  (<span style="font-weight: bold;">when</span> (autoload-if-found
         '(hideshowvis-enable hideshowvis-minor-mode)
         <span style="font-style: italic;">"hideshowvis"</span> nil t)

    (<span style="font-weight: bold;">dolist</span> (hook (list 'perl-mode-hook 'c-mode-common-hook))
      (add-hook hook #'hideshowvis-enable))

    (add-hook 'emacs-lisp-mode-hook
              (<span style="font-weight: bold;">lambda</span> () (<span style="font-weight: bold;">unless</span> (equal <span style="font-style: italic;">"*scratch*"</span> (buffer-name))
                             (hideshowvis-enable))))

    (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"hideshowvis"</span>
      (define-key hideshowvis-mode-map (kbd <span style="font-style: italic;">"C-("</span>) 'hs-hide-block)
      (define-key hideshowvis-mode-map (kbd <span style="font-style: italic;">"C-)"</span>) 'hs-show-block))))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org47616d05" class="outline-2">
<h2 id="org47616d05"><span class="section-number-2">10</span> Org Mode</h2>
<div class="outline-text-2" id="text-org47616d05">
</div>
<div id="outline-container-orgf66bb6fe" class="outline-3">
<h3 id="orgf66bb6fe"><span class="section-number-3">10.1</span> 基本設定</h3>
<div class="outline-text-3" id="text-orgf66bb6fe">
<p>
Org Mode は巨大なパッケージなので，設定項目が必然的に増えます．一度に全部を設定しようとせず，必須機能と見た目の設定から入り，興味があり使いたい機能の設定へと徐々に拡張するのが近道です．
</p>

<p>
<code>C-M-o</code> は，本来， <code>split-line</code> にアサインされています．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(org-mode)
       <span style="font-style: italic;">"org"</span> nil t)

  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#12486;&#12461;&#12473;&#12488;&#12501;&#12449;&#12452;&#12523;&#12434; Org Mode &#12391;&#38283;&#12365;&#12414;&#12377;&#65294;</span>
  (<span style="font-weight: bold;">push</span> '(<span style="font-style: italic;">"\\.txt$"</span> . org-mode) auto-mode-alist)

  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Font lock &#12434;&#20351;&#12358;</span>
  (add-hook 'org-mode-hook #'turn-on-font-lock)

  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#12507;&#12540;&#12512;&#12509;&#12472;&#12471;&#12519;&#12531;&#30340;&#12394; Org&#12501;&#12449;&#12452;&#12523;&#12434;&#19968;&#30330;&#12391;&#38283;&#12365;&#12414;&#12377;&#65294;</span>
  (global-set-key (kbd <span style="font-style: italic;">"C-M-o"</span>)
                  (<span style="font-weight: bold;">lambda</span> () (<span style="font-weight: bold;">interactive</span>)
                    (my-show-org-buffer <span style="font-style: italic;">"next.org"</span>)))

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"postpone"</span>
    (global-set-key (kbd <span style="font-style: italic;">"C-c r"</span>) 'org-capture)
    (global-set-key (kbd <span style="font-style: italic;">"C-c l"</span>) 'org-store-link)
    (global-set-key (kbd <span style="font-style: italic;">"C-c a"</span>) 'org-agenda))

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"org"</span>
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#38306;&#36899;&#12514;&#12472;&#12517;&#12540;&#12523;&#12398;&#35501;&#12415;&#36796;&#12415;</span>
    (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">org-mobile</span> nil t)
    (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">org-eldoc</span> nil t)
      (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-org-eldoc-load</span> ()
        <span style="font-style: italic;">"Set up org-eldoc documentation function."</span>
        (<span style="font-weight: bold;">interactive</span>)
        (<span style="font-weight: bold;">add-function</span> <span style="font-weight: bold;">:before-until</span> (local 'eldoc-documentation-function)
                      #'org-eldoc-documentation-function))
      (advice-add 'org-eldoc-load <span style="font-weight: bold;">:override</span> #'my-org-eldoc-load))

    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#12514;&#12472;&#12517;&#12540;&#12523;&#12398;&#36861;&#21152;</span>
    (add-to-list 'org-modules 'org-habit)
    (add-to-list 'org-modules 'org-id)
    (<span style="font-weight: bold;">when</span> (version&lt; <span style="font-style: italic;">"9.1.4"</span> (org-version))
      (add-to-list 'org-modules 'org-tempo))
    (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">ol-bookmark</span> nil t)
      <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">[[bookmark:hoge][hogehoge]] &#24418;&#24335;&#12398;&#12522;&#12531;&#12463;&#12434;&#26377;&#21177;&#21270;</span>
      (add-to-list 'org-modules 'ol-bookmark)
      (<span style="font-weight: bold;">setq</span> bookmark-save-flag 4) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">N&#22238; bookmark &#12434;&#25805;&#20316;&#12375;&#12383;&#12425;&#20445;&#23384;</span>
      <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">`</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">bookmark-default-file</span><span style="font-weight: bold; font-style: italic;">' &#12398;&#35501;&#12415;&#36796;&#12415;</span>
      (bookmark-maybe-load-default-file))

    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#19981;&#24517;&#35201;&#12394;&#12514;&#12472;&#12517;&#12540;&#12523;&#12398;&#35501;&#12415;&#36796;&#12415;&#12434;&#20572;&#27490;&#12377;&#12427;</span>
    (delq 'ol-gnus org-modules)
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(setq org-modules (delete 'org-bibtex org-modules))</span>

    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">org &#12501;&#12449;&#12452;&#12523;&#12398;&#38598;&#20013;&#31649;&#29702;</span>
    (<span style="font-weight: bold;">setq</span> org-directory (concat (getenv <span style="font-style: italic;">"SYNCROOT"</span>) <span style="font-style: italic;">"/org/"</span>))

    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#12450;&#12540;&#12459;&#12452;&#12502;&#12501;&#12449;&#12452;&#12523;&#12398;&#21517;&#31216;&#12434;&#25351;&#23450;</span>
    (<span style="font-weight: bold;">setq</span> org-archive-location <span style="font-style: italic;">"%s_archive::"</span>)

    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#12479;&#12452;&#12512;&#12473;&#12479;&#12531;&#12503;&#12395;&#12424;&#12427;&#12525;&#12464;&#21454;&#38598;&#35373;&#23450; DONE &#26178;&#12395; CLOSED: &#12434;&#35352;&#20837;&#65294;</span>
    (<span style="font-weight: bold;">setq</span> org-log-done 'time) <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">'time &#20197;&#22806;&#12395;&#65292;'(done), '(state) &#12434;&#25351;&#23450;&#12391;&#12365;&#12427;</span>

    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#12525;&#12464;&#12434;&#12489;&#12525;&#12450;&#12540;&#12395;&#20837;&#12428;&#12427;</span>
    (<span style="font-weight: bold;">setq</span> org-log-into-drawer t)

    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Set checksum program path for windows</span>
    (<span style="font-weight: bold;">when</span> (eq window-system 'w32)
      (<span style="font-weight: bold;">setq</span> org-mobile-checksum-binary (concat (getenv <span style="font-style: italic;">"SYNCROOT"</span>) <span style="font-style: italic;">"/do/cksum.exe"</span>)))

    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Set default table export format</span>
    (<span style="font-weight: bold;">setq</span> org-table-export-default-format <span style="font-style: italic;">"orgtbl-to-csv"</span>)

    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Toggle inline images display at startup</span>
    (<span style="font-weight: bold;">setq</span> org-startup-with-inline-images t)

    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">dvipng</span>
    (<span style="font-weight: bold;">setq</span> org-export-with-LaTeX-fragments t)

    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#25968;&#24335;&#12434;&#12495;&#12452;&#12521;&#12452;&#12488;</span>
    (<span style="font-weight: bold;">setq</span> org-highlight-latex-and-related '(latex entities))

    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">org&#12496;&#12483;&#12501;&#12449;&#20869;&#12398;&#20840;&#12390;&#12398;&#21205;&#30340;&#12502;&#12525;&#12483;&#12463;&#12434;&#20445;&#23384;&#30452;&#21069;&#12395;&#22793;&#26356;&#12377;&#12427;</span>
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(add-hook 'before-save-hook #'org-update-all-dblocks)</span>

    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#12450;&#12531;&#12480;&#12540;&#12473;&#12467;&#12450;&#12434;&#12456;&#12463;&#12473;&#12509;&#12540;&#12488;&#12375;&#12394;&#12356;&#65288;_{}&#12391;&#26126;&#31034;&#30340;&#12395;&#34920;&#29694;&#12391;&#12365;&#12427;&#65289;</span>
    (<span style="font-weight: bold;">setq</span> org-export-with-sub-superscripts nil)

    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">#+options: \n:t &#12392;&#21516;&#12376;</span>
    (<span style="font-weight: bold;">setq</span> org-export-preserve-breaks t)

    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#12479;&#12452;&#12510;&#12540;&#12398;&#38899;</span>
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(lsetq org-clock-sound "");</span>

    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">org-clock &#12398;&#35336;&#28204;&#26178;&#38291;&#12434;&#12514;&#12540;&#12489;&#12521;&#12452;&#12531;&#12391;&#12399;&#12394;&#12367;&#12479;&#12452;&#12488;&#12523;&#12395;&#34920;&#31034;&#12377;&#12427;</span>
    (<span style="font-weight: bold;">setq</span> org-clock-clocked-in-display 'frame-title)

    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">1&#20998;&#26410;&#28288;&#12399;&#35352;&#37682;&#12375;&#12394;&#12356;</span>
    (<span style="font-weight: bold;">setq</span> org-clock-out-remove-zero-time-clocks t)

    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#20877;&#36215;&#21205;&#24460;&#12395; clock &#12434;&#24489;&#24112;&#12373;&#12379;&#12427;&#65288;clock-out &#12391;&#25244;&#12369;&#12394;&#12356;&#38480;&#12426;&#32066;&#20102;&#20013;&#12398;&#26399;&#38291;&#12418;&#35336;&#19978;&#12373;&#12428;&#12390;&#12375;&#12414;&#12358;&#65289;</span>
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">check also org-clock-persist in org-clock.el</span>
    (org-clock-persistence-insinuate)

    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">org-clock-out &#26178;&#12395;&#12473;&#12486;&#12540;&#12479;&#12473;&#12434;&#22793;&#12360;&#12427;&#65288;also configure org-todo-keywords&#65289;</span>
    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-promote-todo-revision</span> (state)
      (<span style="font-weight: bold;">cond</span> ((member state '(<span style="font-style: italic;">"TODO"</span>)) <span style="font-style: italic;">"REV1"</span>)
            ((member state '(<span style="font-style: italic;">"REV1"</span>)) <span style="font-style: italic;">"REV2"</span>)
            ((member state '(<span style="font-style: italic;">"REV2"</span>)) <span style="font-style: italic;">"REV3"</span>)
            (t state)))
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(setq org-clock-out-switch-to-state #'my-promote-todo-revision)</span>

    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">undo &#26178;&#12395; reveal &#12375;&#12390;&#34920;&#31034;&#12434;&#25913;&#21892;&#12377;&#12427;</span>
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(defun ad:org:undo (&amp;optional _ARG)</span>
    <span style="font-weight: bold; font-style: italic;">;;   </span><span style="font-weight: bold; font-style: italic;">(when (and (eq major-mode 'org-mode)</span>
    <span style="font-weight: bold; font-style: italic;">;;              </span><span style="font-weight: bold; font-style: italic;">(not (org-before-first-heading-p)))</span>
    <span style="font-weight: bold; font-style: italic;">;;     </span><span style="font-weight: bold; font-style: italic;">(org-overview)</span>
    <span style="font-weight: bold; font-style: italic;">;;     </span><span style="font-weight: bold; font-style: italic;">(org-reveal)</span>
    <span style="font-weight: bold; font-style: italic;">;;     </span><span style="font-weight: bold; font-style: italic;">(org-cycle-hide-drawers 'all)</span>
    <span style="font-weight: bold; font-style: italic;">;;     </span><span style="font-weight: bold; font-style: italic;">(org-show-entry)</span>
    <span style="font-weight: bold; font-style: italic;">;;     </span><span style="font-weight: bold; font-style: italic;">(show-children)</span>
    <span style="font-weight: bold; font-style: italic;">;;     </span><span style="font-weight: bold; font-style: italic;">(org-show-siblings)))</span>
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(advice-add 'undo :after #'ad:org:undo)</span>

    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#38750;&#34920;&#31034;&#29366;&#24907;&#12398;&#38936;&#22495;&#12408;&#12398;&#26360;&#12365;&#36796;&#12415;&#12434;&#38450;&#12368;</span>
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">"Editing in invisible areas is prohibited, make them visible first"</span>
    (<span style="font-weight: bold;">setq</span> org-catch-invisible-edits 'show-and-error)
    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">ad:org-return</span> (f <span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> arg)
      <span style="font-style: italic;">"An extension for checking invisible editing when you hit the enter."</span>
      (<span style="font-weight: bold;">interactive</span> <span style="font-style: italic;">"P"</span>)
      (org-check-before-invisible-edit 'insert)
      (apply f arg))
    (advice-add 'org-return <span style="font-weight: bold;">:around</span> #'ad:org-return)

    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">- &#12434;&#20778;&#20808;&#65294;&#35242;&#12398;&#12502;&#12522;&#12483;&#12484;&#34920;&#31034;&#12434;&#32153;&#25215;&#12373;&#12379;&#12394;&#12356;</span>
    (<span style="font-weight: bold;">setq</span> org-list-demote-modify-bullet
          '((<span style="font-style: italic;">"+"</span> . <span style="font-style: italic;">"-"</span>)
            (<span style="font-style: italic;">"*"</span> . <span style="font-style: italic;">"-"</span>)
            (<span style="font-style: italic;">"1."</span> . <span style="font-style: italic;">"-"</span>)
            (<span style="font-style: italic;">"1)"</span> . <span style="font-style: italic;">"-"</span>)
            (<span style="font-style: italic;">"A)"</span> . <span style="font-style: italic;">"-"</span>)
            (<span style="font-style: italic;">"B)"</span> . <span style="font-style: italic;">"-"</span>)
            (<span style="font-style: italic;">"a)"</span> . <span style="font-style: italic;">"-"</span>)
            (<span style="font-style: italic;">"b)"</span> . <span style="font-style: italic;">"-"</span>)
            (<span style="font-style: italic;">"A."</span> . <span style="font-style: italic;">"-"</span>)
            (<span style="font-style: italic;">"B."</span> . <span style="font-style: italic;">"-"</span>)
            (<span style="font-style: italic;">"a."</span> . <span style="font-style: italic;">"-"</span>)
            (<span style="font-style: italic;">"b."</span> . <span style="font-style: italic;">"-"</span>)))

    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#23436;&#20102;&#12375;&#12383;&#12479;&#12473;&#12463;&#12398;&#37197;&#33394;&#12434;&#22793;&#12360;&#12427;</span>
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">https://fuco1.github.io/2017-05-25-Fontify-done-checkbox-items-in-org-mode.html</span>
    (font-lock-add-keywords
     'org-mode
     `((<span style="font-style: italic;">"^[ \t]*</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(?:</span><span style="font-style: italic;">[-+*]</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">|</span><span style="font-style: italic;">[0-9]+[).]</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">[ \t]+</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(?:</span><span style="font-style: italic;">\\[@</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(?:</span><span style="font-style: italic;">start:</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">?[0-9]+\\][ \t]*</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">?\\[</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(?:</span><span style="font-style: italic;">X</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">|</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">[0-9]+</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">/\\2</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">\\][</span><span style="font-style: italic;">^</span><span style="font-style: italic;">\n]*\n</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">"</span>
        1 'org-headline-done prepend))
     'append)

    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#12503;&#12525;&#12497;&#12486;&#12451;&#31561;&#12434;&#33258;&#21205;&#30340;&#38281;&#12376;&#12427;&#65294;</span>
    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-org-hide-drawers</span> ()
      <span style="font-style: italic;">"Hide all drawers in an org tree."</span>
      (<span style="font-weight: bold;">save-excursion</span>
        (beginning-of-line)
        (<span style="font-weight: bold;">unless</span> (looking-at-p org-drawer-regexp)
          (org-cycle-hide-drawers 'children))))
    (add-hook 'org-tab-first-hook 'my-org-hide-drawers)

    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">CSV&#25351;&#23450;&#12391;&#12486;&#12540;&#12502;&#12523;&#12434;&#20986;&#21147;&#12377;&#12427;&#65294;</span>
    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-org-table-export</span> ()
      (<span style="font-weight: bold;">interactive</span>)
      (org-table-export nil <span style="font-style: italic;">"orgtbl-to-csv"</span>))

    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-do-org-update-staistics-cookies</span> ()
      (<span style="font-weight: bold;">interactive</span>)
      (message <span style="font-style: italic;">"Update statistics..."</span>)
      (do-org-update-statistics-cookies)
      (message <span style="font-style: italic;">"Update statistics...done"</span>))
    (define-key org-mode-map (kbd <span style="font-style: italic;">"C-c f 2"</span>)
      'my-do-org-update-staistics-cookies)

    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">C-c &amp; &#12364; yasnippet &#12395;&#12458;&#12540;&#12496;&#12540;&#12521;&#12452;&#12489;&#12373;&#12428;&#12390;&#12356;&#12427;&#12398;&#12434;&#24373;&#12426;&#26367;&#12360;&#12427;</span>
    (define-key org-mode-map (kbd <span style="font-style: italic;">"C-c 4"</span>) 'org-mark-ring-goto)

    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(org-transpose-element) &#12364;&#21106;&#12426;&#24403;&#12390;&#12425;&#12428;&#12390;&#12356;&#12427;&#12398;&#12391;&#21462;&#12426;&#36820;&#12377;&#65294;</span>
    (org-defkey org-mode-map <span style="font-style: italic;">"\C-\M-t"</span> 'beginning-of-buffer))

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"ox"</span>
    (add-to-list 'org-modules 'ox-odt)
    (add-to-list 'org-modules 'ox-org)
    (add-to-list 'org-modules 'ox-json))

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"org-tempo"</span>
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#31354;&#34892;&#12398;&#12392;&#12365; "&lt;" &#12434;&#12452;&#12531;&#12487;&#12531;&#12488;&#12373;&#12379;&#12394;&#12356;</span>
    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">ad:org-tempo-complete-tag</span> (f <span style="font-weight: bold; text-decoration: underline;">&amp;rest</span> arg)
      (<span style="font-weight: bold;">if</span> (<span style="font-weight: bold;">save-excursion</span>
            (beginning-of-line)
            (looking-at <span style="font-style: italic;">"&lt;"</span>))
          (<span style="font-weight: bold;">let</span> ((indent-line-function 'ignore))
            (apply f arg))
        (apply f arg)))
    (advice-add 'org-tempo-complete-tag <span style="font-weight: bold;">:around</span> #'ad:org-tempo-complete-tag))
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(Thanks to @conao3)</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">but when using `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">flet</span><span style="font-weight: bold; font-style: italic;">', byte-compile will warn a malformed function</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">and using `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">cl-flet</span><span style="font-weight: bold; font-style: italic;">' will not provide us the expected result...</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(when (require 'cl-lib nil t)</span>
  <span style="font-weight: bold; font-style: italic;">;;   </span><span style="font-weight: bold; font-style: italic;">(defun ad:org-tempo-complete-tag (f &amp;rest arg)</span>
  <span style="font-weight: bold; font-style: italic;">;;     </span><span style="font-weight: bold; font-style: italic;">(if (save-excursion</span>
  <span style="font-weight: bold; font-style: italic;">;;           </span><span style="font-weight: bold; font-style: italic;">(beginning-of-line)</span>
  <span style="font-weight: bold; font-style: italic;">;;           </span><span style="font-weight: bold; font-style: italic;">(looking-at "&lt;"))</span>
  <span style="font-weight: bold; font-style: italic;">;;         </span><span style="font-weight: bold; font-style: italic;">(cl-flet ((indent-according-to-mode () #'ignore))</span>
  <span style="font-weight: bold; font-style: italic;">;;           </span><span style="font-weight: bold; font-style: italic;">(apply f arg))</span>
  <span style="font-weight: bold; font-style: italic;">;;       </span><span style="font-weight: bold; font-style: italic;">(apply f arg)))</span>
  <span style="font-weight: bold; font-style: italic;">;;   </span><span style="font-weight: bold; font-style: italic;">(advice-add 'org-tempo-complete-tag :around #'ad:org-tempo-complete-tag))</span>

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"org-tempo"</span>
    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-org-tempo-add-block</span> (entry)
      <span style="font-style: italic;">"Add block entry from `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">org-structure-template-alist</span><span style="font-style: italic;">'."</span>
      (<span style="font-weight: bold;">let*</span> ((key (format <span style="font-style: italic;">"&lt;%s"</span> (car entry)))
             (name (cdr entry))
             (special nil)) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">FIXED</span>
        (tempo-define-template
         (format <span style="font-style: italic;">"org-%s"</span> (replace-regexp-in-string <span style="font-style: italic;">" "</span> <span style="font-style: italic;">"-"</span> name))
         `(,(format <span style="font-style: italic;">"#+begin_%s%s"</span> name (<span style="font-weight: bold;">if</span> special <span style="font-style: italic;">" "</span> <span style="font-style: italic;">""</span>))
           ,(<span style="font-weight: bold;">when</span> special 'p) '&gt; n '&gt; ,(<span style="font-weight: bold;">unless</span> special 'p) n
           ,(format <span style="font-style: italic;">"#+end_%s"</span> (car (split-string name <span style="font-style: italic;">" "</span>)))
           &gt;)
         key
         (format <span style="font-style: italic;">"Insert a %s block"</span> name)
         'org-tempo-tags)))
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#26356;&#26032;</span>
    (advice-add 'org-tempo-add-block <span style="font-weight: bold;">:override</span> #'my-org-tempo-add-block)
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#21453;&#26144;</span>
    (org-tempo-add-templates))

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"org-clock"</span>
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">nil or 'history &#12394;&#12425;&#12400;&#65292;org-onit &#12364; org-clock-out &#12434;&#23455;&#34892;&#12377;&#12427;&#65294;</span>
    (<span style="font-weight: bold;">setq</span> org-clock-persist 'history) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">{nil, t, 'clock, 'history}</span>
    (<span style="font-weight: bold;">setq</span> org-clock-in-resume t)
    (<span style="font-weight: bold;">setq</span> org-clock-persist-query-resume nil)

    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#32066;&#20102;&#26178;&#12395; clock &#12434;&#27490;&#12417;&#12427;&#65294;</span>
    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-org-clock-out-and-save-when-exit</span> ()
      <span style="font-style: italic;">"Save buffers and stop clocking when kill emacs."</span>
      (<span style="font-weight: bold;">when</span> (org-clocking-p)
        (org-clock-out)
        (save-some-buffers t)))
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">implemented in `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">org-onit.el</span><span style="font-weight: bold; font-style: italic;">'. No need to hook this.</span>
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(add-hook 'kill-emacs-hook #'my-org-clock-out-and-save-when-exit)</span>
    )

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"org-table"</span>
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#12456;&#12467;&#12540;&#34920;&#31034;&#21069;&#12395;&#20445;&#23384;&#12377;&#12427;</span>
    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">ad:org-table-field-info</span> (_arg)
      (save-buffer))
    (advice-add 'org-table-field-info <span style="font-weight: bold;">:before</span> #'ad:org-table-field-info)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgebb1fbe4" class="outline-3">
<h3 id="orgebb1fbe4"><span class="section-number-3">10.2</span> contribution を使う</h3>
<div class="outline-text-3" id="text-orgebb1fbe4">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setq</span> load-path (append '(<span style="font-style: italic;">"~/devel/git/org-mode/contrib/lisp"</span>) load-path))
</pre>
</div>
</div>
</div>

<div id="outline-container-org4da0cefd" class="outline-3">
<h3 id="org4da0cefd"><span class="section-number-3">10.3</span> iCal との連携</h3>
<div class="outline-text-3" id="text-org4da0cefd">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">~/Dropbox/Public &#12399;&#31532;&#19977;&#32773;&#12395;&#25506;&#32034;&#12373;&#12428;&#12427;&#21487;&#33021;&#24615;&#12364;&#12354;&#12427;&#12398;&#12391;&#35201;&#27880;&#24847;</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">default = ~/org.ics</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">C-c C-e i org-export-icalendar-this-file</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">C-c C-e I org-export-icalendar-all-agenda-files</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">C-c C-e c org-export-icalendar-all-combine-agenda-files</span>
(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(my-ox-icalendar my-async-ox-icalendar my-ox-icalendar-cleanup)
       <span style="font-style: italic;">"ox-icalendar"</span> nil t)

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"org"</span>
    (define-key org-mode-map (kbd <span style="font-style: italic;">"C-c f 1"</span>) 'my-ox-upload-icalendar))

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"ox-icalendar"</span>
    (<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">org-ical-file-in-orz-server</span> nil) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">see private.el</span>

    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#29983;&#25104;&#12377;&#12427;&#12459;&#12524;&#12531;&#12480;&#12540;&#12501;&#12449;&#12452;&#12523;&#12434;&#25351;&#23450;</span>
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#20197;&#19979;&#12398;&#35373;&#23450;&#12391;&#12399;&#65292;&#12371;&#12398;&#12501;&#12449;&#12452;&#12523;&#12434;&#19968;&#26178;&#12501;&#12449;&#12452;&#12523;&#12392;&#12375;&#12390;&#20351;&#12358;&#65288;&#21066;&#38500;&#12377;&#12427;&#65289;</span>
    (<span style="font-weight: bold;">setq</span> org-icalendar-combined-agenda-file <span style="font-style: italic;">"~/Desktop/org-ical.ics"</span>)

    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">iCal &#12398;&#35500;&#26126;&#25991;</span>
    (<span style="font-weight: bold;">setq</span> org-icalendar-combined-description <span style="font-style: italic;">"OrgMode&#12398;&#12473;&#12465;&#12472;&#12517;&#12540;&#12523;&#20986;&#21147;"</span>)

    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#12459;&#12524;&#12531;&#12480;&#12540;&#12395;&#36969;&#20999;&#12394;&#12479;&#12452;&#12512;&#12478;&#12540;&#12531;&#12434;&#35373;&#23450;&#12377;&#12427;&#65288;google &#29992;&#12395;&#12399; nil &#12364;&#24517;&#35201;&#65289;</span>
    (<span style="font-weight: bold;">setq</span> org-icalendar-timezone <span style="font-style: italic;">"Asia/Tokyo"</span>)

    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">DONE &#12395;&#12394;&#12387;&#12383; TODO &#12399;&#12450;&#12472;&#12455;&#12531;&#12480;&#12363;&#12425;&#38500;&#22806;&#12377;&#12427;</span>
    (<span style="font-weight: bold;">setq</span> org-icalendar-include-todo t)

    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#36890;&#24120;&#12399;&#65292;&lt;&gt;--&lt;&gt; &#12391;&#21306;&#38291;&#20184;&#12365;&#20104;&#23450;&#12434;&#12388;&#12367;&#12427;&#65294;&#38750;&#25913;&#34892;&#20837;&#21147;&#12391;&#26085;&#20184;&#12364;Note&#12395;&#20837;&#12425;&#12394;&#12356;</span>
    (<span style="font-weight: bold;">setq</span> org-icalendar-use-scheduled '(event-if-todo))

    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">DL &#20184;&#12365;&#12391;&#32066;&#26085;&#20104;&#23450;&#12395;&#12377;&#12427;&#65306;&#32224;&#12417;&#20999;&#12426;&#26085;&#65288;&#12473;&#12479;&#12531;&#12503;&#12391;&#26178;&#38291;&#12434;&#25351;&#23450;&#12375;&#12394;&#12356;&#12371;&#12392;&#65289;</span>
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(setq org-icalendar-use-deadline '(event-if-todo event-if-not-todo))</span>
    (<span style="font-weight: bold;">setq</span> org-icalendar-use-deadline '(event-if-todo))

    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-ox-upload-icalendar</span> ()
      (<span style="font-weight: bold;">interactive</span>)
      (<span style="font-weight: bold;">if</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">async</span> nil t)
          (my-async-ox-icalendar)
        (my-ox-icalendar)))

    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-ox-icalendar</span> ()
      (<span style="font-weight: bold;">let</span> ((message-log-max nil)
            (org-agenda-files '(<span style="font-style: italic;">"~/Dropbox/org/org-ical.org"</span>)))
        <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">org-icalendar-export-to-ics &#12434;&#20351;&#12358;&#12392;&#12463;&#12522;&#12483;&#12503;&#12508;&#12540;&#12489;&#12364;&#33618;&#12428;&#12427;</span>
        (org-icalendar-combine-agenda-files))
      <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#33258;&#12469;&#12540;&#12496;&#12395;&#12450;&#12483;&#12503;&#12525;&#12540;&#12489;</span>
      (message <span style="font-style: italic;">"Uploading..."</span>)
      (<span style="font-weight: bold;">if</span> (eq 0 (shell-command
                 (concat <span style="font-style: italic;">"scp -o ConnectTimeout=5 "</span>
                         org-icalendar-combined-agenda-file <span style="font-style: italic;">" "</span>
                         org-ical-file-in-orz-server)))
          (message <span style="font-style: italic;">"Uploading...done"</span>)
        (message <span style="font-style: italic;">"Uploading...miss!"</span>))
      (my-ox-icalendar-cleanup))

    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-async-ox-icalendar</span> ()
      (message <span style="font-style: italic;">"[async] Uploading..."</span>)
      (async-start
       `(<span style="font-weight: bold;">lambda</span> ()
          (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">and</span> (load <span style="font-style: italic;">"~/.emacs"</span> nil t)
                     (load <span style="font-style: italic;">"~/.emacs.d/lisp/init-org.el"</span> nil t)
                     (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">org</span> nil t))
            (<span style="font-weight: bold;">setq</span> org-agenda-files '(<span style="font-style: italic;">"~/Dropbox/org/org-ical.org"</span>))
            (<span style="font-weight: bold;">if</span> (file-exists-p
                 (expand-file-name org-icalendar-combined-agenda-file))
                1
              (<span style="font-weight: bold;">let</span> ((ical (org-icalendar-combine-agenda-files))
                    (result (shell-command
                             (concat <span style="font-style: italic;">"scp -o ConnectTimeout=5 "</span>
                                     ',org-icalendar-combined-agenda-file <span style="font-style: italic;">" "</span>
                                     ',org-ical-file-in-orz-server))))
                (my-ox-icalendar-cleanup)
                result))))
       (<span style="font-weight: bold;">lambda</span> (result)
         (<span style="font-weight: bold;">unless</span> (active-minibuffer-window)
           (message (format <span style="font-style: italic;">"[async] Uploading...%s"</span>
                            (<span style="font-weight: bold;">cond</span> ((eq result 0) <span style="font-style: italic;">"done"</span>)
                                  ((eq result 1) <span style="font-style: italic;">"skipped"</span>)
                                  (t <span style="font-style: italic;">"miss!"</span>))))))))

    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-ox-icalendar-cleanup</span> ()
      (<span style="font-weight: bold;">interactive</span>)
      (<span style="font-weight: bold;">when</span> (file-exists-p
             (expand-file-name org-icalendar-combined-agenda-file))
        (shell-command-to-string
         (concat <span style="font-style: italic;">"rm -rf "</span> org-icalendar-combined-agenda-file))))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org739cd53d" class="outline-3">
<h3 id="org739cd53d"><span class="section-number-3">10.4</span> スピードコマンド</h3>
<div class="outline-text-3" id="text-org739cd53d">
<p>
慣れてくると Org Mode の通常キーバインドでは満足できなくなります．コンテクストに応じて適切なキーバインドを設定するのが Emacs の醍醐味ですから，そういう欲求が出てきたらスピーコマンドの出番です．シングルキーで各ツリーのステータスを変更したり，任意のコマンドを呼び出せます．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"org"</span>
  (<span style="font-weight: bold;">setq</span> org-use-speed-commands t)

  (add-to-list 'org-speed-commands-user '(<span style="font-style: italic;">"d"</span> org-todo <span style="font-style: italic;">"DONE"</span>))
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(add-to-list 'org-speed-commands-user '("S" call-interactively 'widen))</span>
  (add-to-list 'org-speed-commands-user
               '(<span style="font-style: italic;">"D"</span> my-org-todo-complete-no-repeat <span style="font-style: italic;">"DONE"</span>))
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(add-to-list 'org-speed-commands-user '("N" org-shiftmetadown))</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(add-to-list 'org-speed-commands-user '("P" org-shiftmetaup))</span>
  (add-to-list 'org-speed-commands-user '(<span style="font-style: italic;">"H"</span> my-hugo-export-upload))
  (add-to-list 'org-speed-commands-user '(<span style="font-style: italic;">"."</span> my-org-deadline-today))
  (add-to-list 'org-speed-commands-user '(<span style="font-style: italic;">"!"</span> my-org-set-created-property))
  (add-to-list 'org-speed-commands-user
               '(<span style="font-style: italic;">"$"</span> call-interactively 'org-archive-subtree))

  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#21608;&#26399;&#12479;&#12463;&#12473;&#12434;&#32066;&#20102;&#12373;&#12379;&#12414;&#12377;&#65294;</span>
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-org-todo-complete-no-repeat</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> ARG)
    (<span style="font-weight: bold;">interactive</span> <span style="font-style: italic;">"P"</span>)
    (<span style="font-weight: bold;">when</span> (org-get-repeat)
      (org-cancel-repeater))
    (org-todo ARG))

  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Hugo &#12398;&#35352;&#20107;&#12434;&#26360;&#12365;&#20986;&#12375;&amp;&#12450;&#12483;&#12503;&#12525;&#12540;&#12489;</span>
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-hugo-export-upload</span> ()
    <span style="font-style: italic;">"Export subtree for Hugo and upload the engty."</span>
    (<span style="font-weight: bold;">when</span> (member (buffer-name) '(<span style="font-style: italic;">"imadenale.org"</span> <span style="font-style: italic;">"archive.org"</span>))
      (<span style="font-weight: bold;">if</span> (not (org-entry-is-done-p))
          (message <span style="font-style: italic;">"The state of the entry is not \"DONE\" yet."</span>)
        (org-hugo-export-wim-to-md)
        (<span style="font-weight: bold;">let</span> ((command <span style="font-style: italic;">"/Users/taka/Dropbox/scripts/push-hugo.sh"</span>)
              (filename (org-entry-get (point) <span style="font-style: italic;">"EXPORT_FILE_NAME"</span>))
              (exported (format <span style="font-style: italic;">"[ox-hugo] \"%s\" has been exported."</span>
                                (nth 4 (org-heading-components)))))
          (<span style="font-weight: bold;">when</span> filename
            (<span style="font-weight: bold;">save-excursion</span>
              (<span style="font-weight: bold;">save-restriction</span>
                (outline-up-heading 1)
                (<span style="font-weight: bold;">setq</span> filename
                      (concat (nth 4 (org-heading-components)) <span style="font-style: italic;">"/"</span> filename))
                (<span style="font-weight: bold;">setq</span> command (concat command <span style="font-style: italic;">" -e"</span> (downcase filename)))))
            (<span style="font-weight: bold;">if</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">async</span> nil t)
                (<span style="font-weight: bold;">progn</span>
                  (message <span style="font-style: italic;">"%s\n[async] Uploading..."</span> exported)
                  (async-start
                   `(<span style="font-weight: bold;">lambda</span> () (shell-command-to-string ',command))
                   `(<span style="font-weight: bold;">lambda</span> (result)
                      (message <span style="font-style: italic;">"%s\n[async] Uploading...%s"</span>
                               ',exported (<span style="font-weight: bold;">when</span> result <span style="font-style: italic;">"done"</span>) ))))
              (message <span style="font-style: italic;">"%s\nUploading..."</span> exported)
              (shell-command-to-string command)
              (message <span style="font-style: italic;">"%s\nUploading...done"</span> exported)))))))

  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#32224;&#20999;&#12434;&#20170;&#26085;&#12395;&#12377;&#12427;&#65294;agenda &#12363;&#12425;&#36215;&#21205;&#12375;&#12383;&#12459;&#12524;&#12531;&#12480;&#12540;&#20869;&#12391;&#12399; "C-." &#12391;OK&#65288;&#27161;&#28310;&#65289;</span>
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-org-deadline-today</span> ()
    (<span style="font-weight: bold;">when</span> (org-entry-is-todo-p)
      (<span style="font-weight: bold;">let</span> ((date (org-entry-get (point) <span style="font-style: italic;">"DEADLINE"</span>))
            (today (format-time-string <span style="font-style: italic;">"%F"</span>)))
        (org-deadline 'deadline
                      (<span style="font-weight: bold;">if</span> date
                          (format <span style="font-style: italic;">"&lt;%s%s"</span>
                                  today
                                  (substring date 11 (string-width date)))
                        (format <span style="font-style: italic;">"&lt;%s&gt;"</span> today)))))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org480c9b8b" class="outline-3">
<h3 id="org480c9b8b"><span class="section-number-3">10.5</span> face 関連</h3>
<div class="outline-text-3" id="text-org480c9b8b">
<p>
Orgバッファは日々のタスク管理で閲覧する頻度が高くと期間が長いです．好みの状態にカスタマイズして使いましょう．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"org"</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Font lock &#12434;&#20351;&#12358;</span>
  (global-font-lock-mode 1)

  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#12454;&#12451;&#12531;&#12489;&#12454;&#12398;&#31471;&#12391;&#25240;&#12426;&#36820;&#12377;</span>
  (<span style="font-weight: bold;">setq</span> org-startup-truncated nil)

  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#12469;&#12502;&#12484;&#12522;&#12540;&#20197;&#19979;&#12398; * &#12434;&#30053;&#24335;&#34920;&#31034;&#12377;&#12427;</span>
  (<span style="font-weight: bold;">setq</span> org-hide-leading-stars t)

  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Color setting for TODO keywords</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Color for priorities</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(setq org-priority-faces</span>
  <span style="font-weight: bold; font-style: italic;">;;  </span><span style="font-weight: bold; font-style: italic;">'(("?A" :foreground "#E01B4C" :background "#FFFFFF" :weight bold)</span>
  <span style="font-weight: bold; font-style: italic;">;;    </span><span style="font-weight: bold; font-style: italic;">("?B" :foreground "#1739BF" :background "#FFFFFF" :weight bold)</span>
  <span style="font-weight: bold; font-style: italic;">;;    </span><span style="font-weight: bold; font-style: italic;">("?C" :foreground "#575757" :background "#FFFFFF" :weight bold)))</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Color setting for Tags</span>

  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">#CC3333</span>
  (<span style="font-weight: bold;">setq</span> org-todo-keyword-faces
        '((<span style="font-style: italic;">"FOCUS"</span>    <span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#FF0000"</span> <span style="font-weight: bold;">:background</span> <span style="font-style: italic;">"#FFCC66"</span>)
          (<span style="font-style: italic;">"BUG"</span>      <span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#FF0000"</span> <span style="font-weight: bold;">:background</span> <span style="font-style: italic;">"#FFCC66"</span>)
          (<span style="font-style: italic;">"CHECK"</span>    <span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#FF9900"</span> <span style="font-weight: bold;">:background</span> <span style="font-style: italic;">"#FFF0F0"</span> <span style="font-weight: bold;">:underline</span> t)
          (<span style="font-style: italic;">"ICAL"</span>     <span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#33CC66"</span>)
          (<span style="font-style: italic;">"APPROVED"</span> <span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#66CC66"</span>)
          (<span style="font-style: italic;">"QUESTION"</span> <span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#FF0000"</span>)
          (<span style="font-style: italic;">"WAIT"</span>     <span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#CCCCCC"</span> <span style="font-weight: bold;">:background</span> <span style="font-style: italic;">"#666666"</span>)
          (<span style="font-style: italic;">"MAIL"</span>     <span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#CC3300"</span> <span style="font-weight: bold;">:background</span> <span style="font-style: italic;">"#FFEE99"</span>)
          (<span style="font-style: italic;">"PLAN"</span>     <span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#FF6600"</span>)
          (<span style="font-style: italic;">"PLAN2"</span>    <span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#FFFFFF"</span> <span style="font-weight: bold;">:background</span> <span style="font-style: italic;">"#FF6600"</span>)
          (<span style="font-style: italic;">"REV1"</span>     <span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#3366FF"</span>)
          (<span style="font-style: italic;">"REV2"</span>     <span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#3366FF"</span> <span style="font-weight: bold;">:background</span> <span style="font-style: italic;">"#99CCFF"</span>)
          (<span style="font-style: italic;">"REV3"</span>     <span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#FFFFFF"</span> <span style="font-weight: bold;">:background</span> <span style="font-style: italic;">"#3366FF"</span>)
          (<span style="font-style: italic;">"SLEEP"</span>    <span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#9999CC"</span>)))

  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(:foreground "#0000FF" :bold t)     ; default. do NOT put this bottom</span>
  (<span style="font-weight: bold;">setq</span> org-tag-faces
        '((<span style="font-style: italic;">"Achievement"</span> <span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#66CC66"</span>)
          (<span style="font-style: italic;">"Bug"</span>         <span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#FF0000"</span>)
          (<span style="font-style: italic;">"Report"</span>      <span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#66CC66"</span>)
          (<span style="font-style: italic;">"Background"</span>  <span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#66CC99"</span>)
          (<span style="font-style: italic;">"Chore"</span>       <span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#6699CC"</span>)
          (<span style="font-style: italic;">"project"</span>     <span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#6666CC"</span>)
          (<span style="font-style: italic;">"read"</span>        <span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#6666CC"</span>)
          (<span style="font-style: italic;">"book"</span>        <span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#6666CC"</span>)
          (<span style="font-style: italic;">"Doing"</span>       <span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#FF0000"</span>)
          (<span style="font-style: italic;">"Draft"</span>       <span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#9933CC"</span>) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Draft(r1,r2,r3)-&gt;Review(1,2)</span>
          (<span style="font-style: italic;">"Review"</span>      <span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#6633CC"</span>)
          (<span style="font-style: italic;">"Revisit"</span>     <span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#6633CC"</span>)
          (<span style="font-style: italic;">"Redmine"</span>     <span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#CC6666"</span>)
          (<span style="font-style: italic;">"Ongoing"</span>     <span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#CC6666"</span>) <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">for non scheduled/reminder</span>
          (<span style="font-style: italic;">"Template"</span>    <span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#66CC66"</span>)
          (<span style="font-style: italic;">"Repeat"</span>      <span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#CC9999"</span>) <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">for interval tasks</span>
          (<span style="font-style: italic;">"Mag"</span>         <span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#9966CC"</span>)
          (<span style="font-style: italic;">"buy"</span>         <span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#9966CC"</span>)
          (<span style="font-style: italic;">"pay"</span>         <span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#CC6699"</span>)
          (<span style="font-style: italic;">"try"</span>         <span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#FF3366"</span>)
          (<span style="font-style: italic;">"secret"</span>      <span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#FF0000"</span>)
          (<span style="font-style: italic;">"emacs"</span>       <span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#6633CC"</span>)
          (<span style="font-style: italic;">"note"</span>        <span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#6633CC"</span>)
          (<span style="font-style: italic;">"print"</span>       <span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#6633CC"</span>)
          (<span style="font-style: italic;">"study"</span>       <span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#6666CC"</span>)
          (<span style="font-style: italic;">"Implements"</span>  <span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#CC9999"</span> <span style="font-weight: bold;">:weight</span> bold)
          (<span style="font-style: italic;">"Coding"</span>      <span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#CC9999"</span>)
          (<span style="font-style: italic;">"Editing"</span>     <span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#CC9999"</span> <span style="font-weight: bold;">:weight</span> bold)
          (<span style="font-style: italic;">"work"</span>        <span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#CC9999"</span> <span style="font-weight: bold;">:weight</span> bold)
          (<span style="font-style: italic;">"Survey"</span>      <span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#CC9999"</span> <span style="font-weight: bold;">:weight</span> bold)
          (<span style="font-style: italic;">"Home"</span>        <span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#CC9999"</span> <span style="font-weight: bold;">:weight</span> bold)
          (<span style="font-style: italic;">"Open"</span>        <span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#CC9999"</span> <span style="font-weight: bold;">:weight</span> bold)
          (<span style="font-style: italic;">"Blog"</span>        <span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#9966CC"</span>)
          (<span style="font-style: italic;">"story"</span>       <span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#FF7D7D"</span>)
          (<span style="font-style: italic;">"plan"</span>        <span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#FF7D7D"</span>)
          (<span style="font-style: italic;">"Test"</span>        <span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#FF0000"</span> <span style="font-weight: bold;">:weight</span> bold)
          (<span style="font-style: italic;">"attach"</span>      <span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#FF0000"</span>)
          (<span style="font-style: italic;">"drill"</span>       <span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#66BB66"</span> <span style="font-weight: bold;">:underline</span> t)
          (<span style="font-style: italic;">"DEBUG"</span>       <span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#FFFFFF"</span> <span style="font-weight: bold;">:background</span> <span style="font-style: italic;">"#9966CC"</span>)
          (<span style="font-style: italic;">"EVENT"</span>       <span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#FFFFFF"</span> <span style="font-weight: bold;">:background</span> <span style="font-style: italic;">"#9966CC"</span>)
          (<span style="font-style: italic;">"Thinking"</span>    <span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#FFFFFF"</span> <span style="font-weight: bold;">:background</span> <span style="font-style: italic;">"#96A9FF"</span>)
          (<span style="font-style: italic;">"Schedule"</span>    <span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#FFFFFF"</span> <span style="font-weight: bold;">:background</span> <span style="font-style: italic;">"#FF7D7D"</span>)
          (<span style="font-style: italic;">"INPUT"</span>       <span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#FFFFFF"</span> <span style="font-weight: bold;">:background</span> <span style="font-style: italic;">"#CC6666"</span>)
          (<span style="font-style: italic;">"OUTPUT"</span>      <span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#FFFFFF"</span> <span style="font-weight: bold;">:background</span> <span style="font-style: italic;">"#66CC99"</span>)
          (<span style="font-style: italic;">"CYCLE"</span>       <span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#FFFFFF"</span> <span style="font-weight: bold;">:background</span> <span style="font-style: italic;">"#6699CC"</span>)
          (<span style="font-style: italic;">"weekend"</span>     <span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#FFFFFF"</span> <span style="font-weight: bold;">:background</span> <span style="font-style: italic;">"#CC6666"</span>)
          (<span style="font-style: italic;">"Log"</span>         <span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#008500"</span>))))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdec24da2" class="outline-3">
<h3 id="orgdec24da2"><span class="section-number-3">10.6</span> TODOキーワードのカスタマイズ</h3>
<div class="outline-text-3" id="text-orgdec24da2">
<p>
キーワードには日本語も使えます．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"org"</span>
  (<span style="font-weight: bold;">setq</span> org-todo-keywords
        '((sequence <span style="font-style: italic;">"TODO(t)"</span> <span style="font-style: italic;">"PLAN(p)"</span> <span style="font-style: italic;">"PLAN2(P)"</span> <span style="font-style: italic;">"|"</span> <span style="font-style: italic;">"DONE(d)"</span>)
          (sequence <span style="font-style: italic;">"FOCUS(f)"</span> <span style="font-style: italic;">"CHECK(C)"</span> <span style="font-style: italic;">"ICAL(c)"</span>  <span style="font-style: italic;">"|"</span> <span style="font-style: italic;">"DONE(d)"</span>)
          (sequence <span style="font-style: italic;">"WAIT(w)"</span> <span style="font-style: italic;">"SLEEP(s)"</span> <span style="font-style: italic;">"QUESTION(q)"</span> <span style="font-style: italic;">"|"</span> <span style="font-style: italic;">"DONE(d)"</span>)
          (sequence <span style="font-style: italic;">"REV1(1)"</span> <span style="font-style: italic;">"REV2(2)"</span> <span style="font-style: italic;">"REV3(3)"</span> <span style="font-style: italic;">"|"</span> <span style="font-style: italic;">"APPROVED(a@/!)"</span>)))

  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Global counting of TODO items</span>
  (<span style="font-weight: bold;">setq</span> org-hierarchical-todo-statistics nil)

  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Global counting of checked TODO items</span>
  (<span style="font-weight: bold;">setq</span> org-hierarchical-checkbox-statistics nil)

  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">block-update-time</span>
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">org-dblock-write:block-update-time</span> (params)
    (<span style="font-weight: bold;">let</span> ((fmt (<span style="font-weight: bold;">or</span> (plist-get params <span style="font-weight: bold;">:format</span>) <span style="font-style: italic;">"%Y-%m-%d"</span>)))
      (insert <span style="font-style: italic;">""</span> (format-time-string fmt (current-time)))))

  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#12377;&#12409;&#12390;&#12398;&#12481;&#12455;&#12483;&#12463;&#12508;&#12483;&#12463;&#12473;&#12398; cookies &#12434;&#26356;&#26032;&#12377;&#12427;</span>
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">do-org-update-statistics-cookies</span> ()
    (<span style="font-weight: bold;">interactive</span>)
    (org-update-statistics-cookies 'all)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org55076fa0" class="outline-3">
<h3 id="org55076fa0"><span class="section-number-3">10.7</span> ImageMagick を使って様々な画像をインライン表示する</h3>
<div class="outline-text-3" id="text-org55076fa0">
<p>
システムに <code>OpenJPEG</code> と <code>ImageMagick</code> がインストールされていれば，JPEG 2000 などの画像形式もバッファに表示できます．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"org"</span>
  (<span style="font-weight: bold;">setq</span> org-image-actual-width '(256))
  (add-to-list 'image-file-name-extensions <span style="font-style: italic;">"jp2"</span>)
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(add-to-list 'image-file-name-extensions "j2c")</span>
  (add-to-list 'image-file-name-extensions <span style="font-style: italic;">"bmp"</span>)
  (add-to-list 'image-file-name-extensions <span style="font-style: italic;">"psd"</span>))
</pre>
</div>

<p>
次の例では，同じ画像を2度インライン表示しようと指定ますが，前者は横幅が128ピクセルで表示され，後者は <code>org-image-actual-width</code> で指定した256ピクセルで表示されます．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">#+attr_html: <span style="font-weight: bold;">:width</span> 128
[[~/Desktop/lena_std.jp2]]

[[~/Desktop/lena_std.jp2]]
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(org-toggle-inline-images)
</pre>
</div>
</div>
</div>

<div id="outline-container-org53663ca9" class="outline-3">
<h3 id="org53663ca9"><span class="section-number-3">10.8</span> README を常に org-mode で開く</h3>
<div class="outline-text-3" id="text-org53663ca9">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(org-mode)
       <span style="font-style: italic;">"org"</span> nil t)

  (<span style="font-weight: bold;">push</span> '(<span style="font-style: italic;">"[rR][eE][aA][dD][mM][eE]"</span> . org-mode) auto-mode-alist))
</pre>
</div>
</div>
</div>

<div id="outline-container-org907cb9db" class="outline-3">
<h3 id="org907cb9db"><span class="section-number-3">10.9</span> ソースブロック等の大文字記述を一括で小文字に変える</h3>
<div class="outline-text-3" id="text-org907cb9db">
<p>
<a href="https://scripter.co/org-keywords-lower-case/">https://scripter.co/org-keywords-lower-case/</a> で紹介されている関数を，ログ出力部分だけ加筆して使っています．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"org"</span>
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-lowercase-org-keywords</span> ()
    <span style="font-style: italic;">"Lower case Org keywords and block identifiers."</span>
    (<span style="font-weight: bold;">interactive</span>)
    (<span style="font-weight: bold;">save-excursion</span>
      (goto-char (point-min))
      (<span style="font-weight: bold;">let</span> ((case-fold-search nil)
            (count 0))
        (<span style="font-weight: bold;">while</span> (re-search-forward
                <span style="font-style: italic;">"</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(?1:</span><span style="font-style: italic;">#\\+[A-Z_]+</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(?:</span><span style="font-style: italic;">_[[:alpha:]]+</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">*</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(?:</span><span style="font-style: italic;">[ :=~&#8217;&#8221;]</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">|</span><span style="font-style: italic;">$</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">"</span>
                nil <span style="font-weight: bold;">:noerror</span>)
          (<span style="font-weight: bold;">setq</span> count (1+ count))
          (<span style="font-weight: bold;">let*</span> ((prev (match-string-no-properties 1))
                 (new (downcase prev)))
            (replace-match new <span style="font-weight: bold;">:fixedcase</span> nil nil 1)
            (message <span style="font-style: italic;">"Updated(%d): %s =&gt; %s"</span> count prev new)))
        (message <span style="font-style: italic;">"Lower-cased %d matches"</span> count)))))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdae2d9e7" class="outline-3">
<h3 id="orgdae2d9e7"><span class="section-number-3">10.10</span> イベント通知</h3>
<div class="outline-text-3" id="text-orgdae2d9e7">
<p>
ここでは， <code>terminal-notifier</code> ではなく，事実上，後継アプリと言える <code>alerter</code> を使う設定です．
</p>

<p>
macOS の通知機能を使って，Emacsで発生するイベントをユーザに通知します． <code>org-show-notification-handler</code> に <code>terminal-notifier.app</code> を呼ぶ関数をぶら下げることで， <code>org-notify</code> で簡単に通知機能を使えるようになります． <code>appt-disp-window</code> をカスタマイズすれば， appt を経由して TODOのアイテムも通知されます．
</p>

<p>
独自に追加した <code>ns-default-notification-sound</code> に OSで定められたアラーム音を設定できます．音楽を流したい時は， <code>org-show-notification-handler</code> の引数で指定すると設定できます．
</p>


<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">&#xa0;</th>
<th scope="col" class="org-left">sticky</th>
<th scope="col" class="org-left">sound</th>
<th scope="col" class="org-left">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">pomodoro</td>
<td class="org-left">nil</td>
<td class="org-left">Glass</td>
<td class="org-left">my-pomodoro-notify</td>
</tr>

<tr>
<td class="org-left">org-notify</td>
<td class="org-left">t</td>
<td class="org-left">default</td>
<td class="org-left">my-desktop-notification-handler</td>
</tr>

<tr>
<td class="org-left">daily.org</td>
<td class="org-left">select</td>
<td class="org-left">default</td>
<td class="org-left">my-desktop-notify</td>
</tr>

<tr>
<td class="org-left">appt</td>
<td class="org-left">select</td>
<td class="org-left">Glass/Pop</td>
<td class="org-left">ad:appt-disp-window</td>
</tr>
</tbody>
</table>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">&#xa0;</th>
<th scope="col" class="org-left">Note</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">pomodoro</td>
<td class="org-left">pomodoro loop</td>
</tr>

<tr>
<td class="org-left">org-notify</td>
<td class="org-left">orgからの通知</td>
</tr>

<tr>
<td class="org-left">daily.org</td>
<td class="org-left">Alarms on a table</td>
</tr>

<tr>
<td class="org-left">appt</td>
<td class="org-left">TODO items with deadline</td>
</tr>
</tbody>
</table>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"postpone"</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Select from Preferences: { Funk | Glass | ... | Purr | Pop ... }</span>
  (<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">ns-default-notification-sound</span> <span style="font-style: italic;">"Pop"</span>)

  (<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">ns-alerter-command</span>
    (executable-find (concat (getenv <span style="font-style: italic;">"HOME"</span>) <span style="font-style: italic;">"/Dropbox/bin/alerter"</span>))
    <span style="font-style: italic;">"Path to alerter command. see https://github.com/vjeantet/alerter"</span>)

  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-desktop-notification</span> (title message <span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> sticky sound timeout)
    <span style="font-style: italic;">"Show a message by `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">alerter</span><span style="font-style: italic;">' command."</span>
    (<span style="font-weight: bold;">if</span> ns-alerter-command
        (start-process
         <span style="font-style: italic;">"notification"</span> <span style="font-style: italic;">"*notification*"</span>
         ns-alerter-command
         <span style="font-style: italic;">"-title"</span> title
         <span style="font-style: italic;">"-message"</span> message
         <span style="font-style: italic;">"-sender"</span> <span style="font-style: italic;">"org.gnu.Emacs"</span>
         <span style="font-style: italic;">"-timeout"</span> (format <span style="font-style: italic;">"%s"</span> (<span style="font-weight: bold;">if</span> sticky 0 (<span style="font-weight: bold;">or</span> timeout 7)))
         <span style="font-style: italic;">"-sound"</span> (<span style="font-weight: bold;">or</span> sound ns-default-notification-sound))
      (message <span style="font-style: italic;">"--- ns-alerter-command is %s."</span> ns-alerter-command)))

  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">eval (org-notify "hoge") to test this setting</span>
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-desktop-notification-handler</span> (message)
    (my-desktop-notification <span style="font-style: italic;">"Message from org-mode"</span> message t))
  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"org"</span>
    (<span style="font-weight: bold;">when</span> ns-alerter-command
      (<span style="font-weight: bold;">setq</span> org-show-notification-handler #'my-desktop-notification-handler))))
</pre>
</div>
</div>
</div>

<div id="outline-container-orga58b21fc" class="outline-3">
<h3 id="orga58b21fc"><span class="section-number-3">10.11</span> org-mode でアラーム管理</h3>
<div class="outline-text-3" id="text-orga58b21fc">
<p>
<del>（注）Growlnotify の代わりに <code>terminal-notifier</code> を使うこともできます．</del>
</p>

<p>
<span class="timestamp-wrapper"><span class="timestamp">[2018-03-19 Mon]</span></span>: alerter に統一しました．
</p>

<p>
通知アプリと org-mode のバッファを組み合わせてアラームリストを管理しています．アラームをorgバッファに書き込むだけなので，とても楽です．機能としては，特定のorgバッファに，時刻とアラームの内容を表の形式として保存しておくだけで，Emacs が起動している限りにおいて通知アプリがそのアラームをデスクトップに表示してくれます．つまり，アラームリストは org-mode の表で一覧化されているので，管理も楽ですし，見た目もわかりやすいです．
</p>

<p>
アラームとして解釈される表は，オプション，時刻（HH:MM形式），アラーム内容の3列で構成していればOKです．オプションの列にXを入れておくと，通知アプリがStickyモードで動作するので，アラームを見逃しません．
</p>

<p>
アラームは複数登録することができます．不要になったアラームを削除するのは，単純に表から当該の行を削除するだけで済みます．実際のところは，バッファが保存される時にアラームリストの変更が自動的にシステムに反映されるので，余計な作業は不要です．
</p>

<p>
<code>my-set-alarms-from-file</code> は，<a href="https://pxaka.tokyo/wiki/doku.php?id=emacs:utility.el">utility.el</a>に記述した関数です．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">unless</span> noninteractive
  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"org"</span>
    (<span style="font-weight: bold;">let</span> ((file <span style="font-style: italic;">"~/Dropbox/org/db/daily.org"</span>))
      (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">and</span> (file-exists-p file)
                 (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">utility</span> nil t))
        (my-set-alarms-from-file file) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">init</span>
        (add-hook 'after-save-hook #'my-update-alarms-from-file))))) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">update</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org49e5d185" class="outline-3">
<h3 id="org49e5d185"><span class="section-number-3">10.12</span> カウントダウンタイマー</h3>
<div class="outline-text-3" id="text-org49e5d185">
<p>
<code>M-x my-countdown-timer</code> で呼び出します．ちょっと時間を測りたい時に使っています．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"org"</span>
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-countdown-timer-notify</span> ()
    (<span style="font-weight: bold;">when</span> mode-line-format
      (my-mode-line-off))
    (<span style="font-weight: bold;">when</span> ns-alerter-command
      (<span style="font-weight: bold;">setq</span> org-show-notification-handler #'my-desktop-notification-handler))
    (remove-hook 'org-timer-done-hook #'my-countdown-timer-notify)
    (remove-hook 'org-timer-stop-hook #'my-countdown-timer-notify)
    (my-desktop-notification <span style="font-style: italic;">"### Expired! ###"</span> <span style="font-style: italic;">"Time is up!"</span> t <span style="font-style: italic;">"Glass"</span>))

  (<span style="font-weight: bold;">defalias</span> '<span style="font-weight: bold;">run-timer</span> 'my-countdown-timer)
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-countdown-timer</span> ()
    (<span style="font-weight: bold;">interactive</span>)
    (<span style="font-weight: bold;">unless</span> mode-line-format
      (my-mode-line-on))
    (<span style="font-weight: bold;">when</span> (eq org-show-notification-handler #'my-desktop-notification-handler)
      (<span style="font-weight: bold;">setq</span> org-show-notification-handler nil))
    (<span style="font-weight: bold;">with-temp-buffer</span>
      (org-mode)
      (add-hook 'org-timer-done-hook #'my-countdown-timer-notify)
      (add-hook 'org-timer-stop-hook #'my-countdown-timer-notify)
      (org-timer-set-timer))))
</pre>
</div>
</div>
</div>

<div id="outline-container-orga3d0c218" class="outline-3">
<h3 id="orga3d0c218"><span class="section-number-3">10.13</span> リンクをエコーエリアに表示する</h3>
<div class="outline-text-3" id="text-orga3d0c218">
<p>
<code>eldoc</code> の機能を使うと簡単にできます．
</p>

<ul class="org-ul">
<li><a href="https://pxaka.tokyo/blog/2019/a7ef3cd5-df52-2004-db2b-03d36ef48555/">リンクの内容をeldocで表示 - imadenale</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(org-mode my-load-echo-org-link)
       <span style="font-style: italic;">"org"</span> nil t)

  (add-hook 'org-mode-hook #'my-load-echo-org-link)

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"org"</span>
    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-echo-org-link</span> ()
      (<span style="font-weight: bold;">when</span> (org-in-regexp org-link-bracket-re 1)
        (<span style="font-weight: bold;">let</span> ((link <span style="font-style: italic;">"Link:"</span>)
              (msg (org-link-unescape (match-string-no-properties 1))))
          (put-text-property 0 (length link) 'face 'minibuffer-prompt link)
          (eldoc-message (format <span style="font-style: italic;">"%s %s"</span> link msg)))))

    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-load-echo-org-link</span> ()
      (<span style="font-weight: bold;">add-function</span> <span style="font-weight: bold;">:before-until</span> (local 'eldoc-documentation-function)
                    #'my-echo-org-link)
      <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(setq-local eldoc-documentation-function #'my-echo-org-link)</span>
      )))
</pre>
</div>
</div>
</div>

<div id="outline-container-org30aecedf" class="outline-3">
<h3 id="org30aecedf"><span class="section-number-3">10.14</span> [org-capture] 高速にメモを取る</h3>
<div class="outline-text-3" id="text-org30aecedf">
<p>
Emacs を起動している限り，いつでもどこでもメモを記録できます．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(org-capture)
       <span style="font-style: italic;">"org-capture"</span> nil t)

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"org"</span>
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#12461;&#12515;&#12503;&#12481;&#12515;&#26178;&#12395;&#20316;&#25104;&#26085;&#26178;&#12434;&#12503;&#12525;&#12497;&#12486;&#12451;&#12395;&#20837;&#12428;&#12427;</span>
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Thanks to https://emacs.stackexchange.com/questions/21291/add-created-timestamp-to-logbook</span>
    (<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my-org-created-property-name</span> <span style="font-style: italic;">"CREATED"</span>
      <span style="font-style: italic;">"The name of the org-mode property.</span>
<span style="font-style: italic;">This user property stores the creation date of the entry"</span>)
    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-org-set-created-property</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> active NAME)
      <span style="font-style: italic;">"Set a property on the entry giving the creation time.</span>

<span style="font-style: italic;">By default the property is called CREATED. If given the `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">NAME</span><span style="font-style: italic;">'</span>
<span style="font-style: italic;">argument will be used instead. If the property already exists, it</span>
<span style="font-style: italic;">will not be modified."</span>
      (<span style="font-weight: bold;">interactive</span>)
      (<span style="font-weight: bold;">let*</span> ((created (<span style="font-weight: bold;">or</span> NAME my-org-created-property-name))
             (fmt (<span style="font-weight: bold;">if</span> active <span style="font-style: italic;">"&lt;%s&gt;"</span> <span style="font-style: italic;">"[%s]"</span>))
             (now (format fmt (format-time-string <span style="font-style: italic;">"%Y-%m-%d %a %H:%M"</span>)))
             (field (org-entry-get (point) created nil)))
        (<span style="font-weight: bold;">unless</span> (<span style="font-weight: bold;">or</span> field (equal <span style="font-style: italic;">""</span> field))
          (org-set-property created now)
          (org-cycle-hide-drawers 'children))))
    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">ad:org-insert-todo-heading</span> (_arg <span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> _force-heading)
      (<span style="font-weight: bold;">unless</span> (org-at-item-checkbox-p)
        (my-org-set-created-property)))
    (advice-add 'org-insert-todo-heading <span style="font-weight: bold;">:after</span> #'ad:org-insert-todo-heading))

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"org-capture"</span>
    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-toggle-org-block-visibility</span> ()
      <span style="font-style: italic;">"Testing..."</span>
      (<span style="font-weight: bold;">interactive</span>)
      (<span style="font-weight: bold;">when</span> (looking-at org-drawer-regexp)
        (org-flag-drawer    <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">toggle block visibility</span>
         (not (get-char-property (match-end 0) 'invisible)))))

    (add-hook 'org-capture-before-finalize-hook #'my-org-set-created-property)

    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">2010-06-13 &#12398;&#24418;&#24335;&#12391;&#12399;&#65292;&#12479;&#12464;&#12392;&#12375;&#12390;&#35469;&#35672;&#12373;&#12428;&#12394;&#12356;</span>
    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">get-current-date-tags</span> () (format-time-string <span style="font-style: italic;">"%Y%m%d"</span>))
    (<span style="font-weight: bold;">setq</span> org-default-notes-file (concat org-directory <span style="font-style: italic;">"next.org"</span>))
    (<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">org-capture-academic-file</span> (concat org-directory <span style="font-style: italic;">"academic.org"</span>))
    (<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">org-capture-ical-file</span> (concat org-directory <span style="font-style: italic;">"org-ical.org"</span>))
    (<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">org-capture-buffer-file</span> (concat org-directory <span style="font-style: italic;">"db/buffer.org"</span>))
    (<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">org-capture-notes-file</span> (concat org-directory <span style="font-style: italic;">"db/note.org"</span>))
    (<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">org-capture-english-file</span> (concat org-directory <span style="font-style: italic;">"db/english.org"</span>))
    (<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">org-capture-diary-file</span> (concat org-directory <span style="font-style: italic;">"log/diary.org"</span>))
    (<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">org-capture-article-file</span> (concat org-directory <span style="font-style: italic;">"db/article.org"</span>))
    (<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">org-capture-blog-file</span>
      (concat org-directory <span style="font-style: italic;">"blog/entries/imadenale.org"</span>))

    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">see org.pdf:p73</span>
    (<span style="font-weight: bold;">setq</span> org-capture-templates
          `((<span style="font-style: italic;">"t"</span> <span style="font-style: italic;">"TODO &#38917;&#30446;&#12434; INBOX &#12395;&#36028;&#12426;&#20184;&#12369;&#12427;"</span> entry
             (file+headline ,org-default-notes-file <span style="font-style: italic;">"INBOX"</span>) <span style="font-style: italic;">"** TODO %?\n"</span>)
            (<span style="font-style: italic;">"a"</span> <span style="font-style: italic;">"&#35352;&#20107;&#12522;&#12473;&#12488;&#12395;&#12456;&#12531;&#12488;&#12522;&#12540;"</span> entry
             (file+headline ,org-capture-article-file <span style="font-style: italic;">"INBOX"</span>)
             <span style="font-style: italic;">"** READ %?\n\t"</span>)
            (<span style="font-style: italic;">"c"</span> <span style="font-style: italic;">"&#21516;&#26399;&#12459;&#12524;&#12531;&#12480;&#12540;&#12395;&#12456;&#12531;&#12488;&#12522;&#12540;"</span> entry
             (file+headline ,org-capture-ical-file <span style="font-style: italic;">"Scheduled"</span>)
             <span style="font-style: italic;">"** TODO %?\n\t"</span>)
            (<span style="font-style: italic;">"d"</span> <span style="font-style: italic;">"Doing&#12479;&#12464;&#20184;&#12365;&#12398;&#12479;&#12473;&#12463;&#12434;Inbox&#12395;&#25237;&#12370;&#12427;"</span> entry
             (file+headline ,org-default-notes-file <span style="font-style: italic;">"INBOX"</span>)
             <span style="font-style: italic;">"** TODO %? :Doing:\n  - \n"</span>
             <span style="font-weight: bold;">:clock-in</span> t
             <span style="font-weight: bold;">:clock-keep</span> t)
            (<span style="font-style: italic;">"l"</span> <span style="font-style: italic;">"&#26412;&#26085;&#12398;&#12481;&#12455;&#12483;&#12463;&#12522;&#12473;&#12488;"</span> entry
             (file+headline ,org-capture-diary-file <span style="font-style: italic;">"Today"</span>)
             <span style="font-style: italic;">"** FOCUS &#26412;&#26085;&#12398;&#12481;&#12455;&#12483;&#12463;&#12522;&#12473;&#12488; %T\n&#65288;&#36215;&#24202;&#26178;&#38291;&#12398;&#35352;&#37682;&#65289;[[http://www.hayaoki-seikatsu.com/users/takaxp/][&#26089;&#36215;&#12365;&#26085;&#35352;]] \n&#65288;&#26397;&#39135;&#65289;\n  - [ ] %?\n&#65288;&#26172;&#39135;&#65289;\n&#65288;&#24112;&#23429;&#65295;&#22805;&#39135;&#65289;\n----\n&#65288;&#30740;&#31350;&#36895;&#22577;&#65289;\n  - [ ] \n"</span>)
            (<span style="font-style: italic;">"i"</span> <span style="font-style: italic;">"&#12450;&#12452;&#12487;&#12451;&#12450;&#12434;&#26360;&#12365;&#36796;&#12416;"</span> entry (file+headline ,org-default-notes-file <span style="font-style: italic;">"INBOX"</span>)
             <span style="font-style: italic;">"** %?\n  - \n\t%U"</span>)
            (<span style="font-style: italic;">"b"</span> <span style="font-style: italic;">"Create new post for imadenale blog"</span> entry
             (file+headline ,org-capture-blog-file ,(format-time-string <span style="font-style: italic;">"%Y"</span>))
             <span style="font-style: italic;">"** TODO \n:PROPERTIES:\n:EXPORT_FILE_NAME: %?\n:EXPORT_HUGO_TAGS: \n:EXPORT_HUGO_LASTMOD: \n:EXPORT_HUGO_IMAGES: \n:END:\n"</span>)
            (<span style="font-style: italic;">"B"</span> <span style="font-style: italic;">"Create new post for imadenale blog (UUID)"</span> entry
             (file+headline ,org-capture-blog-file ,(format-time-string <span style="font-style: italic;">"%Y"</span>))
             <span style="font-style: italic;">"** TODO %?\n:PROPERTIES:\n:EXPORT_FILE_NAME: %(uuid-string)\n:EXPORT_HUGO_TAGS: \n:EXPORT_HUGO_LASTMOD: \n:EXPORT_HUGO_IMAGES: \n:END:\n"</span>)
            <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">("b" "Bug &#12479;&#12464;&#20184;&#12365;&#12398; TODO &#38917;&#30446;&#12434;&#36028;&#12426;&#20184;&#12369;&#12427;" entry</span>
            <span style="font-weight: bold; font-style: italic;">;;  </span><span style="font-weight: bold; font-style: italic;">(file+headline ,org-default-notes-file "INBOX")</span>
            <span style="font-weight: bold; font-style: italic;">;;  </span><span style="font-weight: bold; font-style: italic;">"** TODO %? :bug:\n %i\n %a %t")</span>
            (<span style="font-style: italic;">"T"</span> <span style="font-style: italic;">"&#26178;&#38291;&#20184;&#12365;&#12456;&#12531;&#12488;&#12522;&#12540;"</span> entry (file+headline ,org-default-notes-file <span style="font-style: italic;">"INBOX"</span>)
             <span style="font-style: italic;">"** %? %T--\n"</span>)
            (<span style="font-style: italic;">"n"</span> <span style="font-style: italic;">"&#12494;&#12540;&#12488;&#12392;&#12375;&#12390;INBOX&#12395;&#36028;&#12426;&#20184;&#12369;&#12427;"</span> entry
             (file+headline ,org-default-notes-file <span style="font-style: italic;">"INBOX"</span>)
             <span style="font-style: italic;">"** %? :note:\n\t%U"</span>)
            (<span style="font-style: italic;">"D"</span> <span style="font-style: italic;">"&#12300;&#12489;&#12521;&#12483;&#12459;&#12540;365&#12398;&#37329;&#35328;&#12301;&#12434;&#12494;&#12540;&#12488;&#12377;&#12427;"</span> entry
             (file+headline ,org-capture-notes-file <span style="font-style: italic;">"The Daily Drucker"</span>)
             <span style="font-style: italic;">"** &#12300;%?&#12301;\nDrucker) \n  - \n  - \nACTION POINT:\n  - \nQUESTION:\n  - \n"</span>)
            (<span style="font-style: italic;">"r"</span> ,(concat <span style="font-style: italic;">"&#30740;&#31350;&#12494;&#12540;&#12488;&#12434; "</span> org-capture-academic-file
                          <span style="font-style: italic;">" &#12395;&#26360;&#12365;&#36796;&#12416;"</span>)
             entry (file+headline ,org-capture-academic-file <span style="font-style: italic;">"Survey"</span>)
             <span style="font-style: italic;">"** %? :note:\n# \n  - \n\t%U"</span>)
            (<span style="font-style: italic;">"`"</span> ,(concat <span style="font-style: italic;">"&#12494;&#12540;&#12488;&#12434;&#12496;&#12483;&#12501;&#12449; "</span> org-capture-buffer-file
                          <span style="font-style: italic;">" &#12395;&#26360;&#12365;&#36796;&#12416;"</span>)
             entry (file+headline ,org-capture-buffer-file <span style="font-style: italic;">"Buffers"</span>)
             <span style="font-style: italic;">"** %(get-random-string 16) %U\n\n%?\n\n----"</span>)
            (<span style="font-style: italic;">"w"</span> ,(concat <span style="font-style: italic;">"&#33521;&#21336;&#35486;&#12434; "</span> org-capture-english-file
                          <span style="font-style: italic;">" &#12395;&#26360;&#12365;&#36796;&#12416;"</span>) <span style="font-weight: bold;">entry</span>
                          (file+headline ,org-capture-english-file <span style="font-style: italic;">"WORDS"</span>)
                          <span style="font-style: italic;">"** %? :%(get-current-date-tags):\n&#12300;&#12301;\n  - "</span>)
            (<span style="font-style: italic;">"g"</span> ,(concat <span style="font-style: italic;">"&#33521;&#35486;&#12494;&#12540;&#12488;&#12434; "</span> org-capture-english-file
                          <span style="font-style: italic;">" &#12395;&#26360;&#12365;&#36796;&#12416;"</span>)
             entry (file+headline ,org-capture-english-file <span style="font-style: italic;">"GRAMMER"</span>)
             <span style="font-style: italic;">"** %? :%(get-current-date-tags):\n\n%U"</span>)
            ))))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc3302e41" class="outline-3">
<h3 id="orgc3302e41"><span class="section-number-3">10.15</span> [org-agenda] タスク／予定管理</h3>
<div class="outline-text-3" id="text-orgc3302e41">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"org-agenda"</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#12450;&#12472;&#12455;&#12531;&#12480;&#20316;&#25104;&#23550;&#35937;&#65288;&#25351;&#23450;&#12375;&#12394;&#12356;&#12392;agenda&#12364;&#29983;&#25104;&#12373;&#12428;&#12394;&#12356;&#65289;</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#12371;&#12371;&#12434;&#38291;&#36949;&#12358;&#12392;&#65292;MobileOrg, iCal export &#12418;&#12358;&#12414;&#12367;&#12356;&#12363;&#12394;&#12356;</span>
  (<span style="font-weight: bold;">setq</span> org-agenda-files
        (mapcar (<span style="font-weight: bold;">lambda</span> (arg)
                  (concat (getenv <span style="font-style: italic;">"SYNCROOT"</span>) <span style="font-style: italic;">"/org/"</span> arg))
                '(<span style="font-style: italic;">"org-ical.org"</span> <span style="font-style: italic;">"next.org"</span> <span style="font-style: italic;">"db/cooking.org"</span> <span style="font-style: italic;">"minutes/wg1.org"</span>
                  <span style="font-style: italic;">"db/daily.org"</span> <span style="font-style: italic;">"db/trigger.org"</span> <span style="font-style: italic;">"tr/work.org"</span> <span style="font-style: italic;">"academic.org"</span>
                  <span style="font-style: italic;">"org2ja.org"</span>)))
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(setq org-agenda-files</span>
  <span style="font-weight: bold; font-style: italic;">;;       </span><span style="font-weight: bold; font-style: italic;">'("~/Dropbox/org/org-ical.org" "~/Dropbox/org/next.org"</span>
  <span style="font-weight: bold; font-style: italic;">;;         </span><span style="font-weight: bold; font-style: italic;">"~/Dropbox/org/db/cooking.org" "~/Dropbox/org/minutes/wg1.org"</span>
  <span style="font-weight: bold; font-style: italic;">;;         </span><span style="font-weight: bold; font-style: italic;">"~/Dropbox/org/db/daily.org" "~/Dropbox/org/db/trigger.org"</span>
  <span style="font-weight: bold; font-style: italic;">;;         </span><span style="font-weight: bold; font-style: italic;">"~/Dropbox/org/tr/work.org" "~/Dropbox/org/academic.org"</span>
  <span style="font-weight: bold; font-style: italic;">;;         </span><span style="font-weight: bold; font-style: italic;">"~/Dropbox/org/org2ja.org"))</span>

  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">sorting strategy</span>
  (<span style="font-weight: bold;">setq</span> org-agenda-sorting-strategy
        '((agenda habit-down time-up timestamp-up priority-down category-keep)
          (todo priority-down category-keep)
          (tags priority-down category-keep)
          (search category-keep)))

  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Set the view span as day in an agenda view, the default is week</span>
  (<span style="font-weight: bold;">setq</span> org-agenda-span 'day)

  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#12450;&#12472;&#12455;&#12531;&#12480;&#12395;&#35686;&#21578;&#12434;&#34920;&#31034;&#12377;&#12427;&#26399;&#38291;</span>
  (<span style="font-weight: bold;">setq</span> org-deadline-warning-days 0)

  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#26178;&#38291;&#24133;&#12364;&#26126;&#31034;&#30340;&#12395;&#25351;&#23450;&#12373;&#12428;&#12394;&#12356;&#22580;&#21512;&#12398;&#12487;&#12501;&#12457;&#12523;&#12488;&#20516;&#65288;&#20998;&#25351;&#23450;&#65289;</span>
  (<span style="font-weight: bold;">setq</span> org-agenda-default-appointment-duration 60)

  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#12450;&#12472;&#12455;&#12531;&#12480;&#12499;&#12517;&#12540;&#12391;FOLLOW&#12434;&#35373;&#23450;&#65288;&#33258;&#21205;&#30340;&#12395;&#21029;&#12496;&#12483;&#12501;&#12449;&#12395;&#24403;&#35442;&#12479;&#12473;&#12463;&#12434;&#34920;&#31034;&#65289;</span>
  (<span style="font-weight: bold;">setq</span> org-agenda-start-with-follow-mode t)

  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Customized Time Grid</span>
  (<span style="font-weight: bold;">setq</span> org-agenda-time-grid <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Format is changed from 9.1</span>
        '((daily today require-timed)
          (0800 1000 1200 1400 1600 1800 2000 2200 2400)
          <span style="font-style: italic;">"......"</span>
          <span style="font-style: italic;">"----------------"</span>
          ))

  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(setq org-agenda-current-time-string "&lt;  d('- ' &#65394;&#65423;&#65402;&#65402;)")</span>
  (<span style="font-weight: bold;">setq</span> org-agenda-current-time-string <span style="font-style: italic;">"&lt; &#65394;&#65423;&#65402;&#65402;"</span>)
  (<span style="font-weight: bold;">setq</span> org-agenda-timegrid-use-ampm t)

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"moom"</span>
    (<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my-org-tags-column</span> org-tags-column)
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Expand the frame width temporarily during org-agenda is activated.</span>
    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-agenda-frame-width</span> ()
      (<span style="font-weight: bold;">let</span> ((width (floor (* 1.2 moom-frame-width-single))))
        (<span style="font-weight: bold;">setq</span> org-tags-column (- org-tags-column (- width 80)))
        <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(org-align-tags t)</span>
        (moom-change-frame-width width)))
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(add-hook 'org-agenda-mode-hook #'my-agenda-frame-width)</span>

    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">ad:org-agenda--quit</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> _bury)
      (<span style="font-weight: bold;">setq</span> org-tags-column my-org-tags-column)
      <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(org-align-tags t)</span>
      (moom-change-frame-width))
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(advice-add 'org-agenda--quit :after #'ad:org-agenda--quit)</span>
    )

  (add-hook 'org-finalize-agenda-hook #'my-org-agenda-to-appt)

  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#31227;&#21205;&#30452;&#24460;&#12395;agenda&#12496;&#12483;&#12501;&#12449;&#12434;&#38281;&#12376;&#12427;&#65288;&#12484;&#12522;&#12540;&#12398;&#20869;&#23481;&#12399;SPACE&#12391;&#30906;&#35469;&#21487;&#65289;</span>
  (org-defkey org-agenda-mode-map [(tab)]
              (<span style="font-weight: bold;">lambda</span> () (<span style="font-weight: bold;">interactive</span>)
                (org-agenda-goto)
                (<span style="font-weight: bold;">with-current-buffer</span> <span style="font-style: italic;">"*Org Agenda*"</span>
                  (org-agenda-quit))))

  (custom-set-faces
   <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">'(org-agenda-clocking ((t (:background "#300020"))))</span>
   '(org-agenda-structure ((t (<span style="font-weight: bold;">:underline</span> t <span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#6873ff"</span>))))
   '(org-agenda-date-today ((t (<span style="font-weight: bold;">:weight</span> bold <span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#4a6aff"</span>))))
   '(org-agenda-date ((t (<span style="font-weight: bold;">:weight</span> bold <span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#6ac214"</span>))))
   '(org-agenda-date-weekend ((t (<span style="font-weight: bold;">:weight</span> bold <span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#ff8d1e"</span>))))
   '(org-time-grid ((t (<span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#0a4796"</span>))))
   '(org-warning ((t (<span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#ff431a"</span>))))
   '(org-upcoming-deadline ((t (<span style="font-weight: bold;">:inherit</span> font-lock-keyword-face))))
   )

  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#25152;&#23450;&#12398;&#26178;&#21051;&#12395;&#24375;&#21046;&#30340;&#12395;Agenda&#12434;&#34920;&#31034;</span>
  (<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my-org-agenda-auto-popup-list</span>
    '(<span style="font-style: italic;">"01:00"</span> <span style="font-style: italic;">"11:00"</span> <span style="font-style: italic;">"14:00"</span> <span style="font-style: italic;">"17:00"</span> <span style="font-style: italic;">"20:00"</span> <span style="font-style: italic;">"23:00"</span>))
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-popup-agenda</span> ()
    (<span style="font-weight: bold;">interactive</span>)
    (<span style="font-weight: bold;">let</span> ((status use-dialog-box))
      (<span style="font-weight: bold;">setq</span> use-dialog-box nil)
      (<span style="font-weight: bold;">when</span> (y-or-n-p-with-timeout <span style="font-style: italic;">"Popup agenda now?"</span> 10 nil)
        (org-agenda-list))
      (message <span style="font-style: italic;">""</span>)
      (<span style="font-weight: bold;">setq</span> use-dialog-box status)))
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-popup-agenda-set-timers</span> ()
    (<span style="font-weight: bold;">interactive</span>)
    (cancel-function-timers 'my-popup-agenda)
    (<span style="font-weight: bold;">dolist</span> (triger my-org-agenda-auto-popup-list)
      (<span style="font-weight: bold;">when</span> (future-time-p triger)
        (run-at-time triger nil 'my-popup-agenda))))
  (my-popup-agenda-set-timers)
  (run-at-time <span style="font-style: italic;">"24:00"</span> nil 'my-popup-agenda-set-timers)

  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#12388;&#12356;&#12391;&#12395; calendar.app &#12418;&#23450;&#26399;&#30340;&#12395;&#24375;&#21046;&#36215;&#21205;&#12377;&#12427;</span>
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-popup-calendar</span> ()
    (<span style="font-weight: bold;">interactive</span>)
    (<span style="font-weight: bold;">if</span> (<span style="font-weight: bold;">and</span> (eq system-type 'darwin)
             (frame-focus-state))
        (shell-command-to-string <span style="font-style: italic;">"open -a calendar.app"</span>)
      (message <span style="font-style: italic;">"--- input focus is currently OUT."</span>)))

  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-popup-calendar-set-timers</span> ()
    (<span style="font-weight: bold;">interactive</span>)
    (cancel-function-timers 'my-popup-calendar)
    (<span style="font-weight: bold;">dolist</span> (triger my-org-agenda-auto-popup-list)
      (<span style="font-weight: bold;">when</span> (future-time-p triger)
        (run-at-time triger nil 'my-popup-calendar))))

  (<span style="font-weight: bold;">when</span> (memq window-system '(mac ns))
    (my-popup-calendar-set-timers)
    (run-at-time <span style="font-style: italic;">"24:00"</span> nil 'my-popup-calendar-set-timers))

  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">org-agenda &#12391;&#12418; "d" &#25276;&#19979;&#12391; "DONE" &#12395;&#12377;&#12427;</span>
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-org-agenda-done</span> ()
    (<span style="font-weight: bold;">interactive</span>)
    (org-agenda-todo <span style="font-style: italic;">"DONE"</span>)
    (my-org-agenda-to-appt)) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">call with async</span>
  (org-defkey org-agenda-mode-map <span style="font-style: italic;">"d"</span> 'my-org-agenda-done)

  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">org-agenda &#12398;&#34920;&#31034;&#39640;&#12373;&#12434; 50% &#12395;&#22266;&#23450;&#12377;&#12427;</span>
  (<span style="font-weight: bold;">setq</span> org-agenda-window-frame-fractions '(0.5 . 0.5)))

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">M-x calendar &#12398;&#21205;&#20316;&#12395;&#36817;&#12389;&#12369;&#12427;&#65294;&#12394;&#12362; today &#12408;&#12398;&#31227;&#21205;&#12399;&#65292;"C-." &#12391;&#21487;&#33021;&#65294;</span>
(<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"org-keys"</span>
  (org-defkey org-read-date-minibuffer-local-map (kbd <span style="font-style: italic;">"C-n"</span>)
              (<span style="font-weight: bold;">lambda</span> () (<span style="font-weight: bold;">interactive</span>)
                (org-eval-in-calendar '(calendar-forward-week 1))))
  (org-defkey org-read-date-minibuffer-local-map (kbd <span style="font-style: italic;">"C-p"</span>)
              (<span style="font-weight: bold;">lambda</span> () (<span style="font-weight: bold;">interactive</span>)
                (org-eval-in-calendar '(calendar-backward-week 1))))
  (org-defkey org-read-date-minibuffer-local-map (kbd <span style="font-style: italic;">"C-b"</span>)
              (<span style="font-weight: bold;">lambda</span> () (<span style="font-weight: bold;">interactive</span>)
                (org-eval-in-calendar '(calendar-backward-day 1))))
  (org-defkey org-read-date-minibuffer-local-map (kbd <span style="font-style: italic;">"C-f"</span>)
              (<span style="font-weight: bold;">lambda</span> () (<span style="font-weight: bold;">interactive</span>)
                (org-eval-in-calendar '(calendar-forward-day 1))))
  (org-defkey org-read-date-minibuffer-local-map (kbd <span style="font-style: italic;">"q"</span>)
              (<span style="font-weight: bold;">lambda</span> () (<span style="font-weight: bold;">interactive</span>)
                (org-eval-in-calendar '(minibuffer-keyboard-quit)))))
</pre>
</div>

<p>
入門者にとって <code>org-agenda</code> は簡単ではないので，無理に使わなくて良いと思います．Org Modeの動作に十分慣れたら戻ってくる程度で十分です．
</p>
</div>
</div>

<div id="outline-container-org735f32e3" class="outline-3">
<h3 id="org735f32e3"><span class="section-number-3">10.16</span> [org-onit.el] org-clock-in の自動化</h3>
<div class="outline-text-3" id="text-org735f32e3">
<p>
<code>org-onit.el</code> を導入すると，タグを付けるタイミングで自動的に <code>org-clock-in</code> します．タグを取れば <code>org-clock-out</code> が実行されるようになります．
</p>

<ul class="org-ul">
<li><a href="https://github.com/takaxp/org-onit">https://github.com/takaxp/org-onit</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(org-onit-toggle-doing
         org-onit-mode
         org-onit-toggle-auto org-clock-goto my-sparse-doing-tree
         org-clock-goto org-onit-clock-in-when-unfold
         org-onit-update-options)
       <span style="font-style: italic;">"org-onit"</span> nil t)

  (global-set-key (kbd <span style="font-style: italic;">"C-&lt;f11&gt;"</span>) 'org-clock-goto)

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"org"</span>
    (add-hook 'org-cycle-hook #'org-onit-clock-in-when-unfold)
    (define-key org-mode-map (kbd <span style="font-style: italic;">"&lt;f11&gt;"</span>) 'org-onit-toggle-doing)
    (define-key org-mode-map (kbd <span style="font-style: italic;">"M-&lt;f11&gt;"</span>) 'org-onit-toggle-auto)
    (define-key org-mode-map (kbd <span style="font-style: italic;">"S-&lt;f11&gt;"</span>) 'org-onit-goto-anchor)
    (<span style="font-weight: bold;">unless</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">org-bookmark-heading</span> nil t)
      (message <span style="font-style: italic;">"--- org-bookmark-heading.el is NOT installed."</span>))

    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-sparse-doing-tree</span> ()
      (<span style="font-weight: bold;">interactive</span>)
      (org-tags-view nil org-onit-tag)))

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"org-onit"</span>
    (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">org-plist</span> nil t)
      (add-to-list 'org-plist-dict '(<span style="font-style: italic;">"OPTIONS_ONIT"</span> org-onit-basic-options)))
    (custom-set-variables
     '(org-onit-basic-options '(<span style="font-weight: bold;">:wakeup</span> nil <span style="font-weight: bold;">:nostate</span> doing <span style="font-weight: bold;">:unfold</span> nil))))

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"org-clock"</span>
    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-onit-reveal</span> ()
      <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(widen)</span>
      (org-overview)
      (org-reveal)
      (org-cycle-hide-drawers 'all)
      (org-show-entry)
      (show-children)
      (org-show-siblings))
    (add-hook 'org-onit-after-jump-hook #'my-onit-reveal)

    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-clear-undo-list</span> ()
      (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">and</span> (fboundp 'org-clocking-p)
                 (org-clocking-p))
        (<span style="font-weight: bold;">setq</span> buffer-undo-list nil)))
    (add-hook 'org-clock-in-hook #'my-clear-undo-list) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">for testing...</span>

    (<span style="font-weight: bold;">setq</span> org-clock-clocked-in-display 'frame-title) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">or 'both</span>
    (<span style="font-weight: bold;">setq</span> org-clock-frame-title-format
          '((<span style="font-weight: bold;">:eval</span> (format <span style="font-style: italic;">"%s%s |%s|%s"</span>
                           (<span style="font-weight: bold;">if</span> (<span style="font-weight: bold;">and</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">org-clock-today</span> nil t)
                                    org-clock-today-mode)
                               (<span style="font-weight: bold;">if</span> org-clock-today-count-subtree
                                   (format <span style="font-style: italic;">"%s / %s"</span>
                                           org-clock-today-subtree-time
                                           org-clock-today-buffer-time)
                                 (format <span style="font-style: italic;">"%s"</span> org-clock-today-buffer-time))
                             <span style="font-style: italic;">""</span>)
                           (<span style="font-weight: bold;">if</span> org-onit--auto-clocking <span style="font-style: italic;">" Auto "</span> <span style="font-style: italic;">""</span>)
                           (org-onit-get-sign)
                           org-mode-line-string))
            <span style="font-style: italic;">" - %b"</span>))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org20c40e77" class="outline-3">
<h3 id="org20c40e77"><span class="section-number-3">10.17</span> [orgbox.el] スケジュール追加のわかりやすい入力</h3>
<div class="outline-text-3" id="text-org20c40e77">
<p>
<code>C-c C-s</code> をオーバーライドして <code>orgbox-schedule</code> を実行する．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"org"</span>
  (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">orgbox</span> nil t))
</pre>
</div>
</div>
</div>

<div id="outline-container-org5790e981" class="outline-3">
<h3 id="org5790e981"><span class="section-number-3">10.18</span> [appt.el] アラーム設定</h3>
<div class="outline-text-3" id="text-org5790e981">
<ul class="org-ul">
<li>Growl や <a href="https://github.com/julienXX/terminal-notifier/releases">Terminal Notifier</a> と連携していると，Emacsがバックグラウンドにあってもアラームに気づける．</li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(appt my-org-agenda-to-appt ad:appt-display-message
              ad:appt-disp-window)
       <span style="font-style: italic;">"appt"</span> nil t)

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"postpone"</span>
    (global-set-key (kbd <span style="font-style: italic;">"C-c f 3"</span>) #'my-org-agenda-to-appt))

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"appt"</span>
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#12514;&#12540;&#12489;&#12521;&#12452;&#12531;&#12395;&#27531;&#12426;&#26178;&#38291;&#12434;&#34920;&#31034;&#12375;&#12394;&#12356;</span>
    (<span style="font-weight: bold;">setq</span> appt-display-mode-line nil)

    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">window &#12434; &#12501;&#12524;&#12540;&#12512;&#20869;&#12395;&#34920;&#31034;&#12377;&#12427;</span>
    (<span style="font-weight: bold;">setq</span> appt-display-format 'echo)

    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">window &#12434;&#32153;&#32154;&#34920;&#31034;&#12377;&#12427;&#26178;&#38291;[s]</span>
    (<span style="font-weight: bold;">setq</span> appt-display-duration 5)

    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#12499;&#12540;&#12503;&#38899;&#12398;&#26377;&#28961;</span>
    (<span style="font-weight: bold;">setq</span> appt-audible nil)

    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#20309;&#20998;&#21069;&#12363;&#12425;&#35686;&#21578;&#34920;&#31034;&#12434;&#38283;&#22987;&#12377;&#12427;&#12363;[m]</span>
    (<span style="font-weight: bold;">setq</span> appt-message-warning-time 10)

    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#35686;&#21578;&#34920;&#31034;&#38283;&#22987;&#12363;&#12425;&#20309;&#20998;&#12372;&#12392;&#12395;&#12522;&#12510;&#12452;&#12531;&#12489;&#12377;&#12427;&#12363;[m]</span>
    (<span style="font-weight: bold;">setq</span> appt-display-interval 1)

    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">appt-display-format &#12364; 'echo &#12391;&#12418; appt-disp-window-function &#12434;&#21628;&#12406;</span>
    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">ad:appt-display-message</span> (string mins)
      <span style="font-style: italic;">"Display a reminder about an appointment.</span>
<span style="font-style: italic;">The string STRING describes the appointment, due in integer MINS minutes.</span>
<span style="font-style: italic;">The arguments may also be lists, where each element relates to a</span>
<span style="font-style: italic;">separate appointment.  The variable `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">appt-display-format</span><span style="font-style: italic;">' controls</span>
<span style="font-style: italic;">the format of the visible reminder.  If `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">appt-audible</span><span style="font-style: italic;">' is non-nil,</span>
<span style="font-style: italic;">also calls `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">beep</span><span style="font-style: italic;">' for an audible reminder."</span>
      (<span style="font-weight: bold;">if</span> appt-audible (beep 1))
      <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Backwards compatibility: avoid passing lists to a-d-w-f if not necessary.</span>
      (<span style="font-weight: bold;">and</span> (listp mins)
           (= (length mins) 1)
           (<span style="font-weight: bold;">setq</span> mins (car mins)
                 string (car string)))
      (<span style="font-weight: bold;">when</span> (memq appt-display-format '(window echo))
        (<span style="font-weight: bold;">let</span> ((time (format-time-string <span style="font-style: italic;">"%a %b %e "</span>))
              err)
          (<span style="font-weight: bold;">condition-case</span> err
              (funcall appt-disp-window-function
                       (<span style="font-weight: bold;">if</span> (listp mins)
                           (mapcar 'number-to-string mins)
                         (number-to-string mins))
                       time string)
            (wrong-type-argument
             (<span style="font-weight: bold;">if</span> (not (listp mins))
                 (<span style="font-weight: bold;">signal</span> (car err) (cdr err))
               (message <span style="font-style: italic;">"Argtype error in `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">appt-disp-window-function</span><span style="font-style: italic;">' - \</span>
<span style="font-style: italic;">update it for multiple appts?"</span>)
               <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Fallback to just displaying the first appt, as we used to.</span>
               (funcall appt-disp-window-function
                        (number-to-string (car mins)) time
                        (car string)))))
          err))
      (<span style="font-weight: bold;">cond</span> ((eq appt-display-format 'window)
             <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">TODO use calendar-month-abbrev-array rather than %b?</span>
             (run-at-time (format <span style="font-style: italic;">"%d sec"</span> appt-display-duration)
                          nil
                          appt-delete-window-function))
            ((eq appt-display-format 'echo)
             (message <span style="font-style: italic;">"%s"</span> (<span style="font-weight: bold;">if</span> (listp string)
                               (mapconcat 'identity string <span style="font-style: italic;">"\n"</span>)
                             string)))))
    (advice-add 'appt-display-message <span style="font-weight: bold;">:override</span> #'ad:appt-display-message)

    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">ad:appt-disp-window</span> (min-to-app _new-time appt-msg)
      <span style="font-style: italic;">"Extension to support appt-disp-window."</span>
      (<span style="font-weight: bold;">if</span> (string= min-to-app <span style="font-style: italic;">"0"</span>)
          (my-desktop-notification <span style="font-style: italic;">"### Expired! ###"</span> appt-msg t <span style="font-style: italic;">"Glass"</span>)
        (my-desktop-notification
         (concat <span style="font-style: italic;">"in "</span> min-to-app <span style="font-style: italic;">" min."</span>) appt-msg nil <span style="font-style: italic;">"Tink"</span>)))
    (<span style="font-weight: bold;">cond</span>
     ((eq appt-display-format 'echo)
      (<span style="font-weight: bold;">setq</span> appt-disp-window-function 'ad:appt-disp-window))
     ((eq appt-display-format 'window)
      (advice-add 'appt-disp-window <span style="font-weight: bold;">:before</span> #'ad:appt-disp-window))))

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"org"</span>
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#12450;&#12472;&#12455;&#12531;&#12480;&#12434;&#38283;&#12356;&#12383;&#12425;&#12450;&#12521;&#12540;&#12512;&#12522;&#12473;&#12488;&#12434;&#26356;&#26032;&#12375;&#12390;&#26377;&#21177;&#21270;&#12377;&#12427;</span>
    (<span style="font-weight: bold;">unless</span> noninteractive
      (add-hook 'org-agenda-mode-hook #'my-org-agenda-to-appt) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">init</span>
      (appt-activate 1))
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#37325;&#35079;&#23455;&#34892;&#12398;&#25233;&#21046;&#29992;&#12501;&#12521;&#12464;</span>
    (<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my-org-agenda-to-appt-ready</span> t)
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">org-agenda &#12398;&#20869;&#23481;&#12434;&#12450;&#12521;&#12540;&#12512;&#12395;&#30331;&#37682;&#12377;&#12427;</span>
    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-org-agenda-to-appt</span> ()
      <span style="font-style: italic;">"Update `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">appt-time-mag-list</span><span style="font-style: italic;">'.  Use `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">async</span><span style="font-style: italic;">' if possible."</span>
      (<span style="font-weight: bold;">interactive</span>)
      (<span style="font-weight: bold;">if</span> (not (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">async</span> nil t))
          (<span style="font-weight: bold;">unless</span> (active-minibuffer-window)
            (org-agenda-to-appt t '((headline <span style="font-style: italic;">"TODO"</span>))))
        (<span style="font-weight: bold;">when</span> my-org-agenda-to-appt-ready
          (<span style="font-weight: bold;">setq</span> my-org-agenda-to-appt-ready nil)
          (async-start
           `(<span style="font-weight: bold;">lambda</span> ()
              (<span style="font-weight: bold;">setq</span> org-agenda-files ',org-agenda-files)
              (org-agenda-to-appt t '((headline <span style="font-style: italic;">"TODO"</span>)))
              appt-time-msg-list)
           (<span style="font-weight: bold;">lambda</span> (result)
             (<span style="font-weight: bold;">setq</span> appt-time-msg-list result)
             (<span style="font-weight: bold;">unless</span> (active-minibuffer-window)
               (<span style="font-weight: bold;">let</span> ((cnt (length appt-time-msg-list)))
                 (<span style="font-weight: bold;">if</span> (eq cnt 0)
                     (message <span style="font-style: italic;">"[async] No event to add"</span>)
                   (message <span style="font-style: italic;">"[async] Added %d event%s for today"</span>
                            cnt (<span style="font-weight: bold;">if</span> (&gt; cnt 1) <span style="font-style: italic;">"s"</span> <span style="font-style: italic;">""</span>)))))
             (<span style="font-weight: bold;">setq</span> my-org-agenda-to-appt-ready t))))))
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#23450;&#26399;&#30340;&#12395;&#26356;&#26032;&#12377;&#12427;</span>
    (run-with-idle-timer 500 t 'my-org-agenda-to-appt)
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#12461;&#12515;&#12503;&#12481;&#12515;&#30452;&#24460;&#12395;&#26356;&#26032;</span>
    (add-hook 'org-capture-before-finalize-hook #'my-org-agenda-to-appt)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf5236175" class="outline-3">
<h3 id="orgf5236175"><span class="section-number-3">10.19</span> [org-refile] orgツリーの高速移動</h3>
<div class="outline-text-3" id="text-orgf5236175">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"org"</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#23653;&#27508;&#12364;&#29983;&#25104;&#12373;&#12428;&#12427;&#12398;&#12434;&#25233;&#21046;&#65294;</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">[2/3]&#12398;&#12424;&#12358;&#12394;&#23436;&#20102;&#25968;&#12364;&#35211;&#20986;&#12375;&#12395;&#12354;&#12427;&#26178;&#12395;&#36578;&#36865;&#20808;&#20505;&#35036;&#12364;&#37325;&#35079;&#34920;&#31034;&#12373;&#12428;&#12427;&#12383;&#12417;&#65294;</span>

  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#12522;&#12501;&#12449;&#12452;&#12523;&#20808;&#12391;&#12469;&#12502;&#12487;&#12451;&#12524;&#12463;&#12488;&#12522;&#12434;&#25351;&#23450;&#12377;&#12427;&#12383;&#12417;&#12395;&#19968;&#37096;&#12501;&#12523;&#12497;&#12473;&#21270;</span>
  (<span style="font-weight: bold;">let</span> ((dir (expand-file-name org-directory)))
    (<span style="font-weight: bold;">setq</span> org-refile-targets
          `((,(concat dir <span style="font-style: italic;">"next.org"</span>) <span style="font-weight: bold;">:level</span> . 1)
            (,(concat dir <span style="font-style: italic;">"org-ical.org"</span>) <span style="font-weight: bold;">:level</span> . 1)
            (,(concat dir <span style="font-style: italic;">"academic.org"</span>) <span style="font-weight: bold;">:level</span> . 1)
            (,(concat dir <span style="font-style: italic;">"tr/work.org"</span>) <span style="font-weight: bold;">:level</span> . 1)
            (,(concat dir <span style="font-style: italic;">"minutes/wg1.org"</span>) <span style="font-weight: bold;">:level</span> . 1)
            (,(concat dir <span style="font-style: italic;">"db/article.org"</span>) <span style="font-weight: bold;">:level</span> . 1)
            (,(concat dir <span style="font-style: italic;">"db/maybe.org"</span>) <span style="font-weight: bold;">:level</span> . 1)
            (,(concat dir <span style="font-style: italic;">"db/english.org"</span>) <span style="font-weight: bold;">:level</span> . 1)
            (,(concat dir <span style="font-style: italic;">"db/money.org"</span>) <span style="font-weight: bold;">:level</span> . 1))))

  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">ad:org-refile</span> (f <span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> arg default-buffer rfloc msg)
    <span style="font-style: italic;">"Extension to support keeping org-refile-history empty."</span>
    (<span style="font-weight: bold;">save-excursion</span>
      (<span style="font-weight: bold;">save-restriction</span>
        (<span style="font-weight: bold;">let</span> ((l (org-outline-level))
              (b (buffer-name)))
          (apply f arg default-buffer rfloc msg)
          (<span style="font-weight: bold;">if</span> (&gt; l (org-outline-level))
              (outline-backward-same-level 1)
            (outline-up-heading 1))
          (org-update-statistics-cookies nil) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Update in source</span>
          <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(org-sort-entries nil ?O)</span>
          (org-refile-goto-last-stored)
          (org-update-parent-todo-statistics) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Update in destination</span>
          (outline-up-heading 1)
          (org-sort-entries nil ?o)
          (<span style="font-weight: bold;">unless</span> (equal b (buffer-name))
            (switch-to-buffer b)))
        (<span style="font-weight: bold;">setq</span> org-refile-history nil)
        (org-refile-cache-clear))))
  (advice-add 'org-refile <span style="font-weight: bold;">:around</span> #'ad:org-refile)

  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">ad:org-sort-entries</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> _with-case _sorting-type
                                        _getkey-func _compare-func
                                        _property _interactive?)
    (outline-hide-subtree)
    (org-show-hidden-entry)
    (org-show-children)
    (org-cycle-hide-drawers 'children))
  (advice-add 'org-sort-entries <span style="font-weight: bold;">:after</span> #'ad:org-sort-entries))
</pre>
</div>
</div>
</div>

<div id="outline-container-org49ca5eb9" class="outline-3">
<h3 id="org49ca5eb9"><span class="section-number-3">10.20</span> [org-babel] Orgバッファでソースコードを扱う</h3>
<div class="outline-text-3" id="text-org49ca5eb9">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"ob-core"</span>
  (<span style="font-weight: bold;">setq</span> org-edit-src-content-indentation 0)
  (<span style="font-weight: bold;">setq</span> org-src-fontify-natively t)
  (<span style="font-weight: bold;">setq</span> org-src-tab-acts-natively t)
  (<span style="font-weight: bold;">setq</span> org-confirm-babel-evaluate nil)
  (<span style="font-weight: bold;">setq</span> org-src-window-setup 'current-window)
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">org-src-window-setup (current-window, other-window, other-frame)</span>
  (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">ob-http</span> nil t)
  (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">ob-gnuplot</span> nil t)
  (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">ob-octave</span> nil t)
  (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">ob-go</span> nil t)

  (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">and</span> (not noninteractive)
             (not (executable-find <span style="font-style: italic;">"ditaa"</span>)))
    (message <span style="font-style: italic;">"--- ditaa is NOT installed."</span>))

  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Add ":results output" after program name</span>

  (org-babel-do-load-languages
   'org-babel-load-languages
   '((emacs-lisp . t)
     (dot . t)
     (C . t)
     (ditaa . t)
     (perl . t)
     (shell . t)
     (latex . t)
     (sqlite . t)
     (<span style="font-weight: bold;">R</span> . t)
     (python . t)))

  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#23455;&#35013;&#28168;&#12415;&#12398;&#35328;&#35486;&#12395;&#22909;&#12365;&#12394;&#21517;&#21069;&#12434;&#32016;&#20184;&#12369;&#12427;</span>
  (add-to-list 'org-src-lang-modes '(<span style="font-style: italic;">"cs"</span> . csharp))
  (add-to-list 'org-src-lang-modes '(<span style="font-style: italic;">"zsh"</span> . sh)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc0ed68a2" class="outline-3">
<h3 id="orgc0ed68a2"><span class="section-number-3">10.21</span> [org-babel] ソースブロックの入力キーをカスタマイズ</h3>
<div class="outline-text-3" id="text-orgc0ed68a2">
<p>
ソースブロックを入力するときは， &lt;+ <code>TAB</code> でテンプレートを高速に入力できます．しかし，利用する言語までは指定できないので，特定の内容について対応するコマンドを割り当てて起きます．以下の例を設定として追加すると， &lt;S+ <code>TAB</code> で <code>emacs-lisp</code> を， &lt;C+ <code>TAB</code> でコメントブロックを指定できます．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"org"</span>
  (add-to-list 'org-structure-template-alist
               (<span style="font-weight: bold;">if</span> (version&lt; <span style="font-style: italic;">"9.1.4"</span> (org-version))
                   '(<span style="font-style: italic;">"S"</span> . <span style="font-style: italic;">"src emacs-lisp"</span>)
                 '(<span style="font-style: italic;">"S"</span> <span style="font-style: italic;">"#+begin_src emacs-lisp\n?\n#+END_SRC"</span> <span style="font-style: italic;">"&lt;src lang=\"emacs-lisp\"&gt;\n\n&lt;/src&gt;"</span>))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org556eb376" class="outline-3">
<h3 id="org556eb376"><span class="section-number-3">10.22</span> [org-babel] ソースブロックの配色</h3>
<div class="outline-text-3" id="text-org556eb376">
<p>
<code>org-src-block-faces</code>, <code>org-block-begin-line</code>, <code>org-block-end-line</code> をカスタマイズして，配色を変えます．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setq</span> org-src-block-faces
      '((<span style="font-style: italic;">"emacs-lisp"</span> (<span style="font-weight: bold;">:background</span> <span style="font-style: italic;">"cornsilk"</span>))))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"org"</span>
  (custom-set-faces
   '(org-block-begin-line
     ((((background dark))
       (<span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#669966"</span> <span style="font-weight: bold;">:weight</span> bold)) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">:background "#444444"</span>
      (t (<span style="font-weight: bold;">:inherit</span> org-meta-line <span style="font-weight: bold;">:weight</span> bold))) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">:background "#EFEFEF"</span>
     (org-block-end-line
      ((((background dark)) (<span style="font-weight: bold;">:inherit</span> org-block-begin-line))
       (t (<span style="font-weight: bold;">:inherit</span> org-block-begin-line)))))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org89c34f23" class="outline-3">
<h3 id="org89c34f23"><span class="section-number-3">10.23</span> [org-tree-slide] Org Modeでプレゼンテーション</h3>
<div class="outline-text-3" id="text-org89c34f23">
<p>
パワーポイントはもう使わなくてよいのです．
</p>

<ul class="org-ul">
<li><a href="https://pxaka.tokyo/wiki/doku.php?id=emacs:org-tree-slide">https://pxaka.tokyo/wiki/doku.php?id=emacs:org-tree-slide</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(org-tree-slide-mode)
       <span style="font-style: italic;">"org-tree-slide"</span> nil t)

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"postpone"</span>
    (global-set-key (kbd <span style="font-style: italic;">"&lt;f8&gt;"</span>) 'org-tree-slide-mode)
    (global-set-key (kbd <span style="font-style: italic;">"S-&lt;f8&gt;"</span>) 'org-tree-slide-skip-done-toggle))

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"org-tree-slide"</span>
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&lt;f8&gt;/&lt;f9&gt;/&lt;f10&gt;/&lt;f11&gt; are assigned to control org-tree-slide</span>
    (define-key org-tree-slide-mode-map (kbd <span style="font-style: italic;">"&lt;f9&gt;"</span>)
      'org-tree-slide-move-previous-tree)
    (define-key org-tree-slide-mode-map (kbd <span style="font-style: italic;">"&lt;f10&gt;"</span>)
      'org-tree-slide-move-next-tree)
    (<span style="font-weight: bold;">unless</span> noninteractive
      (org-tree-slide-narrowing-control-profile))
    (<span style="font-weight: bold;">setq</span> org-tree-slide-modeline-display 'outside)
    (<span style="font-weight: bold;">setq</span> org-tree-slide-skip-outline-level 5)
    (<span style="font-weight: bold;">setq</span> org-tree-slide-skip-done nil))

  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-reload-header-face</span> ()
    (face-spec-set 'org-tree-slide-header-overlay-face
                   `((t (<span style="font-weight: bold;">:bold</span> t <span style="font-weight: bold;">:foreground</span> ,(face-foreground 'default)
                               <span style="font-weight: bold;">:background</span> ,(face-background 'default))))))
  (add-hook 'org-tree-slide-play-hook #'my-reload-header-face))
</pre>
</div>

<p>
<code>Doing</code> タグのトグルに <code>f11</code> を割り当てたので，コンテンツモードへの切り替えは，異なるキーバインドに変更．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">#+begin_src emacs-lisp <span style="font-weight: bold;">:results</span> none
(<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"org-tree-slide"</span>
  (org-tree-slide-presentation-profile))
#+end_src
</pre>
</div>

<p>
これをプレゼンのヘッダに置いておけば，プロファイルの切り替えに便利です．
</p>
</div>

<div id="outline-container-org2e94f804" class="outline-4">
<h4 id="org2e94f804"><span class="section-number-4">10.23.1</span> doom-modeline との共存</h4>
<div class="outline-text-4" id="text-org2e94f804">
<p>
<code>doom-modeline</code> では <code>widen</code> を <code>advice</code> で拡張していますが， <code>org-tree-slide</code> から抜ける時に期待された効果が得られず， <code>narrowing</code> 状態を表すアイコンがモードロインに残ってしまいます．そこで <code>org-tree-slide-stop-hook</code> で明示的に処理します．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"org-tree-slide"</span>
  (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">and</span> (eq my-toggle-modeline-global 'doom)
             (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">doom-modeline</span> nil t))
    (add-hook 'org-tree-slide-stop-hook
              #'doom-modeline-update-buffer-file-state-icon)))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org264a37c5" class="outline-3">
<h3 id="org264a37c5"><span class="section-number-3">10.24</span> [org-tree-slide] クロックインとアウトを自動化する</h3>
<div class="outline-text-3" id="text-org264a37c5">
<p>
特定のファイルを編集している時， <code>org-tree-slide</code> でフォーカスしたら <code>org-clock-in</code> で時間計測を始めて，ナローイングを解く時や次のツリーに移る時に <code>org-clock-out</code> で計測を停止するように設定しています．基本的に <code>org-tree-slide</code> にあるhookに色々とぶら下げるだけです．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"org-tree-slide"</span>
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-tree-slide-autoclockin-p</span> ()
    (<span style="font-weight: bold;">save-excursion</span>
      (<span style="font-weight: bold;">save-restriction</span>
        (widen)
        (goto-char (point-min))
        (<span style="font-weight: bold;">let</span> ((keyword <span style="font-style: italic;">"TREE_SLIDE:"</span>)
              (value <span style="font-style: italic;">"autoclockin"</span>)
              (result nil))
          (<span style="font-weight: bold;">while</span>
              (<span style="font-weight: bold;">and</span> (re-search-forward (concat <span style="font-style: italic;">"^#\\+"</span> keyword <span style="font-style: italic;">"[ \t]*"</span>) nil t)
                   (re-search-forward value (point-at-eol) t))
            (<span style="font-weight: bold;">setq</span> result t))
          result))))

  (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">org-clock</span> nil t)
    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-org-clock-in</span> ()
      (<span style="font-weight: bold;">unless</span> (<span style="font-weight: bold;">bound-and-true-p</span> doom-modeline-mode)
        (<span style="font-weight: bold;">setq</span> vc-display-status nil)) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#12514;&#12540;&#12489;&#12521;&#12452;&#12531;&#31680;&#32004;</span>
      (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">and</span> (my-tree-slide-autoclockin-p)
                 (looking-at (concat <span style="font-style: italic;">"^\\*+ "</span> org-not-done-regexp))
                 (memq (org-outline-level) '(1 2 3 4)))
        (<span style="font-weight: bold;">save-excursion</span>
          (<span style="font-weight: bold;">save-restriction</span>
            (forward-line)
            (<span style="font-weight: bold;">when</span> (org-at-heading-p)
              (newline)))) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">FIXME: remove empty line if clock will not be recorded.</span>
        (org-clock-in)))

    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-org-clock-out</span> ()
      (<span style="font-weight: bold;">setq</span> vc-display-status t) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#12514;&#12540;&#12489;&#12521;&#12452;&#12531;&#31680;&#32004;&#35299;&#38500;</span>
      (<span style="font-weight: bold;">when</span> (org-clocking-p)
        (org-clock-out)))

    (add-hook 'org-tree-slide-before-move-next-hook #'my-org-clock-out)
    (add-hook 'org-tree-slide-before-move-previous-hook #'my-org-clock-out)
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(add-hook 'org-tree-slide-before-content-view-hook #'my-org-clock-out)</span>
    (add-hook 'org-tree-slide-stop-hook #'my-org-clock-out)
    (add-hook 'org-tree-slide-after-narrow-hook #'my-org-clock-in)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orga7162e8c" class="outline-3">
<h3 id="orga7162e8c"><span class="section-number-3">10.25</span> [org-tree-slide] 特定のツリーをプロポーショナルフォントで表示する</h3>
<div class="outline-text-3" id="text-orga7162e8c">
<p>
ツリーのプロパティに，プロポーショナルで表示するか否かの制御フラグを加えます．ツリーにフォーカス時に <code>PROPORTIONAL</code> 指定がプロパティにあると，そのツリーを動的にプロポーショナルフォントでレンダリングします．変更は下位ツリーの全てに継承しています．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(org-tree-slide-mode my-toggle-proportional-font)
       <span style="font-style: italic;">"org-tree-slide"</span> nil t)

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"org-tree-slide"</span>
    (<span style="font-weight: bold;">defcustom</span> <span style="font-weight: bold; font-style: italic;">use-proportional-font</span> nil
      <span style="font-style: italic;">"The status of FONT property"</span>
      <span style="font-weight: bold;">:type</span> 'boolean
      <span style="font-weight: bold;">:group</span> 'org-mode)

    (set-face-attribute 'variable-pitch nil
                        <span style="font-weight: bold;">:family</span> <span style="font-style: italic;">"Verdana"</span>
                        <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">:family "Comic Sans MS"</span>
                        <span style="font-weight: bold;">:height</span> 125)

    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-toggle-proportional-font</span> ()
      (<span style="font-weight: bold;">interactive</span>)
      (<span style="font-weight: bold;">setq</span> use-proportional-font (not use-proportional-font))
      (<span style="font-weight: bold;">if</span> use-proportional-font
          (org-entry-put nil <span style="font-style: italic;">"FONT"</span> <span style="font-style: italic;">"PROPORTIONAL"</span>)
        (org-delete-property <span style="font-style: italic;">"FONT"</span>)))

    (add-hook 'org-tree-slide-before-narrow-hook
              (<span style="font-weight: bold;">lambda</span> ()
                  (<span style="font-weight: bold;">if</span> (equal <span style="font-style: italic;">"PROPORTIONAL"</span>
                             (org-entry-get-with-inheritance <span style="font-style: italic;">"FONT"</span>))
                      (buffer-face-set 'variable-pitch)
                    (buffer-face-mode 0))))
    (add-hook 'org-tree-slide-stop-hook
              (<span style="font-weight: bold;">lambda</span> ()
                  (buffer-face-mode 0)))))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf5c603e5" class="outline-3">
<h3 id="orgf5c603e5"><span class="section-number-3">10.26</span> [org-tree-slide] ヘッドラインをリッチにする</h3>
<div class="outline-text-3" id="text-orgf5c603e5">
<p>
<code>org-tree-slide</code> が有効な時だけ <code>org-bullets</code> を有効にして，ヘッドラインをリッチにします．元ネタは， <code>org-beautify-theme.el</code> です．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(org-bullets-mode)
       <span style="font-style: italic;">"org-bullets"</span> nil t)

  (add-hook 'org-tree-slide-play-hook (<span style="font-weight: bold;">lambda</span> () (org-bullets-mode 1)))
  (add-hook 'org-tree-slide-stop-hook (<span style="font-weight: bold;">lambda</span> () (org-bullets-mode -1))))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgae555619" class="outline-3">
<h3 id="orgae555619"><span class="section-number-3">10.27</span> [calfw-org.el] calfw に org の予定を表示する</h3>
<div class="outline-text-3" id="text-orgae555619">
<p>
org-mode の表のようにフェイスを統一しています． <code>calfw</code> を起動する時に，自動的にフレームサイズを拡大するような独自関数をぶら下げています．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(my-cfw-open-org-calendar cfw:open-org-calendar)
       <span style="font-style: italic;">"calfw-org"</span> <span style="font-style: italic;">"Rich calendar for org-mode"</span> t)

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"postpone"</span>
    (global-set-key (kbd <span style="font-style: italic;">"C-c f c w"</span>) 'my-cfw-open-org-calendar))

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"calfw-org"</span>
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">icalendar &#12392;&#12398;&#36899;&#32080;</span>
    (custom-set-variables
     '(cfw:org-icalendars '(<span style="font-style: italic;">"~/Dropbox/org/org-ical.org"</span>))
     '(cfw:fchar-junction ?+) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">org &#12391;&#20351;&#12358;&#34920;&#12395;&#12501;&#12455;&#12452;&#12473;&#12434;&#32113;&#19968;</span>
     '(cfw:fchar-vertical-line ?|)
     '(cfw:fchar-horizontal-line ?-)
     '(cfw:fchar-left-junction ?|)
     '(cfw:fchar-right-junction ?|)
     '(cfw:fchar-top-junction ?+)
     '(cfw:fchar-top-left-corner ?|)
     '(cfw:fchar-top-right-corner ?|))

    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-org-mark-ring-goto-calfw</span> ()
      (<span style="font-weight: bold;">interactive</span>)
      (org-mark-ring-goto))

    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-cfw-open-org-calendar</span> ()
      (<span style="font-weight: bold;">interactive</span>)
      (moom-change-frame-width-double)
      (cfw:open-org-calendar))

    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-cfw-burry-buffer</span> ()
      (<span style="font-weight: bold;">interactive</span>)
      (bury-buffer)
      (moom-change-frame-width-single))

    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">cfw:org-goto-date</span> ()
      <span style="font-style: italic;">"Move the cursor to the specified date."</span>
      (<span style="font-weight: bold;">interactive</span>)
      (cfw:navi-goto-date
       (cfw:emacs-to-calendar (org-read-date nil 'to-time))))

    (define-key cfw:calendar-mode-map (kbd <span style="font-style: italic;">"j"</span>) 'cfw:org-goto-date)
    (define-key cfw:org-schedule-map (kbd <span style="font-style: italic;">"q"</span>) 'my-cfw-burry-buffer)))

<span style="font-weight: bold; font-style: italic;">;;         </span><span style="font-weight: bold; font-style: italic;">(add-hook 'window-configuration-change-hook #'cfw:resize-calendar)</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(defun cfw:resize-calendar ()</span>
<span style="font-weight: bold; font-style: italic;">;;   </span><span style="font-weight: bold; font-style: italic;">(interactive)</span>
<span style="font-weight: bold; font-style: italic;">;;   </span><span style="font-weight: bold; font-style: italic;">(when (eq major-mode 'cfw:calendar-mode)</span>
<span style="font-weight: bold; font-style: italic;">;;     </span><span style="font-weight: bold; font-style: italic;">(cfw:refresh-calendar-buffer nil)</span>
<span style="font-weight: bold; font-style: italic;">;;     </span><span style="font-weight: bold; font-style: italic;">(message "Calendar resized.")))</span>

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(defun open-calfw-agenda-org ()</span>
<span style="font-weight: bold; font-style: italic;">;;   </span><span style="font-weight: bold; font-style: italic;">(interactive)</span>
<span style="font-weight: bold; font-style: italic;">;;   </span><span style="font-weight: bold; font-style: italic;">(cfw:open-org-calendar))</span>

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(setq org-agenda-custom-commands</span>
<span style="font-weight: bold; font-style: italic;">;;       </span><span style="font-weight: bold; font-style: italic;">'(("w" todo "FOCUS")</span>
<span style="font-weight: bold; font-style: italic;">;;         </span><span style="font-weight: bold; font-style: italic;">("G" open-calfw-agenda-org "Graphical display in calfw"))))))</span>

</pre>
</div>
</div>
</div>

<div id="outline-container-org02100a39" class="outline-3">
<h3 id="org02100a39"><span class="section-number-3">10.28</span> [org-odt] ODT形式に出力</h3>
<div class="outline-text-3" id="text-org02100a39">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(ox-odt)
       <span style="font-style: italic;">"ox-odt"</span> nil t)

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"ox-odt"</span>
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(add-to-list 'org-odt-data-dir</span>
    <span style="font-weight: bold; font-style: italic;">;;              </span><span style="font-weight: bold; font-style: italic;">(concat (getenv "HOME") "/Dropbox/emacs.d/config/"))</span>
    (<span style="font-weight: bold;">setq</span> org-odt-styles-file
          (concat (getenv <span style="font-style: italic;">"SYNCROOT"</span>) <span style="font-style: italic;">"/emacs.d/config/style.odt"</span>))
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(setq org-odt-content-template-file</span>
    <span style="font-weight: bold; font-style: italic;">;;       </span><span style="font-weight: bold; font-style: italic;">(concat (getenv "HOME") "/Dropbox/emacs.d/config/style.ott"))</span>
    (<span style="font-weight: bold;">setq</span> org-odt-preferred-output-format <span style="font-style: italic;">"pdf"</span>) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">docx</span>
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">;; ox-odt.el &#12398; &#33258;&#20316;&#12497;&#12483;&#12481;&#12398;&#22793;&#25968;&#65288;DOCSTRING&#12364;&#35352;&#36848;&#12373;&#12428;&#12390;&#12356;&#12394;&#12356;&#65289;</span>
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(setq org-odt-apply-custom-punctuation t)</span>
    (<span style="font-weight: bold;">setq</span> org-odt-convert-processes
          '((<span style="font-style: italic;">"LibreOffice"</span>
             <span style="font-style: italic;">"/Applications/LibreOffice.app/Contents/MacOS/soffice --headless --convert-to %f%x --outdir %d %i"</span>)
            (<span style="font-style: italic;">"unoconv"</span> <span style="font-style: italic;">"unoconv -f %f -o %d %i"</span>)))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org02d2c3de" class="outline-3">
<h3 id="org02d2c3de"><span class="section-number-3">10.29</span> [ox-twbs] Twitter Bootstrap 互換のHTML出力</h3>
<div class="outline-text-3" id="text-org02d2c3de">
<ul class="org-ul">
<li><a href="https://github.com/marsmining/ox-twbs">marsmining/ox-twbs: Export org-mode docs as HTML compatible with Twitter Bootstrap.</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"ox"</span>
  (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">ox-twbs</span> nil t))
</pre>
</div>

<p>
次のようなファイルを準備して org ファイルのヘッダで指定（ <code>#+setupfile: theme-readtheorg.setup</code> ）するだけで， <a href="https://takaxp.github.io/">https://takaxp.github.io/</a> のような HTML 出力もできます．
</p>

<ul class="org-ul">
<li><a href="https://lists.gnu.org/archive/html/emacs-orgmode/2016-06/msg00119.html">{O} Org HTML export (ReadTheOrg)</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-org" id="orge8f041a"><span style="font-weight: bold; font-style: italic;"># -*- mode: org; -*-</span>

<span style="font-weight: bold; font-style: italic;">#+html_head: &lt;link rel="stylesheet" type="text/css" href="<a href="https://www.pirilampo.org/styles/readtheorg/css/htmlize.css&quot;/">https://www.pirilampo.org/styles/readtheorg/css/htmlize.css"/</a>&gt;</span>
<span style="font-weight: bold; font-style: italic;">#+html_head: &lt;link rel="stylesheet" type="text/css" href="<a href="https://www.pirilampo.org/styles/readtheorg/css/readtheorg.css&quot;/">https://www.pirilampo.org/styles/readtheorg/css/readtheorg.css"/</a>&gt;</span>

<span style="font-weight: bold; font-style: italic;">#+html_head: &lt;script src="<a href="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js">https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js</a>"&gt;&lt;/script&gt;</span>
<span style="font-weight: bold; font-style: italic;">#+html_head: &lt;script src="<a href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js">https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js</a>"&gt;&lt;/script&gt;</span>
<span style="font-weight: bold; font-style: italic;">#+html_head: &lt;script type="text/javascript" src="<a href="https://www.pirilampo.org/styles/lib/js/jquery.stickytableheaders.min.js">https://www.pirilampo.org/styles/lib/js/jquery.stickytableheaders.min.js</a>"&gt;&lt;/script&gt;</span>
<span style="font-weight: bold; font-style: italic;">#+html_head: &lt;script type="text/javascript" src="<a href="https://www.pirilampo.org/styles/readtheorg/js/readtheorg.js">https://www.pirilampo.org/styles/readtheorg/js/readtheorg.js</a>"&gt;&lt;/script&gt;</span>
</pre>
</div>

<p>
また， <code>(org-html-htmlize-generate-css)</code> を使うとCSSを生成できます．
</p>
</div>
</div>

<div id="outline-container-org5a1cb1a1" class="outline-3">
<h3 id="org5a1cb1a1"><span class="section-number-3">10.30</span> [org-crypt] ツリーを暗号化する</h3>
<div class="outline-text-3" id="text-org5a1cb1a1">
<p>
<code>M-x org-encrypt-entry</code> でカーソル位置のツリーを暗号化できます．復号は， <code>M-x org-decrypt-entry</code> にて．ただし，バッファのバックアップファイルが生成されていることに気をつけてください．自分の場合は，バックアップファイルは外部ホストに同期されない設定にしてあるので，とりあえず問題なしと考えています．
</p>

<p>
<code>M-x org-encrypt-entries</code> で，特定のタグが付けられたツリーを一括処理することもできますが，私は安全性を考慮して使っていません．
</p>

<p>
なお，実戦投入には十分なテストをしてからの方がよいでしょう．org バッファを外部ホストと同期している場合，転送先のホストでも暗号化／復号ができるかを確認するべきです．他方のホストでツリーにドロワーが付くと，復号できなくなったりします．その時は慌てずにプロパティのドロワーを削除すればOKです．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"org"</span>
  (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">org-crypt</span> nil t)
    (<span style="font-weight: bold;">setq</span> org-crypt-key <span style="font-style: italic;">""</span>) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&lt;insert your key&gt;</span>
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">org-encrypt-entries &#12398;&#24433;&#38911;&#12434;&#21463;&#12369;&#12427;&#12479;&#12464;&#12434;&#25351;&#23450;</span>
    (<span style="font-weight: bold;">setq</span> org-tags-exclude-from-inheritance (<span style="font-weight: bold;">quote</span> (<span style="font-style: italic;">"secret"</span>)))
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#33258;&#21205;&#20445;&#23384;&#12398;&#30906;&#35469;&#12434;&#28961;&#21177;&#12395;</span>
    (<span style="font-weight: bold;">setq</span> org-crypt-disable-auto-save 'nil)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org01951291" class="outline-3">
<h3 id="org01951291"><span class="section-number-3">10.31</span> [org-mac-link] 外部アプリから情報を取る</h3>
<div class="outline-text-3" id="text-org01951291">
<p>
<code>org-mac-link</code> を使うと，外部アプリの表示状態をリンクとして取得して，orgバッファに流し込めます．Mac環境用です．簡単な例ではURLで，取得したリンクを <code>C-c C-o</code> で開けばブラウザが起動してリンク先が表示できます．同じ話を，ファインダーで表示しているディレクトリ，メーラーで表示していた特定のメール，PDFビューアで表示していた特定のファイルの特定のページなどで実施できます．対応している外部アプリは，Finder, Mail.app, Outlook, Addressbook, Safari, Firefox, Chrome, そして Skimです．
</p>

<p>
次のように設定すると，org-modeの時に <code>C-c c</code> すればミニバッファにどのアプリからリンク情報を取るか選べます．Chrome には <code>c</code> が当たっているので，ブラウジング中に記になる記事があったらEmacsに切り替えて， <code>C-c c c</code> とすると，URLが自動でバッファに入ります．単なるURLではなく，タイトルで表示されるのでわかりやすいです．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"org"</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(add-to-list 'org-modules 'org-mac-iCal)</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(add-to-list 'org-modules 'org-mac-link) ;; includes org-mac-message</span>
  (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">and</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">org-mac-iCal</span> nil t)
             (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">org-mac-link</span> nil t))
    (define-key org-mode-map (kbd <span style="font-style: italic;">"C-c c"</span>) 'org-mac-grab-link)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb3ae0aea" class="outline-3">
<h3 id="orgb3ae0aea"><span class="section-number-3">10.32</span> [org-download] org バッファにD&amp;Dでファイルを保存</h3>
<div class="outline-text-3" id="text-orgb3ae0aea">
<p>
<code>org-attach</code> とペアで使うのが良いでしょう．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"org"</span>
  (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">org-download</span> nil t)
    (<span style="font-weight: bold;">setq</span> org-download-screenshot-method 'screencapture)
    (<span style="font-weight: bold;">setq</span> org-download-method 'attach)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org97c39f96" class="outline-3">
<h3 id="org97c39f96"><span class="section-number-3">10.33</span> [org-grep] org ファイルを grep する</h3>
<div class="outline-text-3" id="text-org97c39f96">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(org-grep)
       <span style="font-style: italic;">"org-grep"</span> nil t)

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"postpone"</span>
    (global-set-key (kbd <span style="font-style: italic;">"C-M-g"</span>) 'org-grep))

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"org-grep"</span>
    (<span style="font-weight: bold;">setq</span> org-grep-extensions '(<span style="font-style: italic;">".org"</span> <span style="font-style: italic;">".org_archive"</span>))
    (add-to-list 'org-grep-directories <span style="font-style: italic;">"~/.emacs.d"</span>)
    (add-to-list 'org-grep-directories <span style="font-style: italic;">"~/.emacs.d/.cask/package"</span>)

    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">"q"&#25276;&#19979;&#12398;&#25369;&#21205;&#12434;&#35519;&#25972;</span>
    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">ad:org-grep-quit</span> ()
      (<span style="font-weight: bold;">interactive</span>)
      (delete-window))
    (advice-add 'org-grep-quit <span style="font-weight: bold;">:override</span> #'ad:org-grep-quit)

    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">for macOS</span>
    (<span style="font-weight: bold;">when</span> (memq window-system '(mac ns))
      (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">org-grep-from-org-shell-command</span> (regexp)
        (<span style="font-weight: bold;">if</span> org-grep-directories
            (concat <span style="font-style: italic;">"find -E "</span>
                    (<span style="font-weight: bold;">if</span> org-grep-directories
                        (mapconcat #'identity org-grep-directories <span style="font-style: italic;">" "</span>)
                      org-directory)
                    (<span style="font-weight: bold;">and</span> org-grep-extensions
                         (concat <span style="font-style: italic;">" -regex '.*("</span>
                                 (mapconcat #'regexp-quote org-grep-extensions
                                            <span style="font-style: italic;">"|"</span>)
                                 <span style="font-style: italic;">")$'"</span>))
                    <span style="font-style: italic;">" -print0 | xargs -0 grep "</span> org-grep-grep-options
                    <span style="font-style: italic;">" -n -- "</span> (shell-quote-argument regexp))
          <span style="font-style: italic;">":"</span>)))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org1a7c192b" class="outline-3">
<h3 id="org1a7c192b"><span class="section-number-3">10.34</span> [ox-reveal] ナイスなHTML5プレゼンテーション出力</h3>
<div class="outline-text-3" id="text-org1a7c192b">
<p>
<code>C-c C-e R</code> エクスポータを呼び出せます．続けて <code>B</code> を押せば，ブラウザで出力後の見た目を確認できます．ただし別途 <a href="https://github.com/hakimel/reveal.js">reveal.js</a> が使える状態にないとダメです． <code>org-reveal-root</code> を設定すれば，clone した reveal.js の場所を指定できます．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"ox"</span>
  (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">and</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">ox-reveal</span> nil t)
             (version&lt; <span style="font-style: italic;">"9.1.4"</span> (org-version)))
    (<span style="font-weight: bold;">setq</span> org-reveal-note-key-char ?n)))
</pre>
</div>

<p>
それ以外にも <a href="https://github.com/cybercode/org-slides">ox-s5</a>，<a href="https://github.com/coldnew/org-ioslide">org-ioslide</a> があります．
</p>
</div>
</div>

<div id="outline-container-org383ff638" class="outline-3">
<h3 id="org383ff638"><span class="section-number-3">10.35</span> [org-dashboard] 進捗をプログレスバーで確認</h3>
<div class="outline-text-3" id="text-org383ff638">
<ul class="org-ul">
<li><a href="https://github.com/bard/org-dashboard">https://github.com/bard/org-dashboard</a></li>
<li>日本語だとバーの表示位置がずれるので修正．PR反映済み．</li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(org-dashboard-display)
       <span style="font-style: italic;">"org-dashboard"</span> nil t)

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"org"</span>
    (define-key org-mode-map (kbd <span style="font-style: italic;">"C-c f y"</span>) 'org-dashboard-display)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfa6df2ce" class="outline-3">
<h3 id="orgfa6df2ce"><span class="section-number-3">10.36</span> [org-clock-today] 今日の総作業時間をモードラインに表示</h3>
<div class="outline-text-3" id="text-orgfa6df2ce">
<ul class="org-ul">
<li><code>CLOCK_MODELINE_TOTAL</code> を設定するのとは別なアプローチ</li>
<li>clock が動いている時だけモードラインに合計値が表示される</li>
<li><a href="https://github.com/mallt/org-clock-today-mode">mallt/org-clock-today-mode: Emacs minor mode to show the total clocked time of the current day in the mode line</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"org-clock-today"</span>
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-print-working-clocks</span> ()
    (<span style="font-weight: bold;">interactive</span>)
    (<span style="font-weight: bold;">let</span> ((clocked-item (org-duration-from-minutes
                         (org-clock-get-clocked-time))))
      (<span style="font-weight: bold;">if</span> org-clock-today-mode
          (message <span style="font-style: italic;">"Today Subtree %s Total %s | Past %s"</span>
                   org-clock-today--buffer-time
                   org-clock-today--subtree-time
                   clocked-item)
        (message <span style="font-style: italic;">"Past %s"</span> clocked-item)))))

(<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"org-clock"</span>
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">ad:org-clock-sum-today</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> headline-filter)
    <span style="font-style: italic;">"Sum the times for each subtree for today."</span>
    (<span style="font-weight: bold;">let</span> ((range (org-clock-special-range 'today nil t))) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">TZ&#32771;&#24942;</span>
      (org-clock-sum (car range) (cadr range)
                     headline-filter <span style="font-weight: bold;">:org-clock-minutes-today</span>)))
  (advice-add 'org-clock-sum-today <span style="font-weight: bold;">:override</span> #'ad:org-clock-sum-today)

  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">using folked package</span>
  (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">org-clock-today</span> nil t)
    (<span style="font-weight: bold;">unless</span> noninteractive
      (<span style="font-weight: bold;">setq</span> org-clock-today-count-subtree t)
      (org-clock-today-mode 1))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org56b60c02" class="outline-3">
<h3 id="org56b60c02"><span class="section-number-3">10.37</span> [org-random-todo] ランダムにタスクを選ぶ</h3>
<div class="outline-text-3" id="text-org56b60c02">
<ul class="org-ul">
<li>デフォルトで <code>org-agenda-files</code> に登録されたファイルからランダムにタスクを選ぶ</li>
<li>org-random-todo はミニバッファに選択したタスクを表示するだけ．</li>
<li>org-random-todo-goto-current 最後に表示したタスクに移動する．</li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(autoload-if-found
 '(org-random-todo org-random-todo-goto-current)
 <span style="font-style: italic;">"org-random-todo"</span> nil t)
</pre>
</div>
</div>
</div>

<div id="outline-container-org0cba1e62" class="outline-3">
<h3 id="org0cba1e62"><span class="section-number-3">10.38</span> [ox-hugo] OrgファイルからHogoの記事をエクスポートする</h3>
<div class="outline-text-3" id="text-org0cba1e62">
<ul class="org-ul">
<li>Org Mode でブログを書いて， <a href="https://gohugo.io/">Hugo</a>で静的サイトに出力します．</li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">see https://ox-hugo.scripter.co/doc/deprecation-notices/#org-hugo-auto-export-feature-now-a-minor-mode</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(with-eval-after-load "org"</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">No need for latest ox-hugo</span>
<span style="font-weight: bold; font-style: italic;">;;   </span><span style="font-weight: bold; font-style: italic;">;; Require ox-hugo-auto-export.el explictly before loading ox-hugo.el</span>
<span style="font-weight: bold; font-style: italic;">;;   </span><span style="font-weight: bold; font-style: italic;">(require 'ox-hugo-auto-export nil t))</span>

(<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"org"</span>
  (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">ox-hugo</span> nil t)
    (<span style="font-weight: bold;">setq</span> org-hugo-auto-set-lastmod nil) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">see my-hugo-export-md</span>
    (<span style="font-weight: bold;">setq</span> org-hugo-suppress-lastmod-period 86400.0) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">1 day</span>
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">never copy files to under /static/ directory</span>
    (<span style="font-weight: bold;">setq</span> org-hugo-external-file-extensions-allowed-for-copying nil)

    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">see https://pxaka.tokyo/blog/2018/a-link-to-the-original-org-source-file</span>
    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">org-hugo-get-link-to-orgfile</span> (uri alt)
      <span style="font-style: italic;">"Return a formatted link to the original Org file.</span>
<span style="font-style: italic;">To insert the formatted into an org buffer for Hugo, use an appropriate</span>
<span style="font-style: italic;">macro, e.g. {{{srclink}}}.</span>

<span style="font-style: italic;">Note that this mechanism is still under consideration."</span>
      (<span style="font-weight: bold;">let</span> ((line (<span style="font-weight: bold;">save-excursion</span>
                    (<span style="font-weight: bold;">save-restriction</span>
                      (<span style="font-weight: bold;">unless</span> (org-at-heading-p)
                        (org-previous-visible-heading 1))
                      (line-number-at-pos)))))
        (concat <span style="font-style: italic;">"[["</span> uri (file-name-nondirectory (buffer-file-name))
                <span style="font-style: italic;">"#L"</span> (format <span style="font-style: italic;">"%d"</span> line) <span style="font-style: italic;">"]["</span> alt <span style="font-style: italic;">"]]"</span>)))

    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-add-ox-hugo-lastmod</span> ()
      <span style="font-style: italic;">"Add `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">lastmod</span><span style="font-style: italic;">' property with the current time."</span>
      (<span style="font-weight: bold;">interactive</span>)
      (org-set-property <span style="font-style: italic;">"EXPORT_HUGO_LASTMOD"</span>
                        (format-time-string <span style="font-style: italic;">"[%Y-%m-%d %a %H:%M]"</span>)))

    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">ad:ox-hugo:org-todo</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> ARG)
      <span style="font-style: italic;">"Export subtree for Hugo if the TODO status in ARG is changing to DONE."</span>
      (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">and</span> (equal (buffer-name) <span style="font-style: italic;">"imadenale.org"</span>)
                 <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">FIXME C-c C-t d &#12395;&#21453;&#24540;&#12375;&#12394;&#12356;&#65294;speed command &#12399;OK&#65294;</span>
                 (<span style="font-weight: bold;">or</span> (eq ARG 'done)
                     (equal ARG <span style="font-style: italic;">"DONE"</span>)))
        (org-hugo-export-wim-to-md)
        (message <span style="font-style: italic;">"[ox-hugo] \"%s\" has been exported."</span>
                 (nth 4 (org-heading-components)))
        (<span style="font-weight: bold;">let</span> ((command <span style="font-style: italic;">"/Users/taka/Dropbox/scripts/push-hugo.sh"</span>))
          (<span style="font-weight: bold;">if</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">async</span> nil t)
              (async-start
               `(<span style="font-weight: bold;">lambda</span> () (shell-command-to-string ',command)))
            (shell-command-to-string command)))))
<span style="font-weight: bold; font-style: italic;">;;    </span><span style="font-weight: bold; font-style: italic;">(advice-add 'org-todo :after #'ad:ox-hugo:org-todo)</span>
    ))
</pre>
</div>
</div>
</div>

<div id="outline-container-org32e931e3" class="outline-3">
<h3 id="org32e931e3"><span class="section-number-3">10.39</span> [ox-html] HTML見出しへのリンクを固定する</h3>
<div class="outline-text-3" id="text-org32e931e3">
<p>
標準の設定でHTMLを出力すると，各見出しへのリンクとして <code>org0123456</code> のようなIDが振られる．しかしそれらのIDは，HTMLを出力するたびに更新されるため，出力したHTMLの見出しをパーマリンクとして使用できない．これを防ぐためには，プロパティで <code>CUSTOM_ID</code> を指定する必要がある．
</p>

<p>
これを簡単にするための補助関数が公開されている．この<a href="https://writequit.org/articles/emacs-org-mode-generate-ids.html">元ネタ</a>を参考に，少し改良して使用している．なお元ネタでは標準の <code>org-id-new</code> を直接利用しているが，以下の実装では， <code>org</code> の後ろにUUIDの先頭8桁が続くように，IDの内容に制限をかけている．
</p>

<p>
<code>my-add-org-ids-to-headlines-in-file</code> は，バッファの保存時点，或いは，HTMLエクスポートが走る直前のタイミングで自動実行させるのがスマートだが，当面は手動で運用する．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"org"</span>
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-add-custom-id</span> ()
    <span style="font-style: italic;">"Add \"CUSTOM_ID\" to the current tree if not assigned yet."</span>
    (<span style="font-weight: bold;">interactive</span>)
    (my-org-custom-id-get nil t))

  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-get-custom-id</span> ()
    <span style="font-style: italic;">"Return a part of UUID with an \"org\" prefix.</span>
<span style="font-style: italic;">e.g. \"org3ca6ef0c\"."</span>
    (<span style="font-weight: bold;">let*</span> ((id (org-id-new <span style="font-style: italic;">""</span>)))
      (<span style="font-weight: bold;">when</span> (org-uuidgen-p id)
        (downcase (concat <span style="font-style: italic;">"org"</span>  (substring (org-id-new <span style="font-style: italic;">""</span>) 0 8))))))

  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-org-custom-id-get</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> pom create)
    <span style="font-style: italic;">"Get the CUSTOM_ID property of the entry at point-or-marker POM.</span>
<span style="font-style: italic;">If POM is nil, refer to the entry at point.  If the entry does</span>
<span style="font-style: italic;">not have an CUSTOM_ID, the function returns nil.  However, when</span>
<span style="font-style: italic;">CREATE is non nil, create a CUSTOM_ID if none is present</span>
<span style="font-style: italic;">already.  In any case, the CUSTOM_ID of the entry is returned.</span>

<span style="font-style: italic;">See https://writequit.org/articles/emacs-org-mode-generate-ids.html"</span>
    (<span style="font-weight: bold;">interactive</span>)
    (<span style="font-weight: bold;">org-with-point-at</span> pom
      (<span style="font-weight: bold;">let</span> ((id (org-entry-get nil <span style="font-style: italic;">"CUSTOM_ID"</span>)))
        (<span style="font-weight: bold;">cond</span>
         ((<span style="font-weight: bold;">and</span> id (stringp id) (string-match <span style="font-style: italic;">"\\S-"</span> id))
          id)
         (create
          (<span style="font-weight: bold;">setq</span> id (my-get-custom-id))
          (<span style="font-weight: bold;">unless</span> id
            (<span style="font-weight: bold;">error</span> <span style="font-style: italic;">"Invalid ID"</span>))
          (org-entry-put pom <span style="font-style: italic;">"CUSTOM_ID"</span> id)
          (message <span style="font-style: italic;">"--- CUSTOM_ID assigned: %s"</span> id)
          (org-id-add-location id (buffer-file-name (buffer-base-buffer)))
          id)))))

  <span style="font-weight: bold; font-style: italic;">;;;</span><span style="font-weight: bold; font-style: italic;">###autoload</span>
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-add-org-ids-to-headlines-in-file</span> ()
    <span style="font-style: italic;">"Add CUSTOM_ID properties to all headlines in the current file.</span>
<span style="font-style: italic;">Which do not already have one.  Only adds ids if the</span>
<span style="font-style: italic;">`</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">auto-id</span><span style="font-style: italic;">' option is set to `t' in the file somewhere. ie,</span>
<span style="font-style: italic;">#+options: auto-id:t</span>

<span style="font-style: italic;">See https://writequit.org/articles/emacs-org-mode-generate-ids.html"</span>
    (<span style="font-weight: bold;">interactive</span>)
    (<span style="font-weight: bold;">save-excursion</span>
      (widen)
      (goto-char (point-min))
      (<span style="font-weight: bold;">when</span> (re-search-forward <span style="font-style: italic;">"^#\\+options:.*auto-id:t"</span> (point-max) t)
        (org-map-entries
         (<span style="font-weight: bold;">lambda</span> () (my-org-custom-id-get (point) 'create))))))

  (<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">md-link-format</span> <span style="font-style: italic;">"^!\\[</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">.+</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">\\](</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">(</span><span style="font-style: italic;">.+</span><span style="font-weight: bold; font-style: italic;">\\</span><span style="font-weight: bold; font-style: italic;">)</span><span style="font-style: italic;">)$"</span>)
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-convert-md-link-to-html</span> ()
    (<span style="font-weight: bold;">interactive</span>)
    (goto-char (point-min))
    (<span style="font-weight: bold;">while</span> (re-search-forward md-link-format nil <span style="font-weight: bold;">:noerror</span>)
      (<span style="font-weight: bold;">let*</span> ((prev (match-string-no-properties 0))
             (alt (match-string-no-properties 1))
             (src (match-string-no-properties 2))
             (new (concat <span style="font-style: italic;">"&lt;p&gt;&lt;img src=\""</span> src <span style="font-style: italic;">"\" alt=\""</span> alt <span style="font-style: italic;">"\" /&gt;&lt;/p&gt;"</span>)))
        (replace-match new)
        (message <span style="font-style: italic;">"====\ninput:\t%s\noutput:\t%s"</span> prev new)))
    (message <span style="font-style: italic;">"--- done."</span>)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orga114da46" class="outline-3">
<h3 id="orga114da46"><span class="section-number-3">10.40</span> [org-id.el] プロパティに ID を入れる</h3>
<div class="outline-text-3" id="text-orga114da46">
<p>
<code>org.el</code> に付属している <code>org-id.el</code> を使うと，各 heading のプロパティにユニークな id を付与できます．また， <code>org-clock-in</code> で工数計測を開始すると，自動的に付与されます．しかし， heading を不用意にコピペすると，id が重複するので，それらを削除するユーティリティを準備しました．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"org"</span>
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-delete-all-id-in-file</span> ()
    (<span style="font-weight: bold;">interactive</span>)
    (goto-char 1)
    (<span style="font-weight: bold;">while</span> (not (eq (point) (point-max)))
      (org-next-visible-heading 1)
      (<span style="font-weight: bold;">let</span> ((id (org-entry-get (point) <span style="font-style: italic;">"ID"</span>)))
        (<span style="font-weight: bold;">when</span> id
          (message <span style="font-style: italic;">"ID: %s"</span> id)
          (org-delete-property <span style="font-style: italic;">"ID"</span>))))
    (message <span style="font-style: italic;">"--- done."</span>)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org5cc51a8d" class="outline-3">
<h3 id="org5cc51a8d"><span class="section-number-3">10.41</span> [orglink.el] Orgファイル以外でリンクを使う</h3>
<div class="outline-text-3" id="text-org5cc51a8d">
<p>
指定したモードのバッファで， <code>org mode</code> と同じリンク機能を使えるようにします．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(orglink-mode global-orglink-mode my-orglink-mode-activate)
       <span style="font-style: italic;">"orglink"</span> nil t)

  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-orglink-mode-activate</span> ()
    (orglink-mode 1)
    (<span style="font-weight: bold;">setq</span> orglink-mode-lighter <span style="font-style: italic;">""</span>)
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#12496;&#12483;&#12501;&#12449;&#12525;&#12540;&#12459;&#12523;&#12395;&#33394;&#12388;&#12369;&#12434;&#28040;&#12377;</span>
    (face-remap-add-relative 'org-link
                             <span style="font-weight: bold;">:underline</span> nil
                             <span style="font-weight: bold;">:inherit</span> font-lock-comment-delimiter-face))

  (<span style="font-weight: bold;">dolist</span> (hook '(emacs-lisp-mode-hook c-mode-common-hook yatex-mode))
    (add-hook hook #'my-orglink-mode-activate))

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"orglink"</span>
    (delq 'angle orglink-activate-links)
    (define-key orglink-mouse-map (kbd <span style="font-style: italic;">"C-c C-o"</span>) 'org-open-at-point-global)
    (define-key orglink-mouse-map (kbd <span style="font-style: italic;">"C-c C-l"</span>) 'org-insert-link)))

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(add-to-list 'orglink-activate-in-modes 'c++-mode)</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(add-to-list 'orglink-activate-in-modes 'c-mode)</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(when (require 'orglink nil t)</span>
<span style="font-weight: bold; font-style: italic;">;;   </span><span style="font-weight: bold; font-style: italic;">(global-orglink-mode))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org8480b85f" class="outline-3">
<h3 id="org8480b85f"><span class="section-number-3">10.42</span> [org-trello.el] Trello と双方向同期する</h3>
<div class="outline-text-3" id="text-org8480b85f">
<p>
<a href="https://trello.com/">Trello</a> と特定の org バッファを同期します．コンフリクトを避けるために，明示的に <code>pull</code> と <code>push</code> をする関数を定義して使います．非常に強力で，外出時に簡易的にモバイル端末でタスクを追加したり，ブラウザでグラフィカルにタスクを追加できます．
</p>

<p>
落ち着いてEmacsを使う状況になたら， <code>pull</code> してバッファに反映します． <code>DONE</code> になったタスクや，別な org バッファで管理したいはタスクは， <code>org-refile</code> で移してしまえば良いです．そして，整理ができたら， <code>push</code> して，次のモバイル環境での編集に備えます．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">1. TODO/DOING/DONE &#12395; trello &#20596;&#12398;&#12459;&#12540;&#12489;&#12434;&#22793;&#12360;&#12390;&#12362;&#12367;&#65294;</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">2. M-x org-trello-install-key-and-token</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">~/.emacs.d/.trello/&lt;account&gt;.el &#12364;&#20316;&#12425;&#12428;&#12427;</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">3. M-x org-trello-install-board-metadata</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Trello &#20596;&#12398;&#24773;&#22577;&#12434;&#22522;&#12395;&#12375;&#12390; current-buffer &#12395;&#12503;&#12525;&#12497;&#12486;&#12451;&#12502;&#12525;&#12483;&#12463;&#12364;&#25407;&#20837;&#12373;&#12428;&#12427;</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">4. C-u M-x org-trello-sync-buffer &#12391; pull</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">5. M-x org-trello-sync-buffer &#12391; push</span>
(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(my-push-trello my-pull-trello my-activate-org-trello)
       <span style="font-style: italic;">"org-trello"</span> nil t)

  (<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">org-trello-current-prefix-keybinding</span> nil) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">To avoid an error</span>
  (add-to-list 'auto-mode-alist '(<span style="font-style: italic;">"\\.trello$"</span> . org-mode))

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"org"</span>
    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-activate-org-trello</span> ()
      (<span style="font-weight: bold;">let</span> ((filename (buffer-file-name (current-buffer))))
        (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">and</span> filename
                   (string= <span style="font-style: italic;">"trello"</span> (file-name-extension filename))
                   (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">org-trello</span> nil t))
          (org-trello-mode))))
    (add-hook 'org-mode-hook #'my-activate-org-trello))

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"org-trello"</span>
    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-push-trello-card</span> () (<span style="font-weight: bold;">interactive</span>) (org-trello-sync-card))
    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-pull-trello-card</span> () (<span style="font-weight: bold;">interactive</span>) (org-trello-sync-card t))
    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-push-trello</span> () (<span style="font-weight: bold;">interactive</span>) (org-trello-sync-buffer))
    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-pull-trello</span> () (<span style="font-weight: bold;">interactive</span>) (org-trello-sync-buffer t))))
</pre>
</div>
</div>
</div>

<div id="outline-container-orge01f4572" class="outline-3">
<h3 id="orge01f4572"><span class="section-number-3">10.43</span> [ox.el] ディスパッチャを水平方向の分割画面に表示</h3>
<div class="outline-text-3" id="text-orge01f4572">
<ul class="org-ul">
<li><a href="https://qiita.com/takaxp/items/017ccc4655877b827551">orgエクスポータのディスパッチャを水平分割画面に表示する - Qiita</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"ox"</span>
  (<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my-org-export-before-hook</span> nil)
  (<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my-org-export-after-hook</span> nil)
  (<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my-org-export-last-buffer</span> nil)

  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-org-export--post-processing</span> ()
    (<span style="font-weight: bold;">when</span> (eq this-command 'org-export-dispatch)
      (<span style="font-weight: bold;">let</span> ((moom-verbose nil))
        (run-hooks 'my-org-export-after-hook)
        moom-verbose) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">to avoid a warning on lexical variable</span>
      (remove-hook 'my-org-export-before-hook 'moom-split-window)
      (remove-hook 'my-org-export-before-hook 'split-window-horizontally)
      (remove-hook 'my-org-export-after-hook 'moom-delete-windows)
      (remove-hook 'my-org-export-after-hook 'delete-window))
    (<span style="font-weight: bold;">when</span> this-command
      (remove-hook 'post-command-hook #'my-org-export--post-processing)))

  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-org-export-dispatch</span> (f ARG)
    (<span style="font-weight: bold;">cond</span>
     (org-export-dispatch-use-expert-ui
      nil)
     ((eq (frame-width) 80)
      (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">moom</span> nil t)
        (add-hook 'my-org-export-before-hook 'moom-split-window)
        (add-hook 'my-org-export-after-hook 'moom-delete-windows)))
     ((&gt; (frame-width) 160)
      (add-hook 'my-org-export-before-hook 'split-window-horizontally)
      (add-hook 'my-org-export-after-hook 'delete-window)))
    (<span style="font-weight: bold;">when</span> my-org-export-after-hook
      (add-hook 'post-command-hook #'my-org-export--post-processing))
    (run-hooks 'my-org-export-before-hook)
    (apply f ARG))
  (advice-add 'org-export-dispatch <span style="font-weight: bold;">:around</span> #'my-org-export-dispatch)

  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-org-export-insert-default-template</span> (f <span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> backend subtreep)
    (<span style="font-weight: bold;">let</span> ((this-command nil))
      (apply f backend subtreep)))
  (advice-add 'org-export-insert-default-template <span style="font-weight: bold;">:around</span>
              #'my-org-export-insert-default-template)

  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-org-export-to-buffer</span> (_backend
                                  buffer
                                  <span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> _async _subtreep _visible-only
                                  _body-only _ext-plist _post-process)
    (<span style="font-weight: bold;">setq</span> my-org-export-last-buffer buffer))
  (advice-add 'org-export-to-buffer <span style="font-weight: bold;">:after</span> #'my-org-export-to-buffer)

  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-copy-exported-buffer</span> ()
    (<span style="font-weight: bold;">interactive</span>)
    (<span style="font-weight: bold;">when</span> my-org-export-last-buffer
      (<span style="font-weight: bold;">with-current-buffer</span> my-org-export-last-buffer
        (mark-whole-buffer)
        (kill-ring-save (point-min) (point-max))
        (message <span style="font-style: italic;">"Copied: %s"</span> my-org-export-last-buffer))
      (<span style="font-weight: bold;">setq</span> my-org-export-last-buffer nil)))
  (add-hook 'my-org-export-after-hook #'my-copy-exported-buffer))
</pre>
</div>
</div>
</div>

<div id="outline-container-org992326f6" class="outline-3">
<h3 id="org992326f6"><span class="section-number-3">10.44</span> <span class="todo TODO">TODO</span> [ob-async] ソースブロックの非同期実行</h3>
<div class="outline-text-3" id="text-org992326f6">
<p>
ソースブロックを非同期に実行します．各ソースブロックで <code>:async</code> を指定するだけで，非同期になります． ただし， <code>ob-python</code> はすでに <code>:async</code> を予約しているので， <code>ob-async</code> のオプションと衝突しないように，処理対象から除外しておきます．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"ob-core"</span>
  (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">ob-async</span> nil t)
    (custom-set-variables
     '(ob-async-no-async-languages-alist '(<span style="font-style: italic;">"ipython"</span>)))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org9cbb15f3" class="outline-3">
<h3 id="org9cbb15f3"><span class="section-number-3">10.45</span> <span class="todo TODO">TODO</span> [org-tree-slide] BEGIN<sub>SRCとEND</sub><sub>SRCを消して背景色を変える</sub></h3>
<div class="outline-text-3" id="text-org9cbb15f3">
<p>
<code>hide-lines.el</code> を使うことで，プレゼン時に <code>BEGIN_SRC</code> と <code>ENC_SRC</code> を非表示にしてすっきりさせます．さらに，ソースブロックの背景色を変えます（以下の例では， <code>emacs-lisp</code> を言語で指定している場合に限定）．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(org-tree-slide-mode)
       <span style="font-style: italic;">"org-tree-slide"</span> nil t)

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"org-tree-slide"</span>
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">FIXME &#35079;&#25968;&#12398;&#12496;&#12483;&#12501;&#12449;&#12391;&#20006;&#34892;&#21205;&#20316;&#12373;&#12379;&#12427;&#12392;&#12362;&#12363;&#12375;&#12367;&#12394;&#12427;&#65294;hide-lines &#12398;&#21839;&#38988;&#65311;</span>
    (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">and</span> nil (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">hide-lines</span> nil t))
      (<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my-org-src-block-faces</span> nil)
      (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-show-headers</span> ()
        (<span style="font-weight: bold;">setq</span> org-src-block-faces 'my-org-src-block-faces)
        (hide-lines-show-all))
      (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-hide-headers</span> ()
        (<span style="font-weight: bold;">setq</span> my-org-src-block-faces 'org-src-block-faces)
        (<span style="font-weight: bold;">setq</span> org-src-block-faces
              '((<span style="font-style: italic;">"emacs-lisp"</span> (<span style="font-weight: bold;">:background</span> <span style="font-style: italic;">"cornsilk"</span>))))
        (hide-lines-matching <span style="font-style: italic;">"#\\+BEGIN_SRC"</span>)
        (hide-lines-matching <span style="font-style: italic;">"#\\+END_SRC"</span>))
      (add-hook 'org-tree-slide-play-hook #'my-hide-headers)
      (add-hook 'org-tree-slide-stop-hook #'my-show-headers)

      <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(defun ad:org-edit-src-code (&amp;optional code edit-buffer-name)</span>
      (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">ad:org-edit-src-code</span> ()
        (<span style="font-weight: bold;">interactive</span>)
        (my-show-headers))
      (advice-add 'org-edit-src-code <span style="font-weight: bold;">:before</span> #'ad:org-edit-src-code)
      <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Block &#22806;&#12391;&#21628;&#12400;&#12428;&#12427;&#12392;&#65292;my-show-headers &#12364;&#21628;&#12400;&#12428;&#12390;&#12375;&#12414;&#12358;</span>
      (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">ad:org-edit-src-exit</span> ()
        (<span style="font-weight: bold;">interactive</span>)
        (my-hide-headers))
      (advice-add 'org-edit-src-exit <span style="font-weight: bold;">:after</span> #'ad:org-edit-src-exit))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org3ee441c6" class="outline-3">
<h3 id="org3ee441c6"><span class="section-number-3">10.46</span> <span class="todo TODO">TODO</span> [org-fstree] ディレクトリ構造を読み取る</h3>
<div class="outline-text-3" id="text-org3ee441c6">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"org"</span>
  (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">org-fstree</span> nil t))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbb452f44" class="outline-3">
<h3 id="orgbb452f44"><span class="section-number-3">10.47</span> <span class="todo TODO">TODO</span> [ox.el] 出力形式の拡張</h3>
<div class="outline-text-3" id="text-orgbb452f44">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"ox"</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(setq org-export-default-language "ja")</span>
  (<span style="font-weight: bold;">if</span> (eq system-type 'darwin)
      (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">ox-pandoc</span> nil t)
    (message <span style="font-style: italic;">"--- pandoc is NOT configured for Windows or Linux."</span>))
  (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">ox-qmd</span> nil t) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Quita-style</span>
  (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">ox-gfm</span> nil t)) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">GitHub-style</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org4142d8c3" class="outline-3">
<h3 id="org4142d8c3"><span class="section-number-3">10.48</span> <span class="todo TODO">TODO</span> Parers3.app からリンクを取得する</h3>
<div class="outline-text-3" id="text-org4142d8c3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"org-mac-link"</span>
  (<span style="font-weight: bold;">defcustom</span> <span style="font-weight: bold; font-style: italic;">org-mac-grab-Papers-app-p</span> t
    <span style="font-style: italic;">"Add menu option [P]apers to grab links from the Papers.app."</span>
    <span style="font-weight: bold;">:tag</span> <span style="font-style: italic;">"Grab Papers.app links"</span>
    <span style="font-weight: bold;">:group</span> 'org-mac-link
    <span style="font-weight: bold;">:type</span> 'boolean)

  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">org-mac-papers-insert-frontmost-paper-link</span> ()
    (<span style="font-weight: bold;">interactive</span>)
    (<span style="font-weight: bold;">let</span> ((result (org-mac-papers-get-frontmost-paper-link)))
      (<span style="font-weight: bold;">if</span> result
          (insert result)
        (message <span style="font-style: italic;">"Please open Papers.app and select a paper."</span>))))

  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">org-mac-papers-get-frontmost-paper-link</span> ()
    (<span style="font-weight: bold;">interactive</span>)
    (message <span style="font-style: italic;">"Applescript: Getting Papers link..."</span>)
    (<span style="font-weight: bold;">let</span> ((result (org-as-mac-papers-get-paper-link)))
      (<span style="font-weight: bold;">if</span> (<span style="font-weight: bold;">or</span> (eq result nil) (string= result <span style="font-style: italic;">""</span>))
          nil
        (org-mac-paste-applescript-links result))))

  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">org-as-mac-papers-get-paper-link</span> ()
    (do-applescript
     (concat
      <span style="font-style: italic;">"if application \"Papers\" is running then\n"</span>
      <span style="font-style: italic;">" tell application \"Papers\" to activate\n"</span>
      <span style="font-style: italic;">" delay 0.3\n"</span>
      <span style="font-style: italic;">" set the clipboard to \"\"\n"</span>
      <span style="font-style: italic;">" tell application \"System Events\" to tell process \"Papers\"\n"</span>
      <span style="font-style: italic;">"   keystroke \"l\" using {command down, shift down}\n"</span>
      <span style="font-style: italic;">" end tell\n"</span>
      <span style="font-style: italic;">" delay 0.2\n"</span>
      <span style="font-style: italic;">" set aLink to the clipboard\n"</span>
      <span style="font-style: italic;">" tell application \"System Events\" to tell process \"Papers\"\n"</span>
      <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">"    keystroke \"c\" using {command down, alt down\}\n"</span>
      <span style="font-style: italic;">"   keystroke \"m\" using {command down, option down</span><span style="font-weight: bold; font-style: italic;">\</span><span style="font-style: italic;">}\n"</span>
      <span style="font-style: italic;">" end tell\n"</span>
      <span style="font-style: italic;">" delay 0.2\n"</span>
      <span style="font-style: italic;">" set aName to the clipboard\n"</span>
      <span style="font-style: italic;">" tell application \"Emacs\" to activate\n"</span>
      <span style="font-style: italic;">" return (get aLink) &amp; \"::split::\" &amp; (get aName) as string\n"</span>
      <span style="font-style: italic;">"else\n"</span>
      <span style="font-style: italic;">" return\n"</span>
      <span style="font-style: italic;">"end if\n"</span>)))

  (<span style="font-weight: bold;">when</span> (boundp 'org-mac-link-descriptors)
    (add-to-list 'org-mac-link-descriptors
                 `(<span style="font-style: italic;">"P"</span> <span style="font-style: italic;">"apers"</span> org-mac-papers-insert-frontmost-paper-link
                   ,org-mac-grab-Papers-app-p) <span style="font-weight: bold;">t)))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org47b1ee67" class="outline-3">
<h3 id="org47b1ee67"><span class="section-number-3">10.49</span> <span class="todo TODO">TODO</span> Papers3.app のリンクを開けるようにする</h3>
<div class="outline-text-3" id="text-org47b1ee67">
<p>
Papers3.app は，各文献に <code>papers3://</code> で始まるURIを割り当てています．このリンクを org バッファにペーストし， <code>org-open-at-point</code> (C-c C-o) で開けるようにします．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"org"</span>
  (<span style="font-weight: bold;">when</span> (eq system-type 'darwin)
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Open `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">papers3://</span><span style="font-weight: bold; font-style: italic;">' link by C-c C-o.</span>
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(org-add-link-type will be obsoleted from Org 9.</span>
    (<span style="font-weight: bold;">when</span> (fboundp 'org-link-set-parameters)
      (org-link-set-parameters
       <span style="font-style: italic;">"papers3"</span>
       <span style="font-weight: bold;">:follow</span> (<span style="font-weight: bold;">lambda</span> (path)
                 (<span style="font-weight: bold;">let</span> ((cmd (concat <span style="font-style: italic;">"open papers3:"</span> path)))
                   (shell-command-to-string (shell-quote-argument cmd))
                   (message <span style="font-style: italic;">"%s"</span> cmd)))))))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd14388c1" class="outline-3">
<h3 id="orgd14388c1"><span class="section-number-3">10.50</span> <span class="todo TODO">TODO</span> [org-attach] 外部ファイルを紐付ける</h3>
<div class="outline-text-3" id="text-orgd14388c1">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(org-attach du-org-attachments)
       <span style="font-style: italic;">"org-attach"</span> nil t)

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"org-attach"</span>
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">org-insert-link &#12391;&#28155;&#20184;&#12501;&#12449;&#12452;&#12523;&#12408;&#12398;&#12522;&#12531;&#12463;&#12434;&#12506;&#12540;&#12473;&#12488;&#12391;&#12365;&#12427;&#12424;&#12358;&#12395;&#12377;&#12427;</span>
    (<span style="font-weight: bold;">setq</span> org-attach-store-link-p t)
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#33258;&#21205;&#20184;&#19982;&#12373;&#12428;&#12427;&#12479;&#12464;&#12398;&#21517;&#21069;&#12434;&#22793;&#26356;</span>
    (<span style="font-weight: bold;">setq</span> org-attach-auto-tag <span style="font-style: italic;">"Attach"</span>)
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">git-annex &#12434;&#20351;&#29992;&#12375;&#12394;&#12356;</span>
    (<span style="font-weight: bold;">setq</span> org-attach-git-annex-cutoff nil)

    (<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">org-attach-directory-absolute</span>
      (concat (getenv <span style="font-style: italic;">"SYNCROOT"</span>)
              <span style="font-style: italic;">"/org/"</span>
              (<span style="font-weight: bold;">when</span> (boundp 'org-attach-directory)
                <span style="font-style: italic;">"data/"</span>)))

    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">du-org-attachments</span> ()
      <span style="font-style: italic;">"Show directory size for org-attachments."</span>
      (<span style="font-weight: bold;">interactive</span>)
      (message <span style="font-style: italic;">"--- %s"</span>
               (chomp (shell-command-to-string
                       (concat <span style="font-style: italic;">"/usr/bin/du -sh "</span>
                               org-attach-directory-absolute)))))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org1926ab44" class="outline-3">
<h3 id="org1926ab44"><span class="section-number-3">10.51</span> <span class="todo TODO">TODO</span> [org-recent-headings] 訪問したツリーを記録し簡単に再訪問可能にする</h3>
<div class="outline-text-3" id="text-org1926ab44">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(org-recent-headings-ivy org-recent-headings-mode)
       <span style="font-style: italic;">"org-recent-headings"</span> nil t)

  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(global-set-key (kbd "C-c f r") 'org-recent-headings-helm)</span>
  (global-set-key (kbd <span style="font-style: italic;">"C-c f r"</span>) 'org-recent-headings-ivy)

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"org-recent-headings"</span>
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#12487;&#12501;&#12457;&#12523;&#12488;&#12384;&#12392; `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">ivy-string&lt;</span><span style="font-weight: bold; font-style: italic;">' &#12364;&#20351;&#12431;&#12428;&#12390;&#12375;&#12414;&#12356;&#65292;&#20351;&#29992;&#23653;&#27508;&#12364;&#21453;&#26144;&#12373;&#12428;&#12394;&#12356;&#65294;</span>
    (<span style="font-weight: bold;">setf</span> (alist-get 'org-recent-headings-ivy ivy-sort-functions-alist) nil)

    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">ad:org-recent-headings-activate</span> ()
      (<span style="font-weight: bold;">interactive</span>)
      (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">org-recent-headings</span> nil t)
        (org-recent-headings-mode 1)
        (advice-remove 'org-recent-headings-ivy
                       #'ad:org-recent-headings-activate)))
    (advice-add 'org-recent-headings-ivy <span style="font-weight: bold;">:before</span>
                #'ad:org-recent-headings-activate)

    (<span style="font-weight: bold;">setq</span> org-recent-headings-save-file <span style="font-style: italic;">"~/.emacs.d/org-recent-headings.dat"</span>)
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(setq org-recent-headings-use-ids 'when-available)</span>
    (<span style="font-weight: bold;">setq</span> org-recent-headings-show-entry-function
          'org-recent-headings--show-entry-direct) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#30452;&#25509;&#31227;&#21205;&#12377;&#12427;</span>
    (<span style="font-weight: bold;">setq</span> org-recent-headings-advise-functions
          '(org-agenda-goto
            org-agenda-show
            org-agenda-show-mouse
            org-show-entry
            org-reveal
            org-refile
            org-tree-to-indirect-buffer
            org-bookmark-jump))))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfcfd3f34" class="outline-3">
<h3 id="orgfcfd3f34"><span class="section-number-3">10.52</span> <span class="todo TODO">TODO</span> [orgnav] ツリーの検索インタフェース</h3>
<div class="outline-text-3" id="text-orgfcfd3f34">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(orgnav-search-root)
       <span style="font-style: italic;">"orgnav"</span> nil t)

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"org"</span>
    (define-key org-mode-map (kbd <span style="font-style: italic;">"C-c f n"</span>)
      (<span style="font-weight: bold;">lambda</span> () (<span style="font-weight: bold;">interactive</span>)
          (orgnav-search-root 3 'orgnav--goto-action)))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org5fce13fa" class="outline-3">
<h3 id="org5fce13fa"><span class="section-number-3">10.53</span> <span class="todo TODO">TODO</span> [toc-org] 目次の挿入</h3>
<div class="outline-text-3" id="text-org5fce13fa">
<ul class="org-ul">
<li>ツリーに TOC タグを付けて，`toc-org-insert-toc'を実行すればOK</li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(autoload-if-found '(toc-org-insert-toc) <span style="font-style: italic;">"toc-org"</span> nil t)
</pre>
</div>
</div>
</div>

<div id="outline-container-org4ca4749d" class="outline-3">
<h3 id="org4ca4749d"><span class="section-number-3">10.54</span> <span class="todo TODO">TODO</span> [org-review.el] レビューフローのサポート</h3>
<div class="outline-text-3" id="text-org4ca4749d">
<ul class="org-ul">
<li><a href="https://github.com/brabalan/org-review">https://github.com/brabalan/org-review</a></li>
<li>以下の設定では， <code>org-agenda</code> 使用時に <code>C-c C-r r</code> で発動</li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp"># init-org.el
(<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"org-agenda"</span>
  (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">org-review</span> nil t)
    (add-to-list 'org-agenda-custom-commands
                 '((<span style="font-style: italic;">"r"</span> <span style="font-style: italic;">"Review projects"</span> tags-todo <span style="font-style: italic;">"-CANCELLED/"</span>
                    ((org-agenda-overriding-header <span style="font-style: italic;">"Reviews Scheduled"</span>)
                     (org-agenda-skip-function 'org-review-agenda-skip)
                     (org-agenda-cmp-user-defined 'org-review-compare)
                     (org-agenda-sorting-strategy '(user-defined-down))))))
    (org-defkey org-agenda-mode-map <span style="font-style: italic;">"\C-c\C-r"</span>
                'org-review-insert-last-review)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org0b29fe80" class="outline-3">
<h3 id="org0b29fe80"><span class="section-number-3">10.55</span> REV2 [org-screenshot] スクリーンショットを貼り付ける</h3>
<div class="outline-text-3" id="text-org0b29fe80">
<ul class="org-ul">
<li><a href="https://github.com/dfeich/org-screenshot">dfeich/org-screenshot: screenshots integrated with emacs org mode attachments</a></li>
<li>macOSの場合， <code>screencapture</code> コマンドをキャプチャコマンドとして指定し，オプションに <code>-w</code> を付ければ，任意のウィンドウを指定してキャプチャし，それを保存，orgバッファに添付できる．</li>
<li class="on"><code>[X]</code> ファイル名が挿入されない（./.pngになる）</li>
<li class="off"><code>[&#xa0;]</code> org-attach の git ハンドリングと同期していない</li>
</ul>


<div class="figure">
<p><img src="data/4B/8A23F1-81EE-445B-8982-54B5FAB13645/screenshot-20180315-164532.png" alt="screenshot-20180315-164532.png" />
</p>
</div>

<p>
（How？）
</p>
<ul class="org-ul">
<li class="on"><code>[X]</code> 所定のウィンドウだけをキャプチャする方法</li>
<li class="on"><code>[X]</code> Emacs バッファを抜いてキャプチャする方法</li>
<li class="on"><code>[X]</code> Emacs だけキャプチャする方法</li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(org-attach-screenshot)
       <span style="font-style: italic;">"org-attach-screenshot"</span> nil t)

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"org-attach-screenshot"</span>
    (<span style="font-weight: bold;">when</span> (executable-find <span style="font-style: italic;">"screencapture"</span>)
      (<span style="font-weight: bold;">setq</span> org-attach-screenshot-command-line <span style="font-style: italic;">"screencapture -w %f"</span>))
    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-org-attach-screenshot</span> ()
      (<span style="font-weight: bold;">interactive</span>)
      (org-attach-screenshot t (format-time-string
                                <span style="font-style: italic;">"screenshot-%Y%m%d-%H%M%S.png"</span>)))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org0f4b6016" class="outline-3">
<h3 id="org0f4b6016"><span class="section-number-3">10.56</span> <span class="done DONE">DONE</span> [org-autolist] ブリッツの入力を簡単に&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></h3>
<div class="outline-text-3" id="text-org0f4b6016">
<p>
ブリッツの入力や削除を Microsoft Word 的にします．意外と馴染まなかったので不使用です．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(org-autolist-mode)
       <span style="font-style: italic;">"org-autolist"</span> nil t)

  (add-hook 'org-mode-hook (<span style="font-weight: bold;">lambda</span> () (org-autolist-mode))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org39530542" class="outline-3">
<h3 id="org39530542"><span class="section-number-3">10.57</span> <span class="done DONE">DONE</span> [MobileOrg] iOS との連携&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></h3>
<div class="outline-text-3" id="text-org39530542">
<ul class="org-ul">
<li><a href="http://orgmode.org/manual/Setting-up-the-staging-area.html">http://orgmode.org/manual/Setting-up-the-staging-area.html</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"org"</span>
  <span style="font-weight: bold; font-style: italic;">;;</span><span style="font-weight: bold; font-style: italic;">(setq org-mobile-files '("~/Dropbox/org/next.org" "1.org" "2.org"))</span>
  (<span style="font-weight: bold;">setq</span> org-mobile-files '(<span style="font-style: italic;">"~/Dropbox/org/next.org"</span>))
  <span style="font-weight: bold; font-style: italic;">;;</span><span style="font-weight: bold; font-style: italic;">(setq org-mobile-force-id-on-agenda-items nil)</span>

  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Set a file to capture data from iOS devices</span>
  (<span style="font-weight: bold;">setq</span> org-mobile-inbox-for-pull (concat org-directory <span style="font-style: italic;">"captured.org"</span>))

  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Upload location stored org files (index.org will be created)</span>
  (<span style="font-weight: bold;">setq</span> org-mobile-directory <span style="font-style: italic;">"~/Dropbox/Apps/MobileOrg/"</span>)

  <span style="font-weight: bold; font-style: italic;">;;; </span><span style="font-weight: bold; font-style: italic;">Menu to push or pull org files using MobileOrg</span>
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">org-mobile-sync</span> ()
    (<span style="font-weight: bold;">interactive</span>)
    (<span style="font-weight: bold;">let</span>
        (org-mobile-sync-type
         (read-from-minibuffer
          <span style="font-style: italic;">"How do you sync the org files? (pull or push) "</span>))
      (message <span style="font-style: italic;">"%s"</span> org-mobile-sync-type)
      (<span style="font-weight: bold;">cond</span>
       ((string= <span style="font-style: italic;">"pull"</span> org-mobile-sync-type) (org-mobile-pull))
       ((string= <span style="font-style: italic;">"push"</span> org-mobile-sync-type) (org-mobile-push))))))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfb20898b" class="outline-3">
<h3 id="orgfb20898b"><span class="section-number-3">10.58</span> <span class="done DONE">DONE</span> [org-export-generic] エクスポート機能を拡張する&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></h3>
<div class="outline-text-3" id="text-orgfb20898b">
<p>
<code>org-set-generic-type</code> を使うことで，エクスポート機能を好みに拡張できる．contrib の中の <code>org-export-generic.el</code> が必要なので注意する．
</p>

<p>
（注意）次の設定は古い内容．動かないかもしれません．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"org"</span>
  (org-set-generic-type
   <span style="font-style: italic;">"textile"</span>
   '(<span style="font-weight: bold;">:file-suffix</span>
     <span style="font-style: italic;">".textile"</span>
     <span style="font-weight: bold;">:key-binding</span> ?T
     <span style="font-weight: bold;">:title-format</span>    <span style="font-style: italic;">"Title: %s\n\n"</span>
     <span style="font-weight: bold; font-style: italic;">;;   </span><span style="font-weight: bold; font-style: italic;">:date-format     "Date: %s\n"</span>
     <span style="font-weight: bold;">:date-export</span> nil
     <span style="font-weight: bold;">:toc-export</span>      nil
     <span style="font-weight: bold;">:author-export</span>   nil
     <span style="font-weight: bold;">:tags-export</span>     nil
     <span style="font-weight: bold;">:drawers-export</span>  nil
     <span style="font-weight: bold;">:date-export</span>     t
     <span style="font-weight: bold;">:timestamps-export</span>  t
     <span style="font-weight: bold;">:priorities-export</span>  nil
     <span style="font-weight: bold;">:todo-keywords-export</span> t
     <span style="font-weight: bold;">:body-line-fixed-format</span> <span style="font-style: italic;">"\t%s\n"</span>
                                        <span style="font-weight: bold; font-style: italic;">;</span><span style="font-weight: bold; font-style: italic;">:body-list-prefix "\n"</span>
     <span style="font-weight: bold;">:body-list-format</span> <span style="font-style: italic;">"* %s"</span>
     <span style="font-weight: bold;">:body-list-suffix</span> <span style="font-style: italic;">"\n"</span>
     <span style="font-weight: bold;">:body-bullet-list-prefix</span> (<span style="font-style: italic;">"* "</span> <span style="font-style: italic;">"** "</span> <span style="font-style: italic;">"*** "</span> <span style="font-style: italic;">"**** "</span> <span style="font-style: italic;">"***** "</span>)
     <span style="font-weight: bold;">:body-number-list-format</span> <span style="font-style: italic;">"# %s"</span>
     <span style="font-weight: bold;">:body-number-list-suffix</span> <span style="font-style: italic;">"\n"</span>
     <span style="font-weight: bold;">:header-prefix</span> (<span style="font-style: italic;">""</span> <span style="font-style: italic;">""</span> <span style="font-style: italic;">"### "</span> <span style="font-style: italic;">"#### "</span> <span style="font-style: italic;">"##### "</span> <span style="font-style: italic;">"###### "</span>)
     <span style="font-weight: bold;">:body-section-header-prefix</span> (<span style="font-style: italic;">"h1. "</span> <span style="font-style: italic;">"h2. "</span> <span style="font-style: italic;">"h3. "</span> <span style="font-style: italic;">"h4. "</span> <span style="font-style: italic;">"h5. "</span> <span style="font-style: italic;">"h6. "</span>)
     <span style="font-weight: bold;">:body-section-header-format</span> <span style="font-style: italic;">"%s"</span>
     <span style="font-weight: bold;">:body-section-header-suffix</span> (<span style="font-style: italic;">"\n\n"</span>)
     <span style="font-weight: bold;">:body-header-section-numbers</span> nil
     <span style="font-weight: bold;">:body-header-section-number-format</span> <span style="font-style: italic;">"%s) "</span>
     <span style="font-weight: bold;">:body-line-format</span> <span style="font-style: italic;">"%s\n"</span>
     <span style="font-weight: bold;">:body-newline-paragraph</span> <span style="font-style: italic;">"\n"</span>
     <span style="font-weight: bold;">:bold-format</span> <span style="font-style: italic;">"*%s*"</span>
     <span style="font-weight: bold;">:italic-format</span> <span style="font-style: italic;">"_%s_"</span>
     <span style="font-weight: bold;">:underline-format</span> <span style="font-style: italic;">"+%s+"</span>
     <span style="font-weight: bold;">:strikethrough-format</span> <span style="font-style: italic;">"-%s-"</span>
     <span style="font-weight: bold;">:verbatim-format</span> <span style="font-style: italic;">"`%s`"</span>
     <span style="font-weight: bold;">:code-format</span> <span style="font-style: italic;">"@%s@"</span>
     <span style="font-weight: bold;">:body-line-wrap</span>   75
     <span style="font-weight: bold;">:blockquote-start</span> <span style="font-style: italic;">"\n&lt;pre&gt;\n"</span>
     <span style="font-weight: bold;">:blockquote-end</span> <span style="font-style: italic;">"\n&lt;/pre&gt;\n"</span>
     ))

  (org-set-generic-type
   <span style="font-style: italic;">"markdown"</span>
   '(<span style="font-weight: bold;">:file-suffix</span>
     <span style="font-style: italic;">".markdown"</span>
     <span style="font-weight: bold;">:key-binding</span>     ?M
     <span style="font-weight: bold;">:title-format</span>    <span style="font-style: italic;">"Title: %s\n"</span>
     <span style="font-weight: bold;">:date-format</span>     <span style="font-style: italic;">"Date: %s\n"</span>
     <span style="font-weight: bold;">:toc-export</span>      nil
     <span style="font-weight: bold;">:author-export</span>   t
     <span style="font-weight: bold;">:tags-export</span>     nil
     <span style="font-weight: bold;">:drawers-export</span>  nil
     <span style="font-weight: bold;">:date-export</span>     t
     <span style="font-weight: bold;">:timestamps-export</span>  t
     <span style="font-weight: bold;">:priorities-export</span>  nil
     <span style="font-weight: bold;">:todo-keywords-export</span> t
     <span style="font-weight: bold;">:body-line-fixed-format</span> <span style="font-style: italic;">"\t%s\n"</span>
     <span style="font-weight: bold; font-style: italic;">;;</span><span style="font-weight: bold; font-style: italic;">:body-list-prefix "\n"</span>
     <span style="font-weight: bold;">:body-list-format</span> <span style="font-style: italic;">"- %s"</span>
     <span style="font-weight: bold;">:body-list-suffix</span> <span style="font-style: italic;">"\n"</span>
     <span style="font-weight: bold;">:header-prefix</span> (<span style="font-style: italic;">""</span> <span style="font-style: italic;">""</span> <span style="font-style: italic;">"### "</span> <span style="font-style: italic;">"#### "</span> <span style="font-style: italic;">"##### "</span> <span style="font-style: italic;">"###### "</span>)
     <span style="font-weight: bold;">:body-section-header-prefix</span> (<span style="font-style: italic;">""</span> <span style="font-style: italic;">""</span> <span style="font-style: italic;">"### "</span> <span style="font-style: italic;">"#### "</span> <span style="font-style: italic;">"##### "</span> <span style="font-style: italic;">"###### "</span>)
     <span style="font-weight: bold;">:body-section-header-format</span> <span style="font-style: italic;">"%s\n"</span>
     <span style="font-weight: bold;">:body-section-header-suffix</span> (?= ?- <span style="font-style: italic;">""</span>)
     <span style="font-weight: bold;">:body-header-section-numbers</span> nil
     <span style="font-weight: bold;">:body-header-section-number-format</span> <span style="font-style: italic;">"%s) "</span>
     <span style="font-weight: bold;">:body-line-format</span> <span style="font-style: italic;">"%s\n"</span>
     <span style="font-weight: bold;">:body-newline-paragraph</span> <span style="font-style: italic;">"\n"</span>
     <span style="font-weight: bold;">:bold-format</span> <span style="font-style: italic;">"**%s**"</span>
     <span style="font-weight: bold;">:italic-format</span> <span style="font-style: italic;">"_%s_"</span>
     <span style="font-weight: bold;">:verbatim-format</span> <span style="font-style: italic;">"`%s`"</span>
     <span style="font-weight: bold;">:code-format</span> <span style="font-style: italic;">"`%s`"</span>
     <span style="font-weight: bold;">:body-line-wrap</span>   75
     )))
</pre>
</div>

<p>
<code>org-set-generic-type</code> を <code>.emacs</code> に追記した後， <code>C-c C-e g &lt;key-binding&gt;</code> とすればよい． <code>&lt;key-binding&gt;</code> は <code>org-set-generic-type</code> で設定する値である．2つ目は，Markdown へのエクスポーターである．
</p>
</div>
</div>

<div id="outline-container-org563f7076" class="outline-3">
<h3 id="org563f7076"><span class="section-number-3">10.59</span> <span class="done DONE">DONE</span> org-mode の latex エクスポート関数をオーバーライド&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></h3>
<div class="outline-text-3" id="text-org563f7076">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;; </span><span style="font-weight: bold; font-style: italic;">Tex export (org-mode -&gt; tex with beamer class) ;;;;;;;;;;;;;;;;;;;;;;;;;;;;</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(setq org-export-latex-classes</span>
<span style="font-weight: bold; font-style: italic;">;;   </span><span style="font-weight: bold; font-style: italic;">'(("article"</span>
<span style="font-weight: bold; font-style: italic;">;;      </span><span style="font-weight: bold; font-style: italic;">"\\documentclass[11pt]{article}</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">\\usepackage[AUTO]{inputenc}</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">\\usepackage[T1]{fontenc}</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">\\usepackage{graphicx}</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">\\usepackage{longtable}</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">\\usepackage{float}</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">\\usepackage{wrapfig}</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">\\usepackage{soul}</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">\\usepackage{amssymb}</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">\\usepackage{hyperref}"</span>
<span style="font-weight: bold; font-style: italic;">;;      </span><span style="font-weight: bold; font-style: italic;">("\\section{%s}" . "\\section*{%s}")</span>
<span style="font-weight: bold; font-style: italic;">;;      </span><span style="font-weight: bold; font-style: italic;">("\\subsection{%s}" . "\\subsection*{%s}")</span>
<span style="font-weight: bold; font-style: italic;">;;      </span><span style="font-weight: bold; font-style: italic;">("\\subsubsection{%s}" . "\\subsubsection*{%s}")</span>
<span style="font-weight: bold; font-style: italic;">;;      </span><span style="font-weight: bold; font-style: italic;">("\\paragraph{%s}" . "\\paragraph*{%s}")</span>
<span style="font-weight: bold; font-style: italic;">;;      </span><span style="font-weight: bold; font-style: italic;">("\\subparagraph{%s}" . "\\subparagraph*{%s}"))</span>
<span style="font-weight: bold; font-style: italic;">;;     </span><span style="font-weight: bold; font-style: italic;">("report"</span>
<span style="font-weight: bold; font-style: italic;">;;      </span><span style="font-weight: bold; font-style: italic;">"\\documentclass[11pt]{report}</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">\\usepackage[AUTO]{inputenc}</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">\\usepackage[T1]{fontenc}</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">\\usepackage{graphicx}</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">\\usepackage{longtable}</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">\\usepackage{float}</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">\\usepackage{wrapfig}</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">\\usepackage{soul}</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">\\usepackage{amssymb}</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">\\usepackage{hyperref}"</span>
<span style="font-weight: bold; font-style: italic;">;;      </span><span style="font-weight: bold; font-style: italic;">("\\part{%s}" . "\\part*{%s}")</span>
<span style="font-weight: bold; font-style: italic;">;;      </span><span style="font-weight: bold; font-style: italic;">("\\chapter{%s}" . "\\chapter*{%s}")</span>
<span style="font-weight: bold; font-style: italic;">;;      </span><span style="font-weight: bold; font-style: italic;">("\\section{%s}" . "\\section*{%s}")</span>
<span style="font-weight: bold; font-style: italic;">;;      </span><span style="font-weight: bold; font-style: italic;">("\\subsection{%s}" . "\\subsection*{%s}")</span>
<span style="font-weight: bold; font-style: italic;">;;      </span><span style="font-weight: bold; font-style: italic;">("\\subsubsection{%s}" . "\\subsubsection*{%s}"))</span>
<span style="font-weight: bold; font-style: italic;">;;     </span><span style="font-weight: bold; font-style: italic;">("book"</span>
<span style="font-weight: bold; font-style: italic;">;;      </span><span style="font-weight: bold; font-style: italic;">"\\documentclass[11pt]{book}</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">\\usepackage[AUTO]{inputenc}</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">\\usepackage[T1]{fontenc}</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">\\usepackage{graphicx}</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">\\usepackage{longtable}</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">\\usepackage{float}</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">\\usepackage{wrapfig}</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">\\usepackage{soul}</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">\\usepackage{amssymb}</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">\\usepackage{hyperref}"</span>
<span style="font-weight: bold; font-style: italic;">;;      </span><span style="font-weight: bold; font-style: italic;">("\\part{%s}" . "\\part*{%s}")</span>
<span style="font-weight: bold; font-style: italic;">;;      </span><span style="font-weight: bold; font-style: italic;">("\\chapter{%s}" . "\\chapter*{%s}")</span>
<span style="font-weight: bold; font-style: italic;">;;      </span><span style="font-weight: bold; font-style: italic;">("\\section{%s}" . "\\section*{%s}")</span>
<span style="font-weight: bold; font-style: italic;">;;      </span><span style="font-weight: bold; font-style: italic;">("\\subsection{%s}" . "\\subsection*{%s}")</span>
<span style="font-weight: bold; font-style: italic;">;;      </span><span style="font-weight: bold; font-style: italic;">("\\subsubsection{%s}" . "\\subsubsection*{%s}"))</span>
<span style="font-weight: bold; font-style: italic;">;;     </span><span style="font-weight: bold; font-style: italic;">("beamer"</span>
<span style="font-weight: bold; font-style: italic;">;;      </span><span style="font-weight: bold; font-style: italic;">"\\documentclass{beamer}</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">\\usepackage[AUTO]{inputenc}</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">\\usepackage{graphicx}</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">\\usepackage{longtable}</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">\\usepackage{float}</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">\\usepackage{wrapfig}</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">\\usepackage{amssymb}</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">\\usepackage{hyperref}"</span>
<span style="font-weight: bold; font-style: italic;">;;      </span><span style="font-weight: bold; font-style: italic;">org-beamer-sectioning)))</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org5fd484a3" class="outline-2">
<h2 id="org5fd484a3"><span class="section-number-2">11</span> フレーム／ウィンドウ制御</h2>
<div class="outline-text-2" id="text-org5fd484a3">
</div>
<div id="outline-container-orgd05fc75a" class="outline-3">
<h3 id="orgd05fc75a"><span class="section-number-3">11.1</span> 起動時の設定</h3>
<div class="outline-text-3" id="text-orgd05fc75a">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">cond</span>
 <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">for Macintosh</span>
 ((memq window-system '(mac ns))
  (<span style="font-weight: bold;">setq</span> initial-frame-alist
        (append
         '((top . 23)
           (left . 0)
           <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(alpha . (100 90))</span>
           <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(vertical-scroll-bars . nil)</span>
           <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(internal-border-width . 20)</span>
           <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(outer-border-width . 20)</span>
           <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(ns-appearance . nil) ;; 26.1 {light, dark}</span>
           (ns-transparent-titlebar . t)) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">26.1</span>
         initial-frame-alist)))

 <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">for Linux</span>
 ((eq window-system 'x)
  (<span style="font-weight: bold;">setq</span> initial-frame-alist
        (append
         '((vertical-scroll-bars . nil)
           (top . 0)
           (left . 0)
           (width . 80)
           (height . 38))
         initial-frame-alist)))

 ((eq window-system nil)
  nil)

 <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">for Windows</span>
 (t (<span style="font-weight: bold;">setq</span> initial-frame-alist
          (append
           '((vertical-scroll-bars . nil)
             (top . 0)
             (left . 0)
             (width . 80)
             (height . 26))
           initial-frame-alist))))

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Apply the initial setting to default</span>
(<span style="font-weight: bold;">setq</span> default-frame-alist initial-frame-alist)
(<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"postpone"</span>
  (set-face-foreground 'vertical-border (face-foreground 'default))
  (set-face-background 'vertical-border (face-background 'default)))
(set-face-background 'fringe (face-background 'default)) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">10-20[ms]</span>

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#12459;&#12540;&#12477;&#12523;&#12398;&#33394;</span>
(<span style="font-weight: bold;">defconst</span> <span style="font-weight: bold; font-style: italic;">my-cur-color-ime</span> '(<span style="font-weight: bold;">:on</span> <span style="font-style: italic;">"#FF9300"</span> <span style="font-weight: bold;">:off</span> <span style="font-style: italic;">"#91C3FF"</span>))
(<span style="font-weight: bold;">defconst</span> <span style="font-weight: bold; font-style: italic;">my-cur-type-ime</span> '(<span style="font-weight: bold;">:on</span> (bar . 2) <span style="font-weight: bold;">:off</span> (bar . 2)))
(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my-ime-last</span> nil)

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-ime-active-p</span> ()
  (<span style="font-weight: bold;">if</span> (fboundp 'mac-get-current-input-source)
      (not (string-match <span style="font-style: italic;">"\\.Roman$"</span> (mac-get-current-input-source)))
    (<span style="font-weight: bold;">if</span> current-input-method t nil)))
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-ime-on-cursor</span> ()
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">setq</span> cursor-type (plist-get my-cur-type-ime <span style="font-weight: bold;">:on</span>))
  (set-cursor-color (plist-get my-cur-color-ime <span style="font-weight: bold;">:on</span>)))
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-ime-off-cursor</span> ()
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">setq</span> cursor-type (plist-get my-cur-type-ime <span style="font-weight: bold;">:off</span>))
  (set-cursor-color (plist-get my-cur-color-ime <span style="font-weight: bold;">:off</span>)))
(add-hook 'input-method-activate-hook #'my-ime-on-cursor)
(add-hook 'input-method-deactivate-hook #'my-ime-off-cursor)

(<span style="font-weight: bold;">if</span> (version&lt; emacs-version <span style="font-style: italic;">"27.0"</span>)
    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-apply-cursor-config</span> ()
      (<span style="font-weight: bold;">interactive</span>)
      (<span style="font-weight: bold;">when</span> (display-graphic-p)
        (<span style="font-weight: bold;">if</span> (my-ime-active-p) (my-ime-on-cursor) (my-ime-off-cursor))))

  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-apply-cursor-config</span> ()
    (<span style="font-weight: bold;">interactive</span>)
    (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">and</span> (display-graphic-p)
               (fboundp 'mac-ime-active-p))
      (<span style="font-weight: bold;">if</span> (mac-ime-active-p) (my-ime-on-cursor) (my-ime-off-cursor))))
  (add-hook 'buffer-list-update-hook #'my-apply-cursor-config))

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(unless (and (memq window-system '(ns mac))</span>
<span style="font-weight: bold; font-style: italic;">;;              </span><span style="font-weight: bold; font-style: italic;">noninteractive)</span>
<span style="font-weight: bold; font-style: italic;">;;   </span><span style="font-weight: bold; font-style: italic;">;; ensure IME off when starting Emacs except macOS</span>
<span style="font-weight: bold; font-style: italic;">;;   </span><span style="font-weight: bold; font-style: italic;">(toggle-input-method)</span>
<span style="font-weight: bold; font-style: italic;">;;   </span><span style="font-weight: bold; font-style: italic;">(toggle-input-method nil nil))</span>

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">for init setup</span>
(<span style="font-weight: bold;">setq-default</span> cursor-type (plist-get my-cur-type-ime <span style="font-weight: bold;">:on</span>))
(my-apply-cursor-config)

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">could be deleted</span>
(<span style="font-weight: bold;">when</span> (memq window-system '(ns x))
  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"postpone"</span>
    (run-with-idle-timer 3 t #'my-apply-cursor-config)))

(<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"postpone"</span>
  (<span style="font-weight: bold;">cond</span>
   ((memq window-system '(ns x))
    (<span style="font-weight: bold;">when</span> (fboundp 'mac-set-input-method-parameter)
      (mac-set-input-method-parameter
       <span style="font-style: italic;">"com.google.inputmethod.Japanese.base"</span> 'title <span style="font-style: italic;">"&#61724; "</span>)) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#61504;&#61956;&#61957;&#61867;</span>

    (<span style="font-weight: bold;">declare-function</span> my-ime-on <span style="font-style: italic;">"init"</span> nil)
    (<span style="font-weight: bold;">declare-function</span> my-ime-off <span style="font-style: italic;">"init"</span> nil)
    (<span style="font-weight: bold;">declare-function</span> my-ime-active-p <span style="font-style: italic;">"init"</span> nil)

    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">for private patch</span>
    (<span style="font-weight: bold;">when</span> (boundp 'mac-ime-cursor-type)
      (<span style="font-weight: bold;">setq</span> mac-ime-cursor-type (plist-get my-cur-type-ime <span style="font-weight: bold;">:on</span>)))

    (<span style="font-weight: bold;">setq</span> my-ime-last (my-ime-active-p))
    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-ime-on</span> ()
      (<span style="font-weight: bold;">interactive</span>)
      (<span style="font-weight: bold;">if</span> (fboundp 'mac-toggle-input-method)
          (<span style="font-weight: bold;">progn</span>
            (mac-toggle-input-method t)
            (run-hooks 'input-method-activate-hook))
        (activate-input-method default-input-method))
      (<span style="font-weight: bold;">setq</span> my-ime-last t))
    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-ime-off</span> ()
      (<span style="font-weight: bold;">interactive</span>)
      (<span style="font-weight: bold;">if</span> (fboundp 'mac-toggle-input-method)
          (<span style="font-weight: bold;">progn</span>
            (mac-toggle-input-method nil)
            (run-hooks 'input-method-deactivate-hook))
        (deactivate-input-method))
      (<span style="font-weight: bold;">setq</span> my-ime-last nil))

    (<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my-ime-before-action</span> nil)
    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-ime-on-sticky</span> ()
      (<span style="font-weight: bold;">when</span> my-ime-before-action
        (my-ime-on)))
    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-ime-off-sticky</span> ()
      (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">setq</span> my-ime-before-action (my-ime-active-p))
        (my-ime-off)))

    (<span style="font-weight: bold;">if</span> (version&lt; emacs-version <span style="font-style: italic;">"27.0"</span>)
        (<span style="font-weight: bold;">progn</span>
          <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">For selected.el</span>
          (add-hook 'activate-mark-hook #'my-ime-off-sticky)
          (add-hook 'deactivate-mark-hook #'my-ime-on-sticky)
          <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#12300;M-x &#12354;&#12301;&#23550;&#31574;</span>
          (add-hook 'minibuffer-setup-hook #'my-ime-off-sticky)
          (add-hook 'minibuffer-exit-hook #'my-ime-on-sticky))
      <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">For selected.el</span>
      (add-hook 'activate-mark-hook #'mac-ime-deactivate-sticky)
      (add-hook 'deactivate-mark-hook #'mac-ime-activate-sticky))

    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(defun ad:find-file (FILENAME &amp;optional WILDCARDS)</span>
    <span style="font-weight: bold; font-style: italic;">;;   </span><span style="font-weight: bold; font-style: italic;">"Extension to find-file as before-find-file-hook."</span>
    <span style="font-weight: bold; font-style: italic;">;;   </span><span style="font-weight: bold; font-style: italic;">(message "--- ad:findfile")</span>
    <span style="font-weight: bold; font-style: italic;">;;   </span><span style="font-weight: bold; font-style: italic;">(apply FILENAME WILDCARDS))</span>
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(advice-add #'find-file :around #'ad:find-file)</span>

    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">http://tezfm.blogspot.jp/2009/11/cocoa-emacs.html</span>
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#12496;&#12483;&#12501;&#12449;&#20999;&#26367;&#26178;&#12395; input method &#12434;&#20999;&#12426;&#26367;&#12360;&#12427;</span>
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(with-eval-after-load "postpone"</span>
    <span style="font-weight: bold; font-style: italic;">;;   </span><span style="font-weight: bold; font-style: italic;">(when (and (fboundp 'mac-handle-input-method-change)</span>
    <span style="font-weight: bold; font-style: italic;">;;              </span><span style="font-weight: bold; font-style: italic;">(require 'cl nil t))</span>
    <span style="font-weight: bold; font-style: italic;">;;     </span><span style="font-weight: bold; font-style: italic;">(add-hook</span>
    <span style="font-weight: bold; font-style: italic;">;;      </span><span style="font-weight: bold; font-style: italic;">'post-command-hook</span>
    <span style="font-weight: bold; font-style: italic;">;;      </span><span style="font-weight: bold; font-style: italic;">(lexical-let ((previous-buffer nil))</span>
    <span style="font-weight: bold; font-style: italic;">;;        </span><span style="font-weight: bold; font-style: italic;">(message "Change IM %S -&gt; %S" previous-buffer (current-buffer))</span>
    <span style="font-weight: bold; font-style: italic;">;;        </span><span style="font-weight: bold; font-style: italic;">(lambda ()</span>
    <span style="font-weight: bold; font-style: italic;">;;            </span><span style="font-weight: bold; font-style: italic;">(unless (eq (current-buffer) previous-buffer)</span>
    <span style="font-weight: bold; font-style: italic;">;;              </span><span style="font-weight: bold; font-style: italic;">(when (bufferp previous-buffer)</span>
    <span style="font-weight: bold; font-style: italic;">;;                </span><span style="font-weight: bold; font-style: italic;">(mac-handle-input-method-change))</span>
    <span style="font-weight: bold; font-style: italic;">;;              </span><span style="font-weight: bold; font-style: italic;">(setq previous-buffer (current-buffer))))))))</span>
    )


   <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">EMP: Emacs Mac Port</span>
   ((eq window-system 'mac)
    (<span style="font-weight: bold;">when</span> (fboundp 'mac-input-source)
      (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-mac-keyboard-input-source</span> () <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Need update</span>
        (<span style="font-weight: bold;">if</span> (string-match <span style="font-style: italic;">"\\.Roman$"</span> (mac-input-source))
            (<span style="font-weight: bold;">progn</span>
              (<span style="font-weight: bold;">setq</span> cursor-type (plist-get my-cur-type-ime <span style="font-weight: bold;">:off</span>))
              (add-to-list 'default-frame-alist
                           `(cursor-type . ,(plist-get my-cur-type-ime <span style="font-weight: bold;">:off</span>)))
              (set-cursor-color (plist-get my-cur-color-ime <span style="font-weight: bold;">:off</span>)))
          (<span style="font-weight: bold;">progn</span>
            (<span style="font-weight: bold;">setq</span> cursor-type (plist-get my-cur-type-ime <span style="font-weight: bold;">:on</span>))
            (add-to-list 'default-frame-alist
                         `(cursor-type . ,(plist-get my-cur-type-ime <span style="font-weight: bold;">:on</span>)))
            (set-cursor-color (plist-get my-cur-color-ime <span style="font-weight: bold;">:on</span>)))))

      (<span style="font-weight: bold;">when</span> (fboundp 'mac-auto-ascii-mode)
        <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(mac-auto-ascii-mode 1)</span>
        <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">IME ON/OFF &#12391;&#12459;&#12540;&#12477;&#12523;&#12398;&#31278;&#21029;&#12420;&#33394;&#12434;&#26367;&#12360;&#12427;</span>
        (add-hook 'mac-selected-keyboard-input-source-change-hook
                  #'my-mac-keyboard-input-source)
        <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">IME ON &#12398;&#33521;&#35486;&#20837;&#21147;&#65291;&#27770;&#23450;&#24460;&#12391;&#12418;&#12459;&#12540;&#12477;&#12523;&#12398;&#31278;&#21029;&#12420;&#33394;&#12434;&#26367;&#12360;&#12427;</span>
        <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(add-hook 'mac-enabled-keyboard-input-sources-change-hook</span>
        <span style="font-weight: bold; font-style: italic;">;;           </span><span style="font-weight: bold; font-style: italic;">#'my-mac-keyboard-input-source)</span>
        (<span style="font-weight: bold;">declare-function</span> my-mac-keyboard-input-source <span style="font-style: italic;">"init"</span> nil)
        (my-mac-keyboard-input-source))))

   (t nil)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org5f12ba92" class="outline-3">
<h3 id="org5f12ba92"><span class="section-number-3">11.2</span> [moom.el] キーボードでフレームの場所を移す</h3>
<div class="outline-text-3" id="text-org5f12ba92">
<p>
(2017-07-30) frame-ctr から moom.el にリネームしました．Moom は，Many Tricks がリリースするソフトウェアで，今後はこのソフトウェアのポーティングを目指します．
</p>

<p>
拙作の <a href="https://github.com/takaxp/moom">moom.el</a> を使います．
</p>

<p>
ビルトインに <code>face-remap</code> があり，アスキーフォントは <code>C-x C--</code> と <code>C-x C-=</code> で拡大縮小を制御できます．以下のキーバインドは，face-remap.el が提供する text-scale-adjust のキーバインドを上書きします． <code>text-scale-adjust</code> をそのまま使っても，日本語フォントが制御されないので，オーバーライドしてしまってもOKだと思います．
</p>

<p>
近しいパッケージに， <code>WindMove</code> と <code>FrameMove</code> がありますが，これらは基本的にカーソルの移動を目的にしています．
</p>

<ul class="org-ul">
<li><a href="https://www.emacswiki.org/emacs/WindMove">{Home} Wind Move</a> (ビルトイン)
<ul class="org-ul">
<li>ウィンドウ間のカーソル移動を改善</li>
</ul></li>
<li><a href="https://www.emacswiki.org/emacs/FrameMove">{Home} Frame Move</a>
<ul class="org-ul">
<li>フレーム間のカーソル移動を改善</li>
</ul></li>
</ul>

<p>
また類似のパッケージに <code>frame-cmds</code> があります．
</p>

<ol class="org-ol">
<li><a href="http://www.emacswiki.org/emacs/download/frame-cmds.el">http://www.emacswiki.org/emacs/download/frame-cmds.el</a></li>
<li><a href="http://www.emacswiki.org/emacs/download/frame-fns.el">http://www.emacswiki.org/emacs/download/frame-fns.el</a></li>
</ol>

<p>
<code>moom-autuloads</code> に必要なコマンドを <del>羅列していますが，</del> <code>melpa</code> でインストールする場合は関係ありません．パッケージ内で autoload 指定してあります． <code>with-eval-after-load</code> の中だけを設定すれば十分です．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">declare-function</span> my-font-config <span style="font-style: italic;">"init"</span> nil)
(<span style="font-weight: bold;">defconst</span> <span style="font-weight: bold; font-style: italic;">moom-autoloads</span>
  '(moom-cycle-frame-height
    moom-move-frame-to-edge-top moom-move-frame my-frame-reset
    moom-toggle-frame-maximized moom-move-frame-to-edge-right
    moom-move-frame-to-center moom-move-frame-right moom-move-frame-left
    moom-fill-display-band moom-move-frame-to-edge-right moom-fill-band
    moom-change-frame-width moom-change-frame-width-double
    moom-change-frame-width-single moom-change-frame-width-half-again))

(<span style="font-weight: bold;">when</span> (autoload-if-found
       moom-autoloads
       <span style="font-style: italic;">"moom"</span> nil t)

  (global-set-key (kbd <span style="font-style: italic;">"&lt;f2&gt;"</span>) 'moom-cycle-frame-height)
  (global-set-key (kbd <span style="font-style: italic;">"M-2"</span>) 'moom-move-frame-to-center)
  (global-set-key (kbd <span style="font-style: italic;">"M-&lt;f2&gt;"</span>) 'moom-toggle-frame-maximized)

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"moom"</span>
    (add-hook 'moom-split-window-hook #'dimmer-permanent-off)
    (add-hook 'moom-delete-window-hook #'dimmer-on)

    (moom-recommended-keybindings 'all)
    (<span style="font-weight: bold;">setq</span> moom-command-with-centering nil)
    (<span style="font-weight: bold;">setq</span> moom-lighter <span style="font-style: italic;">"M"</span>)
    (<span style="font-weight: bold;">setq</span> moom-verbose t)
    (moom-mode 1)
    (my-font-config)))  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">this could increase `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">postpone-init-time</span><span style="font-weight: bold; font-style: italic;">'.</span>

(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(moom-font-increase
         moom-font-decrease moom-font-size-reset moom-font-resize)
       <span style="font-style: italic;">"moom-font"</span> nil t)

  (add-hook 'moom-font-after-resize-hook #'moom-move-frame-to-edge-top)
  (add-hook 'moom-font-after-resize-hook #'moom-fill-height)

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"moom-font"</span>
    (<span style="font-weight: bold;">setq</span> moom-scaling-gradient (/ (float 50) 30))
    (<span style="font-weight: bold;">setq</span> moom-font-table
          '((50 30) (49 29) (48 29) (47 28) (46 28) (45 27) (44 26) (43 26)
            (42 25) (41 25) (40 24) (39 23) (38 23) (37 22) (36 22) (35 21)
            (34 20) (33 20) (32 19) (31 19) (30 18) (29 17) (28 17) (27 16)
            (26 16) (25 15) (24 14) (23 14) (22 13) (21 13) (20 12) (19 11)
            (18 11) (17 10) (16 10) (15 9) (14 8) (13 8) (12 7) (11 7) (10 6)
            (9 5) (8 5) (7 4) (6 4) (5 3)))))
</pre>
</div>
</div>

<div id="outline-container-org6e3c20dd" class="outline-4">
<h4 id="org6e3c20dd"><span class="section-number-4">11.2.1</span> 最大化時にモードラインを消す</h4>
<div class="outline-text-4" id="text-org6e3c20dd">
<p>
バッファの切替時にモードラインの状態を引き継ぐこともできますが，とりあえず想定外にしています．代わりに，必要ならば <code>M-x my-moom-toggle-mode-line</code> で表示可能にしています．
</p>

<p>
マイナーモードとして扱えるようにするには，Bastien氏の記事が参考になります．
</p>

<ul class="org-ul">
<li><a href="https://emacs-doctor.com/emacs-hide-mode-line.html">Emacs mode for hiding the mode-line</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(global-set-key (kbd <span style="font-style: italic;">"&lt;f12&gt;"</span>) 'my-toggle-mode-line)
(<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"moom"</span>
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">ad:moom-toggle-frame-maximized</span> ()
    (<span style="font-weight: bold;">when</span> (eq major-mode 'org-mode)
      (org-redisplay-inline-images))
    (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">and</span> mode-line-format
               (not my-toggle-modeline-global))
      (my-mode-line-off)))
  (advice-add 'moom-toggle-frame-maximized
              <span style="font-weight: bold;">:after</span> #'ad:moom-toggle-frame-maximized))

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(make-variable-buffer-local 'my-mode-line-format)</span>
(<span style="font-weight: bold;">defvar-local</span> <span style="font-weight: bold; font-style: italic;">my-mode-line-format</span> nil)
(set-default 'my-mode-line-format mode-line-format)
(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my-toggle-modeline-global</span> t)
(<span style="font-weight: bold;">unless</span> (display-graphic-p)
  (<span style="font-weight: bold;">setq</span> my-toggle-modeline-global t)) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Enforce modeline in Terminal</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-toggle-modeline-global</span> ()
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">setq</span> my-toggle-modeline-global (not my-toggle-modeline-global))
  (<span style="font-weight: bold;">if</span> my-toggle-modeline-global
      (my-mode-line-on)
    (my-mode-line-off)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-mode-line-off</span> ()
  <span style="font-style: italic;">"Turn off mode line."</span>
  (<span style="font-weight: bold;">when</span> (fboundp 'dimmer-on)
    (dimmer-on))
  (<span style="font-weight: bold;">when</span> (fboundp 'pomodoro:visualize-stop)
    (pomodoro:visualize-stop))
  (<span style="font-weight: bold;">when</span> mode-line-format
    (<span style="font-weight: bold;">setq</span> my-mode-line-format mode-line-format))
  (<span style="font-weight: bold;">setq</span> mode-line-format nil))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-mode-line-on</span> ()
  <span style="font-style: italic;">"Turn on mode line."</span>
  (<span style="font-weight: bold;">when</span> (fboundp 'dimmer-off)
    (dimmer-off))
  (<span style="font-weight: bold;">when</span> (fboundp 'pomodoro:visualize-start)
    (pomodoro:visualize-start))
  (<span style="font-weight: bold;">unless</span> my-mode-line-format
    (<span style="font-weight: bold;">error</span> <span style="font-style: italic;">"Invalid value: %s"</span> my-mode-line-format))
  (<span style="font-weight: bold;">setq</span> mode-line-format my-mode-line-format)
  (redraw-frame))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-toggle-mode-line</span> ()
  <span style="font-style: italic;">"Toggle mode line."</span>
  (<span style="font-weight: bold;">interactive</span>)
  (<span style="font-weight: bold;">if</span> mode-line-format
      (my-mode-line-off)
    (my-mode-line-on))
  (message <span style="font-style: italic;">"%s"</span> (<span style="font-weight: bold;">if</span> mode-line-format <span style="font-style: italic;">"( &#9593; &#9697;&#9593;)&#65346; ON !"</span> <span style="font-style: italic;">"( &#9593; ^&#9593;)&#65360; OFF!"</span>)))

(add-hook 'find-file-hook
          (<span style="font-weight: bold;">lambda</span> () (<span style="font-weight: bold;">unless</span> my-toggle-modeline-global
                       (<span style="font-weight: bold;">if</span> shutup-p
                           (shut-up (my-mode-line-off))
                         (my-mode-line-off))))
          t) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#20182;&#12398;&#35373;&#23450;&#65288;olivetti.el&#12394;&#12393;&#65289;&#12392;&#12406;&#12388;&#12363;&#12427;&#12398;&#12391;&#26368;&#24460;&#12395;&#36861;&#21152;</span>

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">init</span>
(my-mode-line-off)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org33fd785f" class="outline-3">
<h3 id="org33fd785f"><span class="section-number-3">11.3</span> [winner.el] ウィンドウ構成の履歴を辿る</h3>
<div class="outline-text-3" id="text-org33fd785f">
<ul class="org-ul">
<li>ビルトインの <code>winner.el</code> を使います．</li>
</ul>

<p>
ウィンドウ分割状況と各ウィンドウで表示していたバッファの履歴を辿ることができます． <code>winner-undo</code> で直前の状態に戻せます．例えば，誤って <code>C-x 0</code> で分割ウィンドウを閉じた時にも，即座に元の状態に戻すことが可能です．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">unless</span> noninteractive
  (postpone-message <span style="font-style: italic;">"winner-mode"</span>)
  (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">winner</span> nil t)
    (define-key winner-mode-map (kbd <span style="font-style: italic;">"C-x g"</span>) 'winner-undo)
    (define-key winner-mode-map (kbd <span style="font-style: italic;">"C-("</span>) 'winner-undo)
    (define-key winner-mode-map (kbd <span style="font-style: italic;">"C-)"</span>) 'winner-redo)
    (winner-mode 1)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orga9be167a" class="outline-3">
<h3 id="orga9be167a"><span class="section-number-3">11.4</span> <span class="todo TODO">TODO</span> [shackle.el] ポップアップウィンドウの制御&#xa0;&#xa0;&#xa0;<span class="tag"><span class="Ongoing">Ongoing</span></span></h3>
<div class="outline-text-3" id="text-orga9be167a">
<ul class="org-ul">
<li>popwin の後発パッケージ</li>
<li>popwin.el にある <code>dedicated</code> が使えないので，本当に移行するか検討中．
<ul class="org-ul">
<li>ウィンドウからフォーカスが外れた時に自動的にウィンドウを消す機能</li>
</ul></li>
<li>以下の設定では，パッケージ読み込みのトリガーを <code>postpone</code> にひも付け</li>
<li>align がないと，size が効かない？</li>
<li>バッファ名に正規表現を使う時は，regexpが必要．</li>
<li>org関連でディスパッチャとそれを経由するバッファは制御が効かない？</li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">shackle</span> nil t)
  (<span style="font-weight: bold;">setq</span> shackle-default-ratio 0.33)
  (<span style="font-weight: bold;">setq</span> shackle-rules
        '((<span style="font-style: italic;">"*osx-dictionary*"</span> <span style="font-weight: bold;">:align</span> above <span style="font-weight: bold;">:popup</span> t)
          (<span style="font-style: italic;">"*wclock*"</span> <span style="font-weight: bold;">:align</span> above <span style="font-weight: bold;">:popup</span> t <span style="font-weight: bold;">:select</span> t)
          (<span style="font-style: italic;">"*Checkdoc Status*"</span> <span style="font-weight: bold;">:align</span> above <span style="font-weight: bold;">:popup</span> t <span style="font-weight: bold;">:noselect</span> t)
          <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">("*Help*" :align t :select 'above :popup t :size 0.3)</span>
          ))
  (<span style="font-weight: bold;">unless</span> noninteractive
    (shackle-mode 1)))
</pre>
</div>
</div>

<div id="outline-container-org32b579df" class="outline-4">
<h4 id="org32b579df"><span class="section-number-4">11.4.1</span> checkdoc.el 用の追加設定</h4>
<div class="outline-text-4" id="text-org32b579df">
<p>
<code>M-x checkdoc</code> 実行時に <code>checkdoc-minor-mode-map</code> に checkdoc のウィンドウを閉じるキーバインドを設定． <code>q</code> または <code>C-g</code> を押下すると，マイナーモードが終了し，設定したキーバインドが無効になる．マイナーモードが有効な間は， <code>q</code> が占有されてバッファに入力できなくなる．その場合は，必要に応じて <code>M-x my-delete-checkdoc-window</code> を実行する．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"checkdoc"</span>
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-delete-checkdoc-window</span> ()
    (<span style="font-weight: bold;">interactive</span>)
    (<span style="font-weight: bold;">let</span> ((checkdoc-window (get-buffer-window <span style="font-style: italic;">"*Checkdoc Status*"</span>)))
      (<span style="font-weight: bold;">when</span> checkdoc-window
        (delete-window checkdoc-window)))
    (checkdoc-minor-mode -1))

  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">ad:checkdoc</span> ()
    (<span style="font-weight: bold;">interactive</span>)
    (define-key checkdoc-minor-mode-map (kbd <span style="font-style: italic;">"q"</span>)
      'my-delete-checkdoc-window)
    (define-key checkdoc-minor-mode-map (kbd <span style="font-style: italic;">"C-g"</span>)
      'my-delete-checkdoc-window)
    (checkdoc-minor-mode 1))

  (advice-add 'checkdoc <span style="font-weight: bold;">:before</span> #'ad:checkdoc))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgdca5e7c2" class="outline-3">
<h3 id="orgdca5e7c2"><span class="section-number-3">11.5</span> <span class="todo TODO">TODO</span> [doom-modeline.el] モードラインをリッチにする</h3>
<div class="outline-text-3" id="text-orgdca5e7c2">
<ul class="org-ul">
<li><a href="https://github.com/seagle0128/doom-modeline">seagle0128/doom-modeline: A minimal and modern mode-line</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"moom"</span>
  (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">and</span> (not noninteractive)
             (eq my-toggle-modeline-global 'doom)
             (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">doom-modeline</span> nil t))
    (custom-set-variables
     '(doom-modeline-buffer-file-name-style 'truncate-except-project)
     '(doom-modeline-bar-width 1)
     '(doom-modeline-height (<span style="font-weight: bold;">let</span> ((font (face-font 'mode-line)))
                              (<span style="font-weight: bold;">if</span> (<span style="font-weight: bold;">and</span> font (fboundp 'font-info))
                                  (floor (* 0.8 <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">1.0</span>
                                            (* 2 (aref (font-info font) 2))))
                                10)))
     '(doom-modeline-minor-modes t))
    (<span style="font-weight: bold;">declare-function</span> ad:doom-modeline-buffer-file-state-icon <span style="font-style: italic;">"init"</span> nil)
    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">ad:doom-modeline-buffer-file-state-icon</span>
        (icon <span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> text face height voffset)
      <span style="font-style: italic;">"Displays an ICON with FACE, HEIGHT and VOFFSET.</span>
<span style="font-style: italic;">TEXT is the alternative if it is not applicable.</span>
<span style="font-style: italic;">Uses `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">all-the-icons-material</span><span style="font-style: italic;">' to fetch the icon."</span>
      (<span style="font-weight: bold;">if</span> doom-modeline-icon
          (<span style="font-weight: bold;">when</span> icon
            (doom-modeline-icon-material
             icon
             <span style="font-weight: bold;">:face</span> face
             <span style="font-weight: bold;">:height</span> (<span style="font-weight: bold;">or</span> height 0.85) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">1.1</span>
             <span style="font-weight: bold;">:v-adjust</span> (<span style="font-weight: bold;">or</span> voffset -0.225))) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">-0.225</span>
        (<span style="font-weight: bold;">when</span> text
          (propertize text 'face face))))
    (advice-add 'doom-modeline-buffer-file-state-icon <span style="font-weight: bold;">:override</span>
                #'ad:doom-modeline-buffer-file-state-icon)
    (size-indication-mode 1)
    (doom-modeline-mode 1)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org4dd0671c" class="outline-3">
<h3 id="org4dd0671c"><span class="section-number-3">11.6</span> [e2wm.el] 二画面表示&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></h3>
<div class="outline-text-3" id="text-org4dd0671c">
<p>
使用頻度が低くなりました．
</p>

<ol class="org-ol">
<li><a href="http://github.com/kiwanami/emacs-window-manager/raw/master/e2wm.el">http://github.com/kiwanami/emacs-window-manager/raw/master/e2wm.el</a></li>
<li><a href="http://github.com/kiwanami/emacs-window-layout/raw/master/window-layout.el">http://github.com/kiwanami/emacs-window-layout/raw/master/window-layout.el</a></li>
</ol>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(my-e2wm:dp-two e2wm:dp-two e2wm:start-management)
       <span style="font-style: italic;">"e2wm"</span> nil t)

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"e2wm"</span>
    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-e2wm:dp-two</span> ()
      (<span style="font-weight: bold;">interactive</span>)
      (e2wm:dp-two)
      (<span style="font-weight: bold;">setq</span> e2wm:c-two-recipe
            '(- (<span style="font-weight: bold;">:lower-size</span> 10)
                (| left right)
                sub))
      (<span style="font-weight: bold;">setq</span> e2wm:c-two-winfo
            '((<span style="font-weight: bold;">:name</span> left )
              (<span style="font-weight: bold;">:name</span> right )
              (<span style="font-weight: bold;">:name</span> sub <span style="font-weight: bold;">:default-hide</span> t)))

      <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">left, prev</span>
      (<span style="font-weight: bold;">setq</span> e2wm:c-two-right-default 'left))

    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#39640;&#12373;&#12434;&#30011;&#38754;&#12398;&#26368;&#22823;&#12395;&#30703;&#27491;</span>
    (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">moom</span> nil t)
      (<span style="font-weight: bold;">setq</span> moom-frame-height-tall (moom-max-frame-height))
      (<span style="font-weight: bold;">setq</span> moom-frame-height-small moom-frame-height-tall))

    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#24133;&#12434;&#30011;&#38754;&#12398;&#26368;&#22823;&#12395;&#30703;&#27491;</span>
    (add-hook 'e2wm:pre-start-hook
              (<span style="font-weight: bold;">lambda</span> ()
                  (set-frame-width
                   (selected-frame)
                   (/ (- (display-pixel-width) 30) (frame-char-width)))))

    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#24133;&#12434;&#12487;&#12501;&#12457;&#12523;&#12488;&#20516;&#12395;&#25147;&#12377;</span>
    (add-hook 'e2wm:post-stop-hook
              (<span style="font-weight: bold;">lambda</span> ()
                  (set-frame-width (selected-frame)
                                   moom--frame-width)))

    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">To avoid rebooting issue when using desktop.el and recentf.el</span>
    (add-hook 'kill-emacs-hook
              (<span style="font-weight: bold;">lambda</span> ()
                  (<span style="font-weight: bold;">when</span> (fboundp 'e2wm:stop-management)
                    (e2wm:stop-management))))))
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">setting for e2wm</span>
(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(change-frame-double-window
         change-frame-single-window)
       <span style="font-style: italic;">"frame-ctr-e2wm"</span> nil t)
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Set the frame width single size</span>
  <span style="font-weight: bold; font-style: italic;">;;  </span><span style="font-weight: bold; font-style: italic;">C-u C-x - =&gt; e2wm OFF, single size width and double height, move center</span>
  (global-set-key (kbd <span style="font-style: italic;">"C-x -"</span>) 'change-frame-single-window)
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Set the frame width double size</span>
  <span style="font-weight: bold; font-style: italic;">;;  </span><span style="font-weight: bold; font-style: italic;">C-u C-x = =&gt; e2wm ON, double size width and height, move to the center</span>
  (global-set-key (kbd <span style="font-style: italic;">"C-x ="</span>) 'change-frame-double-window))
</pre>
</div>
</div>
</div>

<div id="outline-container-org0c556404" class="outline-3">
<h3 id="org0c556404"><span class="section-number-3">11.7</span> [tabbar-ruler] バッファをタブ切り替え可能に&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></h3>
<div class="outline-text-3" id="text-org0c556404">
<ul class="org-ul">
<li>不要かな</li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">tabbar-ruler</span> nil t)
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(when (require 'tabbar-ruler nil t)</span>
  (<span style="font-weight: bold;">setq</span> tabbar-ruler-global-tabbar t) <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">If you want tabbar</span>
  (<span style="font-weight: bold;">setq</span> tabbar-ruler-popup-menu t) <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">If you want a popup menu.</span>
  (<span style="font-weight: bold;">setq</span> tabbar-ruler-popup-toolbar t) <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">If you want a popup toolbar</span>
  <span style="font-weight: bold; font-style: italic;">;;  </span><span style="font-weight: bold; font-style: italic;">(setq tabbar-ruler-fancy-tab-separator 'round)</span>
  <span style="font-weight: bold; font-style: italic;">;;  </span><span style="font-weight: bold; font-style: italic;">(setq tabbar-ruler-fancy-current-tab-separator 'round)</span>
  (<span style="font-weight: bold;">setq</span> tabbar-ruler-invert-deselected nil)
  (<span style="font-weight: bold;">setq</span> tabbar-ruler-modified-symbol t))
</pre>
</div>
</div>
</div>

<div id="outline-container-org6474a498" class="outline-3">
<h3 id="org6474a498"><span class="section-number-3">11.8</span> [elscreen.el] Emacs バッファをタブ化&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></h3>
<div class="outline-text-3" id="text-org6474a498">
<ul class="org-ul">
<li>cycle-buffer で十分かなと言う感じで不使用になりました．</li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;;; </span><span style="font-weight: bold; font-style: italic;">ElScreen (require apel) ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;</span>
<span style="font-weight: bold; font-style: italic;">;;; </span><span style="font-weight: bold; font-style: italic;">Note: change a string in the elscreen.el from "mac" to "ns"</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">2011-10-26: e2wm's perspective (two) mode is more useful for me.</span>
(load <span style="font-style: italic;">"elscreen"</span> <span style="font-style: italic;">"ElScreen"</span> t)
</pre>
</div>
</div>
</div>

<div id="outline-container-org750d9aa5" class="outline-3">
<h3 id="org750d9aa5"><span class="section-number-3">11.9</span> [popwin.el] ポップアップウィンドウの制御&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></h3>
<div class="outline-text-3" id="text-org750d9aa5">
<ul class="org-ul">
<li>現在は緩やかに <code>shackle</code> に移行中です．
<ul class="org-ul">
<li>ただし， <code>dedicated</code> オプションが使えないので，ウィンドウからフォーカスが外れた時に自動的にウィンドウを消すことができません．
<ul class="org-ul">
<li>それぞれに <code>q</code> を実装すれば，近い動作にはできる．</li>
</ul></li>
</ul></li>
<li><a href="https://github.com/m2ym/popwin-el/">https://github.com/m2ym/popwin-el/</a></li>
<li>popwin:display-buffer を autoload してもうまくいかない．</li>
</ul>

<p>
<code>postpone</code> の後に呼んでいるのは，Emacs起動時の単純な高速化対策です．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">for emacs 24.1</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(setq special-display-function 'popwin:special-display-popup-window)</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(setq display-buffer-function 'popwin:display-buffer)</span>

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">for emacs 24.3</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(setq special-display-alist 'popwin:special-display-popup-window)</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(setq display-buffer-alist 'popwin:display-buffer)</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(push '("*sdic*" :position top) popwin:special-display-config)</span>

(<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"postpone"</span>
  (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">popwin</span> nil t)
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Performed in shackle</span>
    (<span style="font-weight: bold;">push</span> '(<span style="font-style: italic;">"*Help*"</span> <span style="font-weight: bold;">:height</span> 20 <span style="font-weight: bold;">:position</span> top <span style="font-weight: bold;">:dedicated</span> t)
          popwin:special-display-config)
    (<span style="font-weight: bold;">push</span> '(<span style="font-style: italic;">"*osx-dictionary*"</span> <span style="font-weight: bold;">:height</span> 20 <span style="font-weight: bold;">:position</span> top <span style="font-weight: bold;">:dedicated</span> t)
          popwin:special-display-config)
    (<span style="font-weight: bold;">push</span> '(<span style="font-style: italic;">"*wclock*"</span> <span style="font-weight: bold;">:height</span> 10 <span style="font-weight: bold;">:position</span> top <span style="font-weight: bold;">:dedicated</span> t)
          popwin:special-display-config)

    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Checking...</span>
    (<span style="font-weight: bold;">push</span> '(<span style="font-style: italic;">"*Checkdoc Status*"</span> <span style="font-weight: bold;">:position</span> top <span style="font-weight: bold;">:dedicated</span> t)
          popwin:special-display-config)
    (<span style="font-weight: bold;">push</span> '(<span style="font-style: italic;">"*frequencies*"</span> <span style="font-weight: bold;">:height</span> 20 <span style="font-weight: bold;">:position</span> bottom <span style="font-weight: bold;">:dedicated</span> t)
          popwin:special-display-config)
    (<span style="font-weight: bold;">push</span> '(<span style="font-style: italic;">"CAPTURE-next.org"</span> <span style="font-weight: bold;">:height</span> 10 <span style="font-weight: bold;">:position</span> bottom <span style="font-weight: bold;">:noselect</span> t)
          popwin:special-display-config)
    (<span style="font-weight: bold;">push</span> '(<span style="font-style: italic;">"CAPTURE-org-ical.org"</span><span style="font-weight: bold;">:height</span> 10 <span style="font-weight: bold;">:position</span> bottom <span style="font-weight: bold;">:noselect</span> t)
          popwin:special-display-config)
    (<span style="font-weight: bold;">push</span> '(<span style="font-style: italic;">"dict-app-result"</span> <span style="font-weight: bold;">:height</span> 20 <span style="font-weight: bold;">:position</span> bottom)
          popwin:special-display-config)
    (<span style="font-weight: bold;">push</span> '(<span style="font-style: italic;">"*timer*"</span> <span style="font-weight: bold;">:height</span> 20 <span style="font-weight: bold;">:position</span> bottom <span style="font-weight: bold;">:dedicated</span> t)
          popwin:special-display-config)
    (<span style="font-weight: bold;">push</span> '(<span style="font-style: italic;">"Calendar"</span> <span style="font-weight: bold;">:position</span> top <span style="font-weight: bold;">:dedicated</span> t)
          popwin:special-display-config)
    (<span style="font-weight: bold;">push</span> '(<span style="font-style: italic;">"*Org Dashboard*"</span> <span style="font-weight: bold;">:position</span> bottom)
          popwin:special-display-config)
    (<span style="font-weight: bold;">push</span> '(<span style="font-style: italic;">"*Org Select*"</span> <span style="font-weight: bold;">:height</span> 10 <span style="font-weight: bold;">:position</span> bottom)
          popwin:special-display-config)
    (<span style="font-weight: bold;">push</span> '(<span style="font-style: italic;">"*Org Grep*"</span> <span style="font-weight: bold;">:height</span> 20 <span style="font-weight: bold;">:position</span> bottom <span style="font-weight: bold;">:dedicated</span> t)
          popwin:special-display-config)
    (<span style="font-weight: bold;">push</span> '(<span style="font-style: italic;">"*Occur*"</span> <span style="font-weight: bold;">:height</span> 10 <span style="font-weight: bold;">:position</span> bottom)
          popwin:special-display-config)
    (<span style="font-weight: bold;">push</span> '(<span style="font-style: italic;">"*Shell Command Output*"</span> <span style="font-weight: bold;">:height</span> 10 <span style="font-weight: bold;">:position</span> bottom <span style="font-weight: bold;">:dedicated</span> t)
          popwin:special-display-config)
    (<span style="font-weight: bold;">push</span> '(<span style="font-style: italic;">"*eshell*"</span> <span style="font-weight: bold;">:height</span> 10 <span style="font-weight: bold;">:position</span> bottom)
          popwin:special-display-config)
<span style="font-weight: bold; font-style: italic;">;;;            </span><span style="font-weight: bold; font-style: italic;">(undo-tree-visualizer-buffer-name :height 10 :position top)</span>
<span style="font-weight: bold; font-style: italic;">;;;            </span><span style="font-weight: bold; font-style: italic;">(undo-tree-diff-buffer-name :height 20 :position bottom)</span>

    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Not performed</span>
    (<span style="font-weight: bold;">push</span> '(<span style="font-style: italic;">"*Org Agenda*"</span> <span style="font-weight: bold;">:height</span> 10 <span style="font-weight: bold;">:position</span> top)
          popwin:special-display-config))

  (<span style="font-weight: bold;">unless</span> noninteractive
    (popwin-mode 1)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org7a20b311" class="outline-3">
<h3 id="org7a20b311"><span class="section-number-3">11.10</span> <span class="done DONE">DONE</span> [olivetti.el] ウィンドウを中央寄せで配置&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></h3>
<div class="outline-text-3" id="text-org7a20b311">
<ul class="org-ul">
<li><a href="https://github.com/rnkn/olivetti">rnkn/olivetti: Emacs minor mode for a nice writing environment</a></li>
</ul>

<p>
<code>moom.el</code> を使ってフレームを最大化したり，画面の半分に配置すると，80桁で表示する領域とウィンドウが占める領域の幅が一致しない場合があります．通常は，フレーム内で左寄せに配置されますが， <code>olivetti</code> を使うと，中央寄せにできます．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">late-init.el</span>
(<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"moom"</span>
  (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">olivetti</span> nil t)
    (<span style="font-weight: bold;">setq</span> olivetti-lighter nil)
    (<span style="font-weight: bold;">setq-default</span> olivetti-body-width 80)
    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">ad:turn-on-olivetti-mode</span> ()
      <span style="font-style: italic;">"Disable `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">visual-line-mode</span><span style="font-style: italic;">'."</span>
      (<span style="font-weight: bold;">unless</span> moom--maximized
        (olivetti-mode -1))
      (visual-line-mode -1))
    (advice-add 'turn-on-olivetti-mode <span style="font-weight: bold;">:after</span> #'ad:turn-on-olivetti-mode)
    (add-hook 'find-file-hook #'turn-on-olivetti-mode)
    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">ad:olivetti:moom-toggle-frame-maximized</span> ()
      (<span style="font-weight: bold;">if</span> moom--maximized
          (turn-on-olivetti-mode)
        (olivetti-mode -1)))
    (advice-add 'moom-toggle-frame-maximized <span style="font-weight: bold;">:after</span>
                #'ad:olivetti:moom-toggle-frame-maximized)))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgf57ce845" class="outline-2">
<h2 id="orgf57ce845"><span class="section-number-2">12</span> フォント／配色関連</h2>
<div class="outline-text-2" id="text-orgf57ce845">
</div>
<div id="outline-container-orgbbb079d3" class="outline-3">
<h3 id="orgbbb079d3"><span class="section-number-3">12.1</span> 正規表現を見やすくする</h3>
<div class="outline-text-3" id="text-orgbbb079d3">
<p>
Emacs Lisp の正規表現を色付けします．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(set-face-foreground 'font-lock-regexp-grouping-backslash <span style="font-style: italic;">"#66CC99"</span>)
(set-face-foreground 'font-lock-regexp-grouping-construct <span style="font-style: italic;">"#9966CC"</span>)
</pre>
</div>

<p>
Emacs Lisp で正規表現入力をサポートするツールには， <code>M-x re-builder</code> や <code>rx</code> マクロがある．
</p>

<ul class="org-ul">
<li><a href="http://www.emacswiki.org/emacs/ReBuilder">EmacsWiki: Re Builder</a></li>
<li><a href="http://emacswiki.org/emacs/rx">EmacsWiki: rx</a></li>
</ul>
</div>
</div>

<div id="outline-container-orgc98c6fff" class="outline-3">
<h3 id="orgc98c6fff"><span class="section-number-3">12.2</span> 設定ファイルを見やすくする</h3>
<div class="outline-text-3" id="text-orgc98c6fff">
<p>
<code>generic-x</code> を使うと， <code>/etc/hosts</code> や <code>/etc/apache2.conf</code> に色を付けられる．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">unless</span> noninteractive
  (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">generic-x</span> nil t))
</pre>
</div>
</div>
</div>

<div id="outline-container-org7858d806" class="outline-3">
<h3 id="org7858d806"><span class="section-number-3">12.3</span> カーソル行に色をつける</h3>
<div class="outline-text-3" id="text-org7858d806">
<ul class="org-ul">
<li>ビルトインの <code>hl-line</code> を使います．</li>
<li><a href="http://murakan.cocolog-nifty.com/blog/2009/01/emacs-tips-1d45.html">http://murakan.cocolog-nifty.com/blog/2009/01/emacs-tips-1d45.html</a></li>
<li><a href="http://www.emacswiki.org/cgi-bin/emacs/highlight-current-line.el">http://www.emacswiki.org/cgi-bin/emacs/highlight-current-line.el</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">unless</span> noninteractive
  (global-hl-line-mode 1))
</pre>
</div>

<p>
色の設定は <code>custom-set-faces</code> で．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my-hl-active-period</span> 120
  <span style="font-style: italic;">"Disable `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">hl-line</span><span style="font-style: italic;">' after this period"</span>)

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-hl-line-disable</span> ()
  <span style="font-style: italic;">"Disable `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">hl-line</span><span style="font-style: italic;">'."</span>
  (global-hl-line-mode -1))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-hl-line-enable</span> ()
  <span style="font-style: italic;">"Enable `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">hl-line</span><span style="font-style: italic;">'."</span>
  (<span style="font-weight: bold;">unless</span> global-hl-line-mode
    (global-hl-line-mode 1)))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-ime-off-hline</span> ()
  (my-hl-line-enable)
  (<span style="font-weight: bold;">let</span> ((dark (eq (frame-parameter nil 'background-mode) 'dark)))
    (set-face-background hl-line-face (<span style="font-weight: bold;">if</span> dark <span style="font-style: italic;">"#484c5c"</span> <span style="font-style: italic;">"#DEEDFF"</span>))))

(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-ime-on-hline</span> ()
  (my-hl-line-enable)
  (<span style="font-weight: bold;">let</span> ((dark (eq (frame-parameter nil 'background-mode) 'dark)))
    (set-face-background hl-line-face (<span style="font-weight: bold;">if</span> dark <span style="font-style: italic;">"#594d5d"</span> <span style="font-style: italic;">"#fff0de"</span>))))

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">init</span>
(<span style="font-weight: bold;">when</span> (fboundp 'mac-ime-active-p)
  (<span style="font-weight: bold;">if</span> (version&lt; emacs-version <span style="font-style: italic;">"27.0"</span>)
      (<span style="font-weight: bold;">if</span> (my-ime-active-p) (my-ime-on-hline) (my-ime-off-hline))
    (<span style="font-weight: bold;">if</span> (mac-ime-active-p) (my-ime-on-hline) (my-ime-off-hline))))

(add-hook 'ah-before-move-cursor-hook #'my-hl-line-enable)
(run-with-idle-timer my-hl-active-period t #'my-hl-line-disable)
(add-hook 'focus-in-hook #'my-hl-line-enable)
(add-hook 'focus-out-hook #'my-hl-line-disable)
(add-hook 'input-method-activate-hook #'my-ime-on-hline)
(add-hook 'input-method-deactivate-hook #'my-ime-off-hline)
</pre>
</div>

<p>
色の変更ではなく，下線に変更したい場合は， <code>(setq hl-line-face 'underline)</code> とする．
</p>
</div>
</div>

<div id="outline-container-org29d5304f" class="outline-3">
<h3 id="org29d5304f"><span class="section-number-3">12.4</span> カーソルの点滅を制御</h3>
<div class="outline-text-3" id="text-org29d5304f">
<p>
以下の例では，入力が止まってから <code>30</code> 秒後に <code>0.2</code> 秒間隔で点滅します．次に入力が始まるまで，点滅が続きます．
</p>

<p>
<code>postpone</code> の後に呼んでいるのは，Emacs起動時の単純な高速化対策です．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">setq</span> blink-cursor-blinks 0)
(<span style="font-weight: bold;">setq</span> blink-cursor-interval 0.2)
(<span style="font-weight: bold;">setq</span> blink-cursor-delay 30)
(<span style="font-weight: bold;">unless</span> noninteractive
  (postpone-message <span style="font-style: italic;">"blink-cursor-mode"</span>)
  (blink-cursor-mode 1))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf36a8366" class="outline-3">
<h3 id="orgf36a8366"><span class="section-number-3">12.5</span> カーソル位置のフォントを確認</h3>
<div class="outline-text-3" id="text-orgf36a8366">
<p>
<code>M-x describe-char</code> すると，カーソル位置のフォントの情報が別バッファに表示されます．
</p>
</div>
</div>

<div id="outline-container-org919a945a" class="outline-3">
<h3 id="org919a945a"><span class="section-number-3">12.6</span> フォント設定</h3>
<div class="outline-text-3" id="text-org919a945a">
<p>
表のような利用環境に対して，個別に設定を施しています．WindowsとLinuxは安定版のEmacs23で，Macは開発版のCocoaEmacs23です．MacではEmacs24でもうまく表示できています．最近は，<a href="http://mix-mplus-ipa.sourceforge.jp/migu/">Migu 2M</a>を気に入って使っています．
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption class="t-above"><span class="table-number">Table 1:</span> 環境別の使用フォント</caption>

<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">ASCII</td>
<td class="org-left">日本語</td>
</tr>

<tr>
<td class="org-left">Mac</td>
<td class="org-left">Monaco</td>
<td class="org-left">Migu 2M 又は ヒラギノ丸ゴ</td>
</tr>

<tr>
<td class="org-left">Windows</td>
<td class="org-left">Inconsolata</td>
<td class="org-left">メイリオ</td>
</tr>

<tr>
<td class="org-left">Linux</td>
<td class="org-left">Inconsolata</td>
<td class="org-left">MigMix</td>
</tr>
</tbody>
</table>

<ul class="org-ul">
<li><a href="http://d.hatena.ne.jp/setoryohei/20110117/1295336454">http://d.hatena.ne.jp/setoryohei/20110117/1295336454</a></li>
<li><a href="http://users.teilar.gr/~g1951d/">Unicode Fonts for Ancient Scripts</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">1) Monaco, Hiragino/Migu 2M : font-size=12, -apple-hiragino=1.2</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">2) Inconsolata, Migu 2M     : font-size=14,</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">3) Inconsolata, Hiragino    : font-size=14, -apple-hiragino=1.0</span>
(<span style="font-weight: bold;">defconst</span> <span style="font-weight: bold; font-style: italic;">my-font-size</span> 12)
(<span style="font-weight: bold;">defconst</span> <span style="font-weight: bold; font-style: italic;">my-ja-font</span> <span style="font-style: italic;">"Migu 2M"</span>) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">"Hiragino Maru Gothic Pro"</span>
(<span style="font-weight: bold;">defconst</span> <span style="font-weight: bold; font-style: italic;">my-ascii-font</span> <span style="font-style: italic;">"Monaco"</span>) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">"Inconsolata", Monaco</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(defconst my-ja-font "Hiragino Maru Gothic Pro") ;; "Hiragino Maru Gothic Pro"</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(defconst my-ascii-font "Inconsolata") ;; "Inconsolata", Menlo, "Ricty Diminished"</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-ja-font-setter</span> (spec)
  (set-fontset-font nil 'japanese-jisx0208 spec)
  (set-fontset-font nil 'katakana-jisx0201 spec)
  (set-fontset-font nil 'japanese-jisx0212 spec)
  (set-fontset-font nil '(#x0080 . #x024F) spec)
  (set-fontset-font nil '(#x0370 . #x03FF) spec)
  (set-fontset-font nil 'mule-unicode-0100-24ff spec))
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-ascii-font-setter</span> (spec)
  (set-fontset-font nil 'ascii spec))
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-unicode-font-setter</span> (spec)
  (set-fontset-font nil 'unicode spec))
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-font-config</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> size ascii ja)
  <span style="font-style: italic;">"Font config.</span>
<span style="font-style: italic;">- SIZE: font size for ASCII and Japanese (default: 12)</span>
<span style="font-style: italic;">- ASCII: ascii font family (default: \"Monaco\")</span>
<span style="font-style: italic;">- JA: Japanese font family (default: \"Migu 2M\")</span>
<span style="font-style: italic;">"</span>
  (<span style="font-weight: bold;">when</span> (memq window-system '(mac ns))
    (<span style="font-weight: bold;">let</span> ((font-size (<span style="font-weight: bold;">or</span> size my-font-size))
          <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(unicode-font (or uc "FreeSerif"))</span>
          (ascii-font (<span style="font-weight: bold;">or</span> ascii my-ascii-font))
          (ja-font (<span style="font-weight: bold;">or</span> ja my-ja-font)))
      <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(my-unicode-font-setter</span>
      <span style="font-weight: bold; font-style: italic;">;;  </span><span style="font-weight: bold; font-style: italic;">(font-spec :family unicode-font :size font-size))</span>
      (my-ascii-font-setter (font-spec <span style="font-weight: bold;">:family</span> ascii-font <span style="font-weight: bold;">:size</span> font-size))
      (my-ja-font-setter (font-spec <span style="font-weight: bold;">:family</span> ja-font <span style="font-weight: bold;">:size</span> font-size)))))

(<span style="font-weight: bold;">cond</span>
 <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">CocoaEmacs</span>
 ((memq window-system '(mac ns))
  (<span style="font-weight: bold;">when</span> (&gt;= emacs-major-version 23)

    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Fix ratio provided by set-face-attribute for fonts display</span>
    (<span style="font-weight: bold;">setq</span> face-font-rescale-alist
          '((<span style="font-style: italic;">"^-apple-hiragino.*"</span> . 1.0) <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">1.2</span>
            (<span style="font-style: italic;">".*Migu.*"</span> . 1.2)
            (<span style="font-style: italic;">".*Ricty.*"</span> . 1.0)
            (<span style="font-style: italic;">".*Inconsolata.*"</span> . 1.0)
            (<span style="font-style: italic;">".*osaka-bold.*"</span> . 1.0)     <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">1.2</span>
            (<span style="font-style: italic;">".*osaka-medium.*"</span> . 1.0)   <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">1.0</span>
            (<span style="font-style: italic;">".*courier-bold-.*-mac-roman"</span> . 1.0) <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">0.9</span>
            <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(".*monaco cy-bold-.*-mac-cyrillic" . 1.0)</span>
            <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(".*monaco-bold-.*-mac-roman" . 1.0) ; 0.9</span>
            (<span style="font-style: italic;">"-cdac$"</span> . 1.0))))) <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">1.3</span>
 <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(my-font-config) ;; see `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">my-theme</span><span style="font-weight: bold; font-style: italic;">'</span>

 ((eq window-system 'ns)
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Anti aliasing with Quartz 2D</span>
  (<span style="font-weight: bold;">when</span> (boundp 'mac-allow-anti-aliasing)
    (<span style="font-weight: bold;">setq</span> mac-allow-anti-aliasing t)))

 ((eq window-system 'w32) <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">windows7</span>
  (<span style="font-weight: bold;">let</span> ((font-size 14)
        (font-height 100)
        (ascii-font <span style="font-style: italic;">"Inconsolata"</span>)
        (ja-font <span style="font-style: italic;">"&#12513;&#12452;&#12522;&#12458;"</span>)) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Meiryo UI</span>
    (my-ja-font-setter
     (font-spec <span style="font-weight: bold;">:family</span> ja-font <span style="font-weight: bold;">:size</span> font-size <span style="font-weight: bold;">:height</span> font-height))
    (my-ascii-font-setter (font-spec <span style="font-weight: bold;">:family</span> ascii-font <span style="font-weight: bold;">:size</span> font-size))
    (<span style="font-weight: bold;">setq</span> face-font-rescale-alist '((<span style="font-style: italic;">".*Inconsolata.*"</span> . 1.0))))) <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">0.9</span>

 ((eq window-system 'x) <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">for SuSE Linux 12.1</span>
  (<span style="font-weight: bold;">let</span>
      ((font-size 14)
       (font-height 100)
       (ascii-font <span style="font-style: italic;">"Inconsolata"</span>)
       <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(ja-font "MigMix 1M")</span>
       (ja-font <span style="font-style: italic;">"Migu 2M"</span>))
    (my-ja-font-setter
     (font-spec <span style="font-weight: bold;">:family</span> ja-font <span style="font-weight: bold;">:size</span> font-size <span style="font-weight: bold;">:height</span> font-height))
    (my-ascii-font-setter (font-spec <span style="font-weight: bold;">:family</span> ascii-font <span style="font-weight: bold;">:size</span> font-size)))
  (<span style="font-weight: bold;">setq</span> face-font-rescale-alist '((<span style="font-style: italic;">".*MigMix.*"</span> . 2.0)
                                  (<span style="font-style: italic;">".*Inconsolata.*"</span> . 1.0))))) <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">0.9</span>
</pre>
</div>
</div>

<div id="outline-container-orgb94aa5b3" class="outline-4">
<h4 id="orgb94aa5b3"><span class="section-number-4">12.6.1</span> フォントのインストール方法</h4>
<div class="outline-text-4" id="text-orgb94aa5b3">
<p>
Linux では次のように処理するだけでよく，意外と簡単．
</p>

<ol class="org-ol">
<li>~/.fonts を作成する</li>
<li>フォントを1.のディレクトリに置く</li>
<li>fc-cache -fv を実行</li>
<li>fc-list でインストールされているかを確認．</li>
</ol>

<p>
なお，Windows では，フォントファイルを右クリックして，インストールを選択するだけでOK．
</p>
</div>
</div>

<div id="outline-container-org66fa6b98" class="outline-4">
<h4 id="org66fa6b98"><span class="section-number-4">12.6.2</span> フォントチェック用コード</h4>
<div class="outline-text-4" id="text-org66fa6b98">
<p>
サンプルの <a href="http://dl.dropbox.com/u/2440/dokuwiki/font-test.org">orgファイル</a> を作って，見た目をチェックしています．バッファ内の桁数チェックや，ASCIIが漢字の半分の幅になっているかのチェックが楽になります．
</p>
</div>
</div>
</div>

<div id="outline-container-org2bcbc1db" class="outline-3">
<h3 id="org2bcbc1db"><span class="section-number-3">12.7</span> 行間を制御する</h3>
<div class="outline-text-3" id="text-org2bcbc1db">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">set-default &#12391; global &#25351;&#23450;&#12377;&#12427;&#12392;&#65292;&#12511;&#12491;&#12496;&#12483;&#12501;&#12449;&#12398; message &#12391;&#21046;&#24481;&#19981;&#33021;&#12395;&#12394;&#12427;</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">propertize &#12391;&#25313;&#22823;&#12391;&#12365;&#12427;&#12364;&#65292;global &#12398;&#20516;&#20197;&#19979;&#12395;&#32302;&#23567;&#12391;&#12365;&#12394;&#12367;&#12394;&#12427;&#65294;</span>
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(set-default 'line-spacing 2)</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-linespacing</span> ()
  (<span style="font-weight: bold;">unless</span> (minibufferp)
    (<span style="font-weight: bold;">setq-local</span> line-spacing 2)))
(add-hook 'buffer-list-update-hook #'my-linespacing)
(add-hook 'org-src-mode-hook #'my-linespacing)
(add-hook 'debugger-mode-hook #'my-linespacing)

(<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"org-agenda"</span>
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-org-agenda</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> _arg _org-keys _restriction)
    (my-linespacing))
  (advice-add 'org-agenda <span style="font-weight: bold;">:after</span> #'my-org-agenda)
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-org-agenda-redo</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> _all)
    (my-linespacing))
  (advice-add 'org-agenda-redo <span style="font-weight: bold;">:after</span> #'my-org-agenda-redo))
</pre>
</div>
</div>
</div>

<div id="outline-container-org372b184d" class="outline-3">
<h3 id="org372b184d"><span class="section-number-3">12.8</span> パッチをカラフルに表示する</h3>
<div class="outline-text-3" id="text-org372b184d">
<p>
Built-in の <a href="http://www.emacswiki.org/emacs/DiffMode">diff-mode.el</a> をカスタマイズします．
</p>

<ul class="org-ul">
<li><a href="http://d.hatena.ne.jp/syohex/20111228/1325086893">http://d.hatena.ne.jp/syohex/20111228/1325086893</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"diff-mode"</span>
  (set-face-attribute 'diff-added nil
                      <span style="font-weight: bold;">:background</span> nil <span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"lime green"</span>
                      <span style="font-weight: bold;">:weight</span> 'normal)

  (set-face-attribute 'diff-removed nil
                      <span style="font-weight: bold;">:background</span> nil <span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"firebrick1"</span>
                      <span style="font-weight: bold;">:weight</span> 'normal)

  (set-face-attribute 'diff-file-header nil
                      <span style="font-weight: bold;">:background</span> nil <span style="font-weight: bold;">:weight</span> 'extra-bold)

  (set-face-attribute 'diff-hunk-header nil
                      <span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"chocolate4"</span>
                      <span style="font-weight: bold;">:background</span> <span style="font-style: italic;">"white"</span> <span style="font-weight: bold;">:weight</span> 'extra-bold
                      <span style="font-weight: bold;">:inherit</span> nil))
</pre>
</div>
</div>
</div>

<div id="outline-container-org009dc6e3" class="outline-3">
<h3 id="org009dc6e3"><span class="section-number-3">12.9</span> 背景を黒系色にする</h3>
<div class="outline-text-3" id="text-org009dc6e3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(custom-set-faces
 '(default ((t
             (<span style="font-weight: bold;">:background</span> <span style="font-style: italic;">"black"</span> <span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#55FF55"</span>)
             ))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org92d26c4b" class="outline-3">
<h3 id="org92d26c4b"><span class="section-number-3">12.10</span> 日中と夜中でテーマを切り替える</h3>
<div class="outline-text-3" id="text-org92d26c4b">
<p>
私は使っていませんが，簡単にテーマを切り替えるためのパッケージ(<a href="https://github.com/valignatev/heaven-and-hell">heaven-and-hell</a>)も存在します．また， <a href="https://github.com/purcell/ns-auto-titlebar">ns-auto-titlebar.el</a> を使うことでも同様の効果が得られます．
</p>

<p>
色々なテーマを試してた後に，その状態をダンプするには次のツールが役立ちます．
</p>
<ul class="org-ul">
<li><a href="https://gist.github.com/condotti/2035942">https://gist.github.com/condotti/2035942</a></li>
</ul>

<p>
私が使っているテーマはこちら．
</p>
<ol class="org-ol">
<li><a href="https://gist.github.com/takaxp/f8763df6de734e3aac6834eb6118c0e9">my theme for light</a></li>
<li><a href="https://gist.github.com/takaxp/5a500d953d15d6d2155b120e886dcd52">my theme for dark</a></li>
</ol>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">declare-function</span> my-daylight-theme <span style="font-style: italic;">"init"</span> nil)
(<span style="font-weight: bold;">declare-function</span> my-night-theme <span style="font-style: italic;">"init"</span> nil)
(<span style="font-weight: bold;">declare-function</span> my-terminal-theme <span style="font-style: italic;">"init"</span> nil)
(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my-light-theme-hook</span> nil)
(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my-dark-theme-hook</span> nil)
(<span style="font-weight: bold;">if</span> (not (display-graphic-p))
    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-terminal-theme</span> ()
      (<span style="font-weight: bold;">interactive</span>)
      (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">terminal-theme</span> nil t)
        (mapc 'disable-theme custom-enabled-themes)
        (load-theme 'terminal t)
        (plist-put my-cur-color-ime <span style="font-weight: bold;">:on</span> <span style="font-style: italic;">"#FF9300"</span>)))

  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-daylight-theme</span> ()
    (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">daylight-theme</span> nil t)
      (mapc 'disable-theme custom-enabled-themes)
      (load-theme 'daylight t)
      (plist-put my-cur-color-ime <span style="font-weight: bold;">:on</span> <span style="font-style: italic;">"#FF9300"</span>)
      (<span style="font-weight: bold;">setq</span> default-frame-alist
            (delete (assoc 'ns-appearance default-frame-alist)
                    default-frame-alist))
      (<span style="font-weight: bold;">setq</span> default-frame-alist
            (delete (assoc 'ns-transparent-titlebar default-frame-alist)
                    default-frame-alist))
      (add-to-list 'default-frame-alist '(ns-transparent-titlebar . t))
      (add-to-list 'default-frame-alist '(ns-appearance . light))
      (modify-frame-parameters nil '((ns-transparent-titlebar . t)
                                     (ns-appearance . light)))
      (run-hooks 'my-light-theme-hook)))

  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-night-theme</span> ()
    (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">night-theme</span> nil t) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">atom-one-dark-theme</span>
      (mapc 'disable-theme custom-enabled-themes)
      (load-theme 'night t)
      (plist-put my-cur-color-ime <span style="font-weight: bold;">:on</span> <span style="font-style: italic;">"RosyBrown"</span>) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">#cebcfe</span>
      (<span style="font-weight: bold;">setq</span> default-frame-alist
            (delete (assoc 'ns-appearance default-frame-alist)
                    default-frame-alist))
      (<span style="font-weight: bold;">setq</span> default-frame-alist
            (delete (assoc 'ns-transparent-titlebar default-frame-alist)
                    default-frame-alist))
      (add-to-list 'default-frame-alist '(ns-transparent-titlebar . t))
      (add-to-list 'default-frame-alist '(ns-appearance . dark))
      (modify-frame-parameters nil '((ns-transparent-titlebar . t)
                                     (ns-appearance . dark)))
      (run-hooks 'my-dark-theme-hook))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org7c97dce0" class="outline-3">
<h3 id="org7c97dce0"><span class="section-number-3">12.11</span> 時間帯を指定して起動時にテーマを切り替える</h3>
<div class="outline-text-3" id="text-org7c97dce0">
<p>
次の例では，19時から翌日の朝5時までの間に夜用のテーマを使っています．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">declare-function</span> my-font-config <span style="font-style: italic;">"init"</span> nil)
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-night-time-p</span> (begin end)
  (<span style="font-weight: bold;">let*</span> ((ch (string-to-number (format-time-string <span style="font-style: italic;">"%H"</span> (current-time))))
         (cm (string-to-number (format-time-string <span style="font-style: italic;">"%M"</span> (current-time))))
         (ct (+ cm (* 60 ch))))
    (<span style="font-weight: bold;">if</span> (&gt; begin end)
        (<span style="font-weight: bold;">or</span> (&lt;= begin ct) (&lt;= ct end))
      (<span style="font-weight: bold;">and</span> (&lt;= begin ct) (&lt;= ct end)))))

(<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my-frame-appearance</span> nil) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">{nil, 'dark, 'light} see init-env.el</span>
(<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-theme</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> type)
  (<span style="font-weight: bold;">interactive</span> <span style="font-style: italic;">"MType (light or dark): "</span>)
  (<span style="font-weight: bold;">setq</span> my-frame-appearance
        (<span style="font-weight: bold;">cond</span> ((member type '(<span style="font-style: italic;">"light"</span> <span style="font-style: italic;">"l"</span>)) 'light)
              ((member type '(<span style="font-style: italic;">"dark"</span> <span style="font-style: italic;">"d"</span>)) 'dark)
              (t
               my-frame-appearance)))
  (<span style="font-weight: bold;">if</span> (display-graphic-p)
      (<span style="font-weight: bold;">cond</span> ((eq my-frame-appearance 'dark)
             (my-night-theme))
            ((eq my-frame-appearance 'light)
             (my-daylight-theme))
            (t
             (<span style="font-weight: bold;">let</span> ((night-time-in 23)
                   (night-time-out 5))
               (<span style="font-weight: bold;">if</span> (my-night-time-p
                    (* night-time-in 60) (* night-time-out 60))
                   (my-night-theme)
                 (my-daylight-theme)))))
    (my-terminal-theme))

  (<span style="font-weight: bold;">unless</span> noninteractive
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">remove unintentional colored frame border</span>
    (select-frame-set-input-focus (selected-frame))
    (my-font-config)
    (my-apply-cursor-config)
    (<span style="font-weight: bold;">when</span> type
      (moom-move-frame-to-edge-top)
      (moom-fill-height))))

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">init. This may override or reset font setting</span>
(<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"postpone"</span>
  (my-theme))

<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(with-eval-after-load "postpone"</span>
<span style="font-weight: bold; font-style: italic;">;;   </span><span style="font-weight: bold; font-style: italic;">(run-at-time "21:00" 86400 'my-theme)</span>
<span style="font-weight: bold; font-style: italic;">;;   </span><span style="font-weight: bold; font-style: italic;">(run-at-time "05:00" 86400 'my-theme)) ;; FIXME: it makes frame blink</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org6d79c76a" class="outline-3">
<h3 id="org6d79c76a"><span class="section-number-3">12.12</span> [hl-todo.el] 特定キーワードの配色を変える</h3>
<div class="outline-text-3" id="text-org6d79c76a">
<ul class="org-ul">
<li><a href="https://github.com/tarsius/hl-todo">hl-todo</a> を導入すれば簡単にできます．</li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(global-hl-todo-mode my-hl-todo-activate)
       <span style="font-style: italic;">"hl-todo"</span> nil t)

  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(defun my-hl-todo-activate ()</span>
  <span style="font-weight: bold; font-style: italic;">;;   </span><span style="font-weight: bold; font-style: italic;">(global-hl-todo-mode)</span>
  <span style="font-weight: bold; font-style: italic;">;;   </span><span style="font-weight: bold; font-style: italic;">(remove-hook 'pre-command-hook #'my-hl-todo-activate))</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(add-hook 'pre-command-hook #'my-hl-todo-activate)</span>

  (global-hl-todo-mode) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">FIXME</span>

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"hl-todo"</span>
    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-hl-todo-reload</span> ()
      (<span style="font-weight: bold;">interactive</span>)
      (global-hl-todo-mode -1)
      (global-hl-todo-mode))

    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-hl-todo-light-theme</span> ()
      (<span style="font-weight: bold;">setq</span> hl-todo-keyword-faces
            '((<span style="font-style: italic;">"HOLD"</span> . <span style="font-style: italic;">"#d0bf8f"</span>)
              (<span style="font-style: italic;">"TODO"</span> . <span style="font-style: italic;">"#FF0000"</span>)
              (<span style="font-style: italic;">"NEXT"</span> . <span style="font-style: italic;">"#dca3a3"</span>)
              (<span style="font-style: italic;">"THEM"</span> . <span style="font-style: italic;">"#dc8cc3"</span>)
              (<span style="font-style: italic;">"PROG"</span> . <span style="font-style: italic;">"#7cb8bb"</span>)
              (<span style="font-style: italic;">"OKAY"</span> . <span style="font-style: italic;">"#7cb8bb"</span>)
              (<span style="font-style: italic;">"DONT"</span> . <span style="font-style: italic;">"#5f7f5f"</span>)
              (<span style="font-style: italic;">"FAIL"</span> . <span style="font-style: italic;">"#8c5353"</span>)
              (<span style="font-style: italic;">"DONE"</span> . <span style="font-style: italic;">"SeaGreen"</span>)
              (<span style="font-style: italic;">"NOTE"</span>   . <span style="font-style: italic;">"#d0bf8f"</span>)
              (<span style="font-style: italic;">"KLUDGE"</span> . <span style="font-style: italic;">"#d0bf8f"</span>)
              (<span style="font-style: italic;">"HACK"</span>   . <span style="font-style: italic;">"#d0bf8f"</span>)
              (<span style="font-style: italic;">"TEMP"</span>   . <span style="font-style: italic;">"#d0bf8f"</span>)
              (<span style="font-style: italic;">"FIXME"</span>  . <span style="font-style: italic;">"##3030FF"</span>)
              (<span style="font-style: italic;">"XXX+"</span>   . <span style="font-style: italic;">"#cc9393"</span>)
              (<span style="font-style: italic;">"\\?\\?\\?+"</span> . <span style="font-style: italic;">"#cc9393"</span>)
              (<span style="font-style: italic;">"<i class="far fa-hand-point-right"></i>"</span> . <span style="font-style: italic;">"orange"</span>)
              (<span style="font-style: italic;">"&#61576;"</span> . <span style="font-style: italic;">"red"</span>)
              (<span style="font-style: italic;">"&#61575;"</span> . <span style="font-style: italic;">"Seagreen3"</span>)))
      (my-hl-todo-reload))
    (add-hook 'my-light-theme-hook #'my-hl-todo-light-theme)

    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-hl-todo-dark-theme</span> ()
      (<span style="font-weight: bold;">setq</span> hl-todo-keyword-faces
            '((<span style="font-style: italic;">"HOLD"</span> . <span style="font-style: italic;">"#d0bf8f"</span>)
              (<span style="font-style: italic;">"TODO"</span> . <span style="font-style: italic;">"#cc9393"</span>)
              (<span style="font-style: italic;">"NEXT"</span> . <span style="font-style: italic;">"#dca3a3"</span>)
              (<span style="font-style: italic;">"THEM"</span> . <span style="font-style: italic;">"#dc8cc3"</span>)
              (<span style="font-style: italic;">"PROG"</span> . <span style="font-style: italic;">"#7cb8bb"</span>)
              (<span style="font-style: italic;">"OKAY"</span> . <span style="font-style: italic;">"#7cb8bb"</span>)
              (<span style="font-style: italic;">"DONT"</span> . <span style="font-style: italic;">"#5f7f5f"</span>)
              (<span style="font-style: italic;">"FAIL"</span> . <span style="font-style: italic;">"#8c5353"</span>)
              (<span style="font-style: italic;">"DONE"</span> . <span style="font-style: italic;">"#afd8af"</span>)
              (<span style="font-style: italic;">"NOTE"</span>   . <span style="font-style: italic;">"#d0bf8f"</span>)
              (<span style="font-style: italic;">"KLUDGE"</span> . <span style="font-style: italic;">"#d0bf8f"</span>)
              (<span style="font-style: italic;">"HACK"</span>   . <span style="font-style: italic;">"#d0bf8f"</span>)
              (<span style="font-style: italic;">"TEMP"</span>   . <span style="font-style: italic;">"#d0bf8f"</span>)
              (<span style="font-style: italic;">"FIXME"</span>  . <span style="font-style: italic;">"DodgerBlue1"</span>)
              (<span style="font-style: italic;">"XXX+"</span>   . <span style="font-style: italic;">"#cc9393"</span>)
              (<span style="font-style: italic;">"\\?\\?\\?+"</span> . <span style="font-style: italic;">"#cc9393"</span>)
              (<span style="font-style: italic;">"<i class="far fa-hand-point-right"></i>"</span> . <span style="font-style: italic;">"orange"</span>)
              (<span style="font-style: italic;">"&#61576;"</span> . <span style="font-style: italic;">"red"</span>)
              (<span style="font-style: italic;">"&#61575;"</span> . <span style="font-style: italic;">"Seagreen3"</span>)))
      (my-hl-todo-reload))
    (add-hook 'my-dark-theme-hook #'my-hl-todo-dark-theme)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org9ce2fd45" class="outline-3">
<h3 id="org9ce2fd45"><span class="section-number-3">12.13</span> [rainbow-mode.el] 配色のリアルタイム確認</h3>
<div class="outline-text-3" id="text-org9ce2fd45">
<p>
<code>M-x rainbow-mode</code> とすると，色指定のコードの背景色を，その指定色にリアルタイム変換してくれる．
</p>

<p>
<a href="http://elpa.gnu.org/packages/rainbow-mode.html">http://elpa.gnu.org/packages/rainbow-mode.html</a>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(rainbow-mode)
       <span style="font-style: italic;">"rainbow-mode"</span> nil t)

  (<span style="font-weight: bold;">dolist</span> (hook '(emmet-mode-hook emacs-lisp-mode-hook org-mode-hook))
    (add-hook hook #'rainbow-mode)))
</pre>
</div>
</div>

<div id="outline-container-org19538af3" class="outline-4">
<h4 id="org19538af3"><span class="section-number-4">12.13.1</span> 色一覧</h4>
<div class="outline-text-4" id="text-org19538af3">
<p>
<code>0,3,6,9,C,F</code> の組み合わせ
</p>

<div class="org-src-container">
<pre class="src src-html">
#000000 #000033 #000066 #000099 #0000CC #0000FF
#003300 #003333 #003366 #003399 #0033CC #0033FF
#006600 #006633 #006666 #006699 #0066CC #0066FF
#009900 #009933 #009966 #009999 #0099CC #0099FF
#00CC00 #00CC33 #00CC66 #00CC99 #00CCCC #00CCFF
#00FF00 #00FF33 #00FF66 #00FF99 #00FFCC #00FFFF

#330000 #330033 #330066 #330099 #3300CC #3300FF
#333300 #333333 #333366 #333399 #3333CC #3333FF
#336600 #336633 #336666 #336699 #3366CC #3366FF
#339900 #339933 #339966 #339999 #3399CC #3399FF
#33CC00 #33CC33 #33CC66 #33CC99 #33CCCC #33CCFF
#33FF00 #33FF33 #33FF66 #33FF99 #33FFCC #33FFFF

#660000 #660033 #660066 #660099 #6600CC #6600FF
#663300 #663333 #663366 #663399 #6633CC #6633FF
#666600 #666633 #666666 #666699 #6666CC #6666FF
#669900 #669933 #669966 #669999 #6699CC #6699FF
#66CC00 #66CC33 #66CC66 #66CC99 #66CCCC #66CCFF
#66FF00 #66FF33 #66FF66 #66FF99 #66FFCC #66FFFF

#990000 #990033 #990066 #990099 #9900CC #9900FF
#993300 #993333 #993366 #993399 #9933CC #9933FF
#996600 #996633 #996666 #996699 #9966CC #9966FF
#999900 #999933 #999966 #999999 #9999CC #9999FF
#99CC00 #99CC33 #99CC66 #99CC99 #99CCCC #99CCFF
#99FF00 #99FF33 #99FF66 #99FF99 #99FFCC #99FFFF

#CC0000 #CC0033 #CC0066 #CC0099 #CC00CC #CC00FF
#CC3300 #CC3333 #CC3366 #CC3399 #CC33CC #CC33FF
#CC6600 #CC6633 #CC6666 #CC6699 #CC66CC #CC66FF
#CC9900 #CC9933 #CC9966 #CC9999 #CC99CC #CC99FF
#CCCC00 #CCCC33 #CCCC66 #CCCC99 #CCCCCC #CCCCFF
#CCFF00 #CCFF33 #CCFF66 #CCFF99 #CCFFCC #CCFFFF

#FF0000 #FF0033 #FF0066 #FF0099 #FF00CC #FF00FF
#FF3300 #FF3333 #FF3366 #FF3399 #FF33CC #FF33FF
#FF6600 #FF6633 #FF6666 #FF6699 #FF66CC #FF66FF
#FF9900 #FF9933 #FF9966 #FF9999 #FF99CC #FF99FF
#FFCC00 #FFCC33 #FFCC66 #FFCC99 #FFCCCC #FFCCFF
#FFFF00 #FFFF33 #FFFF66 #FFFF99 #FFFFCC #FFFFFF

</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgcc116051" class="outline-3">
<h3 id="orgcc116051"><span class="section-number-3">12.14</span> [edit-color-stamp] Qt経由でカラーピッカーを使う</h3>
<div class="outline-text-3" id="text-orgcc116051">
<ul class="org-ul">
<li><a href="https://github.com/sabof/edit-color-stamp">sabof/edit-color-stamp: Edit hex color stamps using a QT, or the internal color picker</a></li>

<li>Macintosh でもちゃんと使えます．</li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">and</span> (executable-find <span style="font-style: italic;">"qt_color_picker"</span>)
           (autoload-if-found
            '(edit-color-stamp)
            <span style="font-style: italic;">"edit-color-stamp"</span> nil t))

  (global-set-key (kbd <span style="font-style: italic;">"C-c f c p"</span>) 'edit-color-stamp))
</pre>
</div>

<p>
（設定手順）
</p>
<ul class="org-ul">
<li>QT をインストールして， <code>qmake</code> に <code>PATH</code> を通す（例：/usr/local/opt/qt/bin）</li>
<li><code>edit-color-stamp</code> を入手してインストール先のフォルダに移動</li>
<li>さらに， <code>qt_color_picker</code> ディレクトリに移動</li>
<li><p>
<code>qt_color_picker.pro</code> を編集して， "QT +=" に "widgets" を追加して保存する．
</p>
<div class="org-src-container">
<pre class="src src-conf"><span style="font-weight: bold; font-style: italic;">QT +</span>= core gui widgets
</pre>
</div></li>
<li><code>qmake qt_color_picker.pro &amp;&amp; make</code> を実行</li>
<li>出来上がった <code>qt_color_picker.app</code> を <code>/Applications/</code> にコピー（移動）</li>
<li><p>
<code>exec-path</code> にパスを通す
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(add-to-list 'exec-path <span style="font-style: italic;">"/Applications/qt_color_picker.app/Contents/MacOS/"</span>)
</pre>
</div></li>
<li><code>(executable-find "qt_color_picker")</code> でプログラムを呼べることを確認</li>
<li><code>#FFFFFF</code> などの色の上で <code>M-x edit-color-stamp</code> を実行する</li>
<li>カラーピッカーで色を選んで「OK」すれば， <code>#FFFFFF</code> が更新される．</li>
</ul>
</div>
</div>

<div id="outline-container-orge836aa4d" class="outline-3">
<h3 id="orge836aa4d"><span class="section-number-3">12.15</span> [ivy.el] インターフェイスの配色</h3>
<div class="outline-text-3" id="text-orge836aa4d">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"ivy"</span>
  (custom-set-faces
   '(ivy-current-match
     ((((class color) (background light))
       <span style="font-weight: bold;">:background</span> <span style="font-style: italic;">"#FFF3F3"</span> <span style="font-weight: bold;">:distant-foreground</span> <span style="font-style: italic;">"#000000"</span>)
      (((class color) (background dark))
       <span style="font-weight: bold;">:background</span> <span style="font-style: italic;">"#404040"</span> <span style="font-weight: bold;">:distant-foreground</span> <span style="font-style: italic;">"#abb2bf"</span>)))
   '(ivy-minibuffer-match-face-1
     ((((class color) (background light)) <span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#666666"</span>)
      (((class color) (background dark)) <span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#999999"</span>)))
   '(ivy-minibuffer-match-face-2
     ((((class color) (background light)) <span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#c03333"</span> <span style="font-weight: bold;">:underline</span> t)
      (((class color) (background dark)) <span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#e04444"</span> <span style="font-weight: bold;">:underline</span> t)))
   '(ivy-minibuffer-match-face-3
     ((((class color) (background light)) <span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#8585ff"</span> <span style="font-weight: bold;">:underline</span> t)
      (((class color) (background dark)) <span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#7777ff"</span> <span style="font-weight: bold;">:underline</span> t)))
   '(ivy-minibuffer-match-face-4
     ((((class color) (background light)) <span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#439943"</span> <span style="font-weight: bold;">:underline</span> t)
      (((class color) (background dark)) <span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#33bb33"</span> <span style="font-weight: bold;">:underline</span> t)))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org4b927009" class="outline-3">
<h3 id="org4b927009"><span class="section-number-3">12.16</span> [ivy.el] 選択行をアイコンで強調</h3>
<div class="outline-text-3" id="text-org4b927009">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"ivy"</span>
<span style="font-weight: bold; font-style: italic;">;;; </span><span style="font-weight: bold; font-style: italic;">&#36984;&#25246;&#23550;&#35937;&#12434; "<i class="far fa-hand-point-right"></i>" &#12395;&#12377;&#12427; (requires all-the-icons.el)</span>
  (<span style="font-weight: bold;">defface</span> <span style="font-weight: bold; font-style: italic;">my-ivy-arrow-visible</span>
    '((((class color) (background light)) <span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"orange"</span>)
      (((class color) (background dark)) <span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#EE6363"</span>))
    <span style="font-style: italic;">"Face used by Ivy for highlighting the arrow."</span>)
  (<span style="font-weight: bold;">defface</span> <span style="font-weight: bold; font-style: italic;">my-ivy-arrow-invisible</span>
    '((((class color) (background light)) <span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#FFFFFF"</span>)
      (((class color) (background dark)) <span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#31343F"</span>))
    <span style="font-style: italic;">"Face used by Ivy for highlighting the invisible arrow."</span>)

  (<span style="font-weight: bold;">if</span> window-system
      (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">all-the-icons</span> nil t)
        (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-ivy-format-function-arrow</span> (cands)
          <span style="font-style: italic;">"Transform CANDS into a string for minibuffer."</span>
          (ivy--format-function-generic
           (<span style="font-weight: bold;">lambda</span> (str)
             (concat (all-the-icons-faicon
                      <span style="font-style: italic;">"hand-o-right"</span>
                      <span style="font-weight: bold;">:v-adjust</span> -0.2 <span style="font-weight: bold;">:face</span> 'my-ivy-arrow-visible)
                     <span style="font-style: italic;">" "</span> (ivy--add-face str 'ivy-current-match)))
           (<span style="font-weight: bold;">lambda</span> (str)
             (concat (all-the-icons-faicon
                      <span style="font-style: italic;">"hand-o-right"</span> <span style="font-weight: bold;">:face</span> 'my-ivy-arrow-invisible) <span style="font-style: italic;">" "</span> str))
           cands
           <span style="font-style: italic;">"\n"</span>))
        (<span style="font-weight: bold;">setq</span> ivy-format-functions-alist
              '((t . my-ivy-format-function-arrow))))
    (<span style="font-weight: bold;">setq</span> ivy-format-functions-alist '((t . ivy-format-function-arrow)))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org36a28b28" class="outline-3">
<h3 id="org36a28b28"><span class="section-number-3">12.17</span> [volatile-highlights] コピペした領域を強調</h3>
<div class="outline-text-3" id="text-org36a28b28">
<p>
コピペ直後の数秒に限定して，コピペした領域をハイライトします．さらに，所定の間隔で表示色を変えることで，ハイライト色が徐々に消えていくようなエフェクトにしています．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(volatile-highlights-mode my-vhl-change-color)
       <span style="font-style: italic;">"volatile-highlights"</span> nil t)

  (<span style="font-weight: bold;">dolist</span> (hook '(org-mode-hook emacs-lisp-mode-hook emmet-mode-hook))
    (add-hook hook #'volatile-highlights-mode))

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"volatile-highlights"</span>
    (set-face-attribute
     'vhl/default-face nil <span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#FF3333"</span> <span style="font-weight: bold;">:background</span> <span style="font-style: italic;">"#FFCDCD"</span>)
    (volatile-highlights-mode t)

    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#12405;&#12431;&#12387;&#12392;&#12456;&#12501;&#12455;&#12463;&#12488;&#12398;&#36861;&#21152;&#65288;&#12506;&#12540;&#12473;&#12488;&#26178;&#12398;&#33394; =&gt; &#12459;&#12540;&#12477;&#12523;&#33394; =&gt; &#26412;&#26469;&#33394;&#65289;</span>
    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-vhl-change-color</span> ()
      (<span style="font-weight: bold;">interactive</span>)
      (<span style="font-weight: bold;">let</span> ((next 0.2)
            (reset 0.5)
            (colors '(<span style="font-style: italic;">"#F8D3D7"</span> <span style="font-style: italic;">"#F2DAE1"</span> <span style="font-style: italic;">"#EBE0EB"</span> <span style="font-style: italic;">"#E5E7F5"</span> <span style="font-style: italic;">"#DEEDFF"</span>)))
        (<span style="font-weight: bold;">dolist</span> (color colors)
          (run-at-time next nil
                       'set-face-attribute
                       'vhl/default-face
                       nil <span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#FF3333"</span> <span style="font-weight: bold;">:background</span> color)
          (<span style="font-weight: bold;">setq</span> next (+ 0.05 next)))
        (run-at-time reset nil 'vhl/clear-all))
      (set-face-attribute 'vhl/default-face
                          nil <span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#FF3333"</span>
                          <span style="font-weight: bold;">:background</span> <span style="font-style: italic;">"#FFCDCD"</span>))

    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-yank</span> (<span style="font-weight: bold; text-decoration: underline;">&amp;optional</span> ARG)
      (<span style="font-weight: bold;">interactive</span>)
      (yank ARG)
      (<span style="font-weight: bold;">when</span> window-system
        (my-vhl-change-color)))
    (global-set-key (kbd <span style="font-style: italic;">"M-v"</span>) 'my-yank)
    (global-set-key (kbd <span style="font-style: italic;">"C-y"</span>) 'my-yank)

    (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"org"</span>
      (define-key org-mode-map (kbd <span style="font-style: italic;">"C-y"</span>) 'my-org-yank)
      (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-org-yank</span> ()
        (<span style="font-weight: bold;">interactive</span>)
        (org-yank)
        (<span style="font-weight: bold;">when</span> window-system
          (my-vhl-change-color))))))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgb8e84b9a" class="outline-2">
<h2 id="orgb8e84b9a"><span class="section-number-2">13</span> ユーティリティ関数</h2>
<div class="outline-text-2" id="text-orgb8e84b9a">
</div>

<div id="outline-container-orgbfb695e1" class="outline-3">
<h3 id="orgbfb695e1"><span class="section-number-3">13.1</span> [pomodoro.el] ポモドーロの実践</h3>
<div class="outline-text-3" id="text-orgbfb695e1">
<p>
<a href="https://twitter.com/syohex">@syohex</a> さん謹製の <a href="https://github.com/syohex/emacs-utils/blob/master/pomodoro.el">pomodoro.el</a> に少しカスタマイズしたおれおれ <a href="https://github.com/takaxp/emacs-utils/blob/master/pomodoro.el">pomodoro.el</a> を使っています．以下のように設定すると，ポモドーロの残り時間は表示せず，アイコンだけをモードラインに表示できます．残り時間は <code>M-x pomodoro:mode-line-time-display-toggle</code> すれば，いつでも表示できます．
</p>

<p>
<code>pomodoro:finish-work-hook</code> ， <code>pomodoro:finish-rest-hook</code> ， <code>pomodoro:long-rest-hook</code> にそれぞれ結びつけてあるのは，<a href="http://www.mactechlab.jp/products-report/16673.html">Macのスピーチ機能</a>です．この例では，Kyoko さんが指示を出してくれます．
</p>

<p>
<code>M-x pomodoro:start</code> すると，ポモドーロが始まり，8時間後に <code>pomodoro:stop</code> が呼ばれてポモドーロが終了します．<a href="http://www.pomodorotechnique.com/">pomodoro</a> は機械的に仕事をしたい人にピッタリです．人によっては <a href="http://ja.wikipedia.org/wiki/Getting_Things_Done">GTD</a> よりも取っ付きやすいと思います．
</p>

<p>
なお，Org Mode と組み合わせたい場合は，通知を <code>org-clock-in</code> と <code>org-clock-out</code> に連動させる <a href="https://github.com/lolownia/org-pomodoro">org-pomodoro.el</a> があります．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(pomodoro:start)
       <span style="font-style: italic;">"pomodoro"</span> nil t)

  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(with-eval-after-load "postpone"</span>
  <span style="font-weight: bold; font-style: italic;">;;   </span><span style="font-weight: bold; font-style: italic;">(when (and (not noninteractive)</span>
  <span style="font-weight: bold; font-style: italic;">;;              </span><span style="font-weight: bold; font-style: italic;">(not (boundp 'pomodoro:timer)))</span>
  <span style="font-weight: bold; font-style: italic;">;;     </span><span style="font-weight: bold; font-style: italic;">;; &#37325;&#35079;&#36215;&#21205;&#12434;&#22238;&#36991;</span>
  <span style="font-weight: bold; font-style: italic;">;;     </span><span style="font-weight: bold; font-style: italic;">(pomodoro:start nil)))</span>

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"pomodoro"</span>
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#20316;&#26989;&#26178;&#38291;&#32066;&#20102;&#24460;&#12395;&#38283;&#12367;&#12501;&#12449;&#12452;&#12523;&#12434;&#25351;&#23450;&#12375;&#12394;&#12356;</span>
    (<span style="font-weight: bold;">setq</span> pomodoro:file nil)
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#9679;&#12384;&#12369;&#12391;&#34920;&#29694;&#12377;&#12427;&#65288;&#27531;&#12426;&#26178;&#38291;&#34920;&#31034;&#12394;&#12375;&#65289;</span>
    (<span style="font-weight: bold;">setq</span> pomodoro:mode-line-time-display nil)
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#9679;&#12398;&#32622;&#12365;&#25563;&#12360;</span>
    (<span style="font-weight: bold;">setq</span> pomodoro:mode-line-work-sign <span style="font-style: italic;">"&gt;&gt;"</span>)
    (<span style="font-weight: bold;">setq</span> pomodoro:mode-line-rest-sign <span style="font-style: italic;">"&lt;&lt;"</span>)
    (<span style="font-weight: bold;">setq</span> pomodoro:mode-line-long-rest-sign <span style="font-style: italic;">"&lt;&gt;"</span>)
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#38263;&#12356;&#20241;&#25001;&#12395;&#20837;&#12427;&#12414;&#12391;&#12395;&#12509;&#12514;&#12489;&#12540;&#12525;&#12377;&#12427;&#22238;&#25968;</span>
    (<span style="font-weight: bold;">setq</span> pomodoro:iteration-for-long-rest 4)
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#20316;&#26989;&#26178;&#38291;&#38306;&#36899;</span>
    (<span style="font-weight: bold;">setq</span> pomodoro:work-time 25     <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">&#20316;&#26989;&#26178;&#38291;</span>
          pomodoro:rest-time 5      <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">&#20241;&#25001;&#26178;&#38291;</span>
          pomodoro:long-rest-time 30 <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">&#38263;&#12356;&#20241;&#25001;&#26178;&#38291;</span>
          pomodoro:max-iteration 16) <span style="font-weight: bold; font-style: italic;">; </span><span style="font-weight: bold; font-style: italic;">&#12509;&#12514;&#12489;&#12540;&#12525;&#12377;&#12427;&#22238;&#25968;</span>
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#12479;&#12452;&#12510;&#12540;&#12398;&#34920;&#31034;&#12434;&#12494;&#12540;&#12510;&#12523;&#12501;&#12455;&#12452;&#12473;&#12395;&#12377;&#12427;</span>
    (set-face-bold-p 'pomodoro:timer-face nil)
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#20316;&#26989;&#20013;&#65288;&#36196;&#65289;&#65292;&#20241;&#25001;&#20013;&#65288;&#38738;&#65289;&#65292;&#38263;&#12356;&#20241;&#25001;&#20013;&#65288;&#32209;&#65289;&#12395;&#12377;&#12427;</span>
    (custom-set-faces
     '(pomodoro:work-face
       ((((background dark)) <span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#DB4C46"</span> <span style="font-weight: bold;">:bold</span> t)
        (t (<span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#A130C4"</span> <span style="font-weight: bold;">:bold</span> t)))) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">#8248c4 , #956dc4, #9d64c4</span>
     '(pomodoro:rest-face
       ((((background dark)) <span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#3869FA"</span> <span style="font-weight: bold;">:bold</span> t)
        (t (<span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#203e6f"</span> <span style="font-weight: bold;">:bold</span> t))))
     '(pomodoro:long-rest-face
       ((((background dark)) <span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#008890"</span> <span style="font-weight: bold;">:bold</span> t)
        (t (<span style="font-weight: bold;">:foreground</span> <span style="font-style: italic;">"#1c9b08"</span> <span style="font-weight: bold;">:bold</span> t))))) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">00B800</span>

    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-pomodoro-status</span> ()
      <span style="font-style: italic;">"Show the current `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">pomodoro</span><span style="font-style: italic;">' status in minibuffer when focus-in."</span>
      (<span style="font-weight: bold;">interactive</span>)
      (<span style="font-weight: bold;">when</span> pomodoro:timer
        (<span style="font-weight: bold;">let</span> ((message-log-max nil))
          (message
           (format <span style="font-style: italic;">"[%d/%s] %s to go "</span>
                   pomodoro:work-count
                   pomodoro:max-iteration
                   (pomodoro:time-to-string pomodoro:remainder-seconds))))))
    (add-hook 'focus-in-hook #'my-pomodoro-status)

    (<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my-pomodoro-speak</span> nil)
    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-toggle-pomodoro-speak</span> ()
      (<span style="font-weight: bold;">interactive</span>)
      (<span style="font-weight: bold;">setq</span> my-pomodoro-speak (not my-pomodoro-speak)))

    (<span style="font-weight: bold;">when</span> (memq window-system '(mac ns))
      <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Mac &#12518;&#12540;&#12470;&#21521;&#12369;&#65294;Kyoko&#12373;&#12435;&#12395;&#25351;&#31034;&#12375;&#12390;&#12418;&#12425;&#12358;</span>
      (<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">pomodoro:with-speak</span> nil)
      (<span style="font-weight: bold;">when</span> pomodoro:with-speak
        (add-hook 'pomodoro:finish-work-hook
                  (<span style="font-weight: bold;">lambda</span> ()
                    (<span style="font-weight: bold;">let</span> ((script
                           (concat <span style="font-style: italic;">"say -v Kyoko "</span>
                                   (number-to-string
                                    (floor pomodoro:rest-time))
                                   <span style="font-style: italic;">"&#20998;&#38291;&#65292;&#20241;&#25001;&#12375;&#12429;"</span>)))
                      (<span style="font-weight: bold;">if</span> my-pomodoro-speak
                          (shell-command-to-string script)
                        (message <span style="font-style: italic;">"%s"</span> script)))))

        (add-hook 'pomodoro:finish-rest-hook
                  (<span style="font-weight: bold;">lambda</span> ()
                    (<span style="font-weight: bold;">let</span> ((script
                           (concat <span style="font-style: italic;">"say -v Kyoko "</span>
                                   (number-to-string
                                    (floor pomodoro:work-time))
                                   <span style="font-style: italic;">"&#20998;&#38291;&#65292;&#20316;&#26989;&#12375;&#12429;"</span>)))
                      (<span style="font-weight: bold;">if</span> my-pomodoro-speak
                          (shell-command-to-string script)
                        (message <span style="font-style: italic;">"%s"</span> script)))))

        (add-hook 'pomodoro:long-rest-hook
                  (<span style="font-weight: bold;">lambda</span> ()
                    (<span style="font-weight: bold;">let</span> ((script
                           (concat <span style="font-style: italic;">"say -v Kyoko &#12371;&#12428;&#12363;&#12425;"</span>
                                   (number-to-string
                                    (floor pomodoro:long-rest-time))
                                   <span style="font-style: italic;">"&#20998;&#38291;&#12398;&#20241;&#25001;&#12391;&#12377;"</span>)))
                      (<span style="font-weight: bold;">if</span> my-pomodoro-speak
                          (shell-command-to-string script)
                        (message <span style="font-style: italic;">"%s"</span> script))))))

      (<span style="font-weight: bold;">declare-function</span> my-pomodoro-notify <span style="font-style: italic;">"init"</span> nil)
      (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-pomodoro-notify</span> ()
        (my-desktop-notification
         <span style="font-style: italic;">"Pomodoro"</span>
         (concat <span style="font-style: italic;">"&#19977;&#19977; &#65421;(*&#65439;&#8711;&#65439;)&#65417;   Go #"</span>
                 (format <span style="font-style: italic;">"%s"</span> (1+ pomodoro:work-count))) nil <span style="font-style: italic;">"Glass"</span>))
      (add-hook 'pomodoro:finish-work-hook #'my-pomodoro-notify))))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc09c0be3" class="outline-3">
<h3 id="orgc09c0be3"><span class="section-number-3">13.2</span> [pomodoro.el] 続・ポモドーロの実践</h3>
<div class="outline-text-3" id="text-orgc09c0be3">
<p>
さらに，モードラインに出すスタータスを表すサインに動きを付けます．ただ頻繁にモードラインを更新して描画するので，環境によっては動作が重くなるかもしれません．
</p>

<p>
各 interlval の数値を <code>setq</code> で後から変更する場合は，その直後に <code>pomodoro:activate-visual-work-sign</code> もしくは変更する interval に対応する同様の関数を実行してください．モードラインに変更が反映されます．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"pomodoro"</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#36861;&#21152;&#23455;&#35013;</span>
  (<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">pomodoro:update-work-sign-interval</span> 0.17) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">work&#29992;&#34920;&#31034;&#38291;&#38548;</span>
  (<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">pomodoro:update-rest-sign-interval</span> 0.21) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">rest&#29992;&#34920;&#31034;&#38291;&#38548;</span>
  (<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">pomodoro:update-long-rest-sign-interval</span> 0.36) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">long-rest&#29992;&#34920;&#31034;&#38291;&#38548;</span>

  (<span style="font-weight: bold;">setq</span> pomodoro:mode-line-work-sign-list
        '(<span style="font-style: italic;">"/  "</span> <span style="font-style: italic;">"// "</span> <span style="font-style: italic;">"///"</span> <span style="font-style: italic;">" //"</span> <span style="font-style: italic;">"  /"</span> <span style="font-style: italic;">"   "</span> <span style="font-style: italic;">"   "</span>))
  (<span style="font-weight: bold;">setq</span> pomodoro:mode-line-rest-sign-list
        '(<span style="font-style: italic;">".  "</span> <span style="font-style: italic;">".. "</span> <span style="font-style: italic;">"..."</span> <span style="font-style: italic;">"..:"</span> <span style="font-style: italic;">".::"</span> <span style="font-style: italic;">":::"</span> <span style="font-style: italic;">":::"</span>
          <span style="font-style: italic;">"::."</span> <span style="font-style: italic;">":.."</span> <span style="font-style: italic;">"..."</span> <span style="font-style: italic;">" .."</span> <span style="font-style: italic;">"  ."</span> <span style="font-style: italic;">"   "</span> <span style="font-style: italic;">"   "</span>
          <span style="font-style: italic;">",  "</span> <span style="font-style: italic;">",, "</span> <span style="font-style: italic;">",,,"</span> <span style="font-style: italic;">",,;"</span> <span style="font-style: italic;">",;;"</span> <span style="font-style: italic;">";;;"</span> <span style="font-style: italic;">";;;"</span>
          <span style="font-style: italic;">";;,"</span> <span style="font-style: italic;">";,,"</span> <span style="font-style: italic;">",,,"</span> <span style="font-style: italic;">" ,,"</span> <span style="font-style: italic;">"  ,"</span> <span style="font-style: italic;">"   "</span> <span style="font-style: italic;">"   "</span>))
  (<span style="font-weight: bold;">setq</span> pomodoro:mode-line-long-rest-sign-list
        '(<span style="font-style: italic;">"   "</span> <span style="font-style: italic;">" | "</span> <span style="font-style: italic;">"|||"</span> <span style="font-style: italic;">"| |"</span> <span style="font-style: italic;">"   "</span>))

  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Example.0</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(setq pomodoro:mode-line-work-sign-list</span>
  <span style="font-weight: bold; font-style: italic;">;;       </span><span style="font-weight: bold; font-style: italic;">'("|  " "|| " "|||" " ||" "  |" "   " "   "</span>
  <span style="font-weight: bold; font-style: italic;">;;         </span><span style="font-weight: bold; font-style: italic;">"  |" " ||" "|||" "|| " "|  " "   " "   "))</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(setq pomodoro:mode-line-rest-sign-list</span>
  <span style="font-weight: bold; font-style: italic;">;;       </span><span style="font-weight: bold; font-style: italic;">'(".  " ".. " "..." " .." "  ." "   " "   "</span>
  <span style="font-weight: bold; font-style: italic;">;;         </span><span style="font-weight: bold; font-style: italic;">"  ." " .." "..." ".. " ".  " "   " "   "))</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(setq pomodoro:mode-line-long-rest-sign-list</span>
  <span style="font-weight: bold; font-style: italic;">;;       </span><span style="font-weight: bold; font-style: italic;">'("   " " | " "|||" "| |" "   "))</span>

  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Example.1</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(defvar pomodoro:mode-line-work-sign-list</span>
  <span style="font-weight: bold; font-style: italic;">;;   </span><span style="font-weight: bold; font-style: italic;">'("&#9601;" "&#9602;" "&#9603;" "&#9604;" "&#9605;" "&#9606;" "&#9607;" "&#9607;" "&#9606;" "&#9605;" "&#9604;" "&#9603;" "&#9602;" "&#9601;" "&#9601;" ))</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(defvar pomodoro:mode-line-rest-sign-list</span>
  <span style="font-weight: bold; font-style: italic;">;;   </span><span style="font-weight: bold; font-style: italic;">pomodoro:mode-line-work-sign-list)</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(defvar pomodoro:mode-line-long-rest-sign-list</span>
  <span style="font-weight: bold; font-style: italic;">;;   </span><span style="font-weight: bold; font-style: italic;">pomodoro:mode-line-work-sign-list)</span>

  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Example.2</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(defvar pomodoro:mode-line-work-sign-list</span>
  <span style="font-weight: bold; font-style: italic;">;;   </span><span style="font-weight: bold; font-style: italic;">'("&gt;   " "&gt;&gt;  " "&gt;&gt;&gt; " "&gt;&gt;&gt;&gt;" " &gt;&gt;&gt;" "  &gt;&gt;" "   &gt;" "    "))</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(defvar pomodoro:mode-line-rest-sign-list</span>
  <span style="font-weight: bold; font-style: italic;">;;   </span><span style="font-weight: bold; font-style: italic;">'("   &lt;" "  &lt;&lt;" " &lt;&lt;&lt;" "&lt;&lt;&lt;&lt;" "&lt;&lt;&lt; " "&lt;&lt;  " "&lt;   " "    "))</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(defvar pomodoro:mode-line-long-rest-sign-list</span>
  <span style="font-weight: bold; font-style: italic;">;;   </span><span style="font-weight: bold; font-style: italic;">'("  &lt;&gt;  " " &lt;&lt;&gt;&gt; " "&lt;&lt;&lt;&gt;&gt;&gt;" "&lt;&lt;  &gt;&gt;" "&lt;    &gt;" "      "))</span>

  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Example.3</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(setq pomodoro:mode-line-work-sign-list</span>
  <span style="font-weight: bold; font-style: italic;">;;       </span><span style="font-weight: bold; font-style: italic;">'("&#9602;&#9601;  &#9601;" "&#9603;&#9602;&#9601;  " "&#9604;&#9603;&#9602;&#9601; " "&#9605;&#9604;&#9603;&#9602;&#9601;" "&#9606;&#9605;&#9604;&#9603;&#9602;" "&#9607;&#9606;&#9605;&#9604;&#9603;" "&#9607;&#9607;&#9606;&#9605;&#9604;" "&#9606;&#9607;&#9607;&#9606;&#9605;"</span>
  <span style="font-weight: bold; font-style: italic;">;;         </span><span style="font-weight: bold; font-style: italic;">"&#9605;&#9606;&#9607;&#9607;&#9606;" "&#9604;&#9605;&#9606;&#9607;&#9607;" "&#9603;&#9604;&#9605;&#9606;&#9607;" "&#9602;&#9603;&#9604;&#9605;&#9606;" "&#9601;&#9602;&#9603;&#9604;&#9605;" " &#9601;&#9602;&#9603;&#9604;" "  &#9601;&#9602;&#9603;" "&#9601;  &#9601;&#9602;"))</span>

  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Example.4</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(defvar pomodoro:mode-line-work-sign-list</span>
  <span style="font-weight: bold; font-style: italic;">;;   </span><span style="font-weight: bold; font-style: italic;">'("&#9700;&#9698;&#9700; ^-^; &#9698;&#9700;&#9698;"</span>
  <span style="font-weight: bold; font-style: italic;">;;     </span><span style="font-weight: bold; font-style: italic;">"&#9700;&#9698;&#9700; ^-^  &#9698;&#9700;&#9698;"</span>
  <span style="font-weight: bold; font-style: italic;">;;     </span><span style="font-weight: bold; font-style: italic;">"&#9700;&#9698;&#9700; ^-^  &#9698;&#9700;&#9698;"</span>
  <span style="font-weight: bold; font-style: italic;">;;     </span><span style="font-weight: bold; font-style: italic;">"&#9700;&#9698;&#9700; ^-^  &#9698;&#9700;&#9698;"</span>
  <span style="font-weight: bold; font-style: italic;">;;     </span><span style="font-weight: bold; font-style: italic;">"&#9700;&#9698;&#9700; ^-^; &#9698;&#9700;&#9698;"</span>
  <span style="font-weight: bold; font-style: italic;">;;     </span><span style="font-weight: bold; font-style: italic;">"&#9700;&#9698;&#9700; ^-^; &#9698;&#9700;&#9698;"</span>
  <span style="font-weight: bold; font-style: italic;">;;     </span><span style="font-weight: bold; font-style: italic;">"&#9698;&#9700;&#9698;&#9700; ^-^; &#9698;&#9700;"</span>
  <span style="font-weight: bold; font-style: italic;">;;     </span><span style="font-weight: bold; font-style: italic;">"&#9700;&#9698;&#9700;&#9698;&#9700; ^-^; &#9698;"</span>
  <span style="font-weight: bold; font-style: italic;">;;     </span><span style="font-weight: bold; font-style: italic;">"&#9698;&#9700;&#9698;&#9700;&#9698;&#9700; ^-^; "</span>
  <span style="font-weight: bold; font-style: italic;">;;     </span><span style="font-weight: bold; font-style: italic;">" &#9698;&#9700;&#9698;&#9700;&#9698;&#9700; ^-^;"</span>
  <span style="font-weight: bold; font-style: italic;">;;     </span><span style="font-weight: bold; font-style: italic;">"; &#9698;&#9700;&#9698;&#9700;&#9698;&#9700; ^-^"</span>
  <span style="font-weight: bold; font-style: italic;">;;     </span><span style="font-weight: bold; font-style: italic;">"^; &#9698;&#9700;&#9698;&#9700;&#9698;&#9700; ^-"</span>
  <span style="font-weight: bold; font-style: italic;">;;     </span><span style="font-weight: bold; font-style: italic;">"-^; &#9698;&#9700;&#9698;&#9700;&#9698;&#9700; ^"</span>
  <span style="font-weight: bold; font-style: italic;">;;     </span><span style="font-weight: bold; font-style: italic;">"^-^; &#9698;&#9700;&#9698;&#9700;&#9698;&#9700; "</span>
  <span style="font-weight: bold; font-style: italic;">;;     </span><span style="font-weight: bold; font-style: italic;">" ^-^; &#9698;&#9700;&#9698;&#9700;&#9698;&#9700;"</span>
  <span style="font-weight: bold; font-style: italic;">;;     </span><span style="font-weight: bold; font-style: italic;">"&#9700; ^-^; &#9698;&#9700;&#9698;&#9700;&#9698;"</span>
  <span style="font-weight: bold; font-style: italic;">;;     </span><span style="font-weight: bold; font-style: italic;">"&#9698;&#9700; ^-^; &#9698;&#9700;&#9698;&#9700;"));</span>

  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#12383;&#12394;&#12371;&#12405;&#27663;: https://twitter.com/mattn_jp/status/987203614199263233</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(setq pomodoro:mode-line-work-sign-list</span>
  <span style="font-weight: bold; font-style: italic;">;;   </span><span style="font-weight: bold; font-style: italic;">'("(&#180;&#65381;_&#65381;`)&#180;&#65381;_&#65381;`)"</span>
  <span style="font-weight: bold; font-style: italic;">;;     </span><span style="font-weight: bold; font-style: italic;">" (&#180;&#65381;_&#65381;`)_&#65381;`)  "</span>
  <span style="font-weight: bold; font-style: italic;">;;     </span><span style="font-weight: bold; font-style: italic;">"  (&#180;&#65381;_&#65381;`)`)   "</span>
  <span style="font-weight: bold; font-style: italic;">;;     </span><span style="font-weight: bold; font-style: italic;">"  ((&#180;&#65381;_&#65381;`)    "</span>
  <span style="font-weight: bold; font-style: italic;">;;     </span><span style="font-weight: bold; font-style: italic;">" (&#180;&#65381;(&#180;&#65381;_&#65381;`)  "</span>
  <span style="font-weight: bold; font-style: italic;">;;     </span><span style="font-weight: bold; font-style: italic;">" (&#180;&#65381;_(&#180;&#65381;_&#65381;`) "</span>
  <span style="font-weight: bold; font-style: italic;">;;     </span><span style="font-weight: bold; font-style: italic;">"(&#180;&#65381;_&#65381;`)&#180;&#65381;_&#65381;`)"</span>
  <span style="font-weight: bold; font-style: italic;">;;     </span><span style="font-weight: bold; font-style: italic;">" (&#180;&#65381;_&#65381;`)_&#65381;`)  "</span>
  <span style="font-weight: bold; font-style: italic;">;;     </span><span style="font-weight: bold; font-style: italic;">"  (&#180;&#65381;_&#65381;`)`)   "</span>
  <span style="font-weight: bold; font-style: italic;">;;     </span><span style="font-weight: bold; font-style: italic;">"  (&#180;&#65381;_&#65381;`))    "</span>
  <span style="font-weight: bold; font-style: italic;">;;     </span><span style="font-weight: bold; font-style: italic;">"   ((&#180;&#65381;_&#65381;`)   "</span>
  <span style="font-weight: bold; font-style: italic;">;;     </span><span style="font-weight: bold; font-style: italic;">"  (&#180;&#65381;(&#180;&#65381;_&#65381;`) "</span>
  <span style="font-weight: bold; font-style: italic;">;;     </span><span style="font-weight: bold; font-style: italic;">" (&#180;&#65381;_(&#180;&#65381;_&#65381;`) "));</span>

  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#36215;&#21205;&#12501;&#12521;&#12464;</span>
  (<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my-pomodoro-visualize</span> t)

  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#12479;&#12452;&#12510;&#12540;&#12434;&#35352;&#37682;</span>
  (<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">pomodoro:update-sign-timer</span> nil)

  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#21021;&#26399;&#29366;&#24907;&#12434;&#30331;&#37682;</span>
  (<span style="font-weight: bold;">if</span> my-pomodoro-visualize
      (<span style="font-weight: bold;">setq</span> pomodoro:mode-line-work-sign
            (car pomodoro:mode-line-work-sign-list))
    (<span style="font-weight: bold;">setq</span> pomodoro:mode-line-work-sign <span style="font-style: italic;">""</span>)
    (<span style="font-weight: bold;">setq</span> pomodoro:mode-line-rest-sign <span style="font-style: italic;">""</span>)
    (<span style="font-weight: bold;">setq</span> pomodoro:mode-line-long-rest-sign <span style="font-style: italic;">""</span>))

  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">utilities</span>
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">pomodoro:list-rotate</span> (sign-list)
    (<span style="font-weight: bold;">if</span> (listp sign-list)
        (append (cdr sign-list)
                (list (car sign-list)))
      sign-list))

  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">pomodoro:activate-visual-sign</span> (sign interval)
    (<span style="font-weight: bold;">when</span> (timerp pomodoro:update-sign-timer)
      (cancel-timer pomodoro:update-sign-timer))
    (<span style="font-weight: bold;">setq</span> pomodoro:update-sign-timer
          (run-at-time t interval sign)))

  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">pomodoro:visualize-start</span> ()
    (<span style="font-weight: bold;">setq</span> my-pomodoro-visualize t)
    (<span style="font-weight: bold;">cond</span> ((eq pomodoro:current-state 'rest)
           (pomodoro:update-rest-sign)
           (pomodoro:activate-visual-rest-sign))
          ((eq pomodoro:current-state 'long-rest)
           (pomodoro:update-long-rest-sign)
           (pomodoro:activate-visual-long-rest-sign))
          (t
           (pomodoro:update-work-sign)
           (pomodoro:activate-visual-work-sign))))

  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">pomodoro:visualize-stop</span> ()
    (<span style="font-weight: bold;">setq</span> my-pomodoro-visualize nil)
    (<span style="font-weight: bold;">setq</span> pomodoro:mode-line-work-sign <span style="font-style: italic;">""</span>)
    (<span style="font-weight: bold;">setq</span> pomodoro:mode-line-rest-sign <span style="font-style: italic;">""</span>)
    (<span style="font-weight: bold;">setq</span> pomodoro:mode-line-long-rest-sign <span style="font-style: italic;">""</span>)
    (force-mode-line-update t)
    (<span style="font-weight: bold;">when</span> (timerp pomodoro:update-sign-timer)
      (cancel-timer pomodoro:update-sign-timer)))

  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">ad:pomodoro:start</span> (f <span style="font-weight: bold; text-decoration: underline;">&amp;rest</span> minutes)
    <span style="font-style: italic;">"Extensions to stop pomodoro and timers"</span>
    (<span style="font-weight: bold;">interactive</span> <span style="font-style: italic;">"P"</span>)
    (pomodoro:visualize-start)
    (apply f minutes))

  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">ad:pomodoro:stop</span> (f <span style="font-weight: bold; text-decoration: underline;">&amp;rest</span> do-reset)
    <span style="font-style: italic;">"Extensions to stop pomodoro and timers"</span>
    (<span style="font-weight: bold;">interactive</span>)
    (pomodoro:visualize-stop)
    (<span style="font-weight: bold;">when</span> (timerp pomodoro:timer)
      (apply f do-reset)))

  (<span style="font-weight: bold;">when</span> my-pomodoro-visualize
    (advice-add 'pomodoro:start <span style="font-weight: bold;">:around</span> #'ad:pomodoro:start)
    (advice-add 'pomodoro:stop <span style="font-weight: bold;">:around</span> #'ad:pomodoro:stop))

  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">work</span>
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">pomodoro:update-work-sign</span> ()
    <span style="font-style: italic;">"Update pomodoro work-sign on modeline."</span>
    (<span style="font-weight: bold;">when</span> my-pomodoro-visualize
      (<span style="font-weight: bold;">setq</span> pomodoro:mode-line-work-sign
            (car pomodoro:mode-line-work-sign-list))
      (<span style="font-weight: bold;">setq</span> pomodoro:mode-line-work-sign-list
            (pomodoro:list-rotate pomodoro:mode-line-work-sign-list))
      (force-mode-line-update t)))

  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">pomodoro:activate-visual-work-sign</span> ()
    (pomodoro:activate-visual-sign
     'pomodoro:update-work-sign pomodoro:update-work-sign-interval))

  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">rest</span>
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">pomodoro:update-rest-sign</span> ()
    <span style="font-style: italic;">"Update pomodoro rest-sign on modeline."</span>
    (<span style="font-weight: bold;">when</span> my-pomodoro-visualize
      (<span style="font-weight: bold;">setq</span> pomodoro:mode-line-rest-sign
            (car pomodoro:mode-line-rest-sign-list))
      (<span style="font-weight: bold;">setq</span> pomodoro:mode-line-rest-sign-list
            (pomodoro:list-rotate pomodoro:mode-line-rest-sign-list))
      (force-mode-line-update t)))

  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">pomodoro:activate-visual-rest-sign</span> ()
    (pomodoro:activate-visual-sign
     'pomodoro:update-rest-sign pomodoro:update-rest-sign-interval))

  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">long rest</span>
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">pomodoro:update-long-rest-sign</span> ()
    <span style="font-style: italic;">"Update pomodoro long-rest-sign on modeline."</span>
    (<span style="font-weight: bold;">when</span> my-pomodoro-visualize
      (<span style="font-weight: bold;">setq</span> pomodoro:mode-line-long-rest-sign
            (car pomodoro:mode-line-long-rest-sign-list))
      (<span style="font-weight: bold;">setq</span> pomodoro:mode-line-long-rest-sign-list
            (pomodoro:list-rotate pomodoro:mode-line-long-rest-sign-list))
      (force-mode-line-update t)))

  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">pomodoro:activate-visual-long-rest-sign</span> ()
    (pomodoro:activate-visual-sign
     'pomodoro:update-long-rest-sign pomodoro:update-long-rest-sign-interval))

  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#12473;&#12486;&#12540;&#12479;&#12473;&#12364;&#20999;&#12426;&#26367;&#12431;&#12427;&#26178;&#12395;&#34920;&#31034;&#12434;&#20837;&#12428;&#26367;&#12360;&#12427;</span>
  (<span style="font-weight: bold;">when</span> my-pomodoro-visualize
    (add-hook 'pomodoro:finish-rest-hook #'pomodoro:activate-visual-work-sign)
    (add-hook 'pomodoro:finish-work-hook #'pomodoro:activate-visual-rest-sign)
    (add-hook 'pomodoro:long-rest-hook
              #'pomodoro:activate-visual-long-rest-sign)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org98f153af" class="outline-3">
<h3 id="org98f153af"><span class="section-number-3">13.3</span> [google-this.el] 単語をグーグル検索</h3>
<div class="outline-text-3" id="text-org98f153af">
<p>
カーソル下の単語を検索して，結果をブラウザで受け取ります． <code>google-this</code> を直接呼ぶと検索確認を聞かれるので，すぐに検索するようにカスタマイズします． <code>M-x google-this-word</code> を使うのも手ですが，ハイフンで連結された文字列を拾えないので好みがわかれます．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(my-google-this google-this google-this-word)
       <span style="font-style: italic;">"google-this"</span> nil t)

  (global-set-key (kbd <span style="font-style: italic;">"C-c f g"</span>) 'my-google-this)

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"google-this"</span>
    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-google-this</span> ()
      (<span style="font-weight: bold;">interactive</span>)
      (google-this (current-word) t))))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc6fce61d" class="outline-3">
<h3 id="orgc6fce61d"><span class="section-number-3">13.4</span> [multi-term.el] ターミナル</h3>
<div class="outline-text-3" id="text-orgc6fce61d">
<p>
たまに使いたくなるので一応．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(multi-term)
       <span style="font-style: italic;">"multi-term"</span> nil t)

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"multi-term"</span>
    (setenv <span style="font-style: italic;">"HOSTTYPE"</span> <span style="font-style: italic;">"intel-mac"</span>)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org96f7a2a3" class="outline-3">
<h3 id="org96f7a2a3"><span class="section-number-3">13.5</span> [osx-lib.el] macOS用ユーティリティ&#xa0;&#xa0;&#xa0;<span class="tag"><span class="macOS">macOS</span></span></h3>
<div class="outline-text-3" id="text-org96f7a2a3">
<ul class="org-ul">
<li><a href="https://github.com/raghavgautam/osx-lib">raghavgautam/osx-lib</a></li>
<li>OSXの機能を呼び出すためのツール集</li>
<li><code>osx-lib-say-region</code> を呼び出せば，選択領域を機械音で発声させられます．</li>
<li><code>selected.el</code> と組み合わせると選択後にシングルキーで実施できるのでさらに便利です．</li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(osx-lib-say osx-lib-say-region)
       <span style="font-style: italic;">"osx-lib"</span> nil t)

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"osx-lib"</span>
    (custom-set-variables
     '(osx-lib-say-ratio 100)
     '(osx-lib-say-voice <span style="font-style: italic;">"Samantha"</span>))))
</pre>
</div>

<p>
例えば，カエルの歌の輪唱ができます．以下のソースブロックで <code>C-c C-c</code> を適切なタイミングで押してみてください．
</p>

<div class="org-src-container">
<pre class="src src-org"><span style="font-weight: bold; font-style: italic;">#+begin_src emacs-lisp :results silent</span>
(<span style="font-weight: bold;">setq</span> osx-lib-say-voice <span style="font-style: italic;">"Kyoko"</span>) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Samantha</span>
(<span style="font-weight: bold;">setq</span> osx-lib-say-rate 90) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">min 90 for Samantha</span>
(<span style="font-weight: bold;">setq</span> yourscript <span style="font-style: italic;">"&#12363;&#12360;&#12427;&#12398;&#12358;&#12383;&#12364;&#12288;&#12288;&#12288;&#12288;&#12365;&#12371;&#12360;&#12390;&#12367;&#12427;&#12424;&#12288;&#12288;&#12463;&#12449;&#12288;&#12463;&#12449;&#12288;&#12463;&#12449;&#12288;&#12463;&#12449;&#12288;&#12465;&#12465;&#12465;&#12465;&#12288;&#12465;&#12465;&#12465;&#12465;&#12288;&#12463;&#12449;&#12288;&#12463;&#12449;&#12288;&#12463;&#12449;"</span>)
(osx-lib-say yourscript)
<span style="font-weight: bold; font-style: italic;">#+end_src</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org72d850dc" class="outline-3">
<h3 id="org72d850dc"><span class="section-number-3">13.6</span> iTerm2 を Emacs から呼び出したい&#xa0;&#xa0;&#xa0;<span class="tag"><span class="macOS">macOS</span></span></h3>
<div class="outline-text-3" id="text-org72d850dc">
<p>
<code>C-M-i</code> を iterm2.app の呼び出しに割り当てます．シェルでの作業はどうも <code>eshell</code> では満足できないので．なお flyspell を使っていると，遅延呼び出しした後にキーバインドを奪われるので，取り返します．
</p>

<p>
<code>cmd-to-open-iterm2</code> の実装は，<a href="./utility.el">./utility.el</a> にあります．
</p>

<p>
なお， <code>C-M-i</code> は本来， <code>backward-button</code> に割り当てられています．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(my-cmd-to-open-iterm2)
       <span style="font-style: italic;">"utility"</span> nil t)

  (global-set-key (kbd <span style="font-style: italic;">"C-M-i"</span>) #'my-cmd-to-open-iterm2)

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"flyspell"</span>
    (define-key flyspell-mode-map (kbd <span style="font-style: italic;">"C-M-i"</span>) #'my-cmd-to-open-iterm2))

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"org"</span>
    (define-key org-mode-map (kbd <span style="font-style: italic;">"C-M-i"</span>) #'my-cmd-to-open-iterm2)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org4d91e973" class="outline-3">
<h3 id="org4d91e973"><span class="section-number-3">13.7</span> [counsel-osx-app.el] macOSのアプリケーションを呼び出す&#xa0;&#xa0;&#xa0;<span class="tag"><span class="macOS">macOS</span></span></h3>
<div class="outline-text-3" id="text-org4d91e973">
<p>
Emacs から OS のアプリケーションを呼び出します． <code>Ivy/Counsel</code> の絞り込みを使います．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(counsel-osx-app)
       <span style="font-style: italic;">"counsel-osx-app"</span> nil t)

  (global-set-key (kbd <span style="font-style: italic;">"C-M-1"</span>) 'counsel-osx-app)

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"counsel-osx-app"</span>
    (custom-set-variables
     '(counsel-osx-app-location
       '(<span style="font-style: italic;">"/Applications"</span> <span style="font-style: italic;">"/Applications/Utilities"</span>
         <span style="font-style: italic;">"/System/Applications"</span>
         <span style="font-style: italic;">"/System/Applications/Utilities"</span>
         <span style="font-style: italic;">"/Applications/Microsoft Remote Desktop.localized"</span>)))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org32e35e60" class="outline-3">
<h3 id="org32e35e60"><span class="section-number-3">13.8</span> カレントバッファのあるディレクトリをターミナルで表示</h3>
<div class="outline-text-3" id="text-org32e35e60">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(global-set-key (kbd <span style="font-style: italic;">"C-c f t"</span>) 'my-open-current-directory-in-terminal)
</pre>
</div>
</div>
</div>

<div id="outline-container-org2906cf09" class="outline-3">
<h3 id="org2906cf09"><span class="section-number-3">13.9</span> [gif-screencast.el] ユーザアクションのたびにスクショを取る</h3>
<div class="outline-text-3" id="text-org2906cf09">
<ul class="org-ul">
<li><a href="https://gitlab.com/ambrevar/emacs-gif-screencast">Ambrevar / emacs-gif-screencast · GitLab</a>
<ul class="org-ul">
<li>GitLab に移転しました．</li>
<li><a href="https://github.com/Ambrevar/emacs-gif-screencast">Ambrevar/emacs-gif-screencast: One-frame-per-action GIF recording for optimal quality/size ratio</a></li>
</ul></li>
<li><del>色々と Linux用に設計・前提とされていて，今のところ Mac で使うのはちょっと厳しい．</del>
<ul class="org-ul">
<li>macOS用に追加実装しました．<a href="https://github.com/Ambrevar/emacs-gif-screencast/commit/0ab5f3db2ca0679698a297003cb286e727d12c10#diff-825716ca58bd0ebef62b7ed711446577">本家にマージ</a>されています．</li>
<li>スクショ専門ツールもあります．こちらは <code>import</code> コマンドを利用します．
<ul class="org-ul">
<li><a href="https://github.com/tarsius/frameshot">tarsius/frameshot: Take screenshots of a frame</a></li>
</ul></li>
</ul></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(gif-screencast)
       <span style="font-style: italic;">"gif-screencast"</span> nil t)

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"gif-screencast"</span>
    (<span style="font-weight: bold;">setq</span> gif-screencast-want-optimized nil)
    (<span style="font-weight: bold;">setq</span> gif-screencast-args '(<span style="font-style: italic;">"-x"</span>))
    (<span style="font-weight: bold;">setq</span> gif-screencast-capture-format <span style="font-style: italic;">"ppm"</span>)

    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">Start... M-x gif-screencast</span>
    (define-key gif-screencast-mode-map (kbd <span style="font-style: italic;">"&lt;f5&gt;"</span>) 'gif-screencast-stop)
    (define-key gif-screencast-mode-map (kbd <span style="font-style: italic;">"S-&lt;f5&gt;"</span>)
      'gif-screencast-toggle-pause)

    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">&#25313;&#24373;</span>
    (<span style="font-weight: bold;">defcustom</span> <span style="font-weight: bold; font-style: italic;">gif-screencast-additional-normal-hooks</span> '()
      <span style="font-style: italic;">"A list of hooks. These hooks activate `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">gif-screencast-capture</span><span style="font-style: italic;">'."</span>
      <span style="font-weight: bold;">:group</span> 'gif-screencast
      <span style="font-weight: bold;">:type</span> '(repeat hook))

    (add-to-list 'gif-screencast-additional-normal-hooks
                 'window-size-change-functions) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">for which-key.el, as of 26.1</span>
    (add-to-list 'gif-screencast-additional-normal-hooks
                 'window-configuration-change-hook) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">for which-key.el</span>
    (add-to-list 'gif-screencast-additional-normal-hooks 'focus-in-hook)
    (add-to-list 'gif-screencast-additional-normal-hooks 'focus-out-hook)
    (add-to-list 'gif-screencast-additional-normal-hooks 'minibuffer-setup-hook)
    (add-to-list 'gif-screencast-additional-normal-hooks 'minibuffer-exit-hook)
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(add-to-list 'gif-screencast-additional-normal-hooks 'pre-redisplay-functions)</span>
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">pre-redisplay-functions &#12399;&#12420;&#12400;&#12356;&#65294;</span>

    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">modification-hooks</span>
    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">ad:gif-screencast</span> ()
      (<span style="font-weight: bold;">dolist</span> (hook gif-screencast-additional-normal-hooks)
        (add-hook hook #'gif-screencast-capture)))
    (advice-add 'gif-screencast <span style="font-weight: bold;">:after</span> #'ad:gif-screencast)

    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">ad:gif-screencast-stop</span> ()
      (<span style="font-weight: bold;">dolist</span> (hook gif-screencast-additional-normal-hooks)
        (remove-hook hook 'gif-screencast-capture)))
    (advice-add 'gif-screencast-stop <span style="font-weight: bold;">:after</span> #'ad:gif-screencast-stop)

    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">ad:gif-screencast-toggle-pause</span> ()
      (<span style="font-weight: bold;">if</span> (memq 'gif-screencast-capture (default-value 'pre-command-hook))
          (<span style="font-weight: bold;">dolist</span> (hook gif-screencast-additional-normal-hooks)
            (remove-hook hook 'gif-screencast-capture))
        (<span style="font-weight: bold;">dolist</span> (hook gif-screencast-additional-normal-hooks)
          (add-hook hook #'gif-screencast-capture))))
    (advice-add 'gif-screencast-toggle-pause
                <span style="font-weight: bold;">:before</span> #'ad:gif-screencast-toggle-pause)

    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">ad:gif-screencast-opendir</span> ()
      <span style="font-style: italic;">"Open the output directory when screencast is finished."</span>
      (<span style="font-weight: bold;">if</span> (not (eq system-type 'darwin))
          (my-gif-screencast-opendir-dired)
        (shell-command-to-string
         (concat <span style="font-style: italic;">"open "</span> gif-screencast-screenshot-directory))
        (shell-command-to-string
         (concat <span style="font-style: italic;">"open "</span> gif-screencast-output-directory))))
    (advice-add 'gif-screencast-stop <span style="font-weight: bold;">:before</span> #'ad:gif-screencast-opendir)

    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-gif-screencast-opendir-dired</span> ()
      <span style="font-style: italic;">"Open directories for screenshots and generated GIFs by Dired."</span>
      (<span style="font-weight: bold;">interactive</span>)
      (dired gif-screencast-output-directory)
      (dired gif-screencast-screenshot-directory))))
</pre>
</div>
</div>
</div>

<div id="outline-container-orged473d8d" class="outline-3">
<h3 id="orged473d8d"><span class="section-number-3">13.10</span> [utility.el] 自作してテスト中の便利関数群</h3>
<div class="outline-text-3" id="text-orged473d8d">
<p>
関数定義を<a href="https://pxaka.tokyo/wiki/doku.php?id=emacs:utility.el">別ファイル</a>に分離して，Emacs起動の高速化を図っています．各関数を autoload の管理下において，必要なときにロードするように設定しています．
</p>

<p>
なお， <code>C-M--</code> は本来， <code>negative-argument</code> に割り振られています．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(global-set-key (kbd <span style="font-style: italic;">"C-M--"</span>) 'my-cycle-bullet-at-heading)
<span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(global-set-key (kbd "&lt;f12&gt;") 'my-open-file-ring)</span>
<span style="font-weight: bold; font-style: italic;">;;  </span><span style="font-weight: bold; font-style: italic;">(global-set-key (kbd "C-c t") 'my-date)</span>
(global-set-key (kbd <span style="font-style: italic;">"C-c f 4"</span>) 'my-window-resizer)
</pre>
</div>
</div>
</div>

<div id="outline-container-org72dab3c6" class="outline-3">
<h3 id="org72dab3c6"><span class="section-number-3">13.11</span> [manage-minor-mode.el] マイナーモードの視覚的な管理</h3>
<div class="outline-text-3" id="text-org72dab3c6">
<p>
マイナーモードの動作状況を視覚的に確認できます．さらに，モードのON/OFFを指定できます．
</p>

<ul class="org-ul">
<li><a href="http://fukuyama.co/manage-minor-mode">minor-modeを簡単に切り替える manage-minor-mode.el Emacs Lisp - Web学び</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(manage-minor-mode)
       <span style="font-style: italic;">"manage-minor-mode"</span> nil t)

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"manage-minor-mode"</span>
    (define-key manage-minor-mode-map (kbd <span style="font-style: italic;">"q"</span>)
      (<span style="font-weight: bold;">lambda</span> () (<span style="font-weight: bold;">interactive</span>)
          (delete-window (get-buffer-window <span style="font-style: italic;">"*manage-minor-mode*"</span>))))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org2adaf11c" class="outline-3">
<h3 id="org2adaf11c"><span class="section-number-3">13.12</span> 検索語を変えずに counsel-fzf に接続する</h3>
<div class="outline-text-3" id="text-org2adaf11c">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"counsel"</span>
<span style="font-weight: bold; font-style: italic;">;;; </span><span style="font-weight: bold; font-style: italic;">auto fzf, 0&#20214;&#12498;&#12483;&#12488;&#12398;&#26178;&#65292;1&#22238;&#12384;&#12369;[y/n]&#12391; counsel-fzf &#12395;&#32331;&#12368;&#12363;&#21839;&#12358;</span>
  (<span style="font-weight: bold;">defcustom</span> <span style="font-weight: bold; font-style: italic;">my-nocand-then-fzf-commands</span> '(counsel-recentf
                                           counsel-projectile-find-file
                                           counsel-projectile-switch-project)
    <span style="font-style: italic;">"List of commands for applying extension no candidates then `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">counsel-fzf</span><span style="font-style: italic;">'."</span>
    <span style="font-weight: bold;">:group</span> 'ivy
    <span style="font-weight: bold;">:type</span> '(list symbol))

  (<span style="font-weight: bold;">defcustom</span> <span style="font-weight: bold; font-style: italic;">my-nocand-then-fzf-idle-time</span> 0.8
    <span style="font-style: italic;">"Idle time for showing prompt."</span>
    <span style="font-weight: bold;">:group</span> 'ivy
    <span style="font-weight: bold;">:type</span> 'float) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">N[s] &#28961;&#24540;&#31572;&#12398;&#26178;[y/n]&#12434;&#20986;&#12377;&#65294;</span>

  (<span style="font-weight: bold;">defvar</span> <span style="font-weight: bold; font-style: italic;">my--nocand-then-fzf</span> t)
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-nocand-then-fzf-reset</span> ()
    (<span style="font-weight: bold;">setq</span> my--nocand-then-fzf t))
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-nocand-then-fzf</span> (prompt)
    (<span style="font-weight: bold;">when</span> (= ivy--length 0)
      (<span style="font-weight: bold;">if</span> (eq (read-char prompt) ?y) <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">y-or-n-p is not applicable</span>
          (ivy-exit-with-action
           (<span style="font-weight: bold;">lambda</span> (_x)
             (counsel-fzf ivy-text default-directory)))
        (<span style="font-weight: bold;">setq</span> my--nocand-then-fzf nil))))
  (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">ad:fzf:ivy--insert-prompt</span> ()
    (<span style="font-weight: bold;">when</span> (<span style="font-weight: bold;">and</span> my--nocand-then-fzf
               (memq (ivy-state-caller ivy-last) my-nocand-then-fzf-commands)
               (= ivy--length 0))
      (<span style="font-weight: bold;">let*</span> ((std-props
              '(front-sticky t rear-nonsticky t field t read-only t))
             (prompt (concat (my-pre-prompt-function)
                             <span style="font-style: italic;">"Switch to Counsel-fzf? [y/n] "</span>)))
        (set-text-properties 0 (length prompt)
                             `(face minibuffer-prompt ,@std-props) prompt)
        (run-with-idle-timer my-nocand-then-fzf-idle-time
                             nil #'my-nocand-then-fzf prompt))))
  (advice-add 'ivy--insert-prompt <span style="font-weight: bold;">:before</span> #'ad:fzf:ivy--insert-prompt)
  (add-hook 'minibuffer-setup-hook #'my-nocand-then-fzf-reset)
  (add-hook 'minibuffer-exit-hook #'my-nocand-then-fzf-reset))
</pre>
</div>
</div>
</div>

<div id="outline-container-org409d5d63" class="outline-3">
<h3 id="org409d5d63"><span class="section-number-3">13.13</span> [gitter.el] Gitter にログイン</h3>
<div class="outline-text-3" id="text-org409d5d63">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">late-init.el</span>
(autoload-if-found '(gitter) <span style="font-style: italic;">"gitter"</span>  nil t)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc75ab540" class="outline-3">
<h3 id="orgc75ab540"><span class="section-number-3">13.14</span> <span class="todo TODO">TODO</span> [password-store.el] パスワード管理</h3>
<div class="outline-text-3" id="text-orgc75ab540">
<ul class="org-ul">
<li><a href="http://h12.me/article/password-management">http://h12.me/article/password-management</a></li>
<li><a href="http://www.tricksofthetrades.net/2015/07/04/notes-pass-unix-password-manager/">http://www.tricksofthetrades.net/2015/07/04/notes-pass-unix-password-manager/</a></li>
<li>Add no-tty into ~/.gnupg/gpg.conf if an error occurred.</li>
<li>システムで <code>pass</code> コマンドを使えることが条件</li>
<li><a href="https://github.com/ecraven/ivy-pass">ecraven/ivy-pass: ivy interface for pass</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">if</span> (not (executable-find <span style="font-style: italic;">"pass"</span>))
    (message <span style="font-style: italic;">"--- pass is NOT installed."</span>)
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(global-set-key (kbd "C-c f p") 'helm-pass)</span>
  <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">(autoload-if-found '(helm-pass) "helm-pass" nil t)</span>
  (global-set-key (kbd <span style="font-style: italic;">"C-c f p"</span>) 'ivy-pass)
  (autoload-if-found '(ivy-pass) <span style="font-style: italic;">"ivy-pass"</span> nil t))
</pre>
</div>

<p>
もしくは， <code>id-manager.el</code> もパスワード管理に利用できる．こちらは特定のコマンドがシステムにインストールされていなくても動く．
</p>

<ul class="org-ul">
<li>The encrypted file is stored as ~/.idm-db.gpg.</li>
<li><a href="http://d.hatena.ne.jp/kiwanami/20110221/1298293727">http://d.hatena.ne.jp/kiwanami/20110221/1298293727</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(id-manager)
       <span style="font-style: italic;">"id-manager"</span> nil t)

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"id-manager"</span>
    (setenv <span style="font-style: italic;">"GPG_AGENT_INFO"</span> nil)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org1141e95f" class="outline-3">
<h3 id="org1141e95f"><span class="section-number-3">13.15</span> <span class="todo TODO">TODO</span> [network-watch.el] ネットワークインターフェイスの状態を監視</h3>
<div class="outline-text-3" id="text-org1141e95f">
<ul class="org-ul">
<li>プロキシ内での挙動は不明．</li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(network-watch-mode
         network-watch-active-p ad:network-watch-update-lighter)
       <span style="font-style: italic;">"network-watch"</span> nil t)

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"network-watch"</span>
    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">ad:network-watch-update-lighter</span> ()
      <span style="font-style: italic;">"Return a mode lighter reflecting the current network state."</span>
      (<span style="font-weight: bold;">unless</span> (network-watch-active-p) <span style="font-style: italic;">" NW&#8595;"</span>))
    (advice-add 'network-watch-update-lighter
                <span style="font-weight: bold;">:override</span> #'ad:network-watch-update-lighter))

  (<span style="font-weight: bold;">unless</span> noninteractive
    (<span style="font-weight: bold;">if</span> shutup-p
        (shut-up (network-watch-mode 1))
      (network-watch-mode 1))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org71c49002" class="outline-3">
<h3 id="org71c49002"><span class="section-number-3">13.16</span> <span class="done DONE">DONE</span> [lingr.el] チャットルームに自動参加&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></h3>
<div class="outline-text-3" id="text-org71c49002">
<p>
init.el読書会が毎週土曜日の23時に開催されています．作業に集中していると，ついつい忘れてしまうので，その時間が来たら自動的にログインするように設定しています．ユーザ名とパスワードは，セキュリティを考慮して別なファイルに記載しています．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"># late-init.el
(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(lingr-login my-lingr-login)
       <span style="font-style: italic;">"lingr"</span> nil t)

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"lingr"</span>
    (custom-set-variables
     '(lingr-icon-mode t)
     '(lingr-icon-fix-size 24)
     '(lingr-image-convert-program  (<span style="font-weight: bold;">or</span> (executable-find <span style="font-style: italic;">"convert"</span>)
                                        lingr-image-convert-program))))

  (<span style="font-weight: bold;">when</span> (future-time-p <span style="font-style: italic;">"23:00"</span>)
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">do not use `</span><span style="font-weight: bold; font-style: italic; text-decoration: underline;">run-at-time</span><span style="font-weight: bold; font-style: italic;">' at booting since diary-lib.el</span>
    <span style="font-weight: bold; font-style: italic;">;; </span><span style="font-weight: bold; font-style: italic;">will be loaded. It requires loading cost.</span>
    (run-at-time <span style="font-style: italic;">"23:00"</span> nil 'my-lingr-login)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org2be833d3" class="outline-3">
<h3 id="org2be833d3"><span class="section-number-3">13.17</span> <span class="done DONE">DONE</span> [lingr.el] lingr にログインする&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></h3>
<div class="outline-text-3" id="text-org2be833d3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="font-weight: bold;">when</span> (autoload-if-found
       '(lingr-login)
       <span style="font-style: italic;">"lingr"</span> nil t)

  (<span style="font-weight: bold;">with-eval-after-load</span> <span style="font-style: italic;">"lingr"</span>
    (<span style="font-weight: bold;">defun</span> <span style="font-weight: bold;">my-lingr-login</span> ()
      (<span style="font-weight: bold;">when</span> (string= <span style="font-style: italic;">"Sat"</span> (format-time-string <span style="font-style: italic;">"%a"</span>))
        (lingr-login)))))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org362fb2dc" class="outline-2">
<h2 id="org362fb2dc"><span class="section-number-2">14</span> おわりに</h2>
<div class="outline-text-2" id="text-org362fb2dc">
<p>
以上が，私の <code>init.el</code> とその説明です．
</p>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Takaaki Ishikawa</p>
<p class="date">Created: 2020-06-25 Thu 23:03</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
