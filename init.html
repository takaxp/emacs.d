<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2023-09-19 Tue 16:09 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Configurations for GNU Emacs</title>
<meta name="author" content="Takaaki Ishikawa" />
<meta name="generator" content="Org Mode" />
<style>
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { }
</style>
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/css/readtheorg.css"/>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/lib/js/jquery.stickytableheaders.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/js/readtheorg.js"></script>
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous" />
<style>pre{ font-family: Inconsolata; }</style>
</head>
<body>
<div id="content" class="content">
<h1 class="title">Configurations for GNU Emacs</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#orgda9120c8">1. はじめに</a></li>
<li><a href="#org2a411a2e">2. 起動設定</a>
<ul>
<li><a href="#orgdb94bf6d">2.1. Spacemacs</a></li>
<li><a href="#org2db575a1">2.2. init.el のヘッダ</a></li>
<li><a href="#org43b7d78e">2.3. [early-init.el] early-init.el を使う</a></li>
<li><a href="#org3c4d5a7a">2.4. initファイルの読み込み時間計測</a>
<ul>
<li><a href="#org715ba410">2.4.1. Emacs 起動時の呼び出し順</a></li>
</ul>
</li>
<li><a href="#orga09727ae">2.5. 起動時間の計測</a></li>
<li><a href="#orgb459f5a2">2.6. 実行時間の計測</a></li>
<li><a href="#org4c3e9f59">2.7. GCサイズの最適化</a></li>
<li><a href="#orgc7901a57">2.8. Common Lisp を使う</a></li>
<li><a href="#org625e4ab2">2.9. メッセージ出力の抑制</a></li>
<li><a href="#org8b967ce1">2.10. 警告の抑制</a></li>
<li><a href="#org0ea7dbaf">2.11. エラー表示の抑制</a></li>
<li><a href="#org8d718626">2.12. バッファの保存を静かにする</a></li>
<li><a href="#org660ba5e8">2.13. [my-load-package-p] 設定の読み込みフラグを確認する</a></li>
<li><a href="#orgc0921cdc">2.14. [autoload-if-found] 関数をリストで渡すautoload設定</a></li>
<li><a href="#orga2859651">2.15. [postpone.el] Emacs起動してから使い始めるタイミングで実行する</a></li>
<li><a href="#org124f13e2">2.16. [future-time-p] 指定時刻が本日の未来の時刻かを判定</a></li>
<li><a href="#org30c47759">2.17. [library-p] load-path にライブラリがあるかを判定</a></li>
<li><a href="#orgb75ac2db">2.18. run-at-time をハックして diary-lib.el の読み込みを抑制</a></li>
<li><a href="#orgdc071e4d">2.19. <span class="todo TODO">TODO</span> [gcmh.el] idle 中にGC実行</a></li>
<li><a href="#orgfca510d8">2.20. [shut-up.el] Messages 出力を封じる（制御する）</a>
<ul>
<li><a href="#orgb6593164">2.20.1. with-suppressed-message&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></a></li>
</ul>
</li>
<li><a href="#org5a18ac68">2.21. Native comp が使えるかを判定する</a></li>
<li><a href="#orgb59612b6">2.22. [exec-path-from-shell.el] PATH設定をシェルから継承する&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></a></li>
<li><a href="#org0b7d9710">2.23. [eval-after-autoload-if-found] 遅延読み込み&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></a>
<ul>
<li><a href="#org42722212">2.23.1. 関数版</a></li>
<li><a href="#org1498f6ce">2.23.2. マクロ版</a></li>
</ul>
</li>
<li><a href="#orgcea06248">2.24. <span class="done DONE">DONE</span> [window-focus-p] フォーカス判定</a></li>
</ul>
</li>
<li><a href="#org8e58f563">3. コア設定</a>
<ul>
<li><a href="#org218fe598">3.1. 言語／文字コード</a></li>
<li><a href="#org08c6f620">3.2. 日本語入力</a></li>
<li><a href="#org532e1f02">3.3. 基本キーバインド</a></li>
<li><a href="#org62c41327">3.4. ナローイングするか</a></li>
<li><a href="#org162dbe4a">3.5. バッファの終わりでのnewlineを禁止する</a></li>
<li><a href="#orgff941e69">3.6. 常に最終行に一行追加する</a></li>
<li><a href="#org7a9614cc">3.7. 長い文章を右端で常に折り返す</a></li>
<li><a href="#org8dd417a4">3.8. マウスで選択した領域を自動コピー</a></li>
<li><a href="#org1b2d3cc0">3.9. compilation buffer でのデータ表示で自動するスクロールする</a></li>
<li><a href="#orgbe5f52a7">3.10. NS版でスクロール時の表示乱れを補正</a></li>
<li><a href="#orgb26cd017">3.11. 水平方向の自動スクロール調整</a></li>
<li><a href="#org68d1750d">3.12. C-x C-c で容易にEmacsを終了させないように質問する</a></li>
<li><a href="#orgd7b8f4e2">3.13. パッケージ管理</a>
<ul>
<li><a href="#orgf6f05dc9">3.13.1. [cask-mode.el] モード設定</a></li>
<li><a href="#org02669d67">3.13.2. Cask のセットアップ</a></li>
<li><a href="#orgec66ea31">3.13.3. load-path を一箇所にして起動を高速化</a></li>
<li><a href="#orgda4ef167">3.13.4. [paradox.el] パッケージ選択画面の改善</a></li>
<li><a href="#org6c5717fc">3.13.5. [el-get.el] パッケージ管理（GUI，CUI）</a></li>
</ul>
</li>
<li><a href="#org03555a6a">3.14. インデント</a></li>
<li><a href="#orgfc7cc004">3.15. ファイルリンクを辿る時に確認のメッセージを出さない</a></li>
<li><a href="#orgc2257142">3.16. バッファが外部から編集された場合に自動で再読み込みする</a></li>
<li><a href="#org4ea9e5f1">3.17. マウススクロールをピクセル単位にする</a></li>
<li><a href="#org6a9f8b88">3.18. デフォルトディレクトリ</a></li>
<li><a href="#org5dd2a9d7">3.19. <span class="todo TODO">TODO</span> git用の設定ファイル読み込み</a></li>
<li><a href="#orgb5cd55a9">3.20. [aggressive-indent.el] 即時バッファ整形</a></li>
<li><a href="#org723e2b73">3.21. [uniquify.el] 同じバッファ名が開かれた場合に区別する</a></li>
<li><a href="#org982c69d7">3.22. [ws-butler.el] 不要なスペースを自動除去</a></li>
<li><a href="#orge014847e">3.23. [epa.el] GPGを使う</a></li>
<li><a href="#orgedc5d7af">3.24. [epa.el] GPGファイルの保存時のメッセージを停止する</a></li>
<li><a href="#org6ff409ba">3.25. GPGファイルを一定時間後にロックする</a></li>
<li><a href="#orge44eded5">3.26. NSビルド用設定&#xa0;&#xa0;&#xa0;<span class="tag"><span class="macOS">macOS</span></span></a></li>
<li><a href="#org53a63301">3.27. EMPビルド用設定&#xa0;&#xa0;&#xa0;<span class="tag"><span class="macOS">macOS</span></span></a></li>
</ul>
</li>
<li><a href="#org35f3bbc9">4. カーソル移動</a>
<ul>
<li><a href="#org2a46a2bd">4.1. バッファ内のカーソル移動</a></li>
<li><a href="#org3bebf489">4.2. バッファ間のカーソル移動</a></li>
<li><a href="#orgc4c0ed9a">4.3. 対応するカッコを選択（逆方向）</a></li>
<li><a href="#orgb8c57f30">4.4. スクロールを制御</a></li>
<li><a href="#org5f40f030">4.5. スクロールで表示を重複させる行数</a></li>
<li><a href="#org9811c7e8">4.6. マーク箇所を遡る</a></li>
<li><a href="#org7ea97f70">4.7. [ah.el] カーソル移動に反応するフック</a></li>
<li><a href="#orgc62cc9bf">4.8. [smooth-scroll.el] 滑らかなスクロール</a></li>
<li><a href="#org768c06a0">4.9. [bs.el] 続・カレントバッファの表示切り替え</a></li>
<li><a href="#orgd5942d14">4.10. [bm.el] カーソル位置をブックマークして追う</a></li>
<li><a href="#orgfa2bad61">4.11. [centered-cursor-mode.el] カーソル位置をバッファ中央に固定</a></li>
<li><a href="#orgadf36a14">4.12. [smart-mark] C-g後に元の場所へカーソルを戻す</a></li>
<li><a href="#orgf75f443a">4.13. [syntax-subword.el] M-f で移動する位置をより密にする</a></li>
<li><a href="#org3901456e">4.14. [expand-region.el] カーソル箇所を起点に選択範囲を賢く広げる</a></li>
<li><a href="#org8435eae2">4.15. <span class="done DONE">DONE</span> [goto-chg.el] 編集箇所を簡単に辿る&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></a></li>
<li><a href="#org27e3241e">4.16. <span class="done DONE">DONE</span> [cycle-buffer.el] カレントバッファの表示切り替え&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></a></li>
<li><a href="#orgd906e864">4.17. <span class="done DONE">DONE</span> [back-button] マークをたどる&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></a></li>
<li><a href="#org42db9464">4.18. <span class="done DONE">DONE</span> [point-undo.el] カーソル位置を簡単にたどる&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></a></li>
<li><a href="#org1af5f062">4.19. <span class="done DONE">DONE</span> [SmoothScroll.el] カーソル固定でスクロールする&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></a></li>
</ul>
</li>
<li><a href="#org36bb3b1a">5. 編集サポート</a>
<ul>
<li><a href="#org6f2cf1cd">5.1. エンターキーの挙動</a></li>
<li><a href="#org4c4fe29c">5.2. Yank時に装飾を取る</a></li>
<li><a href="#orgf6cb5849">5.3. 矩形編集／連番入力</a></li>
<li><a href="#org9dba91d0">5.4. ファイル保存時に時間を記録する</a></li>
<li><a href="#orge62264fe">5.5. 選択リージョンを使って検索</a></li>
<li><a href="#org7cb03523">5.6. ChangeLog モード</a></li>
<li><a href="#org1bd5d8ee">5.7. テキストモード</a></li>
<li><a href="#org92da42b4">5.8. C/C++モード</a></li>
<li><a href="#orga6184922">5.9. C#モード</a></li>
<li><a href="#org743f2508">5.10. Infoモード</a></li>
<li><a href="#orgd2a57328">5.11. Rモード</a></li>
<li><a href="#org8c99f06c">5.12. nXMLモード</a></li>
<li><a href="#orgbfa6c13b">5.13. yamlモード</a></li>
<li><a href="#org34a54f82">5.14. jsonモード</a></li>
<li><a href="#orgc35f66fb">5.15. javascriptモード</a></li>
<li><a href="#orga7d86e03">5.16. csvモード</a></li>
<li><a href="#orgba009928">5.17. asciiモード</a></li>
<li><a href="#orgc5b5891d">5.18. javaモード</a></li>
<li><a href="#orgf0c39e0f">5.19. esモード</a></li>
<li><a href="#org2a14728f">5.20. gnuplotモード</a></li>
<li><a href="#orga6fc6cf7">5.21. markdown-modeモード</a></li>
<li><a href="#org29328dcd">5.22. cmakeモード</a></li>
<li><a href="#org41da658e">5.23. logviewモード</a></li>
<li><a href="#org6b6c1c11">5.24. viewモード</a></li>
<li><a href="#orgfdeec1c5">5.25. Web/HTMLモード&#xa0;&#xa0;&#xa0;<span class="tag"><span class="web">web</span></span></a></li>
<li><a href="#orge1eeb2a1">5.26. POモード</a></li>
<li><a href="#org58f62c66">5.27. Goモード</a></li>
<li><a href="#orge727dabc">5.28. スペルチェック</a></li>
<li><a href="#orgdd65fc08">5.29. リアルタイムスペルチェック</a></li>
<li><a href="#org9317ee6f">5.30. リージョン内の文字をカウントする</a></li>
<li><a href="#org863cfc2a">5.31. 世界時計を使う</a></li>
<li><a href="#orgee372b48">5.32. [counsel-world-clock.el] ivy でタイムゾーンの情報を選択する</a></li>
<li><a href="#orgab4f9bf0">5.33. [latex-math-preview.el] TeX数式をプレビュー&#xa0;&#xa0;&#xa0;<span class="tag"><span class="tex">tex</span></span></a></li>
<li><a href="#org770fb4ec">5.34. [yatex.el] YaTeXでTex編集&#xa0;&#xa0;&#xa0;<span class="tag"><span class="tex">tex</span></span></a></li>
<li><a href="#org9b92b6f8">5.35. [auxtex.el] AUCTEXでTex編集&#xa0;&#xa0;&#xa0;<span class="tag"><span class="tex">tex</span></span></a></li>
<li><a href="#org2e5c6e4f">5.36. [yasnippet.el] Emacs用のテンプレートシステム</a>
<ul>
<li><a href="#org8166015d">5.36.1. [ivy-yasnippet.el] yasnippet.el の ivy インターフェイス</a></li>
</ul>
</li>
<li><a href="#orgbea14b16">5.37. [osx-dictionary.el] macOSのdictionary.appで辞書をひく</a></li>
<li><a href="#orgca044d69">5.38. [describe-number.el] 16進数などを確認</a></li>
<li><a href="#org98d5c1aa">5.39. [emmet-mode.el] zencoding の後継&#xa0;&#xa0;&#xa0;<span class="tag"><span class="web">web</span></span></a></li>
<li><a href="#orgc885e502">5.40. [web-beautify.el] ソースコード整形&#xa0;&#xa0;&#xa0;<span class="tag"><span class="web">web</span></span></a></li>
<li><a href="#orgc3ce60f5">5.41. [smartparens.el] 対応するカッコの挿入をアシスト</a></li>
<li><a href="#orgcbb87f41">5.42. <span class="todo TODO">TODO</span> [grugru.el] 所定のキーワードをサイクルさせる</a></li>
<li><a href="#org69748b72">5.43. [replace-from-region.el] 選択領域を別の文字列に置き換える</a></li>
<li><a href="#orgbc8501cf">5.44. [selected.el] リージョン選択時のアクションを制御</a></li>
<li><a href="#org98897862">5.45. [helm-selected.el] selecte.el のアクション候補を絞り込み</a></li>
<li><a href="#orgeafa82dd">5.46. [counsel-selected.el] 続・selected.el のアクション候補絞り込み</a></li>
<li><a href="#org9e3510c2">5.47. <span class="todo TODO">TODO</span> [multiple-cursors.el] 指定箇所を同時編集</a></li>
<li><a href="#orge18cb840">5.48. <span class="todo TODO">TODO</span> [isolate.el] ブラケット等の入力をアシスト</a></li>
<li><a href="#orgc6f37d6d">5.49. <span class="todo TODO">TODO</span> [git-complete.el] GIT grep を使う補完エンジン</a></li>
<li><a href="#orgab8a7bee">5.50. <span class="todo TODO">TODO</span> [tiny.el] 連番入力をサポート</a></li>
<li><a href="#org12a087af">5.51. <span class="todo TODO">TODO</span> [bratex.el] LaTeX 数式のブラケット入力をサポート</a></li>
<li><a href="#orgb3d87116">5.52. <span class="done DONE">DONE</span> [iedit.el] バッファ内の同じ文字列を一度に編集する&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></a></li>
<li><a href="#orgf18160de">5.53. <span class="done DONE">DONE</span> [lookup.el] 辞書&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></a></li>
<li><a href="#org903987d3">5.54. <span class="done DONE">DONE</span> [cacoo] Cacoo で描く&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></a></li>
<li><a href="#org56cbbb36">5.55. <span class="done DONE">DONE</span> [zencoding-mode] HTML編集の高速化&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></a></li>
<li><a href="#org7e84aa55">5.56. <span class="done DONE">DONE</span> [sdic.el] 英辞郎で英単語を調べる&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></a></li>
<li><a href="#org52c2a77d">5.57. <span class="done DONE">DONE</span> [dictionary.app] macOSのdictionary.appでCOBUILD5をひく&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></a>
<ul>
<li><a href="#org34b20ea7">5.57.1. マイナーモード化</a></li>
<li><a href="#org34f10f81">5.57.2. キーバインド</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org94c7bd73">6. 表示サポート</a>
<ul>
<li><a href="#orgf6a240ab">6.1. キーコマンド入力中に入力過程をミニバッファに反映する</a></li>
<li><a href="#org581a32ab">6.2. <span class="todo TODO">TODO</span> モードラインの色をナローイングで変える</a></li>
<li><a href="#org3368625d">6.3. <span class="todo TODO">TODO</span> モードラインのNarrowを短くする</a></li>
<li><a href="#org8e939aed">6.4. <span class="todo TODO">TODO</span> [mlscroll.el] モードラインにバッファ内表示位置をバー形式で表示</a></li>
<li><a href="#org5fd3a668">6.5. モードラインの節約（VC-mode編）</a></li>
<li><a href="#orgb577af83">6.6. モードラインの色をカスタマイズする</a>
<ul>
<li><a href="#org21b30e75">6.6.1. 色セット例</a></li>
</ul>
</li>
<li><a href="#org328bb797">6.7. visible-bell のカスタマイズ</a></li>
<li><a href="#org91a9f893">6.8. 常に <b>scratch</b> を表示して起動する</a></li>
<li><a href="#orgdf6d1ea2">6.9. スクロールバーを非表示にする</a></li>
<li><a href="#orgdd0a9c41">6.10. ツールバーを非表示にする</a></li>
<li><a href="#org52e500e2">6.11. メニューバーを非表示にする</a></li>
<li><a href="#orgd432e8ff">6.12. 起動時のスプラッシュ画面を表示しない</a></li>
<li><a href="#org0f9c4edc">6.13. ターミナル時のウィンドウ分割線を見やすくする</a></li>
<li><a href="#org4a736379">6.14. default.el を探索させない</a></li>
<li><a href="#org8d729190">6.15. カーソル行の行数をモードラインに表示する</a></li>
<li><a href="#orge456e19c">6.16. カーソル行の関数名をモードラインに表示する</a></li>
<li><a href="#orga76ec530">6.17. 行番号をバッファに表示する</a></li>
<li><a href="#org19cbc9b3">6.18. 行番号の表示制限を拡張する</a></li>
<li><a href="#org5117762c">6.19. 時刻をモードラインに表示する</a></li>
<li><a href="#orga734802e">6.20. 対応するカッコをハイライトする</a></li>
<li><a href="#orgd1e62da7">6.21. 全角スペースと行末タブ／半角スペースを強調表示する</a>
<ul>
<li><a href="#org58e6bf63">6.21.1. emacs 28 からの表示制御</a></li>
</ul>
</li>
<li><a href="#orgc93741fa">6.22. バッファの終わりをフリンジで明示</a></li>
<li><a href="#orgec7835e0">6.23. 文字エンコードの表示を明確化</a></li>
<li><a href="#org0e59b85f">6.24. [delight.el] モードラインのモード名を短縮する</a></li>
<li><a href="#org74bad2de">6.25. [migemo.el] ローマ字入力で日本語を検索する</a></li>
<li><a href="#org6332fe92">6.26. [git-gutter-fringe] 編集差分をフレーム端で視覚化</a></li>
<li><a href="#orgd6308db6">6.27. [japanese-holidays] カレンダーをカラフルにする</a></li>
<li><a href="#org12f72886">6.28. [calendar.el] カレンダーで週番号を表示する</a></li>
<li><a href="#orgc45b24d4">6.29. [which-key] キーバインドの選択肢をポップアップする</a></li>
<li><a href="#org467accb9">6.30. [highlight-symbol] 同じ名前のシンボルをハイライトする</a></li>
<li><a href="#org962224ff">6.31. [all-the-icons.el] フォントでアイコン表示</a></li>
<li><a href="#orgd92b50db">6.32. [all-the-icons-dired] dired でアイコンを表示</a></li>
<li><a href="#org402f1293">6.33. [eldoc.el] コンテクストに応じてヘルプを表示</a></li>
<li><a href="#org138fda77">6.34. [go-eldoc.el] Go用の eldoc</a></li>
<li><a href="#org7cab354d">6.35. [keycast.el] 入力しているキーとコマンドをモードラインに表示</a></li>
<li><a href="#org8af73f26">6.36. [keypression.el] 入力しているキーとコマンドを任意の場所に表示</a></li>
<li><a href="#orgfa7d126f">6.37. [ivy.el] 続々・何でも絞り込みインターフェイス</a></li>
<li><a href="#org9c962eaf">6.38. [ivy.el] プロンプトをカスタマイズ</a></li>
<li><a href="#org45b3667a">6.39. [imenu-list.el] サイドバー的にファイル内容の目次要素を表示</a></li>
<li><a href="#org29951da5">6.40. [prescient.el] リスト項目の並び替えとイニシャル入力機能（ivy and company）</a></li>
<li><a href="#orga3715560">6.41. [command-log-mode.el] 発行したコマンドの履歴をバッファに表示する</a></li>
<li><a href="#orga6eb6883">6.42. <span class="todo TODO">TODO</span> [emacs-tree-sitter.el] tree-sitter でシンタックスハイライトする</a></li>
<li><a href="#orgf0e91c5a">6.43. <span class="todo TODO">TODO</span> [swiper.el] 文字列探索とプレビューを同時に行う</a></li>
<li><a href="#org3d431f2e">6.44. <span class="todo TODO">TODO</span> [all-the-icons-ivy] ivy インターフェイスでアイコンを表示する</a></li>
<li><a href="#org5eaeb687">6.45. <span class="todo TODO">TODO</span> [rainbow-delimiters.el] 対応するカッコに色を付ける</a></li>
<li><a href="#org7270262d">6.46. <span class="todo TODO">TODO</span> [yascroll.el] フリンジにスクロールバーを出す</a></li>
<li><a href="#org8ba0784e">6.47. <span class="todo TODO">TODO</span> [dimmer.el] 現在のバッファ以外の輝度を落とす</a></li>
<li><a href="#orgdef403ec">6.48. <span class="todo TODO">TODO</span> [transient.el] コマンドディスパッチャを構築する</a></li>
<li><a href="#org1e701627">6.49. <span class="done DONE">DONE</span> [hydra.el] コマンドディスパッチャを構築する&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></a></li>
<li><a href="#org56d8bf9d">6.50. <span class="done DONE">DONE</span> [helm.el] 続・何でも絞り込みインターフェイス&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></a></li>
<li><a href="#orgc00267d7">6.51. <span class="done DONE">DONE</span> バッテリー情報をモードラインに表示する&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></a></li>
<li><a href="#org205dbe20">6.52. <span class="done DONE">DONE</span> [mode-icons] 使用中のモード表示をアイコンで代替&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></a></li>
<li><a href="#org6e56a94f">6.53. <span class="done DONE">DONE</span> [stock-ticker] 株価をモードラインに表示&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></a></li>
<li><a href="#org0ed58559">6.54. <span class="done DONE">DONE</span> [zlc.el] find-file バッファを zsh ライクにする&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></a></li>
<li><a href="#org5cc37356">6.55. <span class="done DONE">DONE</span> [stripe-buffer.el] テーブルの色をストライプにする&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></a></li>
<li><a href="#org62c6f085">6.56. <span class="done DONE">DONE</span> [guide-key] キーバインドの選択肢をポップアップする&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></a></li>
<li><a href="#orgdf971702">6.57. <span class="done DONE">DONE</span> [anything.el] 何でも絞り込みインターフェイス&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></a></li>
<li><a href="#org83eaaf3a">6.58. <span class="done DONE">DONE</span> [diminish.el] モードラインのモード名を短くする&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></a></li>
</ul>
</li>
<li><a href="#org9ff300b4">7. メディアサポート</a>
<ul>
<li><a href="#orgcf4022fd">7.1. [emms.el] メディアプレーヤー</a></li>
<li><a href="#orgca126930">7.2. [GoogleMaps.el] GoogleMaps を Emacs 内で使う</a></li>
<li><a href="#org41faa552">7.3. [japanlaw.el] Emacs 電子六法</a></li>
<li><a href="#org8e8f85ec">7.4. [sunshine.el] 天気を知る</a></li>
<li><a href="#orgb77ecd7a">7.5. [org-google-weather.el] org-agenda に天気を表示する&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></a></li>
<li><a href="#org474263ad">7.6. [bongo.el] Emacsのバッファで音楽ライブラリを管理する&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></a></li>
</ul>
</li>
<li><a href="#orgd5aed515">8. 履歴／ファイル管理</a>
<ul>
<li><a href="#org0f46c991">8.1. 履歴サイズを大きくする</a></li>
<li><a href="#org9736b2f0">8.2. Undoバッファを無限に取る</a></li>
<li><a href="#orgf2cd8961">8.3. 最近開いたファイルリストを保持</a></li>
<li><a href="#org9f20061e">8.4. C-g した場所をブックマークする</a></li>
<li><a href="#orgb2530c3e">8.5. 開いているバッファのcopy/rename/deleteと別アプリでの表示</a></li>
<li><a href="#org300e8f70">8.6. バッファ保存時にバックアップを生成させない&#xa0;&#xa0;&#xa0;<span class="tag"><span class="backup">backup</span></span></a></li>
<li><a href="#org89e64435">8.7. 特定のファイルを Dropbox 以下にバックアップする&#xa0;&#xa0;&#xa0;<span class="tag"><span class="backup">backup</span></span></a></li>
<li><a href="#org9b0e7066">8.8. [backup-each-save.el] クラッシュに備える&#xa0;&#xa0;&#xa0;<span class="tag"><span class="backup">backup</span></span></a></li>
<li><a href="#orge2f78ad3">8.9. [dired] ファイラのサポートツール&#xa0;&#xa0;&#xa0;<span class="tag"><span class="dired">dired</span></span></a></li>
<li><a href="#org7c53511f">8.10. [dired-recent.el] 訪問したディレクトリの履歴を取る&#xa0;&#xa0;&#xa0;<span class="tag"><span class="dired">dired</span></span></a></li>
<li><a href="#orga3cbefa8">8.11. [osx-trash] system-move-file-to-trash を有効にする</a></li>
<li><a href="#org6e71b562">8.12. [undo-fu.el] シンプルな redo を提供してくる</a></li>
<li><a href="#orgde08dbd8">8.13. [super-save.el] 所定のタイミングでバッファを保存する</a></li>
<li><a href="#orgb8c01946">8.14. <span class="done DONE">DONE</span> [auto-save-buffers.el] 一定間隔でバッファを保存する&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></a></li>
<li><a href="#orgab837e6a">8.15. [session.el] 様々な履歴を保存し復元に利用する</a></li>
<li><a href="#org92404bbd">8.16. [neotree.el] ディレクトリ情報をツリー表示</a></li>
<li><a href="#orgf2d47943">8.17. [helpful.el] リッチなヘルプページ</a></li>
<li><a href="#orgc08799d2">8.18. [facecheck.el] クリックしてfaceをチェック</a></li>
<li><a href="#org0d952d68">8.19. [keyfreq.el] コマンドログ</a></li>
<li><a href="#orged77c483">8.20. [disk-usage.el] ディスク利用率を調べる</a></li>
<li><a href="#orgdd1e03ec">8.21. [uptimes.el] Emacsの起動時間を記録する</a></li>
<li><a href="#orgfd3c67b9">8.22. [ag.el] 検索</a></li>
<li><a href="#org29c7b6b7">8.23. [counsel-ag.el] 高速全文検索</a></li>
<li><a href="#org24fd7b68">8.24. [counsel-fzf.el] 高速ファイル検索</a></li>
<li><a href="#org694ee426">8.25. <span class="done DONE">DONE</span> [undo-propose] undo を編集不可モードで辿る&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></a></li>
<li><a href="#org82bd942f">8.26. <span class="done DONE">DONE</span> [undo-tree] 編集履歴をわかりやすくたどる&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></a></li>
<li><a href="#orgc47c1e75">8.27. <span class="done DONE">DONE</span> [wakatime-mode.el] WakaTime を利用して作業記録する&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></a></li>
<li><a href="#orgc470d5a3">8.28. <span class="done DONE">DONE</span> [backup-dir.el] バックアップファイルを一箇所に集める&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></a></li>
<li><a href="#org8b2fe680">8.29. <span class="done DONE">DONE</span> バッファ保存時にバックアップファイルを生成する&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></a></li>
<li><a href="#orgdba35c9f">8.30. <span class="done DONE">DONE</span> ミニバッファの履歴を保存しリストアする&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></a></li>
<li><a href="#orgead91174">8.31. <span class="done DONE">DONE</span> Emacs終了時に開いていたバッファを起動時に復元する&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></a></li>
<li><a href="#org63e50e2c">8.32. <span class="done DONE">DONE</span> 深夜にバッファを自動整理する&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></a></li>
</ul>
</li>
<li><a href="#orgf1b8fa63">9. 開発サポート</a>
<ul>
<li><a href="#org9f988c12">9.1. 便利キーバインド</a></li>
<li><a href="#orgac7d1689">9.2. [gist.el] Gist インターフェイス</a></li>
<li><a href="#org7baba8dd">9.3. [doxymacs.el] Doxygen のコメントを簡単に入力する</a></li>
<li><a href="#org0e27778c">9.4. [matlab.el] Matlab用の設定</a></li>
<li><a href="#org966da7c1">9.5. [flycheck.el] 構文エラー表示</a></li>
<li><a href="#org2bf4fb77">9.6. [origami.el] 関数の折りたたみ</a></li>
<li><a href="#org291c6055">9.7. [auto-complete-clang.el] オムニ補完</a>
<ul>
<li><a href="#org3d08c27d">9.7.1. References</a></li>
</ul>
</li>
<li><a href="#orgabd9abb3">9.8. [quickrun.el] お手軽ビルド</a></li>
<li><a href="#org034bbf9f">9.9. [ggtags.el] タグジャンプ</a></li>
<li><a href="#org216e9539">9.10. [0xc.el] N進数変換</a></li>
<li><a href="#orge830f6b0">9.11. [hexl.el] バイナリファイルを開く</a></li>
<li><a href="#org9ffc2142">9.12. [uuid.el] UUID の生成</a></li>
<li><a href="#orga1d9863f">9.13. [package-lint.el] MEPLA登録用Lint</a></li>
<li><a href="#org7d18b489">9.14. [projectile.el] ディレクトリ単位でファイル群をプロジェクト扱いする</a></li>
<li><a href="#org1c672519">9.15. [relint.el] elispの正規表現用のlinter</a></li>
<li><a href="#org7d969237">9.16. [magit.el] Gitクライアント</a></li>
<li><a href="#orgaa25b74c">9.17. <span class="todo TODO">TODO</span> [EditorConfig] コードスタイルの強制</a></li>
<li><a href="#orgae4ecac7">9.18. <span class="todo TODO">TODO</span> [cov] カバレッジの状態をフリンジで確認</a></li>
<li><a href="#orgbf790f4d">9.19. <span class="todo TODO">TODO</span> [format-all.el] コード整形</a></li>
<li><a href="#orgac7d24d7">9.20. <span class="todo TODO">TODO</span> [emr.el] リファクタリング</a></li>
<li><a href="#org4e23f079">9.21. <span class="todo TODO">TODO</span> [rmsbolt.el] アセンブリをバッファにリアルタイム表示</a></li>
<li><a href="#org9547f772">9.22. <span class="todo TODO">TODO</span> [semantic-refactor.el] リファクタリングツール</a></li>
<li><a href="#orgea32afad">9.23. <span class="todo TODO">TODO</span> [company.el] 続・自動補完機能</a></li>
<li><a href="#orgdd272f8c">9.24. <span class="todo TODO">TODO</span> [vterm.el] vterm を使う</a></li>
<li><a href="#org09687b9c">9.25. <span class="done DONE">DONE</span> [auto-complete.el] 自動補完機能&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></a></li>
<li><a href="#orgcde881ad">9.26. <span class="done DONE">DONE</span> [hideshowvis.el] 関数の表示／非表示&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></a></li>
</ul>
</li>
<li><a href="#org47616d05">10. Org Mode</a>
<ul>
<li><a href="#orgf66bb6fe">10.1. 基本設定</a></li>
<li><a href="#orgebb1fbe4">10.2. contribution を使う</a></li>
<li><a href="#org4da0cefd">10.3. iCal との連携</a></li>
<li><a href="#org739cd53d">10.4. スピードコマンド</a></li>
<li><a href="#org480c9b8b">10.5. face 関連</a></li>
<li><a href="#orgdec24da2">10.6. TODOキーワードのカスタマイズ</a></li>
<li><a href="#org55076fa0">10.7. ImageMagick を使って様々な画像をインライン表示する</a></li>
<li><a href="#org53663ca9">10.8. README を常に org-mode で開く</a></li>
<li><a href="#org907cb9db">10.9. ソースブロック等の大文字記述を一括で小文字に変える</a></li>
<li><a href="#orgdae2d9e7">10.10. イベント通知</a></li>
<li><a href="#orga58b21fc">10.11. org-mode でアラーム管理</a></li>
<li><a href="#org49e5d185">10.12. カウントダウンタイマー</a></li>
<li><a href="#orga3d0c218">10.13. リンクをエコーエリアに表示する</a></li>
<li><a href="#org10cf6a0a">10.14. <span class="todo TODO">TODO</span> HHKBで矢印を使わないように設定する</a></li>
<li><a href="#org0d2cce2f">10.15. orgmode のテーブルを csv に変換する</a></li>
<li><a href="#org5c265a12">10.16. ソースブロック内で eldoc の発動を抑制する</a></li>
<li><a href="#org21a5771d">10.17. 見出しの上で org-reveal する場合の挙動を変える</a></li>
<li><a href="#org1bc48f7e">10.18. <span class="todo TODO">TODO</span> org-emphasis-alist の各要素を個別に配色する</a></li>
<li><a href="#org6c2ed02c">10.19. 現在のアイテムをリストの最初・最後に移す</a></li>
<li><a href="#org30aecedf">10.20. [org-capture] 高速にメモを取る</a></li>
<li><a href="#orgc3302e41">10.21. [org-agenda] タスク／予定管理</a></li>
<li><a href="#org735f32e3">10.22. [org-onit.el] org-clock-in の自動化</a></li>
<li><a href="#org20c40e77">10.23. [orgbox.el] スケジュール追加のわかりやすい入力</a></li>
<li><a href="#org5790e981">10.24. [appt.el] アラーム設定</a></li>
<li><a href="#orgf5236175">10.25. [org-refile] orgツリーの高速移動</a></li>
<li><a href="#org49ca5eb9">10.26. [org-babel] Orgバッファでソースコードを扱う</a></li>
<li><a href="#orgc0ed68a2">10.27. [org-babel] ソースブロックの入力キーをカスタマイズ</a></li>
<li><a href="#org556eb376">10.28. [org-babel] ソースブロックの配色</a></li>
<li><a href="#org89c34f23">10.29. [org-tree-slide] Org Modeでプレゼンテーション</a>
<ul>
<li><a href="#org2e94f804">10.29.1. doom-modeline との共存</a></li>
</ul>
</li>
<li><a href="#org264a37c5">10.30. [org-tree-slide] クロックインとアウトを自動化する</a></li>
<li><a href="#orga7162e8c">10.31. [org-tree-slide] 特定のツリーをプロポーショナルフォントで表示する</a></li>
<li><a href="#orgf5c603e5">10.32. [org-tree-slide] ヘッドラインをリッチにする</a></li>
<li><a href="#org639ece0e">10.33. [org-tree-slide] 一時的に #+ATTR_ORG などを非表示にする</a></li>
<li><a href="#orgae555619">10.34. [calfw-org.el] calfw に org の予定を表示する</a></li>
<li><a href="#org02100a39">10.35. [org-odt] ODT形式に出力</a></li>
<li><a href="#org02d2c3de">10.36. [ox-twbs] Twitter Bootstrap 互換のHTML出力</a></li>
<li><a href="#org5a1cb1a1">10.37. [org-crypt] ツリーを暗号化する</a></li>
<li><a href="#org01951291">10.38. [org-mac-link] 外部アプリから情報を取る</a></li>
<li><a href="#orgb3ae0aea">10.39. [org-download] org バッファにD&amp;Dでファイルを保存</a></li>
<li><a href="#org97c39f96">10.40. [org-grep] org ファイルを grep する</a></li>
<li><a href="#org1a7c192b">10.41. [ox-reveal] ナイスなHTML5プレゼンテーション出力</a></li>
<li><a href="#org383ff638">10.42. [org-dashboard] 進捗をプログレスバーで確認</a></li>
<li><a href="#orgfa6df2ce">10.43. [org-clock-today] 今日の総作業時間をモードラインに表示</a></li>
<li><a href="#org56b60c02">10.44. [org-random-todo] ランダムにタスクを選ぶ</a></li>
<li><a href="#org0cba1e62">10.45. [ox-hugo] OrgファイルからHogoの記事をエクスポートする</a></li>
<li><a href="#org32e931e3">10.46. [ox-html] HTML見出しへのリンクを固定する</a></li>
<li><a href="#orga114da46">10.47. [org-id.el] プロパティに ID を入れる</a></li>
<li><a href="#org5cc51a8d">10.48. [orglink.el] Orgファイル以外でリンクを使う</a></li>
<li><a href="#org8480b85f">10.49. [org-trello.el] Trello と双方向同期する</a></li>
<li><a href="#orge01f4572">10.50. [ox.el] ディスパッチャを水平方向の分割画面に表示</a></li>
<li><a href="#orgd536a4cc">10.51. <span class="todo TODO">TODO</span> [org-extra-emphasis] 強調表現を拡張する</a></li>
<li><a href="#orgf5d6500a">10.52. <span class="todo TODO">TODO</span> [org-appear.el] カーソルを置いた時だけマークアップを表示する</a></li>
<li><a href="#org992326f6">10.53. <span class="todo TODO">TODO</span> [ob-async] ソースブロックの非同期実行</a></li>
<li><a href="#org9cbb15f3">10.54. <span class="todo TODO">TODO</span> [org-tree-slide] BEGIN_SRCとEND_SRCを消して背景色を変える</a></li>
<li><a href="#org3ee441c6">10.55. <span class="todo TODO">TODO</span> [org-fstree] ディレクトリ構造を読み取る</a></li>
<li><a href="#orgbb452f44">10.56. <span class="todo TODO">TODO</span> [ox.el] 出力形式の拡張</a></li>
<li><a href="#org4142d8c3">10.57. <span class="todo TODO">TODO</span> Parers3.app からリンクを取得する</a></li>
<li><a href="#org47b1ee67">10.58. <span class="todo TODO">TODO</span> Papers3.app のリンクを開けるようにする</a></li>
<li><a href="#orgd14388c1">10.59. <span class="todo TODO">TODO</span> [org-attach] 外部ファイルを紐付ける</a></li>
<li><a href="#org1926ab44">10.60. <span class="todo TODO">TODO</span> [org-recent-headings] 訪問したツリーを記録し簡単に再訪問可能にする</a></li>
<li><a href="#orgfcfd3f34">10.61. <span class="todo TODO">TODO</span> [orgnav] ツリーの検索インタフェース</a></li>
<li><a href="#org5fce13fa">10.62. <span class="todo TODO">TODO</span> [toc-org] 目次の挿入</a></li>
<li><a href="#org4ca4749d">10.63. <span class="todo TODO">TODO</span> [org-review.el] レビューフローのサポート</a></li>
<li><a href="#org0b29fe80">10.64. REV2 [org-screenshot] スクリーンショットを貼り付ける</a></li>
<li><a href="#org0f4b6016">10.65. <span class="done DONE">DONE</span> [org-autolist] ブリッツの入力を簡単に&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></a></li>
<li><a href="#org39530542">10.66. <span class="done DONE">DONE</span> [MobileOrg] iOS との連携&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></a></li>
<li><a href="#orgfb20898b">10.67. <span class="done DONE">DONE</span> [org-export-generic] エクスポート機能を拡張する&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></a></li>
<li><a href="#org563f7076">10.68. <span class="done DONE">DONE</span> org-mode の latex エクスポート関数をオーバーライド&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></a></li>
</ul>
</li>
<li><a href="#org5fd484a3">11. フレーム／ウィンドウ制御</a>
<ul>
<li><a href="#orgd05fc75a">11.1. 起動時の設定</a></li>
<li><a href="#orgdffe4e49">11.2. 複数フレーム対応</a></li>
<li><a href="#org5f12ba92">11.3. [moom.el] キーボードでフレームの場所を移す</a>
<ul>
<li><a href="#org6e3c20dd">11.3.1. 最大化時にモードラインを消す</a></li>
</ul>
</li>
<li><a href="#org33fd785f">11.4. [winner.el] ウィンドウ構成の履歴を辿る</a></li>
<li><a href="#orga9be167a">11.5. <span class="todo TODO">TODO</span> [shackle.el] ポップアップウィンドウの制御&#xa0;&#xa0;&#xa0;<span class="tag"><span class="Ongoing">Ongoing</span></span></a>
<ul>
<li><a href="#org32b579df">11.5.1. checkdoc.el 用の追加設定</a></li>
</ul>
</li>
<li><a href="#orgdca5e7c2">11.6. <span class="todo TODO">TODO</span> [doom-modeline.el] モードラインをリッチにする</a></li>
<li><a href="#org4dd0671c">11.7. [e2wm.el] 二画面表示&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></a></li>
<li><a href="#org0c556404">11.8. [tabbar-ruler] バッファをタブ切り替え可能に&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></a></li>
<li><a href="#org6474a498">11.9. [elscreen.el] Emacs バッファをタブ化&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></a></li>
<li><a href="#org750d9aa5">11.10. [popwin.el] ポップアップウィンドウの制御&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></a></li>
<li><a href="#org7a20b311">11.11. <span class="done DONE">DONE</span> [olivetti.el] ウィンドウを中央寄せで配置&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></a></li>
</ul>
</li>
<li><a href="#orgf57ce845">12. フォント／配色関連</a>
<ul>
<li><a href="#orgbbb079d3">12.1. 正規表現を見やすくする</a></li>
<li><a href="#orgc98c6fff">12.2. 設定ファイルを見やすくする</a></li>
<li><a href="#org7858d806">12.3. カーソル行に色をつける</a></li>
<li><a href="#org29d5304f">12.4. カーソルの点滅を制御</a></li>
<li><a href="#orgf36a8366">12.5. カーソル位置のフォントを確認</a></li>
<li><a href="#org919a945a">12.6. フォント設定</a>
<ul>
<li><a href="#orgb94aa5b3">12.6.1. フォントのインストール方法</a></li>
<li><a href="#org66fa6b98">12.6.2. フォントチェック用コード</a></li>
</ul>
</li>
<li><a href="#org2bcbc1db">12.7. 行間を制御する</a></li>
<li><a href="#org372b184d">12.8. パッチをカラフルに表示する</a></li>
<li><a href="#org009dc6e3">12.9. 背景を黒系色にする</a></li>
<li><a href="#org6d79c76a">12.10. [hl-todo.el] 特定キーワードの配色を変える</a></li>
<li><a href="#org92d26c4b">12.11. 日中と夜中でテーマを切り替える</a></li>
<li><a href="#org7c97dce0">12.12. 時間帯を指定して起動時にテーマを切り替える</a></li>
<li><a href="#org9ce2fd45">12.13. [rainbow-mode.el] 配色のリアルタイム確認</a>
<ul>
<li><a href="#org19538af3">12.13.1. 色一覧</a></li>
</ul>
</li>
<li><a href="#orgcc116051">12.14. [edit-color-stamp] Qt経由でカラーピッカーを使う</a></li>
<li><a href="#orge836aa4d">12.15. [ivy.el] インターフェイスの配色</a></li>
<li><a href="#org4b927009">12.16. [ivy.el] 選択行をアイコンで強調</a></li>
<li><a href="#org36a28b28">12.17. [volatile-highlights] コピペした領域を強調</a></li>
</ul>
</li>
<li><a href="#org6794a918">13. 非同期実行</a>
<ul>
<li><a href="#orgc4efbf8e">13.1. [async] パッケージのインストール状況を確認</a></li>
<li><a href="#org9fefe803">13.2. [async] 古いバックアップファイルを削除</a></li>
</ul>
</li>
<li><a href="#orgb8e84b9a">14. ユーティリティ関数</a>
<ul>
<li><a href="#orgbfb695e1">14.1. [pomodoro.el] ポモドーロの実践</a></li>
<li><a href="#orgc09c0be3">14.2. [pomodoro.el] 続・ポモドーロの実践</a></li>
<li><a href="#org98f153af">14.3. [google-this.el] 単語をグーグル検索</a></li>
<li><a href="#orgc6fce61d">14.4. [multi-term.el] ターミナル</a></li>
<li><a href="#org96f7a2a3">14.5. [osx-lib.el] macOS用ユーティリティ&#xa0;&#xa0;&#xa0;<span class="tag"><span class="macOS">macOS</span></span></a></li>
<li><a href="#org72d850dc">14.6. iTerm2 を Emacs から呼び出したい&#xa0;&#xa0;&#xa0;<span class="tag"><span class="macOS">macOS</span></span></a></li>
<li><a href="#org4d91e973">14.7. [counsel-osx-app.el] macOSのアプリケーションを呼び出す&#xa0;&#xa0;&#xa0;<span class="tag"><span class="macOS">macOS</span></span></a></li>
<li><a href="#org32e35e60">14.8. カレントバッファのあるディレクトリをターミナルで表示</a></li>
<li><a href="#org2906cf09">14.9. [gif-screencast.el] ユーザアクションのたびにスクショを取る</a></li>
<li><a href="#orged473d8d">14.10. [utility.el] 自作してテスト中の便利関数群</a></li>
<li><a href="#org72dab3c6">14.11. [manage-minor-mode.el] マイナーモードの視覚的な管理</a></li>
<li><a href="#org2adaf11c">14.12. 検索語を変えずに counsel-fzf に接続する</a></li>
<li><a href="#org409d5d63">14.13. [gitter.el] Gitter にログイン</a></li>
<li><a href="#org693f8def">14.14. <span class="todo TODO">TODO</span> [elfeed.el] RSSフィードの管理と閲覧</a></li>
<li><a href="#orgc75ab540">14.15. <span class="todo TODO">TODO</span> [password-store.el] パスワード管理</a></li>
<li><a href="#org1141e95f">14.16. <span class="todo TODO">TODO</span> [network-watch.el] ネットワークインターフェイスの状態を監視</a></li>
<li><a href="#orgf14fe89c">14.17. <span class="todo TODO">TODO</span> [circe.el] IRCにログインする</a></li>
<li><a href="#org71c49002">14.18. <span class="done DONE">DONE</span> [lingr.el] チャットルームに自動参加&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></a></li>
<li><a href="#org2be833d3">14.19. <span class="done DONE">DONE</span> [lingr.el] lingr にログインする&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></a></li>
<li><a href="#orgb91a9245">14.20. ビルド情報をバッファに表示する</a></li>
<li><a href="#orgf426bdf4">14.21. macOSのバージョン情報と名前を取得する</a></li>
<li><a href="#org62365dfa">14.22. iTerm2.app を呼び出す関数</a></li>
<li><a href="#org68ed2087">14.23. サボっていると Kyoko さんに怒られる</a></li>
<li><a href="#orgbf8ddfed">14.24. コンソールでカレントバッファのあるディレクトリに移動する</a></li>
<li><a href="#orgb8c148ec">14.25. ファイルに含まれるテーブルを使って定時にアラートを表示する</a></li>
<li><a href="#org33d4f93d">14.26. 頻繁に利用するファイルをring形式でたどる</a></li>
<li><a href="#org31226d9e">14.27. 引数のorgバッファを開く</a></li>
<li><a href="#org6a1e418a">14.28. orgバッファにいつものヘッダを追加する</a></li>
<li><a href="#org50dc6656">14.29. orgバッファにPGPヘッダとフッタを書き込む</a></li>
<li><a href="#orgf2d1ba3d">14.30. orgバッファでPGPを使った自分宛ての暗号化データ生成する</a></li>
<li><a href="#org8f57b3f8">14.31. 議事録ひな形を書き入れる</a></li>
<li><a href="#orgdd9630ad">14.32. ランダムの文字列を取得する</a></li>
<li><a href="#org3697f6bd">14.33. 行頭に" - "を挿入する&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></a></li>
<li><a href="#org9aef972b">14.34. 定期実行関数</a></li>
<li><a href="#org175a102f">14.35. ブラウザの設定</a></li>
<li><a href="#orgca3eae6b">14.36. バックアップファイルの削除</a></li>
<li><a href="#org65219005">14.37. chomp</a></li>
<li><a href="#org9731a19e">14.38. 特定のファイルを Dropbox 以下にバックアップする</a></li>
<li><a href="#orgdfad16ba">14.39. ゴミ箱を空にする&#xa0;&#xa0;&#xa0;<span class="tag"><span class="macOS">macOS</span></span></a></li>
<li><a href="#org4842582b">14.40. 終了シーケンスのデバッグ用関数</a></li>
<li><a href="#orgeb3d01a8">14.41. modeline の高さを得る</a></li>
<li><a href="#org4043fe35">14.42. [package.el] MELPA利用設定</a></li>
<li><a href="#orgfd51fa6e">14.43. orgバッファを評価</a></li>
<li><a href="#orga706f503">14.44. リージョン内のブリッツを操作する(orgmode)</a></li>
<li><a href="#orgc99664d5">14.45. " - "と" - [ ] "をサイクルさせる</a></li>
<li><a href="#orga3da97e5">14.46. 句読点を変換する</a></li>
<li><a href="#orgda007b63">14.47. <span class="todo TODO">TODO</span> ガベージコレクト情報を表示</a></li>
<li><a href="#orgfd77df9c">14.48. その他</a></li>
<li><a href="#org81ca01d1">14.49. 日付などを簡単に挿入する</a>
<ul>
<li><a href="#org74fab35b">14.49.1. キーバインド</a></li>
</ul>
</li>
<li><a href="#orgdf529698">14.50. XHTMLを利用したガントチャート生成&#xa0;&#xa0;&#xa0;<span class="tag"><span class="obsolete">obsolete</span></span></a></li>
<li><a href="#org481e7f96">14.51. Auto-install をセットアップする&#xa0;&#xa0;&#xa0;<span class="tag"><span class="obsolete">obsolete</span></span></a></li>
<li><a href="#org6183f766">14.52. org-buffer を dokuwiki 形式に変換し，kill-ring に格納&#xa0;&#xa0;&#xa0;<span class="tag"><span class="obsolete">obsolete</span></span></a></li>
<li><a href="#org5e548445">14.53. ミニバッファに日時を表示&#xa0;&#xa0;&#xa0;<span class="tag"><span class="obsolete">obsolete</span></span></a></li>
<li><a href="#org1a1d73ca">14.54. UUID をファイル名にして所定のディレクトリにコピー／移動</a></li>
<li><a href="#orgbdeca93a">14.55. byte-compile の警告を抑制する</a></li>
<li><a href="#org8065c996">14.56. 開いているファイルをすべて閉じる</a></li>
<li><a href="#org32ff042a">14.57. [window-resizer.el] 分割したウィンドウサイズを変更する</a></li>
<li><a href="#org54f46ec1">14.58. [idle-requie]</a></li>
<li><a href="#org22e29aa4">14.59. [pdf-preview]</a></li>
<li><a href="#orge6a31c57">14.60. [EasyPG]</a></li>
<li><a href="#org1495619c">14.61. [eblook]</a></li>
<li><a href="#org13d9d76f">14.62. [iBuffer]</a></li>
<li><a href="#orgafde656e">14.63. キーバインド</a></li>
</ul>
</li>
<li><a href="#org362fb2dc">15. おわりに</a></li>
</ul>
</div>
</div>

<div id="outline-container-orgda9120c8" class="outline-2">
<h2 id="orgda9120c8"><span class="section-number-2">1.</span> はじめに</h2>
<div class="outline-text-2" id="text-orgda9120c8">
<ul class="org-ul">
<li><a href="https://github.com/takaxp/emacs.d/blob/master/init.org">init.org</a> から <a href="https://github.com/takaxp/emacs.d/blob/master/init.el">init.el</a>，<a href="https://takaxp.github.io/init.html">init.html</a>，<a href="https://github.com/takaxp/emacs.d/raw/master/init.pdf">init.pdf</a>，<a href="https://github.com/takaxp/emacs.d/raw/master/init.odt">init.odt</a> を生成しています．</li>
<li>一部の関数定義を <a href="https://github.com/takaxp/emacs.d/blob/master/utility.el">utility.el</a> に分離しています．</li>
<li>Org Modeに関する設定は， <a href="https://github.com/takaxp/emacs.d/blob/master/init-org.el">init-org.el</a> に分離しています．</li>
<li><a href="https://github.com/takaxp/postpone">postpone.el</a> で遅延読み込みするパッケージを，<a href="https://github.com/takaxp/emacs.d/blob/master/late-init.el">late-init.el</a> に分離しています．</li>
<li><a href="https://github.com/takaxp/emacs.d/blob/master/init.el">init.el</a> 本体は，<a href="https://github.com/takaxp/emacs.d/">GitHub</a> に公開しています．</li>
<li>コピペだけで動かなかった場合は，気軽に <a href="https://twitter.com/takaxp">@takaxp</a> までご意見をどうぞ．</li>
<li><code>notinuse</code> タグのある設定は，あくまで個人的に不使用になったものです．</li>
</ul>
</div>
</div>

<div id="outline-container-org2a411a2e" class="outline-2">
<h2 id="org2a411a2e"><span class="section-number-2">2.</span> 起動設定</h2>
<div class="outline-text-2" id="text-org2a411a2e">
<p>
基本的な設定群です．一部の関数は記述しておかないと動かない可能性があります．
</p>

<p>
普通は <code>init.el</code> に様々な設定をEmacsに読ませますが，私は諸事情から次のようにブートシーケンスを制御しています．
</p>

<ol class="org-ol">
<li><code>.emacs</code> の読み込み</li>
<li><code>init-env.el</code> の読み込み</li>
<li><code>init.el</code> の読み込み</li>
<li><code>init-async.el</code> の読み込み</li>
<li><code>late-init.el</code> の読み込み</li>
</ol>

<p>
<code>.emacs</code> は，基本的に <code>init-env.el</code> を読み込むだけです．ただ，ちょっとしたコードを試したい時は， <code>.emacs</code> に書いてしまいます．気に入ったら， <code>init.el</code> に移します．
</p>

<p>
Org Mode の設定がかなり肥大化したため， <code>init-org.el</code> として分離して，遅延読み込みの対象にしています．設定ファイルの分離は， <code>.el</code> ファイルを <code>tangle</code> する時に自動的に実行されるように設定しています． <code>postpone.el</code> で遅延読み込みさせる設定を， <code>late-init.el</code> に分離しています．
</p>

<p>
<code>init-env.el</code> には，パスの設定，起動時間計測のためのフラグ群，パッケージ管理用の補助関数を設定しています．そして， <code>init-env.el</code> の最後に <code>init.el</code> を <code>require</code> しています．
</p>

<p>
<code>init-async.el</code> は，起動時に非同期で実行する関数を格納していますが，バイトコンパイルすると動作が怪しいので， <code>init.el</code> に格納せず分離しています． <code>async.el</code> 依存です．
</p>

<p>
これ以外に，バッチモードでバイトコンパイルするための <code>init-eval.el</code> も使います．このファイルには，バイトコンパイル時だけ必要なパッケージを列挙しています．
</p>

<ul class="org-ul">
<li><a href="https://github.com/takaxp/emacs.d/blob/master/.emacs">emacs.d/.emacs at master · takaxp/emacs.d</a></li>
<li><a href="https://github.com/takaxp/emacs.d/blob/master/elget-config.el">emacs.d/elget-config.el at master · takaxp/emacs.d</a></li>
<li><a href="https://github.com/takaxp/emacs.d/blob/master/init-env.el">emacs.d/init-env.el at master · takaxp/emacs.d</a></li>
<li><a href="https://github.com/takaxp/emacs.d/blob/master/init.el">emacs.d/init.el at master · takaxp/emacs.d</a></li>
<li><a href="https://github.com/takaxp/emacs.d/blob/master/late-init.el">emacs.d/late-init.el at master · takaxp/emacs.d</a></li>
<li><a href="https://github.com/takaxp/emacs.d/blob/master/init-async.el">emacs.d/init-async.el at master · takaxp/emacs.d</a></li>
<li><a href="https://github.com/takaxp/emacs.d/blob/master/init-eval.el">emacs.d/init-eval.el at master · takaxp/emacs.d</a></li>
<li><a href="https://github.com/takaxp/emacs.d/blob/master/init-ad.el">emacs.d/init-ad.el at master · takaxp/emacs.d</a></li>
</ul>
</div>

<div id="outline-container-orgdb94bf6d" class="outline-3">
<h3 id="orgdb94bf6d"><span class="section-number-3">2.1.</span> Spacemacs</h3>
<div class="outline-text-3" id="text-orgdb94bf6d">
<ul class="org-ul">
<li><a href="https://www.spacemacs.org/">Spacemacs: Emacs advanced Kit focused on Evil</a></li>
</ul>

<p>
たまに使いたくなるので，起動時に読み込む <code>init.el</code> を変えるだけで Spacemacs を読み込めるようにしています．
</p>

<p>
（Setup手順）
</p>
<ol class="org-ol">
<li>ln -s ~/Dropbox/emacs.d/config/.spacemacs ~/</li>
<li>git clone <a href="https://github.com/syl20bnr/spacemacs">https://github.com/syl20bnr/spacemacs</a> ~/.spacemacs.d</li>
</ol>
<p>
Then load the following at startup
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">(load (concat (setq user-emacs-directory "~/.spacemacs.d/") "init.el"))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org2db575a1" class="outline-3">
<h3 id="org2db575a1"><span class="section-number-3">2.2.</span> init.el のヘッダ</h3>
<div class="outline-text-3" id="text-org2db575a1">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">init.el --- My init.el -*- lexical-binding: t -*-</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">Configurations for Emacs</span>
<span style="color: #b22222;">;;                                         </span><span style="color: #b22222;">Takaaki ISHIKAWA  <a href="mailto:takaxp%40ieee.org">&lt;takaxp@ieee.org&gt;</a></span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">see also https://takaxp.github.io/init.html</span>
(<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">init-autoloads</span> nil t)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">utility.el --- My utility.el -*- lexical-binding: t -*-</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">"my-" and "ad:" functions associated with my '</span><span style="color: #008b8b;">init.el</span><span style="color: #b22222;">'</span>
(<span style="color: #a020f0;">unless</span> (<span style="color: #a020f0;">featurep</span> '<span style="color: #008b8b;">postpone</span>)
  (call-interactively 'postpone-pre))
</pre>
</div>
</div>
</div>

<div id="outline-container-org43b7d78e" class="outline-3">
<h3 id="org43b7d78e"><span class="section-number-3">2.3.</span> [early-init.el] early-init.el を使う</h3>
<div class="outline-text-3" id="text-org43b7d78e">
<p>
<code>early-init.el</code> の読み込み時には， <code>(display-graphic-p)</code> と <code>window-system</code> が共に <code>nil</code> に設定されるので要注意です．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">(message "--- Window system (ns mac) %s, display-graphic-p %s, File %s" window-system (display-graphic-p) early-init-file)</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">References:</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">https://raw.githubusercontent.com/hlissner/doom-emacs/develop/early-init.el</span>
(<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">my-early-start</span> (current-time))
(<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">my-early-init</span>
  (format <span style="color: #8b2252;">"%searly-init.el"</span> (expand-file-name user-emacs-directory)))

(message <span style="color: #8b2252;">"Loading %s..."</span> my-early-init)

<span style="color: #b22222;">;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">(unless (getenv "LIBRARY_PATH")</span>
<span style="color: #b22222;">;;   </span><span style="color: #b22222;">(setenv "LIBRARY_PATH"</span>
<span style="color: #b22222;">;;           </span><span style="color: #b22222;">(string-join</span>
<span style="color: #b22222;">;;            </span><span style="color: #b22222;">'("/opt/homebrew/opt/gcc/lib/gcc/12"</span>
<span style="color: #b22222;">;;              </span><span style="color: #b22222;">"/opt/homebrew/opt/libgccjit/lib/gcc/12"</span>
<span style="color: #b22222;">;;              </span><span style="color: #b22222;">"/opt/homebrew/opt/gcc/lib/gcc/12/gcc/aarch64-apple-darwin22/12")</span>
<span style="color: #b22222;">;;            </span><span style="color: #b22222;">":")))</span>

(<span style="color: #a020f0;">setq</span> package-enable-at-startup nil
      frame-inhibit-implied-resize t)
(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"moom"</span>
  (<span style="color: #a020f0;">setq</span> frame-inhibit-implied-resize nil))

(set-scroll-bar-mode nil)
(menu-bar-mode -1)
(tab-bar-mode -1)
(tool-bar-mode -1)
</pre>
</div>
</div>
</div>

<div id="outline-container-org3c4d5a7a" class="outline-3">
<h3 id="org3c4d5a7a"><span class="section-number-3">2.4.</span> initファイルの読み込み時間計測</h3>
<div class="outline-text-3" id="text-org3c4d5a7a">
<p>
次の関数を <code>init.el</code> の最初に記載して，オプション付きで <code>after-init-hook</code> に追加します．すると，initファイルの読み込み時間を計測できます（GUIのフレーム生成を含まない）．別途設定する <code>emacs-init-time</code> の派生関数とは違い， <code>after-init-hook</code> で実行される処理の時間もわかります．ただ，ほかの処理も微妙に入るので，あくまで目安です．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">defconst</span> <span style="color: #a0522d;">my-before-load-init-time</span> (current-time))
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-load-init-time</span> ()
  <span style="color: #8b2252;">"Loading time of user init files including time for `</span><span style="color: #008b8b;">after-init-hook</span><span style="color: #8b2252;">'."</span>
  (<span style="color: #a020f0;">let</span> ((t-init-files (time-subtract after-init-time my-before-load-init-time))
        (t-after-init (time-subtract (current-time) after-init-time))
        (t-others (time-subtract my-before-load-init-time before-init-time))
        (t-early-init (time-subtract my-early-end my-early-start)))
    (message (concat
              <span style="color: #8b2252;">"  Loading init files: %4.0f [msec]\n"</span>
              <span style="color: #8b2252;">"  Loading early-init: %4.0f [msec]\n"</span>
              <span style="color: #8b2252;">"  Others(GUI etc.):   %4.0f [msec] (includes `</span><span style="color: #008b8b;">before-init-hook</span><span style="color: #8b2252;">')\n"</span>
              <span style="color: #8b2252;">"(`</span><span style="color: #008b8b;">after-init-hook</span><span style="color: #8b2252;">': %4.0f [msec])"</span>)
             (* 1000 (float-time t-init-files))
             (* 1000 (float-time t-early-init))
             (* 1000 (- (float-time t-others) (float-time t-early-init)))
             (* 1000 (float-time t-after-init)))))

(add-hook 'after-init-hook #'my-load-init-time t)

(<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">my-tick-previous-time</span> my-before-load-init-time)
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-tick-init-time</span> (msg)
  <span style="color: #8b2252;">"Tick boot sequence at loading MSG."</span>
  (<span style="color: #a020f0;">when</span> my-loading-profile-p
    (<span style="color: #a020f0;">let</span> ((ctime (current-time)))
      (message <span style="color: #8b2252;">"---- %5.2f[ms] %s"</span>
               (* 1000 (float-time
                        (time-subtract ctime my-tick-previous-time)))
               msg)
      (<span style="color: #a020f0;">setq</span> my-tick-previous-time ctime))))
</pre>
</div>

<p>
<code>after-init-hook</code> の値をチェックして， <code>my-load-init-time</code> が最後に配置されていることに留意します．以下は， <code>after-init-hook</code> の値の例です．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(session-initialize recentf-mode my-emacs-init-time my-load-init-time)
</pre>
</div>
</div>

<div id="outline-container-org715ba410" class="outline-4">
<h4 id="org715ba410"><span class="section-number-4">2.4.1.</span> Emacs 起動時の呼び出し順</h4>
<div class="outline-text-4" id="text-org715ba410">
<p>
Emacsは，以下の順番で起動します．
</p>

<ol class="org-ol">
<li>Set before-init-time = (current-time) and Set after-init-time = nil</li>
<li>Load early-init.el</li>
<li>Run before-init-hook</li>
<li>Run frame-initialize</li>
<li>Set my-before-load-init-time = (current-time) =&gt; 独自変数で計測</li>
<li>Load user's init files (.emacs, init.el, etc&#x2026;)</li>
<li>Set after-init-time = (current-time)</li>
<li>Run after-init-hook</li>
<li>Run emacs-startup-hook</li>
</ol>

<p>
<code>emacs-init-time</code> は，GUI生成と，GUI関連elの読み込み， <code>before-init-hook</code> で実行する関数の実行時間，およびearly-init.elとユーザ定義のinitファイル群の読み込み時間の合計値となる．
</p>

<p>
すでに <code>after-init-time</code> で時間計測が完了しているので，その後に続く <code>after-init-hook</code> と <code>emacs-startup-hook</code> に登録された関数の実行時間は <code>emacs-init-time</code> の値に含まれない．
</p>

<p>
より端的に言えば， <code>emacs-init-time</code> = <code>before-init-time</code> - <code>after-init-time</code> である．
</p>

<p>
一方， <code>my-before-load-init-time</code> と <code>after-init-time</code> を使って計算する算出する起動時間には，GUI生成とGUI関連elの読み込み，early-init.elの読み込み，after-init-hook と before-init-hook にある関数の実行が含まれていない．
</p>

<p>
see also <a href="https://www.gnu.org/software/emacs/manual/html_node/elisp/Startup-Summary.html">Startup Summary - GNU Emacs Lisp Reference Manual</a>
</p>
</div>
</div>
</div>

<div id="outline-container-orga09727ae" class="outline-3">
<h3 id="orga09727ae"><span class="section-number-3">2.5.</span> 起動時間の計測</h3>
<div class="outline-text-3" id="text-orga09727ae">
<p>
<code>M-x emacs-init-time</code> を実行すると，Emacsの起動にかかった時間が表示されます．個人的にはミリ秒表示が好きなので，手を加えて表示を変えます．元ネタは<a href="http://d.hatena.ne.jp/sugyan/20120120/1327037494">すぎゃーんメモ</a>からです．感謝．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-emacs-init-time</span> ()
  <span style="color: #8b2252;">"Emacs booting time in msec."</span>
  (message <span style="color: #8b2252;">"Emacs booting time: %4.0f [msec] = `</span><span style="color: #008b8b;">emacs-init-time</span><span style="color: #8b2252;">'."</span>
           (* 1000
              (float-time (time-subtract
                           after-init-time
                           before-init-time)))))

(add-hook 'after-init-hook #'my-emacs-init-time)
</pre>
</div>

<p>
ついでに， <code>%.1f</code> で出力されるいつもの <code>emacs-init-time</code> をハック．ただ最新の emacs では，デフォルトで細かい小数点以下表示に変更されているので不要です．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"time"</span>
  (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">ad:emacs-init-time</span> ()
    <span style="color: #8b2252;">"Return a string giving the duration of the Emacs initialization."</span>
    (<span style="color: #a020f0;">interactive</span>)
    (<span style="color: #a020f0;">let</span> ((str
           (format <span style="color: #8b2252;">"%.3f seconds"</span>
                   (float-time
                    (time-subtract after-init-time before-init-time)))))
      (<span style="color: #a020f0;">if</span> (called-interactively-p 'interactive)
          (message <span style="color: #8b2252;">"%s"</span> str)
        str)))

  (advice-add 'emacs-init-time <span style="color: #483d8b;">:override</span> #'ad:emacs-init-time))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb459f5a2" class="outline-3">
<h3 id="orgb459f5a2"><span class="section-number-3">2.6.</span> 実行時間の計測</h3>
<div class="outline-text-3" id="text-orgb459f5a2">
<p>
計測したい関数を <code>measure-exec-time-list</code> にリストすることで，対象とする関数の実行時間を計測して <code>*Messages*</code> バッファに書き込みます．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">measure-exec-time-list</span> nil)
(<span style="color: #a020f0;">dolist</span> (f measure-exec-time-list)
  (advice-add f <span style="color: #483d8b;">:around</span> #'ad:measure-exec-time))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">ad:measure-exec-time</span> (f <span style="color: #228b22;">&amp;rest</span> arg)
  <span style="color: #8b2252;">"If `</span><span style="color: #008b8b;">measure-exec-time-list</span><span style="color: #8b2252;">' is non-nil, measure exe time for each function."</span>
  (<span style="color: #a020f0;">if</span> measure-exec-time-list
      (<span style="color: #a020f0;">let</span> ((inhibit-message nil)
            (message-log-max 5000)
            (begin (current-time)))
        (apply f arg)
        (message
         (format <span style="color: #8b2252;">"--- %.3f[ms] %S"</span>
                 (* 1000 (float-time (time-subtract (current-time) begin)))
                 (<span style="color: #a020f0;">if</span> (byte-code-function-p f)
                     nil <span style="color: #b22222;">;; </span><span style="color: #b22222;">not includes closure</span>
                   f)))) <span style="color: #b22222;">;; </span><span style="color: #b22222;">FIXME</span>
    (apply f arg)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org4c3e9f59" class="outline-3">
<h3 id="org4c3e9f59"><span class="section-number-3">2.7.</span> GCサイズの最適化</h3>
<div class="outline-text-3" id="text-org4c3e9f59">
<p>
起動時に発生するガベージコレクトを防きます．起動後に使用しているメモリサイズを超えていれば良さ気． <code>garbage-collection-messages</code> を設定しておくと，ガベージコレクトが生じる時にメッセージが出るようになります．どの程度の時間を要したかを知りたい場合は，下記のように <code>post-gc-hook</code> に表示用関数を設定しておけばよいです．
</p>

<p>
<code>early-init.el</code> で設定すると高速起動に効果があります．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">setq</span> gc-cons-threshold (* 16 1024 1024)) <span style="color: #b22222;">;; </span><span style="color: #b22222;">[MB]</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">(setq garbage-collection-messages t)</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">(defvar my-gc-last 0.0)</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">(add-hook 'post-gc-hook</span>
<span style="color: #b22222;">;;           </span><span style="color: #b22222;">#'(lambda ()</span>
<span style="color: #b22222;">;;               </span><span style="color: #b22222;">(message "GC! &gt; %.4f[sec]" (- gc-elapsed my-gc-last))</span>
<span style="color: #b22222;">;;               </span><span style="color: #b22222;">(setq my-gc-last gc-elapsed)))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc7901a57" class="outline-3">
<h3 id="orgc7901a57"><span class="section-number-3">2.8.</span> Common Lisp を使う</h3>
<div class="outline-text-3" id="text-orgc7901a57">
<ul class="org-ul">
<li><a href="http://lisperblog.blogspot.com/2008/12/blog-post_18.html">http://lisperblog.blogspot.com/2008/12/blog-post_18.html</a></li>
</ul>

<p>
一般的には次のように記載すればOKです．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">eval-when-compile</span>
  (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">cl-lib</span> nil t))
</pre>
</div>

<p>
しかし，いくつかのパッケージは，バイトパイル時の警告を回避するために， <code>cl-lib</code> と同様に <code>eval-when-compile</code> の中に記述する必要が出てきます． <code>init.el</code> の成長に伴い，対象パッケージが増えたので，別ファイル(<a href="https://github.com/takaxp/emacs.d/blob/master/init-eval.el">init-eval.el</a>)に括り出しました．バイトコンパイルするときだけ， <code>init-eval.el</code> を読み込みます．
</p>

<p>
例えば， <code>init.el</code> のコンパイルを次のようにします．
</p>

<div class="org-src-container">
<pre class="src src-sh">/Applications/Emacs.app/Contents/MacOS/Emacs -l ~/.emacs -l ~/Dropbox/emacs.d/config/init-eval.el -batch -f batch-byte-compile-if-not-done ~/Dropbox/emacs.d/config/init.el
</pre>
</div>

<p>
これなら <code>init.el</code> に <code>eval-when-compile</code> を書くのと同じに見えますが，そうしてしまうと，バイトコンパイルしない状態の <code>init.el</code> を読み込む場合に， <code>eval-when-compile</code> の中身が起動のたびにすべて実行されてしまいます．もちろん起動が重くなります．
</p>

<p>
そもそも <code>init.org</code> を編集対象にしていて， <code>init.el</code> を手動でバイトコンパイルすることはないので，私のフローには合っています.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">eval-when-compile</span>
  (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">init-eval</span> nil t))
</pre>
</div>
</div>
</div>

<div id="outline-container-org625e4ab2" class="outline-3">
<h3 id="org625e4ab2"><span class="section-number-3">2.9.</span> メッセージ出力の抑制</h3>
<div class="outline-text-3" id="text-org625e4ab2">
<p>
メッセージバッファに "Waiting for git&#x2026;" が残るのを抑制します．ミニバッファにも表示しないので，存在を完全に消せます．非常に強力ですが，逆に，主に他の設定の読み込み順に起因して，意図しないところで別な関数が出力する（本来は出力させたい）メッセージも削除してしまう可能性があるので注意が必要です．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">my-suppress-message-p</span> t)
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">ad:suppress-message</span> (f <span style="color: #228b22;">&amp;rest</span> arg)
  (<span style="color: #a020f0;">if</span> my-suppress-message-p
      (<span style="color: #a020f0;">let</span> ((inhibit-message t)
            (message-log-max nil))
        (apply f arg))
    (apply f arg)))

<span style="color: #b22222;">;; </span><span style="color: #b22222;">Suppress printing "Waiting for git..." from version.el</span>
(advice-add 'emacs-repository-branch-git <span style="color: #483d8b;">:around</span> #'ad:suppress-message)
(advice-add 'emacs-repository-version-git <span style="color: #483d8b;">:around</span> #'ad:suppress-message)
</pre>
</div>
</div>
</div>

<div id="outline-container-org8b967ce1" class="outline-3">
<h3 id="org8b967ce1"><span class="section-number-3">2.10.</span> 警告の抑制</h3>
<div class="outline-text-3" id="text-org8b967ce1">
<p>
起動時に警告が出てうっとうしい場合に使います．起動直後に呼ばれるように， <code>.emacs</code> の上の方に書いておくとよいと思います．
</p>

<ul class="org-ul">
<li><a href="http://d.hatena.ne.jp/kitokitoki/20100425/p1">http://d.hatena.ne.jp/kitokitoki/20100425/p1</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">setq</span> byte-compile-warnings
      '(not free-vars unresolved callargs redefine obsolete noruntime
            cl-functions interactive-only make-local))
<span style="color: #b22222;">;; </span><span style="color: #b22222;">(setq byte-compile-warnings '(not obsolete))</span>
(<span style="color: #a020f0;">setq</span> ad-redefinition-action 'accept)
</pre>
</div>

<p>
特定のパッケージの deprecated メッセージを抑制します． <code>my-exclude-deprecated-packages</code> にパッケージを列挙します．以下は <code>cl</code> と <code>tls</code> の出力だけ抑制して他のパッケージの場合は表示します．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">ad:do-after-load-evaluation</span> (abs-file)
  <span style="color: #8b2252;">"Evaluate all `</span><span style="color: #008b8b;">eval-after-load</span><span style="color: #8b2252;">' forms, if any, for ABS-FILE.</span>
<span style="color: #8b2252;">ABS-FILE, a string, should be the absolute true name of a file just loaded.</span>
<span style="color: #8b2252;">This function is called directly from the C code."</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">Run the relevant eval-after-load forms.</span>
  (<span style="color: #a020f0;">dolist</span> (a-l-element after-load-alist)
    (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">and</span> (stringp (car a-l-element))
               (string-match-p (car a-l-element) abs-file))
      <span style="color: #b22222;">;; </span><span style="color: #b22222;">discard the file name regexp</span>
      (mapc #'funcall (cdr a-l-element))))
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">Complain when the user uses obsolete files.</span>
  (<span style="color: #a020f0;">when</span> (string-match-p <span style="color: #8b2252;">"/obsolete/[</span><span style="color: #8b2252;">^</span><span style="color: #8b2252;">/]*\\'"</span> abs-file)
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">Maybe we should just use display-warning?  This seems yucky...</span>
    (<span style="color: #a020f0;">let*</span> ((file (file-name-nondirectory abs-file))
           (package (intern (substring file 0
                                       (string-match <span style="color: #8b2252;">"\\.elc?\\&gt;"</span> file))
                            obarray))
           (msg (<span style="color: #a020f0;">unless</span> (memq package my-exclude-deprecated-packages)
                  (format <span style="color: #8b2252;">"Package %s is deprecated"</span> package)))
           (fun (<span style="color: #a020f0;">lambda</span> (msg) (message <span style="color: #8b2252;">"%s"</span> msg))))
      (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">or</span> (not (fboundp 'byte-compile-warning-enabled-p))
                (byte-compile-warning-enabled-p 'obsolete package))
        (<span style="color: #a020f0;">cond</span>
         ((<span style="color: #a020f0;">bound-and-true-p</span> byte-compile-current-file)
          <span style="color: #b22222;">;; </span><span style="color: #b22222;">Don't warn about obsolete files using other obsolete files.</span>
          (<span style="color: #a020f0;">unless</span> (<span style="color: #a020f0;">and</span> (stringp byte-compile-current-file)
                       (string-match-p <span style="color: #8b2252;">"/obsolete/[</span><span style="color: #8b2252;">^</span><span style="color: #8b2252;">/]*\\'"</span>
                                       (expand-file-name
                                        byte-compile-current-file
                                        byte-compile-root-dir)))
            (byte-compile-warn <span style="color: #8b2252;">"%s"</span> msg)))
         (noninteractive (funcall fun msg)) <span style="color: #b22222;">;; </span><span style="color: #b22222;">No timer will be run!</span>
         (t (run-with-idle-timer 0 nil fun msg))))))

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">Finally, run any other hook.</span>
  (run-hook-with-args 'after-load-functions abs-file))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">(setq byte-compile-warnings '(obsolete))</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">Suppress warning on cl.el loading</span>
(<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">my-exclude-deprecated-packages</span> '(cl tls))
(advice-add 'do-after-load-evaluation <span style="color: #483d8b;">:override</span> #'ad:do-after-load-evaluation)
</pre>
</div>
</div>
</div>

<div id="outline-container-org0ea7dbaf" class="outline-3">
<h3 id="org0ea7dbaf"><span class="section-number-3">2.11.</span> エラー表示の抑制</h3>
<div class="outline-text-3" id="text-org0ea7dbaf">
<p>
普段使いでは要らないので抑制します．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">setq</span> debug-on-error nil)
</pre>
</div>
</div>
</div>

<div id="outline-container-org8d718626" class="outline-3">
<h3 id="org8d718626"><span class="section-number-3">2.12.</span> バッファの保存を静かにする</h3>
<div class="outline-text-3" id="text-org8d718626">
<p>
ビルトインの <code>file.el</code> にある変数を使うと，バッファ保存時に表示されるメッセージが減り "Saving file &#x2026;" がメッセージバッファに記録されなくなります．バッファ保存時以外で，メッセージ出力を抑制したい場合は， <code>shut-up.el</code> が便利です．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">setq</span> save-silently t) <span style="color: #b22222;">;; </span><span style="color: #b22222;">No need shut-up.el for saving files.</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org660ba5e8" class="outline-3">
<h3 id="org660ba5e8"><span class="section-number-3">2.13.</span> [my-load-package-p] 設定の読み込みフラグを確認する</h3>
<div class="outline-text-3" id="text-org660ba5e8">
<p>
<code>autoload-if-found</code> のサポート関数です．
</p>

<p>
<code>my-loading-packages</code> 変数に，設定を無視するパッケージを記述しておくと， <code>autoload-if-found</code> 内でそれらを読み込まないようにします．読み込まなかったパッケージは，Messages バッファにそのことを報告します． <code>autoload-if-found</code> は本来の実装ではなく， <code>my-loading-packages</code> を参照するように手を加えています．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-load-package-p</span> (file)
  (<span style="color: #a020f0;">let</span> ((enabled t))
    (<span style="color: #a020f0;">when</span> (boundp 'my-loading-packages)
      (<span style="color: #a020f0;">dolist</span> (package my-loading-packages)
        (<span style="color: #a020f0;">let</span> ((name (car package))
              (flag (cdr package)))
          (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">and</span> (stringp name)
                     (equal file name)
                     (not flag))
            (<span style="color: #a020f0;">setq</span> enabled nil)
            (message <span style="color: #8b2252;">"--- `</span><span style="color: #008b8b;">%s</span><span style="color: #8b2252;">' was NOT loaded intentionally"</span> name)))))
    enabled))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc0921cdc" class="outline-3">
<h3 id="orgc0921cdc"><span class="section-number-3">2.14.</span> [autoload-if-found] 関数をリストで渡すautoload設定</h3>
<div class="outline-text-3" id="text-orgc0921cdc">
<p>
この <code>autoload-if-found</code> の初出は，<a href="http://www.sodan.org/~knagano/emacs/dotemacs.html">dot.emacs</a> です．
</p>

<p>
<code>autoload-if-found</code> と <code>with-eval-after-load</code> の組み合わせが基本です．最初に <code>when</code> 判定をすることで，パッケージが未インストールの状態に各種設定をスキップするので安全です．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">my-skip-check-autoload-file</span> t)
(<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">bound-and-true-p</span> my-loading-packages)
  (<span style="color: #a020f0;">setq</span> my-skip-check-autoload-file nil))

(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">autoload-if-found</span> (functions file <span style="color: #228b22;">&amp;optional</span> docstring interactive type)
  <span style="color: #8b2252;">"set autoload iff. FILE has found."</span>
  (<span style="color: #a020f0;">when</span> (boundp 'my-required-libraries)
    (add-to-list 'my-required-libraries file))
  (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">or</span> my-skip-check-autoload-file
            (<span style="color: #a020f0;">and</span> (my-load-package-p file)
                 (locate-library file)))
    (<span style="color: #a020f0;">dolist</span> (f functions)
      (autoload f file docstring interactive type))
    t))
</pre>
</div>

<p>
この <code>init.el</code> は，基本的にこの <code>autoload-if-found</code> に依存しています．遅延ロードに基づく高速化において必須の関数ですが，特にこだわらない人は <code>use-package.el</code> に依存するのをオススメします．以下， <code>autoload-if-found</code> を使った設定のテンプレートです．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found
       '(f1 f2) <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#38306;&#25968;&#12522;&#12473;&#12488;&#65294;&#35201;&#32032;&#12398;&#38306;&#25968;&#12434;&#21628;&#12406;&#26178;&#12395;&#65292;&#12497;&#12483;&#12465;&#12540;&#12472;&#12364;&#35501;&#12415;&#36796;&#12414;&#12428;&#12427;</span>
       <span style="color: #8b2252;">"package-name"</span> nil t) <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#31532;4&#24341;&#25968;&#12414;&#12391;&#25351;&#23450;&#12377;&#12427;&#12392;&#65292;M-x &#12391;&#35036;&#23436;&#23550;&#35937;&#12395;&#12394;&#12427;&#65294;</span>

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">(0) &#12496;&#12452;&#12488;&#12467;&#12531;&#12497;&#12452;&#12523;&#26178;&#12395;&#35686;&#21578;&#12364;&#12391;&#12383;&#12425;&#65292;&#23550;&#24540;&#12377;&#12427;&#12497;&#12483;&#12465;&#12540;&#12472;&#12434;&#35352;&#36617;</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#29694;&#22312;&#12399;&#65292;&#12496;&#12452;&#12488;&#12467;&#12531;&#12497;&#12452;&#12523;&#26178;&#12384;&#12369;&#65292;&#24517;&#35201;&#12394;&#12497;&#12483;&#12465;&#12540;&#12472;&#12398; require &#12434;&#20840;&#12390;&#35352;&#36617;&#12375;&#12383;</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">init-eval.el &#12434;&#35501;&#12415;&#36796;&#12416;&#26041;&#24335;&#12395;&#22793;&#26356;&#65294;&#12371;&#12371;&#12391;&#12399; eval-when-compile &#12434;&#20351;&#12431;&#12394;&#12356;&#65294;</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">(eval-when-compile</span>
  <span style="color: #b22222;">;;   </span><span style="color: #b22222;">(require 'package-name nil t))</span>

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">(1) &#12497;&#12483;&#12465;&#12540;&#12472;&#12364;&#23384;&#22312;&#12377;&#12428;&#12400;&#65292; Emacs &#36215;&#21205;&#26178;&#12395;&#35501;&#12415;&#36796;&#12416;&#35373;&#23450;&#32676;</span>
  (<span style="color: #a020f0;">push</span> '(<span style="color: #8b2252;">"\\.hoge$"</span> . package-name-mode) auto-mode-alist)
  (add-hook 'after-init-hook #'f1)
  (global-set-key (kbd <span style="color: #8b2252;">"r"</span>) 'f2)
  (autoload-if-found '(hoge1 hoge2) <span style="color: #8b2252;">"hoge"</span> nil t)

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">(2) &#36933;&#24310;&#35501;&#12415;&#36796;&#12415;&#12377;&#12427;&#35373;&#23450;&#32676;</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">autoload-if-found &#12391;&#36933;&#24310;&#12525;&#12540;&#12489;&#12377;&#12427;&#38306;&#25968;</span>
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"package-name"</span>
    (<span style="color: #a020f0;">setq</span> v1 t)
    (<span style="color: #a020f0;">setq</span> v2 nil)
    (define-key package-name-map (kbd <span style="color: #8b2252;">"q"</span>) 'f1))

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#38306;&#36899;&#12377;&#12427;&#12497;&#12483;&#12465;&#12540;&#12472;&#12398;&#36933;&#24310;&#12525;&#12540;&#12489;</span>
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"package-name2"</span>
    (<span style="color: #a020f0;">setq</span> v3 t)
    (<span style="color: #a020f0;">setq</span> v4 nil))

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#36215;&#21205;&#26178;&#12395;&#23455;&#34892;&#12379;&#12378;&#65292;&#26368;&#21021;&#12395;&#20219;&#24847;&#12398;&#30330;&#34892;&#12377;&#12427;&#12467;&#12510;&#12531;&#12489;&#12414;&#12391;&#36933;&#24310;&#12525;&#12540;&#12489;&#12373;&#12379;&#12427;</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">see https://github.com/takaxp/postpone</span>
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"postpone"</span>
    (<span style="color: #a020f0;">setq</span> v5 nil)))
</pre>
</div>

<p>
このカスタマイズされた <code>autoload-if-found</code> は引数にリストのみを受け付けます．欠点は，リスト内の全て関数に個別の <code>docstring</code> を設定できないため，ヘルプ画面で何の関数なのかの情報があまり表示されないことです．ただ， <code>require</code> でパッケージを読み込んでしまえば，本来の <code>docstring</code> の内容が正しく反映されるので，すべての情報を確認できるようになります．また， <code>interactive</code> を <code>t</code> にすれば， <code>M-x</code> で当該関数がリストアップされるようになります．したがって， <code>(docstring interactive) = (nil t)</code> をデフォルトで指定すればOKです． <code>type</code> には， <code>macro</code> や <code>keymap</code> を
指定して，関数以外の情報をオートロード対象にします．
</p>

<p>
コンパイル時に <code>Warning: the function ‘google-this’ is not known to be defined.</code> のようなメッセージが出る時には， <code>autoload-if-found</code> の <code>functions</code> に当該関数を追加すると，警告されなくなります． <code>declare-function</code> を追記せずに済みます．
</p>

<p>
<code>locate-library</code> は，高速化を求める状況では，意外と高コストです．なので，それらを評価しないためのフラグ <code>skip-file-checking</code> を追加しました．各パッケージの設定は，基本的に <code>with-eval-after-load</code> に括られていることを前提にすれば，起動が停止する自体は避けられるので，悪くない選択です．もし変なことになってしまっても， <code>skip-file-checking</code> を <code>nil</code> にすれば，従来のようにパッケージの存在を確認し，安全に起動できます．
</p>
</div>
</div>

<div id="outline-container-orga2859651" class="outline-3">
<h3 id="orga2859651"><span class="section-number-3">2.15.</span> [postpone.el] Emacs起動してから使い始めるタイミングで実行する</h3>
<div class="outline-text-3" id="text-orga2859651">
<ul class="org-ul">
<li><a href="https://github.com/takaxp/postpone">takaxp/postpone: Call functions just one time at your first action in Emacs</a></li>
</ul>

<p>
<code>helm-config</code> に紐付けていた遅延呼び出し関数および設定を，自作の <code>postpone.el</code> に紐付けました． <code>helm-config</code> に紐付けていた時は， <code>M-x</code> を初めて使う時に複数の設定が読み込まれましたが，今回の設定では，Emacs起動後の最初のアクション時に読み込まれます（一部のコマンドを除く）．これには <code>M-x</code> も含まれます．この <code>init.el</code> に記載された遅延読み込みは約660[ms]にも及びます．通常起動では約400[ms]を要している（コンソール起動の場合は，約100[ms]）ので，もし遅延読み込みしなければ，Emacsの起動が1秒を超えてしまうことになります．
</p>

<p>
起動後，即座にEmacs終了するシーンでは， <code>postpone.el</code> に紐付けた設定が活性化すると無駄になります．それを回避するために， <code>this-command</code> の値を確認して，条件に合う場合だけ <code>postpone.el</code> が読み込まれる（結果的に紐付いている全ての設定が活性化する）ようにしています．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">Copied from postpone-pre.el for speed up -- begin ;;;;;;;;;;;;;;;;;;;;;</span>
(<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">postpone-pre-init-time</span> nil
  <span style="color: #8b2252;">"A variable to store the duration of loading postponed packages."</span>)

(<span style="color: #a020f0;">defcustom</span> <span style="color: #a0522d;">postpone-pre-exclude</span> '(self-insert-command
                                  save-buffers-kill-terminal
                                  exit-minibuffer)
  <span style="color: #8b2252;">"A list of commands not to activate `</span><span style="color: #008b8b;">postpone-mode</span><span style="color: #8b2252;">'."</span>
  <span style="color: #483d8b;">:type</span> 'sexp
  <span style="color: #483d8b;">:group</span> 'postpone)

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">postpone-pre</span> ()
  (<span style="color: #a020f0;">interactive</span>)
  (<span style="color: #a020f0;">unless</span> (<span style="color: #a020f0;">or</span> my-secure-boot
              (memq this-command postpone-pre-exclude)
              postpone-pre-init-time)
    (message <span style="color: #8b2252;">"Activating postponed packages..."</span>)
    (<span style="color: #a020f0;">let</span> ((t1 (current-time)))
      (postpone-kicker 'postpone-pre)
      (<span style="color: #a020f0;">setq</span> postpone-pre-init-time (float-time
                                    (time-subtract (current-time) t1))))
    (message <span style="color: #8b2252;">"Activating postponed packages...done (%.3f seconds)"</span>
             postpone-pre-init-time)))

<span style="color: #b22222;">;; </span><span style="color: #b22222;">(if (not (locate-library "postpone"))</span>
<span style="color: #b22222;">;;     </span><span style="color: #b22222;">(error "postpone.el is NOT installed yet or cannot find it")</span>
<span style="color: #b22222;">;;   </span><span style="color: #b22222;">(autoload 'postpone-kicker "postpone" nil t)</span>
<span style="color: #b22222;">;;   </span><span style="color: #b22222;">(add-hook 'pre-command-hook #'postpone-pre))</span>
(autoload 'postpone-kicker <span style="color: #8b2252;">"postpone"</span> nil t)
(add-hook 'pre-command-hook #'postpone-pre) <span style="color: #b22222;">;; </span><span style="color: #b22222;">will be removed in postpone.el.</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">Copied from postpone-pre.el for speed up -- end ;;;;;;;;;;;;;;;;;;;;;;;</span>

(<span style="color: #a020f0;">setq</span> postpone-pre-exclude
      '(self-insert-command
        newline
        forward-char
        backward-char
        delete-char
        delete-backward-char
        save-buffer
        save-buffers-kill-terminal
        electric-newline-and-maybe-indent
        exit-minibuffer))

<span style="color: #b22222;">;; </span><span style="color: #b22222;">&#36215;&#21205;&#24460;X&#31186;&#20309;&#12418;&#12375;&#12394;&#12356;&#22580;&#21512;&#12399;&#33258;&#21205;&#12391;&#12461;&#12483;&#12463; (related to setting on org-agenda)</span>
(<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">my-pp-kicker-timer</span>
  (<span style="color: #a020f0;">unless</span> (<span style="color: #a020f0;">or</span> noninteractive my-secure-boot)
    (run-with-idle-timer (+ 5 my-default-loading-delay) nil #'postpone-pre)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org124f13e2" class="outline-3">
<h3 id="org124f13e2"><span class="section-number-3">2.16.</span> [future-time-p] 指定時刻が本日の未来の時刻かを判定</h3>
<div class="outline-text-3" id="text-org124f13e2">
<p>
今日の時刻に限定して，指定時刻が過去の時間かどうかを判定します． <code>run-at-time</code> が想定通りに動かず，起動時に <code>run-at-time</code> に登録した関数が走ってしまうので，この判定が <code>non-nil</code> の時だけタイマー登録します． <code>time</code> を <code>HH:MM</code> の書式で与えます．指定時刻と現在時刻が同じ場合は，過去とみなします．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span><span style="color: #b22222;">'</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">future-time-p</span> (time)
  <span style="color: #8b2252;">"Return non-nil if provided TIME formed of \"10:00\" is the future time."</span>
  (not (time-less-p
        (apply 'encode-time
               (<span style="color: #a020f0;">let</span> ((t1 (decode-time))
                     (t2 (parse-time-string time)))
                 (<span style="color: #a020f0;">setf</span> (nth 0 t1) 0)
                 (<span style="color: #a020f0;">setf</span> (nth 1 t1) (nth 1 t2))
                 (<span style="color: #a020f0;">setf</span> (nth 2 t1) (nth 2 t2))
                 t1))
        (current-time))))
<span style="color: #b22222;">;; </span><span style="color: #b22222;">(when (future-time-p "10:00") (run-at-time...))</span>
</pre>
</div>

<p>
以下は古い実装．指定時刻と現在時刻が同じ場合は，タイマー登録の動作確認が楽だったこともあり，未来とみなしていた．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">passed-clock-p</span> (target)
  (<span style="color: #a020f0;">let</span> ((hour nil)
        (min nil)
        (current-hour nil)
        (current-min nil))
    (<span style="color: #a020f0;">when</span> (string-match <span style="color: #8b2252;">"</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">(</span><span style="color: #8b2252;">[0-2]?[0-9]</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">)</span><span style="color: #8b2252;">:</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">(</span><span style="color: #8b2252;">[0-5][0-9]</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">)</span><span style="color: #8b2252;">"</span> target)
      (<span style="color: #a020f0;">setq</span> hour (substring target (match-beginning 1) (match-end 1)))
      (<span style="color: #a020f0;">setq</span> min (substring target (match-beginning 2) (match-end 2)))
      (<span style="color: #a020f0;">setq</span> current-hour (format-time-string <span style="color: #8b2252;">"%H"</span> (current-time)))
      (<span style="color: #a020f0;">setq</span> current-min (format-time-string <span style="color: #8b2252;">"%M"</span> (current-time)))
      (&lt; (+ (* (string-to-number hour) 60)
            (string-to-number min))
         (+ (* (string-to-number current-hour) 60)
            (string-to-number current-min))))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org30c47759" class="outline-3">
<h3 id="org30c47759"><span class="section-number-3">2.17.</span> [library-p] load-path にライブラリがあるかを判定</h3>
<div class="outline-text-3" id="text-org30c47759">
<p>
パッケージが <code>load-path</code> に存在していて使える状態にあるかを調べます．もし存在しなければ，メッセージバッファに [NOT FOUND] を刻みます．
</p>

<p>
<code>libraries</code> には複数のパッケージ名を指定でき，すべてが使える状態の場合のみ <code>t</code> が返ります．
</p>

<p>
<code>"org"</code> を渡したり， <code>'("org" "helm")</code> を渡したりできます．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">library-p</span> (libraries)
  <span style="color: #8b2252;">"Return t when every specified library can be located. "</span>
  (<span style="color: #a020f0;">let</span> ((result t))
    (mapc (<span style="color: #a020f0;">lambda</span> (library)
            (<span style="color: #a020f0;">unless</span> (locate-library library)
              (message <span style="color: #8b2252;">"--- NOT FOUND: %s"</span> library)
              (<span style="color: #a020f0;">setq</span> result nil)))
          (<span style="color: #a020f0;">if</span> (listp libraries)
              libraries
            (list libraries)))
    result))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb75ac2db" class="outline-3">
<h3 id="orgb75ac2db"><span class="section-number-3">2.18.</span> run-at-time をハックして diary-lib.el の読み込みを抑制</h3>
<div class="outline-text-3" id="text-orgb75ac2db">
<p>
<code>run-at-time</code> を使ったタイマー設定時に，時刻を文字列で指定すると， <code>diary-lib.el</code> を読み込み， <code>diary-entry-time</code> を使いますが，そのために起動時の時間を使うのはもったいないので， <code>diary-entry-time</code> だけを <code>init.el</code> に移植し， <code>run-at-time</code> をハックして <code>diary-lib.el</code> を読み込まないようにします．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">diary-entry-time</span> (s)
  <span style="color: #8b2252;">"Return time at the beginning of the string S as a military-style integer.</span>
<span style="color: #8b2252;">For example, returns 1325 for 1:25pm.</span>

<span style="color: #8b2252;">Returns `</span><span style="color: #008b8b;">diary-unknown-time</span><span style="color: #8b2252;">' (default value -9999) if no time is recognized.</span>
<span style="color: #8b2252;">The recognized forms are XXXX, X:XX, or XX:XX (military time), and XXam,</span>
<span style="color: #8b2252;">XXAM, XXpm, XXPM, XX:XXam, XX:XXAM, XX:XXpm, or XX:XXPM.  A period (.) can</span>
<span style="color: #8b2252;">be used instead of a colon (:) to separate the hour and minute parts."</span>
  (<span style="color: #a020f0;">let</span> (case-fold-search)
    (<span style="color: #a020f0;">cond</span> ((string-match                <span style="color: #b22222;">; </span><span style="color: #b22222;">military time</span>
            <span style="color: #8b2252;">"\\`[ \t\n]*</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">(</span><span style="color: #8b2252;">[0-9]?[0-9]</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">)</span><span style="color: #8b2252;">[:.]?</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">(</span><span style="color: #8b2252;">[0-9][0-9]</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">)</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">(</span><span style="color: #8b2252;">\\&gt;</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">|</span><span style="color: #8b2252;">[</span><span style="color: #8b2252;">^</span><span style="color: #8b2252;">ap]</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">)</span><span style="color: #8b2252;">"</span>
            s)
           (+ (* 100 (string-to-number (match-string 1 s)))
              (string-to-number (match-string 2 s))))
          ((string-match                <span style="color: #b22222;">; </span><span style="color: #b22222;">hour only (XXam or XXpm)</span>
            <span style="color: #8b2252;">"\\`[ \t\n]*</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">(</span><span style="color: #8b2252;">[0-9]?[0-9]</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">)</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">(</span><span style="color: #8b2252;">[ap]</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">)</span><span style="color: #8b2252;">m\\&gt;"</span> s)
           (+ (* 100 (% (string-to-number (match-string 1 s)) 12))
              (<span style="color: #a020f0;">if</span> (equal ?a (downcase (aref s (match-beginning 2))))
                  0 1200)))
          ((string-match        <span style="color: #b22222;">; </span><span style="color: #b22222;">hour and minute (XX:XXam or XX:XXpm)</span>
            <span style="color: #8b2252;">"\\`[ \t\n]*</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">(</span><span style="color: #8b2252;">[0-9]?[0-9]</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">)</span><span style="color: #8b2252;">[:.]</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">(</span><span style="color: #8b2252;">[0-9][0-9]</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">)</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">(</span><span style="color: #8b2252;">[ap]</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">)</span><span style="color: #8b2252;">m\\&gt;"</span> s)
           (+ (* 100 (% (string-to-number (match-string 1 s)) 12))
              (string-to-number (match-string 2 s))
              (<span style="color: #a020f0;">if</span> (equal ?a (downcase (aref s (match-beginning 3))))
                  0 1200)))
          (t diary-unknown-time))))

(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">run-at-time</span> (time repeat function <span style="color: #228b22;">&amp;rest</span> args)
  <span style="color: #8b2252;">"Perform an action at time TIME.</span>
<span style="color: #8b2252;">Repeat the action every REPEAT seconds, if REPEAT is non-nil.</span>
<span style="color: #8b2252;">REPEAT may be an integer or floating point number.</span>
<span style="color: #8b2252;">TIME should be one of:</span>

<span style="color: #8b2252;">- a string giving today's time like \"11:23pm\"</span>
<span style="color: #8b2252;">  (the acceptable formats are HHMM, H:MM, HH:MM, HHam, HHAM,</span>
<span style="color: #8b2252;">  HHpm, HHPM, HH:MMam, HH:MMAM, HH:MMpm, or HH:MMPM;</span>
<span style="color: #8b2252;">  a period `</span><span style="color: #008b8b;">.</span><span style="color: #8b2252;">' can be used instead of a colon `</span><span style="color: #008b8b;">:</span><span style="color: #8b2252;">' to separate</span>
<span style="color: #8b2252;">  the hour and minute parts);</span>

<span style="color: #8b2252;">- a string giving a relative time like \"90\" or \"2 hours 35 minutes\"</span>
<span style="color: #8b2252;">  (the acceptable forms are a number of seconds without units</span>
<span style="color: #8b2252;">  or some combination of values using units in `</span><span style="color: #008b8b;">timer-duration-words</span><span style="color: #8b2252;">');</span>

<span style="color: #8b2252;">- nil, meaning now;</span>

<span style="color: #8b2252;">- a number of seconds from now;</span>

<span style="color: #8b2252;">- a value from `</span><span style="color: #008b8b;">encode-time</span><span style="color: #8b2252;">';</span>

<span style="color: #8b2252;">- or t (with non-nil REPEAT) meaning the next integral multiple</span>
<span style="color: #8b2252;">  of REPEAT.  This is handy when you want the function to run at</span>
<span style="color: #8b2252;">  a certain \"round\" number.  For instance, (run-at-time t 60 ...)</span>
<span style="color: #8b2252;">  will run at 11:04:00, 11:05:00, etc.</span>

<span style="color: #8b2252;">The action is to call FUNCTION with arguments ARGS.</span>

<span style="color: #8b2252;">This function returns a timer object which you can use in</span>
<span style="color: #8b2252;">`</span><span style="color: #008b8b;">cancel-timer</span><span style="color: #8b2252;">'."</span>
  (<span style="color: #a020f0;">interactive</span> <span style="color: #8b2252;">"sRun at time: \nNRepeat interval: \naFunction: "</span>)

  (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">and</span> repeat
             (numberp repeat)
             (&lt; repeat 0))
    (<span style="color: #ff0000; font-weight: bold;">error</span> <span style="color: #8b2252;">"Invalid repetition interval"</span>))

  (<span style="color: #a020f0;">let</span> ((timer (timer-create)))
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">Special case: nil means "now" and is useful when repeating.</span>
    (<span style="color: #a020f0;">unless</span> time
      (<span style="color: #a020f0;">setq</span> time (current-time)))

    <span style="color: #b22222;">;; </span><span style="color: #b22222;">Special case: t means the next integral multiple of REPEAT.</span>
    (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">and</span> (eq time t) repeat)
      (<span style="color: #a020f0;">setq</span> time (timer-next-integral-multiple-of-time nil repeat))
      (<span style="color: #a020f0;">setf</span> (timer--integral-multiple timer) t))

    <span style="color: #b22222;">;; </span><span style="color: #b22222;">Handle numbers as relative times in seconds.</span>
    (<span style="color: #a020f0;">when</span> (numberp time)
      (<span style="color: #a020f0;">setq</span> time (timer-relative-time nil time)))

    <span style="color: #b22222;">;; </span><span style="color: #b22222;">Handle relative times like "2 hours 35 minutes".</span>
    (<span style="color: #a020f0;">when</span> (stringp time)
      (<span style="color: #a020f0;">when-let</span> ((secs (timer-duration time)))
              (<span style="color: #a020f0;">setq</span> time (timer-relative-time nil secs))))

    <span style="color: #b22222;">;; </span><span style="color: #b22222;">Handle "11:23pm" and the like.  Interpret it as meaning today</span>
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">which admittedly is rather stupid if we have passed that time</span>
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">already.  (Though only Emacs hackers hack Emacs at that time.)</span>
    (<span style="color: #a020f0;">when</span> (stringp time)
      <span style="color: #b22222;">;; </span><span style="color: #b22222;">(require 'diary-lib) ;; *Modified*</span>
      (<span style="color: #a020f0;">let</span> ((hhmm (diary-entry-time time))
                  (now (decode-time)))
              (<span style="color: #a020f0;">when</span> (&gt;= hhmm 0)
                (<span style="color: #a020f0;">setq</span> time (encode-time 0 (% hhmm 100) (/ hhmm 100)
                                  (decoded-time-day now)
                                                    (decoded-time-month now)
                                  (decoded-time-year now)
                                  (decoded-time-zone now))))))

    (timer-set-time timer time repeat)
    (timer-set-function timer function args)
    (timer-activate timer)
    timer))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdc071e4d" class="outline-3">
<h3 id="orgdc071e4d"><span class="section-number-3">2.19.</span> <span class="todo TODO">TODO</span> [gcmh.el] idle 中にGC実行</h3>
<div class="outline-text-3" id="text-orgdc071e4d">
<ul class="org-ul">
<li><a href="https://gitlab.com/koral/gcmh">https://gitlab.com/koral/gcmh</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">(eval-when-compile</span>
<span style="color: #b22222;">;;   </span><span style="color: #b22222;">(message "Loading gcmh... %s" (featurep 'gcmh))</span>
<span style="color: #b22222;">;;   </span><span style="color: #b22222;">(require 'gcmh))</span>

(<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">my-gcmh-idlegc-p</span> nil)

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">ad:garbage-collect</span> (f)
  (<span style="color: #a020f0;">unless</span> my-gcmh-idlegc-p
    (message <span style="color: #8b2252;">"[gcmh] Garbage collecting..."</span>)
    (message <span style="color: #8b2252;">"[gcmh] Garbage collecting...done (%.3fs)"</span>
             (gcmh-time (funcall f)))))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">ad:gcmh-idle-garbage-collect</span> (f)
  (<span style="color: #a020f0;">let</span> ((my-gcmh-idlegc-p t))
    (funcall f)))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-gcmh-activate</span> ()
  (cancel-timer my-gcmh-timer)
  (gcmh-mode 1))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload 'gcmh-mode <span style="color: #8b2252;">"gcmh"</span> nil t)

  (advice-add 'garbage-collect <span style="color: #483d8b;">:around</span> #'ad:garbage-collect)

  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"gcmh"</span>
    (<span style="color: #a020f0;">setq</span> gcmh-verbose nil)
    (advice-add 'gcmh-idle-garbage-collect
                <span style="color: #483d8b;">:around</span> #'ad:gcmh-idle-garbage-collect))

  (<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">my-gcmh-timer</span>
    (<span style="color: #a020f0;">unless</span> noninteractive
      (run-with-idle-timer (+ 10 my-default-loading-delay)
                           nil #'my-gcmh-activate))))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfca510d8" class="outline-3">
<h3 id="orgfca510d8"><span class="section-number-3">2.20.</span> [shut-up.el] Messages 出力を封じる（制御する）</h3>
<div class="outline-text-3" id="text-orgfca510d8">
<p>
<code>shut-up.el</code> というマクロがあり，現在はそちらを使っています．非常に強力です．
</p>

<ul class="org-ul">
<li><a href="https://github.com/cask/shut-up">cask/shut-up: Emacs, shut up would you!</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">setq</span> message-log-max 5000) <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#12513;&#12483;&#12475;&#12540;&#12472;&#12496;&#12483;&#12501;&#12449;&#12398;&#38263;&#12373;</span>
(<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">shutup-p</span> nil)
</pre>
</div>
</div>

<div id="outline-container-orgb6593164" class="outline-4">
<h4 id="orgb6593164"><span class="section-number-4">2.20.1.</span> with-suppressed-message&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></h4>
<div class="outline-text-4" id="text-orgb6593164">
<p>
以下はそれ以前のアプローチ． <code>recentf-save-list</code> を <code>find-file-hook</code> にぶら下げていますが，そのままだと <code>org-agenda</code> の初回実行時にたくさんのメッセージが出てしまうところ，このマクロを介すだけで抑制可能です． <code>message-log-max</code> で制御できるのがすごい．
</p>

<ul class="org-ul">
<li><a href="http://qiita.com/itiut@github/items/d917eafd6ab255629346">Emacs - エコーエリアや <b>Messages</b> バッファにメッセージを表示させたくない - Qiita</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">defmacro</span> <span style="color: #0000ff;">with-suppressed-message</span> (<span style="color: #228b22;">&amp;rest</span> body)
  <span style="color: #8b2252;">"Suppress new messages temporarily in the echo area and the `</span><span style="color: #008b8b;">*Messages*</span><span style="color: #8b2252;">' buffer while BODY is evaluated."</span>
  (<span style="color: #a020f0;">declare</span> (indent 0))
  (<span style="color: #a020f0;">let</span> ((message-log-max nil))
    `(<span style="color: #a020f0;">with-temp-message</span> (<span style="color: #a020f0;">or</span> (current-message) <span style="color: #8b2252;">""</span>) ,@body)))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org5a18ac68" class="outline-3">
<h3 id="org5a18ac68"><span class="section-number-3">2.21.</span> Native comp が使えるかを判定する</h3>
<div class="outline-text-3" id="text-org5a18ac68">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-native-comp-p</span> ()
  (<span style="color: #a020f0;">when</span> (fboundp 'native-comp-available-p)
    (native-comp-available-p)))
</pre>
</div>

<p>
ついでに NativeComp のオプションを指定します．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"comp"</span>
  (<span style="color: #a020f0;">setq</span> native-comp-async-query-on-exit t))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb59612b6" class="outline-3">
<h3 id="orgb59612b6"><span class="section-number-3">2.22.</span> [exec-path-from-shell.el] PATH設定をシェルから継承する&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></h3>
<div class="outline-text-3" id="text-orgb59612b6">
<ul class="org-ul">
<li><a href="https://github.com/purcell/exec-path-from-shell">purcell/exec-path-from-shell: Make Emacs use the $PATH set up by the user's shell</a></li>
</ul>

<p>
外部プログラムのサポートを得て動くパッケージは，設定の過程で「プログラムが見つからない」と怒られることがしばしばあります． <code>exec-path-from-shell</code> は，シェルに設定した <code>PATH</code> の情報を継承して <code>exec-path</code> や <code>PATH</code> を設定してくれます．私は起動時に環境を切り替えることがあるので使ってませんが，使われている方は多いようです．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">and</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">exec-path-from-shell</span> nil t)
           (memq window-system '(mac ns)))
  (exec-path-from-shell-initialize))
</pre>
</div>
</div>
</div>

<div id="outline-container-org0b7d9710" class="outline-3">
<h3 id="org0b7d9710"><span class="section-number-3">2.23.</span> [eval-after-autoload-if-found] 遅延読み込み&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></h3>
<div class="outline-text-3" id="text-org0b7d9710">
<p>
<b>現在は使っていません．非推奨です．</b>
</p>

<p>
<code>with-eval-after-load</code> とのペアでマクロ化したバージョンです．ただ，生成されるバイトコードに問題がありそうなので，最近は使っています．長らくお世話になっております．になりましたが，現在は， <code>autoload-if-found</code> と <code>with-eval-after-load</code> の組み合わせを使っています．
</p>

<p>
Twitterでぼやいていたら <a href="https://twitter.com/cvmat">@cvmat</a>さんが降臨して次のマクロを作ってくださいました．感謝感謝．
</p>

<ul class="org-ul">
<li><a href="https://gist.github.com/3513287">https://gist.github.com/3513287</a></li>
</ul>

<p>
autoload-if-found で遅延読み込みすると，eval-after-load と組み合わせるので，どうしてもインデントが増えてしまうのが欠点です．
</p>

<p>
例えば，cycle-buffer を遅延読み込みしたい場合， <code>setq</code> で変数を書き換えするために随分とインデントが進んでいます．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found
       '(cycle-buffer cycle-buffer-backward) <span style="color: #8b2252;">"cycle-buffer"</span> nil t)

  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"cycle-buffer"</span>
    (<span style="color: #a020f0;">setq</span> cycle-buffer-allow-visible t)
    (<span style="color: #a020f0;">setq</span> cycle-buffer-show-length 12)
    (<span style="color: #a020f0;">setq</span> cycle-buffer-show-format '(<span style="color: #8b2252;">" [ %s ]"</span> . <span style="color: #8b2252;">" %s"</span>))))
</pre>
</div>

<p>
これをスッキリさせるために <code>eval-after-autoload-if-found</code> を導入します．記述がシンプルになり，行数も桁数もスッキリです．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(eval-after-autoload-if-found
 '(cycle-buffer cycle-buffer-backward) <span style="color: #b22222;">;; </span><span style="color: #b22222;">autoload &#12391;&#21453;&#24540;&#12373;&#12379;&#12427;&#38306;&#25968;</span>
 <span style="color: #8b2252;">"cycle-buffer"</span> nil t nil      <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#21453;&#24540;&#12373;&#12379;&#12383;&#38306;&#25968;&#12398;&#12467;&#12540;&#12523;&#12391;&#35501;&#12416;&#12497;&#12483;&#12465;&#12540;&#12472;&#25351;&#23450;</span>
 '(<span style="color: #b22222;">;; </span><span style="color: #b22222;">&#12497;&#12483;&#12465;&#12540;&#12472;&#35501;&#12415;&#36796;&#12415;&#24460;&#12398;&#35373;&#23450;</span>
   (<span style="color: #a020f0;">setq</span> cycle-buffer-allow-visible t)
   (<span style="color: #a020f0;">setq</span> cycle-buffer-show-length 12)
   (<span style="color: #a020f0;">setq</span> cycle-buffer-show-format '(<span style="color: #8b2252;">" &lt; %s &gt;"</span> . <span style="color: #8b2252;">" %s"</span>))))
</pre>
</div>

<p>
さらに戻り値を判定して，グローバルなキーアサインもできます．存在しないパッケージの関数呼び出しを明示的に防ぐために有効です． <code>hook</code> 系の登録も同様です．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (eval-after-autoload-if-found
       '(cycle-buffer cycle-buffer-backward) <span style="color: #8b2252;">"cycle-buffer"</span> nil t nil
       '((<span style="color: #a020f0;">setq</span> cycle-buffer-allow-visible t)
         (<span style="color: #a020f0;">setq</span> cycle-buffer-show-length 12)
         (<span style="color: #a020f0;">setq</span> cycle-buffer-show-format '(<span style="color: #8b2252;">" &lt; %s &gt;"</span> . <span style="color: #8b2252;">" %s"</span>))
         <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#12497;&#12483;&#12465;&#12540;&#12472;&#12398;&#12461;&#12540;&#12450;&#12469;&#12452;&#12531;&#12399;&#12371;&#12385;&#12425;</span>
         <span style="color: #b22222;">;; </span><span style="color: #b22222;">(define-key xxx-map (kbd "q") 'hoge)</span>
         ))
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#12464;&#12525;&#12540;&#12496;&#12523;&#12399;&#12371;&#12385;&#12425;</span>
  (global-set-key (kbd <span style="color: #8b2252;">"M-]"</span>) 'cycle-buffer)
  (<span style="color: #a020f0;">when</span> (display-graphic-p)
    (global-set-key (kbd <span style="color: #8b2252;">"M-["</span>) 'cycle-buffer-backward))
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#12497;&#12483;&#12465;&#12540;&#12472;&#12395;&#32016;&#20184;&#12356;&#12383;&#12501;&#12483;&#12463;&#12399;&#12371;&#12385;&#12425;&#12408;</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">(add-hook 'xxx-hook #'hogehoge)</span>
  <span style="color: #b22222;">;;</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#12499;&#12523;&#12489;&#12452;&#12531;&#12391;&#12399;&#12394;&#12356;mode&#12398; auto-mode-alist &#35373;&#23450;&#12418;&#24517;&#35201;&#12394;&#12425;&#12371;&#12385;&#12395;&#35352;&#36848;</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">(push '("\\.hoge$" . hoge-mode) auto-mode-alist)</span>
  )
</pre>
</div>

<p>
なお，第四引数 <code>(functions file docstring interactive)</code> まで指定すれば， <code>M-x</code> の呼び出し候補に functions で指定した関数が補完表示されます．
</p>
</div>

<div id="outline-container-org42722212" class="outline-4">
<h4 id="org42722212"><span class="section-number-4">2.23.1.</span> 関数版</h4>
<div class="outline-text-4" id="text-org42722212">
<p>
関数版にリスト <code>my-loading-packages</code> を追加しました．このリストに事前に Lisp ファイル名を入れておくと，一切の設定をスキップするものです． <code>eval-after-atoload-if-found</code> を定義する前に次のような変数を設定しておきます．バイトコンパイルしていないファイルに書いておけば，パッケージのON/OFFを簡単に制御できます．
</p>

<p>
ただ問題点として，最後の引数に入れる関数がバイトコンパイル時に展開されないようで，出来上がったバイトコードが高速化に寄与しているのか不明です．簡易的な実験ではだいぶ差があるようで，最近は <code>autoload-if-found</code> ， <code>with-eval-after-load</code> ， <code>eval-when-compile</code> の組み合わせで設定を書いて，遅延ロードと高速読み込みを実現しています． <code>my-loading-packages</code> は <code>autoload-if-found</code> に組み込みました．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">setq</span> my-loading-packages <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#36861;&#21152;&#12373;&#12428;&#12390;&#12356;&#12394;&#12356;&#22580;&#21512;&#12399;&#27161;&#28310;&#12391;&#35501;&#12415;&#36796;&#12416;</span>
      '((<span style="color: #8b2252;">"web-mode"</span> . nil) <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#35501;&#12415;&#36796;&#12414;&#12394;&#12356;</span>
        (<span style="color: #8b2252;">"org"</span> . t))) <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#35501;&#12415;&#36796;&#12416;</span>
</pre>
</div>

<p>
<a href="https://gist.github.com/3513287">https://gist.github.com/3513287</a>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">https://github.com/zk-phi/setup</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">(when (require 'setup nil t)</span>
<span style="color: #b22222;">;;   </span><span style="color: #b22222;">(setup-initialize))</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">eval-after-autoload-if-found</span>
    (functions file <span style="color: #228b22;">&amp;optional</span> docstring interactive type after-body)
  <span style="color: #8b2252;">"Set up autoload and eval-after-load for FUNCTIONS iff. FILE has found."</span>
  (<span style="color: #a020f0;">let</span> ((enabled t)
        (package nil))
    (message <span style="color: #8b2252;">"--- %s"</span> file)
    (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">bound-and-true-p</span> my-loading-packages)
      (<span style="color: #a020f0;">dolist</span> (package my-loading-packages)
        (<span style="color: #a020f0;">let</span> ((name (car package))
              (flag (cdr package)))
          (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">and</span> (stringp name) (equal file name))
            (<span style="color: #a020f0;">unless</span> flag
              (<span style="color: #a020f0;">setq</span> enabled nil)
              (message <span style="color: #8b2252;">"--- A setting for `</span><span style="color: #008b8b;">%s</span><span style="color: #8b2252;">' was NOT loaded explicitly"</span>
                       name))))))
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">if disabled then return nil.</span>
    (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">and</span> enabled (locate-library file))
      (mapc (<span style="color: #a020f0;">lambda</span> (func)
              (autoload func file docstring interactive type))
            (<span style="color: #a020f0;">if</span> (listp functions)
                functions
              (list functions)))
      (<span style="color: #a020f0;">when</span> after-body
        (eval-after-load file `(<span style="color: #a020f0;">progn</span> ,@after-body)))
      t)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org1498f6ce" class="outline-4">
<h4 id="org1498f6ce"><span class="section-number-4">2.23.2.</span> マクロ版</h4>
<div class="outline-text-4" id="text-org1498f6ce">
<p>
以下はマクロ版です．引数の渡し方が関数と少し違うので要注意です．
</p>

<p>
<a href="https://gist.github.com/3499459">https://gist.github.com/3499459</a>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">defmacro</span> <span style="color: #0000ff;">eval-after-autoload-if-found</span>
    (functions file <span style="color: #228b22;">&amp;optional</span> docstring interactive type <span style="color: #228b22;">&amp;rest</span> after-body)
  <span style="color: #8b2252;">"Set up autoload and eval-after-load for FUNCTIONS iff. FILE has found."</span>
  `(<span style="color: #a020f0;">let*</span> ((functions ,functions)
          (docstring ,docstring)
          (interactive ,interactive)
          (type ,type)
          (file ,file))
     (<span style="color: #a020f0;">when</span> (locate-library file)
       (mapc (<span style="color: #a020f0;">lambda</span> (func)
               (autoload func file docstring interactive type))
             (<span style="color: #a020f0;">if</span> (listp functions)
                 functions
               (list functions)))
       ,@(<span style="color: #a020f0;">when</span> after-body
           `((eval-after-load file '(progn ,@after-body))))
       t)))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgcea06248" class="outline-3">
<h3 id="orgcea06248"><span class="section-number-3">2.24.</span> <span class="done DONE">DONE</span> [window-focus-p] フォーカス判定</h3>
<div class="outline-text-3" id="text-orgcea06248">
<p>
フォーカスが当たっているのかを判定するための関数です．
</p>

<p>
(2020-06-04) <code>frame-focus-state</code> という標準関数がありました．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"postpone"</span>
  (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">window-focus-p</span> ()
    (frame-parameter (selected-frame) 'last-focus-update)))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org8e58f563" class="outline-2">
<h2 id="org8e58f563"><span class="section-number-2">3.</span> コア設定</h2>
<div class="outline-text-2" id="text-org8e58f563">
<p>
Emacs を操作して文書編集する上で欠かせない設定です．
</p>
</div>

<div id="outline-container-org218fe598" class="outline-3">
<h3 id="org218fe598"><span class="section-number-3">3.1.</span> 言語／文字コード</h3>
<div class="outline-text-3" id="text-org218fe598">
<p>
徹底的にUTF-8に合わせます．
</p>

<p>
<code>save-buffer-coding-system</code> を設定すると， <code>buffer-file-coding-system</code> の値を無視して，指定した <code>save-buffer-coding-system</code> の値でバッファを保存する．つまり， <code>buffer-file-coding-system</code> に統一するなら設定不要．
</p>

<p>
<code>set-default-coding-systems</code> か <code>prefer-coding-system</code> を設定すると，同時に <code>file-name-coding-system=，=set-terminal-coding-system=，=set-keyboard-coding-system</code> も設定される． <code>prefer-coding-system</code> は，文字コード自動判定の最上位判定項目を設定する．
</p>

<p>
<code>set-buffer-file-coding-system</code> は，Xとのデータやりとりを設定する．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(prefer-coding-system 'utf-8-unix)
<span style="color: #b22222;">;; </span><span style="color: #b22222;">(set-language-environment "Japanese") ;; will take 20-30[ms]</span>
(set-locale-environment <span style="color: #8b2252;">"en_US.UTF-8"</span>) <span style="color: #b22222;">; </span><span style="color: #b22222;">"ja_JP.UTF-8"</span>
(set-default-coding-systems 'utf-8-unix)
(set-selection-coding-system 'utf-8-unix)
(set-buffer-file-coding-system 'utf-8-unix)
(<span style="color: #a020f0;">setq</span> locale-coding-system 'utf-8-unix)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (eq system-type 'windows-nt)
  (set-clipboard-coding-system 'utf-16le) <span style="color: #b22222;">;; </span><span style="color: #b22222;">enable copy-and-paste correctly</span>
  (<span style="color: #a020f0;">setq</span> system-time-locale <span style="color: #8b2252;">"C"</span>)) <span style="color: #b22222;">;; </span><span style="color: #b22222;">format-time-string %a, not &#26085; but Sun</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org08c6f620" class="outline-3">
<h3 id="org08c6f620"><span class="section-number-3">3.2.</span> 日本語入力</h3>
<div class="outline-text-3" id="text-org08c6f620">
<p>
NSビルド用のインラインパッチを適用している場合に使います．Lion でも使える自分用にカスタマイズした <a href="https://gist.github.com/1532344">inline-patch</a> を使っています．
</p>

<ul class="org-ul">
<li>Emacs24用には，Mavericks対応した<a href="https://gist.github.com/takaxp/9658281">パッチ</a>を使っています．</li>
<li>Emacs24.5用は<a href="https://gist.github.com/takaxp/1d91107b311b63b57529">こちら</a>．</li>
<li>Emacs25.2用は<a href="https://gist.github.com/takaxp/3314a153f6d02d82ef1833638d338ecf">こちら</a>．</li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (fboundp 'mac-add-key-passed-to-system)
  (<span style="color: #a020f0;">setq</span> default-input-method <span style="color: #8b2252;">"macOS"</span>)
  (mac-add-key-passed-to-system 'shift))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (eq system-type 'gnu/linux)
  (global-set-key (kbd <span style="color: #8b2252;">"&lt;hiragana-katakana&gt;"</span>) 'toggle-input-method)
  (<span style="color: #a020f0;">push</span> <span style="color: #8b2252;">"/usr/share/emacs/site-lisp/anthy"</span> load-path)
  (<span style="color: #a020f0;">push</span> <span style="color: #8b2252;">"/usr/share/emacs/site-lisp/emacs-mozc"</span> load-path)
  (set-language-environment <span style="color: #8b2252;">"Japanese"</span>)

  (<span style="color: #a020f0;">if</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">mozc</span> nil t)
      (<span style="color: #a020f0;">progn</span>
        (<span style="color: #a020f0;">setq</span> default-input-method <span style="color: #8b2252;">"japanese-mozc"</span>)
        (custom-set-variables
         '(mozc-candidate-style 'overlay)))

    (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">anthy</span> nil t) <span style="color: #b22222;">;; </span><span style="color: #b22222;">sudo yum install emacs-anthy-el</span>
      <span style="color: #b22222;">;; </span><span style="color: #b22222;">if get error</span>
      (load-file <span style="color: #8b2252;">"/usr/share/emacs/site-lisp/anthy/leim-list.el"</span>)
      (<span style="color: #a020f0;">setq</span> default-input-method 'japanese-anthy))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org532e1f02" class="outline-3">
<h3 id="org532e1f02"><span class="section-number-3">3.3.</span> 基本キーバインド</h3>
<div class="outline-text-3" id="text-org532e1f02">
<p>
次の機能にキーバインドを設定する．
</p>

<ul class="org-ul">
<li>Cmd+V でペースト（Mac用）</li>
<li>Cmd と Option を逆にする（Mac用）</li>
<li>削除</li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (eq system-type 'darwin)
  (<span style="color: #a020f0;">when</span> (boundp 'ns-command-modifier) (<span style="color: #a020f0;">setq</span> ns-command-modifier 'meta))
  (<span style="color: #a020f0;">when</span> (boundp 'ns-alternate-modifier) (<span style="color: #a020f0;">setq</span> ns-alternate-modifier 'super))
  (<span style="color: #a020f0;">when</span> (boundp 'ns-pop-up-frames) (<span style="color: #a020f0;">setq</span> ns-pop-up-frames nil))
  (global-set-key (kbd <span style="color: #8b2252;">"M-v"</span>) 'yank)
  (global-set-key [ns-drag-file] 'ns-find-file))
(global-set-key [delete] 'delete-char)
(global-set-key [kp-delete] 'delete-char)
</pre>
</div>
</div>
</div>

<div id="outline-container-org62c41327" class="outline-3">
<h3 id="org62c41327"><span class="section-number-3">3.4.</span> ナローイングするか</h3>
<div class="outline-text-3" id="text-org62c41327">
<p>
ナローイングを有効にします．ナローイングを知らないユーザが「データが消えた！」と勘違いしないように，デフォルトでは無効になっています．
</p>

<p>
Org Mode でナローイングを使う場合は，特に設定しなくてもOKです．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(put 'narrow-to-region 'disabled nil)
</pre>
</div>

<p>
<code>fancy-narrow</code> を使うと，通常のナローイングではバッファ上で表示しなくなる領域を目立たないように残すことができます．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">late-init.el</span>
(autoload-if-found
 '(fancy-narrow-to-region
   fancy-widen
   org-fancy-narrow-to-block
   org-fancy-narrow-to-element
   org-fancy-narrow-to-subtree)
 <span style="color: #8b2252;">"fancy-narrow"</span> nil t)
</pre>
</div>
</div>
</div>

<div id="outline-container-org162dbe4a" class="outline-3">
<h3 id="org162dbe4a"><span class="section-number-3">3.5.</span> バッファの終わりでのnewlineを禁止する</h3>
<div class="outline-text-3" id="text-org162dbe4a">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">Avoid adding a new line at the end of buffer</span>
(<span style="color: #a020f0;">setq</span> next-line-add-newlines nil)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgff941e69" class="outline-3">
<h3 id="orgff941e69"><span class="section-number-3">3.6.</span> 常に最終行に一行追加する</h3>
<div class="outline-text-3" id="text-orgff941e69">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">Limit the final word to a line break code (automatically correct)</span>
(<span style="color: #a020f0;">setq</span> require-final-newline t)
</pre>
</div>
</div>
</div>

<div id="outline-container-org7a9614cc" class="outline-3">
<h3 id="org7a9614cc"><span class="section-number-3">3.7.</span> 長い文章を右端で常に折り返す</h3>
<div class="outline-text-3" id="text-org7a9614cc">
<p>
さらに折り返しのマークを右側のfringeだけに表示させています．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">setq</span> truncate-lines nil)
(<span style="color: #a020f0;">setq</span> truncate-partial-width-windows nil)
(<span style="color: #a020f0;">setq-default</span> fringe-indicator-alist
              (append (list '(continuation . (nil right-curly-arrow)))
                      (remove (assoc 'continuation fringe-indicator-alist)
                              fringe-indicator-alist)))
<span style="color: #b22222;">;; </span><span style="color: #b22222;">fringe&#12395;&#34920;&#31034;&#12377;&#12427;&#12510;&#12540;&#12463;&#12398;&#24418;&#29366;&#12434;&#22793;&#26356;</span>
(define-fringe-bitmap 'right-curly-arrow
  [#b00000000
   #b00000000
   #b00000000
   #b00000000
   #b01111110
   #b01111110
   #b00000110
   #b00000110])
</pre>
</div>
</div>
</div>

<div id="outline-container-org8dd417a4" class="outline-3">
<h3 id="org8dd417a4"><span class="section-number-3">3.8.</span> マウスで選択した領域を自動コピー</h3>
<div class="outline-text-3" id="text-org8dd417a4">
<p>
マウスで選択すると，勝手にペーストボードにデータが流れます．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">setq</span> mouse-drag-copy-region t)
</pre>
</div>
</div>
</div>

<div id="outline-container-org1b2d3cc0" class="outline-3">
<h3 id="org1b2d3cc0"><span class="section-number-3">3.9.</span> compilation buffer でのデータ表示で自動するスクロールする</h3>
<div class="outline-text-3" id="text-org1b2d3cc0">
<p>
<code>nil</code> のままだと，出力が続いてもスクロールされないので，自動的にスクロールされるように設定．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">setq</span> compilation-scroll-output t)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbe5f52a7" class="outline-3">
<h3 id="orgbe5f52a7"><span class="section-number-3">3.10.</span> NS版でスクロール時の表示乱れを補正</h3>
<div class="outline-text-3" id="text-orgbe5f52a7">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">late-init.el</span>
(<span style="color: #a020f0;">when</span> (eq window-system 'ns)
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">NS&#29256;&#12391;&#12473;&#12463;&#12525;&#12540;&#12523;&#24460;&#12395;&#34920;&#31034;&#12364;&#28040;&#12360;&#12427;&#12398;&#12434;&#22238;&#36991;&#65288;&#12383;&#12384;&#12375;&#12385;&#12425;&#12388;&#12367;&#65289;</span>
  (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">ad:scroll</span> (_ARG)
    (redraw-display))
  (advice-add 'scroll-up <span style="color: #483d8b;">:after</span> #'ad:scroll)
  (advice-add 'scroll-down <span style="color: #483d8b;">:after</span> #'ad:scroll))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb26cd017" class="outline-3">
<h3 id="orgb26cd017"><span class="section-number-3">3.11.</span> 水平方向の自動スクロール調整</h3>
<div class="outline-text-3" id="text-orgb26cd017">
<ul class="org-ul">
<li>違和感なく水平方向にスクロールさせる．</li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">setq</span> hscroll-margin 40)
</pre>
</div>
</div>
</div>

<div id="outline-container-org68d1750d" class="outline-3">
<h3 id="org68d1750d"><span class="section-number-3">3.12.</span> C-x C-c で容易にEmacsを終了させないように質問する</h3>
<div class="outline-text-3" id="text-org68d1750d">
<p>
<code>y-or-n-p</code> もしくは <code>yes-or-no-p</code> を指定するだけです．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">setq</span> confirm-kill-emacs 'yes-or-no-p)
</pre>
</div>

<p>
以前は， <code>C-x C-c</code> を以下の関数に割り当てて，任意の質問文で入力を求めていました．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">A simple solution is (setq confirm-kill-emacs 'y-or-n-p).</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">confirm-save-buffers-kill-emacs</span> (<span style="color: #228b22;">&amp;optional</span> arg)
  <span style="color: #8b2252;">"Show yes or no when you try to kill Emacs"</span>
  (<span style="color: #a020f0;">interactive</span> <span style="color: #8b2252;">"P"</span>)
  (<span style="color: #a020f0;">cond</span> (arg (save-buffers-kill-emacs))
        (t
         (<span style="color: #a020f0;">when</span> (yes-or-no-p <span style="color: #8b2252;">"Are you sure to quit Emacs now? "</span>)
           (save-buffers-kill-emacs)))))

(global-set-key (kbd <span style="color: #8b2252;">"C-x C-c"</span>) 'confirm-save-buffers-kill-emacs)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd7b8f4e2" class="outline-3">
<h3 id="orgd7b8f4e2"><span class="section-number-3">3.13.</span> パッケージ管理</h3>
<div class="outline-text-3" id="text-orgd7b8f4e2">
<p>
<a href="https://github.com/cask/cask">Cask</a>+Palletの環境を採用しました．それまでは，特定のディレクトリに必要な elisp をダウンロードしておいたり，git から取り寄せて，それらをload-pathに設定するスクリプトを準備するなど，個人的なルールで運用してきましたが，希望の機能をCaskが提供しているので，Emacs24.4になるタイミングで移行しました．
</p>

<p>
ただし，頒布元が危ういようなファイルはやはり個人で管理しておきたいので，Caskで管理する対象は，MEPLA経由で入手可能なメンテナンスが行き届いたパッケージに限定しています．また，普通の使い方（casl.elを読み込んで初期化）をしていると，起動時に少し時間を要するので，所定のディレクトリにCaskで取り寄せたすべてのファイルをコピーして，そのディレクトリだけをload-pathで指定するという使い方もしています．今のところ大きな問題は生じていません．
</p>
</div>

<div id="outline-container-orgf6f05dc9" class="outline-4">
<h4 id="orgf6f05dc9"><span class="section-number-4">3.13.1.</span> [cask-mode.el] モード設定</h4>
<div class="outline-text-4" id="text-orgf6f05dc9">
<ul class="org-ul">
<li><a href="https://github.com/Wilfred/cask-mode">Wilfred/cask-mode: Major mode for editing Cask files</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">late-init.el</span>
(<span style="color: #a020f0;">when</span> (autoload-if-found '(cask-mode) <span style="color: #8b2252;">"cask-mode"</span> nil t)
  (<span style="color: #a020f0;">push</span> '(<span style="color: #8b2252;">"/Cask\\'"</span> . cask-mode) auto-mode-alist))
</pre>
</div>
</div>
</div>

<div id="outline-container-org02669d67" class="outline-4">
<h4 id="org02669d67"><span class="section-number-4">3.13.2.</span> Cask のセットアップ</h4>
<div class="outline-text-4" id="text-org02669d67">
<p>
以下は自分用のメモです．
</p>

<ol class="org-ol">
<li>curl -fsSkL <a href="https://raw.github.com/cask/cask/master/go">https://raw.github.com/cask/cask/master/go</a> | python</li>
<li>~/.cask/bin に PATH を通す (see .zshenv, export PATH="${HOME}/.cask/bin:{$PATH}")</li>
<li>cask upgrade</li>
<li>cd ~/.emacs.d</li>
<li>cask init            ;; ~/.emacs.d/Cask が存在しない場合だけ実行</li>
<li>cask install</li>
</ol>
</div>
</div>

<div id="outline-container-orgec66ea31" class="outline-4">
<h4 id="orgec66ea31"><span class="section-number-4">3.13.3.</span> load-path を一箇所にして起動を高速化</h4>
<div class="outline-text-4" id="text-orgec66ea31">
<p>
Caskを使うと，個々のパッケージが独立にload-pathに設定されます．これにより依存関係がスッキリするわけですが，数が増えると起動時間が遅くなります．重いです．自分の例では，800[ms]のオーバーヘッドでした．これを避けるには，load-pathを一箇所に集約することが効きます．オーバーヘッドは約100[ms]まで削減できました．場合によっては依存関係に問題が生じる可能性がありますが，今のところは問題になっていません．
</p>

<ol class="org-ol">
<li><code>~/.emacs.d/.cask/package/&lt;emacs-version&gt;</code> なるフォルダを作る</li>
<li><code>~/.emacs.d/.cask/24.4.1/elpa/*/*</code> と <code>~/.emacs.d/.cask/24.4.1/elpa/*/lisp/*</code> をすべて上記フォルダにコピー</li>
<li><code>~/.emacs</code> で， <code>~/.emacs.d/.cask/package/&lt;emacs-version&gt;</code> を load-path に設定し，Caskは読み込まない</li>
</ol>

<p>
<code>M-x lis-packges</code> を使って新しいパッケージをインストールする時だけ，以下のフラグを nil に書き換えてEmacsを起動します． <code>load-path-setter</code> は独自関数です（普通に <code>add-to-list</code> で追加するのと同じです）
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">defconst</span> <span style="color: #a0522d;">cask-package-dir</span>
  (format <span style="color: #8b2252;">"~/.emacs.d/.cask/package/%s"</span> emacs-version))
(<span style="color: #a020f0;">if</span> t
    (load-path-setter `(,cask-package-dir) 'load-path)
  (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">or</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">cask</span> <span style="color: #8b2252;">"~/.cask/cask.el"</span> t)
            (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">cask</span> <span style="color: #8b2252;">"/usr/local/opt/cask/cask.el"</span> t)) <span style="color: #b22222;">;; </span><span style="color: #b22222;">Homebrew</span>
    (<span style="color: #a020f0;">when</span> (fboundp 'cask-initialize) (cask-initialize))) <span style="color: #b22222;">;; </span><span style="color: #b22222;">800[ms]</span>
  (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">pallet</span> nil t)
    (<span style="color: #a020f0;">when</span> (fboundp 'pallet-mode) (pallet-mode t))))
</pre>
</div>

<p>
Cask で新しいパッケージを導入したり，既存のパッケージを更新したら，その都度，package ディレクトリにコピーします．手動でやると面倒なので，次のようなスクリプトで対処します．アルファリリースなどに対応するときなど，少し調整が必要です．
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">!/bin/</span><span style="color: #a020f0;">sh</span>

<span style="color: #a0522d;">LOADPATH</span>=$<span style="color: #a0522d;">HOME</span>/.emacs.d/lisp
<span style="color: #a0522d;">SOURCEPATH</span>=$<span style="color: #a0522d;">HOME</span>/Dropbox/emacs.d
<span style="color: #a0522d;">EVALWCOMPILE</span>=<span style="color: #8b2252;">"$SOURCEPATH/config/init-eval.el"</span>

<span style="color: #a020f0;">while </span><span style="color: #483d8b;">getopts</span> t:hd opt
<span style="color: #a020f0;">do</span>
<span style="color: #a020f0;">case</span> ${<span style="color: #a0522d;">opt</span>} <span style="color: #a020f0;">in</span>
t)
<span style="color: #a0522d;">TARGET</span>=${<span style="color: #a0522d;">OPTARG</span>};;
d)
<span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"--- Remove byte compiled files."</span>
rm -rf $<span style="color: #a0522d;">LOADPATH</span>/*.elc
rm -rf $<span style="color: #a0522d;">SOURCEPATH</span>/config/*.elc
rm -rf ${<span style="color: #a0522d;">HOME</span>}/devel/git/org-mode/lisp/*.elc
<span style="color: #a020f0;">exit</span> 1;;
h)
<span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"TARGET LIST:"</span>;
<span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"  actex"</span>;
<span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"  org-sync"</span>;
<span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"  yatex"</span>;
<span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"e.g."</span>
<span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"&gt; $0 -t anything"</span>
<span style="color: #a020f0;">exit</span> 1;;
<span style="color: #8b2252;">\?</span>)
<span style="color: #a020f0;">exit</span> 1;;
<span style="color: #a020f0;">esac</span>
<span style="color: #a020f0;">exit</span> 0
<span style="color: #a020f0;">done</span>

<span style="color: #a020f0;">if</span> [ ! -f $<span style="color: #a0522d;">HOME</span>/.zsh.local ]; <span style="color: #a020f0;">then</span>
    <span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"~/.zsh.local does NOT exist."</span>
    <span style="color: #a020f0;">exit</span> 0
<span style="color: #a020f0;">fi</span>

<span style="color: #a020f0;">if</span> [ ! -d $<span style="color: #a0522d;">HOME</span>/.emacs.d ]; <span style="color: #a020f0;">then</span>
    <span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"~/.emacs.d does NOT exist."</span>
    <span style="color: #a020f0;">exit</span> 0
<span style="color: #a020f0;">fi</span>

<span style="color: #a0522d;">EMACS</span>=<span style="font-weight: bold;">`which emacs`</span>
<span style="color: #a020f0;">if</span> [ $<span style="color: #a0522d;">HOSTTYPE</span> = <span style="color: #8b2252;">"intel-mac"</span> ]; <span style="color: #a020f0;">then</span>
    <span style="color: #a0522d;">TARGETV</span>=head <span style="color: #b22222;"># </span><span style="color: #b22222;">25.1, 25.2, 25.3, 26.1, head</span>
    <span style="color: #a0522d;">EMACS</span>=<span style="color: #8b2252;">"/Users/taka/devel/emacs/bin/$TARGETV/Emacs.app/Contents/MacOS/Emacs"</span>
    <span style="color: #a020f0;">if</span> [ $<span style="color: #a0522d;">TARGETV</span> = <span style="color: #8b2252;">"head"</span> ]; <span style="color: #a020f0;">then</span>
        <span style="color: #a0522d;">EMACS</span>=<span style="color: #8b2252;">'/Applications/Emacs.app/Contents/MacOS/Emacs'</span>
    <span style="color: #a020f0;">fi</span>
<span style="color: #a020f0;">fi</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">$EMACS -l ~/.emacs --script ~/Dropbox/config/tangle.el</span>
$<span style="color: #a0522d;">EMACS</span> -q --script ~/Dropbox/config/tangle.el

<span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"--- Starting batch-byte-compiles with GNU Emacs ($TARGETV)."</span>

<span style="color: #a0522d;">COMMAND</span>=<span style="color: #8b2252;">"$EMACS -l ~/.emacs -l $EVALWCOMPILE -batch -f batch-byte-compile-if-not-done"</span>

rm -rf $<span style="color: #a0522d;">LOADPATH</span>/*.elc
rm -rf $<span style="color: #a0522d;">LOADPATH</span>/utility-autoloads.el
rm -rf $<span style="color: #a0522d;">SOURCEPATH</span>/config/*.elc

cp -rf $<span style="color: #a0522d;">SOURCEPATH</span>/*.el $<span style="color: #a0522d;">LOADPATH</span>
cp -rf $<span style="color: #a0522d;">SOURCEPATH</span>/config/init.el $<span style="color: #a0522d;">LOADPATH</span>
cp -rf $<span style="color: #a0522d;">SOURCEPATH</span>/config/utility.el $<span style="color: #a0522d;">LOADPATH</span>

$<span style="color: #a0522d;">COMMAND</span> $<span style="color: #a0522d;">LOADPATH</span>/init.el
$<span style="color: #a0522d;">COMMAND</span> $<span style="color: #a0522d;">LOADPATH</span>/utility.el
<span style="color: #b22222;">#</span><span style="color: #b22222;">$COMMAND $SOURCEPATH/config/init.el $SOURCEPATH/config/utility.el $SOURCEPATH/*.el</span>
$<span style="color: #a0522d;">EMACS</span> -Q --batch --eval=<span style="color: #8b2252;">"(update-file-autoloads \"$LOADPATH/utility.el\" t \"$LOADPATH/utility-autoloads.el\")"</span>

<span style="color: #a020f0;">if</span> [ ! -f <span style="color: #8b2252;">"$LOADPATH/utility-autoloads.el"</span> ]; <span style="color: #a020f0;">then</span>
    <span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"--- missing $LOADPATH/utility-autoloads.el!"</span>
<span style="color: #a020f0;">fi</span>

<span style="color: #b22222;"># </span><span style="color: #b22222;">raw</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">/Applications/Emacs.app/Contents/MacOS/Emacs -l ~/.emacs -l ~/Dropbox/emacs.d/config/init-eval.el -batch -f batch-byte-compile-if-not-done</span>

<span style="color: #b22222;"># </span><span style="color: #b22222;">mv $SOURCEPATH/config/init.elc $HOME/.emacs.d</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">mv $SOURCEPATH/config/utility.elc $HOME/.emacs.d</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">mv $SOURCEPATH/*.elc $HOME/.emacs.d</span>

<span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"--- done."</span>
</pre>
</div>

<p>
なお，Emacs 29以降では， <code>update-file-autoloads</code> が使えなくなります．代わりに，指定ディレクトリに含まれる elisp ファイルに対して処理する <code>loaddefs-generate</code> を使います．定義先は， <code>loaddefs-gen.el</code> になります．引数が微妙に異なるので注意してください．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">28&#20197;&#21069;</span>
(update-file-autoloads
 (concat (getenv <span style="color: #8b2252;">"HOME"</span>) <span style="color: #8b2252;">"/.emacs.d/lisp/late-init.el"</span>)
 t
 (concat (getenv <span style="color: #8b2252;">"HOME"</span>) <span style="color: #8b2252;">"/.emacs.d/lisp/init-autoloads.el"</span>))

<span style="color: #b22222;">;; </span><span style="color: #b22222;">29&#20197;&#38477;</span>
(loaddefs-generate
 (concat (getenv <span style="color: #8b2252;">"HOME"</span>) <span style="color: #8b2252;">"/.emacs.d/lisp/"</span>)
 (concat (getenv <span style="color: #8b2252;">"HOME"</span>) <span style="color: #8b2252;">"/.emacs.d/lisp/init-autoloads.el"</span>))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgda4ef167" class="outline-4">
<h4 id="orgda4ef167"><span class="section-number-4">3.13.4.</span> [paradox.el] パッケージ選択画面の改善</h4>
<div class="outline-text-4" id="text-orgda4ef167">
<p>
パッケージインストール用のバッファが多機能になります．スターが表示されたり，ミニバッファには様々な情報が表示されるようになります．基本の操作系は同じで，拡張部分は <code>h</code> を押すとミニバッファにディスパッチャが表示されます．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">late-init.el</span>
(<span style="color: #a020f0;">when</span> (autoload-if-found
       '(paradox-list-packages
         my-list-packages my-setup-cask
         my-reset-load-path
         advice:paradox-quit-and-close)
       <span style="color: #8b2252;">"paradox"</span> nil t)

  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"paradox"</span>
    (<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">my-default-load-path</span> nil)
    (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-list-packages</span> ()
      <span style="color: #8b2252;">"Call paradox-list-packages if available instead of list-packages."</span>
      (<span style="color: #a020f0;">interactive</span>)
      (<span style="color: #a020f0;">setq</span> my-default-load-path load-path)
      (my-setup-cask)
      (<span style="color: #a020f0;">if</span> (fboundp 'paradox-list-packages)
          (paradox-list-packages nil)
        (list-packages nil)))

    (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-reset-load-path</span> ()
      <span style="color: #8b2252;">"Revert `</span><span style="color: #008b8b;">load-path</span><span style="color: #8b2252;">' to `</span><span style="color: #008b8b;">my-default-load-path</span><span style="color: #8b2252;">'."</span>
      (shell-command-to-string <span style="color: #8b2252;">"update-cask.sh link"</span>))
    (<span style="color: #a020f0;">setq</span> load-path my-default-load-path)
    (message <span style="color: #8b2252;">"--- Reverted to the original `</span><span style="color: #008b8b;">load-path</span><span style="color: #8b2252;">'."</span>))

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">(declare-function advice:paradox-quit-and-close "init" (kill))</span>

  (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">and</span> (fboundp 'cask-load-path)
             (fboundp 'cask-initialize))
    (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-setup-cask</span> ()
      <span style="color: #8b2252;">"Override `</span><span style="color: #008b8b;">load-path</span><span style="color: #8b2252;">' to use cask."</span>
      (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">or</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">cask</span> <span style="color: #8b2252;">"/usr/local/opt/cask/cask.el"</span> t)
                (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">cask</span> <span style="color: #8b2252;">"~/.cask/cask.el"</span> t))
        (<span style="color: #a020f0;">setq</span> load-path (cask-load-path (cask-initialize))))))

  (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">advice:paradox-quit-and-close</span> (_kill)
    (my-reset-load-path))
  (advice-add 'paradox-quit-and-close <span style="color: #483d8b;">:after</span>
              #'advice:paradox-quit-and-close)

  (custom-set-variables
   '(paradox-github-token t))

  (<span style="color: #a020f0;">unless</span> noninteractive
    (<span style="color: #a020f0;">when</span> (fboundp 'paradox-enable)
      (paradox-enable))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org6c5717fc" class="outline-4">
<h4 id="org6c5717fc"><span class="section-number-4">3.13.5.</span> [el-get.el] パッケージ管理（GUI，CUI）</h4>
<div class="outline-text-4" id="text-org6c5717fc">
<p>
密かに <code>el-get</code> に移行．コマンドラインからも効率よく管理可能．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(autoload-if-found '(el-get-version
                     el-get-bundle my-elget-list my-elget-reset-links
                     el-get-cd el-get-remove el-get-update
                     el-get-install el-get-reinstall)
                   <span style="color: #8b2252;">"elget-config"</span> nil t)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org03555a6a" class="outline-3">
<h3 id="org03555a6a"><span class="section-number-3">3.14.</span> インデント</h3>
<div class="outline-text-3" id="text-org03555a6a">
<p>
オープンソース等で他の人のコードを修正する場合は，以下のような設定は良くないかもしれません．例えば差分を取ると見た目は変わらないのに，タブとスペースの違いから差分ありと判定されてしまい，意図しない編集履歴が残ることがあります．ただこの問題は，修正対象のファイルが限定されているならば， <code>M-x tabify</code> や <code>M-x untabify</code> で回避できそうです．
</p>

<p>
一方， <code>org-mode</code> のソースブロックは半角スペース統一されているため，この設定のほうが都合が良いです．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">setq-default</span> tab-width 2)
(<span style="color: #a020f0;">setq-default</span> indent-tabs-mode nil)
(<span style="color: #a020f0;">setq</span> indent-line-function 'insert-tab)
(add-hook 'emacs-lisp-mode-hook #'my-emacs-lisp-mode-conf)
(add-hook 'emacs-lisp-mode-hook #'turn-on-font-lock)

</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-emacs-lisp-mode-conf</span> ()
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">(setq indent-tabs-mode t)</span>
  (<span style="color: #a020f0;">setq</span> tab-width 8)
  (<span style="color: #a020f0;">setq</span> indent-line-function 'lisp-indent-line))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfc7cc004" class="outline-3">
<h3 id="orgfc7cc004"><span class="section-number-3">3.15.</span> ファイルリンクを辿る時に確認のメッセージを出さない</h3>
<div class="outline-text-3" id="text-orgfc7cc004">
<p>
そのまま辿ってファイルオープンします．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">setq</span> vc-follow-symlinks t)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc2257142" class="outline-3">
<h3 id="orgc2257142"><span class="section-number-3">3.16.</span> バッファが外部から編集された場合に自動で再読み込みする</h3>
<div class="outline-text-3" id="text-orgc2257142">
<p>
<code>auto-save-buffers</code> を使っていれば，バッファは常に保存された状態になるため， revert が即座に反映されます．適宜バックアップツールと組み合わせないと，バッファが自動更新されてしまうので不安かもしれません．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-org-hide-drawers-all</span> ()
  (<span style="color: #a020f0;">when</span> (eq major-mode 'org-mode)
    (org-cycle-hide-drawers 'all)))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">unless</span> noninteractive
  (global-auto-revert-mode 1)
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">revert &#12373;&#12428;&#12427;&#12398;&#12364; org &#12496;&#12483;&#12501;&#12449;&#12398;&#12392;&#12365;&#65292;&#33258;&#21205;&#30340;&#12395;&#12489;&#12525;&#12527;&#12434;&#12383;&#12383;&#12416;</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#12459;&#12540;&#12477;&#12523;&#12364; (point-max) &#12395;&#31227;&#21205;&#12375;&#12390;&#12375;&#12414;&#12358;&#22580;&#21512;&#12399;&#38750;&#25512;&#22888;</span>
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"org"</span>
    (add-hook 'after-revert-hook 'my-org-hide-drawers-all)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org4ea9e5f1" class="outline-3">
<h3 id="org4ea9e5f1"><span class="section-number-3">3.17.</span> マウススクロールをピクセル単位にする</h3>
<div class="outline-text-3" id="text-org4ea9e5f1">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">unless</span> noninteractive
  (<span style="color: #a020f0;">when</span> (fboundp 'pixel-scroll-mode)
    (pixel-scroll-mode 1))) <span style="color: #b22222;">;; </span><span style="color: #b22222;">26.1</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org6a9f8b88" class="outline-3">
<h3 id="org6a9f8b88"><span class="section-number-3">3.18.</span> デフォルトディレクトリ</h3>
<div class="outline-text-3" id="text-org6a9f8b88">
<p>
Version 27 から <code>C-x C-f</code> のデフォルトが変わったようなので， <code>~/</code> に矯正する．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (version&lt; <span style="color: #8b2252;">"27.0"</span> emacs-version)
  (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">ad:find-file-read-args</span> (f prompt mustmatch)
    (<span style="color: #a020f0;">when</span> (equal default-directory <span style="color: #8b2252;">"/"</span>)
      (<span style="color: #a020f0;">setq</span> default-directory <span style="color: #8b2252;">"~/"</span>))
    (funcall f prompt mustmatch))
  (advice-add 'find-file-read-args <span style="color: #483d8b;">:around</span> #'ad:find-file-read-args))
</pre>
</div>
</div>
</div>

<div id="outline-container-org5dd2a9d7" class="outline-3">
<h3 id="org5dd2a9d7"><span class="section-number-3">3.19.</span> <span class="todo TODO">TODO</span> git用の設定ファイル読み込み</h3>
<div class="outline-text-3" id="text-org5dd2a9d7">
<p>
Emacs を高速に起動できれば，git のコミットメッセージを Emacs で編集できます．最低限の編集ができればよいので，通常は <code>emacs -nw -Q</code> あたりを <code>core.editor</code> に設定すると思いますが，それでも最低限の設定は加えておきたいものです．
</p>

<p>
Eamcs 29からは， <code>--init-directory</code> オプションで <code>user-emacs-directory</code> を変更して，任意の場所にある <code>init.el</code> を指定して起動できます．なので，例えば，下記の設定を <code>init.el</code> に記述して <code>~/.emacs.d/min</code> 以下に配置する場合は，
</p>

<div class="org-src-container">
<pre class="src src-sh">emacs -nw --init-directory=<span style="color: #8b2252;">"$HOME/.emacs.d/min"</span>
</pre>
</div>
<p>
とすればOKです．
</p>

<p>
ただ NativeComp の場合には， <code>${HOME}/.emacs.d/min</code> 以下に新たに <code>eln-cache</code> が生成されるので注意してください．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">setq</span> make-backup-files nil)
(<span style="color: #a020f0;">setq</span> auto-save-default nil)
(<span style="color: #a020f0;">setq</span> auto-save-list-file-prefix nil)
(global-set-key (kbd <span style="color: #8b2252;">"RET"</span>) 'electric-newline-and-maybe-indent)
(global-set-key (kbd <span style="color: #8b2252;">"C-M-t"</span>) 'beginning-of-buffer)
(global-set-key (kbd <span style="color: #8b2252;">"C-M-b"</span>) 'end-of-buffer)
(global-set-key (kbd <span style="color: #8b2252;">"C-M-p"</span>) (<span style="color: #a020f0;">lambda</span> () (<span style="color: #a020f0;">interactive</span>) (other-window -1)))
(global-set-key (kbd <span style="color: #8b2252;">"C-M-n"</span>) (<span style="color: #a020f0;">lambda</span> () (<span style="color: #a020f0;">interactive</span>) (other-window 1)))
(global-set-key (kbd <span style="color: #8b2252;">"C-;"</span>) 'comment-dwim) <span style="color: #b22222;">;; </span><span style="color: #b22222;">M-; is the defualt</span>
(global-set-key (kbd <span style="color: #8b2252;">"M-="</span>) 'count-words)
(global-set-key (kbd <span style="color: #8b2252;">"M-]"</span>) 'bs-cycle-next)
(global-set-key (kbd <span style="color: #8b2252;">"M-["</span>) 'bs-cycle-previous)
(global-set-key (kbd <span style="color: #8b2252;">"C-c g"</span>) 'goto-line)
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-open-scratch</span> ()
  <span style="color: #8b2252;">"Switch the current buffer to </span><span style="color: #ff0000; font-weight: bold;">\</span><span style="color: #8b2252;">*scratch</span><span style="color: #ff0000; font-weight: bold;">\</span><span style="color: #8b2252;">* buffer."</span>
  (<span style="color: #a020f0;">interactive</span>)
  (switch-to-buffer <span style="color: #8b2252;">"*scratch*"</span>))
(global-set-key (kbd <span style="color: #8b2252;">"C-M-s"</span>) #'my-open-scratch)
</pre>
</div>

<p>
なお上記を回避するために， <code>user-emacs-directory</code> を変更せずに， <code>min/init.el</code> をロードすることもできます．だだし，非推奨です． <code>.emacs</code> で起動時に読み込む <code>init</code> 系ファイルを制御することになります．事前に <code>early-init.el</code> のどこかに <code>(defvar my-boot-mode nil)</code> を入れておいてください．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">Boot mode selection</span>
(<span style="color: #a020f0;">cond</span>
 ((eq my-boot-mode 'org) <span style="color: #b22222;">;; </span><span style="color: #b22222;">To test the latest org</span>
  (add-to-list 'load-path (expand-file-name <span style="color: #8b2252;">"~/devel/git/org-mode/lisp"</span>))
  (<span style="color: #a020f0;">setq</span> org-agenda-files '(<span style="color: #8b2252;">"~/Desktop/test/hoge.org"</span>)))
 ((eq my-boot-mode 'min) <span style="color: #b22222;">;; </span><span style="color: #b22222;">minimum</span>
  (load (concat user-emacs-directory <span style="color: #8b2252;">"min/init.el"</span>))) <span style="color: #b22222;">;; </span><span style="color: #b22222;">~/.emacs.d/min/init.el</span>
 ((eq my-boot-mode 'space) <span style="color: #b22222;">;; </span><span style="color: #b22222;">Spacemacs</span>
  (load (concat (<span style="color: #a020f0;">setq</span> user-emacs-directory <span style="color: #8b2252;">"~/.spacemacs.d/"</span>) <span style="color: #8b2252;">"init.el"</span>)))
 (t <span style="color: #b22222;">;; </span><span style="color: #b22222;">Normal mode. see also init-eval.el</span>
  (load <span style="color: #8b2252;">"~/Dropbox/emacs.d/config/init-env.el"</span> nil t)))
</pre>
</div>

<p>
CLIからは，次のように呼び出します．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">emacs -nw --eval=<span style="color: #8b2252;">"(setq my-boot-mode 'min)"</span> -l ~/.emacs
</pre>
</div>

<p>
このやり方の問題点は，バッチモードで起動するときに，別途 <code>(defvar my-boot-mode nil)</code> をしてくれる <code>.emacs</code> ではないファイルを読み込まないといけません．バッチモードでは <code>early-init.el</code> が読み込まれないためです．なので，上記のように <code>my-boot-mode</code> で切り替えるやり方は，あまりオススメしません．
</p>

<p>
私の場合は，バッチモード用に専用の <code>init-eval.el</code> というファイルを読み込んで，この問題を回避しています．
</p>
</div>
</div>

<div id="outline-container-orgb5cd55a9" class="outline-3">
<h3 id="orgb5cd55a9"><span class="section-number-3">3.20.</span> [aggressive-indent.el] 即時バッファ整形</h3>
<div class="outline-text-3" id="text-orgb5cd55a9">
<p>
特定のメジャーモードで，とにかく整形しまくります． <code>python-mode</code> では意図しないインデントになったりします． <code>web-mode</code> だと異常に重かったりします．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(aggressive-indent-mode)
                         <span style="color: #8b2252;">"aggressive-indent"</span> nil t)
  (<span style="color: #a020f0;">dolist</span> (hook
           '(<span style="color: #b22222;">;; </span><span style="color: #b22222;">python-mode-hook</span>
             <span style="color: #b22222;">;; </span><span style="color: #b22222;">nxml-mode-hook</span>
             <span style="color: #b22222;">;; </span><span style="color: #b22222;">web-mode-hook</span>
             emacs-lisp-mode-hook
             lisp-mode-hook perl-mode-hook c-mode-common-hook))

    (add-hook hook #'aggressive-indent-mode)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org723e2b73" class="outline-3">
<h3 id="org723e2b73"><span class="section-number-3">3.21.</span> [uniquify.el] 同じバッファ名が開かれた場合に区別する</h3>
<div class="outline-text-3" id="text-org723e2b73">
<p>
ビルトインの <code>uniquify</code> を使います．モードラインの表示が変わります．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">setq</span> uniquify-buffer-name-style 'post-forward-angle-brackets)
</pre>
</div>
</div>
</div>

<div id="outline-container-org982c69d7" class="outline-3">
<h3 id="org982c69d7"><span class="section-number-3">3.22.</span> [ws-butler.el] 不要なスペースを自動除去</h3>
<div class="outline-text-3" id="text-org982c69d7">
<p>
行末の不要なスペース等が残るのを回避できます．バッファ保存時の自動処理です．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(ws-butler-mode ws-butler-global-mode)
                         <span style="color: #8b2252;">"ws-butler"</span> nil t)

  (<span style="color: #a020f0;">dolist</span> (hook '(emacs-lisp-mode-hook
                  lisp-mode-hook perl-mode-hook c-mode-common-hook))
    (add-hook hook #'ws-butler-mode))

  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"ws-butler"</span>
    (custom-set-variables
     '(ws-butler-global-exempt-modes
       (append '(org-mode empty-booting-mode change-log-mode epa-mode)
                           ws-butler-global-exempt-modes)))))
</pre>
</div>
</div>
</div>

<div id="outline-container-orge014847e" class="outline-3">
<h3 id="orge014847e"><span class="section-number-3">3.23.</span> [epa.el] GPGを使う</h3>
<div class="outline-text-3" id="text-orge014847e">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-private-conf-activate</span> ()
  (cancel-timer my-private-conf-timer)
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">(require 'epa)</span>
  (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">and</span> (file-exists-p <span style="color: #8b2252;">"~/Dropbox/config/private.el.gpg"</span>)
             (eq system-type 'darwin)
             (not (<span style="color: #a020f0;">featurep</span> '<span style="color: #008b8b;">private</span>)))
    (<span style="color: #a020f0;">unless</span> (<span style="color: #a020f0;">ignore-errors</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">private</span> <span style="color: #8b2252;">"private.el.gpg"</span> t))
      (<span style="color: #ff0000; font-weight: bold;">user-error</span> <span style="color: #8b2252;">"GPG decryption error (private.el)"</span>))))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">unless</span> noninteractive
  (<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">my-private-conf-timer</span>
    (run-with-idle-timer (+ 6 my-default-loading-delay)
                         nil #'my-private-conf-activate))
  (<span style="color: #a020f0;">when</span> (version&lt; <span style="color: #8b2252;">"27.0"</span> emacs-version)
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#12511;&#12491;&#12496;&#12483;&#12501;&#12449;&#12391;&#12497;&#12473;&#12527;&#12540;&#12489;&#12434;&#20837;&#21147;&#12377;&#12427;</span>
    (<span style="color: #a020f0;">setq</span> epg-pinentry-mode 'loopback)))
</pre>
</div>

<p>
<code>w32</code> の MSYS2 で gpg を使うと，バージョン情報が "2.2.19-unknown" などとなる．その状況で <code>epg-find-configuration</code> が呼ばれると，内部で生じるエラーが報告されず nil となり， <code>epg.el</code> が以下を報告する．
</p>

<div class="org-src-container">
<pre class="src src-sh">GPG error: <span style="color: #8b2252;">"no usable configuration,"</span> OpenPGP
</pre>
</div>

<p>
しかし実際には， <code>epg-find-configuration</code> が <code>epg-check-configuration</code> のエラーを正しく処理していないのが原因であり，この関数のハックが必要となる．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"org-crypt"</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">(when (eq window-system 'w32)</span>
  <span style="color: #b22222;">;;   </span><span style="color: #b22222;">;; with export GNUPGHOME="/home/taka/.gnupg" in .bashrc</span>
  <span style="color: #b22222;">;;   </span><span style="color: #b22222;">(setq epg-gpg-home-directory ".gnupg")) ;; No need for zip downloaded Emacs</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">epg-gpg-home-directory &#12364;&#35373;&#23450;&#12373;&#12428;&#12390;&#12356;&#12427;&#12392;&#65292;(epg-make-context nil t t) &#12398;&#25147;&#12426;&#20516;&#12395;&#21453;&#26144;&#12373;&#12428;&#65292;&#32080;&#26524; epg-list-keys &#12398;&#25147;&#12426;&#20516;&#12364; nil &#12395;&#12394;&#12426;&#37749;&#12434;&#12522;&#12473;&#12488;&#12391;&#12365;&#12394;&#12367;&#12394;&#12427;&#65294;</span>

  (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-epg-check-configuration</span> (config <span style="color: #228b22;">&amp;optional</span> minimum-version)
    <span style="color: #8b2252;">"Verify that a sufficient version of GnuPG is installed."</span>
    (<span style="color: #a020f0;">let</span> ((version (alist-get 'version config)))
      (<span style="color: #a020f0;">unless</span> (stringp version)
        (<span style="color: #ff0000; font-weight: bold;">error</span> <span style="color: #8b2252;">"Undetermined version: %S"</span> version))
      <span style="color: #b22222;">;; </span><span style="color: #b22222;">hack for w32</span>
      (<span style="color: #a020f0;">when</span> (eq window-system 'w32)
        (<span style="color: #a020f0;">setq</span> version (<span style="color: #a020f0;">or</span> minimum-version
                          epg-gpg-minimum-version)))
      <span style="color: #b22222;">;;</span>
      (<span style="color: #a020f0;">unless</span> (version&lt;= (<span style="color: #a020f0;">or</span> minimum-version
                             epg-gpg-minimum-version)
                         version)
        (<span style="color: #ff0000; font-weight: bold;">error</span> <span style="color: #8b2252;">"Unsupported version: %s"</span> version))))
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">(advice-add 'epg-check-configuration</span>
  <span style="color: #b22222;">;;             </span><span style="color: #b22222;">:override #'my-epg-check-configuration)</span>
  )
</pre>
</div>
</div>
</div>
<div id="outline-container-orgedc5d7af" class="outline-3">
<h3 id="orgedc5d7af"><span class="section-number-3">3.24.</span> [epa.el] GPGファイルの保存時のメッセージを停止する</h3>
<div class="outline-text-3" id="text-orgedc5d7af">
<p>
GPGで暗号化されたファイルを編集すると，保存時に暗号化していることを知らせる情報が Messages バッファに出力されます．頻度が低ければ特に気にならないかもしれませんが，自動的にバッファを保存する設定を施していると，Messages バッファが埋め尽くされてしまうので困ります． <code>epa-file-write-region</code> をハックして黙らせます．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"epa"</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">Suppress message when saving encrypted file (hoge.org.gpg)</span>
  (advice-add 'epa-file-write-region <span style="color: #483d8b;">:around</span> #'ad:suppress-message))
</pre>
</div>
</div>
</div>

<div id="outline-container-org6ff409ba" class="outline-3">
<h3 id="org6ff409ba"><span class="section-number-3">3.25.</span> GPGファイルを一定時間後にロックする</h3>
<div class="outline-text-3" id="text-org6ff409ba">
<p>
次の例では， <code>secret.org.gpg</code> が開かれていて，1分間操作しなかったら安全のためバッファを閉じます．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###autolaod</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-lock-secret-buffer</span> (<span style="color: #228b22;">&amp;optional</span> file)
  (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">and</span> (stringp file)
             (buffer-live-p (get-buffer file)))
    (kill-buffer file)
    (<span style="color: #a020f0;">let</span> ((message-log-max nil))
      (message <span style="color: #8b2252;">"--- %s is locked."</span> file))))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(run-with-idle-timer 60 t #'my-lock-secret-buffer <span style="color: #8b2252;">"secret.org.gpg"</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-orge44eded5" class="outline-3">
<h3 id="orge44eded5"><span class="section-number-3">3.26.</span> NSビルド用設定&#xa0;&#xa0;&#xa0;<span class="tag"><span class="macOS">macOS</span></span></h3>
<div class="outline-text-3" id="text-orge44eded5">
<p>
インラインパッチの適用が前提の設定です． <code>M-SPC/S-SPC</code> で日本語IMEのON/OFFができるようになります．インラインパッチの情報はリンク先にあります．
</p>

<ul class="org-ul">
<li><a href="http://qiita.com/takaxp/items/e07bb286d80fa9dd8e05">emacs-25.2 をインラインパッチをあてて使う（OSX） - Qiita</a></li>
<li><a href="https://gist.github.com/takaxp/3314a153f6d02d82ef1833638d338ecf">An inline-patch for Emacs-25.2</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-isearch-ime-deactivate-sticky</span> ()
  (<span style="color: #a020f0;">unless</span> (region-active-p)
    (mac-ime-deactivate-sticky)))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-toggle-ime-ns</span> ()
  <span style="color: #8b2252;">"Toggle IME."</span>
  (<span style="color: #a020f0;">interactive</span>)
  (<span style="color: #a020f0;">if</span> (my-ime-active-p) (my-ime-off) (my-ime-on)))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-working-text-face-on</span> ()
  (<span style="color: #a020f0;">if</span> (<span style="color: #a020f0;">or</span> isearch-mode
          (minibufferp))
      (custom-set-faces
       '(ns-working-text-face nil))
    (custom-set-faces
     '(ns-working-text-face
       ((((background dark))
         <span style="color: #483d8b;">:background</span> <span style="color: #8b2252;">"#594d5d"</span> <span style="color: #483d8b;">:underline</span> <span style="color: #8b2252;">"LightSlateBlue"</span>)
        (t (<span style="color: #483d8b;">:background</span> <span style="color: #8b2252;">"#fff0de"</span> <span style="color: #483d8b;">:underline</span> <span style="color: #8b2252;">"gray20"</span>)))))))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-working-text-face-off</span> ()
  (<span style="color: #a020f0;">if</span> (<span style="color: #a020f0;">or</span> isearch-mode
          (minibufferp))
      (custom-set-faces
       '(ns-working-text-face nil))
    (custom-set-faces
     '(ns-working-text-face
       ((((background dark)) <span style="color: #483d8b;">:background</span> <span style="color: #8b2252;">"#484c5c"</span> <span style="color: #483d8b;">:underline</span> <span style="color: #8b2252;">"white"</span>)
        (t (<span style="color: #483d8b;">:background</span> <span style="color: #8b2252;">"#DEEDFF"</span> <span style="color: #483d8b;">:underline</span> <span style="color: #8b2252;">"DarkOrchid3"</span>)))))))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-ns-org-heading-auto-ascii</span> ()
  <span style="color: #8b2252;">"IME off, when the cursor on org headings."</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">(message "%s" (frame-focus-state (selected-frame)))</span>
  (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">and</span>
         (fboundp 'frame-focus-state)
                     (frame-focus-state)
         (eq major-mode 'org-mode)
         (boundp 'org-agenda-buffer-name)
         (<span style="color: #a020f0;">or</span> (looking-at org-heading-regexp)
             (equal (buffer-name) org-agenda-buffer-name))
         (my-ime-active-p))

    (my-ime-off)))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(global-set-key (kbd <span style="color: #8b2252;">"M-SPC"</span>) 'my-toggle-ime-ns)
(global-set-key (kbd <span style="color: #8b2252;">"S-SPC"</span>) 'my-toggle-ime-ns)
(define-key isearch-mode-map (kbd <span style="color: #8b2252;">"M-SPC"</span>) 'my-toggle-ime-ns)
(define-key isearch-mode-map (kbd <span style="color: #8b2252;">"S-SPC"</span>) 'my-toggle-ime-ns)
(<span style="color: #a020f0;">when</span> (fboundp 'mac-ime-toggle)
  (<span style="color: #a020f0;">defalias</span> '<span style="color: #0000ff;">my-toggle-ime-ns</span> 'mac-ime-toggle)
  (<span style="color: #a020f0;">defalias</span> '<span style="color: #0000ff;">my-ime-active-p</span> 'mac-ime-active-p)) <span style="color: #b22222;">;; </span><span style="color: #b22222;">FIXME</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (memq window-system '(ns nil))

  (custom-set-faces
   '(ns-marked-text-face
     ((t (<span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"black"</span>
                      <span style="color: #483d8b;">:background</span> <span style="color: #8b2252;">"light pink"</span> <span style="color: #483d8b;">:underline</span> <span style="color: #8b2252;">"OrangeRed2"</span>))))
   '(ns-unmarked-text-face
     ((t (<span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"black"</span>
                      <span style="color: #483d8b;">:background</span> <span style="color: #8b2252;">"light sky blue"</span> <span style="color: #483d8b;">:underline</span> <span style="color: #8b2252;">"royal blue"</span>)))))

  (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">and</span> (memq window-system '(ns nil))
             (fboundp 'mac-get-current-input-source))

    (<span style="color: #a020f0;">when</span> (version&lt; <span style="color: #8b2252;">"27.0"</span> emacs-version)
      <span style="color: #b22222;">;; </span><span style="color: #b22222;">"com.apple.inputmethod.Kotoeri.RomajiTyping.Japanese" for Big Sur</span>
      (custom-set-variables
       '(mac-default-input-source <span style="color: #8b2252;">"com.google.inputmethod.Japanese.base"</span>))
      (mac-input-method-mode 1)

      <span style="color: #b22222;">;; </span><span style="color: #b22222;">see also activate-mark-hook, deactivate-mark-hook</span>
      (add-hook 'isearch-mode-hook #'my-isearch-ime-deactivate-sticky)
      (add-hook 'isearch-mode-end-hook #'mac-ime-activate-sticky)))

  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"org"</span>
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#12459;&#12540;&#12477;&#12523;&#31227;&#21205;&#12391; heading &#12395;&#26469;&#12383;&#12392;&#12365;&#12399;&#21363;&#24231;&#12395;IME&#12434;OFF&#12395;&#12377;&#12427;</span>
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">(add-hook 'after-move-cursor-hook #'my-ns-org-heading-auto-ascii)</span>
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#12459;&#12540;&#12477;&#12523;&#31227;&#21205;&#12391; heading &#12395;&#30041;&#12414;&#12387;&#12383;&#26178;&#12395;IME&#12434;OFF&#12395;&#12377;&#12427;</span>
    (<span style="color: #a020f0;">unless</span> noninteractive
      (run-with-idle-timer 0.2 t #'my-ns-org-heading-auto-ascii)))

  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"hl-line"</span>
    (add-hook 'input-method-activate-hook #'my-working-text-face-on)
    (add-hook 'input-method-deactivate-hook #'my-working-text-face-off)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org53a63301" class="outline-3">
<h3 id="org53a63301"><span class="section-number-3">3.27.</span> EMPビルド用設定&#xa0;&#xa0;&#xa0;<span class="tag"><span class="macOS">macOS</span></span></h3>
<div class="outline-text-3" id="text-org53a63301">
<p>
NSビルド版で生じた日本語入力時のチラつきを避けるために，EMP版ビルドに(一時期)浮気しました．以下はその時にNSビルドの振る舞いに近づけるためにがんばった設定です．詳細な情報は，リンク先の記事にあります．
</p>

<ul class="org-ul">
<li><a href="http://qiita.com/takaxp/items/a86ee2aacb27c7c3a902">Emacs 25.1/25.2 を EMP版で快適に使う - Qiita</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (eq window-system 'mac)
  (global-set-key (kbd <span style="color: #8b2252;">"M-SPC"</span>) 'mac-win-toggle-ime)
  (global-set-key (kbd <span style="color: #8b2252;">"S-SPC"</span>) 'mac-win-toggle-ime)
  (<span style="color: #a020f0;">declare-function</span> mac-win-save-last-ime-status <span style="color: #8b2252;">"init"</span> nil)
  (<span style="color: #a020f0;">declare-function</span> ad:mac-auto-ascii-setup-input-source <span style="color: #8b2252;">"init"</span> nil)
  (<span style="color: #a020f0;">declare-function</span> mac-win-restore-ime <span style="color: #8b2252;">"init"</span> nil)
  (<span style="color: #a020f0;">declare-function</span> mac-win-restore-ime-target-commands <span style="color: #8b2252;">"init"</span> nil))

(<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">and</span> (eq window-system 'mac)
           (fboundp 'mac-select-input-source)
           (fboundp 'mac-auto-ascii-select-input-source)
           (fboundp 'mac-auto-ascii-setup-input-source)
           (fboundp 'mac-input-source)
           (fboundp 'mac-auto-ascii-mode))

  (<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">mac-win-last-ime-status</span> 'off) <span style="color: #b22222;">;; </span><span style="color: #b22222;">{'</span><span style="color: #008b8b;">off|</span><span style="color: #b22222;">'on}</span>
  (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">mac-win-save-last-ime-status</span> ()
    (<span style="color: #a020f0;">setq</span> mac-win-last-ime-status
          (<span style="color: #a020f0;">if</span> (string-match <span style="color: #8b2252;">"\\.</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">(</span><span style="color: #8b2252;">Roman</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">|</span><span style="color: #8b2252;">US</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">)</span><span style="color: #8b2252;">$"</span> (mac-input-source))
              'off 'on)))
  (mac-win-save-last-ime-status) <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#21021;&#26399;&#21270;</span>

  (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">mac-win-restore-ime</span> ()
    (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">and</span> (<span style="color: #a020f0;">bound-and-true-p</span> mac-auto-ascii-mode)
               (eq mac-win-last-ime-status 'on))
      (mac-select-input-source
       <span style="color: #8b2252;">"com.google.inputmethod.Japanese.base"</span>)))

  (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">ad:mac-auto-ascii-setup-input-source</span> (<span style="color: #228b22;">&amp;optional</span> _prompt)
    <span style="color: #8b2252;">"Extension to store IME status"</span>
    (mac-win-save-last-ime-status))
  (advice-add 'mac-auto-ascii-setup-input-source <span style="color: #483d8b;">:before</span>
              #'ad:mac-auto-ascii-setup-input-source)

  (<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">mac-win-target-commands</span>
    '(find-file save-buffer other-window delete-window split-window))

  (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">mac-win-restore-ime-target-commands</span> ()
    (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">and</span> (<span style="color: #a020f0;">bound-and-true-p</span> mac-auto-ascii-mode)
               (eq mac-win-last-ime-status 'on))
      (mapc (<span style="color: #a020f0;">lambda</span> (command)
              (<span style="color: #a020f0;">when</span> (string-match
                     (format <span style="color: #8b2252;">"^%s"</span> command) (format <span style="color: #8b2252;">"%s"</span> this-command))
                (mac-select-input-source
                 <span style="color: #8b2252;">"com.google.inputmethod.Japanese.base"</span>)))
            mac-win-target-commands)))
  (add-hook 'pre-command-hook #'mac-win-restore-ime-target-commands)

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#12496;&#12483;&#12501;&#12449;&#12522;&#12473;&#12488;&#12434;&#35211;&#12427;&#12392;&#12365;</span>
  (add-to-list 'mac-win-target-commands 'counsel-ibuffer)
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">ChangeLog&#12395;&#34892;&#12367;&#12392;&#12365;</span>
  (add-to-list 'mac-win-target-commands 'add-change-log-entry-other-window)
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#20491;&#20154;&#29992;&#12398;&#38306;&#25968;&#12434;&#20351;&#12358;&#12392;&#12365;</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">(add-to-list 'mac-win-target-commands 'my-)</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#33258;&#20998;&#12391;&#20316;&#12387;&#12383;&#12497;&#12483;&#12465;&#12540;&#12472;&#32676;&#12398;&#38306;&#25968;&#12434;&#20351;&#12358;&#12392;&#12365;</span>
  (add-to-list 'mac-win-target-commands 'change-frame)
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">org-mode &#12391;&#32224;&#12417;&#20999;&#12426;&#12434;&#35373;&#23450;&#12377;&#12427;&#12392;&#12365;&#65294;</span>
  (add-to-list 'mac-win-target-commands 'org-deadline)
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">org-mode &#12391;&#32224;&#12417;&#20999;&#12426;&#12434;&#35373;&#23450;&#12377;&#12427;&#12392;&#12365;&#65294;</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">(add-to-list 'mac-win-target-commands 'org-capture)</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">query-replace &#12391;&#22793;&#25563;&#12377;&#12427;&#12392;&#12365;</span>
  (add-to-list 'mac-win-target-commands 'query-replace)

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#12511;&#12491;&#12496;&#12483;&#12501;&#12449;&#21033;&#29992;&#24460;&#12395;IME&#12434;&#25147;&#12377;</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">M-x &#12391;&#12398;&#12467;&#12510;&#12531;&#12489;&#36984;&#25246;&#12391;IME&#12434;&#25147;&#12379;&#12427;&#65294;</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#12371;&#12428;&#31227;&#21205;&#20808;&#12391; q &#12364;&#21177;&#12363;&#12394;&#12356;&#12371;&#12392;&#12364;&#12354;&#12427;</span>
  (add-hook 'minibuffer-setup-hook #'mac-win-save-last-ime-status)
  (add-hook 'minibuffer-exit-hook #'mac-win-restore-ime)

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#12479;&#12452;&#12488;&#12523;&#12496;&#12540;&#12398;&#25391;&#12427;&#33310;&#12356;&#12434; NS&#29256;&#12395;&#21512;&#12431;&#12379;&#12427;&#65294;</span>
  (<span style="color: #a020f0;">setq</span> frame-title-format (format (<span style="color: #a020f0;">if</span> (buffer-file-name) <span style="color: #8b2252;">"%%f"</span> <span style="color: #8b2252;">"%%b"</span>)))

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#12394;&#12362;&#12486;&#12540;&#12510;&#12434;&#20999;&#12426;&#26367;&#12360;&#12383;&#12425;&#65292;face &#12398;&#35373;&#23450;&#12434;&#12522;&#12525;&#12540;&#12489;&#12375;&#12394;&#12356;&#12392;&#26399;&#24453;&#36890;&#12426;&#12395;&#12394;&#12425;&#12394;&#12356;</span>
  (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">hl-line</span> nil t)
    (custom-set-faces
     <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#22793;&#25563;&#21069;&#20837;&#21147;&#26178;&#12398;&#25991;&#23383;&#21015;&#29992; face</span>
     `(mac-ts-converted-text
       ((((background dark)) <span style="color: #483d8b;">:underline</span> <span style="color: #8b2252;">"orange"</span>
         <span style="color: #483d8b;">:background</span> ,(face-attribute 'hl-line <span style="color: #483d8b;">:background</span>))
        (t (<span style="color: #483d8b;">:underline</span> <span style="color: #8b2252;">"orange"</span>
                       <span style="color: #483d8b;">:background</span>
                       ,(face-attribute 'hl-line <span style="color: #483d8b;">:background</span>)))))
     <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#22793;&#25563;&#23550;&#35937;&#12398;&#25991;&#23383;&#21015;&#29992; face</span>
     `(mac-ts-selected-converted-text
       ((((background dark)) <span style="color: #483d8b;">:underline</span> <span style="color: #8b2252;">"orange"</span>
         <span style="color: #483d8b;">:background</span> ,(face-attribute 'hl-line <span style="color: #483d8b;">:background</span>))
        (t (<span style="color: #483d8b;">:underline</span> <span style="color: #8b2252;">"orange"</span>
                       <span style="color: #483d8b;">:background</span>
                       ,(face-attribute 'hl-line <span style="color: #483d8b;">:background</span>)))))))

  (<span style="color: #a020f0;">when</span> (fboundp 'mac-input-source)
    (run-with-idle-timer 3 t 'my-mac-keyboard-input-source))


  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#12354;&#12414;&#12426;&#12424;&#12356;&#12450;&#12503;&#12525;&#12540;&#12481;&#12391;&#12399;&#28961;&#12356;&#27671;&#12364;&#12377;&#12427;&#12369;&#12393;&#65292;org-heading &#19978;&#12392;agenda&#12391;&#12399;</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">1&#31186;&#12450;&#12452;&#12489;&#12523;&#12377;&#12427;&#12392;&#65292;&#33258;&#21205;&#30340;&#12395; IME &#12434; OFF &#12395;&#12377;&#12427;</span>
  (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-mac-win-org-heading-auto-ascii</span> ()
    (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">and</span> (eq major-mode 'org-mode)
               (<span style="color: #a020f0;">or</span> (looking-at org-heading-regexp)
                   (equal (buffer-name) org-agenda-buffer-name)))
      (<span style="color: #a020f0;">setq</span> mac-win-last-ime-status 'off)
      (mac-auto-ascii-select-input-source)))
  (<span style="color: #a020f0;">when</span> (fboundp 'mac-auto-ascii-select-input-source)
    (run-with-idle-timer 1 t 'my-mac-win-org-heading-auto-ascii))

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">EMP&#29256;Emacs&#12398;&#37326;&#33391;&#12499;&#12523;&#12489;&#29992;&#29420;&#33258;&#35373;&#23450;&#32676;</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">IME toggle&#12434; Emacs&#20869;&#12391;&#26377;&#21177;&#12395;&#12377;&#12427;</span>
  (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">mac-win-toggle-ime</span> ()
    (<span style="color: #a020f0;">interactive</span>)
    (<span style="color: #a020f0;">when</span> (fboundp 'mac-input-source)
      (mac-select-input-source
       (concat <span style="color: #8b2252;">"com.google.inputmethod.Japanese"</span>
               (<span style="color: #a020f0;">if</span> (string-match <span style="color: #8b2252;">"\\.base$"</span> (mac-input-source))
                   <span style="color: #8b2252;">".Roman"</span> <span style="color: #8b2252;">".base"</span>)))))

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">isearch &#20013;&#12395;IME&#12434;&#20999;&#12426;&#26367;&#12360;&#12427;&#12392;&#65292;[I-Search] &#12398;&#34920;&#31034;&#12364;&#28040;&#12360;&#12427;&#65294;</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">(define-key isearch-mode-map (kbd "M-SPC") 'mac-win-toggle-ime)</span>
  (define-key isearch-mode-map (kbd <span style="color: #8b2252;">"S-SPC"</span>) 'mac-win-toggle-ime)

  (<span style="color: #a020f0;">when</span> (boundp 'mac-win-ime-cursor-type) <span style="color: #b22222;">;; </span><span style="color: #b22222;">Need update</span>
    (<span style="color: #a020f0;">setq</span> mac-win-ime-cursor-type (plist-get my-cur-type-ime <span style="color: #483d8b;">:on</span>)))
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">minibuffer &#12391;&#12399;&#8593;&#12398;&#32972;&#26223;&#33394;&#12434;&#28961;&#21177;&#12395;&#12377;&#12427;</span>
  (<span style="color: #a020f0;">when</span> (fboundp 'mac-min--minibuffer-setup)
    (add-hook 'minibuffer-setup-hook #'mac-min--minibuffer-setup))
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">echo-area &#12391;&#12418;&#32972;&#26223;&#33394;&#12434;&#28961;&#21177;&#12395;&#12377;&#12427;</span>
  (<span style="color: #a020f0;">when</span> (boundp 'mac-win-default-background-echo-area)
    (<span style="color: #a020f0;">setq</span> mac-win-default-background-echo-area t))<span style="color: #b22222;">;; </span><span style="color: #b22222;">*-text&#12398;background&#12434;&#28961;&#35222;</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#12487;&#12496;&#12483;&#12464;&#29992;</span>
  (<span style="color: #a020f0;">when</span> (boundp 'mac-win-debug-log)
    (<span style="color: #a020f0;">setq</span> mac-win-debug-log nil))
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">Testing...</span>
  (<span style="color: #a020f0;">when</span> (boundp 'mac-win-apply-org-heading-face)
    (<span style="color: #a020f0;">setq</span> mac-win-apply-org-heading-face t))

  (<span style="color: #a020f0;">unless</span> noninteractive
    (mac-auto-ascii-mode 1)))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org35f3bbc9" class="outline-2">
<h2 id="org35f3bbc9"><span class="section-number-2">4.</span> カーソル移動</h2>
<div class="outline-text-2" id="text-org35f3bbc9">
<p>
カーソルの移動は，次のポリシーに従っています．デフォルトでは <code>C-v/M-v</code> で上下移動になっていますが， <code>M-v</code> は windows のペーストに対応するので混乱を招くので使っていません．
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">行移動</td>
<td class="org-left">C-n/C-p</td>
</tr>

<tr>
<td class="org-left">ページ移動（スクロール）</td>
<td class="org-left">C-v/C-t</td>
</tr>

<tr>
<td class="org-left">ウィンドウ移動</td>
<td class="org-left">C-M-n/C-M-p</td>
</tr>

<tr>
<td class="org-left">バッファ切り替え</td>
<td class="org-left">M-]/M-[</td>
</tr>

<tr>
<td class="org-left">バッファ先頭・末尾</td>
<td class="org-left">C-M-t/C-M-b</td>
</tr>

<tr>
<td class="org-left">編集点の移動</td>
<td class="org-left">C-u C-SPC</td>
</tr>

<tr>
<td class="org-left">タグジャンプ</td>
<td class="org-left">M-,/M-.</td>
</tr>
</tbody>
</table>

<p>
なお， <code>C-M-b</code>, <code>C-M-n</code>, <code>C-M-p</code>, はそれぞれ，本来S式の移動(<code>backward-sexp</code>, <code>forward-list</code>, <code>backward-list</code>)に割り振られています．また， <code>C-M-t</code> は，本来，2つのS式の入れ替え(<code>transpose-sexps</code>)に割り振られています．
</p>
</div>

<div id="outline-container-org2a46a2bd" class="outline-3">
<h3 id="org2a46a2bd"><span class="section-number-3">4.1.</span> バッファ内のカーソル移動</h3>
<div class="outline-text-3" id="text-org2a46a2bd">
<p>
先頭に移動，最終行に移動，ページ単位の進む，ページ単位の戻る，行数を指定して移動．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(global-set-key (kbd <span style="color: #8b2252;">"C-M-t"</span>) 'beginning-of-buffer)
(global-set-key (kbd <span style="color: #8b2252;">"C-M-b"</span>) 'end-of-buffer)
<span style="color: #b22222;">;; </span><span style="color: #b22222;">Backward page scrolling instead of M-v</span>
(global-set-key (kbd <span style="color: #8b2252;">"C-t"</span>) 'scroll-down)
<span style="color: #b22222;">;; </span><span style="color: #b22222;">Frontward page scrolling instead of C-v</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">(global-set-key (kbd "M-n") 'scroll-up)</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">Move cursor to a specific line</span>
(global-set-key (kbd <span style="color: #8b2252;">"C-c g"</span>) 'goto-line)
</pre>
</div>
</div>
</div>

<div id="outline-container-org3bebf489" class="outline-3">
<h3 id="org3bebf489"><span class="section-number-3">4.2.</span> バッファ間のカーソル移動</h3>
<div class="outline-text-3" id="text-org3bebf489">
<p>
<code>C-c o</code> でもいいですが，ワンアクションで移動できるようが楽です．次のように双方向で使えるように設定しています．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(global-set-key (kbd <span style="color: #8b2252;">"C-M-p"</span>) (<span style="color: #a020f0;">lambda</span> () (<span style="color: #a020f0;">interactive</span>) (other-window -1)))
(global-set-key (kbd <span style="color: #8b2252;">"C-M-n"</span>) (<span style="color: #a020f0;">lambda</span> () (<span style="color: #a020f0;">interactive</span>) (other-window 1)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc4c0ed9a" class="outline-3">
<h3 id="orgc4c0ed9a"><span class="section-number-3">4.3.</span> 対応するカッコを選択（逆方向）</h3>
<div class="outline-text-3" id="text-orgc4c0ed9a">
<ul class="org-ul">
<li><code>C-M-SPC</code> (mark-sexp) は，カーソル位置から順方向に選択．</li>
<li><code>C-M-U</code> (backward-up-list) は，一つ外のカッコの先頭にポイントを移す．</li>
</ul>

<p>
<del>- <code>C-M-9</code> (my-mark-sexp) は，カーソル位置から逆方向に選択．</del> 以前は <code>my-mark-sexp</code> を定義して使っていましたが， <code>mark-sexp</code> を advice する方法に変えました．カーソルが行末だったり，後ろが空白文字の場合にのみ， <code>mark-sexp</code> に <code>-1</code> がわたるようにしました．
</p>

<p>
<code>ad:er:mark-sexp</code> を設定することで， <code>C-M-SPC</code> 時にカーソル以下の単語を選択するようになります． <code>expand-region.el</code> の機能を使っています．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-mark-sexp</span> (<span style="color: #228b22;">&amp;optional</span> arg)
  <span style="color: #8b2252;">"Move backward across one balanced expression and select it."</span>
  (<span style="color: #a020f0;">interactive</span>)
  (mark-sexp (<span style="color: #a020f0;">or</span> arg -1)))
(global-set-key (kbd <span style="color: #8b2252;">"C-M-9"</span>) #'my-mark-sexp)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">ad:mark-sexp</span> (f <span style="color: #228b22;">&amp;optional</span> arg allow-extend)
  <span style="color: #8b2252;">"Set mark ARG sexps from point.</span>
<span style="color: #8b2252;">When the cursor is at the end of line or before a whitespace, set ARG -1."</span>
  (<span style="color: #a020f0;">interactive</span> <span style="color: #8b2252;">"P\np"</span>)
  (funcall f (<span style="color: #a020f0;">if</span> (<span style="color: #a020f0;">and</span> (not (bolp))
                      (not (eq (preceding-char) ?\ ))
                      (not (memq (following-char) '(?\( ?\&lt; ?\[ ?\{)))
                      (<span style="color: #a020f0;">or</span> (eolp)
                          (eq (following-char) ?\ )
                          (memq (preceding-char) '(?\) ?\&gt; ?\] ?\}))))
                 -1 arg)
           allow-extend))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">ad:er:mark-sexp</span> (f <span style="color: #228b22;">&amp;optional</span> arg allow-extend)
  <span style="color: #8b2252;">"If the cursor is on a symbol, expand the region along the symbol."</span>
  (<span style="color: #a020f0;">interactive</span> <span style="color: #8b2252;">"P\np"</span>)
  (<span style="color: #a020f0;">if</span> (<span style="color: #a020f0;">and</span> (not (use-region-p))
           (symbol-at-point)
           (not (memq (following-char) '(?\( ?\&lt; ?\[ ?\{)))
           (not (memq (preceding-char) '(?\) ?\&gt; ?\] ?\}))))
      (er/mark-symbol)
    (funcall f arg allow-extend)))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(advice-add 'mark-sexp <span style="color: #483d8b;">:around</span> #'ad:mark-sexp)
(<span style="color: #a020f0;">when</span> (autoload-if-found '(er/mark-symbol) <span style="color: #8b2252;">"expand-region"</span> nil t)
  (advice-add 'mark-sexp <span style="color: #483d8b;">:around</span> #'ad:er:mark-sexp))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb8c57f30" class="outline-3">
<h3 id="orgb8c57f30"><span class="section-number-3">4.4.</span> スクロールを制御</h3>
<div class="outline-text-3" id="text-orgb8c57f30">
<p>
一行づつスクロールさせます．デフォルトではバッファの端でスクロールすると，半画面移動します．また，上下の端にカーソルがどのくらい近づいたらスクロールとみなすかも指定できます．
</p>

<ul class="org-ul">
<li><a href="http://marigold.sakura.ne.jp/devel/emacs/scroll/index.html">http://marigold.sakura.ne.jp/devel/emacs/scroll/index.html</a></li>
</ul>

<p>
非ASCII文字を扱っているときに一行づつスクロールしない場合は，scroll-conservatively の値を1ではなく大きい数字にすると直るかもしれません．マニュアルでは，100より大きい数値とあります．
</p>

<ul class="org-ul">
<li><a href="http://www.emacswiki.org/emacs/SmoothScrolling">http://www.emacswiki.org/emacs/SmoothScrolling</a></li>
</ul>

<p>
scroll-margin を指定すると，カーソルがウィンドウの端から離れた状態でスクロールされます．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">Scroll window on a line-by-line basis</span>
(<span style="color: #a020f0;">setq</span> scroll-conservatively 1000)
(<span style="color: #a020f0;">setq</span> scroll-step 1)
(<span style="color: #a020f0;">setq</span> scroll-preserve-screen-position t) <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#12473;&#12463;&#12525;&#12540;&#12523;&#26178;&#12395;&#12473;&#12463;&#12522;&#12540;&#12531;&#20869;&#12391;&#22266;&#23450;</span>
<span style="color: #b22222;">;;  </span><span style="color: #b22222;">(setq scroll-margin 0) ; default=0</span>
</pre>
</div>

<p>
スクロール時のジャンプが気になる場合は次のパッケージを使うとよいです．
</p>

<ul class="org-ul">
<li><a href="http://adamspiers.org/computing/elisp/smooth-scrolling.el">http://adamspiers.org/computing/elisp/smooth-scrolling.el</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">smooth-scrolling</span> nil t)
  (<span style="color: #a020f0;">setq</span> smooth-scroll-margin 1))
</pre>
</div>
</div>
</div>

<div id="outline-container-org5f40f030" class="outline-3">
<h3 id="org5f40f030"><span class="section-number-3">4.5.</span> スクロールで表示を重複させる行数</h3>
<div class="outline-text-3" id="text-org5f40f030">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">Scroll window on a page-by-page basis with N line overlapping</span>
(<span style="color: #a020f0;">setq</span> next-screen-context-lines 10)
</pre>
</div>
</div>
</div>

<div id="outline-container-org9811c7e8" class="outline-3">
<h3 id="org9811c7e8"><span class="section-number-3">4.6.</span> マーク箇所を遡る</h3>
<div class="outline-text-3" id="text-org9811c7e8">
<p>
<code>C-u C-SPC</code> で辿れるようになります．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">setq</span> set-mark-command-repeat-pop t)
(<span style="color: #a020f0;">setq</span> mark-ring-max 32)
(<span style="color: #a020f0;">setq</span> global-mark-ring-max 64)
</pre>
</div>
</div>
</div>

<div id="outline-container-org7ea97f70" class="outline-3">
<h3 id="org7ea97f70"><span class="section-number-3">4.7.</span> [ah.el] カーソル移動に反応するフック</h3>
<div class="outline-text-3" id="text-org7ea97f70">
<p>
カーソルを移動するインタラクティブ関数に反応する <code>ah-before-move-cursor-hook</code> と <code>ah-after-move-cursor-hook</code> を使います． <a href="https://github.com/takaxp/ah">ah.el</a> に関数定義を切り出しました．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">ah</span> nil t)
  (<span style="color: #a020f0;">setq</span> ah-lighter <span style="color: #8b2252;">""</span>)
  (<span style="color: #a020f0;">unless</span> noninteractive
    (ah-mode 1)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc62cc9bf" class="outline-3">
<h3 id="orgc62cc9bf"><span class="section-number-3">4.8.</span> [smooth-scroll.el] 滑らかなスクロール</h3>
<div class="outline-text-3" id="text-orgc62cc9bf">
<p>
良い感じです．スススっとスクロールします．最初にスクロールする時にパッケージを読み込みます．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(smooth-scroll-mode)
                         <span style="color: #8b2252;">"smooth-scroll"</span> nil t)

  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"smooth-scroll"</span>
    (custom-set-variables
     '(smooth-scroll/vscroll-step-size 6)
     '(smooth-scroll/hscroll-step-size 6)))

  (<span style="color: #a020f0;">unless</span> noninteractive
    (smooth-scroll-mode t)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org768c06a0" class="outline-3">
<h3 id="org768c06a0"><span class="section-number-3">4.9.</span> [bs.el] 続・カレントバッファの表示切り替え</h3>
<div class="outline-text-3" id="text-org768c06a0">
<p>
古くから <code>cycle-buffer</code> がありますが，基本機能だけで満足するようになったので，ビルトインの <code>bs.el</code> に移行しました． <code>bs-cycle-next</code> あるいは <code>bs-cycle-previous</code> でバッファを切り替えられます．
</p>

<p>
切り替えるときにミニバッファにバッファ名が列挙されますが，できればセパレータを表示したいところです．FontAwesome を使えば，だいぶ見やすくなるかも．
</p>

<p>
<code>bs.el</code> が表示するバッファリストが横長で見にくいので，縦表示する拡張パッケージを作りました．表示中のリストには番号を割り当てられていて，番号に対応するキーを押すとそのバッファに移動できます． <code>bs.el</code> のコマンドを <code>advice</code> しているだけなので，それを解けばオリジナルの <code>bs.el</code> の振る舞いに戻ります．そのための関数(<code>M-x bsv-disable-advices</code>)も準備しておきました．
</p>

<ul class="org-ul">
<li><a href="https://github.com/takaxp/bsv">https://github.com/takaxp/bsv</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(global-set-key (kbd <span style="color: #8b2252;">"M-]"</span>) 'bs-cycle-next)
(<span style="color: #a020f0;">when</span> (display-graphic-p)
  (global-set-key (kbd <span style="color: #8b2252;">"M-["</span>) 'bs-cycle-previous))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"bs"</span>
  (custom-set-variables
   '(bs-cycle-configuration-name <span style="color: #8b2252;">"files-and-scratch"</span>)
   '(bs-max-window-height 10))

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#12522;&#12473;&#12488;&#12434;&#32294;&#34920;&#31034;&#12377;&#12427;</span>
  (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">bsv</span> nil t)
    (<span style="color: #a020f0;">setq</span> bsv-max-height 5
          bsv-message-timeout 9)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd5942d14" class="outline-3">
<h3 id="orgd5942d14"><span class="section-number-3">4.10.</span> [bm.el] カーソル位置をブックマークして追う</h3>
<div class="outline-text-3" id="text-orgd5942d14">
<p>
<a href="https://github.com/joodland/bm">bm.el</a>は，カーソル位置をブックマークしておくためのツールです． <code>point-undo</code> と比較して，ユーザが明示的に位置を保存でき，見た目にも使いやすいです．以下の例では， <code>org-mode</code> のツリー内にブックマークがある時にも，上手い具合に表示ができるように調整してあります．カーソル移動は，順方向（ <code>bm-next</code> ）にだけ使っています．
</p>

<p>
org-mode との連携には， <a href="https://github.com/alphapapa/org-bookmark-heading">org-bookmark-heading</a> があります．ただ，私は下記の設定だけでそれほど不自由していません．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-bm-save-all</span> ()
  (bm-buffer-save-all)
  (bm-repository-save))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-toggle-bm</span> ()
  <span style="color: #8b2252;">"bm-toggle with updating history"</span>
  (<span style="color: #a020f0;">interactive</span>)
  (<span style="color: #a020f0;">let</span> ((bm (concat
             (buffer-name) <span style="color: #8b2252;">"::"</span>
             (<span style="color: #a020f0;">if</span> (<span style="color: #a020f0;">and</span> (equal major-mode 'org-mode)
                      (not (org-before-first-heading-p)))
                 (nth 4 (org-heading-components))
               (format <span style="color: #8b2252;">"%s"</span> (line-number-at-pos))))))
    (<span style="color: #a020f0;">if</span> (bm-bookmark-at (point))
        (bookmark-delete bm)
      (bookmark-set bm)))
  (bm-toggle)
  (bm-buffer-save-all)
  (bm-repository-save))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-bm-next</span> ()
  <span style="color: #8b2252;">"bm-next with org-mode"</span>
  (<span style="color: #a020f0;">interactive</span>)
  (bm-next)
  (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">and</span> (equal major-mode 'org-mode)
             (not (org-before-first-heading-p)))
    (widen)
    (org-overview)
    (org-reveal)
    (org-cycle-hide-drawers 'all)
    (org-show-entry)
    (show-children)
    (org-show-siblings)))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">counsel-bm-get-list</span> (bookmark-overlays)
  (-map (<span style="color: #a020f0;">lambda</span> (bm)
          (<span style="color: #a020f0;">with-current-buffer</span> (overlay-buffer bm)
            (<span style="color: #a020f0;">let*</span> ((line (replace-regexp-in-string
                          <span style="color: #8b2252;">"\n$"</span> <span style="color: #8b2252;">""</span>
                          (buffer-substring (overlay-start bm)
                                            (overlay-end bm))))
                   <span style="color: #b22222;">;; </span><span style="color: #b22222;">line numbers start on 1</span>
                   (line-num
                    (+ 1 (count-lines (point-min) (overlay-start bm))))
                   (name (format <span style="color: #8b2252;">"%s:%d - %s"</span> (buffer-name) line-num line)))
              `(,name . ,bm))))
        bookmark-overlays))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">counsel-bm</span> ()
  (<span style="color: #a020f0;">interactive</span>)
  (<span style="color: #a020f0;">let*</span> ((bm-list (counsel-bm-get-list (bm-overlays-lifo-order t)))
         (bm-hash-table (make-hash-table <span style="color: #483d8b;">:test</span> 'equal))
         (search-list (-map (<span style="color: #a020f0;">lambda</span> (bm) (car bm)) bm-list)))
    (-each bm-list (<span style="color: #a020f0;">lambda</span> (bm)
                     (puthash (car bm) (cdr bm) bm-hash-table)
                     ))
    (ivy-read <span style="color: #8b2252;">"Find bookmark(bm.el): "</span>
              search-list
              <span style="color: #483d8b;">:require-match</span> t
              <span style="color: #483d8b;">:keymap</span> counsel-describe-map
              <span style="color: #483d8b;">:action</span> (<span style="color: #a020f0;">lambda</span> (chosen)
                        (<span style="color: #a020f0;">let</span> ((bookmark (gethash chosen bm-hash-table)))
                          (switch-to-buffer (overlay-buffer bookmark))
                          (bm-goto bookmark)
                          ))
              <span style="color: #483d8b;">:sort</span> t)))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">ad:bm-show-mode</span> ()
  <span style="color: #8b2252;">"Enable truncate mode when showing bm list."</span>
  (toggle-truncate-lines 1))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(my-toggle-bm
                           my-bm-next bm-buffer-save bm-buffer-restore
                           bm-buffer-save-all bm-repository-save
                           bm-repository-load counsel-bm)
       <span style="color: #8b2252;">"bm"</span> nil t)

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#12501;&#12449;&#12452;&#12523;&#12458;&#12540;&#12503;&#12531;&#26178;&#12395;&#12502;&#12483;&#12463;&#12510;&#12540;&#12463;&#12434;&#24489;&#24112;</span>
  (global-set-key (kbd <span style="color: #8b2252;">"&lt;f10&gt;"</span>) 'my-toggle-bm)
  (global-set-key (kbd <span style="color: #8b2252;">"&lt;C-f10&gt;"</span>) 'my-bm-next)
  (global-set-key (kbd <span style="color: #8b2252;">"&lt;S-f10&gt;"</span>) 'bm-show-all)
  (add-hook 'find-file-hook #'bm-buffer-restore)

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#12499;&#12523;&#12488;&#12452;&#12531; bookmark &#12398;&#37197;&#33394;&#12434;&#28961;&#21177;&#12395;&#12377;&#12427;(as of 28.1)</span>
  (<span style="color: #a020f0;">setq</span> bookmark-fontify nil)

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#12499;&#12523;&#12488;&#12452;&#12531; bookmark &#12364;fringe&#12395;&#20986;&#12377;&#12510;&#12540;&#12463;&#12434;&#28961;&#21177;&#12395;&#12377;&#12427;(as of 28.1)</span>
  (<span style="color: #a020f0;">setq</span> bookmark-set-fringe-mark nil)

  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"ivy"</span>
    (global-set-key (kbd <span style="color: #8b2252;">"&lt;S-f10&gt;"</span>) 'counsel-bm))

  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"bm"</span>
    (advice-add 'bm-repository-load <span style="color: #483d8b;">:around</span> #'ad:suppress-message)

    <span style="color: #b22222;">;; </span><span style="color: #b22222;">(setq bm-annotation-width 30)</span>
    (<span style="color: #a020f0;">setq-default</span> bm-buffer-persistence t)
    (<span style="color: #a020f0;">setq</span> bm-restore-repository-on-load t)
    (<span style="color: #a020f0;">setq</span> bm-cycle-all-buffers t)
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">(setq bm-toggle-buffer-persistence t)</span>
    (<span style="color: #a020f0;">setq</span> bm-buffer-persistence t)
    (<span style="color: #a020f0;">setq</span> bm-persistent-face 'bm-face)
    (<span style="color: #a020f0;">setq</span> bm-repository-file
          (expand-file-name
           (concat (getenv <span style="color: #8b2252;">"SYNCROOT"</span>) <span style="color: #8b2252;">"/emacs.d/.bm-repository"</span>)))

    (<span style="color: #a020f0;">unless</span> noninteractive
      (bm-repository-load)
      (add-hook 'kill-buffer-hook 'bm-buffer-save)
      (add-hook 'after-save-hook 'bm-buffer-save)
      (add-hook 'after-revert-hook 'bm-buffer-restore)
      (add-hook 'kill-emacs-hook #'my-bm-save-all))

    (advice-add 'bm-show-mode <span style="color: #483d8b;">:after</span> #'ad:bm-show-mode)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfa2bad61" class="outline-3">
<h3 id="orgfa2bad61"><span class="section-number-3">4.11.</span> [centered-cursor-mode.el] カーソル位置をバッファ中央に固定</h3>
<div class="outline-text-3" id="text-orgfa2bad61">
<p>
<code>isearch-mode</code> の時だけ有効にしています．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-centered-cursor-activate</span> () (centered-cursor-mode 1))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-centered-cursor-deactivate</span> () (centered-cursor-mode -1))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(centered-cursor-mode)
                         <span style="color: #8b2252;">"centered-cursor-mode"</span> nil t)

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">isearch &#12398;&#26178;&#12399;OFF&#12395;&#12377;&#12427;</span>
  (add-hook 'isearch-mode-hook #'my-centered-cursor-activate)
  (add-hook 'isearch-mode-end-hook #'my-centered-cursor-deactivate))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgadf36a14" class="outline-3">
<h3 id="orgadf36a14"><span class="section-number-3">4.12.</span> [smart-mark] C-g後に元の場所へカーソルを戻す</h3>
<div class="outline-text-3" id="text-orgadf36a14">
<p>
すぐわかる例は， <code>C-x h</code> で全選択して何もせず， <code>C-g</code> する場合です．通常だとバッファの先頭にカーソルが置き去りにされますが， <code>smart-mark</code> を使うと，全選択を実行した時の位置に自動的に戻してくれます．
</p>

<ul class="org-ul">
<li><a href="https://github.com/zhangkaiyulw/smart-mark">zhangkaiyulw/smart-mark: Emacs package to restore point after C-g when mark</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-smart-mark-activate</span> ()
  (smart-mark-mode 1)
  (remove-hook 'find-file-hook #'my-smart-mark-activate))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">ad:smart-mark-restore-cursor</span> ()
  <span style="color: #8b2252;">"Restore cursor position saved just before mark."</span>
  (<span style="color: #a020f0;">when</span> smart-mark-point-before-mark
    (<span style="color: #a020f0;">when</span> (&gt; smart-mark-point-before-mark 1)
      <span style="color: #b22222;">;; </span><span style="color: #b22222;">To avoid to jump to the beginning of the buffer</span>
      (goto-char smart-mark-point-before-mark))
    (<span style="color: #a020f0;">setq</span> smart-mark-point-before-mark nil)))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">ad:smart-mark-set-restore-before-mark</span> (<span style="color: #228b22;">&amp;rest</span> _arg)
  (<span style="color: #a020f0;">unless</span> (memq this-command
                '(er/expand-region er/mark-symbol er/contract-region))
    (<span style="color: #a020f0;">setq</span> smart-mark-point-before-mark (point))))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">ad:er:keyboard-quit</span> ()
  (<span style="color: #a020f0;">when</span> (memq last-command '(er/expand-region er/contract-region))
    (<span style="color: #a020f0;">when</span> smart-mark-point-before-mark
      (goto-char smart-mark-point-before-mark))))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">ad:er:pre:keyboard-quit</span> ()
  (<span style="color: #a020f0;">when</span> (memq last-command '(er/expand-region er/contract-region))
    (er/contract-region 0)
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">(when (&gt; smart-mark-point-before-mark 1) ;; FIXME</span>
    <span style="color: #b22222;">;;   </span><span style="color: #b22222;">(goto-char smart-mark-point-before-mark))</span>
    ))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(smart-mark-mode)
                         <span style="color: #8b2252;">"smart-mark"</span> nil t)

  (add-hook 'find-file-hook #'my-smart-mark-activate)

  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"smart-mark"</span>
    (<span style="color: #a020f0;">progn</span> <span style="color: #b22222;">;; </span><span style="color: #b22222;">C-M-SPC SPC SPC ... C-g &#12398;&#22580;&#21512;&#12395;&#27491;&#12375;&#12367;&#12459;&#12540;&#12477;&#12523;&#12392;&#20803;&#12395;&#25147;&#12377;&#65294;</span>
      (advice-add 'smart-mark-restore-cursor <span style="color: #483d8b;">:override</span>
                  #'ad:smart-mark-restore-cursor)
      (advice-add 'smart-mark-set-restore-before-mark <span style="color: #483d8b;">:override</span>
                  #'ad:smart-mark-set-restore-before-mark)

      (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">expand-region-core</span> nil t)
        (advice-add 'keyboard-quit <span style="color: #483d8b;">:after</span> #'ad:er:keyboard-quit))
      <span style="color: #b22222;">;; </span><span style="color: #b22222;">(advice-add 'keyboard-quit :before #'ad:er:pre:keyboard-quit)</span>
      )))
<span style="color: #b22222;">;; </span><span style="color: #b22222;">(defun my-smart-mark-activate () (smart-mark-mode 1))</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">(defun my-smart-mark-dectivate () (smart-mark-mode -1))</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">(add-hook 'isearch-mode-hook #'my-smart-mark-dectivate)</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">(add-hook 'isearch-mode-end-hook #'my-smart-mark-activate)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf75f443a" class="outline-3">
<h3 id="orgf75f443a"><span class="section-number-3">4.13.</span> [syntax-subword.el] M-f で移動する位置をより密にする</h3>
<div class="outline-text-3" id="text-orgf75f443a">
<ul class="org-ul">
<li><a href="https://github.com/jpkotta/syntax-subword">https://github.com/jpkotta/syntax-subword</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-syntax-subword-activate</span> (<span style="color: #228b22;">&amp;rest</span> arg)
  (<span style="color: #a020f0;">unless</span> (<span style="color: #a020f0;">featurep</span> '<span style="color: #008b8b;">syntax-subword</span>)
    (global-syntax-subword-mode 1))
  (advice-remove 'forward-word #'my-syntax-subword-activate)
  (advice-remove 'backword-word #'my-syntax-subword-activate)
  arg)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(global-syntax-subword-mode syntax-subword-mode)
                         <span style="color: #8b2252;">"syntax-subword"</span> nil t)

  (advice-add 'forward-word <span style="color: #483d8b;">:before</span> #'my-syntax-subword-activate)
  (advice-add 'backword-word <span style="color: #483d8b;">:before</span> #'my-syntax-subword-activate))
</pre>
</div>
</div>
</div>

<div id="outline-container-org3901456e" class="outline-3">
<h3 id="org3901456e"><span class="section-number-3">4.14.</span> [expand-region.el] カーソル箇所を起点に選択範囲を賢く広げる</h3>
<div class="outline-text-3" id="text-org3901456e">
<ul class="org-ul">
<li><a href="https://github.com/magnars/expand-region.el">magnars/expand-region.el: Emacs extension to increase selected region by semantic units.</a></li>
</ul>

<p>
<code>er/expand-region</code> を呼ぶと，カーソル位置を起点として前後に選択範囲を広げてくれます．2回以上呼ぶと，読んだ回数だけ賢く選択範囲が広がりますが，2回目は設定したキーバインドの最後の一文字を連打すればOKです．その場合，選択範囲を狭める時は <code>-</code> を押し， <code>0</code> を押せばリセットされます．
</p>

<p>
自分は <code>selected.el</code> とペアで使うように設定していて， <code>C-SPC</code> か <code>C-M-SPC</code> から <code>SPC</code> を押すことで <code>er/expand-region</code> が呼ばれるように設定しています．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"selected"</span>
  (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">expand-region</span> nil t)
    (define-key selected-keymap (kbd <span style="color: #8b2252;">"SPC"</span>) #'er/expand-region)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org8435eae2" class="outline-3">
<h3 id="org8435eae2"><span class="section-number-3">4.15.</span> <span class="done DONE">DONE</span> [goto-chg.el] 編集箇所を簡単に辿る&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></h3>
<div class="outline-text-3" id="text-org8435eae2">
<p>
編集結果を保持したまま編集箇所にカーソルを移すことができます． <code>C-/</code> の Undo のような操作で，簡単かつ高速にカーソルを移動できます．ただ <code>undo-tree</code> 依存です．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(goto-last-change goto-last-change-reverse)
                         <span style="color: #8b2252;">"goto-chg"</span> nil t)

  (global-set-key (kbd <span style="color: #8b2252;">"C-,"</span>) 'goto-last-change)
  (global-set-key (kbd <span style="color: #8b2252;">"C-."</span>) 'goto-last-change-reverse)

  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"flyspell"</span>
    (define-key flyspell-mode-map (kbd <span style="color: #8b2252;">"C-,"</span>) 'goto-last-change)
    (define-key flyspell-mode-map (kbd <span style="color: #8b2252;">"C-."</span>) 'goto-last-change-reverse)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org27e3241e" class="outline-3">
<h3 id="org27e3241e"><span class="section-number-3">4.16.</span> <span class="done DONE">DONE</span> [cycle-buffer.el] カレントバッファの表示切り替え&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></h3>
<div class="outline-text-3" id="text-org27e3241e">
<p>
<a href="http://www.emacswiki.org/emacs/download/cycle-buffer.el">http://www.emacswiki.org/emacs/download/cycle-buffer.el</a>
</p>

<p>
cycle-buffer を使うと，バッファの履歴をスライドショーのようにたどれます．ミニバッファに前後の履歴が表示されるので，何回キーを押せばいいかの目安になります．それを超える場合には，おとなしくバッファリストを使います．直近数件のバッファをたどるのに便利です． <code>cycle-buffer</code> は古めですが，個人的には気に入っています．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(cycle-buffer cycle-buffer-backward)
                         <span style="color: #8b2252;">"cycle-buffer"</span> nil t)

  (global-set-key (kbd <span style="color: #8b2252;">"M-]"</span>) 'cycle-buffer)
  (global-set-key (kbd <span style="color: #8b2252;">"M-["</span>) 'cycle-buffer-backward)

  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"cycle-buffer"</span>
    (custom-set-variables
     '(cycle-buffer-allow-visible t)
     '(cycle-buffer-show-length 12)
     '(cycle-buffer-show-format '(<span style="color: #8b2252;">" &lt; %s &gt;"</span> . <span style="color: #8b2252;">" %s"</span>)))))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd906e864" class="outline-3">
<h3 id="orgd906e864"><span class="section-number-3">4.17.</span> <span class="done DONE">DONE</span> [back-button] マークをたどる&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></h3>
<div class="outline-text-3" id="text-orgd906e864">
<p>
現在のバッファと開いている全てのバッファのマークを辿ることができます．いま注目している位置が，マーク全体でどのあたりに位置するのかをミニバッファに表示してくれます．ツールバーを表示している場合は，マークを付けたり辿る用のボタンが追加されます． <code>global-mark-ring-max</code> を設定して，辿れるマークの数を拡張しておきます．
</p>

<p>
ただ <code>C-x &lt;SPC&gt;</code> が潰れるので要注意です．矩形選択で用いる <code>rectangle-mark-mode</code> に当てられているキーバインドです．
</p>

<ul class="org-ul">
<li><a href="https://github.com/rolandwalker/back-button">rolandwalker/back-button: Visual navigation through mark rings in Emacs 🔊</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(back-button-mode
                           back-button-local-forward back-button-global-forward)
                         <span style="color: #8b2252;">"back-button"</span> nil t)

  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"back-button"</span>
    (<span style="color: #a020f0;">setq</span> global-mark-ring-max 64)
    (<span style="color: #a020f0;">setq</span> back-button-local-forward-keystrokes '(<span style="color: #8b2252;">"&lt;f10&gt;"</span>))
    (<span style="color: #a020f0;">setq</span> back-button-global-forward-keystrokes '(<span style="color: #8b2252;">"C-&lt;f10&gt;"</span>))
    (define-key back-button-mode-map
      (kbd (car back-button-local-forward-keystrokes))
      'back-button-local-forward)
    (define-key back-button-mode-map
      (kbd (car back-button-global-forward-keystrokes))
      'back-button-global-forward)
    (<span style="color: #a020f0;">setq</span> back-button-mode-lighter nil)
    (<span style="color: #a020f0;">setq</span> back-button-index-timeout 0))

  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"postpone"</span>
    (<span style="color: #a020f0;">unless</span> noninteractive
      (back-button-mode 1))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org42db9464" class="outline-3">
<h3 id="org42db9464"><span class="section-number-3">4.18.</span> <span class="done DONE">DONE</span> [point-undo.el] カーソル位置を簡単にたどる&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></h3>
<div class="outline-text-3" id="text-org42db9464">
<p>
<code>autoload</code> や <code>autoload-if-found</code> で定義すると，使いたい時に履歴が取れていないのでよろしくないです．起動時に有効化します． bm.el で明示的にマーカーを残して履歴をたどる方が気に入っているので，最近は point-undo を使っていません．シングルキーを割り当てておくと使いやすいです．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">point-undo</span> nil t)
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">[point-undo.el] Move the cursor to the previous position</span>
  (global-set-key (kbd <span style="color: #8b2252;">"&lt;f7&gt;"</span>) 'point-undo)
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">[point-undo.el] Redo of point-undo</span>
  (global-set-key (kbd <span style="color: #8b2252;">"S-&lt;f7&gt;"</span>) 'point-redo))
</pre>
</div>
</div>
</div>

<div id="outline-container-org1af5f062" class="outline-3">
<h3 id="org1af5f062"><span class="section-number-3">4.19.</span> <span class="done DONE">DONE</span> [SmoothScroll.el] カーソル固定でスクロールする&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></h3>
<div class="outline-text-3" id="text-org1af5f062">
<p>
<a href="https://raw.github.com/takaxp/EmacsScripts/master/SmoothScroll.el">https://raw.github.com/takaxp/EmacsScripts/master/SmoothScroll.el</a>
<a href="https://github.com/pglotov/EmacsScripts/blob/master/SmoothScroll.el">https://github.com/pglotov/EmacsScripts/blob/master/SmoothScroll.el</a>
</p>

<p>
カーソル位置と行を固定してバッファを背景スクロールできます．
</p>

<p>
オリジナルのままだとコンパイル時に警告がでるので， <code>line-move-visual</code> で書き換えています．残念ながら最近は使っていません．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(scroll-one-up scroll-one-down)
                         <span style="color: #8b2252;">"smoothscroll"</span> nil t)

  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"postpone"</span>
    (global-set-key (kbd <span style="color: #8b2252;">"s-&lt;up&gt;"</span>) 'scroll-one-down)
    (global-set-key (kbd <span style="color: #8b2252;">"s-&lt;down&gt;"</span>) 'scroll-one-up)))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org36bb3b1a" class="outline-2">
<h2 id="org36bb3b1a"><span class="section-number-2">5.</span> 編集サポート</h2>
<div class="outline-text-2" id="text-org36bb3b1a">
</div>
<div id="outline-container-org6f2cf1cd" class="outline-3">
<h3 id="org6f2cf1cd"><span class="section-number-3">5.1.</span> エンターキーの挙動</h3>
<div class="outline-text-3" id="text-org6f2cf1cd">
<p>
好みの問題ですかね．標準では <code>C-j</code> が当てられています．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(global-set-key (kbd <span style="color: #8b2252;">"RET"</span>) 'electric-newline-and-maybe-indent)
</pre>
</div>
</div>
</div>

<div id="outline-container-org4c4fe29c" class="outline-3">
<h3 id="org4c4fe29c"><span class="section-number-3">5.2.</span> Yank時に装飾を取る</h3>
<div class="outline-text-3" id="text-org4c4fe29c">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">setq</span> yank-excluded-properties t)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf6cb5849" class="outline-3">
<h3 id="orgf6cb5849"><span class="section-number-3">5.3.</span> 矩形編集／連番入力</h3>
<div class="outline-text-3" id="text-orgf6cb5849">
<p>
24.4 からは， <code>rectangle-mark-mode</code> が使えるようになり， <code>C-x SPC</code> を押下すると矩形モードに入り直感的に矩形選択ができる．
</p>

<p>
標準の rect.el に以下の機能が実装されている．
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">矩形切り取り</td>
<td class="org-left">C-x r k</td>
</tr>

<tr>
<td class="org-left">矩形削除</td>
<td class="org-left">C-x r d</td>
</tr>

<tr>
<td class="org-left">矩形貼り付け</td>
<td class="org-left">C-x r y</td>
</tr>

<tr>
<td class="org-left">矩形先頭に文字を挿入</td>
<td class="org-left">C-x r t</td>
</tr>

<tr>
<td class="org-left">矩形を空白に変換する</td>
<td class="org-left">C-x r c</td>
</tr>
</tbody>
</table>

<p>
Built-in の cua-base.el（CUA-mode）を使うと，矩形選択は，領域選択後 <code>cua-toggle-rectangle-mark</code> でもできる．また，矩形選択した後に， <code>M-n</code> を押すと，連番をふれる．開始値，増加値を入力してから，hoge%03d.pgm などとすれば，hoge001，hoge002，，，と入力される．これと，org-mode の表機能（ <code>C-c |</code> で選択部分を簡単に表にできる）を組み合わせれば，連番で数値をふったテーブルを容易に作れる．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">cua-base</span>)
  (cua-mode 1)
  (<span style="color: #a020f0;">setq</span> cua-enable-cua-keys nil))
</pre>
</div>
</div>
</div>

<div id="outline-container-org9dba91d0" class="outline-3">
<h3 id="org9dba91d0"><span class="section-number-3">5.4.</span> ファイル保存時に時間を記録する</h3>
<div class="outline-text-3" id="text-org9dba91d0">
<p>
Built-in の time-stamp.el を使う．
</p>

<p>
バッファの保存時にタイムスタンプを記録する．以下の設定では，バッファの先頭から10行以内に，"#+date:" があると，"#+date: 2011-12-31" のようにタイムスタンプが記録される．Org Mode 用には "<span class="timestamp-wrapper"><span class="timestamp">[2018-10-08 Mon 10:00]</span></span>" のような形式でタイムスタンプを記録するようにしている．
</p>

<p>
ただし， <code>time-stamp-start</code>, <code>time-stamp-end</code>, <code>time-stamp-line-limit</code> を <code>init.el</code> で変更するのは推奨されていない（ファイルごとにするべき）．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-time-stamp</span> ()
  (<span style="color: #a020f0;">setq</span> time-stamp-format
        (<span style="color: #a020f0;">if</span> (eq major-mode 'org-mode)
            <span style="color: #8b2252;">"[%Y-%02m-%02d %3a %02H:%02M]"</span> <span style="color: #b22222;">;; </span><span style="color: #b22222;">"%04y"</span>
          <span style="color: #8b2252;">"%Y-%02m-%02d"</span>))
  (<span style="color: #a020f0;">if</span> (boundp 'org-tree-slide-mode)
      (<span style="color: #a020f0;">unless</span> org-tree-slide-mode
        (time-stamp))
    (time-stamp)))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(add-hook 'before-save-hook #'my-time-stamp)

(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"time-stamp"</span>
  (<span style="color: #a020f0;">setq</span> time-stamp-start <span style="color: #8b2252;">"#\\+date:[ \t]*"</span>) <span style="color: #b22222;">;; </span><span style="color: #b22222;">"Time-stamp:[ \t]+\\\\?[\"&lt;]+"</span>
  (<span style="color: #a020f0;">setq</span> time-stamp-end <span style="color: #8b2252;">"$"</span>) <span style="color: #b22222;">;; </span><span style="color: #b22222;">"\\\\?[\"&gt;]"</span>
  (<span style="color: #a020f0;">setq</span> time-stamp-line-limit 10)) <span style="color: #b22222;">;; </span><span style="color: #b22222;">def=8</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orge62264fe" class="outline-3">
<h3 id="orge62264fe"><span class="section-number-3">5.5.</span> 選択リージョンを使って検索</h3>
<div class="outline-text-3" id="text-orge62264fe">
<p>
検索語をミニバッファに入力するのが面倒なので，リージョンをそのまま検索語として利用します．
</p>

<ul class="org-ul">
<li><a href="http://dev.ariel-networks.com/articles/emacs/part5/">http://dev.ariel-networks.com/articles/emacs/part5/</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">defadvice</span> <span style="color: #0000ff;">isearch-mode</span>
    (around isearch-mode-default-string
            (forward <span style="color: #228b22;">&amp;optional</span> regexp op-fun recursive-edit word-p) activate)
  (<span style="color: #a020f0;">if</span> (<span style="color: #a020f0;">and</span> transient-mark-mode mark-active (not (eq (mark) (point))))
      (<span style="color: #a020f0;">progn</span>
        (isearch-update-ring (buffer-substring-no-properties (mark) (point)))
        (deactivate-mark)
        ad-do-it
        (<span style="color: #a020f0;">if</span> (not forward)
            (isearch-repeat-backward)
          (goto-char (mark))
          (isearch-repeat-forward)))
    ad-do-it))

<span style="color: #b22222;">;; </span><span style="color: #b22222;">C-g &#12434; isearch-exit &#12395;&#21106;&#12426;&#24403;&#12390;&#12390;&#36884;&#20013;&#20013;&#26029;&#12392;&#12377;&#12427;&#65294;&#65288;&#12459;&#12540;&#12477;&#12523;&#12434;&#30041;&#12417;&#12390;&#12362;&#12365;&#12383;&#12356;&#65289;&#12459;&#12540;&#12477;&#12523;&#12434;&#26908;&#32034;&#38283;&#22987;&#26178;&#28857;&#12398;&#22580;&#25152;&#12395;&#25147;&#12377;&#12395;&#12399;&#65292;&#21029;&#36884; counsel-mark-ring &#12434;&#20351;&#12358;</span>
(define-key isearch-mode-map (kbd <span style="color: #8b2252;">"C-g"</span>) 'isearch-exit)
</pre>
</div>
</div>
</div>

<div id="outline-container-org7cb03523" class="outline-3">
<h3 id="org7cb03523"><span class="section-number-3">5.6.</span> ChangeLog モード</h3>
<div class="outline-text-3" id="text-org7cb03523">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">see private.el</span>
(<span style="color: #a020f0;">setq</span> user-full-name <span style="color: #8b2252;">"Your NAME"</span>)
(<span style="color: #a020f0;">setq</span> user-mail-address <span style="color: #8b2252;">"your@address.com"</span>)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-orgalist-activate</span> ()
  (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">orgalist</span> nil t)
    (orgalist-mode 1))) <span style="color: #b22222;">;; </span><span style="color: #b22222;">originally orgstruct-mode</span>

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">ad:add-change-log-entry-other-window</span> ()
  (<span style="color: #a020f0;">when</span> view-mode
    (View-exit-and-edit)))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(add-hook 'change-log-mode-hook
          (<span style="color: #a020f0;">lambda</span> ()
            (view-mode 1)
            (my-orgalist-activate)
            (<span style="color: #a020f0;">setq</span> tab-width 4)
            (<span style="color: #a020f0;">setq</span> left-margin 4)))

(advice-add 'add-change-log-entry-other-window
            <span style="color: #483d8b;">:before</span> #'ad:add-change-log-entry-other-window)
</pre>
</div>
</div>
</div>

<div id="outline-container-org1bd5d8ee" class="outline-3">
<h3 id="org1bd5d8ee"><span class="section-number-3">5.7.</span> テキストモード</h3>
<div class="outline-text-3" id="text-org1bd5d8ee">
<p>
<a href="http://d.hatena.ne.jp/NeoCat/20080211">http://d.hatena.ne.jp/NeoCat/20080211</a>
</p>

<p>
とは言っても，Org-modeを知ってから <code>.txt</code> もテキストモードで開かなくなったので，ほぼ無意味な設定となりました．しかも， <code>nxml-mode</code> で <code>TAB</code> が効かなくなる現象が起きているので，以下の設定はしない方がよさげ．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(add-hook 'text-mode-hook
          (<span style="color: #a020f0;">lambda</span>()
              (<span style="color: #a020f0;">setq</span> tab-width 4)
              (<span style="color: #a020f0;">setq</span> indent-line-function 'tab-to-tab-stop)
              (<span style="color: #a020f0;">setq</span> tab-stop-list
                    '(4 8 12 16 20 24 28 32 36 40 44 48 52 56 60
                        64 68 72 76 80))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org92da42b4" class="outline-3">
<h3 id="org92da42b4"><span class="section-number-3">5.8.</span> C/C++モード</h3>
<div class="outline-text-3" id="text-org92da42b4">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(modern-c++-font-lock-mode)
                         <span style="color: #8b2252;">"modern-cpp-font-lock"</span> nil t)
  (<span style="color: #a020f0;">push</span> '(<span style="color: #8b2252;">"\\.[hm]$"</span> . c++-mode) auto-mode-alist)
  (add-hook 'c-mode-hook #'modern-c++-font-lock-mode)
  (add-hook 'c++-mode-hook #'modern-c++-font-lock-mode))
</pre>
</div>
</div>
</div>

<div id="outline-container-orga6184922" class="outline-3">
<h3 id="orga6184922"><span class="section-number-3">5.9.</span> C#モード</h3>
<div class="outline-text-3" id="text-orga6184922">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(csharp-mode)
                         <span style="color: #8b2252;">"csharp-mode"</span> <span style="color: #8b2252;">"Major mode for editing C# mode."</span> t nil)

  (<span style="color: #a020f0;">push</span> '(<span style="color: #8b2252;">"\\.cs$"</span> . csharp-mode) auto-mode-alist))
</pre>
</div>
</div>
</div>

<div id="outline-container-org743f2508" class="outline-3">
<h3 id="org743f2508"><span class="section-number-3">5.10.</span> Infoモード</h3>
<div class="outline-text-3" id="text-org743f2508">
<p>
Org-mode の日本語翻訳済みinfoを読むための設定．<a href="https://github.com/org-mode-doc-ja/org-ja">翻訳プロジェクト</a>で頒布しています．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">org-info-ja</span> (<span style="color: #228b22;">&amp;optional</span> node)
  <span style="color: #8b2252;">"(Japanese) Read documentation for Org-mode in the info system.</span>
<span style="color: #8b2252;">    With optional NODE, go directly to that node."</span>
  (<span style="color: #a020f0;">interactive</span>)
  (info (format <span style="color: #8b2252;">"(org-ja)%s"</span> (<span style="color: #a020f0;">or</span> node <span style="color: #8b2252;">""</span>))))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"info"</span>
  (add-to-list 'Info-additional-directory-list
               (expand-file-name <span style="color: #8b2252;">"~/devel/mygit/org-ja/work/"</span>)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd2a57328" class="outline-3">
<h3 id="orgd2a57328"><span class="section-number-3">5.11.</span> Rモード</h3>
<div class="outline-text-3" id="text-orgd2a57328">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found
       '(R-mode R)
       <span style="color: #8b2252;">"ess-site"</span> <span style="color: #8b2252;">"Emacs Speaks Statistics mode"</span> t)

  (<span style="color: #a020f0;">push</span> '(<span style="color: #8b2252;">"\\.[rR]$"</span> . R-mode) auto-mode-alist))
</pre>
</div>
</div>
</div>

<div id="outline-container-org8c99f06c" class="outline-3">
<h3 id="org8c99f06c"><span class="section-number-3">5.12.</span> nXMLモード</h3>
<div class="outline-text-3" id="text-org8c99f06c">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(add-hook 'nxml-mode-hook
          (<span style="color: #a020f0;">lambda</span> ()
            (define-key nxml-mode-map <span style="color: #8b2252;">"\r"</span> 'newline-and-indent)
            (auto-fill-mode -1)
            (<span style="color: #a020f0;">setq</span> indent-tabs-mode t)
            (<span style="color: #a020f0;">setq</span> nxml-slash-auto-complete-flag t)
            (<span style="color: #a020f0;">setq</span> tab-width 1)
            (<span style="color: #a020f0;">setq</span> nxml-child-indent 1)
            (<span style="color: #a020f0;">setq</span> nxml-attribute-indent 0)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbfa6c13b" class="outline-3">
<h3 id="orgbfa6c13b"><span class="section-number-3">5.13.</span> yamlモード</h3>
<div class="outline-text-3" id="text-orgbfa6c13b">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(yaml-mode)
                         <span style="color: #8b2252;">"yaml-mode"</span> nil t)
  (<span style="color: #a020f0;">push</span> '(<span style="color: #8b2252;">"\\.yml$"</span> . yaml-mode) auto-mode-alist))
</pre>
</div>
</div>
</div>

<div id="outline-container-org34a54f82" class="outline-3">
<h3 id="org34a54f82"><span class="section-number-3">5.14.</span> jsonモード</h3>
<div class="outline-text-3" id="text-org34a54f82">
<p>
バッファの保存時に <code>json-mode-beautify</code> を走らせます．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-json-mode-beautify</span> ()
  (<span style="color: #a020f0;">when</span> (eq major-mode 'json-mode)
    (json-mode-beautify (point-min) (point-max))))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-json-pretty-print-buffer</span> ()
  (<span style="color: #a020f0;">when</span> (eq major-mode 'json-mode)
    (json-pretty-print-buffer)))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(json-mode)
                         <span style="color: #8b2252;">"json-mode"</span> nil t)
  (<span style="color: #a020f0;">push</span> '(<span style="color: #8b2252;">"\\.json$"</span> . json-mode) auto-mode-alist)
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"json-mode"</span>
    (add-hook 'before-save-hook #'my-json-mode-beautify)
    (add-hook 'after-save-hook #'my-json-pretty-print-buffer)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc35f66fb" class="outline-3">
<h3 id="orgc35f66fb"><span class="section-number-3">5.15.</span> javascriptモード</h3>
<div class="outline-text-3" id="text-orgc35f66fb">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(js2-mode)
                         <span style="color: #8b2252;">"js2-mode"</span> nil t)
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"js2-mode"</span>
    (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">js2-refactor</span> nil t)
    (<span style="color: #a020f0;">push</span> '(<span style="color: #8b2252;">"\\.js$"</span> . js2-mode) auto-mode-alist)

    (<span style="color: #a020f0;">when</span> (autoload-if-found
           '(ac-js2-mode ac-js2-setup-auto-complete-mode)
           <span style="color: #8b2252;">"ac-js2"</span> nil t)
      (add-hook 'js2-mode-hook #'ac-js2-mode))

    (<span style="color: #a020f0;">if</span> (executable-find <span style="color: #8b2252;">"tern"</span>)
        (<span style="color: #a020f0;">when</span> (autoload-if-found
               '(tern-mode)
               <span style="color: #8b2252;">"tern"</span> nil t)
          (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"tern"</span>
            (tern-mode 1)
            <span style="color: #b22222;">;; </span><span style="color: #b22222;">tern-command shall be overwritten by actual path</span>
            (<span style="color: #a020f0;">setq</span> tern-command `(<span style="color: #8b2252;">"node"</span> ,(executable-find <span style="color: #8b2252;">"tern"</span>)))
            (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">tern-auto-complete</span> nil t)
              (tern-ac-setup)))
          (add-hook 'js2-mode-hook #'tern-mode))
      (message <span style="color: #8b2252;">"--- tern is NOT installed in this system."</span>))))
</pre>
</div>
</div>
</div>

<div id="outline-container-orga7d86e03" class="outline-3">
<h3 id="orga7d86e03"><span class="section-number-3">5.16.</span> csvモード</h3>
<div class="outline-text-3" id="text-orga7d86e03">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(csv-mode)
                         <span style="color: #8b2252;">"csv-mode"</span> nil t)
  (<span style="color: #a020f0;">push</span> '(<span style="color: #8b2252;">"\\.csv$"</span> . csv-mode) auto-mode-alist))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgba009928" class="outline-3">
<h3 id="orgba009928"><span class="section-number-3">5.17.</span> asciiモード</h3>
<div class="outline-text-3" id="text-orgba009928">
<p>
カーソル下の文字のアスキーコードを別ウィンドウでリアルタイムに確認できます．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(autoload-if-found '(ascii-on ascii-off) <span style="color: #8b2252;">"ascii"</span> nil t)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc5b5891d" class="outline-3">
<h3 id="orgc5b5891d"><span class="section-number-3">5.18.</span> javaモード</h3>
<div class="outline-text-3" id="text-orgc5b5891d">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(cc-mode)
                         <span style="color: #8b2252;">"cc-mode"</span> nil t)
  (<span style="color: #a020f0;">push</span> '(<span style="color: #8b2252;">"\\.pde$"</span> . java-mode) auto-mode-alist) <span style="color: #b22222;">;; </span><span style="color: #b22222;">Processing</span>
  (<span style="color: #a020f0;">push</span> '(<span style="color: #8b2252;">"\\.java$"</span> . java-mode) auto-mode-alist))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf0c39e0f" class="outline-3">
<h3 id="orgf0c39e0f"><span class="section-number-3">5.19.</span> esモード</h3>
<div class="outline-text-3" id="text-orgf0c39e0f">
<ul class="org-ul">
<li><a href="https://github.com/dakrone/es-mode">https://github.com/dakrone/es-mode</a></li>
</ul>

<p>
<a href="https://www.elastic.co/products/elasticsearch">ElasticSearch</a> のクエリを編集します．org-mode との連携もできます．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(es-mode)
                         <span style="color: #8b2252;">"es-mode"</span> nil t)
  (<span style="color: #a020f0;">push</span> '(<span style="color: #8b2252;">"\\.es$"</span> . es-mode) auto-mode-alist))
</pre>
</div>
</div>
</div>

<div id="outline-container-org2a14728f" class="outline-3">
<h3 id="org2a14728f"><span class="section-number-3">5.20.</span> gnuplotモード</h3>
<div class="outline-text-3" id="text-org2a14728f">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">yes</span>
(<span style="color: #a020f0;">when</span> (autoload-if-found '(gnuplot-mode)
                         <span style="color: #8b2252;">"gnuplot-mode"</span> nil t)
  (<span style="color: #a020f0;">push</span> '(<span style="color: #8b2252;">"\\.plt$"</span> . gnuplot-mode) auto-mode-alist))
</pre>
</div>
</div>
</div>

<div id="outline-container-orga6fc6cf7" class="outline-3">
<h3 id="orga6fc6cf7"><span class="section-number-3">5.21.</span> markdown-modeモード</h3>
<div class="outline-text-3" id="text-orga6fc6cf7">
<ul class="org-ul">
<li><a href="http://jblevins.org/projects/markdown-mode/">http://jblevins.org/projects/markdown-mode/</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(markdown-mode)
                         <span style="color: #8b2252;">"markdown-mode"</span> nil t)
  (<span style="color: #a020f0;">push</span> '(<span style="color: #8b2252;">"\\.markdown$"</span> . markdown-mode) auto-mode-alist)
  (<span style="color: #a020f0;">push</span> '(<span style="color: #8b2252;">"\\.md$"</span> . markdown-mode) auto-mode-alist))
</pre>
</div>
</div>
</div>

<div id="outline-container-org29328dcd" class="outline-3">
<h3 id="org29328dcd"><span class="section-number-3">5.22.</span> cmakeモード</h3>
<div class="outline-text-3" id="text-org29328dcd">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(cmake-mode)
                         <span style="color: #8b2252;">"cmake-mode"</span> nil t)
  (add-to-list 'auto-mode-alist '(<span style="color: #8b2252;">"CMakeLists\\.txt\\'"</span> . cmake-mode))
  (add-to-list 'auto-mode-alist '(<span style="color: #8b2252;">"\\.cmake\\'"</span> . cmake-mode))

  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"cmake-mode"</span>
    (<span style="color: #a020f0;">unless</span> (executable-find <span style="color: #8b2252;">"cmake"</span>)
      (message <span style="color: #8b2252;">"--- cmake is NOT installed."</span>))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org41da658e" class="outline-3">
<h3 id="org41da658e"><span class="section-number-3">5.23.</span> logviewモード</h3>
<div class="outline-text-3" id="text-org41da658e">
<ul class="org-ul">
<li><a href="https://github.com/doublep/logview">doublep/logview: Emacs mode for viewing log files.</a></li>
</ul>

<p>
ログファイルが見やすくなり， <code>n/p</code> で移動可能になります．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(logview-mode)
                         <span style="color: #8b2252;">"logview"</span> nil t)
  (<span style="color: #a020f0;">push</span> '(<span style="color: #8b2252;">"\\.log$"</span> . logview-mode) auto-mode-alist))
</pre>
</div>
</div>
</div>

<div id="outline-container-org6b6c1c11" class="outline-3">
<h3 id="org6b6c1c11"><span class="section-number-3">5.24.</span> viewモード</h3>
<div class="outline-text-3" id="text-org6b6c1c11">
<p>
個別のファイルで view モードで開くことを指定するには次のようにします．
</p>

<div class="org-src-container">
<pre class="src src-text">-*- mode:org; eval: (view-mode) -*-
</pre>
</div>

<p>
一方，特定の拡張子に対して常に view モードで開きたい，例えば，gzされた elisp ソースを見るときに， <code>view-mode</code> を使います．また下記の設定では， <code>my-auto-view-dirs</code> に追加したディレクトリのファイルを開くと， <code>view-mode</code> が常に有効になります．
</p>

<p>
さらなる細かい制御が必要な場合は，<a href="https://www.emacswiki.org/emacs/viewer.el">viewer.el</a> がおすすめです．
</p>

<p>
<code>view-mode</code> では独自のキーバインドが設定されているので，カーソル移動や <code>&lt;tab&gt;</code> を好みの状態に変えることで，より違和感なく使えるようになります． <code>org</code> バッファにおける <code>n</code> や <code>&lt;tab&gt;</code> などの振る舞いですね．また <code>origami.el</code> があれば，~org~ バッファ以外でもFOLD機能を使って関数を簡略表示して，注目するもの（関数など）だけを読むことが可能です．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-auto-view</span> ()
  <span style="color: #8b2252;">"Open a file with `</span><span style="color: #008b8b;">view-mode</span><span style="color: #8b2252;">'."</span>
  (<span style="color: #a020f0;">when</span> (file-exists-p buffer-file-name)
    (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">and</span> my-auto-view-regexp
               (string-match my-auto-view-regexp buffer-file-name))
      (view-mode 1))
    (<span style="color: #a020f0;">dolist</span> (dir my-auto-view-dirs)
      (<span style="color: #a020f0;">when</span> (eq 0 (string-match (expand-file-name dir) buffer-file-name))
        (view-mode 1)))))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-org-view-next-heading</span> ()
  (<span style="color: #a020f0;">interactive</span>)
  (<span style="color: #a020f0;">if</span> (<span style="color: #a020f0;">and</span> (derived-mode-p 'org-mode)
           (org-at-heading-p))
      (org-next-visible-heading 1)
    (next-line)))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-org-view-previous-heading</span> ()
  (<span style="color: #a020f0;">interactive</span>)
  (<span style="color: #a020f0;">if</span> (<span style="color: #a020f0;">and</span> (derived-mode-p 'org-mode)
           (org-at-heading-p))
      (org-previous-visible-heading 1)
    (previous-line)))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-view-tab</span> ()
  (<span style="color: #a020f0;">interactive</span>)
  (<span style="color: #a020f0;">if</span> (<span style="color: #a020f0;">and</span> (derived-mode-p 'org-mode)
           (<span style="color: #a020f0;">or</span> (org-at-heading-p)
               (org-at-property-drawer-p)))
      (<span style="color: #a020f0;">let</span> ((view-mode nil))
        (org-cycle))
    (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">origami</span> nil t)
      (origami-toggle-node (current-buffer) (point)))))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-view-shifttab</span> ()
  (<span style="color: #a020f0;">interactive</span>)
  (<span style="color: #a020f0;">if</span> (derived-mode-p 'org-mode)
      (<span style="color: #a020f0;">let</span> ((view-mode nil))
        (org-shifttab))
    (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">origami</span> nil t)
      (origami-toggle-all-nodes (current-buffer)))))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-unlock-view-mode</span> ()
  (<span style="color: #a020f0;">when</span> view-mode
    (View-exit-and-edit)))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-view-exit</span> ()
  (<span style="color: #a020f0;">interactive</span>)
  (<span style="color: #a020f0;">if</span> (use-region-p) (my-eval-region) (View-exit)))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">ad:view--enable</span> () (my-mode-line-on))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">ad:view--disable</span> () (my-mode-line-off))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">ad:switch-to-buffer</span> (<span style="color: #228b22;">&amp;rest</span> _arg)
  (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">and</span> (not view-mode)
             (member (buffer-name) my-auto-view-buffers))
    (view-mode 1)))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">&#29305;&#23450;&#12398;&#25313;&#24373;&#23376;&#12539;&#12487;&#12451;&#12524;&#12463;&#12488;&#12522;</span>
(<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">my-auto-view-regexp</span> <span style="color: #8b2252;">"\\.el.gz$</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">|</span><span style="color: #8b2252;">\\.patch$</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">|</span><span style="color: #8b2252;">\\.xml$</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">|</span><span style="color: #8b2252;">\\.gpg$</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">|</span><span style="color: #8b2252;">\\.csv$</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">|</span><span style="color: #8b2252;">\\.emacs.d/[</span><span style="color: #8b2252;">^</span><span style="color: #8b2252;">/]+/el-get</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">|</span><span style="color: #8b2252;">config"</span>)
(<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">my-auto-view-buffers</span> '(<span style="color: #8b2252;">"*Messages*"</span>))

<span style="color: #b22222;">;; </span><span style="color: #b22222;">&#29305;&#23450;&#12398;&#12487;&#12451;&#12524;&#12463;&#12488;&#12522;&#65288;&#32118;&#23550;&#12497;&#12473;&#12539;&#12507;&#12540;&#12512;&#12487;&#12451;&#12524;&#12463;&#12488;&#12522;&#20197;&#19979;&#65289;</span>
(<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">my-auto-view-dirs</span> nil)
(add-to-list 'my-auto-view-dirs <span style="color: #8b2252;">"~/devel/emacs-head/emacs/"</span>)
(add-to-list 'my-auto-view-dirs <span style="color: #8b2252;">"~/devel/git/org-mode/lisp/"</span>)
(<span style="color: #a020f0;">when</span> (eq window-system 'w32)
  (add-to-list 'my-auto-view-dirs <span style="color: #8b2252;">"c:/msys64/mingw64"</span>))

<span style="color: #b22222;">;; </span><span style="color: #b22222;">(autoload 'my-auto-view "view" nil t)</span>
(add-hook 'find-file-hook #'my-auto-view)
<span style="color: #b22222;">;; </span><span style="color: #b22222;">note: messages-buffer-mode-hook may not work</span>
(advice-add 'switch-to-buffer <span style="color: #483d8b;">:after</span> #'ad:switch-to-buffer)

(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"view"</span>
  (define-key view-mode-map (kbd <span style="color: #8b2252;">"i"</span>) 'View-exit-and-edit)
  (define-key view-mode-map (kbd <span style="color: #8b2252;">"&lt;SPC&gt;"</span>) 'ignore)
  (define-key view-mode-map (kbd <span style="color: #8b2252;">"&lt;DEL&gt;"</span>) 'ignore)
  (define-key view-mode-map (kbd <span style="color: #8b2252;">"S-SPC"</span>) 'mac-ime-toggle)
  (define-key view-mode-map (kbd <span style="color: #8b2252;">"e"</span>) 'my-view-exit)
  (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">helpful</span> nil t)
    (define-key view-mode-map (kbd <span style="color: #8b2252;">"h"</span>) 'helpful-at-point))
  (define-key view-mode-map (kbd <span style="color: #8b2252;">"f"</span>) 'forward-char)
  (define-key view-mode-map (kbd <span style="color: #8b2252;">"b"</span>) 'backward-char)
  (define-key view-mode-map (kbd <span style="color: #8b2252;">"n"</span>) 'my-org-view-next-heading)
  (define-key view-mode-map (kbd <span style="color: #8b2252;">"p"</span>) 'my-org-view-previous-heading)
  (define-key view-mode-map (kbd <span style="color: #8b2252;">"g"</span>) #'my-google-this)
  (define-key view-mode-map (kbd <span style="color: #8b2252;">"&lt;tab&gt;"</span>) 'my-view-tab)
  (define-key view-mode-map (kbd <span style="color: #8b2252;">"S-&lt;tab&gt;"</span>) 'my-view-shifttab)
  (<span style="color: #a020f0;">unless</span> my-toggle-modeline-global
    (advice-add 'view--enable <span style="color: #483d8b;">:before</span> #'ad:view--enable)
    (advice-add 'view--disable <span style="color: #483d8b;">:before</span> #'ad:view--disable)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfdeec1c5" class="outline-3">
<h3 id="orgfdeec1c5"><span class="section-number-3">5.25.</span> Web/HTMLモード&#xa0;&#xa0;&#xa0;<span class="tag"><span class="web">web</span></span></h3>
<div class="outline-text-3" id="text-orgfdeec1c5">
<p>
HTML編集をするなら <a href="http://web-mode.org/">web-mode</a> がお勧めです．古いHTMLモードを使っている方は，移行時期です．以下の <code>my-web-indent-fold</code> では， タブキーを打つたびにタグでくくられた領域を展開／非表示して整形します．Org-mode っぽい動作になりますが，操作の度にバッファに変更が加わったと判断されるので好みが分かれると思います．自動保存を有効にしているとそれほど気になりません．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-web-indent-fold</span> ()
  (<span style="color: #a020f0;">interactive</span>)
  (web-mode-fold-or-unfold)
  (web-mode-buffer-indent)
  (indent-for-tab-command))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(web-mode)
                         <span style="color: #8b2252;">"web-mode"</span> <span style="color: #8b2252;">"web mode"</span> t)
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">web-mode &#12391;&#38283;&#12367;&#12501;&#12449;&#12452;&#12523;&#12398;&#25313;&#24373;&#23376;&#12434;&#25351;&#23450;</span>
  (<span style="color: #a020f0;">push</span> '(<span style="color: #8b2252;">"\\.phtml\\'"</span> . web-mode) auto-mode-alist)
  (<span style="color: #a020f0;">push</span> '(<span style="color: #8b2252;">"\\.tpl\\.php\\'"</span> . web-mode) auto-mode-alist)
  (<span style="color: #a020f0;">push</span> '(<span style="color: #8b2252;">"\\.jsp\\'"</span> . web-mode) auto-mode-alist)
  (<span style="color: #a020f0;">push</span> '(<span style="color: #8b2252;">"\\.as[cp]x\\'"</span> . web-mode) auto-mode-alist)
  (<span style="color: #a020f0;">push</span> '(<span style="color: #8b2252;">"\\.erb\\'"</span> . web-mode) auto-mode-alist)
  (<span style="color: #a020f0;">push</span> '(<span style="color: #8b2252;">"\\.mustache\\'"</span> . web-mode) auto-mode-alist)
  (<span style="color: #a020f0;">push</span> '(<span style="color: #8b2252;">"\\.djhtml\\'"</span> . web-mode) auto-mode-alist)
  (<span style="color: #a020f0;">push</span> '(<span style="color: #8b2252;">"\\.html?\\'"</span> . web-mode) auto-mode-alist)

  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"web-mode"</span>
    (define-key web-mode-map (kbd <span style="color: #8b2252;">"S-&lt;tab&gt;"</span>) 'my-web-indent-fold)

    <span style="color: #b22222;">;; </span><span style="color: #b22222;">indent</span>
    (<span style="color: #a020f0;">setq</span> web-mode-markup-indent-offset 1)

    <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#33394;&#12398;&#35373;&#23450;</span>
    (custom-set-faces
     <span style="color: #b22222;">;; </span><span style="color: #b22222;">custom-set-faces was added by Custom.</span>
     <span style="color: #b22222;">;; </span><span style="color: #b22222;">If you edit it by hand, you could mess it up, so be careful.</span>
     <span style="color: #b22222;">;; </span><span style="color: #b22222;">Your init file should contain only one such instance.</span>
     <span style="color: #b22222;">;; </span><span style="color: #b22222;">If there is more than one, they won't work right.</span>
     '(web-mode-comment-face ((t (<span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#D9333F"</span>))))
     '(web-mode-css-at-rule-face ((t (<span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#FF7F00"</span>))))
     '(web-mode-css-pseudo-class-face ((t (<span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#FF7F00"</span>))))
     '(web-mode-css-rule-face ((t (<span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#A0D8EF"</span>))))
     '(web-mode-doctype-face ((t (<span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#82AE46"</span>))))
     '(web-mode-html-attr-name-face ((t (<span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#C97586"</span>))))
     '(web-mode-html-attr-value-face ((t (<span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#82AE46"</span>))))
     '(web-mode-html-tag-face ((t (<span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"##4682ae"</span> <span style="color: #483d8b;">:weight</span> bold))))
     '(web-mode-server-comment-face ((t (<span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#D9333F"</span>)))))))
</pre>
</div>
</div>
</div>

<div id="outline-container-orge1eeb2a1" class="outline-3">
<h3 id="orge1eeb2a1"><span class="section-number-3">5.26.</span> POモード</h3>
<div class="outline-text-3" id="text-orge1eeb2a1">
<ul class="org-ul">
<li><a href="http://www.emacswiki.org/emacs/PoMode">http://www.emacswiki.org/emacs/PoMode</a></li>
<li><a href="http://www.emacswiki.org/emacs/po-mode+.el">http://www.emacswiki.org/emacs/po-mode+.el</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;</span><span style="color: #b22222;">(autoload 'po-mode "po-mode+" nil nil)</span>
<span style="color: #b22222;">;;</span><span style="color: #b22222;">(autoload 'po-mode "po-mode" nil t)</span>
(<span style="color: #a020f0;">when</span> (autoload-if-found '(po-mode)
                         <span style="color: #8b2252;">"po-mode"</span> nil t)
  (<span style="color: #a020f0;">push</span> '(<span style="color: #8b2252;">"\\.po[tx]?\\'</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">|</span><span style="color: #8b2252;">\\.po\\$"</span> . po-mode) auto-mode-alist))
</pre>
</div>
</div>
</div>

<div id="outline-container-org58f62c66" class="outline-3">
<h3 id="org58f62c66"><span class="section-number-3">5.27.</span> Goモード</h3>
<div class="outline-text-3" id="text-org58f62c66">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(go-mode)
                         <span style="color: #8b2252;">"go-mode"</span> nil t)
  (<span style="color: #a020f0;">push</span> '(<span style="color: #8b2252;">"\\.go\\'"</span> . go-mode) auto-mode-alist))
</pre>
</div>
</div>
</div>

<div id="outline-container-orge727dabc" class="outline-3">
<h3 id="orge727dabc"><span class="section-number-3">5.28.</span> スペルチェック</h3>
<div class="outline-text-3" id="text-orge727dabc">
<p>
Built-in の ispell を使う．チェックエンジンは，aspell を利用する．そして， <code>hunspell</code> に移行した．
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">'ns</td>
<td class="org-left">sudo port install aspell aspell-dict-en</td>
</tr>

<tr>
<td class="org-left">'x32</td>
<td class="org-left">installer.exe and aspell-en from <a href="http://aspell.net/win32/">http://aspell.net/win32/</a></td>
</tr>
</tbody>
</table>

<ul class="org-ul">
<li><a href="http://qiita.com/YutakakINJO/items/2c891aff66ef45251893">英語の文章を aspell でスペルチェック - Qiita</a></li>
</ul>

<p>
コマンドラインから <code>aspell</code> を使う時は，
</p>

<div class="org-src-container">
<pre class="src src-sh">aspell -l en -c &lt;file&gt;
</pre>
</div>

<p>
とすると， <code>~/.aspell.en.pws</code> を個人辞書として暗黙的に設定し，スペルチェックをしてくれる． <code>hunspell</code> が使える環境ならば，優先して使います．さらに， <code>~/.aspell.conf</code> に，次を書いておきます．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">lang en_US
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(ispell-region ispell-complete-word)
                         <span style="color: #8b2252;">"ispell"</span> nil t)
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">This could hilde other messages from loading functions regarding org-mode.</span>
  (advice-add 'ispell-init-process <span style="color: #483d8b;">:around</span> #'ad:suppress-message)

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">Spell checking within a specified region</span>
  (global-set-key (kbd <span style="color: #8b2252;">"C-c f 7"</span>) 'ispell-region)
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#35036;&#23436;&#20505;&#35036;&#12398;&#34920;&#31034;&#65288;flyspell &#12364;&#20351;&#12360;&#12427;&#26178;&#12399;&#12381;&#12385;&#12425;&#12434;&#20778;&#20808;&#12375;&#12390; &lt;f7&gt; &#12395;&#12377;&#12427;&#65294;</span>
  (global-set-key (kbd <span style="color: #8b2252;">"&lt;f7&gt;"</span>) 'ispell-word)

  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"ispell"</span>
    (<span style="color: #a020f0;">setq</span> ispell-encoding8-command t)
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">for English and Japanese mixed</span>
    (add-to-list 'ispell-skip-region-alist '(<span style="color: #8b2252;">"[</span><span style="color: #8b2252;">^</span><span style="color: #8b2252;">\000-\377]+"</span>))
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">http://endlessparentheses.com/ispell-and-org-mode.html</span>
    (add-to-list 'ispell-skip-region-alist '(<span style="color: #8b2252;">"^#\\+begin_src"</span> . <span style="color: #8b2252;">"^#\\+end_src"</span>))
    (add-to-list 'ispell-skip-region-alist '(<span style="color: #8b2252;">"~"</span> <span style="color: #8b2252;">"~"</span>))
    (add-to-list 'ispell-skip-region-alist '(<span style="color: #8b2252;">"="</span> <span style="color: #8b2252;">"="</span>))
    (add-to-list 'ispell-skip-region-alist '(org-property-drawer-re))

    (<span style="color: #a020f0;">cond</span>
     ((executable-find <span style="color: #8b2252;">"hunspell"</span>)
      (setenv <span style="color: #8b2252;">"LC_ALL"</span> <span style="color: #8b2252;">"en_US"</span>)
      <span style="color: #b22222;">;; </span><span style="color: #b22222;">(message "--- hunspell loaded.")</span>
      <span style="color: #b22222;">;; </span><span style="color: #b22222;">(setenv "DICPATH" "/Applications/LibreOffice.app/Contents/Resources/extensions/dict-en")</span>
      (setenv <span style="color: #8b2252;">"DICPATH"</span> (concat (getenv <span style="color: #8b2252;">"SYNCROOT"</span>) <span style="color: #8b2252;">"/emacs.d/hunspell/dict-en"</span>))
      (<span style="color: #a020f0;">setq</span> ispell-local-dictionary-alist
            '((<span style="color: #8b2252;">"ja_JP"</span> <span style="color: #8b2252;">"[[:alpha:]]"</span> <span style="color: #8b2252;">"[</span><span style="color: #8b2252;">^</span><span style="color: #8b2252;">[:alpha:]]"</span> <span style="color: #8b2252;">"[']"</span> nil
               (<span style="color: #8b2252;">"-d"</span> <span style="color: #8b2252;">"en_US"</span>) nil utf-8)
              (<span style="color: #8b2252;">"en_US"</span> <span style="color: #8b2252;">"[[:alpha:]]"</span> <span style="color: #8b2252;">"[</span><span style="color: #8b2252;">^</span><span style="color: #8b2252;">[:alpha:]]"</span> <span style="color: #8b2252;">"[']"</span> nil
               (<span style="color: #8b2252;">"-d"</span> <span style="color: #8b2252;">"en_US"</span>) nil utf-8)))
      (<span style="color: #a020f0;">setq</span> ispell-local-dictionary <span style="color: #8b2252;">"en_US"</span>)
      (<span style="color: #a020f0;">setq</span> ispell-dictionary ispell-local-dictionary)
      (<span style="color: #a020f0;">setq</span> ispell-hunspell-dictionary-alist ispell-local-dictionary-alist)
      (<span style="color: #a020f0;">if</span> shutup-p
          <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#24517;&#35201;&#65294;&#12375;&#12363;&#12418; ispell-program-name &#25351;&#23450;&#12398;&#21069;&#12391;&#65294;</span>
          <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#12383;&#12384;&#12375;&#65292;ispell-local-dictionary-alist &#12398;&#24460;&#12391;&#65294;</span>
          (shut-up (ispell-change-dictionary <span style="color: #8b2252;">"en_US"</span> t))
        (ispell-change-dictionary <span style="color: #8b2252;">"en_US"</span> t))
      (<span style="color: #a020f0;">setq-default</span> ispell-program-name (executable-find <span style="color: #8b2252;">"hunspell"</span>))
      <span style="color: #b22222;">;; </span><span style="color: #b22222;">Not regal way, but it's OK (usually ispell-local-dictionary-alist)</span>

      (<span style="color: #a020f0;">setq</span> ispell-personal-dictionary
            (concat (getenv <span style="color: #8b2252;">"SYNCROOT"</span>) <span style="color: #8b2252;">"/emacs.d/.hunspell.en.dic"</span>)))

     ((executable-find <span style="color: #8b2252;">"aspell"</span>)
      <span style="color: #b22222;">;; </span><span style="color: #b22222;">(message "--- aspell loaded.")</span>
      (<span style="color: #a020f0;">setq-default</span> ispell-program-name <span style="color: #8b2252;">"aspell"</span>)
      <span style="color: #b22222;">;; </span><span style="color: #b22222;">(when (eq window-system 'w32)</span>
      <span style="color: #b22222;">;;   </span><span style="color: #b22222;">(setq-default ispell-program-name</span>
      <span style="color: #b22222;">;;                 </span><span style="color: #b22222;">"C:/Program Files/Aspell/bin/aspell.exe"))</span>
      (<span style="color: #a020f0;">setq</span> ispell-dictionary <span style="color: #8b2252;">"english"</span>)
      <span style="color: #b22222;">;; </span><span style="color: #b22222;">This will also avoid an IM-OFF issue for flyspell-mode.</span>
      <span style="color: #b22222;">;; </span><span style="color: #b22222;">(setq ispell-aspell-supports-utf8 t) ;; Obsolete</span>
      (<span style="color: #a020f0;">setq</span> ispell-local-dictionary-alist
            '((nil <span style="color: #8b2252;">"[a-zA-Z]"</span> <span style="color: #8b2252;">"[</span><span style="color: #8b2252;">^</span><span style="color: #8b2252;">a-zA-Z]"</span> <span style="color: #8b2252;">"'"</span> t
                   (<span style="color: #8b2252;">"-d"</span> <span style="color: #8b2252;">"en"</span> <span style="color: #8b2252;">"--encoding=utf-8"</span>) nil utf-8)))
      (<span style="color: #a020f0;">setq</span> ispell-personal-dictionary
            (concat (getenv <span style="color: #8b2252;">"SYNCROOT"</span>) <span style="color: #8b2252;">"/emacs.d/config/aspell.en.pws"</span>)))
     (t
      nil))))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdd65fc08" class="outline-3">
<h3 id="orgdd65fc08"><span class="section-number-3">5.29.</span> リアルタイムスペルチェック</h3>
<div class="outline-text-3" id="text-orgdd65fc08">
<p>
Built-in の <a href="http://www.emacswiki.org/emacs/FlySpell">flyspell.el</a> を使います．flyspell は内部で <code>ispell</code> を読み込んでいるので，辞書機能自体はそちらの設定が使われます．
</p>

<p>
<a href="http://www.morishima.net/~naoto/fragments/archives/2005/12/20/flyspell/">http://www.morishima.net/~naoto/fragments/archives/2005/12/20/flyspell/</a>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-flyspell-ignore-nonascii</span> (beg end _info)
  <span style="color: #8b2252;">"incorrect&#21028;&#23450;&#12434;ASCII&#12395;&#38480;&#23450;"</span>
  (string-match <span style="color: #8b2252;">"[</span><span style="color: #8b2252;">^</span><span style="color: #8b2252;">!-~]"</span> (buffer-substring beg end)))
(add-hook 'flyspell-incorrect-hook #'my-flyspell-ignore-nonascii)

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-flyspell-on</span> ()
  (<span style="color: #a020f0;">cond</span>
   ((memq major-mode major-mode-with-flyspell)
    (turn-on-flyspell))
   ((memq major-mode major-mode-with-flyspell-prog)
    (flyspell-prog-mode))
   (t
    nil)))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-flyspell-off</span> ()
  (<span style="color: #a020f0;">when</span> (memq major-mode my-flyspell-target-modes)
    (turn-off-flyspell)))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(flyspell-mode-on
                           flyspell-prog-mode flyspell-mode
                           my-flyspell-mode-on my-flyspell-prog-mode)
                         <span style="color: #8b2252;">"flyspell"</span> nil t)
  (<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">major-mode-with-flyspell</span>
    '(text-mode change-log-mode latex-mode yatex-mode
                git-commit-mode org-mode))
  (<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">major-mode-with-flyspell-prog</span>
    '(c-mode-common emacs-lisp-mode perl-mode python-mode))
  (<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">my-flyspell-target-modes</span>
    (append major-mode-with-flyspell
            major-mode-with-flyspell-prog))

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#12496;&#12483;&#12501;&#12449;&#20869;&#12398;&#20840;&#12390;&#12434;&#12481;&#12455;&#12483;&#12463;&#23550;&#35937;&#12395;&#12377;&#12427;&#12514;&#12540;&#12489;&#12398; hook &#12395; flyspell &#36215;&#21205;&#12434;&#30331;&#37682;</span>
  (<span style="color: #a020f0;">dolist</span> (hook major-mode-with-flyspell)
    (add-hook (intern (format <span style="color: #8b2252;">"%s-hook"</span> hook)) #'flyspell-mode))

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#12467;&#12513;&#12531;&#12488;&#34892;&#12398;&#12415;&#12434;&#12481;&#12455;&#12483;&#12463;&#23550;&#35937;&#12395;&#12377;&#12427;</span>
  (<span style="color: #a020f0;">dolist</span> (hook major-mode-with-flyspell-prog)
    (add-hook (intern (format <span style="color: #8b2252;">"%s-hook"</span> hook)) #'flyspell-prog-mode))

  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"flyspell"</span>

    <span style="color: #b22222;">;; </span><span style="color: #b22222;">C-; &#12434;&#12458;&#12540;&#12496;&#12540;&#12521;&#12452;&#12489;</span>
    (define-key flyspell-mode-map (kbd <span style="color: #8b2252;">"C-;"</span>) 'comment-dwim)
    (<span style="color: #a020f0;">setq</span> flyspell-duplicate-distance 0)
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">(setq flyspell-mode-line-string " F")</span>
    (<span style="color: #a020f0;">setq</span> flyspell-mode-line-string <span style="color: #8b2252;">""</span>)
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">(setq flyspell-large-region 200)</span>
    (set-face-attribute 'flyspell-duplicate nil
                        <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#EA5506"</span> <span style="color: #483d8b;">:bold</span> t
                        <span style="color: #483d8b;">:background</span> 'unspecified <span style="color: #483d8b;">:underline</span> t)
    (set-face-attribute 'flyspell-incorrect nil
                        <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#BA2636"</span> <span style="color: #483d8b;">:bold</span> nil
                        <span style="color: #483d8b;">:background</span> 'unspecified <span style="color: #483d8b;">:underline</span> t)

    <span style="color: #b22222;">;; </span><span style="color: #b22222;">ispell-complete-word &#12398;&#12461;&#12540;&#12496;&#12452;&#12531;&#12489;&#12434;&#19978;&#26360;&#12365;</span>
    (global-set-key (kbd <span style="color: #8b2252;">"&lt;f7&gt;"</span>) 'flyspell-correct-at-point)

    <span style="color: #b22222;">;; </span><span style="color: #b22222;">ivy &#12434;&#29992;&#12356;&#12427;</span>
    (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">flyspell-correct-ivy</span> nil t)
      (<span style="color: #a020f0;">setq</span> flyspell-correct-interface #'flyspell-correct-ivy))

    <span style="color: #b22222;">;; </span><span style="color: #b22222;">Auto complete &#12392;&#12398;&#34909;&#31361;&#12434;&#22238;&#36991;</span>
    (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"auto-complete"</span>
      (ac-flyspell-workaround))

    <span style="color: #b22222;">;; </span><span style="color: #b22222;">[FIXME] nextstep+inline-patch&#29256;&#12391; flyspell &#12377;&#12427;&#12392;&#65292;&#26085;&#26412;&#35486;nyuu&#12398;&#12424;&#12358;&#12395;&#12394;&#12427;&#22580;&#21512;&#12364;&#12354;&#12427;&#12398;&#12391;&#65292;&#12381;&#12428;&#12434;&#22238;&#36991;&#65288;IME &#12364; ON&#12395;&#12394;&#12387;&#12383;&#12425;&#19968;&#26178;&#30340;&#12395; flyspell &#12434;&#27490;&#12417;&#12427;&#65289;</span>
    (add-hook 'input-method-activate-hook #'my-flyspell-off)
    (add-hook 'input-method-deactivate-hook #'my-flyspell-on)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org9317ee6f" class="outline-3">
<h3 id="org9317ee6f"><span class="section-number-3">5.30.</span> リージョン内の文字をカウントする</h3>
<div class="outline-text-3" id="text-org9317ee6f">
<p>
ビルドインの simple.el に十分な機能なのがある．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(global-set-key (kbd <span style="color: #8b2252;">"M-="</span>) 'count-words)
</pre>
</div>

<p>
以前は，<a href="http://www.emacswiki.org/emacs/WordCount">word-count.el</a> を使用していた．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(word-count-mode)
                         <span style="color: #8b2252;">"word-count"</span> <span style="color: #8b2252;">"Minor mode to count words."</span> t)
  (global-set-key (kbd <span style="color: #8b2252;">"M-="</span>) 'word-count-mode))
</pre>
</div>
</div>
</div>

<div id="outline-container-org863cfc2a" class="outline-3">
<h3 id="org863cfc2a"><span class="section-number-3">5.31.</span> 世界時計を使う</h3>
<div class="outline-text-3" id="text-org863cfc2a">
<p>
<code>M-x display-time-world</code> で表示されます．次の設定を施して， <code>shackle.el</code> と組み合わせれば，表示後に <code>q</code> 押下でウィンドウを閉じてカーソルを元のバッファに戻せます．
</p>

<p>
世界の時刻を確認するために wclock.el がありました（参考：<a href="https://pxaka.tokyo/wiki/doku.php?id=emacs">https://pxaka.tokyo/wiki/doku.php?id=emacs</a>）が，現在はビルトインの <code>time.el</code> に <code>display-time-world-mode</code> として吸収されているようです． <code>display-time-world-buffer-name</code> に wclock が設定されているところが名残と思われます．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"time"</span>
  (define-key display-time-world-mode-map <span style="color: #8b2252;">"q"</span> 'delete-window))
</pre>
</div>

<p>
<code>tz</code> の値は，システム内部 <code>/usr/share/zoneinfo</code> を見るか，<a href="https://en.wikipedia.org/wiki/List_of_tz_database_time_zones">公開情報</a>から確認できます．
</p>
</div>
</div>

<div id="outline-container-orgee372b48" class="outline-3">
<h3 id="orgee372b48"><span class="section-number-3">5.32.</span> [counsel-world-clock.el] ivy でタイムゾーンの情報を選択する</h3>
<div class="outline-text-3" id="text-orgee372b48">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(autoload-if-found '(counsel-world-clock) <span style="color: #8b2252;">"counsel-world-clock"</span> nil t)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgab4f9bf0" class="outline-3">
<h3 id="orgab4f9bf0"><span class="section-number-3">5.33.</span> [latex-math-preview.el] TeX数式をプレビュー&#xa0;&#xa0;&#xa0;<span class="tag"><span class="tex">tex</span></span></h3>
<div class="outline-text-3" id="text-orgab4f9bf0">
<ul class="org-ul">
<li><a href="https://gitlab.com/latex-math-preview/latex-math-preview/tree/775887a89447dd19541b121161cc02e9799d0d3a">Files · 775887a89447dd19541b121161cc02e9799d0d3a · latex-math-preview / Latex Math Preview · GitLab</a></li>
<li><a href="http://www.emacswiki.org/emacs/latex-math-preview.el">http://www.emacswiki.org/emacs/latex-math-preview.el</a></li>
<li><a href="http://transitive.info/software/latex-math-preview/">http://transitive.info/software/latex-math-preview/</a></li>
</ul>

<p>
以下の設定では， 数式で <code>&lt;f6&gt;</code> を押すとプレビューが走り，さらに <code>&lt;f6&gt;</code> を押すとプレビューウィンドウを閉じるように動作します．通常， <code>q</code> でプレビューを閉じられます．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(latex-math-preview-expression
                           latex-math-preview-insert-symbol
                           latex-math-preview-save-image-file
                           latex-math-preview-beamer-frame)
                         <span style="color: #8b2252;">"latex-math-preview"</span> nil t nil)
  (global-set-key (kbd <span style="color: #8b2252;">"&lt;f6&gt;"</span>) 'latex-math-preview-expression)
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"latex-math-preview"</span>
    (<span style="color: #a020f0;">setq</span> latex-math-preview-command-path-alist
          '((latex . <span style="color: #8b2252;">"latex"</span>)
            (dvipng . <span style="color: #8b2252;">"dvipng"</span>)
            (dvips . <span style="color: #8b2252;">"dvips"</span>)))
    (define-key latex-math-preview-expression-mode-map (kbd <span style="color: #8b2252;">"&lt;f6&gt;"</span>)
      'latex-math-preview-delete-buffer)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org770fb4ec" class="outline-3">
<h3 id="org770fb4ec"><span class="section-number-3">5.34.</span> [yatex.el] YaTeXでTex編集&#xa0;&#xa0;&#xa0;<span class="tag"><span class="tex">tex</span></span></h3>
<div class="outline-text-3" id="text-org770fb4ec">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(yatex-mode)
                         <span style="color: #8b2252;">"yatex"</span> <span style="color: #8b2252;">"Yet Another LaTeX mode"</span> t)
  (<span style="color: #a020f0;">push</span> '(<span style="color: #8b2252;">"\\.tex$"</span> . yatex-mode) auto-mode-alist)
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">Disable auto line break</span>
  (add-hook 'yatex-mode-hook
            (<span style="color: #a020f0;">lambda</span> ()
              (<span style="color: #a020f0;">setq</span> auto-fill-function nil)))

  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"yatex"</span>
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">1=Shift JIS, 2=JIS, 3=EUC, 4=UTF-8</span>
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">(setq YaTeX-kanji-code nil)</span>
    (modify-coding-system-alist 'file <span style="color: #8b2252;">"\\.tex$'"</span> 'utf-8)
    (define-key YaTeX-mode-map (kbd <span style="color: #8b2252;">"C-M-SPC"</span>) 'mark-sexp)
    (define-key YaTeX-mode-map (kbd <span style="color: #8b2252;">"C-M-@"</span>) 'mark-sexp)))
</pre>
</div>

<p>
ショートカットの利用を強制するメッセージが出るので，抑制します．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">ad:YaTeX-insert-begin-end</span> (env region-mode)
  <span style="color: #8b2252;">"Insert \\begin{mode-name} and \\end{mode-name}.</span>
<span style="color: #8b2252;">This works also for other defined begin/end tokens to define the structure."</span>
  (<span style="color: #a020f0;">setq</span> YaTeX-current-completion-type 'begin)
  (<span style="color: #a020f0;">let*</span>((ccol (current-column)) beg beg2 exchange
        (_arg region-mode)              <span style="color: #b22222;">;</span><span style="color: #b22222;">for old compatibility</span>
        (indent-column (+ ccol YaTeX-environment-indent))(_i 1) _func)
    (<span style="color: #a020f0;">if</span> (<span style="color: #a020f0;">and</span> region-mode (&gt; (point) (mark)))
        (<span style="color: #a020f0;">progn</span> (exchange-point-and-mark)
               (<span style="color: #a020f0;">setq</span> exchange t
                     ccol (current-column)
                     indent-column (+ ccol YaTeX-environment-indent))))
    <span style="color: #b22222;">;;</span><span style="color: #b22222;">VER2 (insert "\\begin{" env "}" (YaTeX-addin env))</span>
    (<span style="color: #a020f0;">setq</span> beg (point))
    (YaTeX-insert-struc 'begin env)
    (<span style="color: #a020f0;">setq</span> beg2 (point))
    (insert <span style="color: #8b2252;">"\n"</span>)
    (indent-to indent-column)
    (<span style="color: #a020f0;">save-excursion</span>
      <span style="color: #b22222;">;;</span><span style="color: #b22222;">indent optional argument of \begin{env}, if any</span>
      (<span style="color: #a020f0;">while</span> (&gt; (point-beginning-of-line) beg)
        (skip-chars-forward <span style="color: #8b2252;">"\\s "</span> (point-end-of-line))
        (indent-to indent-column)
        (forward-line -1)))
    (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">yatexenv</span>)
    (<span style="color: #a020f0;">if</span> region-mode
        <span style="color: #b22222;">;;</span><span style="color: #b22222;">if region-mode, indent all text in the region</span>
        (<span style="color: #a020f0;">save-excursion</span>
          (<span style="color: #a020f0;">if</span> (fboundp (intern-soft (concat <span style="color: #8b2252;">"YaTeX-enclose-"</span> env)))
              (funcall (intern-soft (concat <span style="color: #8b2252;">"YaTeX-enclose-"</span> env))
                       (point) (mark))
            (<span style="color: #a020f0;">while</span> (&lt; (<span style="color: #a020f0;">progn</span> (forward-line 1) (point)) (mark))
              (<span style="color: #a020f0;">if</span> (eolp) nil
                (skip-chars-forward <span style="color: #8b2252;">" \t\n"</span>)
                (indent-to indent-column))))))
    (<span style="color: #a020f0;">if</span> region-mode (exchange-point-and-mark))
    (indent-to ccol)
    <span style="color: #b22222;">;;</span><span style="color: #b22222;">VER2 (insert "\\end{" env "}\n")</span>
    (YaTeX-insert-struc 'end env)
    (YaTeX-reindent ccol)
    (<span style="color: #a020f0;">if</span> region-mode
        (<span style="color: #a020f0;">progn</span>
          (insert <span style="color: #8b2252;">"\n"</span>)
          (<span style="color: #a020f0;">or</span> exchange (exchange-point-and-mark)))
      (goto-char beg2)
      (YaTeX-intelligent-newline nil)
      (YaTeX-indent-line))
    (YaTeX-package-auto-usepackage env 'env)
    (<span style="color: #a020f0;">if</span> YaTeX-current-position-register
        (point-to-register YaTeX-current-position-register))))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"yatex"</span>
  (put 'YaTeX-insert-braces 'begend-guide 2)
  (advice-add 'YaTeX-insert-begin-end <span style="color: #483d8b;">:override</span> #'ad:YaTeX-insert-begin-end))
</pre>
</div>
</div>
</div>

<div id="outline-container-org9b92b6f8" class="outline-3">
<h3 id="org9b92b6f8"><span class="section-number-3">5.35.</span> [auxtex.el] AUCTEXでTex編集&#xa0;&#xa0;&#xa0;<span class="tag"><span class="tex">tex</span></span></h3>
<div class="outline-text-3" id="text-org9b92b6f8">
<p>
実践未投入です．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(autotex-latexmk)
                         <span style="color: #8b2252;">"autotex-latexmk"</span> nil t)
  (<span style="color: #a020f0;">push</span> '(<span style="color: #8b2252;">"\\.tex$"</span> . autotex-latexmk) auto-mode-alist)
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"autotex-latexmk"</span>
    (<span style="color: #a020f0;">setq-default</span> TeX-master nil)
    (<span style="color: #a020f0;">setq</span> TeX-auto-save t)
    (<span style="color: #a020f0;">setq</span> TeX-parse-self t)
    (<span style="color: #a020f0;">setq</span> TeX-PDF-mode t)
    (auctex-latexmk-setup)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org2e5c6e4f" class="outline-3">
<h3 id="org2e5c6e4f"><span class="section-number-3">5.36.</span> [yasnippet.el] Emacs用のテンプレートシステム</h3>
<div class="outline-text-3" id="text-org2e5c6e4f">
<p>
実は余り使いこなせていません&#x2026;
</p>

<ul class="org-ul">
<li><a href="https://github.com/capitaomorte/yasnippet">https://github.com/capitaomorte/yasnippet</a></li>
<li><a href="http://yasnippet-doc-jp.googlecode.com/svn/trunk/doc-jp/index.html">http://yasnippet-doc-jp.googlecode.com/svn/trunk/doc-jp/index.html</a></li>
<li><a href="http://d.hatena.ne.jp/IMAKADO/20080401/1206715770">http://d.hatena.ne.jp/IMAKADO/20080401/1206715770</a></li>
<li><a href="http://coderepos.org/share/browser/config/yasnippet">http://coderepos.org/share/browser/config/yasnippet</a></li>
<li><a href="https://github.com/RickMoynihan/yasnippet-org-mode">https://github.com/RickMoynihan/yasnippet-org-mode</a></li>
</ul>

<p>
<a href="http://orgmode.org/manual/Conflicts.html">Org-modeとの衝突を避ける</a>
</p>

<p>
↑のサイトで紹介されている回避策とは異なり，新たな <code>my-yas-expand</code> を作ることで，orgバッファのソースブロック中で <code>TAB</code> 押下してもエラーを受けないようにしました．ソースコードは <code>C-c '</code> で開く別バッファで編集します．
</p>

<p>
↑どうやら<a href="https://github.com/joaotavora/yasnippet/commit/0041efedf9f06bfe427d36547f7c4a73ab7405ba">本家で対応</a>がなされたようです． <code>my-yas-expand</code> なしで所望の動作になりました．ありがたや，ありがたや．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">late-init.el</span>
(<span style="color: #a020f0;">when</span> (autoload-if-found '(yas-minor-mode yas-global-mode)
                         <span style="color: #8b2252;">"yasnippet"</span> nil t)
  (<span style="color: #a020f0;">dolist</span> (hook
           (list
            'perl-mode-hook 'c-mode-common-hook 'js2-mode-hook 'org-mode-hook
            'python-mode-hook 'emacs-lisp-mode-hook))
    (add-hook hook #'yas-minor-mode))
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"yasnippet"</span>
    (<span style="color: #a020f0;">setq</span> yas-verbosity 2)
    (<span style="color: #a020f0;">setq</span> yas-snippet-dirs `(,(concat (getenv <span style="color: #8b2252;">"SYNCROOT"</span>) <span style="color: #8b2252;">"/emacs.d/yas-dict"</span>)))
    (<span style="color: #a020f0;">unless</span> noninteractive
      (yas-global-mode 1))))
</pre>
</div>

<p>
以下は，本家できちんと対応されたので，不要になった．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"yasnippet"</span>
  (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-yas-expand-src-edit</span> (<span style="color: #228b22;">&amp;optional</span> field)
    <span style="color: #8b2252;">"Override `</span><span style="color: #008b8b;">yas-expand</span><span style="color: #8b2252;">'. Kick `</span><span style="color: #008b8b;">org-edit-special</span><span style="color: #8b2252;">' directly in src-block."</span>
    (<span style="color: #a020f0;">interactive</span>)
    (<span style="color: #a020f0;">cond</span> ((<span style="color: #a020f0;">and</span> (equal major-mode 'org-mode)
                (org-in-src-block-p t))
           (org-edit-special))
          (t
           (yas-expand field))))

  (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-yas-expand</span> (<span style="color: #228b22;">&amp;optional</span> field)
    <span style="color: #8b2252;">"Disable `</span><span style="color: #008b8b;">yas-expand</span><span style="color: #8b2252;">' in src-block."</span>
    (<span style="color: #a020f0;">interactive</span>)
    (<span style="color: #a020f0;">cond</span> ((<span style="color: #a020f0;">and</span> (equal major-mode 'org-mode)
                (org-at-heading-p))
           (org-cycle))
          ((<span style="color: #a020f0;">and</span> (equal major-mode 'org-mode)
                (org-in-src-block-p t)
                (not (<span style="color: #a020f0;">and</span> (fboundp 'org-src-edit-buffer-p)
                          (org-src-edit-buffer-p))))
           (org-cycle))
          (t (yas-expand field))))
  (define-key yas-minor-mode-map (kbd <span style="color: #8b2252;">"&lt;tab&gt;"</span>) 'my-yas-expand))
</pre>
</div>
</div>

<div id="outline-container-org8166015d" class="outline-4">
<h4 id="org8166015d"><span class="section-number-4">5.36.1.</span> [ivy-yasnippet.el] yasnippet.el の ivy インターフェイス</h4>
<div class="outline-text-4" id="text-org8166015d">
<p>
<code>M-x ivy-yasnippet</code> でスニペットを絞り込めます．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"yasnippet"</span>
  (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">ivy-yasnippet</span> nil t))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgbea14b16" class="outline-3">
<h3 id="orgbea14b16"><span class="section-number-3">5.37.</span> [osx-dictionary.el] macOSのdictionary.appで辞書をひく</h3>
<div class="outline-text-3" id="text-orgbea14b16">
<p>
<code>osx-dictionary</code> なるパッケージが存在します．さくさくと高速に動作します．なお， <code>C-M-w</code> は，本来，削除文字の連結(<code>append-next-kill</code>)にアサインされています．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(osx-dictionary-search-pointer
                           osx-dictionary-search-input)
                         <span style="color: #8b2252;">"osx-dictionary"</span> nil t)
  (global-set-key (kbd <span style="color: #8b2252;">"C-M-w"</span>) #'osx-dictionary-search-pointer)
  (global-set-key (kbd <span style="color: #8b2252;">"C-c f w"</span>) #'osx-dictionary-search-input)
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"osx-dictionary"</span>
    (custom-set-variables
     '(osx-dictionary-dictionary-choice <span style="color: #8b2252;">"&#33521;&#36766;&#37070; &#31532;&#19971;&#29256;"</span>))))
</pre>
</div>

<p>
COBUILD5をデフォルトで使うには，次のサイト参照してください．
</p>

<ul class="org-ul">
<li><a href="http://safx-dev.blogspot.jp/2012/02/collins-cobuld-5dictionaryapp.html">Collins COBULD 5をDictionary.appで利用できるようにする</a></li>
</ul>

<p>
私の場合は，できあがった辞書を <code>/Library/Dictionaries/</code> 以下に置いています．その状態で dictionary.app の設定で辞書の優先順位を変えることで，常にCOBUILD5の情報を引っ張り出せます．もしくは， <code>osx-dictionary-dictionary-choice</code> で辞書名を指定します．
</p>
</div>
</div>

<div id="outline-container-orgca044d69" class="outline-3">
<h3 id="orgca044d69"><span class="section-number-3">5.38.</span> [describe-number.el] 16進数などを確認</h3>
<div class="outline-text-3" id="text-orgca044d69">
<p>
<code>describe-number.el</code> を使うと，16進数表示や文字コードを確認できます．
</p>

<p>
<code>math-bignum</code> が <code>calc.el</code> から削除されたため，依存している <a href="https://github.com/d5884/yabin">yabin</a> が正常動作しない．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(autoload-if-found '(describe-number describe-number-at-point)
                   <span style="color: #8b2252;">"describe-number"</span> nil t) <span style="color: #b22222;">;; </span><span style="color: #b22222;">FIXME</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org98d5c1aa" class="outline-3">
<h3 id="org98d5c1aa"><span class="section-number-3">5.39.</span> [emmet-mode.el] zencoding の後継&#xa0;&#xa0;&#xa0;<span class="tag"><span class="web">web</span></span></h3>
<div class="outline-text-3" id="text-org98d5c1aa">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">yes</span>
(<span style="color: #a020f0;">when</span> (autoload-if-found '(emmet-mode)
                         <span style="color: #8b2252;">"emmet-mode"</span> nil t nil)
  (<span style="color: #a020f0;">push</span> '(<span style="color: #8b2252;">"\\.xml\\'"</span> . nxml-mode) auto-mode-alist)
  (<span style="color: #a020f0;">push</span> '(<span style="color: #8b2252;">"\\.rdf\\'"</span> . nxml-mode) auto-mode-alist)
  (<span style="color: #a020f0;">dolist</span> (hook
           '(sgml-mode-hook
             nxml-mode-hook css-mode-hook html-mode-hook web-mode-hook))
    (add-hook hook #'emmet-mode))
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"emmet-mode"</span>
    (<span style="color: #a020f0;">setq</span> emmet-indentation 2)
    (<span style="color: #a020f0;">setq</span> emmet-move-cursor-between-quotes t)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc885e502" class="outline-3">
<h3 id="orgc885e502"><span class="section-number-3">5.40.</span> [web-beautify.el] ソースコード整形&#xa0;&#xa0;&#xa0;<span class="tag"><span class="web">web</span></span></h3>
<div class="outline-text-3" id="text-orgc885e502">
<p>
ソースコードを読みやすい表示に整形します．バッファの自動時に自動で整形を実施するには， <code>after-save-hook</code> を使えばOKですね．
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">JavaScript</td>
<td class="org-left">M-x web-beautify-js</td>
</tr>

<tr>
<td class="org-left">HTML</td>
<td class="org-left">M-x web-beautify-html</td>
</tr>

<tr>
<td class="org-left">CSS</td>
<td class="org-left">M-x web-beautify-css</td>
</tr>
</tbody>
</table>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(js2-mode)
                         <span style="color: #8b2252;">"js2-mode"</span> nil t)
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"js2-mode"</span>
    (<span style="color: #a020f0;">if</span> (executable-find <span style="color: #8b2252;">"js-beautify"</span>)
        (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">web-beautify</span> nil t)
          (define-key js2-mode-map (kbd <span style="color: #8b2252;">"C-c b"</span>) 'web-beautify-js)
          (define-key js2-mode-map (kbd <span style="color: #8b2252;">"C-c b"</span>) 'web-beautify-css))
      (message <span style="color: #8b2252;">"--- js-beautify is NOT installed."</span>)
      (message <span style="color: #8b2252;">"--- Note: npm -g install js-beautify"</span>))))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc3ce60f5" class="outline-3">
<h3 id="orgc3ce60f5"><span class="section-number-3">5.41.</span> [smartparens.el] 対応するカッコの挿入をアシスト</h3>
<div class="outline-text-3" id="text-orgc3ce60f5">
<ul class="org-ul">
<li><a href="http://smartparens.readthedocs.io/">http://smartparens.readthedocs.io/</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-smartparens-mode</span> ()
  (smartparens-global-mode)
  (remove-hook 'yatex-mode-hook #'my-smartparens-mode)
  (remove-hook 'org-mode-hook #'my-smartparens-mode))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(smartparens-global-mode
                           turn-on-show-smartparens-mode)
                         <span style="color: #8b2252;">"smartparens"</span> nil t)
  (add-hook 'yatex-mode-hook #'my-smartparens-mode)
  (add-hook 'org-mode-hook #'my-smartparens-mode)
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"smartparens"</span>
    (<span style="color: #a020f0;">setq-default</span> sp-highlight-pair-overlay nil)
    (<span style="color: #a020f0;">setq-default</span> sp-highlight-wrap-overlay nil)
    (<span style="color: #a020f0;">setq-default</span> sp-highlight-wrap-tag-overlay nil)
    (sp-pair <span style="color: #8b2252;">"`"</span> nil <span style="color: #483d8b;">:actions</span> <span style="color: #483d8b;">:rem</span>)
    (sp-pair <span style="color: #8b2252;">"'"</span> nil <span style="color: #483d8b;">:actions</span> <span style="color: #483d8b;">:rem</span>)
    (sp-pair <span style="color: #8b2252;">"["</span> nil <span style="color: #483d8b;">:actions</span> <span style="color: #483d8b;">:rem</span>)
    (sp-local-pair 'org-mode <span style="color: #8b2252;">"="</span> <span style="color: #8b2252;">"="</span>)
    (sp-local-pair 'org-mode <span style="color: #8b2252;">"_"</span> <span style="color: #8b2252;">"_"</span>)
    (sp-local-pair 'org-mode <span style="color: #8b2252;">"$"</span> <span style="color: #8b2252;">"$"</span>)
    (sp-local-pair 'org-mode <span style="color: #8b2252;">"~"</span> <span style="color: #8b2252;">"~"</span>)
    (sp-local-pair 'org-mode <span style="color: #8b2252;">"["</span> <span style="color: #8b2252;">"]"</span> <span style="color: #483d8b;">:actions</span> '(wrap)) <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#36984;&#25246;&#26178;&#12398;&#12415;&#26377;&#21177;</span>
    <span style="color: #b22222;">;;</span><span style="color: #b22222;">(sp-local-pair 'org-mode "+" "+")</span>
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">(sp-local-pair 'org-mode "/" "/")</span>
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">(sp-local-pair 'org-mode "*" "*")</span>
    (sp-local-pair 'yatex-mode <span style="color: #8b2252;">"$"</span> <span style="color: #8b2252;">"$"</span> <span style="color: #483d8b;">:actions</span> '(wrap))))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgcbb87f41" class="outline-3">
<h3 id="orgcbb87f41"><span class="section-number-3">5.42.</span> <span class="todo TODO">TODO</span> [grugru.el] 所定のキーワードをサイクルさせる</h3>
<div class="outline-text-3" id="text-orgcbb87f41">
<p>
入力する候補が決まっているキーワード群について，それらをサイクルさせるようにするパッケージです．例えば， <code>nil</code>, <code>t</code> を高速に切り替えられるようになります．
</p>

<ul class="org-ul">
<li><a href="https://github.com/ROCKTAKEY/grugru">https://github.com/ROCKTAKEY/grugru</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(grugru-default grugru)
                         <span style="color: #8b2252;">"grugru-default"</span> nil t)
  (global-set-key (kbd <span style="color: #8b2252;">"C-9"</span>) #'grugru)
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"grugru-default"</span>
    (custom-set-faces
     '(grugru-edit-completing-function #'ivy-completing-read)
     '(grugru-highlight-face ((t (<span style="color: #483d8b;">:bold</span> t <span style="color: #483d8b;">:underline</span> <span style="color: #8b2252;">"#FF3333"</span>))))
     '(grugru-highlight-idle-delay 1))

    (add-hook 'grugru-before-hook #'my-unlock-view-mode)
    (add-hook 'grugru-after-hook #'save-buffer)
    (add-hook 'ah-after-move-cursor-hook #'grugru--highlight-remove)
    (grugru-define-on-major-mode 'org-mode 'word '(<span style="color: #8b2252;">"TODO"</span> <span style="color: #8b2252;">"DONE"</span>))
    (grugru-define-global 'word '(<span style="color: #8b2252;">"True"</span> <span style="color: #8b2252;">"False"</span>))
    (grugru-define-global 'word '(<span style="color: #8b2252;">"TRUE"</span> <span style="color: #8b2252;">"FALSE"</span>)) <span style="color: #b22222;">;; </span><span style="color: #b22222;">FIXME</span>
    (grugru-default-setup)
    (grugru-find-function-integration-mode 1)
    (grugru-highlight-mode 1)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org69748b72" class="outline-3">
<h3 id="org69748b72"><span class="section-number-3">5.43.</span> [replace-from-region.el] 選択領域を別の文字列に置き換える</h3>
<div class="outline-text-3" id="text-org69748b72">
<p>
通常の <code>query-replace</code> は，変更前と変更後の文字列を両方入力しますが， <code>query-replace-from-region</code> は，変更前の文字列を選択領域から自動抽出し，さらに同じ単語を変更後の文字列の候補として事前入力してくれます．したがって，文字列選択， <code>query-replace-from-region</code> 呼び出し，文字列を一部変更，実行，というフローになり簡略化されます．さらに， <code>selected.el</code> を使うことで，文字列選択後の <code>query-replace-from-region</code> 呼び出しは，シングルキーの押下で実現できます（私の場合は <code>5</code> の押下）．
</p>

<p>
文字列選択は， <code>C-M-SPC</code> で簡単にできるので，つまり， <code>C-M-SPC</code>, <code>5</code> , 文字列を一部変更，実行となり，通常の <code>query-replace</code> よりもタイプ量を圧倒的に減らせます．
</p>

<p>
<code>iedit.el</code> の方が好みの人が多いかもしれません．
</p>

<ul class="org-ul">
<li><a href="https://www.emacswiki.org/emacs/replace-from-region.el">https://www.emacswiki.org/emacs/replace-from-region.el</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(autoload-if-found '(query-replace-from-region query-replace-regexp-from-region)
                   <span style="color: #8b2252;">"replace-from-region"</span> nil t)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbc8501cf" class="outline-3">
<h3 id="orgbc8501cf"><span class="section-number-3">5.44.</span> [selected.el] リージョン選択時のアクションを制御</h3>
<div class="outline-text-3" id="text-orgbc8501cf">
<p>
選択した後に右クリック的な感じでリージョンに対するアクションを制御できます．選択領域に対するスピードコマンドですね．普通にシングルキーを割り当てると，日本語IMEが有効な時に上手くいかないので， <code>activate-mark-hook</code> と <code>deactivate-mark-hook</code> に細工しています．
</p>

<ul class="org-ul">
<li><a href="https://github.com/Kungsgeten/selected.el">Kungsgeten/selected.el: Keymap for when region is active</a></li>
<li><a href="https://www.reddit.com/r/emacs/comments/4fxnss/selectedel_keymap_for_when_region_is_active/">selected.el - Keymap for when region is active : emacs</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(autoload-if-found '(embark-act) <span style="color: #8b2252;">"embark"</span> nil t)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-activate-selected</span> ()
  (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">transient</span> nil t)
  (selected-global-mode 1)
  (selected--on) <span style="color: #b22222;">;; </span><span style="color: #b22222;">must call expclitly here</span>
  (remove-hook 'activate-mark-hook #'my-activate-selected))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-helpful-variable</span> ()
  (<span style="color: #a020f0;">interactive</span>)
  (<span style="color: #a020f0;">let</span> ((thing (symbol-at-point)))
    (<span style="color: #a020f0;">if</span> (helpful--variable-p thing)
        (helpful-variable thing)
      (call-interactively 'helpful-variable))))

(<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">my-eval-result</span> <span style="color: #8b2252;">"*eval-result*"</span>)

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-eval-region</span> ()
  (<span style="color: #a020f0;">interactive</span>)
  (<span style="color: #a020f0;">when</span> (use-region-p)
    (eval-region (region-beginning) (region-end)
                 (get-buffer-create my-eval-result))
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">Copy the result to kill-ring and print it</span>
    (<span style="color: #a020f0;">with-current-buffer</span> (get-buffer-create my-eval-result)
      (delete-char -1)
      (goto-char (point-min))
      (delete-blank-lines)
      (mark-whole-buffer)
      (kill-ring-save (point-min) (point-max))
      (message <span style="color: #8b2252;">"%s"</span> (car kill-ring))
      (erase-buffer))
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">Jump to the end of the region</span>
    (goto-char (max (<span style="color: #a020f0;">or</span> (mark) 0) (point)))
    (deactivate-mark)))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-eval-region-as-function</span> ()
  (<span style="color: #a020f0;">interactive</span>)
  (<span style="color: #a020f0;">when</span> (use-region-p)
    (<span style="color: #a020f0;">let</span> ((region (intern (buffer-substring-no-properties
                           (region-beginning) (region-end)))))
      (funcall region))))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-describe-selected-keymap</span> ()
  (<span style="color: #a020f0;">interactive</span>)
  (describe-keymap 'selected-keymap))

</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(selected-global-mode)
                         <span style="color: #8b2252;">"selected"</span> nil t)
  (add-hook 'activate-mark-hook #'my-activate-selected)
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"selected"</span>
    (define-key selected-keymap (kbd <span style="color: #8b2252;">"a"</span>) #'embark-act)
    (define-key selected-keymap (kbd <span style="color: #8b2252;">";"</span>) #'comment-dwim)
    (define-key selected-keymap (kbd <span style="color: #8b2252;">"e"</span>) #'my-eval-region)
    (define-key selected-keymap (kbd <span style="color: #8b2252;">"E"</span>) #'my-eval-region-as-function)
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">(define-key selected-keymap (kbd "=") #'count-words-region)</span>
    (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">helpful</span> nil t)
      (define-key selected-keymap (kbd <span style="color: #8b2252;">"h"</span>) #'helpful-at-point)
      (define-key selected-keymap (kbd <span style="color: #8b2252;">"v"</span>) #'my-helpful-variable))
    (define-key selected-keymap (kbd <span style="color: #8b2252;">"w"</span>) #'osx-dictionary-search-pointer)
    (define-key selected-keymap (kbd <span style="color: #8b2252;">"d"</span>) #'osx-dictionary-search-pointer)
    (define-key selected-keymap (kbd <span style="color: #8b2252;">"5"</span>) #'query-replace-from-region)
    (define-key selected-keymap (kbd <span style="color: #8b2252;">"g"</span>) #'my-google-this)
    (define-key selected-keymap (kbd <span style="color: #8b2252;">"s"</span>) #'osx-lib-say-region)
    (define-key selected-keymap (kbd <span style="color: #8b2252;">"q"</span>) #'selected-off)
    (define-key selected-keymap (kbd <span style="color: #8b2252;">"x"</span>) #'my-hex-to-decimal)
    (define-key selected-keymap (kbd <span style="color: #8b2252;">"X"</span>) #'my-decimal-to-hex)

    <span style="color: #b22222;">;; </span><span style="color: #b22222;">(defun my-eval-region ()</span>
    <span style="color: #b22222;">;;   </span><span style="color: #b22222;">(interactive)</span>
    <span style="color: #b22222;">;;   </span><span style="color: #b22222;">(when (use-region-p)</span>
    <span style="color: #b22222;">;;     </span><span style="color: #b22222;">(eval-region (region-beginning) (region-end) t)))</span>

    (<span style="color: #a020f0;">setq</span> selected-org-mode-map (make-sparse-keymap))
    (define-key selected-org-mode-map (kbd <span style="color: #8b2252;">"t"</span>) #'org-toggle-checkbox)
    (define-key selected-org-mode-map (kbd <span style="color: #8b2252;">"-"</span>) #'my-org-bullet-and-checkbox)

    (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">expand-region</span> nil t)
      (define-key selected-keymap (kbd <span style="color: #8b2252;">"SPC"</span>) #'er/expand-region))

    (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">counsel-selected</span> nil t)
      (define-key selected-keymap (kbd <span style="color: #8b2252;">"l"</span>) 'counsel-selected))

    (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">help-fns+</span> nil t)
      (define-key selected-keymap (kbd <span style="color: #8b2252;">"H"</span>) #'my-describe-selected-keymap))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org98897862" class="outline-3">
<h3 id="org98897862"><span class="section-number-3">5.45.</span> [helm-selected.el] selecte.el のアクション候補を絞り込み</h3>
<div class="outline-text-3" id="text-org98897862">
<ul class="org-ul">
<li><a href="https://qiita.com/takaxp/items/00245794d46c3a5fcaa8">記事</a>にしました．</li>
<li><a href="https://github.com/takaxp/counsel-selected">counsel-selected</a> に移行しました．</li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"selected"</span>
  (<span style="color: #a020f0;">when</span> (autoload-if-found '(helm-selected)
                           <span style="color: #8b2252;">"helm-selected"</span> nil t)
    (define-key selected-keymap (kbd <span style="color: #8b2252;">"h"</span>) 'helm-selected)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgeafa82dd" class="outline-3">
<h3 id="orgeafa82dd"><span class="section-number-3">5.46.</span> [counsel-selected.el] 続・selected.el のアクション候補絞り込み</h3>
<div class="outline-text-3" id="text-orgeafa82dd">
<p>
<code>ivy</code> でも絞り込めるように拡張を作りました．
</p>

<ul class="org-ul">
<li><a href="https://github.com/takaxp/counsel-selected">https://github.com/takaxp/counsel-selected</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"selected"</span>
  (<span style="color: #a020f0;">when</span> (autoload-if-found '(counsel-selected)
                           <span style="color: #8b2252;">"counsel-selected"</span> nil t)
    (define-key selected-keymap (kbd <span style="color: #8b2252;">"l"</span>) 'counsel-selected)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org9e3510c2" class="outline-3">
<h3 id="org9e3510c2"><span class="section-number-3">5.47.</span> <span class="todo TODO">TODO</span> [multiple-cursors.el] 指定箇所を同時編集</h3>
<div class="outline-text-3" id="text-org9e3510c2">
<ul class="org-ul">
<li><a href="http://emacsrocks.com/e08.html">http://emacsrocks.com/e08.html</a></li>
<li><a href="https://github.com/magnars/multiple-cursors.el">magnars/multiple-cursors.el: Multiple cursors for emacs.</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">late-init.el</span>
(<span style="color: #a020f0;">when</span> (autoload-if-found '(mc/num-cursors
                           mc/edit-lines
                           hydra-multi-cursors/body)
                         <span style="color: #8b2252;">"multiple-cursors"</span> nil t)
  (global-set-key (kbd <span style="color: #8b2252;">"C-c h m"</span>) #'hydra-multi-cursors/body)
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"multiple-cursors"</span>
    (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">hydra</span> nil t)
      <span style="color: #b22222;">;; </span><span style="color: #b22222;">see https://github.com/abo-abo/hydra/wiki/multiple-cursors</span>
      (defhydra hydra-multi-cursors (<span style="color: #483d8b;">:hint</span> nil)
        <span style="color: #8b2252;">"</span>
<span style="color: #8b2252;">==================================================================</span>
<span style="color: #8b2252;"> Up^^             Down^^           Miscellaneous           % 2(mc/num-cursors) cursor%s(if (&gt; (mc/num-cursors) 1) \"s\" \"\")</span>
<span style="color: #8b2252;">------------------------------------------------------------------</span>
<span style="color: #8b2252;"> [_p_]   Next     [_n_]   Next     [_l_] Edit lines  [_0_] Insert numbers</span>
<span style="color: #8b2252;"> [_P_]   Skip     [_N_]   Skip     [_a_] Mark all    [_A_] Insert letters</span>
<span style="color: #8b2252;"> [_M-p_] Unmark   [_M-n_] Unmark   [_s_] Search</span>
<span style="color: #8b2252;"> [Click] Cursor at point       [_q_] Quit"</span>
        (<span style="color: #8b2252;">"l"</span> mc/edit-lines) <span style="color: #b22222;">;;  </span><span style="color: #b22222;">:exit t</span>
        (<span style="color: #8b2252;">"a"</span> mc/mark-all-like-this) <span style="color: #b22222;">;;  </span><span style="color: #b22222;">:exit t</span>
        (<span style="color: #8b2252;">"n"</span> mc/mark-next-like-this)
        (<span style="color: #8b2252;">"N"</span> mc/skip-to-next-like-this)
        (<span style="color: #8b2252;">"M-n"</span> mc/unmark-next-like-this)
        (<span style="color: #8b2252;">"p"</span> mc/mark-previous-like-this)
        (<span style="color: #8b2252;">"P"</span> mc/skip-to-previous-like-this)
        (<span style="color: #8b2252;">"M-p"</span> mc/unmark-previous-like-this)
        (<span style="color: #8b2252;">"s"</span> mc/mark-all-in-region-regexp) <span style="color: #b22222;">;;  </span><span style="color: #b22222;">:exit t</span>
        (<span style="color: #8b2252;">"0"</span> mc/insert-numbers) <span style="color: #b22222;">;;  </span><span style="color: #b22222;">:exit t</span>
        (<span style="color: #8b2252;">"A"</span> mc/insert-letters) <span style="color: #b22222;">;;  </span><span style="color: #b22222;">:exit t</span>
        (<span style="color: #8b2252;">"&lt;mouse-1&gt;"</span> mc/add-cursor-on-click)
        <span style="color: #b22222;">;; </span><span style="color: #b22222;">Help with click recognition in this hydra</span>
        (<span style="color: #8b2252;">"&lt;down-mouse-1&gt;"</span> ignore)
        (<span style="color: #8b2252;">"&lt;drag-mouse-1&gt;"</span> ignore)
        (<span style="color: #8b2252;">"q"</span> nil)))))
</pre>
</div>
</div>
</div>

<div id="outline-container-orge18cb840" class="outline-3">
<h3 id="orge18cb840"><span class="section-number-3">5.48.</span> <span class="todo TODO">TODO</span> [isolate.el] ブラケット等の入力をアシスト</h3>
<div class="outline-text-3" id="text-orge18cb840">
<ul class="org-ul">
<li><a href="https://github.com/casouri/isolate">casouri/isolate: Surrounding magics, extensible</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">late-init.el</span>
(autoload-if-found '(isolate-quick-add
                     isolate-long-add isolate-quick-delete
                     isolate-quick-chnge isolate-long-change)
                   <span style="color: #8b2252;">"isolate"</span> nil t)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc6f37d6d" class="outline-3">
<h3 id="orgc6f37d6d"><span class="section-number-3">5.49.</span> <span class="todo TODO">TODO</span> [git-complete.el] GIT grep を使う補完エンジン</h3>
<div class="outline-text-3" id="text-orgc6f37d6d">
<ul class="org-ul">
<li><a href="https://github.com/zk-phi/git-complete">zk-phi/git-complete: {Emacs} Yet another completion engine powered by "git grep"</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(git-complete)
                         <span style="color: #8b2252;">"git-complete"</span> nil t)
  (global-set-key (kbd <span style="color: #8b2252;">"C-c f &lt;tab&gt;"</span>) 'git-complete))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgab8a7bee" class="outline-3">
<h3 id="orgab8a7bee"><span class="section-number-3">5.50.</span> <span class="todo TODO">TODO</span> [tiny.el] 連番入力をサポート</h3>
<div class="outline-text-3" id="text-orgab8a7bee">
<ul class="org-ul">
<li><a href="https://github.com/abo-abo/tiny">abo-abo/tiny: Quickly generate linear ranges in Emacs</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">tiny</span> nil t)
  (tiny-setup-default))
</pre>
</div>
</div>
</div>

<div id="outline-container-org12a087af" class="outline-3">
<h3 id="org12a087af"><span class="section-number-3">5.51.</span> <span class="todo TODO">TODO</span> [bratex.el] LaTeX 数式のブラケット入力をサポート</h3>
<div class="outline-text-3" id="text-org12a087af">
<ul class="org-ul">
<li><a href="https://github.com/sbrisard/bratex">sbrisard/bratex: Emacs package for manipulation of brackets in LaTeX mode</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(bratex-config)
                         <span style="color: #8b2252;">"bratex"</span> nil t)
  (add-hook 'yatex-mode-hook #'bratex-config))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb3d87116" class="outline-3">
<h3 id="orgb3d87116"><span class="section-number-3">5.52.</span> <span class="done DONE">DONE</span> [iedit.el] バッファ内の同じ文字列を一度に編集する&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></h3>
<div class="outline-text-3" id="text-orgb3d87116">
<p>
<code>replace-from-region.el</code> を <code>selected.el</code> で呼び出すので満足しています．表示色の点では， <code>highlight-symbol.el</code> があるので，今からどれが編集されるのかもわかりやすいです．
</p>

<p>
<a href="http://emacswiki.org/emacs/iedit.el">iedit.el</a> を使うと，バッファ内の同じ文字列を一度に編集することができる．部分重複のない変数名を置き換えるときに有用な場合がある．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">iedit</span> nil t)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf18160de" class="outline-3">
<h3 id="orgf18160de"><span class="section-number-3">5.53.</span> <span class="done DONE">DONE</span> [lookup.el] 辞書&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></h3>
<div class="outline-text-3" id="text-orgf18160de">
<p>
最近使っていません．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">.lookup/cache.el</span>
(<span style="color: #a020f0;">setq</span> lookup-init-directory <span style="color: #8b2252;">"~/env/dot_files/.lookup"</span>)

(autoload 'lookup <span style="color: #8b2252;">"lookup"</span> nil t)
(autoload 'lookup-region <span style="color: #8b2252;">"lookup"</span> nil t)
(autoload 'lookup-word <span style="color: #8b2252;">"lookup"</span> nil t)
(autoload 'lookup-select-dictionaries <span style="color: #8b2252;">"lookup"</span> nil t)

(<span style="color: #a020f0;">setq</span> lookup-search-modules
      '((<span style="color: #8b2252;">"default"</span>
         (<span style="color: #8b2252;">"ndeb:/Users/taka/Dropbox/Dic/COBUILD5/cobuild"</span> <span style="color: #483d8b;">:priority</span> t)
         (<span style="color: #8b2252;">"ndeb:/Users/taka/Dropbox/Dic/COBUILD5/wordbank"</span> <span style="color: #483d8b;">:priority</span> t)
         (<span style="color: #8b2252;">"ndeb:/Users/taka/Dropbox/Dic/LDOCE4/ldoce4"</span> <span style="color: #483d8b;">:priority</span> t)
         (<span style="color: #8b2252;">"ndeb:/Users/taka/Dropbox/Dic/LDOCE4/bank"</span> <span style="color: #483d8b;">:priority</span> t)
         (<span style="color: #8b2252;">"ndeb:/Users/taka/Dropbox/Dic/LDOCE4/colloc"</span> <span style="color: #483d8b;">:priority</span> t)
         (<span style="color: #8b2252;">"ndeb:/Users/taka/Dropbox/Dic/LDOCE4/activ"</span> <span style="color: #483d8b;">:priority</span> t))))

(<span style="color: #a020f0;">setq</span> lookup-agent-attributes
      '((<span style="color: #8b2252;">"ndeb:/Users/taka/Dropbox/Dic/COBUILD5"</span>
         (dictionaries <span style="color: #8b2252;">"cobuild"</span> <span style="color: #8b2252;">"wordbank"</span>))
        (<span style="color: #8b2252;">"ndeb:/Users/taka/Dropbox/Dic/LDOCE4"</span>
         (dictionaries <span style="color: #8b2252;">"ldoce4"</span> <span style="color: #8b2252;">"bank"</span> <span style="color: #8b2252;">"colloc"</span> <span style="color: #8b2252;">"activ"</span>))))

(<span style="color: #a020f0;">setq</span> lookup-dictionary-attributes
      '((<span style="color: #8b2252;">"ndeb:/Users/taka/Dropbox/Dic/COBUILD5/cobuild"</span>
         (title . <span style="color: #8b2252;">"COBUILD 5th Edition"</span>)
         (methods exact prefix))
        (<span style="color: #8b2252;">"ndeb:/Users/taka/Dropbox/Dic/COBUILD5/wordbank"</span>
         (title . <span style="color: #8b2252;">"Wordbank"</span>)
         (methods))
        (<span style="color: #8b2252;">"ndeb:/Users/taka/Dropbox/Dic/LDOCE4/ldoce4"</span>
         (title . <span style="color: #8b2252;">"Longman 4th Edition"</span>)
         (methods exact prefix))
        (<span style="color: #8b2252;">"ndeb:/Users/taka/Dropbox/Dic/LDOCE4/bank"</span>
         (title . <span style="color: #8b2252;">"LDOCE4 Examples and Phrases"</span>)
         (methods exact prefix menu))
        (<span style="color: #8b2252;">"ndeb:/Users/taka/Dropbox/Dic/LDOCE4/colloc"</span>
         (title . <span style="color: #8b2252;">"LDOCE4 Collocation"</span>)
         (methods exact prefix))
        (<span style="color: #8b2252;">"ndeb:/Users/taka/Dropbox/Dic/LDOCE4/activ"</span>
         (title . <span style="color: #8b2252;">"Longman Activator"</span>)
         (methods exact prefix menu))))

(<span style="color: #a020f0;">setq</span> lookup-default-dictionary-options
      '((<span style="color: #483d8b;">:stemmer</span> .  stem-english)))
(<span style="color: #a020f0;">setq</span> lookup-use-kakasi nil)
(global-set-key (kbd <span style="color: #8b2252;">"&lt;f6&gt;"</span>) 'lookup-word)

<span style="color: #b22222;">;;; </span><span style="color: #b22222;">lookup for dictionary (require EB Library, eblook, and lookup.el)</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">package download: http://sourceforge.net/projects/lookup</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">http://lookup.sourceforge.net/docs/ja/index.shtml#Top</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">http://www.bookshelf.jp/texi/lookup/lookup-guide.html#SEC_Top</span>
<span style="color: #b22222;">;;</span><span style="color: #b22222;">(load "lookup-autoloads") ; for 1.99</span>
<span style="color: #b22222;">;;</span><span style="color: #b22222;">(autoload 'lookup "lookup" nil t)</span>
<span style="color: #b22222;">;;</span><span style="color: #b22222;">(autoload 'lookup-region "lookup" nil t)</span>
<span style="color: #b22222;">;;</span><span style="color: #b22222;">(autoload 'lookup-word "lookup" nil t)</span>
<span style="color: #b22222;">;;</span><span style="color: #b22222;">(autoload 'lookup-select-dictionaries "lookup" nil t)</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">Search Agents</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">ndeb option requries "eblook" command</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">Use expand-file-name!</span>
<span style="color: #b22222;">;;</span><span style="color: #b22222;">(setq lookup-search-agents `((ndeb ,(concat homedir "/Dropbox/Dic/COBUILD5"))</span>
<span style="color: #b22222;">;;                            </span><span style="color: #b22222;">(ndeb ,(concat homedir "/Dropbox/Dic/LDOCE4"))))</span>
<span style="color: #b22222;">;;</span><span style="color: #b22222;">(setq lookup-use-bitmap nil)</span>
<span style="color: #b22222;">;;</span><span style="color: #b22222;">(setq ndeb-program-name "/usr/bin/eblook")</span>
<span style="color: #b22222;">;;</span><span style="color: #b22222;">(when (eq window-system 'ns)</span>
<span style="color: #b22222;">;;  </span><span style="color: #b22222;">(setq ndeb-program-name "/opt/local/bin/eblook")</span>
<span style="color: #b22222;">;;  </span><span style="color: #b22222;">(setq ndeb-program-arguments '("-q" "-e" "euc-jp"))</span>
<span style="color: #b22222;">;;  </span><span style="color: #b22222;">(setq ndeb-process-coding-system 'utf-8)) ; utf-8-hfs</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org903987d3" class="outline-3">
<h3 id="org903987d3"><span class="section-number-3">5.54.</span> <span class="done DONE">DONE</span> [cacoo] Cacoo で描く&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></h3>
<div class="outline-text-3" id="text-org903987d3">
<p>
画像をリサイズしてバッファに表示する用途にも使える．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(toggle-cacoo-minor-mode)
                         <span style="color: #8b2252;">"cacoo"</span> nil t)
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"cacoo"</span>
    (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">cacoo-plugins</span>))

  (global-set-key (kbd <span style="color: #8b2252;">"M--"</span>) 'toggle-cacoo-minor-mode))
</pre>
</div>
</div>
</div>

<div id="outline-container-org56cbbb36" class="outline-3">
<h3 id="org56cbbb36"><span class="section-number-3">5.55.</span> <span class="done DONE">DONE</span> [zencoding-mode] HTML編集の高速化&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></h3>
<div class="outline-text-3" id="text-org56cbbb36">
<p>
zencoding でタグ打ちを効率化します．今は emmet-mode を使います．
</p>

<ul class="org-ul">
<li><a href="http://www.emacswiki.org/emacs/ZenCoding">http://www.emacswiki.org/emacs/ZenCoding</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(zencoding-mode zencoding-expand-line)
                         <span style="color: #8b2252;">"zencoding-mode"</span> <span style="color: #8b2252;">"Zen-coding"</span> t)
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"zencoding-mode"</span>
    (define-key zencoding-mode-keymap
      (kbd <span style="color: #8b2252;">"M-&lt;return&gt;"</span>) 'zencoding-expand-line))
  (add-hook 'sgml-mode-hook #'zencoding-mode)
  (add-hook 'html-mode-hook #'zencoding-mode)
  (add-hook 'web-mode-hook #'zencoding-mode))
</pre>
</div>
</div>
</div>

<div id="outline-container-org7e84aa55" class="outline-3">
<h3 id="org7e84aa55"><span class="section-number-3">5.56.</span> <span class="done DONE">DONE</span> [sdic.el] 英辞郎で英単語を調べる&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></h3>
<div class="outline-text-3" id="text-org7e84aa55">
<ul class="org-ul">
<li>osx-directory.el に移行しました．</li>
</ul>

<p>
<a href="http://www.namazu.org/~tsuchiya/sdic/index.html">http://www.namazu.org/~tsuchiya/sdic/index.html</a>
</p>

<p>
Emacs から辞書を使う．lookup を使う方法もあるが，Emacsから使うのは英辞郎に限定．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(sdic-describe-word sdic-describe-word-at-point)
                         <span style="color: #8b2252;">"sdic"</span> nil t)
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"sdic"</span>
    (<span style="color: #a020f0;">setq</span> sdic-face-color <span style="color: #8b2252;">"#3333FF"</span>)
    (<span style="color: #a020f0;">setq</span> sdic-default-coding-system 'utf-8)
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">Dictionary (English =&gt; Japanese)</span>
    (<span style="color: #a020f0;">setq</span> sdic-eiwa-dictionary-list
          '((sdicf-client <span style="color: #8b2252;">"~/Dropbox/Dic/EIJIRO6/EIJI-128.sdic"</span>)))
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">Dictionary (Japanese =&gt; English)</span>
    (<span style="color: #a020f0;">setq</span> sdic-waei-dictionary-list
          '((sdicf-client <span style="color: #8b2252;">"~/Dropbox/Dic/EIJIRO6/WAEI-128.sdic"</span>))))

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#12459;&#12540;&#12477;&#12523;&#12398;&#20301;&#32622;&#12398;&#33521;&#21336;&#35486;&#12398;&#24847;&#21619;&#12434;&#35519;&#12409;&#12427;</span>
  (global-set-key (kbd <span style="color: #8b2252;">"C-M-w"</span>) 'sdic-describe-word-at-point)
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#12511;&#12491;&#12496;&#12483;&#12501;&#12449;&#12395;&#33521;&#21336;&#35486;&#12434;&#20837;&#12428;&#12390;&#33521;&#36766;&#37070;&#12434;&#20351;&#12358;</span>
  (global-set-key (kbd <span style="color: #8b2252;">"C-c w"</span>) 'sdic-describe-word))
</pre>
</div>
</div>
</div>

<div id="outline-container-org52c2a77d" class="outline-3">
<h3 id="org52c2a77d"><span class="section-number-3">5.57.</span> <span class="done DONE">DONE</span> [dictionary.app] macOSのdictionary.appでCOBUILD5をひく&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></h3>
<div class="outline-text-3" id="text-org52c2a77d">
<p>
OS標準の辞書アプリ（dictionary.app）を経由して，バッファにCOBUILD5のデータを流し込むことができます．
</p>

<ul class="org-ul">
<li><a href="http://sakito.jp/mac/dictionary.html#emacs">辞書(Dictionary).appを使い倒そう</a></li>
</ul>

<p>
以下の関数を準備します．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">dictionary</span> ()
  <span style="color: #8b2252;">"dictionary.app"</span>
  (<span style="color: #a020f0;">interactive</span>)

  (<span style="color: #a020f0;">let</span> ((editable (not buffer-read-only))
        (pt (<span style="color: #a020f0;">save-excursion</span> (mouse-set-point last-nonmenu-event)))
        beg end)

    (<span style="color: #a020f0;">if</span> (<span style="color: #a020f0;">and</span> mark-active
             (&lt;= (region-beginning) pt) (&lt;= pt (region-end)) )
        (<span style="color: #a020f0;">setq</span> beg (region-beginning)
              end (region-end))
      (<span style="color: #a020f0;">save-excursion</span>
        (goto-char pt)
        (<span style="color: #a020f0;">setq</span> end (<span style="color: #a020f0;">progn</span> (forward-word) (point)))
        (<span style="color: #a020f0;">setq</span> beg (<span style="color: #a020f0;">progn</span> (backward-word) (point)))
        ))

    (<span style="color: #a020f0;">let</span> ((word (buffer-substring-no-properties beg end))
          <span style="color: #b22222;">;;            </span><span style="color: #b22222;">(win (selected-window))</span>
          (tmpbuf <span style="color: #8b2252;">" * dict-process*"</span>))
      (pop-to-buffer tmpbuf)
      (erase-buffer)
      (insert <span style="color: #8b2252;">"Query: "</span> word <span style="color: #8b2252;">"\n\n"</span>)
      (start-process <span style="color: #8b2252;">"dict-process"</span> tmpbuf <span style="color: #8b2252;">"dict.py"</span> word)
      (goto-char 0)
      <span style="color: #b22222;">;;        </span><span style="color: #b22222;">(select-window win)</span>
      )))
</pre>
</div>

<p>
これでカーソル以下の単語の情報が別ウィンドウに出ます．チェックし終わったら <code>C-x 1</code> (delete-other-windows) で表示を閉じます． <code>q</code> で閉じられるようにしたり，ツールチップで表示したりもできるはずです．
</p>

<p>
マスタカさんのナイスソリューションをまだ試していないので，こちらの方がエレガントかもしれません．
</p>

<ul class="org-ul">
<li><a href="http://masutaka.net/chalow/2011-05-18-1.html">Emacs で Mac の辞書を sdic っぽく使う </a></li>
<li><a href="http://masutaka.net/chalow/2012-09-17-1.html">EmacsからMacの辞書をお手軽に使う</a></li>
</ul>

<p>
なお，COBUILD5の辞書データをdictionary.appで引けるようにするには以下の操作が必要です．
</p>

<ul class="org-ul">
<li><a href="http://safx-dev.blogspot.jp/2012/02/collins-cobuld-5dictionaryapp.html">Collins COBULD 5をDictionary.appで利用できるようにする</a></li>
</ul>

<p>
私の場合は，できあがった辞書を <code>/Library/Dictionaries/</code> 以下に置いています．その状態で dictionary.app の設定で辞書の優先順位を変えることで，常にCOBUILD5の情報を引っ張り出せます．
</p>
</div>

<div id="outline-container-org34b20ea7" class="outline-4">
<h4 id="org34b20ea7"><span class="section-number-4">5.57.1.</span> マイナーモード化</h4>
<div class="outline-text-4" id="text-org34b20ea7">
<p>
<code>q</code> で閉じたくなったのでマイナーモードを作りました．これまで通り， <code>C-M-w</code> でカーソル下の単語を調べてポップアップで表示．カーソルはその新しいバッファに移しておき， <code>q</code> で閉じられます．新しいバッファ内で別な単語を <code>C-M-w</code> で調べると，同じバッファに結果を再描画します．
</p>

<p>
マイナーモード化した elisp は，<a href="https://gist.github.com/takaxp/9786376">gist</a>で公開しています．
</p>
</div>
</div>

<div id="outline-container-org34f10f81" class="outline-4">
<h4 id="org34f10f81"><span class="section-number-4">5.57.2.</span> キーバインド</h4>
<div class="outline-text-4" id="text-org34f10f81">
<p>
マイナーモード化した dict-app を使う場合は以下のようにします．sdic を使っている人は，sdic 用の設定と衝突しないように気をつけます．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(dict-app-search)
                         <span style="color: #8b2252;">"dict-app"</span> nil t)
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#12459;&#12540;&#12477;&#12523;&#12398;&#20301;&#32622;&#12398;&#33521;&#21336;&#35486;&#12398;&#24847;&#21619;&#12434;&#35519;&#12409;&#12427;</span>
  (global-set-key (kbd <span style="color: #8b2252;">"C-M-w"</span>) 'dict-app-search))
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-org94c7bd73" class="outline-2">
<h2 id="org94c7bd73"><span class="section-number-2">6.</span> 表示サポート</h2>
<div class="outline-text-2" id="text-org94c7bd73">
</div>
<div id="outline-container-orgf6a240ab" class="outline-3">
<h3 id="orgf6a240ab"><span class="section-number-3">6.1.</span> キーコマンド入力中に入力過程をミニバッファに反映する</h3>
<div class="outline-text-3" id="text-orgf6a240ab">
<p>
標準値は <code>1</code> です．例えば， <code>C-c f r</code> で発動する関数があるとき， <code>C-c</code> を入力するとその直後にはミニバッファに何も表示されませんが， <code>echo-keystrokes</code> だけ経過すると， <code>C-c</code> が表示されます． <code>0</code> に設定すると，いくら経過しても何も表示しません． <code>which-key.el</code> の設定で表示を <code>1.0</code> にすると，時系列的に， <code>0.5</code> 秒でキー入力の状態を表示し， <code>1.0</code> 秒で続くキーで入力可能なコマンドがリストアップ表示されます．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">setq</span> echo-keystrokes 0.5)
</pre>
</div>
</div>
</div>

<div id="outline-container-org581a32ab" class="outline-3">
<h3 id="org581a32ab"><span class="section-number-3">6.2.</span> <span class="todo TODO">TODO</span> モードラインの色をナローイングで変える</h3>
<div class="outline-text-3" id="text-org581a32ab">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-update-modeline-face</span> ()
  (<span style="color: #a020f0;">setq</span> my-selected-window-last (frame-selected-window))
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">(message "--- %s" my-selected-window-last)</span>
  (<span style="color: #a020f0;">unless</span> (minibufferp)
    (my-modeline-face (buffer-narrowed-p))))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-modeline-face</span> (buffer-narrowed)
  <span style="color: #8b2252;">"Update modeline color.</span>
<span style="color: #8b2252;">If BUFFER-NARROWED is nil, then change the color to indicating `</span><span style="color: #008b8b;">widen</span><span style="color: #8b2252;">'.</span>
<span style="color: #8b2252;">Otherwise, indicating narrowing."</span>
  (<span style="color: #a020f0;">unless</span> (eq my-buffer-narrowed-last
              buffer-narrowed) <span style="color: #b22222;">;; </span><span style="color: #b22222;">block unnecessary request</span>
    (<span style="color: #a020f0;">setq</span> my-buffer-narrowed-last buffer-narrowed)
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">(message "--- %s %s %s" this-command last-command buffer-narrowed)</span>
    (<span style="color: #a020f0;">when</span> (not (memq this-command '(save-buffer))) <span style="color: #b22222;">;; </span><span style="color: #b22222;">FIXME</span>
      (<span style="color: #a020f0;">if</span> buffer-narrowed
          (custom-set-faces
           `(mode-line ((t (<span style="color: #483d8b;">:background</span>
                            ,(nth 0 my-narrow-modeline)
                            <span style="color: #483d8b;">:foreground</span>
                            ,(nth 1 my-narrow-modeline))))))
        (custom-set-faces '(mode-line ((t nil))))))))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-update-modeline-color</span> ()
  <span style="color: #8b2252;">"Update modeline face of the current selected window.</span>
<span style="color: #8b2252;">Call this function at updating `</span><span style="color: #008b8b;">mode-line-mode</span><span style="color: #8b2252;">'."</span>
  (<span style="color: #a020f0;">when</span> (eq my-selected-window-last (frame-selected-window))
    (my-modeline-face (buffer-narrowed-p))))
</pre>
</div>


<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">my-narrow-modeline</span> '(<span style="color: #8b2252;">"#426EBB"</span> <span style="color: #8b2252;">"#FFFFFF"</span>)) <span style="color: #b22222;">;; </span><span style="color: #b22222;">background, foreground</span>
(<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">my-buffer-narrowed-last</span> nil)
(make-local-variable 'my-buffer-narrowed-last)
(<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">my-selected-window-last</span> nil)
(add-hook 'buffer-list-update-hook #'my-update-modeline-face)
</pre>
</div>
</div>
</div>

<div id="outline-container-org3368625d" class="outline-3">
<h3 id="org3368625d"><span class="section-number-3">6.3.</span> <span class="todo TODO">TODO</span> モードラインのNarrowを短くする</h3>
<div class="outline-text-3" id="text-org3368625d">
<p>
標準では「Narrow」と表示されますが，「N」に短縮します． <code>all-the-icons</code> を使って，画像に置き換えることも可能です．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">setq</span> mode-line-modes
      (mapcar
       (<span style="color: #a020f0;">lambda</span> (entry)
         (<span style="color: #a020f0;">if</span> (equal entry <span style="color: #8b2252;">"%n"</span>)
             '(<span style="color: #483d8b;">:eval</span> (<span style="color: #a020f0;">progn</span>
                       <span style="color: #b22222;">;; </span><span style="color: #b22222;">org &#12364; widen &#12434;&#20081;&#30330;&#12377;&#12427;&#12398;&#12391;&#12371;&#12385;&#12425;&#12434;&#12488;&#12522;&#12460;&#12540;&#12395;&#12377;&#12427;&#65294;</span>
                       <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#33394;&#12398;&#22793;&#26356;</span>
                       (my-update-modeline-color)
                       <span style="color: #b22222;">;; </span><span style="color: #b22222;">"Narrow" &#12434; "N" &#12395;&#30701;&#32302;&#34920;&#31034;</span>
                       (<span style="color: #a020f0;">if</span> (<span style="color: #a020f0;">and</span> (buffer-narrowed-p)
                                (fboundp 'icons-in-terminal-octicon))
                           (concat <span style="color: #8b2252;">" "</span> (icons-in-terminal-octicon
                                        <span style="color: #8b2252;">"fold"</span> <span style="color: #483d8b;">:v-adjust</span> 0.0)) <span style="color: #ff0000; font-weight: bold;">""</span><span style="color: #ff0000; font-weight: bold;">)))</span>
           entry))
       mode-line-modes))
</pre>
</div>
</div>
</div>

<div id="outline-container-org8e939aed" class="outline-3">
<h3 id="org8e939aed"><span class="section-number-3">6.4.</span> <span class="todo TODO">TODO</span> [mlscroll.el] モードラインにバッファ内表示位置をバー形式で表示</h3>
<div class="outline-text-3" id="text-org8e939aed">
<p>
<a href="https://github.com/jdtsmith/mlscroll">mlscroll.el</a> を使います．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-reload-mlscroll</span> ()
  (mlscroll-mode -1)
  (<span style="color: #a020f0;">setq</span> mlscroll-border (ceiling (/ moom-font--size 4.0)))
  (mlscroll-mode 1))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">mlscroll</span> nil t)
  (custom-set-variables
   '(mlscroll-in-color <span style="color: #8b2252;">"light coral"</span>) <span style="color: #b22222;">;;  </span><span style="color: #b22222;">#FFA07A</span>
   '(mlscroll-out-color <span style="color: #8b2252;">"#FFFFEF"</span>)
   '(mlscroll-width-chars 10))
  (mlscroll-mode 1)

  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"moom"</span>
    (add-hook 'moom-font-after-resize-hook #'my-reload-mlscroll)
    (add-hook 'moom-after-reset-hook #'my-reload-mlscroll)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org5fd3a668" class="outline-3">
<h3 id="org5fd3a668"><span class="section-number-3">6.5.</span> モードラインの節約（VC-mode編）</h3>
<div class="outline-text-3" id="text-org5fd3a668">
<p>
定形で表示されている <code>Git</code> を消します．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-mode-line-vc-mode-icon</span> ()
  (<span style="color: #a020f0;">if</span> (string-match <span style="color: #8b2252;">"^ Git:"</span> vc-mode)
      (replace-regexp-in-string
       <span style="color: #8b2252;">"^ Git:"</span> (propertize <span style="color: #8b2252;">" &#57370;"</span> 'face 'mode-line-vc-modified-face) vc-mode)
    (replace-regexp-in-string
     <span style="color: #8b2252;">"^ Git-"</span> (propertize <span style="color: #8b2252;">" &#57370;"</span> 'face 'mode-line-vc-normal-face) vc-mode)))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"vc-hooks"</span>
  (setcdr (assq 'vc-mode mode-line-format)
          '((<span style="color: #483d8b;">:eval</span> (replace-regexp-in-string <span style="color: #8b2252;">"^ Git"</span> <span style="color: #8b2252;">""</span> vc-mode)))))

(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"icons-in-terminal"</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#22793;&#26356;&#12364;&#12450;&#12522;&#26178;&#12399;&#36196;&#12450;&#12452;&#12467;&#12531;&#65292;&#12381;&#12358;&#12391;&#12394;&#12356;&#26178;&#12395;&#32209;&#12450;&#12452;&#12467;&#12531;&#12434;&#12514;&#12540;&#12489;&#12521;&#12452;&#12531;&#12395;&#34920;&#31034;</span>
  (make-face 'mode-line-vc-normal-face)
  (make-face 'mode-line-vc-modified-face)
  (set-face-attribute 'mode-line-vc-normal-face nil <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#AFFFAF"</span>)
  (set-face-attribute 'mode-line-vc-modified-face nil <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#EEAFAF"</span>)
  (setcdr (assq 'vc-mode mode-line-format)
          '((<span style="color: #483d8b;">:eval</span> (my-mode-line-vc-mode-icon)))))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb577af83" class="outline-3">
<h3 id="orgb577af83"><span class="section-number-3">6.6.</span> モードラインの色をカスタマイズする</h3>
<div class="outline-text-3" id="text-orgb577af83">
<p>
配色は定期的に変えています．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">if</span> (not (display-graphic-p))
    (<span style="color: #a020f0;">progn</span> <span style="color: #b22222;">;; </span><span style="color: #b22222;">Terminal</span>
      (set-face-foreground 'mode-line <span style="color: #8b2252;">"#96CBFE"</span>)
      (set-face-background 'mode-line <span style="color: #8b2252;">"#21252B"</span>))

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">mode-line</span>
  (set-face-attribute 'mode-line nil
                      <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#FFFFFF"</span>
                      <span style="color: #483d8b;">:background</span> <span style="color: #8b2252;">"#a46398"</span>
                      <span style="color: #b22222;">;; </span><span style="color: #b22222;">:overline "#9d5446"</span>
                      <span style="color: #483d8b;">:box</span> nil)
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">mode-line-inactive</span>
  (set-face-attribute 'mode-line-inactive nil
                      <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#FFFFFF"</span>
                      <span style="color: #483d8b;">:background</span> <span style="color: #8b2252;">"#c8a1b7"</span>
                      <span style="color: #b22222;">;; </span><span style="color: #b22222;">:overline "#FFFFFF"</span>
                      <span style="color: #483d8b;">:box</span> nil))
</pre>
</div>
</div>

<div id="outline-container-org21b30e75" class="outline-4">
<h4 id="org21b30e75"><span class="section-number-4">6.6.1.</span> 色セット例</h4>
<div class="outline-text-4" id="text-org21b30e75">
<ul class="org-ul">
<li>青／白</li>
</ul>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">background</td>
<td class="org-left">foreground</td>
<td class="org-left">overline</td>
</tr>

<tr>
<td class="org-left">active</td>
<td class="org-left">558BE2</td>
<td class="org-left">FFFFFF</td>
<td class="org-left">566f99</td>
</tr>

<tr>
<td class="org-left">inactive</td>
<td class="org-left">94bbf9</td>
<td class="org-left">EFEFEF</td>
<td class="org-left">a4bfea</td>
</tr>
</tbody>
</table>

<ul class="org-ul">
<li>青</li>
</ul>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">background</td>
<td class="org-left">foreground</td>
<td class="org-left">overline</td>
</tr>

<tr>
<td class="org-left">active</td>
<td class="org-left">b2cefb</td>
<td class="org-left">203e6f</td>
<td class="org-left">203e6f</td>
</tr>

<tr>
<td class="org-left">inactive</td>
<td class="org-left">94bbf9</td>
<td class="org-left">94bbf9</td>
<td class="org-left">94bbf9</td>
</tr>
</tbody>
</table>

<ul class="org-ul">
<li>緑</li>
</ul>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">background</td>
<td class="org-left">foreground</td>
<td class="org-left">overline</td>
</tr>

<tr>
<td class="org-left">active</td>
<td class="org-left">b1fbd6</td>
<td class="org-left">206f47</td>
<td class="org-left">206f47</td>
</tr>

<tr>
<td class="org-left">inactive</td>
<td class="org-left">95f9c7</td>
<td class="org-left">95f9c7</td>
<td class="org-left">95f9c7</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>

<div id="outline-container-org328bb797" class="outline-3">
<h3 id="org328bb797"><span class="section-number-3">6.7.</span> visible-bell のカスタマイズ</h3>
<div class="outline-text-3" id="text-org328bb797">
<p>
最近は鬱陶しくなってしまい，ビープ音も無しかつ視覚効果も無しにしています．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;  </span><span style="color: #b22222;">(setq visible-bell nil) ;; default=nil</span>
(<span style="color: #a020f0;">setq</span> ring-bell-function 'ignore)
</pre>
</div>

<p>
see <a href="http://yohshiy.blog.fc2.com/blog-entry-171.html">http://yohshiy.blog.fc2.com/blog-entry-171.html</a>
</p>

<p>
以前は，<a href="http://www.emacswiki.org/emacs/MilesBader">http://www.emacswiki.org/emacs/MilesBader</a> を参考にカスタマイズしていました．現在は後継パッケージ（<a href="http://www.emacswiki.org/emacs/echo-bell.el">http://www.emacswiki.org/emacs/echo-bell.el</a>）があり，MELPAから取れます．
</p>

<p>
visibl-bell を使うと，操作ミスで発生するビープ音を，視覚的な表示に入れ替えられます．ただ，デフォルトではバッファ中央に黒い四角が表示されて少々鬱陶しいので，ミニバッファの点滅に変更します．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(echo-area-bell)
                         <span style="color: #8b2252;">"echo-area-bell"</span> nil t)
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"echo-area-bell"</span>
    (<span style="color: #a020f0;">setq</span> visible-bell t)
    (<span style="color: #a020f0;">setq</span> ring-bell-function 'echo-area-bell)))

<span style="color: #b22222;">;; </span><span style="color: #b22222;">&#12497;&#12483;&#12465;&#12540;&#12472;&#65288;echo-bell&#65289;&#12398;&#22580;&#21512;</span>
(<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">echo-bell</span> nil t)
  (<span style="color: #a020f0;">setq</span> echo-bell-string <span style="color: #8b2252;">""</span>)
  (<span style="color: #a020f0;">setq</span> echo-bell-background <span style="color: #8b2252;">"#FFDCDC"</span>)
  (<span style="color: #a020f0;">setq</span> echo-bell-delay 0.1)
  (echo-bell-mode 1))
</pre>
</div>
</div>
</div>

<div id="outline-container-org91a9f893" class="outline-3">
<h3 id="org91a9f893"><span class="section-number-3">6.8.</span> 常に <b>scratch</b> を表示して起動する</h3>
<div class="outline-text-3" id="text-org91a9f893">
<p>
最近は，起動用にメジャーモードを書いて対応しています．詳しくはリンク先にて．
</p>

<ul class="org-ul">
<li><a href="http://qiita.com/takaxp/items/12c01bff4c687b3f242b">高速起動用ミニマム*scratch*バッファ - Qiita</a></li>
</ul>

<p>
なお， <code>C-M-s</code> をスクラッチバッファを表示するために使用していますが，本来は，正規表現での検索(<code>isearch-forward-regexp</code>)に割り振られています．
</p>

<p>
パッケージとして切り出された別ファイルにすると，そのファイルをロードすることも起動時のコストになるため，現在は下記を <code>init.el</code> 内に直接記述しています．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">empty-booting-mode</span> ()
  <span style="color: #8b2252;">"Minimum mode for quick booting"</span>
  (<span style="color: #a020f0;">interactive</span>)
  (<span style="color: #a020f0;">setq</span> mode-name <span style="color: #8b2252;">"Empty"</span>)
  (<span style="color: #a020f0;">setq</span> major-mode 'empty-booting-mode)
  (<span style="color: #a020f0;">setq</span> header-line-format <span style="color: #8b2252;">" No day is a good day."</span>)
  <span style="color: #b22222;">;;  </span><span style="color: #b22222;">(setq buffer-mode-map (make-keymap))</span>
  <span style="color: #b22222;">;;  </span><span style="color: #b22222;">(use-local-map buffer-mode-map)</span>
  (run-hooks 'empty-booting-hook))
<span style="color: #b22222;">;; </span><span style="color: #b22222;">(setq initial-buffer-choice t) ;; &#24341;&#25968;&#20184;&#12365;&#36215;&#21205;&#12377;&#12427;&#12392;&#30011;&#38754;&#20998;&#21106;&#12373;&#12428;&#12427;</span>
(<span style="color: #a020f0;">setq</span> initial-scratch-message nil)
(<span style="color: #a020f0;">setq</span> initial-major-mode 'empty-booting-mode)
(set-face-foreground 'header-line <span style="color: #8b2252;">"#FFFFFF"</span>) <span style="color: #b22222;">;; </span><span style="color: #b22222;">"#203e6f" #333333 "#FFFFFF"</span>
(set-face-background 'header-line <span style="color: #8b2252;">"#a46398"</span>) <span style="color: #b22222;">;; </span><span style="color: #b22222;">"#ffb08c" "#7e59b5" ##5F7DB7</span>
(set-face-attribute 'header-line nil
                    <span style="color: #483d8b;">:inherit</span> nil
                    <span style="color: #483d8b;">:overline</span> nil
                    <span style="color: #483d8b;">:underline</span> nil)
(<span style="color: #a020f0;">unless</span> noninteractive
  (run-at-time <span style="color: #8b2252;">"5 sec"</span> 600 'my-empty-booting-header-line))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-open-scratch</span> ()
  <span style="color: #8b2252;">"Switch the current buffer to </span><span style="color: #ff0000; font-weight: bold;">\</span><span style="color: #8b2252;">*scratch</span><span style="color: #ff0000; font-weight: bold;">\</span><span style="color: #8b2252;">* buffer."</span>
  (<span style="color: #a020f0;">interactive</span>)
  (switch-to-buffer <span style="color: #8b2252;">"*scratch*"</span>))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">ad:split-window-below</span> (<span style="color: #228b22;">&amp;optional</span> _size)
  <span style="color: #8b2252;">"An extention to switch to </span><span style="color: #ff0000; font-weight: bold;">\</span><span style="color: #8b2252;">*scratch</span><span style="color: #ff0000; font-weight: bold;">\</span><span style="color: #8b2252;">* buffer after splitting window."</span>
  (my-open-scratch))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">(advice-add 'split-window-below :after #'ad:split-window-below)</span>
(<span style="color: #a020f0;">if</span> (&lt; emacs-major-version 29)
    (global-set-key (kbd <span style="color: #8b2252;">"C-M-s"</span>) #'my-open-scratch)
  (global-set-key (kbd <span style="color: #8b2252;">"C-M-s"</span>) #'scratch-buffer))
</pre>
</div>

<p>
<code>session.el</code> や <code>desktop.el</code> を使っていても，いつも <code>*scratch*</code> バッファを表示する．そうじゃないと安心できない人向け．
</p>

<p>
使われるメジャーモードと表示する文字列も制御できます．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">Start Emacs with scratch buffer even though it call session.el/desktop.el</span>
(add-hook 'emacs-startup-hook (<span style="color: #a020f0;">lambda</span> () (switch-to-buffer <span style="color: #8b2252;">"*scratch*"</span>)))
(<span style="color: #a020f0;">setq</span> initial-major-mode 'text-mode)
(<span style="color: #a020f0;">setq</span> initial-scratch-message
      (concat <span style="color: #8b2252;">"                                                              "</span>
              (format-time-string <span style="color: #8b2252;">"%Y-%m-%d (%a.)"</span>) <span style="color: #8b2252;">"\n"</span>
              <span style="color: #8b2252;">"-----------------------------------------------------"</span>
              <span style="color: #8b2252;">"--------------------------\n"</span>))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdf6d1ea2" class="outline-3">
<h3 id="orgdf6d1ea2"><span class="section-number-3">6.9.</span> スクロールバーを非表示にする</h3>
<div class="outline-text-3" id="text-orgdf6d1ea2">
<p>
スクロールバーを非表示にするには，nil を指定します．
右側に表示したい場合は，'right とします．
スクロールバーの非表示は起動後に実施されるため，フレームがチラつきます．それを解消するために，現在は，ソースコードレベルでオフにしています．パッチに興味がある場合は，<a href="https://gist.github.com/takaxp/01ff965361d70de93e9aba3795193cc7">こちら</a>．以下は，EMPビルド向けに設定しています．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">Show scroll bar or not</span>
(<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">and</span> (display-graphic-p)
           (not early-init-file)
           (memq window-system '(ns mac)))
  (set-scroll-bar-mode nil)) <span style="color: #b22222;">; </span><span style="color: #b22222;">'right</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdd0a9c41" class="outline-3">
<h3 id="orgdd0a9c41"><span class="section-number-3">6.10.</span> ツールバーを非表示にする</h3>
<div class="outline-text-3" id="text-orgdd0a9c41">
<p>
ツールバーは使わないので非表示にします． <code>early-init.el</code> にも設定があることを前提しています．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">Disable to show the tool bar.</span>
(<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">and</span> (boundp 'early-init-file)
                 (not early-init-file)
                 (display-graphic-p))
  (tool-bar-mode -1))
</pre>
</div>
</div>
</div>

<div id="outline-container-org52e500e2" class="outline-3">
<h3 id="org52e500e2"><span class="section-number-3">6.11.</span> メニューバーを非表示にする</h3>
<div class="outline-text-3" id="text-org52e500e2">
<p>
特にターミナルでは不要です．Windowsでも非表示にします． <code>early-init.el</code> にも設定があることを前提しています．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">and</span> (boundp 'early-init-file)
                 (not early-init-file)
                 (<span style="color: #a020f0;">or</span> (not (display-graphic-p))
                     (eq system-type 'windows-nt)))
  (menu-bar-mode -1))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd432e8ff" class="outline-3">
<h3 id="orgd432e8ff"><span class="section-number-3">6.12.</span> 起動時のスプラッシュ画面を表示しない</h3>
<div class="outline-text-3" id="text-orgd432e8ff">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">Disable to show the splash window at startup</span>
(<span style="color: #a020f0;">setq</span> inhibit-startup-screen t)
</pre>
</div>
</div>
</div>

<div id="outline-container-org0f9c4edc" class="outline-3">
<h3 id="org0f9c4edc"><span class="section-number-3">6.13.</span> ターミナル時のウィンドウ分割線を見やすくする</h3>
<div class="outline-text-3" id="text-org0f9c4edc">
<p>
see <a href="https://www.reddit.com/r/emacs/comments/3u0d0u/how_do_i_make_the_vertical_window_divider_more/">https://www.reddit.com/r/emacs/comments/3u0d0u/how_do_i_make_the_vertical_window_divider_more/</a>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-change-window-divider</span> ()
  (<span style="color: #a020f0;">interactive</span>)
  (<span style="color: #a020f0;">let</span> ((display-table (<span style="color: #a020f0;">or</span> buffer-display-table
                                             standard-display-table
                                             (make-display-table))))
    (set-display-table-slot display-table 5 ?&#9474;)
    (set-window-display-table (selected-window) display-table)))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">unless</span> (display-graphic-p)
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#12479;&#12540;&#12511;&#12490;&#12523;&#12398;&#32294;&#20998;&#21106;&#32218;&#12434;UTF-8&#12391;&#12365;&#12428;&#12356;&#12395;&#25551;&#12367;</span>
  (add-hook 'window-configuration-change-hook 'my-change-window-divider))
</pre>
</div>
</div>
</div>

<div id="outline-container-org4a736379" class="outline-3">
<h3 id="org4a736379"><span class="section-number-3">6.14.</span> default.el を探索させない</h3>
<div class="outline-text-3" id="text-org4a736379">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">setq</span> inhibit-default-init t)
</pre>
</div>
</div>
</div>

<div id="outline-container-org8d729190" class="outline-3">
<h3 id="org8d729190"><span class="section-number-3">6.15.</span> カーソル行の行数をモードラインに表示する</h3>
<div class="outline-text-3" id="text-org8d729190">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">Show line number in the mode line.</span>
(<span style="color: #a020f0;">unless</span> noninteractive
  (line-number-mode 1))
</pre>
</div>
</div>
</div>

<div id="outline-container-orge456e19c" class="outline-3">
<h3 id="orge456e19c"><span class="section-number-3">6.16.</span> カーソル行の関数名をモードラインに表示する</h3>
<div class="outline-text-3" id="text-orge456e19c">
<ul class="org-ul">
<li>emacs24.3 で重く感じるので外している．</li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">Show function name in the mode line.</span>
(which-function-mode t)
</pre>
</div>
</div>
</div>

<div id="outline-container-orga76ec530" class="outline-3">
<h3 id="orga76ec530"><span class="section-number-3">6.17.</span> 行番号をバッファに表示する</h3>
<div class="outline-text-3" id="text-orga76ec530">
<p>
Emacs Version 26.1 からネイティブ実装に切り替わった <code>display-line-numbers.el</code> を使います．普段は使わないので，必要に応じてグローバルにトグルできるようにしてあります．現在行の番号について <code>face</code> を変更したい場合は， <code>line-number-current-line</code> をカスタマイズすればOKです．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-update-display-line-numbers-face</span> ()
  (custom-set-faces
   `(line-number-current-line
     ((t (<span style="color: #483d8b;">:bold</span> t <span style="color: #483d8b;">:background</span> ,(face-attribute 'hl-line <span style="color: #483d8b;">:background</span>)))))))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-display-line-numbers-width</span> ()
  (<span style="color: #a020f0;">when</span> (&lt; display-line-numbers-width 5)
    (<span style="color: #a020f0;">setq</span> display-line-numbers-width 5))
  (<span style="color: #a020f0;">setq</span> moom-display-line-numbers-width (+ 2 display-line-numbers-width)))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-display-line-numbers-mode-on</span> ()
  <span style="color: #8b2252;">"Trun on `</span><span style="color: #008b8b;">display-line-numbers</span><span style="color: #8b2252;">'."</span>
  (<span style="color: #a020f0;">interactive</span>)
  (<span style="color: #a020f0;">if</span> (fboundp 'global-display-line-numbers-mode) <span style="color: #b22222;">;; </span><span style="color: #b22222;">26.1 or later</span>
      (<span style="color: #a020f0;">unless</span> global-display-line-numbers-mode
        (global-display-line-numbers-mode 1)
        (line-number-mode -1))
    (<span style="color: #ff0000; font-weight: bold;">user-error</span> <span style="color: #8b2252;">"The display-line-numbers is NOT supported"</span>)))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-display-line-numbers-mode-off</span> ()
  <span style="color: #8b2252;">"Trun off `</span><span style="color: #008b8b;">display-line-numbers</span><span style="color: #8b2252;">'."</span>
  (<span style="color: #a020f0;">interactive</span>)
  (<span style="color: #a020f0;">if</span> (fboundp 'global-display-line-numbers-mode) <span style="color: #b22222;">;; </span><span style="color: #b22222;">26.1 or later</span>
      (<span style="color: #a020f0;">when</span> global-display-line-numbers-mode
        (global-display-line-numbers-mode -1)
        (line-number-mode 1))
    (<span style="color: #ff0000; font-weight: bold;">user-error</span> <span style="color: #8b2252;">"The display-line-numbers is NOT supported"</span>)))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-toggle-display-line-numbers-mode</span> ()
  <span style="color: #8b2252;">"Toggle variable `</span><span style="color: #008b8b;">global-display-line-numbers-mode</span><span style="color: #8b2252;">'."</span>
  (<span style="color: #a020f0;">interactive</span>)
  (<span style="color: #a020f0;">if</span> (fboundp 'global-display-line-numbers-mode) <span style="color: #b22222;">;; </span><span style="color: #b22222;">26.1 or later</span>
      (<span style="color: #a020f0;">let</span> ((flag (<span style="color: #a020f0;">if</span> global-display-line-numbers-mode -1 1)))
        (global-display-line-numbers-mode flag)
        (line-number-mode (- flag)))
    (<span style="color: #ff0000; font-weight: bold;">user-error</span> <span style="color: #8b2252;">"The display-line-numbers is NOT supported"</span>)))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(my-toggle-display-line-numbers-mode)
                         <span style="color: #8b2252;">"display-line-numbers"</span> nil t)
  (global-set-key (kbd <span style="color: #8b2252;">"C-&lt;f12&gt;"</span>) 'my-toggle-display-line-numbers-mode)
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"hl-line"</span>
    (my-update-display-line-numbers-face)
    (add-hook 'my-ime-off-hline-hook #'my-update-display-line-numbers-face)
    (add-hook 'my-ime-on-hline-hook #'my-update-display-line-numbers-face))

  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"display-line-numbers"</span>
    (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">moom</span> nil t)
    (custom-set-faces
     '(line-number-current-line
       ((t (<span style="color: #483d8b;">:bold</span> t)))))

    (custom-set-variables
     '(display-line-numbers-width-start t))

    <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#12454;&#12451;&#12531;&#12489;&#12454;&#24038;&#12395;&#34920;&#31034;&#12377;&#12427;&#34892;&#25968;&#12398;&#24133;&#12434;5&#20197;&#19978;&#12395;&#22266;&#23450;&#12377;&#12427;&#65294;</span>
    (add-hook 'display-line-numbers-mode-hook
              #'my-display-line-numbers-width)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org19cbc9b3" class="outline-3">
<h3 id="org19cbc9b3"><span class="section-number-3">6.18.</span> 行番号の表示制限を拡張する</h3>
<div class="outline-text-3" id="text-org19cbc9b3">
<p>
デフォルトだと200桁までしかモードラインに表示されないので，それ以上の行数であっても，行数がいつも表示されるように拡張します．
</p>

<p>
さらにモードラインの表示をちょっとリッチにします．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">setq</span> line-number-display-limit-width 100000)

<span style="color: #b22222;">;; </span><span style="color: #b22222;">&#12514;&#12540;&#12489;&#12521;&#12452;&#12531;&#12398;&#34892;&#25968;&#34920;&#31034;&#12398;&#21069;&#12395;&#12450;&#12452;&#12467;&#12531;&#12434;&#36861;&#21152;</span>
(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"icons-in-terminal"</span>
  (<span style="color: #a020f0;">setq</span> mode-line-position-line-format
        `(,(icons-in-terminal-material <span style="color: #8b2252;">"edit"</span>) <span style="color: #8b2252;">"%3l"</span>)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org5117762c" class="outline-3">
<h3 id="org5117762c"><span class="section-number-3">6.19.</span> 時刻をモードラインに表示する</h3>
<div class="outline-text-3" id="text-org5117762c">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">Show clock in in the mode line</span>
(<span style="color: #a020f0;">setq</span> display-time-format <span style="color: #8b2252;">"%H:%M"</span>) <span style="color: #b22222;">;; </span><span style="color: #b22222;">%y%m%d. ;; "%H%M.%S"</span>
(<span style="color: #a020f0;">setq</span> display-time-interval 1)
(<span style="color: #a020f0;">setq</span> display-time-default-load-average nil)
(<span style="color: #a020f0;">unless</span> noninteractive
  (display-time-mode 1))
</pre>
</div>
</div>
</div>

<div id="outline-container-orga734802e" class="outline-3">
<h3 id="orga734802e"><span class="section-number-3">6.20.</span> 対応するカッコをハイライトする</h3>
<div class="outline-text-3" id="text-orga734802e">
<p>
Built-in の paren.el が利用できる．拡張版として <a href="http://www.emacswiki.org/emacs/mic-paren.el">mic-paren.el</a> があり，現在はこれを利用している．
</p>

<p>
2022-07-29: emacs 28.1 になった頃から paren.el でもいい感じになっているので，しばらく様子見ます．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-mic-paren-activate</span> ()
  (paren-activate)
  (show-paren-mode -1)
  (remove-hook 'find-file-hook #'my-mic-paren-activate))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">ad:mic-paren-highlight</span> (f)
  (<span style="color: #a020f0;">if</span> (active-minibuffer-window)
      (<span style="color: #a020f0;">let</span> ((paren-display-message 'never))
        (funcall f)
        paren-display-message)
    (funcall f)))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">(eval-when-compile</span>
<span style="color: #b22222;">;;   </span><span style="color: #b22222;">(require 'mic-paren nil t))</span>

(<span style="color: #a020f0;">when</span> (autoload-if-found '(paren-activate)
                         <span style="color: #8b2252;">"mic-paren"</span> nil t)
  (add-hook 'find-file-hook #'my-mic-paren-activate)
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"mic-paren"</span>
    (<span style="color: #a020f0;">setq</span> paren-sexp-mode nil)
    (set-face-foreground 'paren-face-match <span style="color: #8b2252;">"#FFFFFF"</span>)
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">Deep blue: #6666CC, orange: #FFCC66</span>
    (set-face-background 'paren-face-match <span style="color: #8b2252;">"#66CC66"</span>)

    <span style="color: #b22222;">;; </span><span style="color: #b22222;">for ivy-mode, "Matches" &#12392;&#34920;&#31034;&#12373;&#12428;&#12427;&#38306;&#25968;&#12392;&#12398;&#34909;&#31361;&#12434;&#12373;&#12369;&#12427;</span>
    (advice-add 'mic-paren-highlight <span style="color: #483d8b;">:around</span> #'ad:mic-paren-highlight)))
</pre>
</div>

<p>
paren.el の場合は以下の設定．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">setq</span> show-paren-delay 0)
(show-paren-mode t)
<span style="color: #b22222;">;; </span><span style="color: #b22222;">(setq show-paren-style 'expression) ; &#12459;&#12483;&#12467;&#20869;&#12418;&#24375;&#35519;</span>
<span style="color: #b22222;">;;</span><span style="color: #b22222;">(set-face-background 'show-paren-match-face "#5DA4ff") ; &#12459;&#12540;&#12477;&#12523;&#12424;&#12426;&#28611;&#12356;&#38738;</span>
(set-face-background 'show-paren-match-face <span style="color: #8b2252;">"#a634ff"</span>)
(set-face-foreground 'show-paren-match-face <span style="color: #8b2252;">"#FFFFFF"</span>)
(set-face-underline-p 'show-paren-match-face nil)
(<span style="color: #a020f0;">setq</span> show-paren-style 'parenthesis)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd1e62da7" class="outline-3">
<h3 id="orgd1e62da7"><span class="section-number-3">6.21.</span> 全角スペースと行末タブ／半角スペースを強調表示する</h3>
<div class="outline-text-3" id="text-orgd1e62da7">
<ul class="org-ul">
<li><a href="http://ubulog.blogspot.jp/2007/09/emacs_09.html">http://ubulog.blogspot.jp/2007/09/emacs_09.html</a></li>
<li><a href="https://beiznotes.org/200906031244034052-2/">emacsでタブとEOFと全角空白の表示を。</a></li>
<li><a href="http://qiita.com/itiut@github/items/4d74da2412a29ef59c3a">whitespace-modeを使って、ファイルの保存時に行末のスペースや末尾の改行を削除する - Qiita</a></li>
</ul>

<p>
英語で原稿を書く時に全角スペースが入っているを苦労するので，強調表示して編集中でも気づくようにします．また，行末のタブや半角スペースも無駄なので，入り込まないように強調しています．パッケージを使うと too much かなという印象があったので，個別の設定だけを使わせてもらっています．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">ad:font-lock-mode</span> (<span style="color: #228b22;">&amp;optional</span> _ARG)
  (<span style="color: #a020f0;">unless</span> (memq major-mode '(vterm-mode))
    (font-lock-add-keywords major-mode
                            <span style="color: #b22222;">;; </span><span style="color: #b22222;">"[\t]+$" &#34892;&#26411;&#12398;&#12479;&#12502;</span>
                            '((<span style="color: #8b2252;">"&#12288;"</span> 0 'my-face-b-1 append)
                              (<span style="color: #8b2252;">"[ ]+$"</span> 0 'my-face-b-3 append)
                              (<span style="color: #8b2252;">"[\t]+$"</span> 0 'my-face-b-2 append)))))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">&#12473;&#12506;&#12540;&#12473;</span>
(<span style="color: #a020f0;">defface</span> <span style="color: #a0522d;">my-face-b-1</span>
  '((t (<span style="color: #483d8b;">:background</span> <span style="color: #8b2252;">"gray"</span> <span style="color: #483d8b;">:bold</span> t <span style="color: #483d8b;">:underline</span> <span style="color: #8b2252;">"red"</span>)))
  nil <span style="color: #483d8b;">:group</span> 'font-lock-highlighting-faces)
<span style="color: #b22222;">;; </span><span style="color: #b22222;">&#12479;&#12502;&#12384;&#12369;&#12398;&#34892;</span>
(<span style="color: #a020f0;">defface</span> <span style="color: #a0522d;">my-face-b-2</span>
  '((t (<span style="color: #483d8b;">:background</span> <span style="color: #8b2252;">"orange"</span> <span style="color: #483d8b;">:bold</span> t <span style="color: #483d8b;">:underline</span> <span style="color: #8b2252;">"red"</span>)))
  nil <span style="color: #483d8b;">:group</span> 'font-lock-highlighting-faces)
<span style="color: #b22222;">;; </span><span style="color: #b22222;">&#21322;&#35282;&#12473;&#12506;&#12540;&#12473;</span>
(<span style="color: #a020f0;">defface</span> <span style="color: #a0522d;">my-face-b-3</span> '((t (<span style="color: #483d8b;">:background</span> <span style="color: #8b2252;">"orange"</span>)))
  nil <span style="color: #483d8b;">:group</span> 'font-lock-highlighting-faces)
(advice-add 'font-lock-mode <span style="color: #483d8b;">:before</span> #'ad:font-lock-mode)

<span style="color: #b22222;">;;</span><span style="color: #b22222;">show EOF</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">(defun set-buffer-end-mark()</span>
<span style="color: #b22222;">;;   </span><span style="color: #b22222;">(let ((overlay (make-overlay (point-max) (point-max))))</span>
<span style="color: #b22222;">;;     </span><span style="color: #b22222;">(overlay-put overlay 'before-string #("[EOF]" 0 5 (face highlight)))</span>
<span style="color: #b22222;">;;     </span><span style="color: #b22222;">(overlay-put overlay 'insert-behind-hooks</span>
<span style="color: #b22222;">;;                  </span><span style="color: #b22222;">'((lambda (overlay after beg end &amp;optional len)</span>
<span style="color: #b22222;">;;                      </span><span style="color: #b22222;">(when after</span>
<span style="color: #b22222;">;;                        </span><span style="color: #b22222;">(move-overlay overlay (point-max) (point-max))))))))</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">(add-hook 'find-file-hook #'set-buffer-end-mark)</span>
</pre>
</div>
</div>
<div id="outline-container-org58e6bf63" class="outline-4">
<h4 id="org58e6bf63"><span class="section-number-4">6.21.1.</span> emacs 28 からの表示制御</h4>
<div class="outline-text-4" id="text-org58e6bf63">
<p>
version 28 で全角スペースに黒下線が付くので回避します．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">unless</span> (version&lt; emacs-version <span style="color: #8b2252;">"28.0"</span>)
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#20840;&#35282;&#12473;&#12506;&#12540;&#12473;"&#12288;"&#12395;&#12487;&#12501;&#12457;&#12523;&#12488;&#12391;&#40658;&#19979;&#32218;&#12364;&#20184;&#12367;&#12398;&#12434;&#22238;&#36991;&#12377;&#12427;</span>
    (<span style="color: #a020f0;">setq</span> nobreak-char-display nil))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgc93741fa" class="outline-3">
<h3 id="orgc93741fa"><span class="section-number-3">6.22.</span> バッファの終わりをフリンジで明示</h3>
<div class="outline-text-3" id="text-orgc93741fa">
<p>
以下の設定では，ウィンドウ以下にバッファが続いているかを表す矢印と，続いていないことを示すカギカッコをフリンジに表示します．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">setq-default</span> indicate-buffer-boundaries
              '((top . nil) (bottom . right) (down . left)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgec7835e0" class="outline-3">
<h3 id="orgec7835e0"><span class="section-number-3">6.23.</span> 文字エンコードの表示を明確化</h3>
<div class="outline-text-3" id="text-orgec7835e0">
<p>
デフォルトの表示は略されすぎていてわかりにくいので，表示内容を具体化します．
</p>

<ul class="org-ul">
<li><a href="https://qiita.com/kai2nenobu/items/ddf94c0e5a36919bc6db">モードラインの文字エンコーディング表示をわかりやすくする - Qiita</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">&#25991;&#23383;&#12456;&#12531;&#12467;&#12540;&#12487;&#12451;&#12531;&#12464;&#12398;&#25991;&#23383;&#21015;&#34920;&#29694;</span>

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-coding-system-name-mnemonic</span> (coding-system)
  (<span style="color: #a020f0;">let*</span> ((base (coding-system-base coding-system))
         (name (symbol-name base)))
    (<span style="color: #a020f0;">cond</span> ((string-prefix-p <span style="color: #8b2252;">"utf-8"</span> name) <span style="color: #8b2252;">"U8"</span>)
          ((string-prefix-p <span style="color: #8b2252;">"utf-16"</span> name) <span style="color: #8b2252;">"U16"</span>)
          ((string-prefix-p <span style="color: #8b2252;">"utf-7"</span> name) <span style="color: #8b2252;">"U7"</span>)
          ((string-prefix-p <span style="color: #8b2252;">"japanese-shift-jis"</span> name) <span style="color: #8b2252;">"SJIS"</span>)
          ((string-match <span style="color: #8b2252;">"cp</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">(</span><span style="color: #8b2252;">[0-9]+</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">)</span><span style="color: #8b2252;">"</span> name) (match-string 1 name))
          ((string-match <span style="color: #8b2252;">"japanese-iso-8bit"</span> name) <span style="color: #8b2252;">"EUC"</span>)
          (t <span style="color: #8b2252;">"???"</span>))))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-coding-system-bom-mnemonic</span> (coding-system)
  (<span style="color: #a020f0;">let</span> ((name (symbol-name coding-system)))
    (<span style="color: #a020f0;">cond</span> ((string-match <span style="color: #8b2252;">"be-with-signature"</span> name) <span style="color: #8b2252;">"[BE]"</span>)
          ((string-match <span style="color: #8b2252;">"le-with-signature"</span> name) <span style="color: #8b2252;">"[LE]"</span>)
          ((string-match <span style="color: #8b2252;">"-with-signature"</span> name) <span style="color: #8b2252;">"[BOM]"</span>)
          (t <span style="color: #8b2252;">""</span>))))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-mode-line-icon-lock</span> ()
  (<span style="color: #a020f0;">if</span> view-mode
      (concat (icons-in-terminal-faicon
               <span style="color: #8b2252;">"lock"</span> <span style="color: #483d8b;">:face</span> '(<span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#FF0000"</span>)) <span style="color: #ff0000; font-weight: bold;">" "</span><span style="color: #ff0000; font-weight: bold;">) </span><span style="color: #ff0000; font-weight: bold;">""</span><span style="color: #ff0000; font-weight: bold;">))</span>

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-mode-line-icon-for-file</span> ()
  (icons-in-terminal-icon-for-file
   (buffer-name) <span style="color: #483d8b;">:v-adjust</span> 0.03 <span style="color: #483d8b;">:face</span> 'mode-line-file-icon-face))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-buffer-coding-system-mnemonic</span> ()
  <span style="color: #8b2252;">"Return a mnemonic for `</span><span style="color: #008b8b;">buffer-file-coding-system</span><span style="color: #8b2252;">'."</span>
  (<span style="color: #a020f0;">let*</span> ((code buffer-file-coding-system)
         (name (my-coding-system-name-mnemonic code))
         (bom (my-coding-system-bom-mnemonic code)))
    (<span style="color: #a020f0;">if</span> (version&lt; emacs-version <span style="color: #8b2252;">"29.0"</span>)
        (format <span style="color: #8b2252;">"%s %s%s"</span> (my-mode-line-icon-for-file) name bom )
      (format <span style="color: #8b2252;">"%s%s"</span> name bom ))))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">&#25913;&#34892;&#25991;&#23383;&#12398;&#25991;&#23383;&#21015;&#34920;&#29694;</span>
(set 'eol-mnemonic-dos <span style="color: #8b2252;">"CRLF"</span>)
(set 'eol-mnemonic-unix <span style="color: #8b2252;">"LF"</span>)
(set 'eol-mnemonic-mac <span style="color: #8b2252;">"CR"</span>)
(set 'eol-mnemonic-undecided <span style="color: #8b2252;">"?"</span>)

(make-face 'mode-line-file-icon-face)
(custom-set-faces
 '(mode-line-file-icon-face
   ((((background dark)) <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"VioletRed1"</span>)
    (t (<span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"LightGoldenrod1"</span>)))))

<span style="color: #b22222;">;; </span><span style="color: #b22222;">`</span><span style="color: #008b8b;">mode-line-mule-info</span><span style="color: #b22222;">' &#12398;&#25991;&#23383;&#12456;&#12531;&#12467;&#12540;&#12487;&#12451;&#12531;&#12464;&#12398;&#25991;&#23383;&#21015;&#34920;&#29694;&#12434;&#24046;&#12375;&#26367;&#12360;&#12427;</span>
(<span style="color: #a020f0;">setq-default</span> mode-line-mule-info
              (cl-substitute '(<span style="color: #483d8b;">:eval</span> (my-buffer-coding-system-mnemonic))
                             <span style="color: #8b2252;">"%z"</span> mode-line-mule-info <span style="color: #483d8b;">:test</span> 'equal))
</pre>
</div>
</div>
</div>

<div id="outline-container-org0e59b85f" class="outline-3">
<h3 id="org0e59b85f"><span class="section-number-3">6.24.</span> [delight.el] モードラインのモード名を短縮する</h3>
<div class="outline-text-3" id="text-org0e59b85f">
<ul class="org-ul">
<li><a href="https://elpa.gnu.org/packages/delight.html">GNU ELPA - delight</a></li>
</ul>

<p>
以前は <code>diminish.el</code> を使用していましたが，ELPA配布のパッケージに移行しました．メジャーモードの短縮表示もマイナーモードの場合と同様に設定できます．この点で，設定がスッキリしました．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-delight-activate</span> ()
  (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">delight</span> nil t)
  (remove-hook 'find-file-hook #'my-delight-activate))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(add-hook 'find-file-hook #'my-delight-activate)

(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"delight"</span>
  (delight
   '(<span style="color: #b22222;">;; </span><span style="color: #b22222;">Major modes</span>
     <span style="color: #b22222;">;;     </span><span style="color: #b22222;">(c-mode "C" :major)</span>
     <span style="color: #b22222;">;;     </span><span style="color: #b22222;">(c++mode "C++" :major)</span>
     (js2-mode <span style="color: #8b2252;">"JS"</span> <span style="color: #483d8b;">:major</span>)
     (csharp-mode <span style="color: #8b2252;">"C#"</span> <span style="color: #483d8b;">:major</span>)
     (prog-mode <span style="color: #8b2252;">"Pr"</span> <span style="color: #483d8b;">:major</span>)
     (emacs-lisp-mode <span style="color: #8b2252;">"El"</span> <span style="color: #483d8b;">:major</span>)
     (python-mode <span style="color: #8b2252;">"Py"</span> <span style="color: #483d8b;">:major</span>)
     (perl-mode <span style="color: #8b2252;">"Pl"</span> <span style="color: #483d8b;">:major</span>)
     (web-mode <span style="color: #8b2252;">"W"</span> <span style="color: #483d8b;">:major</span>)
     (change-log-mode <span style="color: #8b2252;">"CLog"</span> <span style="color: #483d8b;">:major</span>)
     (lisp-interaction-mode <span style="color: #8b2252;">"Lisp"</span> <span style="color: #483d8b;">:major</span>)

     <span style="color: #b22222;">;; </span><span style="color: #b22222;">Shorten for minor modes</span>
     (ggtags-mode <span style="color: #8b2252;">" G"</span> <span style="color: #8b2252;">"ggtags"</span>)
     <span style="color: #b22222;">;; </span><span style="color: #b22222;">(orgstruct-mode " OrgS" "org")</span>
     (orgalist-mode <span style="color: #8b2252;">" ol"</span> <span style="color: #8b2252;">"orgalist"</span>)
     (view-mode <span style="color: #8b2252;">" V"</span> <span style="color: #8b2252;">"view"</span>)
     <span style="color: #b22222;">;; </span><span style="color: #b22222;">Stop to display for minor modes</span>
     (org-fancy-priorities-mode nil <span style="color: #8b2252;">"org-fancy-priorities"</span>)
     (smooth-scroll-mode nil <span style="color: #8b2252;">"smooth-scroll"</span>)
     (eldoc-mode nil <span style="color: #8b2252;">"eldoc"</span>)
     (ivy-mode nil <span style="color: #8b2252;">"ivy"</span>)
     (counsel-mode nil <span style="color: #8b2252;">"counsel"</span>)
     (centered-cursor-mode nil <span style="color: #8b2252;">"centered-cursor-mode"</span>)
     (volatile-highlights-mode nil <span style="color: #8b2252;">"volatile-highlights"</span>)
     (aggressive-indent-mode nil <span style="color: #8b2252;">"aggressive-indent"</span>)
     (all-the-icons-dired-mode nil <span style="color: #8b2252;">"all-the-icons-dired"</span>)
     (icons-in-terminal-dired-mode nil <span style="color: #8b2252;">"icons-in-terminal-dired"</span>)
     (yas-minor-mode nil <span style="color: #8b2252;">"yasnippet"</span>)
     (auto-complete-mode nil <span style="color: #8b2252;">"auto-complete"</span>)
     (company-mode nil <span style="color: #8b2252;">"company"</span>)
     (ws-butler-mode nil <span style="color: #8b2252;">"ws-butler"</span>)
     (isearch-mode nil <span style="color: #8b2252;">"isearch"</span>)
     (auto-revert-mode nil <span style="color: #8b2252;">"autorevert"</span>)
     (global-whitespace-mode nil <span style="color: #8b2252;">"whitespace"</span>)
     (emmet-mode nil <span style="color: #8b2252;">"emmet-mode"</span>)
     (abbrev-mode nil <span style="color: #8b2252;">"abbrev"</span>)
     (doxymacs-mode nil <span style="color: #8b2252;">"doxymacs"</span>)
     (editorconfig-mode nil <span style="color: #8b2252;">"editorconfig"</span>)
     (rainbow-mode nil <span style="color: #8b2252;">"rainbow-mode"</span>)
     (highlight-symbol-mode nil <span style="color: #8b2252;">"highlight-symbol"</span>)
     (which-key-mode nil <span style="color: #8b2252;">"which-key"</span>)
     (fancy-narrow-mode nil <span style="color: #8b2252;">"fancy-narrow"</span>)
     (smartparens-mode nil <span style="color: #8b2252;">"smartparens"</span>)
     (projectile-mode nil <span style="color: #8b2252;">"projectile"</span>)
     (selected-minor-mode nil <span style="color: #8b2252;">"selected"</span>)
     (skewer-html-mode nil <span style="color: #8b2252;">"skewer-html"</span>)
     (org-extra-emphasis-intraword-emphasis-mode nil <span style="color: #8b2252;">"org-extra-emphasis"</span>)
     (gcmh-mode nil <span style="color: #8b2252;">"gcmh"</span>)
     (super-save-mode nil <span style="color: #8b2252;">"super-save"</span>)))

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">Override by icon</span>
  (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">icons-in-terminal</span> nil t)
    (delight
     `((view-mode ,(concat <span style="color: #8b2252;">" "</span> (icons-in-terminal-faicon <span style="color: #8b2252;">"lock"</span>)) <span style="color: #8b2252;">"view"</span>)))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org74bad2de" class="outline-3">
<h3 id="org74bad2de"><span class="section-number-3">6.25.</span> [migemo.el] ローマ字入力で日本語を検索する</h3>
<div class="outline-text-3" id="text-org74bad2de">
<ul class="org-ul">
<li><a href="http://0xcc.net/migemo/#download">http://0xcc.net/migemo/#download</a></li>
<li><a href="https://github.com/emacs-jp/migemo">emacs-jp/migemo: emacs migemo client</a></li>
</ul>

<p>
以下は，<a href="http://www.kaoriya.net/software/cmigemo">cmigemo</a> を使う設定です．正直なところ，それほどメリットを感じていません．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-migemo-activate</span> ()
  (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">and</span> (executable-find <span style="color: #8b2252;">"cmigemo"</span>)
                   (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">migemo</span> nil t))
    (add-hook 'isearch-mode-hook #'migemo-init)
    (migemo-init))
  (remove-hook 'isearch-mode-hook #'my-migemo-activate))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">late-init.el</span>
(<span style="color: #a020f0;">when</span> (autoload-if-found '(migemo-init)
                         <span style="color: #8b2252;">"migemo"</span> nil t)
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">Tricky!</span>
  (add-hook 'isearch-mode-hook #'my-migemo-activate)
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"migemo"</span>
    (custom-set-variables
     '(completion-ignore-case t) <span style="color: #b22222;">;; </span><span style="color: #b22222;">case-independent</span>
     '(migemo-command <span style="color: #8b2252;">"cmigemo"</span>)
     '(migemo-options '(<span style="color: #8b2252;">"-q"</span> <span style="color: #8b2252;">"--emacs"</span> <span style="color: #8b2252;">"-i"</span> <span style="color: #8b2252;">"\a"</span>))
     '(migemo-dictionary <span style="color: #8b2252;">"/usr/local/share/migemo/utf-8/migemo-dict"</span>)
     '(migemo-user-dictionary nil)
     '(migemo-regex-dictionary nil)
     '(migemo-use-pattern-alist t)
     '(migemo-use-frequent-pattern-alist t)
     '(migemo-pattern-alist-length 1024)
     '(migemo-coding-system 'utf-8-unix))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org6332fe92" class="outline-3">
<h3 id="org6332fe92"><span class="section-number-3">6.26.</span> [git-gutter-fringe] 編集差分をフレーム端で視覚化</h3>
<div class="outline-text-3" id="text-org6332fe92">
<p>
編集差分の視覚化は，元々 git-gutter が提供している機能です．しかし有効にするとフレームの幅が若干広がってしまうので，気になる人は git-gutter-fringe を使えばよいです．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">git-gutter</span> nil t)
  (<span style="color: #a020f0;">dolist</span> (hook
           '(emacs-lisp-mode-hook
             lisp-mode-hook perl-mode-hook python-mode-hook
             c-mode-common-hook nxml-mode-hook web-mode-hook))
    (add-hook hook #'git-gutter-mode))
  (custom-set-variables
   '(git-gutter:lighter <span style="color: #8b2252;">""</span>)))

(<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">git-gutter-fringe</span> nil t)
  (custom-set-variables
   '(git-gutter-fr:side 'left-fringe)))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-fringe-helper</span> ()
  (eval '(fringe-helper-define 'git-gutter-fr:modified nil
    <span style="color: #8b2252;">"...XX..."</span>
    <span style="color: #8b2252;">"...XX..."</span>
    <span style="color: #8b2252;">"...XX..."</span>
    <span style="color: #8b2252;">"...XX..."</span>
    <span style="color: #8b2252;">"...XX..."</span>
    <span style="color: #8b2252;">"........"</span>
    <span style="color: #8b2252;">"...XX..."</span>
    <span style="color: #8b2252;">"...XX..."</span>))
  (set-face-foreground 'git-gutter-fr:added    <span style="color: #8b2252;">"#FF2600"</span>)
  (set-face-foreground 'git-gutter-fr:modified <span style="color: #8b2252;">"orange"</span>)
  (set-face-foreground 'git-gutter-fr:deleted  <span style="color: #8b2252;">"medium sea green"</span>))

<span style="color: #b22222;">;;</span><span style="color: #b22222;">(add-hook 'git-gutter-mode-hook #'my-fringe-helper)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">(eval-when-compile</span>
<span style="color: #b22222;">;;   </span><span style="color: #b22222;">(message "Loading fringe-helper...")</span>
<span style="color: #b22222;">;;   </span><span style="color: #b22222;">(require 'fringe-helper))</span>

(<span style="color: #a020f0;">when</span> (autoload-if-found '(git-gutter-mode)
                         <span style="color: #8b2252;">"git-gutter"</span> nil t)
  (<span style="color: #a020f0;">dolist</span> (hook
           '(emacs-lisp-mode-hook
             lisp-mode-hook perl-mode-hook python-mode-hook
             c-mode-common-hook nxml-mode-hook web-mode-hook))
    (add-hook hook #'git-gutter-mode))

  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"git-gutter"</span>
    (custom-set-variables
     '(git-gutter:lighter <span style="color: #8b2252;">""</span>))

    (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">git-gutter-fringe</span> nil t)
      (custom-set-variables
       '(git-gutter-fr:side 'left-fringe))

      <span style="color: #b22222;">;; </span><span style="color: #b22222;">(require 'fringe-helper nil t) ;; byte-compile &#26178;&#12395;&#26126;&#31034;&#30340;&#12395;&#25351;&#23450;&#12364;&#24517;&#35201;&#65294;</span>
      <span style="color: #b22222;">;; </span><span style="color: #b22222;">"!"</span>
      (eval '(fringe-helper-define 'git-gutter-fr:modified nil
               <span style="color: #8b2252;">"...XX..."</span>
               <span style="color: #8b2252;">"...XX..."</span>
               <span style="color: #8b2252;">"...XX..."</span>
               <span style="color: #8b2252;">"...XX..."</span>
               <span style="color: #8b2252;">"...XX..."</span>
               <span style="color: #8b2252;">"........"</span>
               <span style="color: #8b2252;">"...XX..."</span>
               <span style="color: #8b2252;">"...XX..."</span>))
      <span style="color: #b22222;">;; </span><span style="color: #b22222;">"+"</span>
      (eval '(fringe-helper-define 'git-gutter-fr:added nil
               <span style="color: #8b2252;">"........"</span>
               <span style="color: #8b2252;">"...XX..."</span>
               <span style="color: #8b2252;">"...XX..."</span>
               <span style="color: #8b2252;">".XXXXXX."</span>
               <span style="color: #8b2252;">".XXXXXX."</span>
               <span style="color: #8b2252;">"...XX..."</span>
               <span style="color: #8b2252;">"...XX..."</span>
               <span style="color: #8b2252;">"........"</span>))
      <span style="color: #b22222;">;; </span><span style="color: #b22222;">"-"</span>
      (eval '(fringe-helper-define 'git-gutter-fr:deleted nil
               <span style="color: #8b2252;">"........"</span>
               <span style="color: #8b2252;">"........"</span>
               <span style="color: #8b2252;">"........"</span>
               <span style="color: #8b2252;">".XXXXXX."</span>
               <span style="color: #8b2252;">".XXXXXX."</span>
               <span style="color: #8b2252;">"........"</span>
               <span style="color: #8b2252;">"........"</span>
               <span style="color: #8b2252;">"........"</span>))
      (set-face-foreground 'git-gutter-fr:added    <span style="color: #8b2252;">"#FF2600"</span>)
      (set-face-foreground 'git-gutter-fr:modified <span style="color: #8b2252;">"orange"</span>)
      (set-face-foreground 'git-gutter-fr:deleted  <span style="color: #8b2252;">"medium sea green"</span>))))
</pre>
</div>


<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">late-init.el</span>
(<span style="color: #a020f0;">when</span> (autoload-if-found '(git-gutter-mode)
                         <span style="color: #8b2252;">"git-gutter"</span> nil t)
  (<span style="color: #a020f0;">dolist</span> (hook
           '(emacs-lisp-mode-hook
             lisp-mode-hook perl-mode-hook python-mode-hook
             c-mode-common-hook nxml-mode-hook web-mode-hook))
    (add-hook hook #'git-gutter-mode))

  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"git-gutter"</span>
    (custom-set-variables
     '(git-gutter:lighter <span style="color: #8b2252;">""</span>))

    (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">git-gutter-fringe</span> nil t)
      (custom-set-variables
       '(git-gutter-fr:side 'left-fringe))

      (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">fringe-helper</span> nil t) <span style="color: #b22222;">;; </span><span style="color: #b22222;">byte-compile &#26178;&#12395;&#26126;&#31034;&#30340;&#12395;&#25351;&#23450;&#12364;&#24517;&#35201;&#65294;</span>
      <span style="color: #b22222;">;; </span><span style="color: #b22222;">"!"</span>
      (fringe-helper-define 'git-gutter-fr:modified nil
        <span style="color: #8b2252;">"...XX..."</span>
        <span style="color: #8b2252;">"...XX..."</span>
        <span style="color: #8b2252;">"...XX..."</span>
        <span style="color: #8b2252;">"...XX..."</span>
        <span style="color: #8b2252;">"...XX..."</span>
        <span style="color: #8b2252;">"........"</span>
        <span style="color: #8b2252;">"...XX..."</span>
        <span style="color: #8b2252;">"...XX..."</span>)
      <span style="color: #b22222;">;; </span><span style="color: #b22222;">"+"</span>
      (fringe-helper-define 'git-gutter-fr:added nil
        <span style="color: #8b2252;">"........"</span>
        <span style="color: #8b2252;">"...XX..."</span>
        <span style="color: #8b2252;">"...XX..."</span>
        <span style="color: #8b2252;">".XXXXXX."</span>
        <span style="color: #8b2252;">".XXXXXX."</span>
        <span style="color: #8b2252;">"...XX..."</span>
        <span style="color: #8b2252;">"...XX..."</span>
        <span style="color: #8b2252;">"........"</span>)
      <span style="color: #b22222;">;; </span><span style="color: #b22222;">"-"</span>
      (fringe-helper-define 'git-gutter-fr:deleted nil
        <span style="color: #8b2252;">"........"</span>
        <span style="color: #8b2252;">"........"</span>
        <span style="color: #8b2252;">"........"</span>
        <span style="color: #8b2252;">".XXXXXX."</span>
        <span style="color: #8b2252;">".XXXXXX."</span>
        <span style="color: #8b2252;">"........"</span>
        <span style="color: #8b2252;">"........"</span>
        <span style="color: #8b2252;">"........"</span>)
      (set-face-foreground 'git-gutter-fr:added    <span style="color: #8b2252;">"#FF2600"</span>)
      (set-face-foreground 'git-gutter-fr:modified <span style="color: #8b2252;">"orange"</span>)
      (set-face-foreground 'git-gutter-fr:deleted  <span style="color: #8b2252;">"medium sea green"</span>))))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd6308db6" class="outline-3">
<h3 id="orgd6308db6"><span class="section-number-3">6.27.</span> [japanese-holidays] カレンダーをカラフルにする</h3>
<div class="outline-text-3" id="text-orgd6308db6">
<p>
ビルドインの <code>holidays</code> と， <code>japanese-holidays</code> を使います．土日祝日に色を着けます．土曜日と日曜祝日で異なる配色にできます．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"calendar"</span>

  (add-hook 'calendar-today-visible-hook #'calendar-mark-today)

  (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">japanese-holidays</span> nil t)
    (<span style="color: #a020f0;">setq</span> calendar-holidays
          (append japanese-holidays
                  holiday-local-holidays holiday-other-holidays))
    (<span style="color: #a020f0;">setq</span> calendar-mark-holidays-flag t)
    (<span style="color: #a020f0;">setq</span> mark-holidays-in-calendar t)
    (<span style="color: #a020f0;">setq</span> japanese-holiday-weekend-marker
          '(holiday nil nil nil nil nil japanese-holiday-saturday))
    (<span style="color: #a020f0;">setq</span> japanese-holiday-weekend '(0 6))
    (add-hook 'calendar-today-visible-hook #'japanese-holiday-mark-weekend)
    (add-hook 'calendar-today-invisible-hook #'japanese-holiday-mark-weekend)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org12f72886" class="outline-3">
<h3 id="org12f72886"><span class="section-number-3">6.28.</span> [calendar.el] カレンダーで週番号を表示する</h3>
<div class="outline-text-3" id="text-org12f72886">
<p>
ビルドインの <code>calendar.el</code> にある <code>calendar-intermonth-text</code> をカスタマイズすると，カレンダーに週番号を表示させることが可能です．
</p>

<blockquote>
<p>
ただ， <code>calendar.el</code> に記載されている例だと， <code>calendar-week-start-day</code> が <code>1</code> 以外の時に計算結果がおかしくなるので，次のように <code>calendar-absolute-from-gregorian</code> に渡す値を補正する必要があります．
</p>
</blockquote>
<p>
↑要再検討（以前は， <code>calendar-week-start-day</code> が2の場合でうまく行っていたが，現在は6を用いており，翌月の第一週の週番号が正しく表示されない状態）
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(autoload 'calendar-iso-from-absolute <span style="color: #8b2252;">"cal-iso"</span> nil t)
(autoload 'calendar-absolute-from-gregorian <span style="color: #8b2252;">"calendar"</span> nil t)

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-get-week-number</span> ()
  <span style="color: #8b2252;">"Return the current week number."</span>
  (format <span style="color: #8b2252;">"%02d"</span>
          (car
           (calendar-iso-from-absolute
            (calendar-absolute-from-gregorian
             (list (string-to-number (format-time-string <span style="color: #8b2252;">"%m"</span>))
                   (string-to-number (format-time-string <span style="color: #8b2252;">"%d"</span>))
                   (string-to-number (format-time-string <span style="color: #8b2252;">"%y"</span>))))))))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-empty-booting-header-line</span> ()
  (<span style="color: #a020f0;">with-current-buffer</span> <span style="color: #8b2252;">"*scratch*"</span>
    (<span style="color: #a020f0;">let</span> ((week (format <span style="color: #8b2252;">"W%s: "</span> (my-get-week-number)))
          (date (format-time-string <span style="color: #8b2252;">"%Y-%m-%d %a."</span>)))
      (<span style="color: #a020f0;">setq</span> header-line-format
            (concat
             <span style="color: #8b2252;">" No day is a good day.                                       "</span>
             week
             date
             (propertize <span style="color: #8b2252;">" "</span>
                         'display
                         `(space . (<span style="color: #483d8b;">:align-to</span>
                                    ,(- (frame-width)
                                        (length week)
                                        (length date))))))))))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"calendar"</span>
  (<span style="color: #a020f0;">setq</span> calendar-week-start-day 1)
  (copy-face 'default 'calendar-iso-week-header-face)
  (set-face-attribute 'calendar-iso-week-header-face nil
                      <span style="color: #483d8b;">:height</span> 1.0 <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#1010FF"</span>
                      <span style="color: #483d8b;">:background</span> (face-background 'default))
  (<span style="color: #a020f0;">setq</span> calendar-intermonth-header
        (propertize <span style="color: #8b2252;">" w"</span>
                    'font-lock-face 'calendar-iso-week-header-face))

  (copy-face font-lock-constant-face 'calendar-iso-week-face)
  (set-face-attribute 'calendar-iso-week-face nil
                      <span style="color: #483d8b;">:height</span> 1.0 <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"orange"</span>
                      <span style="color: #483d8b;">:background</span> (face-background 'default))

  (<span style="color: #a020f0;">setq</span> calendar-intermonth-text
        '(propertize
          (format <span style="color: #8b2252;">"%02d"</span>
                  (car
                   (calendar-iso-from-absolute
                    (+ (calendar-absolute-from-gregorian
                        (list month day year))
                       calendar-week-start-day
                       ))))
          'font-lock-face 'calendar-iso-week-face)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc45b24d4" class="outline-3">
<h3 id="orgc45b24d4"><span class="section-number-3">6.29.</span> [which-key] キーバインドの選択肢をポップアップする</h3>
<div class="outline-text-3" id="text-orgc45b24d4">
<p>
<code>guide-key.el</code> の後発． <code>guide-key.el</code> の改良でもあり，ディスパッチャが見やすく，直感的でとても使いやすい．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(which-key-mode)
                         <span style="color: #8b2252;">"which-key"</span> nil t)
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"which-key"</span>
    (custom-set-variables
     '(which-key-idle-delay 1.0)))

  (<span style="color: #a020f0;">unless</span> noninteractive
    (which-key-mode 1)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org467accb9" class="outline-3">
<h3 id="org467accb9"><span class="section-number-3">6.30.</span> [highlight-symbol] 同じ名前のシンボルをハイライトする</h3>
<div class="outline-text-3" id="text-org467accb9">
<p>
一定時間が過ぎると，カーソル下のワードをバッファ内で検索し，ハイライトしてくれる．殺風景なバッファに動きが出て良い．また， <code>highlight-symbol-nav-mode</code> を使うと，シンボル間を <code>M-n/M-p</code> で移動できるので，毎度検索しなくてよい．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(highlight-symbol-mode highlight-symbol-nav-mode)
                         <span style="color: #8b2252;">"highlight-symbol"</span> nil t)
  (<span style="color: #a020f0;">dolist</span> (hook '(emacs-lisp-mode-hook c-mode-common-hook prog-mode-hook))
    (add-hook hook #'highlight-symbol-mode))
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"highlight-symbol"</span>
    (custom-set-variables
     '(highlight-symbol-idle-delay 0.5))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org962224ff" class="outline-3">
<h3 id="org962224ff"><span class="section-number-3">6.31.</span> [all-the-icons.el] フォントでアイコン表示</h3>
<div class="outline-text-3" id="text-org962224ff">
<p>
<code>all-the-icons.el</code> を使うと，バッファ内やモードライン，ミニバッファでアイコンを表示できるようになります．
</p>

<p>
<a href="https://github.com/domtronn/all-the-icons.el">domtronn/all-the-icons.el: A utility package to collect various Icon Fonts and propertize them within Emacs.</a>
</p>

<p>
パッケージを使えるようにした後， <code>M-x all-the-icons-install-fonts</code> すると自動的にフォントがインストールされます．必要に応じて <code>fc-cache -f -v</code> を発行すればフォントが使えるようになります．
</p>

<p>
期待と異なるフォントが表示されたり，コピペするとフォントが入れ替わってしまう場合は， <code>set-fontset-font</code> で <code>unicode</code> を設定すると解決するかもしれません．
</p>
</div>
</div>

<div id="outline-container-orgd92b50db" class="outline-3">
<h3 id="orgd92b50db"><span class="section-number-3">6.32.</span> [all-the-icons-dired] dired でアイコンを表示</h3>
<div class="outline-text-3" id="text-orgd92b50db">
<p>
<code>dired</code> で，ファイルのアイコンを表示します． <code>all-the-icons</code> をインストール後に， <code>M-x all-the-icons-install-fonts</code> を忘れずに実行する必要があります． <code>neotree</code> の設定は別セクションに記載しています．
</p>

<p>
<code>M-x all-the-icons-install-fonts</code> をしてもうまくアイコンが表示されない場合は， <code>~/Library/Fonts/</code> 以下にある <code>all-the-icons.ttf</code> のサイズを確認してください．もしゼロバイトならインストールに失敗しています．その場合は，パッケージの <code>all-the-icons/fonts</code> 以下にあるフォントを直接インストールすればOKです．
</p>

<p>
<code>font-lock-mode</code> が無効の場合に，意図しないアイコンが表示されることがあります．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(all-the-icons-dired-mode
                           ad:all-the-icons-dired--display)
       <span style="color: #8b2252;">"all-the-icons-dired"</span> nil t)
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"all-the-icons"</span>
    (<span style="color: #a020f0;">setq</span> all-the-icons-scale-factor 1.0)
    (add-to-list 'all-the-icons-dir-icon-alist
                 '(<span style="color: #8b2252;">"google[ _-]drive"</span> all-the-icons-alltheicon <span style="color: #8b2252;">"google-drive"</span>
                   <span style="color: #483d8b;">:height</span> 1.0 <span style="color: #483d8b;">:v-adjust</span> -0.1))))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(icons-in-terminal-dired-mode)
                         <span style="color: #8b2252;">"icons-in-terminal-dired"</span> nil t)
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"icons-in-terminal"</span>
    (<span style="color: #a020f0;">setq</span> icons-in-terminal-scale-factor 1.0)))

(<span style="color: #a020f0;">cond</span> ((<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">icons-in-terminal</span> nil t)
       (add-hook 'dired-mode-hook #'icons-in-terminal-dired-mode))
      ((<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">all-the-icons</span> nil t)
       (add-hook 'dired-mode-hook #'all-the-icons-dired-mode)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org402f1293" class="outline-3">
<h3 id="org402f1293"><span class="section-number-3">6.33.</span> [eldoc.el] コンテクストに応じてヘルプを表示</h3>
<div class="outline-text-3" id="text-org402f1293">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my:elisp-eldoc</span> (_callback)
  <span style="color: #8b2252;">"Avoid hiding `</span><span style="color: #008b8b;">hl-line</span><span style="color: #8b2252;">' in `</span><span style="color: #008b8b;">emacs-lisp-mode</span><span style="color: #8b2252;">'."</span>
  (<span style="color: #a020f0;">when</span> (fboundp 'hl-line-highlight)
    (hl-line-highlight)))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">ad:eldoc-message</span> (f <span style="color: #228b22;">&amp;optional</span> string)
  (<span style="color: #a020f0;">unless</span> (active-minibuffer-window)
    (funcall f string)))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(turn-on-eldoc-mode)
                         <span style="color: #8b2252;">"eldoc"</span> nil t)
  (<span style="color: #a020f0;">dolist</span> (hook '(emacs-lisp-mode-hook org-mode-hook c-mode-common-hook))
    (add-hook hook #'turn-on-eldoc-mode))
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"eldoc"</span>
    (advice-add 'elisp-eldoc-funcall <span style="color: #483d8b;">:after</span> #'my:elisp-eldoc)
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">(advice-add 'elisp-eldoc-var-docstring :after #'my:elisp-eldoc)</span>

    <span style="color: #b22222;">;; </span><span style="color: #b22222;">for ivy-mode</span>
    (advice-add 'eldoc-message <span style="color: #483d8b;">:around</span> #'ad:eldoc-message)

    (custom-set-variables
     '(eldoc-idle-delay 1.0))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org138fda77" class="outline-3">
<h3 id="org138fda77"><span class="section-number-3">6.34.</span> [go-eldoc.el] Go用の eldoc</h3>
<div class="outline-text-3" id="text-org138fda77">
<div class="org-src-container">
<pre class="src src-go">go get -v github.com/mdempsky/gocode
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"go-mode"</span>
  (<span style="color: #a020f0;">if</span> (executable-find <span style="color: #8b2252;">"gocode"</span>)
      (<span style="color: #a020f0;">when</span> (autoload-if-found '(go-mode)
                               <span style="color: #8b2252;">"go-eldoc"</span> nil t)
        (add-hook 'go-mode-hook #'go-eldoc-setup))
    (message <span style="color: #8b2252;">"--- gocode is NOT installed."</span>)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org7cab354d" class="outline-3">
<h3 id="org7cab354d"><span class="section-number-3">6.35.</span> [keycast.el] 入力しているキーとコマンドをモードラインに表示</h3>
<div class="outline-text-3" id="text-org7cab354d">
<ul class="org-ul">
<li>入力した文字や発行したコマンドキーをモードラインに表示．コマンドの名前もリアルタイムに表示される．</li>
<li><a href="https://github.com/tarsius/keycast">tarsius/keycast: Show current command and its key in the mode line</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">late-init.el</span>
(autoload-if-found '(keycast-mode) <span style="color: #8b2252;">"keycast"</span> nil t)
</pre>
</div>
</div>
</div>

<div id="outline-container-org8af73f26" class="outline-3">
<h3 id="org8af73f26"><span class="section-number-3">6.36.</span> [keypression.el] 入力しているキーとコマンドを任意の場所に表示</h3>
<div class="outline-text-3" id="text-org8af73f26">
<ul class="org-ul">
<li><code>keycast.el</code> は表示がモードラインに限定されますが， <code>keypression.el</code> は任意の場所に入力状況を表示できます．一般的なキーキャストアプリとほぼ同じ振る舞いになります．</li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(keypression-mode)
                         <span style="color: #8b2252;">"keypression"</span> nil t)
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"keypression"</span>
    (<span style="color: #a020f0;">setq</span> keypression-use-child-frame t)
    (<span style="color: #a020f0;">setq</span> keypression-frames-maxnum 3)
    (<span style="color: #a020f0;">setq</span> keypression-fade-out-delay 1.5)
    (<span style="color: #a020f0;">setq</span> keypression-font <span style="color: #8b2252;">"Monaco"</span>)
    (<span style="color: #a020f0;">setq</span> keypression-font-face-attribute
          '(<span style="color: #483d8b;">:width</span> normal <span style="color: #483d8b;">:height</span> 200 <span style="color: #483d8b;">:weight</span> bold))
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">(progn</span>
    <span style="color: #b22222;">;;   </span><span style="color: #b22222;">(setq keypression-frame-origin 'keypression-origin-top-left)</span>
    <span style="color: #b22222;">;;   </span><span style="color: #b22222;">(setq keypression-x-offset -10)</span>
    <span style="color: #b22222;">;;   </span><span style="color: #b22222;">(setq keypression-y-offset +10))</span>
    (<span style="color: #a020f0;">progn</span>
      (<span style="color: #a020f0;">setq</span> keypression-x-offset +8)
      (<span style="color: #a020f0;">setq</span> keypression-y-offset +16))
    (add-hook 'keypression-mode-hook #'dimmer-permanent-off)
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">(keypression-mode 1) ;; To start, M-x keypression-mode</span>
    ))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfa7d126f" class="outline-3">
<h3 id="orgfa7d126f"><span class="section-number-3">6.37.</span> [ivy.el] 続々・何でも絞り込みインターフェイス</h3>
<div class="outline-text-3" id="text-orgfa7d126f">
<p>
<code>helm</code> から <code>ivy</code> に乗り換えました．移行話は Qiita で（長編）記事にしました．
</p>

<ul class="org-ul">
<li><a href="https://qiita.com/takaxp/items/2fde2c119e419713342b">https://qiita.com/takaxp/items/2fde2c119e419713342b</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(ivy-hydra-read-action)
                         <span style="color: #8b2252;">"ivy-hydra"</span> nil t)

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">ivy-dispatching-done-hydra was depreciated in ivy 0.13</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">(with-eval-after-load "ivy-hydra"</span>
  <span style="color: #b22222;">;;   </span><span style="color: #b22222;">(defun ad:ivy-dispatching-done-hydra (f)</span>
  <span style="color: #b22222;">;;     </span><span style="color: #b22222;">(when (&gt; ivy--length 0)</span>
  <span style="color: #b22222;">;;       </span><span style="color: #b22222;">(funcall f)))</span>
  <span style="color: #b22222;">;;   </span><span style="color: #b22222;">(advice-add 'ivy-dispatching-done-hydra</span>
  <span style="color: #b22222;">;;               </span><span style="color: #b22222;">:around #'ad:ivy-dispatching-done-hydra))</span>
  )

</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-seq-sort-by</span> (function pred sequence)
  <span style="color: #8b2252;">"Sort SEQUENCE using PRED as a comparison function.</span>
<span style="color: #8b2252;">Elements of SEQUENCE are transformed by FUNCTION before being</span>
<span style="color: #8b2252;">sorted.  FUNCTION must be a function of one argument."</span>
  (seq-sort (<span style="color: #a020f0;">lambda</span> (a b)
              (funcall pred
                       (funcall function a)
                       (funcall function b)))
            sequence))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">ivy--sort-by-len</span> (name candidates)
  <span style="color: #8b2252;">"Sort CANDIDATES based on similarity of their length with NAME."</span>
  (<span style="color: #a020f0;">let</span> ((name-len (length name))
        (candidates-count (length candidates)))
    (<span style="color: #a020f0;">if</span> (&lt; 500 candidates-count)
        candidates
      (seq-sort-by #'length
                   (<span style="color: #a020f0;">lambda</span> (a b)
                     (&lt; (abs (- name-len a))
                        (abs (- name-len b))))
                   candidates))))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-disable-counsel-find-file</span> (<span style="color: #228b22;">&amp;rest</span> args)
  <span style="color: #8b2252;">"Disable `</span><span style="color: #008b8b;">counsel-find-file</span><span style="color: #8b2252;">' and use the original `</span><span style="color: #008b8b;">find-file</span><span style="color: #8b2252;">' with ARGS."</span>
  (<span style="color: #a020f0;">let</span> ((completing-read-function #'completing-read-default)
        (completion-in-region-function #'completion--in-region))
    (apply #'read-file-name-default args)))

<span style="color: #b22222;">;; </span><span style="color: #b22222;">Common actions for counsel-ag, counsel-fzf, and counsel-recentf</span>

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-counsel-fzf-in-default-dir</span> (_arg)
  <span style="color: #8b2252;">"Search the current directory with fzf."</span>
  (counsel-fzf ivy-text default-directory))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-counsel-fzf-in-dir</span> (_arg)
  <span style="color: #8b2252;">"Search again with new root directory."</span>
  (counsel-fzf ivy-text
               (read-directory-name
                (concat (car (split-string counsel-fzf-cmd))
                        <span style="color: #8b2252;">" in directory: "</span>))))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-counsel-ag-in-dir</span> (_arg)
  <span style="color: #8b2252;">"Search again with new root directory."</span>
  (<span style="color: #a020f0;">let</span> ((current-prefix-arg '(4)))
    (counsel-ag ivy-text nil <span style="color: #8b2252;">""</span>))) <span style="color: #b22222;">;; </span><span style="color: #b22222;">also disable extra-ag-args</span>

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-counsel-mark-ring</span> ()
  <span style="color: #8b2252;">"Browse `</span><span style="color: #008b8b;">mark-ring</span><span style="color: #8b2252;">' interactively.</span>
<span style="color: #8b2252;">Obeys `</span><span style="color: #008b8b;">widen-automatically</span><span style="color: #8b2252;">', which see."</span>
  (<span style="color: #a020f0;">interactive</span>)
  (<span style="color: #a020f0;">let*</span> ((counsel--mark-ring-calling-point (point))
         (marks (copy-sequence mark-ring))
         (marks (delete-dups marks))
         (marks
          <span style="color: #b22222;">;; </span><span style="color: #b22222;">mark-marker is empty?</span>
          (<span style="color: #a020f0;">if</span> (equal (mark-marker) (make-marker))
              marks
            (cons (copy-marker (mark-marker)) marks)))
         (candidates (counsel-mark--get-candidates marks)))
    (delete-dups candidates) <span style="color: #b22222;">;; </span><span style="color: #b22222;">[added] remove duplicated lines</span>
    (<span style="color: #a020f0;">if</span> candidates
        (counsel-mark--ivy-read <span style="color: #8b2252;">"Mark: "</span> candidates 'counsel-mark-ring)
      (message <span style="color: #8b2252;">"Mark ring is empty"</span>))
    counsel--mark-ring-calling-point)) <span style="color: #b22222;">;; </span><span style="color: #b22222;">To avoid an warning on lexical val.</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(counsel-ibuffer counsel-M-x counsel-yank-pop)
                         <span style="color: #8b2252;">"counsel"</span> nil t)

  (global-set-key (kbd <span style="color: #8b2252;">"M-x"</span>) 'counsel-M-x)
  (global-set-key (kbd <span style="color: #8b2252;">"M-y"</span>) 'counsel-yank-pop)
  (global-set-key (kbd <span style="color: #8b2252;">"C-,"</span>) 'counsel-mark-ring)
  (global-set-key (kbd <span style="color: #8b2252;">"C-x C-b"</span>) 'counsel-ibuffer)
  (global-set-key (kbd <span style="color: #8b2252;">"C-M-g"</span>) 'ivy-resume)

  (<span style="color: #a020f0;">unless</span> (fboundp 'seq-sort-by) <span style="color: #b22222;">;; </span><span style="color: #b22222;">emacs25</span>
    (<span style="color: #a020f0;">defalias</span> '<span style="color: #0000ff;">seq-sort-by</span> 'my-seq-sort-by))

  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"flyspell"</span>
    (define-key flyspell-mode-map (kbd <span style="color: #8b2252;">"C-,"</span>) 'counsel-mark-ring))

  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"org"</span>
    (define-key org-mode-map (kbd <span style="color: #8b2252;">"C-,"</span>) 'counsel-mark-ring))

  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"ivy"</span>
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#21516;&#19968;&#34892;&#12395;&#35079;&#25968;&#12398; mark &#12364;&#12354;&#12427;&#22580;&#21512;&#65292;&#19968;&#12388;&#12384;&#12369;&#12434;&#20505;&#35036;&#12392;&#12375;&#12390;&#34920;&#31034;&#12377;&#12427;&#65294;</span>
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">mark &#12434;&#27491;&#30906;&#12395;&#36799;&#12428;&#12394;&#12367;&#12394;&#12427;&#12364;&#65292;&#24403;&#35442;&#34892;&#12395;&#31227;&#21205;&#12391;&#12365;&#12427;&#12371;&#12392;&#12434;&#37325;&#35222;&#65294;</span>
    (advice-add 'counsel-mark-ring <span style="color: #483d8b;">:override</span> #'my-counsel-mark-ring)

    <span style="color: #b22222;">;; </span><span style="color: #b22222;">counsel-mark-ring &#12398;&#12522;&#12473;&#12488;&#12434;&#12477;&#12540;&#12488;&#12373;&#12379;&#12394;&#12356;</span>
    (<span style="color: #a020f0;">setf</span> (alist-get 'counsel-mark-ring ivy-sort-functions-alist) nil)

    <span style="color: #b22222;">;; </span><span style="color: #b22222;">M-o &#12434; ivy-dispatching-done-hydra &#12395;&#21106;&#12426;&#24403;&#12390;&#12427;&#65294;</span>
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">(define-key ivy-minibuffer-map (kbd "M-o") 'ivy-dispatching-done-hydra)</span>
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">ivy-dispatching-done &#12434;&#20351;&#12358;&#65294;</span>
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">(define-key ivy-minibuffer-map (kbd "M-o") 'ivy-dispatching-done)</span>
    (<span style="color: #a020f0;">setq</span> ivy-read-action-function #'ivy-hydra-read-action)

    (<span style="color: #a020f0;">setq</span> ivy-use-virtual-buffers nil)
    (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">setq</span> enable-recursive-minibuffers t)
      (minibuffer-depth-indicate-mode 1))
    (define-key ivy-minibuffer-map (kbd <span style="color: #8b2252;">"&lt;escape&gt;"</span>) 'minibuffer-keyboard-quit)
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">(setq ivy-truncate-lines nil) ;; &#36984;&#25246;&#20505;&#35036;&#12418;&#25240;&#12426;&#36820;&#12373;&#12428;&#12390;&#12375;&#12414;&#12358;&#65294;</span>
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">(setq ivy-wrap t)</span>
    (ivy-mode 1))

  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"counsel"</span>
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">counsel-M-x, see also prescient.el section</span>
    (<span style="color: #a020f0;">setq</span> ivy-initial-inputs-alist
          '((org-agenda-refile . <span style="color: #8b2252;">"^"</span>)
            (org-capture-refile . <span style="color: #8b2252;">"^"</span>)
            (counsel-describe-function . <span style="color: #8b2252;">"^"</span>)
            (counsel-describe-variable . <span style="color: #8b2252;">"^"</span>)
            (Man-completion-table . <span style="color: #8b2252;">"^"</span>)
            (woman . <span style="color: #8b2252;">"^"</span>)))

    (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">smex</span> nil t)
      (<span style="color: #a020f0;">setq</span> smex-history-length 35)
      (<span style="color: #a020f0;">setq</span> smex-completion-method 'ivy))

    <span style="color: #b22222;">;;  </span><span style="color: #b22222;">https://github.com/abo-abo/swiper/issues/1294</span>
    (<span style="color: #a020f0;">setf</span> (alist-get 'counsel-M-x ivy-sort-matches-functions-alist)
          #'ivy--sort-by-len)

    <span style="color: #b22222;">;; </span><span style="color: #b22222;">Disable counsel-find-file</span>
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">https://emacs.stackexchange.com/questions/45929/disable-ivy-for-find-file</span>
    (<span style="color: #a020f0;">setq</span> read-file-name-function #'my-disable-counsel-find-file)
    (define-key counsel-mode-map [remap find-file]  nil)

    <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#12458;&#12522;&#12472;&#12490;&#12523;&#12434;&#38750;&#12452;&#12531;&#12479;&#12521;&#12463;&#12486;&#12451;&#12502;&#21270;&#65288;&#19978;&#26360;&#12365;&#12391;&#21487;&#65294;advice&#19981;&#21487;&#65289;</span>
    (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">find-func</span> nil t)
      (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">find-library</span> (library)
        <span style="color: #8b2252;">"Override the original `</span><span style="color: #008b8b;">find-library</span><span style="color: #8b2252;">' to hide in command list."</span>
        (<span style="color: #a020f0;">prog1</span>
            (switch-to-buffer (find-file-noselect (find-library-name library)))
          (run-hooks 'find-function-after-hook))))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org9c962eaf" class="outline-3">
<h3 id="org9c962eaf"><span class="section-number-3">6.38.</span> [ivy.el] プロンプトをカスタマイズ</h3>
<div class="outline-text-3" id="text-org9c962eaf">
<p>
<code>ivy-pre-prompt-function</code> に文字列を返す任意の関数を与えると，プロンプトの前を修飾できます．好みの情報を出力しましょう．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-pre-prompt-function</span> ()
  (<span style="color: #a020f0;">cond</span> (window-system
         (format <span style="color: #8b2252;">"%s%s "</span>
                 (<span style="color: #a020f0;">if</span> my-toggle-modeline-global <span style="color: #8b2252;">""</span> <span style="color: #b22222;">;; </span><span style="color: #b22222;">FIXME</span>
                   (concat (make-string (frame-width) ?\x5F) <span style="color: #8b2252;">"\n"</span>)) <span style="color: #b22222;">;; </span><span style="color: #b22222;">"__"</span>
                 (<span style="color: #a020f0;">cond</span> ((<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">icons-in-terminal</span> nil t)
                        (icons-in-terminal-material <span style="color: #8b2252;">"playlist_add_check"</span>))
                       ((<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">all-the-icons</span> nil t)
                        (all-the-icons-material <span style="color: #8b2252;">"playlist_add_check"</span>))
                       (t <span style="color: #8b2252;">""</span>))))
        <span style="color: #b22222;">;; </span><span style="color: #b22222;">((eq system-type 'windows-nt)</span>
        <span style="color: #b22222;">;;  </span><span style="color: #b22222;">(format "%s%s "</span>
        <span style="color: #b22222;">;;          </span><span style="color: #b22222;">(if my-toggle-modeline-global "" ;; FIXME</span>
        <span style="color: #b22222;">;;            </span><span style="color: #b22222;">(concat (make-string (frame-width) ?\x5F) "\n")) ;; "__"</span>
        <span style="color: #b22222;">;;          </span><span style="color: #b22222;">"&gt;&gt;"))</span>
        (t
         (format <span style="color: #8b2252;">"%s\n"</span> (make-string (1- (frame-width)) ?\x2D)))))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">&#12503;&#12525;&#12531;&#12503;&#12488;&#12434;&#12459;&#12473;&#12479;&#12510;&#12452;&#12474;</span>
(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"ivy"</span>
  (<span style="color: #a020f0;">setq</span> ivy-pre-prompt-function #'my-pre-prompt-function))
</pre>
</div>
</div>
</div>

<div id="outline-container-org45b3667a" class="outline-3">
<h3 id="org45b3667a"><span class="section-number-3">6.39.</span> [imenu-list.el] サイドバー的にファイル内容の目次要素を表示</h3>
<div class="outline-text-3" id="text-org45b3667a">
<ul class="org-ul">
<li><a href="https://github.com/takaxp/imenu-list">takaxp/imenu-list: Emacs plugin to show the current buffer's imenu entries in a seperate buffer</a></li>
</ul>

<p>
↑のリポジトリは，オリジナルのコードに対して次の修正を加えています．
</p>
<ol class="org-ol">
<li>トップレベルのツリーで ENT する時，カーソルが imenu-list 側に残さない</li>
<li>最初の試行で imenu-list のバッファを生成できない時に以後のフローを正しく動かす</li>
</ol>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-truncate-lines-activate</span> ()
  <span style="color: #8b2252;">"Truncate lines on `</span><span style="color: #008b8b;">imenu-list</span><span style="color: #8b2252;">' buffer."</span>
  (toggle-truncate-lines 1))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-imenu-list-update</span> ()
  <span style="color: #8b2252;">"Expand frame width by `</span><span style="color: #008b8b;">moom-change-frame-width</span><span style="color: #8b2252;">'."</span>
  (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">and</span> (memq imenu-list-position '(right left))
             (not (get-buffer-window imenu-list-buffer-name t)))
    (moom-change-frame-width (+ (frame-width) imenu-list-size))))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-imenu-list-quit-window</span> ()
  <span style="color: #8b2252;">"Shrink frame width by `</span><span style="color: #008b8b;">moom-change-frame-width</span><span style="color: #8b2252;">'."</span>
  (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">and</span> (memq imenu-list-position '(right left))
             (not (get-buffer-window imenu-list-buffer-name t)))
    (moom-change-frame-width (- (frame-width) imenu-list-size))))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(imenu-list)
                         <span style="color: #8b2252;">"imenu-list"</span> nil t)
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"imenu-list"</span>
    (<span style="color: #a020f0;">setq</span> imenu-list-size 40)
    (<span style="color: #a020f0;">setq</span> imenu-list-position 'left)

    (add-hook 'imenu-list-major-mode-hook #'my-truncate-lines-activate)

    (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">moom</span> nil t)
      (add-hook 'imenu-list-update-hook #'my-imenu-list-update)
      (advice-add 'imenu-list-quit-window <span style="color: #483d8b;">:after</span> #'my-imenu-list-quit-window))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org29951da5" class="outline-3">
<h3 id="org29951da5"><span class="section-number-3">6.40.</span> [prescient.el] リスト項目の並び替えとイニシャル入力機能（ivy and company）</h3>
<div class="outline-text-3" id="text-org29951da5">
<p>
コマンド履歴を保存．コマンドのイニシャル入力を可能にする．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"prescient"</span>
  (<span style="color: #a020f0;">setq</span> prescient-aggressive-file-save t) <span style="color: #b22222;">;; </span><span style="color: #b22222;">Merged!</span>
  (<span style="color: #a020f0;">setq</span> prescient-save-file
        (expand-file-name <span style="color: #8b2252;">"~/.emacs.d/prescient-save.el"</span>))
  (prescient-persist-mode 1))

(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"ivy"</span>
  (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">and</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">prescient</span> nil t)
             (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">ivy-prescient</span> nil t))
    (<span style="color: #a020f0;">setq</span> ivy-prescient-retain-classic-highlighting t)
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">(dolist (command '(counsel-world-clock ;; Merged!</span>
    <span style="color: #b22222;">;;                    </span><span style="color: #b22222;">counsel-app))</span>
    <span style="color: #b22222;">;;   </span><span style="color: #b22222;">(add-to-list 'ivy-prescient-sort-commands command t))</span>
    (ivy-prescient-mode 1)
    (<span style="color: #a020f0;">setf</span> (alist-get 'counsel-M-x ivy-re-builders-alist)
          #'ivy-prescient-re-builder)
    (<span style="color: #a020f0;">setf</span> (alist-get t ivy-re-builders-alist) #'ivy--regex-ignore-order)))

(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"company"</span>
  (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">and</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">prescient</span> nil t)
             (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">company-prescient</span> nil t))
    (company-prescient-mode 1)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orga3715560" class="outline-3">
<h3 id="orga3715560"><span class="section-number-3">6.41.</span> [command-log-mode.el] 発行したコマンドの履歴をバッファに表示する</h3>
<div class="outline-text-3" id="text-orga3715560">
<p>
入力したコマンドの履歴をバッファに表示してくれます．Emacsのバッファを表示しながらお話する時に便利です．
</p>

<p>
プレゼンテーションという点で，さらに，キーキャストを実現する <code>keypression.el</code> と， Org Mode のプレゼンツールである <code>org-tree-slide.el</code> と組み合わせることで，視覚的なサポートが完成します．
</p>

<p>
<code>command-log-mode.el</code> の出力は，フレームの横幅を拡張してできる空間に表示するようにしています．フレームサイズの制御は <code>moom.el</code> で簡単にできます．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-command-log-mode-activate</span> ()
  (<span style="color: #a020f0;">interactive</span>)
  (keypression-mode 1)
  (global-command-log-mode 1)
  (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">moom</span> nil t)
    (moom-delete-windows)
    (moom-change-frame-width 140)
    (moom--stay-in-region)
    (clm/open-command-log-buffer)))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-command-log-mode-deactivate</span> ()
  (<span style="color: #a020f0;">interactive</span>)
  (keypression-mode -1)
  (global-command-log-mode -1)
  (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">moom</span> nil t)
    (moom-delete-windows)))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(command-log-mode global-command-log-mode)
                         <span style="color: #8b2252;">"command-log-mode"</span> nil t)
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"command-log-mode"</span>
    (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">keypression</span>)
    (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">moom</span>)
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">(setq command-log-mode-window-font-size 0)</span>
    (<span style="color: #a020f0;">setq</span> command-log-mode-window-size 60)))
</pre>
</div>
</div>
</div>
<div id="outline-container-orga6eb6883" class="outline-3">
<h3 id="orga6eb6883"><span class="section-number-3">6.42.</span> <span class="todo TODO">TODO</span> [emacs-tree-sitter.el] tree-sitter でシンタックスハイライトする</h3>
<div class="outline-text-3" id="text-orga6eb6883">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-enable-tree-sitter</span> ()
  (<span style="color: #a020f0;">unless</span> (<span style="color: #a020f0;">featurep</span> '<span style="color: #008b8b;">tree-sitter</span>)
    (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">tree-sitter</span>)
    (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">tree-sitter-hl</span>)
    (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">tree-sitter-debug</span>)
    (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">tree-sitter-query</span>)
    (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">tree-sitter-langs</span>))
  (tree-sitter-hl-mode))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">let*</span> ((elp (expand-file-name
                   (concat <span style="color: #8b2252;">"~/.emacs.d/"</span> (format <span style="color: #8b2252;">"%s"</span> emacs-version) <span style="color: #8b2252;">"/el-get/"</span>)))
       (ets (concat elp <span style="color: #8b2252;">"emacs-tree-sitter/"</span>))
       (tsl (concat elp <span style="color: #8b2252;">"tree-sitter-langs/"</span>)))
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">(add-to-list 'load-path (concat ets "langs"))</span>
  (add-to-list 'load-path (concat ets <span style="color: #8b2252;">"core"</span>))
  (add-to-list 'load-path (concat ets <span style="color: #8b2252;">"lisp"</span>))
  (add-to-list 'load-path tsl))

(<span style="color: #a020f0;">dolist</span> (hook '(js-mode-hook))
  (add-hook hook #'my-enable-tree-sitter))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf0e91c5a" class="outline-3">
<h3 id="orgf0e91c5a"><span class="section-number-3">6.43.</span> <span class="todo TODO">TODO</span> [swiper.el] 文字列探索とプレビューを同時に行う</h3>
<div class="outline-text-3" id="text-orgf0e91c5a">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">ad:swiper-thing-at-point</span> ()
  <span style="color: #8b2252;">"`</span><span style="color: #008b8b;">swiper</span><span style="color: #8b2252;">' with `</span><span style="color: #008b8b;">ivy-thing-at-point</span><span style="color: #8b2252;">'."</span>
  (<span style="color: #a020f0;">interactive</span>)
  (<span style="color: #a020f0;">let</span> ((thing (<span style="color: #a020f0;">if</span> (thing-at-point-looking-at <span style="color: #8b2252;">"^\\*+"</span>) <span style="color: #b22222;">;; </span><span style="color: #b22222;">org heading &#12434;&#38500;&#22806;</span>
                   nil
                 (ivy-thing-at-point))))
    (<span style="color: #a020f0;">when</span> (use-region-p)
      (deactivate-mark))
    (swiper thing)))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(swiper-thing-at-point swiper-all-thing-at-point)
                         <span style="color: #8b2252;">"swiper"</span> nil t)
  (global-set-key (kbd <span style="color: #8b2252;">"M-s M-s"</span>) 'swiper-thing-at-point)
  (global-set-key (kbd <span style="color: #8b2252;">"M-s M-a"</span>) 'swiper-all-thing-at-point)
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"swiper"</span>
    (advice-add 'swiper-thing-at-point <span style="color: #483d8b;">:override</span> #'ad:swiper-thing-at-point)))
</pre>
</div>
</div>
</div>
<div id="outline-container-org3d431f2e" class="outline-3">
<h3 id="org3d431f2e"><span class="section-number-3">6.44.</span> <span class="todo TODO">TODO</span> [all-the-icons-ivy] ivy インターフェイスでアイコンを表示する</h3>
<div class="outline-text-3" id="text-org3d431f2e">
<ul class="org-ul">
<li><a href="https://github.com/asok/all-the-icons-ivy">https://github.com/asok/all-the-icons-ivy</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (eq system-type 'darwin)
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"ivy"</span>
    (<span style="color: #a020f0;">cond</span> ((<span style="color: #a020f0;">and</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">icons-in-terminal</span> nil t) <span style="color: #b22222;">;; </span><span style="color: #b22222;">safeguard</span>
                (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">icons-in-terminal-ivy</span> nil t))
           (<span style="color: #a020f0;">dolist</span> (command '(counsel-projectile-switch-project
                              counsel-ibuffer))
             (add-to-list 'icons-in-terminal-ivy-buffer-commands command))
           (icons-in-terminal-ivy-setup))
          ((<span style="color: #a020f0;">and</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">all-the-icons</span> nil t) <span style="color: #b22222;">;; </span><span style="color: #b22222;">safeguard</span>
                (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">all-the-icons-ivy</span> nil t))
           (<span style="color: #a020f0;">dolist</span> (command '(counsel-projectile-switch-project
                              counsel-ibuffer))
             (add-to-list 'all-the-icons-ivy-buffer-commands command))
           (all-the-icons-ivy-setup)))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org5eaeb687" class="outline-3">
<h3 id="org5eaeb687"><span class="section-number-3">6.45.</span> <span class="todo TODO">TODO</span> [rainbow-delimiters.el] 対応するカッコに色を付ける</h3>
<div class="outline-text-3" id="text-org5eaeb687">
<p>
複数のカッコが重なる言語では，カッコの対応関係がひと目で理解し難い場合があります． <code>rainbow-delimiters</code> を使うと，対応するカッコを七色に色付けして見やすくできます．デフォルトだと色がパステル調で薄いので，パラメータを追加して調整します．
</p>

<p>
<code>org-block</code> 内でうまく動かないようなので，本格導入は様子見中です．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"rainbow-delimiters"</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">https://yoo2080.wordpress.com/2013/12/21/small-rainbow-delimiters-tutorial/</span>
  (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">cl-lib</span>)
  (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">color</span>)
  (<span style="color: #a020f0;">cl-loop</span>
   for index from 1 to rainbow-delimiters-max-face-count
   do
   (<span style="color: #a020f0;">let</span> ((face (intern (format <span style="color: #8b2252;">"rainbow-delimiters-depth-%d-face"</span> index))))
     (<span style="color: #a020f0;">cl-callf</span> color-saturate-name (face-foreground face) 50))))

(add-hook 'prog-mode-hook
          (<span style="color: #a020f0;">lambda</span> ()
              (<span style="color: #a020f0;">unless</span> (equal (buffer-name) <span style="color: #8b2252;">"*scratch*"</span>)
                (rainbow-delimiters-mode))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org7270262d" class="outline-3">
<h3 id="org7270262d"><span class="section-number-3">6.46.</span> <span class="todo TODO">TODO</span> [yascroll.el] フリンジにスクロールバーを出す</h3>
<div class="outline-text-3" id="text-org7270262d">
<p>
<code>yascroll</code> を使います．
</p>

<ul class="org-ul">
<li><a href="http://d.hatena.ne.jp/m2ym/20110401/1301617991">http://d.hatena.ne.jp/m2ym/20110401/1301617991</a></li>
<li>2015-03-15: smooth-scroll との組み合わせで重いのを確認．</li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"postpone"</span>
  (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">yascroll</span> nil t)
    (<span style="color: #a020f0;">setq</span> yascroll:delay-to-hide 2)
    (<span style="color: #a020f0;">setq</span> yascroll:disabled-modes '(org-mode))
    (set-face-foreground 'yascroll:thumb-fringe <span style="color: #8b2252;">"#b2cefb"</span>)
    (set-face-background 'yascroll:thumb-fringe <span style="color: #8b2252;">"#b2cefb"</span>)
    (<span style="color: #a020f0;">unless</span> noninteractive
      (global-yascroll-bar-mode 1))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org8ba0784e" class="outline-3">
<h3 id="org8ba0784e"><span class="section-number-3">6.47.</span> <span class="todo TODO">TODO</span> [dimmer.el] 現在のバッファ以外の輝度を落とす</h3>
<div class="outline-text-3" id="text-org8ba0784e">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-toggle-dimmer</span> ()
  (<span style="color: #a020f0;">interactive</span>)
  (<span style="color: #a020f0;">if</span> (<span style="color: #a020f0;">setq</span> my-dimmer-mode (not my-dimmer-mode))
                  (dimmer-on) (dimmer-off)))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">dimmer-permanent-off</span> ()
  (<span style="color: #a020f0;">setq</span> my-dimmer-mode nil)
  (dimmer-off))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">dimmer-off</span> ()
  (dimmer-process-all)
  (dimmer-mode -1))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">dimmer-on</span> ()
  (<span style="color: #a020f0;">when</span> my-dimmer-mode
          (dimmer-mode 1)
          (dimmer-process-all)))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-dimmer-update</span> ()
        (<span style="color: #a020f0;">if</span> (frame-focus-state) (dimmer-on) (dimmer-off)))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">ad:dimmer-org-agenda--quit</span> (<span style="color: #228b22;">&amp;optional</span> _bury)
  (<span style="color: #a020f0;">when</span> (fboundp 'dimmer-on)
          (<span style="color: #a020f0;">setq</span> my-dimmer-mode t)
          (dimmer-on)
          (redraw-frame)))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-dimmer-activate</span> ()
  (<span style="color: #a020f0;">setq</span> my-dimmer-mode (dimmer-mode 1))
  (remove-hook 'window-configuration-change-hook #'my-dimmer-activate))<span style="color: #b22222;">;; </span><span style="color: #b22222;">FIXME</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(dimmer-mode
                           dimmer-process-all dimmer-off dimmer-on
                           my-toggle-dimmer dimmer-permanent-off
                           ad:dimmer-org-agenda--quit)
                         <span style="color: #8b2252;">"dimmer"</span> nil t)
  (<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">my-dimmer-mode</span> nil)
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"dimmer"</span>
    (custom-set-variables
     '(dimmer-exclusion-regexp
       <span style="color: #8b2252;">"^\\*[Hh]elm</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">|</span><span style="color: #8b2252;">^ \\*Minibuf</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">|</span><span style="color: #8b2252;">^\\*scratch</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">|</span><span style="color: #8b2252;">^ \\*Neo</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">|</span><span style="color: #8b2252;">^ \\*Echo</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">|</span><span style="color: #8b2252;">^\\*Calendar</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">|</span><span style="color: #8b2252;">*Org</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">|</span><span style="color: #8b2252;">^ \\*LV*"</span>)
     '(dimmer-fraction 0.6))

    (<span style="color: #a020f0;">if</span> (version&lt; emacs-version <span style="color: #8b2252;">"27.1"</span>)
        (<span style="color: #a020f0;">progn</span>
          (add-hook 'focus-out-hook #'dimmer-off)
          (add-hook 'focus-in-hook #'dimmer-on))
      (<span style="color: #a020f0;">add-function</span> <span style="color: #483d8b;">:before</span> after-focus-change-function #'my-dimmer-update))

    <span style="color: #b22222;">;; </span><span style="color: #b22222;">for org-agenda</span>
    (add-hook 'org-agenda-mode-hook #'dimmer-permanent-off)
    (advice-add 'org-agenda--quit <span style="color: #483d8b;">:after</span> #'ad:dimmer-org-agenda--quit)

    <span style="color: #b22222;">;; </span><span style="color: #b22222;">for swiper/helm-swoop</span>
    (add-hook 'minibuffer-setup-hook #'dimmer-off)
    (add-hook 'minibuffer-exit-hook #'dimmer-on))

  (<span style="color: #a020f0;">unless</span> noninteractive
    (<span style="color: #a020f0;">unless</span> (version&lt; <span style="color: #8b2252;">"28.0"</span> emacs-version)
      <span style="color: #b22222;">;; </span><span style="color: #b22222;">FIXME</span>
      (add-hook 'window-configuration-change-hook #'my-dimmer-activate))))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdef403ec" class="outline-3">
<h3 id="orgdef403ec"><span class="section-number-3">6.48.</span> <span class="todo TODO">TODO</span> [transient.el] コマンドディスパッチャを構築する</h3>
<div class="outline-text-3" id="text-orgdef403ec">
<p>
<code>autoload-if-found</code> を使ういつもの設定では正しく動作しないので， <code>eval-when-compile</code> を使用して require しています．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">&#12371;&#12398;&#22580;&#21512;&#12399;&#65292;interactive &#12514;&#12540;&#12489;&#12391; init-eval.el &#12395;&#12354;&#12427;&#35352;&#36848;&#12434;&#12525;&#12540;&#12489;&#12377;&#12427;&#12399;&#12384;&#12417;&#65294;</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">(eval-when-compile</span>
<span style="color: #b22222;">;;   </span><span style="color: #b22222;">(message "Loading transient...")</span>
<span style="color: #b22222;">;;   </span><span style="color: #b22222;">(require 'transient))</span>

(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"transient"</span>
  (<span style="color: #a020f0;">transient-define-prefix</span> my-org-bullet-and-checkbox ()
    <span style="color: #8b2252;">"Commands to handle bullet and checkbox"</span>
    [[<span style="color: #8b2252;">"Bullet"</span>
      (<span style="color: #8b2252;">"i"</span> <span style="color: #8b2252;">"insert"</span> my-org-insert-bullet)
      (<span style="color: #8b2252;">"d"</span> <span style="color: #8b2252;">"delete"</span> my-org-delete-bullet)]
     [<span style="color: #8b2252;">"Checkbox"</span>
      (<span style="color: #8b2252;">"["</span> <span style="color: #8b2252;">"insert"</span> my-org-insert-checkbox-into-bullet)
      (<span style="color: #8b2252;">"]"</span> <span style="color: #8b2252;">"delete"</span> my-org-delete-checkbox-from-bullet)
      <span style="color: #b22222;">;;</span><span style="color: #b22222;">("a" "toggle checkbox" my-org-toggle-checkbox)</span>
      <span style="color: #b22222;">;;</span><span style="color: #b22222;">("h" "cycle" my-cycle-bullet-at-heading) ;; single line</span>
      ]
     [<span style="color: #8b2252;">"Bullet and Checkbox"</span>
      (<span style="color: #8b2252;">"I"</span> <span style="color: #8b2252;">"insert"</span> my-org-insert-bullet-and-checkbox)
      (<span style="color: #8b2252;">"D"</span> <span style="color: #8b2252;">"delete"</span> my-org-delete-bullet-and-checkbox)]]))
</pre>
</div>
</div>
</div>

<div id="outline-container-org1e701627" class="outline-3">
<h3 id="org1e701627"><span class="section-number-3">6.49.</span> <span class="done DONE">DONE</span> [hydra.el] コマンドディスパッチャを構築する&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></h3>
<div class="outline-text-3" id="text-org1e701627">
<ul class="org-ul">
<li><a href="https://www.wisdomandwonder.com/article/10763/emacsorg-mode-hydra-to-insert-timestamps">(Emacs+Org-Mode) Hydra To Insert Timestamps | Wisdom and Wonder</a></li>
<li><a href="https://oremacs.com/2016/04/04/hydra-doc-syntax/">Extended syntax for hydra docstrings · (or emacs</a></li>
</ul>

<p>
ディスパッチャ内の <code>docstring</code> には， <code>?x?</code> の形式で評価値を反映できる．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">late-init.el</span>
(<span style="color: #a020f0;">when</span> (autoload-if-found '(hydra-timestamp/body help/insert-datestamp)
                         <span style="color: #8b2252;">"hydra"</span> nil t)
  (global-set-key (kbd <span style="color: #8b2252;">"C-c h t"</span>) #'hydra-timestamp/body)
  (global-set-key (kbd <span style="color: #8b2252;">"C-c 0"</span>) #'help/insert-datestamp)
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"hydra"</span>
    (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">org</span> nil t)
    (global-set-key (kbd <span style="color: #8b2252;">"C-c )"</span>) #'help/insert-currenttime)
    (custom-set-faces
     '(hydra-face-blue
       ((((background light))
         <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"orange red"</span> <span style="color: #483d8b;">:bold</span> t)
        (((background dark))
         <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"orange"</span> <span style="color: #483d8b;">:bold</span> t))))

    (defhydra hydra-timestamp (<span style="color: #483d8b;">:color</span> blue <span style="color: #483d8b;">:hint</span> none)
      <span style="color: #8b2252;">"</span>
<span style="color: #8b2252;">   === Timestamp ===</span>
<span style="color: #8b2252;">0. <i class="far fa-hand-point-right"></i> ?i? (_i_so 8601)   <i class="far fa-hand-point-right"></i> ?n? (_n_ow)   <i class="far fa-hand-point-right"></i> ?w? (_w_eek)   <i class="far fa-hand-point-right"></i> ?a? (week-d_a_y)</span>
<span style="color: #8b2252;">_1_. <i class="far fa-hand-point-right"></i> ?t? (ISO 8601 including _t_imezone)</span>
<span style="color: #8b2252;">_2_. <i class="far fa-hand-point-right"></i> ?r?    (Org Mode: _r_ight now)</span>
<span style="color: #8b2252;">_3_. <i class="far fa-hand-point-right"></i> ?s?          (Org Mode: by _s_elect)                             _q_uit</span>
<span style="color: #8b2252;">"</span>
      (<span style="color: #8b2252;">"q"</span> nil)
      (<span style="color: #8b2252;">"i"</span> help/insert-datestamp (format-time-string <span style="color: #8b2252;">"%F"</span>))
      (<span style="color: #8b2252;">"n"</span> help/insert-currenttime (format-time-string <span style="color: #8b2252;">"%H:%M"</span>))
      (<span style="color: #8b2252;">"w"</span> help/insert-week (format-time-string <span style="color: #8b2252;">"%W"</span>))
      (<span style="color: #8b2252;">"a"</span> help/insert-month-and-day (format-time-string <span style="color: #8b2252;">"%m%d"</span>))
      (<span style="color: #8b2252;">"t"</span> help/insert-timestamp (help/get-timestamp))
      (<span style="color: #8b2252;">"r"</span> help/org-time-stamp-with-seconds-now
       (format-time-string <span style="color: #8b2252;">"&lt;%F %a %H:%M&gt;"</span>))
      (<span style="color: #8b2252;">"s"</span> org-time-stamp (format-time-string <span style="color: #8b2252;">"&lt;%F %a&gt;"</span>))
      (<span style="color: #8b2252;">"0"</span> help/show-my-date)
      (<span style="color: #8b2252;">"1"</span> help/insert-timestamp)
      (<span style="color: #8b2252;">"2"</span> help/org-time-stamp-with-seconds-now)
      (<span style="color: #8b2252;">"3"</span> org-time-stamp))

    (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">help/show-my-date</span> ()
      <span style="color: #8b2252;">"Produces and show date and time in preferred format."</span>
      (<span style="color: #a020f0;">interactive</span>)
      (message (format-time-string <span style="color: #8b2252;">"%Y-%m-%d (%a.) W:%W @%H:%M"</span>))
      (hydra-keyboard-quit))
    (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">help/insert-currenttime</span> ()
      <span style="color: #8b2252;">"Produces and inserts the current time."</span>
      (<span style="color: #a020f0;">interactive</span>)
      (insert (format-time-string <span style="color: #8b2252;">"%H:%M"</span>)))
    (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">help/insert-week</span> ()
      <span style="color: #8b2252;">"Produces and inserts the week number."</span>
      (<span style="color: #a020f0;">interactive</span>)
      (insert (format-time-string <span style="color: #8b2252;">"%W"</span>)))
    (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">help/insert-month-and-day</span> ()
      <span style="color: #8b2252;">"Inserts a month and day pair in 4-degits."</span>
      (<span style="color: #a020f0;">interactive</span>)
      (insert (format-time-string <span style="color: #8b2252;">"%m%d"</span>)))
    (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">help/insert-datestamp</span> ()
      <span style="color: #8b2252;">"Produces and inserts a partial ISO 8601 format timestamp."</span>
      (<span style="color: #a020f0;">interactive</span>)
      (insert (format-time-string <span style="color: #8b2252;">"%F"</span>)))
    (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">help/insert-timestamp</span> ()
      <span style="color: #8b2252;">"Inserts a full ISO 8601 format timestamp."</span>
      (<span style="color: #a020f0;">interactive</span>)
      (insert (help/get-timestamp)))
    (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">help/org-time-stamp-with-seconds-now</span> ()
      (<span style="color: #a020f0;">interactive</span>)
      (<span style="color: #a020f0;">let</span> ((current-prefix-arg '(16)))
        (call-interactively 'org-time-stamp)))
    (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">help/get-timestamp</span> ()
      <span style="color: #8b2252;">"Produces a full ISO 8601 format timestamp."</span>
      (<span style="color: #a020f0;">interactive</span>)
      (<span style="color: #a020f0;">let*</span> ((timestamp-without-timezone (format-time-string <span style="color: #8b2252;">"%Y-%m-%dT%T"</span>))
             (timezone-name-in-numeric-form (format-time-string <span style="color: #8b2252;">"%z"</span>))
             (timezone-utf-offset
              (concat (substring timezone-name-in-numeric-form 0 3)
                      <span style="color: #8b2252;">":"</span>
                      (substring timezone-name-in-numeric-form 3 5)))
             (timestamp (concat timestamp-without-timezone
                                timezone-utf-offset)))
        timestamp))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org56d8bf9d" class="outline-3">
<h3 id="org56d8bf9d"><span class="section-number-3">6.50.</span> <span class="done DONE">DONE</span> [helm.el] 続・何でも絞り込みインターフェイス&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></h3>
<div class="outline-text-3" id="text-org56d8bf9d">
<p>
ivyに移行しました．
</p>

<p>
<code>M-s</code> を <code>helm-swoop</code> にあてていましたが， <code>M-s</code> を入り口にたくさんの検索系コマンドが割り振られているため <code>M-s M-s</code> に変えました．なお， <code>C-M-r</code> は本来，正規表現での逆検索(<code>isearch-backward-regexp</code>)に割り振らています．また， <code>C-M-l</code> は本来， <code>reposition-window</code> に割り当てられています．
</p>

<p>
以下の設定では， <code>helm</code> に関連するモジュールも多数含まれます． <code>helm</code> がキックされるタイミングで有効化させます．
</p>

<ul class="org-ul">
<li>helm-google</li>
<li>helm-swoop</li>
<li>helm-projectile</li>
<li>helm-bm</li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(helm-google)
                         <span style="color: #8b2252;">"helm-google"</span> nil t)
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"helm-google"</span>
    (custom-set-variables
     '(helm-google-tld <span style="color: #8b2252;">"co.jp"</span>))))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(helm-swoop)
                         <span style="color: #8b2252;">"helm-swoop"</span> nil t)
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"postpone"</span>
    (global-set-key (kbd <span style="color: #8b2252;">"M-s M-s"</span>) 'helm-swoop))

  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"helm-swoop"</span>
    (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">helm-config</span> nil t)
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#12459;&#12540;&#12477;&#12523;&#12398;&#21336;&#35486;&#12364; org &#12398;&#35211;&#20986;&#12375;&#65288;*&#12398;&#38598;&#12414;&#12426;&#65289;&#12394;&#12425;&#26908;&#32034;&#23550;&#35937;&#12395;&#12375;&#12394;&#12356;&#65294;</span>
    (<span style="color: #a020f0;">setq</span> helm-swoop-pre-input-function
          (<span style="color: #a020f0;">lambda</span>()
            (<span style="color: #a020f0;">unless</span> (thing-at-point-looking-at <span style="color: #8b2252;">"^\\*+"</span>)
              (thing-at-point 'symbol))))
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#37197;&#33394;&#35373;&#23450;</span>
    (set-face-attribute
     'helm-swoop-target-line-face nil <span style="color: #483d8b;">:background</span> <span style="color: #8b2252;">"#FFEDDC"</span>)
    (set-face-attribute
     'helm-swoop-target-word-face nil <span style="color: #483d8b;">:background</span> <span style="color: #8b2252;">"#FF5443"</span>)))

(<span style="color: #a020f0;">when</span> (autoload-if-found '(helm-M-x
                           helm-buffers-list helm-recentf
                           helm-locate helm-descbinds
                           helm-occur helm-flycheck helm-bookmarks)
                         <span style="color: #8b2252;">"helm-config"</span> nil t)
  (global-set-key (kbd <span style="color: #8b2252;">"C-x C-b"</span>) 'helm-buffers-list)
  (global-set-key (kbd <span style="color: #8b2252;">"C-M-r"</span>) 'helm-recentf)
  (global-set-key (kbd <span style="color: #8b2252;">"M-x"</span>) 'helm-M-x)
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"postpone"</span>

    (global-set-key (kbd <span style="color: #8b2252;">"C-M-l"</span>) 'helm-locate)
    (global-set-key (kbd <span style="color: #8b2252;">"C-c f b"</span>) 'helm-bookmarks)
    (global-set-key (kbd <span style="color: #8b2252;">"C-c o"</span>) 'helm-occur)
    (global-set-key (kbd <span style="color: #8b2252;">"C-h d"</span>) 'helm-descbinds))

  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"projectile"</span>
    (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">helm-projectile</span> nil t)
      <span style="color: #b22222;">;; </span><span style="color: #b22222;">M-x helm-projectile-find-file (C-c p f)</span>
      (<span style="color: #a020f0;">setq</span> projectile-completion-system 'helm)
      <span style="color: #b22222;">;; </span><span style="color: #b22222;">projectile.el &#12398;&#12461;&#12540;&#12496;&#12452;&#12531;&#12489;&#12434;&#12458;&#12540;&#12496;&#12540;&#12521;&#12452;&#12489;</span>
      (helm-projectile-toggle 1)))

  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"helm-config"</span>
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">(when (require 'helm-files nil t)</span>
    <span style="color: #b22222;">;;   </span><span style="color: #b22222;">(define-key helm-find-files-map</span>
    <span style="color: #b22222;">;;     </span><span style="color: #b22222;">(kbd "&lt;tab&gt;") 'helm-execute-persistent-action)</span>
    <span style="color: #b22222;">;;   </span><span style="color: #b22222;">(define-key helm-read-file-map</span>
    <span style="color: #b22222;">;;     </span><span style="color: #b22222;">(kbd "&lt;tab&gt;") 'helm-execute-persistent-action))</span>

    (<span style="color: #a020f0;">when</span> (memq window-system '(mac ns))
      (<span style="color: #a020f0;">setq</span> helm-locate-command <span style="color: #8b2252;">"mdfind -name %s %s"</span>))

    <span style="color: #b22222;">;; </span><span style="color: #b22222;">(require 'helm-css-scss nil t)</span>
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">(require 'helm-emmet nil t)</span>
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">(require 'helm-descbinds nil t)</span>

    <span style="color: #b22222;">;; </span><span style="color: #b22222;">Configure helm-completing-read-handlers-alist after `(helm-mode 1)'</span>
    (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">helm</span> nil t)
      (helm-mode 1))

    <span style="color: #b22222;">;; </span><span style="color: #b22222;">helm-find-files &#12434;&#21628;&#12400;&#12379;&#12394;&#12356;</span>
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">(add-to-list 'helm-completing-read-handlers-alist '(find-file . nil))</span>
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">helm-mode-ag &#12434;&#21628;&#12400;&#12379;&#12394;&#12356;</span>
    (add-to-list 'helm-completing-read-handlers-alist '(ag . nil))
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">helm-mode-org-set-tags &#12434;&#21628;&#12400;&#12379;&#12394;&#12356;</span>
    (add-to-list 'helm-completing-read-handlers-alist '(org-set-tags . nil))

    (<span style="color: #a020f0;">setq</span> helm-display-source-at-screen-top nil)
    <span style="color: #b22222;">;;         </span><span style="color: #b22222;">(setq helm-display-header-line nil)</span>
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">helm-autoresize-mode &#12434;&#26377;&#21177;&#12395;&#12375;&#12388;&#12388; 30% &#12395;&#22266;&#23450;</span>
    (<span style="color: #a020f0;">setq</span> helm-autoresize-max-height 30)
    (<span style="color: #a020f0;">setq</span> helm-autoresize-min-height 30)
    (set-face-attribute 'helm-source-header nil
                        <span style="color: #483d8b;">:height</span> 1.0 <span style="color: #483d8b;">:family</span> <span style="color: #8b2252;">"Verdana"</span> <span style="color: #483d8b;">:weight</span> 'normal
                        <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#666666"</span> <span style="color: #483d8b;">:background</span> <span style="color: #8b2252;">"#DADADA"</span>)
    (helm-autoresize-mode 1)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc00267d7" class="outline-3">
<h3 id="orgc00267d7"><span class="section-number-3">6.51.</span> <span class="done DONE">DONE</span> バッテリー情報をモードラインに表示する&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></h3>
<div class="outline-text-3" id="text-orgc00267d7">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">Show battery information on the mode line.</span>
(display-battery-mode t)
</pre>
</div>
</div>
</div>

<div id="outline-container-org205dbe20" class="outline-3">
<h3 id="org205dbe20"><span class="section-number-3">6.52.</span> <span class="done DONE">DONE</span> [mode-icons] 使用中のモード表示をアイコンで代替&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></h3>
<div class="outline-text-3" id="text-org205dbe20">
<p>
しばらく使ってみたが，統一感が失われるので使用停止中．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">mode-icons</span> nil t)
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#12450;&#12452;&#12467;&#12531;&#12434;&#20445;&#23384;&#12375;&#12390;&#12356;&#12427;&#12487;&#12451;&#12524;&#12463;&#12488;&#12522;&#12434;&#25351;&#23450;</span>
  (<span style="color: #a020f0;">setq</span> mode-icons--directory
        (expand-file-name <span style="color: #8b2252;">"~/.emacs.d/.cask/package/icons"</span>))
  (mode-icons-mode 1))
</pre>
</div>
</div>
</div>

<div id="outline-container-org6e56a94f" class="outline-3">
<h3 id="org6e56a94f"><span class="section-number-3">6.53.</span> <span class="done DONE">DONE</span> [stock-ticker] 株価をモードラインに表示&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></h3>
<div class="outline-text-3" id="text-org6e56a94f">
<p>
季節が過ぎ去りました．不使用です．
</p>

<p>
日経平均やダウ平均の状況をモードラインに表示します．表示が長くなる傾向があるので， <code>stock-ticker--parse</code> を再定義して，銘柄（3桁のみ）と変動率だけを表示しています．
</p>

<p>
起動時には不要なので，ウィンドウにフォーカスが移った時に開始して，さらに1分でモードラインから消えるようにしています．
</p>

<p>
色々と不安定になってきたので，最近は使っていません．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(my-activate-stock-ticker stock-ticker-global-mode)
                         <span style="color: #8b2252;">"stock-ticker"</span> nil t)
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"stock-ticker"</span>
    (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">stock-ticker--parse</span> (data)
      <span style="color: #8b2252;">"Parse financial DATA into list of display strings."</span>
      (<span style="color: #a020f0;">let</span> ((qs (assoc-default
                 'quote (assoc-default
                         'results (assoc-default 'query data)))))
        (mapcar
         (<span style="color: #a020f0;">lambda</span> (q)
           (<span style="color: #a020f0;">let</span> ((percent (assoc-default 'PercentChange q))
                 (name (assoc-default 'Name q))
                 (symbol (assoc-default 'Symbol q))
                 (change (assoc-default 'Change q)))
             (format <span style="color: #8b2252;">" %s:%s"</span>
                     (substring
                      (<span style="color: #a020f0;">if</span> (<span style="color: #a020f0;">or</span>
                           (string-match <span style="color: #8b2252;">"="</span> symbol)
                           (string-match <span style="color: #8b2252;">"\\^"</span> symbol))
                          name symbol) <span style="color: #ff0000; font-weight: bold;">0 3)</span>
                     (<span style="color: #a020f0;">if</span> percent percent <span style="color: #8b2252;">""</span>))))
         qs)))
    (<span style="color: #a020f0;">setq</span> stock-ticker-display-interval 5)
    (<span style="color: #a020f0;">setq</span> stock-ticker-symbols '(<span style="color: #8b2252;">"^N225"</span> <span style="color: #8b2252;">"DOW"</span>))
    (<span style="color: #a020f0;">setq</span> stock-ticker-update-interval 300)

    (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-activate-stock-ticker</span> (<span style="color: #228b22;">&amp;optional</span> duration)
      <span style="color: #8b2252;">"Activate stock-ticker within the given duration."</span>
      (stock-ticker-global-mode 1)
      (<span style="color: #a020f0;">unless</span> (numberp duration)
        (<span style="color: #a020f0;">setq</span> duration 90))
      (run-with-timer duration nil 'stock-ticker-global-mode -1)))

  (add-hook 'focus-in-hook #'my-activate-stock-ticker))
</pre>
</div>
</div>
</div>

<div id="outline-container-org0ed58559" class="outline-3">
<h3 id="org0ed58559"><span class="section-number-3">6.54.</span> <span class="done DONE">DONE</span> [zlc.el] find-file バッファを zsh ライクにする&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></h3>
<div class="outline-text-3" id="text-org0ed58559">
<p>
ファイル選択を zsh ライクに変更できます．しっくりこないので不使用．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">zlc</span> nil t)
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">http://d.hatena.ne.jp/mooz/20101003/p1</span>
  (set-face-attribute 'zlc-selected-completion-face nil
                      <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#000000"</span> <span style="color: #483d8b;">:background</span> <span style="color: #8b2252;">"#9DFFD2"</span> <span style="color: #483d8b;">:bold</span> t)
  <span style="color: #b22222;">;;    </span><span style="color: #b22222;">(setq zlc-select-completion-immediately t)</span>
  (<span style="color: #a020f0;">let</span> ((map minibuffer-local-map))
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">like menu select</span>
    (define-key map (kbd <span style="color: #8b2252;">"C-n"</span>) 'zlc-select-next-vertical)
    (define-key map (kbd <span style="color: #8b2252;">"C-p"</span>) 'zlc-select-previous-vertical)
    (define-key map (kbd <span style="color: #8b2252;">"C-f"</span>) 'zlc-select-next)
    (define-key map (kbd <span style="color: #8b2252;">"C-b"</span>) 'zlc-select-previous)
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">reset selection</span>
    (define-key map (kbd <span style="color: #8b2252;">"C-c"</span>) 'zlc-reset))

  (zlc-mode 1))
</pre>
</div>
</div>
</div>

<div id="outline-container-org5cc37356" class="outline-3">
<h3 id="org5cc37356"><span class="section-number-3">6.55.</span> <span class="done DONE">DONE</span> [stripe-buffer.el] テーブルの色をストライプにする&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></h3>
<div class="outline-text-3" id="text-org5cc37356">
<p>
<a href="https://github.com/sabof/stripe-buffer/blob/master/stripe-buffer.el">stripe-buffer.el</a>を使います．重くツリーが多いOrgバッファだと激重になる可能性があります．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(turn-on-stripe-table-mode)
                         <span style="color: #8b2252;">"stripe-buffer"</span> nil t)
  (add-hook 'org-mode-hook #'turn-on-stripe-table-mode))
</pre>
</div>
</div>
</div>

<div id="outline-container-org62c6f085" class="outline-3">
<h3 id="org62c6f085"><span class="section-number-3">6.56.</span> <span class="done DONE">DONE</span> [guide-key] キーバインドの選択肢をポップアップする&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></h3>
<div class="outline-text-3" id="text-org62c6f085">
<p>
<code>which-key</code> に移行しました．
</p>

<p>
自分用の関数にキーバインドを付けたのはいいけど，覚えられない時に使っています．以下の例では， <code>helm</code> もしくは <code>org</code> が読み込まれた時についでに有効化し， <code>C-c f</code> を押して， 0.5秒経つと，その後ろに続くキーの一覧がポップします．すでに覚えたキーバインドならば，0.5秒以内に打てるでしょうから，ポップ表示無しで通常通りにコマンドが発行します．色分けも効くのでわかりやすいです．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(guide-key-mode)
                         <span style="color: #8b2252;">"guide-key"</span> nil t)
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"guide-key"</span>
    (<span style="color: #a020f0;">setq</span> guide-key/guide-key-sequence '(<span style="color: #8b2252;">"C-c f"</span> <span style="color: #8b2252;">"C-c f c"</span>))
    (<span style="color: #a020f0;">setq</span> guide-key/popup-window-position 'bottom)
    (<span style="color: #a020f0;">setq</span> guide-key/idle-delay 0.5)
    (<span style="color: #a020f0;">setq</span> guide-key/highlight-command-regexp
          '((<span style="color: #8b2252;">"my-"</span> . <span style="color: #8b2252;">"red"</span>)
            (<span style="color: #8b2252;">"takaxp:"</span> . <span style="color: #8b2252;">"blue"</span>))))

  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"org"</span>
    (guide-key-mode 1))

  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"postpone"</span>
    (<span style="color: #a020f0;">unless</span> noninteractive
      (guide-key-mode 1))))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdf971702" class="outline-3">
<h3 id="orgdf971702"><span class="section-number-3">6.57.</span> <span class="done DONE">DONE</span> [anything.el] 何でも絞り込みインターフェイス&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></h3>
<div class="outline-text-3" id="text-orgdf971702">
<ul class="org-ul">
<li>helm に移行しました．</li>
</ul>

<p>
<a href="http://svn.coderepos.org/share/lang/elisp/anything-c-moccur/trunk/anything-c-moccur.el">http://svn.coderepos.org/share/lang/elisp/anything-c-moccur/trunk/anything-c-moccur.el</a>
<a href="http://d.hatena.ne.jp/IMAKADO/20080724/1216882563">http://d.hatena.ne.jp/IMAKADO/20080724/1216882563</a>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(anything-other-buffer
                           anything-complete anything-M-x
                           anything-c-moccur-occur-by-moccur)
                         <span style="color: #8b2252;">"anything-startup"</span> nil t)
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"anything-startup"</span>
    (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">anything-c-moccur</span> nil t)
    <span style="color: #b22222;">;;  </span><span style="color: #b22222;">(setq moccur-split-word t)</span>
    <span style="color: #b22222;">;;  </span><span style="color: #b22222;">(setq anything-c-locate-options `("locate" "-w"))</span>

    <span style="color: #b22222;">;; </span><span style="color: #b22222;">M-x install-elisp-from-emacswiki recentf-ext.el</span>
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">http://www.emacswiki.org/cgi-bin/wiki/download/recentf-ext.el</span>
    <span style="color: #b22222;">;;  </span><span style="color: #b22222;">(autoload-if-found 'recentf-ext "recentf-ext" nil t)</span>
    <span style="color: #b22222;">;;              </span><span style="color: #b22222;">(require 'recentf-ext nil t)</span>

    (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">migemo</span> nil t)
      (<span style="color: #a020f0;">setq</span> moccur-use-migemo t))
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">M-x anything-grep-by-name</span>
    (<span style="color: #a020f0;">setq</span> anything-grep-alist
          '((<span style="color: #8b2252;">"Org-files"</span> (<span style="color: #8b2252;">"egrep -Hin %s *.org"</span> <span style="color: #8b2252;">"~/Dropbox/org/"</span>))
            (<span style="color: #8b2252;">".emacs.d"</span> (<span style="color: #8b2252;">"egrep -Hin %s *.el"</span> <span style="color: #8b2252;">"~/.emacs.d/"</span>))
            (<span style="color: #8b2252;">"ChangeLog"</span> (<span style="color: #8b2252;">"egrep -Hin %s ChangeLog"</span> <span style="color: #8b2252;">"~/"</span>))))
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">("Spotlight" ("mdfind %s -onlyin ~/Dropbox/Documents/Library/" ""))))</span>

    (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-anything</span> ()
      (<span style="color: #a020f0;">interactive</span>)
      (anything-other-buffer
       '(anything-c-source-recentf
         anything-c-source-file-name-history
         anything-c-source-buffers
         anything-c-source-emacs-commands
         anything-c-source-locate)
       <span style="color: #8b2252;">" *my-anything*"</span>))

    (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-anything-buffer</span> ()
      (<span style="color: #a020f0;">interactive</span>)
      (anything-other-buffer
       '(anything-c-source-buffers)
       <span style="color: #8b2252;">" *my-anthing-buffer*"</span>))

    (<span style="color: #a020f0;">when</span> (memq window-system '(mac ns))
      (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-anything-spotlight</span> ()
        <span style="color: #8b2252;">"Spotlight search with anything.el"</span>
        (<span style="color: #a020f0;">interactive</span>)
        (anything-other-buffer
         '(anything-c-source-mac-spotlight)
         <span style="color: #8b2252;">" *anything-spotlight*"</span>)))

    (<span style="color: #a020f0;">setq</span> anything-candidate-number-limit 50) <span style="color: #b22222;">; </span><span style="color: #b22222;">50</span>
    (<span style="color: #a020f0;">setq</span> anything-input-idle-delay 0.1)      <span style="color: #b22222;">; </span><span style="color: #b22222;">0.1</span>
    (<span style="color: #a020f0;">setq</span> anything-idle-delay 0.5)            <span style="color: #b22222;">; </span><span style="color: #b22222;">0.5</span>
    (<span style="color: #a020f0;">setq</span> anything-quick-update nil))        <span style="color: #b22222;">; </span><span style="color: #b22222;">nil</span>

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">Show ibuffer powered by anything</span>
  <span style="color: #b22222;">;;  </span><span style="color: #b22222;">(with-eval-after-load "anything-startup"</span>
  (global-set-key (kbd <span style="color: #8b2252;">"M-x"</span>) 'anything-M-x)
  (global-set-key (kbd <span style="color: #8b2252;">"C-c o"</span>) 'anything-c-moccur-occur-by-moccur)
  (global-set-key (kbd <span style="color: #8b2252;">"C-M-r"</span>) 'my-anything)
  (global-set-key (kbd <span style="color: #8b2252;">"C-M-s"</span>) 'my-anything-spotlight)
  (global-set-key (kbd <span style="color: #8b2252;">"C-x C-b"</span>) 'my-anything-buffer))
</pre>
</div>
</div>
</div>

<div id="outline-container-org83eaaf3a" class="outline-3">
<h3 id="org83eaaf3a"><span class="section-number-3">6.58.</span> <span class="done DONE">DONE</span> [diminish.el] モードラインのモード名を短くする&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></h3>
<div class="outline-text-3" id="text-org83eaaf3a">
<p>
以前は自作したパッケージを使っていましたが，不具合も多く，調べると <code>diminish.el</code> という素晴らしいパッケージがあったので移行しました．これはマイナーモードの短縮表示なので，メジャーモードは個別にフックで <code>mode-name</code> を書き換えて対応します． <code>use-package.el</code> を使っていると依存関係から自動的にインストールされます．
</p>

<p>
<code>diminish.el</code> を使えば，短縮名に書き換えることも，存在自体を消してしまうこともできます．helm だけ行儀が悪いので，後段での設定時に diminish を呼ぶようにしています．代替パッケージに，<a href="https://github.com/Malabarba/rich-minority">rich-minority-mode</a>があります．
</p>

<p>
メジャーモードの短縮表示は <code>diminish</code> に頼らず，単純に各モードの <code>hook</code> で対処します．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"postpone"</span>
  (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">diminish</span> nil t)
    (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"ggtags"</span> (diminish 'ggtags-mode <span style="color: #8b2252;">" G"</span>))
    (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"org"</span> (diminish 'orgstruct-mode <span style="color: #8b2252;">" OrgS"</span>))
    (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"centered-cursor-mode"</span>
      (diminish 'centered-cursor-mode))
    (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"volatile-highlights"</span>
      (diminish 'volatile-highlights-mode))
    (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"aggressive-indent"</span>
      (diminish 'aggressive-indent-mode))
    (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"all-the-icons-dired"</span>
      (diminish 'all-the-icons-dired-mode))
    (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"yasnippet"</span> (diminish 'yas-minor-mode))
    (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"auto-complete"</span> (diminish 'auto-complete-mode))
    (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"ws-butler"</span> (diminish 'ws-butler-mode))
    (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"isearch"</span> (diminish 'isearch-mode))
    (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"autorevert"</span> (diminish 'auto-revert-mode))
    (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"smooth-scroll"</span> (diminish 'smooth-scroll-mode))
    (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"whitespace"</span> (diminish 'global-whitespace-mode))
    (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"emmet-mode"</span> (diminish 'emmet-mode))
    (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"abbrev"</span> (diminish 'abbrev-mode))
    (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"doxymacs"</span> (diminish 'doxymacs-mode))
    (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"editorconfig"</span> (diminish 'editorconfig-mode))
    (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"rainbow-mode"</span> (diminish 'rainbow-mode))
    (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"guide-key"</span> (diminish 'guide-key-mode))
    (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"highlight-symbol"</span> (diminish 'highlight-symbol-mode))
    (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"which-key"</span> (diminish 'which-key-mode))
    (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"fancy-narrow"</span> (diminish 'fancy-narrow-mode))
    (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"smartparens"</span> (diminish 'smartparens-mode))
    (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"selected"</span> (diminish 'selected-minor-mode))
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">(with-eval-after-load "org-autolist" (diminish 'org-autolist-mode))</span>
   <span style="color: #b22222;">;;;  </span><span style="color: #b22222;">(with-eval-after-load "helm" (diminish 'helm-mode " H"))</span>
    ))

<span style="color: #b22222;">;; </span><span style="color: #b22222;">&#12513;&#12472;&#12515;&#12540;&#12514;&#12540;&#12489;&#12398;&#30701;&#32302;</span>
(add-hook 'c-mode-hook (<span style="color: #a020f0;">lambda</span> () (<span style="color: #a020f0;">setq</span> mode-name <span style="color: #8b2252;">"C"</span>)))
(add-hook 'js2-mode-hook (<span style="color: #a020f0;">lambda</span> () (<span style="color: #a020f0;">setq</span> mode-name <span style="color: #8b2252;">"JS"</span>)))
(add-hook 'c++-mode-hook (<span style="color: #a020f0;">lambda</span> () (<span style="color: #a020f0;">setq</span> mode-name <span style="color: #8b2252;">"C++"</span>)))
(add-hook 'csharp-mode-hook (<span style="color: #a020f0;">lambda</span> () (<span style="color: #a020f0;">setq</span> mode-name <span style="color: #8b2252;">"C#"</span>)))
(add-hook 'prog-mode-hook (<span style="color: #a020f0;">lambda</span> () (<span style="color: #a020f0;">setq</span> mode-name <span style="color: #8b2252;">"Pr"</span>)))
(add-hook 'emacs-lisp-mode-hook (<span style="color: #a020f0;">lambda</span> () (<span style="color: #a020f0;">setq</span> mode-name <span style="color: #8b2252;">"El"</span>)))
(add-hook 'python-mode-hook (<span style="color: #a020f0;">lambda</span> () (<span style="color: #a020f0;">setq</span> mode-name <span style="color: #8b2252;">"Py"</span>)))
(add-hook 'perl-mode-hook (<span style="color: #a020f0;">lambda</span> () (<span style="color: #a020f0;">setq</span> mode-name <span style="color: #8b2252;">"Pl"</span>)))
(add-hook 'web-mode-hook (<span style="color: #a020f0;">lambda</span> () (<span style="color: #a020f0;">setq</span> mode-name <span style="color: #8b2252;">"W"</span>)))
(add-hook 'change-log-mode-hook (<span style="color: #a020f0;">lambda</span> () (<span style="color: #a020f0;">setq</span> mode-name <span style="color: #8b2252;">"ChangeLog"</span>)))
(add-hook 'lisp-interaction-mode-hook (<span style="color: #a020f0;">lambda</span> () (<span style="color: #a020f0;">setq</span> mode-name <span style="color: #8b2252;">"Lisp"</span>)))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org9ff300b4" class="outline-2">
<h2 id="org9ff300b4"><span class="section-number-2">7.</span> メディアサポート</h2>
<div class="outline-text-2" id="text-org9ff300b4">
</div>
<div id="outline-container-orgcf4022fd" class="outline-3">
<h3 id="orgcf4022fd"><span class="section-number-3">7.1.</span> [emms.el] メディアプレーヤー</h3>
<div class="outline-text-3" id="text-orgcf4022fd">
<p>
<code>mpv</code> を使い，emacs からメディアファイルを再生します． <code>bongo.el</code> よりも使いやすい印象．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(emms-play-file
                           emms-play-playlist emms-play-directory my-play-bgm
                           emms-next emms-previous emms-stop emms-pause)
                         <span style="color: #8b2252;">"emms"</span> nil t)
  (global-set-key (kbd <span style="color: #8b2252;">"C-c e b"</span>) 'my-play-bgm)
  (<span style="color: #a020f0;">let</span> ((base <span style="color: #8b2252;">"C-c e "</span>))
    (global-set-key (kbd (concat base <span style="color: #8b2252;">"n"</span>)) 'emms-next)
    (global-set-key (kbd (concat base <span style="color: #8b2252;">"p"</span>)) 'emms-previous)
    (global-set-key (kbd (concat base <span style="color: #8b2252;">"s"</span>)) 'emms-stop)
    (global-set-key (kbd (concat base <span style="color: #8b2252;">"SPC"</span>)) 'emms-pause))

  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"emms-mode-line"</span>
    (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">ad:emms-mode-line-playlist-current</span> ()
      <span style="color: #8b2252;">"Display filename in mode-line, not full-path."</span>
      (format emms-mode-line-format
              (file-name-nondirectory
               (emms-track-description
                (emms-playlist-current-selected-track)))))
    (advice-add 'emms-mode-line-playlist-current <span style="color: #483d8b;">:override</span>
                #'ad:emms-mode-line-playlist-current))

  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"emms-mode-line-icon"</span>
    (<span style="color: #a020f0;">setq</span> emms-mode-line-format <span style="color: #8b2252;">"%s"</span>)
    (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">ad:emms-mode-line-icon-function</span> ()
      <span style="color: #8b2252;">"Replace the default musical note icon with a Unicode character."</span>
      (concat <span style="color: #8b2252;">" "</span>
              emms-mode-line-icon-before-format
              <span style="color: #8b2252;">"&#9834;"</span>
              (emms-mode-line-playlist-current)))
    (advice-add 'emms-mode-line-icon-function <span style="color: #483d8b;">:override</span>
                #'ad:emms-mode-line-icon-function))

  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"emms"</span>
    (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">emms-setup</span> nil t)
      (emms-standard)
      (emms-default-players))

    (<span style="color: #a020f0;">unless</span> noninteractive
      (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">org-emms</span> nil t)) <span style="color: #b22222;">;; </span><span style="color: #b22222;">emms &#12398;&#12522;&#12531;&#12463;&#12395;&#23550;&#24540;&#12373;&#12379;&#12427;</span>
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">(require 'helm-emms nil t)</span>

    (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-play-bgm</span> ()
      (<span style="color: #a020f0;">interactive</span>)
      (<span style="color: #a020f0;">let</span> ((file <span style="color: #8b2252;">"~/Dropbox/12-audio/ffximusic104.m4a"</span>))
        (<span style="color: #a020f0;">when</span> (file-exists-p file)
          (emms-play-file file)
          (emms-toggle-repeat-track))))

    <span style="color: #b22222;">;; </span><span style="color: #b22222;">setup an additional player</span>
    (<span style="color: #a020f0;">if</span> (executable-find <span style="color: #8b2252;">"mpv"</span>)
        (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">emms-player-mpv</span> nil t)
          (add-to-list 'emms-player-list 'emms-player-mpv)

          <span style="color: #b22222;">;; </span><span style="color: #b22222;">(defvar emms-player-mpv-ontop nil)</span>
          <span style="color: #b22222;">;; </span><span style="color: #b22222;">(defun emms-player-mpv-toggle-ontop ()</span>
          <span style="color: #b22222;">;;   </span><span style="color: #b22222;">"Toggle float on top."</span>
          <span style="color: #b22222;">;;   </span><span style="color: #b22222;">(interactive)</span>
          <span style="color: #b22222;">;;   </span><span style="color: #b22222;">(if emms-player-mpv-ontop</span>
          <span style="color: #b22222;">;;       </span><span style="color: #b22222;">(emms-player-mpv-disable-ontop)</span>
          <span style="color: #b22222;">;;     </span><span style="color: #b22222;">(emms-player-mpv-enable-ontop)))</span>

          <span style="color: #b22222;">;; </span><span style="color: #b22222;">(defun emms-player-mpv-enable-ontop ()</span>
          <span style="color: #b22222;">;;   </span><span style="color: #b22222;">"Enable float on top."</span>
          <span style="color: #b22222;">;;   </span><span style="color: #b22222;">(let ((cmd (emms-player-mpv--format-command "set ontop yes")))</span>
          <span style="color: #b22222;">;;     </span><span style="color: #b22222;">(call-process-shell-command cmd nil nil nil))</span>
          <span style="color: #b22222;">;;   </span><span style="color: #b22222;">(setq emms-player-mpv-ontop t))</span>

          <span style="color: #b22222;">;; </span><span style="color: #b22222;">(defun emms-player-mpv-disable-ontop ()</span>
          <span style="color: #b22222;">;;   </span><span style="color: #b22222;">"Disable float on top."</span>
          <span style="color: #b22222;">;;   </span><span style="color: #b22222;">(let ((cmd (emms-player-mpv--format-command "set ontop no")))</span>
          <span style="color: #b22222;">;;     </span><span style="color: #b22222;">(call-process-shell-command cmd nil nil nil))</span>
          <span style="color: #b22222;">;;   </span><span style="color: #b22222;">(setq emms-player-mpv-ontop nil))</span>

          <span style="color: #b22222;">;; </span><span style="color: #b22222;">(global-set-key (kbd "C-c e t") 'emms-player-mpv-toggle-ontop)</span>
          )

      (message <span style="color: #8b2252;">"--- mpv is NOT installed."</span>))))

<span style="color: #b22222;">;; </span><span style="color: #b22222;">ivy &#12391;&#36942;&#21435;&#20877;&#29983;&#12375;&#12383;&#27005;&#26354;&#12434;&#12383;&#12393;&#12427;</span>
(autoload-if-found '(ivy-emms) <span style="color: #8b2252;">"ivy-emms"</span> nil t)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgca126930" class="outline-3">
<h3 id="orgca126930"><span class="section-number-3">7.2.</span> [GoogleMaps.el] GoogleMaps を Emacs 内で使う</h3>
<div class="outline-text-3" id="text-orgca126930">
<ul class="org-ul">
<li>ネタとして最高の出来</li>
</ul>

<p>
<a href="http://julien.danjou.info/software/google-maps.el">http://julien.danjou.info/software/google-maps.el</a>
</p>

<p>
<code>M-x google-maps</code> で起動します．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">late-init.el</span>
(<span style="color: #a020f0;">when</span> (autoload-if-found '(google-maps)
                         <span style="color: #8b2252;">"google-maps"</span> nil t)
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"google-maps"</span>
    (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">org-location-google-maps</span> nil t)))
</pre>
</div>

<p>
<code>+/-</code> でズーム， <code>矢印</code> で移動， <code>q</code> で終了します．また， <code>w</code> でURLを取得してコピー， <code>t</code> で地図の種別を変更できます．
</p>

<p>
Org-mode を使っている場合には， <code>C-c M-L</code> で表示されるプロンプトで検索すると，プロパティにそのキーワードが記録されます．後から <code>C-c M-l</code> すれば，いつでも地図を表示できるようになります．
</p>
</div>
</div>

<div id="outline-container-org41faa552" class="outline-3">
<h3 id="org41faa552"><span class="section-number-3">7.3.</span> [japanlaw.el] Emacs 電子六法</h3>
<div class="outline-text-3" id="text-org41faa552">
<p>
Emacs で総務省の「<a href="http://law.e-gov.go.jp/">法令データ提供システム</a>」に登録された法令データを閲覧します． <code>w3m</code> が必要です．
</p>

<ul class="org-ul">
<li><a href="http://www.ne.jp/asahi/alpha/kazu/laws.html">Emacs 電子六法</a></li>
<li><a href="https://github.com/mhayashi1120/japanlaw.el">mhayashi1120/japanlaw.el: Emacs 電子六法</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">if</span> (executable-find <span style="color: #8b2252;">"w3m"</span>)
    (autoload-if-found '(japanlaw) <span style="color: #8b2252;">"japanlaw"</span> nil t)
  (message <span style="color: #8b2252;">"--- w3m is NOT installed."</span>))
</pre>
</div>
</div>
</div>

<div id="outline-container-org8e8f85ec" class="outline-3">
<h3 id="org8e8f85ec"><span class="section-number-3">7.4.</span> [sunshine.el] 天気を知る</h3>
<div class="outline-text-3" id="text-org8e8f85ec">
<ul class="org-ul">
<li><a href="https://openweathermap.org/">https://openweathermap.org/</a> にアカウントを作り，APIを呼び出すための専用IDを発行する必要があります．取得した idを， <code>sunshine-appid</code> に格納し， <code>sunshine-location</code> で対象地域を設定すれば， <code>M-x sunshine-forecast</code> で天気が表示されます． <code>M-x sunshine-quick-format</code> を使うと，結果がミニバッファに表示されます．</li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">late-init.el</span>
(<span style="color: #a020f0;">when</span> (autoload-if-found '(sunshine-forecast sunshine-quick-forecast)
                         <span style="color: #8b2252;">"sunshine"</span> nil t)
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"sunshine"</span>
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">(setq sunshine-location "Tokyo, Japan")</span>
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">(setq sunshine-appid "................................")</span>
    (custom-set-variables
     '(sunshine-show-icons t)
     '(sunshine-units 'metric))))
</pre>
</div>
</div>
</div>
<div id="outline-container-orgb77ecd7a" class="outline-3">
<h3 id="orgb77ecd7a"><span class="section-number-3">7.5.</span> [org-google-weather.el] org-agenda に天気を表示する&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></h3>
<div class="outline-text-3" id="text-orgb77ecd7a">
<p>
残念ながら Google API が変更になり動かなくなったそうです．
</p>

<p>
<a href="http://julien.danjou.info/software/google-weather.el">http://julien.danjou.info/software/google-weather.el</a>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">google-weather</span> nil t)
(<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">org-google-weather</span> nil t)
  '(org-google-weather-use-google-icons t))
</pre>
</div>
</div>
</div>
<div id="outline-container-org474263ad" class="outline-3">
<h3 id="org474263ad"><span class="section-number-3">7.6.</span> [bongo.el] Emacsのバッファで音楽ライブラリを管理する&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></h3>
<div class="outline-text-3" id="text-org474263ad">
<p>
<a href="https://pxaka.tokyo/wiki/doku.php?id=emacs">iTunes の代わりに Emacs を使う</a>
</p>

<p>
autoload を設定すると， <code>*.bango-playlist</code> や <code>*.bongo-library</code> から起動できないので，明示的に require している．なお，bongo-mplayer を使う場合，bongo を先にrequireするとうまく動作しない（bongo.el の最後で，bongo-mplayer が provide されているからだと思われる）．
</p>

<p>
以下の設定では，autoload で使いつつ，=M-x init-bongo= でプレイリストを読み込んでいる．これならば，Emacs起動時は軽量で，かつ，プレイリストの訪問で Bongo を開始できる．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(bongo)
                         <span style="color: #8b2252;">"bongo-mplayer"</span> nil t)
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"bongo-mplayer"</span>
    (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">init-bongo</span> ()
      (<span style="color: #a020f0;">interactive</span>)
      (bongo)
      (find-file <span style="color: #8b2252;">"~/Desktop/next/Tidy/hoge.bongo-playlist"</span>))

    <span style="color: #b22222;">;; </span><span style="color: #b22222;">Volume control</span>
    <span style="color: #b22222;">;;         </span><span style="color: #b22222;">(require volume.el nil t)</span>
    (<span style="color: #a020f0;">setq</span> bongo-mplayer-extra-arguments '(<span style="color: #8b2252;">"-volume"</span> <span style="color: #8b2252;">"1"</span>))
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">Avoid error when editing bongo buffers</span>
    (<span style="color: #a020f0;">setq</span> yank-excluded-properties nil)
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">Use mplayer</span>
    (<span style="color: #a020f0;">setq</span> bongo-enabled-backends '(mplayer))))
</pre>
</div>

<p>
org-player.el を使えば，org-mode のバッファから Bongo を操作できる．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"org"</span>
  (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">org-player</span> nil t))
</pre>
</div>

<p>
音量コントロールには，<a href="https://github.com/dbrock/volume-el">volume.el</a>が必要です．設定がうまくいかないので保留中
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(autoload 'volume <span style="color: #8b2252;">"volume"</span> <span style="color: #8b2252;">"Tweak your sound card volume."</span> t)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgd5aed515" class="outline-2">
<h2 id="orgd5aed515"><span class="section-number-2">8.</span> 履歴／ファイル管理</h2>
<div class="outline-text-2" id="text-orgd5aed515">
</div>
<div id="outline-container-org0f46c991" class="outline-3">
<h3 id="org0f46c991"><span class="section-number-3">8.1.</span> 履歴サイズを大きくする</h3>
<div class="outline-text-3" id="text-org0f46c991">
<p>
<code>t</code> で無限大に指定できる．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">setq</span> history-length 2000)
</pre>
</div>
</div>
</div>

<div id="outline-container-org9736b2f0" class="outline-3">
<h3 id="org9736b2f0"><span class="section-number-3">8.2.</span> Undoバッファを無限に取る</h3>
<div class="outline-text-3" id="text-org9736b2f0">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">setq</span> undo-outer-limit nil)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf2cd8961" class="outline-3">
<h3 id="orgf2cd8961"><span class="section-number-3">8.3.</span> 最近開いたファイルリストを保持</h3>
<div class="outline-text-3" id="text-orgf2cd8961">
<p>
Built-in の <a href="http://www.emacswiki.org/emacs/RecentFiles">recentf.el</a> を使う．
</p>

<ul class="org-ul">
<li><a href="http://d.hatena.ne.jp/tomoya/20110217/1297928222">http://d.hatena.ne.jp/tomoya/20110217/1297928222</a></li>
</ul>

<p>
recentf-auto-cleanup を <code>'mode</code> などにすると起動時にファイルのクリーニングが行われるてしまうので， <code>'never</code> で回避し，アイドルタイマーなどで対応する．これだけで50[ms]ほど起動を高速化できる．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-recentf-save-list-silence</span> ()
  (<span style="color: #a020f0;">interactive</span>)
  (<span style="color: #a020f0;">if</span> shutup-p
            (shut-up (recentf-save-list))
          (<span style="color: #a020f0;">let</span> ((message-log-max nil))
            (recentf-save-list)))
  (message <span style="color: #8b2252;">""</span>))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-recentf-cleanup-silence</span> ()
  (<span style="color: #a020f0;">interactive</span>)
  (<span style="color: #a020f0;">when</span> (file-exists-p <span style="color: #8b2252;">"/Volumes/orzHDn"</span>)
          (<span style="color: #a020f0;">if</span> shutup-p
              (shut-up (recentf-cleanup))
            (<span style="color: #a020f0;">let</span> ((message-log-max nil))
              (recentf-cleanup)))
          (message <span style="color: #8b2252;">""</span>)))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-counsel-recentf-action</span> (file)
  (eval `(with-ivy-window (find-file ,file))))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">ad:counsel-recentf</span> ()
  <span style="color: #8b2252;">"Find a file on `</span><span style="color: #008b8b;">recentf-list</span><span style="color: #8b2252;">'."</span>
  (<span style="color: #a020f0;">interactive</span>)
  (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">recentf</span>)
  (recentf-mode)
  (ivy-read <span style="color: #8b2252;">"Recentf: "</span>
                        (mapcar (<span style="color: #a020f0;">lambda</span> (x) (abbreviate-file-name  <span style="color: #b22222;">;; </span><span style="color: #b22222;">~/</span>
                                                         (substring-no-properties x)))
                                      recentf-list)
                        <span style="color: #483d8b;">:action</span> #'my-counsel-recentf-action
                        <span style="color: #483d8b;">:require-match</span> t
                        <span style="color: #483d8b;">:caller</span> 'counsel-recentf))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(counsel-recentf)
                         <span style="color: #8b2252;">"counsel"</span> nil t)
  (global-set-key (kbd <span style="color: #8b2252;">"C-M-r"</span>) 'counsel-recentf))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(rencetf-mode
                           my-recentf-save-list-silence
                           my-recentf-cleanup-silence
                           recentf-open-files)
                         <span style="color: #8b2252;">"recentf"</span> nil t)
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"recentf"</span>
    (custom-set-variables
     '(recentf-max-saved-items 2000)
     '(recentf-save-file (expand-file-name <span style="color: #8b2252;">"~/.emacs.d/_recentf"</span>))
     '(recentf-auto-cleanup 'never)
     '(recentf-exclude
       '(<span style="color: #8b2252;">".recentf"</span> <span style="color: #8b2252;">"bookmarks"</span> <span style="color: #8b2252;">"org-recent-headings.dat"</span> <span style="color: #8b2252;">"^/tmp\\.*"</span>
         <span style="color: #8b2252;">"^/private\\.*"</span> <span style="color: #8b2252;">"^/var/folders\\.*"</span> <span style="color: #8b2252;">"/TAGS$"</span>)))

    <span style="color: #b22222;">;; </span><span style="color: #b22222;">see https://github.com/mattfidler/EmacsPortable.App/issues/7</span>
    (<span style="color: #a020f0;">when</span> (eq system-type 'darwin)
      <span style="color: #b22222;">;; </span><span style="color: #b22222;">Dropbox &#12398;&#12456;&#12452;&#12522;&#12450;&#12473;&#12434;&#23637;&#38283;&#12373;&#12428;&#12394;&#12356;&#12424;&#12358;&#12395;&#12377;&#12427;</span>
      (<span style="color: #a020f0;">setq</span> directory-abbrev-alist
            '((<span style="color: #8b2252;">"\\`~/Library/CloudStorage/Dropbox"</span> . <span style="color: #8b2252;">"~/Dropbox"</span>))))

    (<span style="color: #a020f0;">if</span> (version&lt; emacs-version <span style="color: #8b2252;">"27.1"</span>)
        (<span style="color: #a020f0;">progn</span>
          (add-hook 'focus-out-hook #'my-recentf-save-list-silence)
          (add-hook 'focus-out-hook #'my-recentf-cleanup-silence))
      (<span style="color: #a020f0;">add-function</span> <span style="color: #483d8b;">:before</span> after-focus-change-function
                    #'my-recentf-save-list-silence)
      (<span style="color: #a020f0;">add-function</span> <span style="color: #483d8b;">:before</span> after-focus-change-function
                    #'my-recentf-cleanup-silence)))

  (<span style="color: #a020f0;">unless</span> noninteractive
    (<span style="color: #a020f0;">let</span> ((message-log-max nil))
      (recentf-mode 1)))

  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"counsel"</span>
    (advice-add 'counsel-recentf <span style="color: #483d8b;">:override</span> #'ad:counsel-recentf)
    (ivy-add-actions
     'counsel-recentf
     '((<span style="color: #8b2252;">"g"</span> my-counsel-ag-in-dir <span style="color: #8b2252;">"switch to ag"</span>)
       (<span style="color: #8b2252;">"r"</span> my-counsel-fzf-in-dir <span style="color: #8b2252;">"switch to fzf (in dir.)"</span>)
       (<span style="color: #8b2252;">"z"</span> my-counsel-fzf-in-default-dir <span style="color: #8b2252;">"switch to fzf (default)"</span>)))))

<span style="color: #b22222;">;; </span><span style="color: #b22222;">(add-hook 'after-init-hook #'recentf-mode))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org9f20061e" class="outline-3">
<h3 id="org9f20061e"><span class="section-number-3">8.4.</span> C-g した場所をブックマークする</h3>
<div class="outline-text-3" id="text-org9f20061e">
<p>
<code>C-g</code> でカーソルが飛んだ時，元の場所へブックマークから戻れます．mark でも辿れるようにしておきます．
</p>

<ul class="org-ul">
<li><a href="https://pxaka.tokyo/blog/2019/7f6518aa-bab0-91a4-53b3-ba3b8f02a481/">C-g した場所をブックマークする - imadenale</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">my-cg-bookmark</span> <span style="color: #8b2252;">"c-g-point-last"</span>)
<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-cg-bookmark</span> ()
  (push-mark)
  (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">and</span> buffer-file-name
             (eq major-mode 'org-mode)
             (not (org-before-first-heading-p))
             (&gt; (org-current-level) 1)) <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#12524;&#12505;&#12523;1&#12398; heading &#12434;&#38500;&#22806;</span>
    (bookmark-set my-cg-bookmark)
    (save-buffer)))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"ah"</span>
  (advice-add 'my-cg-bookmark <span style="color: #483d8b;">:around</span> #'ad:suppress-message)
  (add-hook 'ah-before-c-g-hook #'my-cg-bookmark))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb2530c3e" class="outline-3">
<h3 id="orgb2530c3e"><span class="section-number-3">8.5.</span> 開いているバッファのcopy/rename/deleteと別アプリでの表示</h3>
<div class="outline-text-3" id="text-orgb2530c3e">
<ul class="org-ul">
<li><a href="https://github.com/bbatsov/crux">https://github.com/bbatsov/crux</a></li>
</ul>

<p>
<code>curx.el</code> から次の関数を拝借しています．
</p>

<ol class="org-ol">
<li>M-x crux-copy-file-preserve-attributes</li>
<li>M-x crux-rename-file-and-buffer</li>
<li>M-x crux-delete-file-and-buffer</li>
<li>M-x crux-open-with
<ul class="org-ul">
<li>diredでは， <code>C-c C-o</code> で呼べるように設定</li>
</ul></li>
</ol>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(define-key dired-mode-map (kbd <span style="color: #8b2252;">"C-c C-o"</span>) 'crux-open-with)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">crux-copy-file-preserve-attributes</span> (visit)
  <span style="color: #8b2252;">"[curx.el]</span>
<span style="color: #8b2252;">Copy the current file-visiting buffer's file to a destination.</span>

<span style="color: #8b2252;">This function prompts for the new file's location and copies it</span>
<span style="color: #8b2252;">similar to cp -p. If the new location is a directory, and the</span>
<span style="color: #8b2252;">directory does not exist, this function confirms with the user</span>
<span style="color: #8b2252;">whether it should be created. A directory must end in a slash</span>
<span style="color: #8b2252;">like `</span><span style="color: #008b8b;">copy-file</span><span style="color: #8b2252;">' expects. If the destination is a directory and</span>
<span style="color: #8b2252;">already has a file named as the origin file, offers to</span>
<span style="color: #8b2252;">overwrite.</span>

<span style="color: #8b2252;">If the current buffer is not a file-visiting file or the</span>
<span style="color: #8b2252;">destination is a non-existent directory but the user has elected</span>
<span style="color: #8b2252;">to not created it, nothing will be done.</span>

<span style="color: #8b2252;">When invoke with C-u, the newly created file will be visited.</span>
<span style="color: #8b2252;">"</span>
  (<span style="color: #a020f0;">interactive</span> <span style="color: #8b2252;">"p"</span>)
  (<span style="color: #a020f0;">let</span> ((current-file (buffer-file-name)))
    (<span style="color: #a020f0;">when</span> current-file
      (<span style="color: #a020f0;">let*</span> ((new-file (read-file-name <span style="color: #8b2252;">"Copy file to: "</span>))
             (abs-path (expand-file-name new-file))
             (create-dir-prompt <span style="color: #8b2252;">"%s is a non-existent directory, create it? "</span>)
             (is-dir? (string-match <span style="color: #8b2252;">"/"</span> abs-path (1- (length abs-path))))
             (dir-missing? (<span style="color: #a020f0;">and</span> is-dir? (not (file-exists-p abs-path))))
             (create-dir? (<span style="color: #a020f0;">and</span> is-dir?
                               dir-missing?
                               (y-or-n-p
                                (format create-dir-prompt new-file))))
             (destination (concat (file-name-directory abs-path)
                                  (file-name-nondirectory current-file))))
        (<span style="color: #a020f0;">unless</span> (<span style="color: #a020f0;">and</span> is-dir? dir-missing? (not create-dir?))
          (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">and</span> is-dir? dir-missing? create-dir?)
            (make-directory abs-path))
          (<span style="color: #a020f0;">condition-case</span> nil
              (<span style="color: #a020f0;">progn</span>
                (copy-file current-file abs-path nil t t t)
                (message <span style="color: #8b2252;">"Wrote %s"</span> destination)
                (<span style="color: #a020f0;">when</span> visit
                  (find-file-other-window destination)))
            (file-already-exists
             (<span style="color: #a020f0;">when</span> (y-or-n-p (format <span style="color: #8b2252;">"%s already exists, overwrite? "</span> destination))
               (copy-file current-file abs-path t t t t)
               (message <span style="color: #8b2252;">"Wrote %s"</span> destination)
               (<span style="color: #a020f0;">when</span> visit
                 (find-file-other-window destination))))))))))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">crux-rename-file-and-buffer</span> ()
  <span style="color: #8b2252;">"[curx.el]</span>
<span style="color: #8b2252;">Rename current buffer and if the buffer is visiting a file, rename it too."</span>
  (<span style="color: #a020f0;">interactive</span>)
  (<span style="color: #a020f0;">when-let*</span> ((filename (buffer-file-name))
              (new-name (<span style="color: #a020f0;">or</span> (read-file-name <span style="color: #8b2252;">"New name: "</span> (file-name-directory filename) nil 'confirm)))
              (containing-dir (file-name-directory new-name)))
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">make sure the current buffer is saved and backed by some file</span>
    (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">or</span> (buffer-modified-p) (not (file-exists-p filename)))
      (<span style="color: #a020f0;">if</span> (y-or-n-p <span style="color: #8b2252;">"Can't move file before saving it.  Would you like to save it now?"</span>)
          (save-buffer)))
    (<span style="color: #a020f0;">if</span> (get-file-buffer new-name)
        (message <span style="color: #8b2252;">"There already exists a buffer named %s"</span> new-name)
      (<span style="color: #a020f0;">progn</span>
        (make-directory containing-dir t)
        (<span style="color: #a020f0;">cond</span>
         ((vc-backend filename)
          <span style="color: #b22222;">;; </span><span style="color: #b22222;">vc-rename-file seems not able to cope with remote filenames?</span>
          (<span style="color: #a020f0;">let</span> ((vc-filename (<span style="color: #a020f0;">if</span> (tramp-tramp-file-p filename) (tramp-file-local-name filename) filename))
                (vc-new-name (<span style="color: #a020f0;">if</span> (tramp-tramp-file-p new-name) (tramp-file-local-name filename) new-name)))
            (vc-rename-file vc-filename vc-new-name)))
         (t
          (rename-file filename new-name t)
          (set-visited-file-name new-name t t)))))))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">crux-delete-file-and-buffer</span> ()
  <span style="color: #8b2252;">"[curx.el]</span>
<span style="color: #8b2252;">Kill the current buffer and deletes the file it is visiting."</span>
  (<span style="color: #a020f0;">interactive</span>)
  (<span style="color: #a020f0;">let</span> ((filename (buffer-file-name)))
    (<span style="color: #a020f0;">when</span> filename
      (<span style="color: #a020f0;">if</span> (vc-backend filename)
          (vc-delete-file filename)
        (<span style="color: #a020f0;">when</span> (y-or-n-p (format <span style="color: #8b2252;">"Are you sure you want to delete %s? "</span> filename))
          (delete-file filename delete-by-moving-to-trash)
          (message <span style="color: #8b2252;">"Deleted file %s"</span> filename)
          (kill-buffer))))))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">crux-open-with</span> (arg)
  <span style="color: #8b2252;">"[curx.el]</span>
<span style="color: #8b2252;">Open visited file in default external program.</span>
<span style="color: #8b2252;">When in dired mode, open file under the cursor.</span>

<span style="color: #8b2252;">With a prefix ARG always prompt for command to use."</span>
  (<span style="color: #a020f0;">interactive</span> <span style="color: #8b2252;">"P"</span>)
  (<span style="color: #a020f0;">let*</span> ((current-file-name
          (<span style="color: #a020f0;">if</span> (derived-mode-p 'dired-mode)
              (dired-get-file-for-visit)
            buffer-file-name))
         (open (<span style="color: #a020f0;">pcase</span> system-type
                 (`darwin <span style="color: #8b2252;">"open"</span>)
                 ((<span style="color: #a020f0;">or</span> `gnu `gnu/linux `gnu/kfreebsd) <span style="color: #8b2252;">"xdg-open"</span>)))
         (program (<span style="color: #a020f0;">if</span> (<span style="color: #a020f0;">or</span> arg (not open))
                      (read-shell-command <span style="color: #8b2252;">"Open current file with: "</span>)
                    open)))
    (call-process program nil 0 nil current-file-name)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org300e8f70" class="outline-3">
<h3 id="org300e8f70"><span class="section-number-3">8.6.</span> バッファ保存時にバックアップを生成させない&#xa0;&#xa0;&#xa0;<span class="tag"><span class="backup">backup</span></span></h3>
<div class="outline-text-3" id="text-org300e8f70">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">*.~</span>
(<span style="color: #a020f0;">setq</span> make-backup-files nil)
<span style="color: #b22222;">;; </span><span style="color: #b22222;">.#*</span>
(<span style="color: #a020f0;">setq</span> auto-save-default nil)
<span style="color: #b22222;">;; </span><span style="color: #b22222;">auto-save-list</span>
(<span style="color: #a020f0;">setq</span> auto-save-list-file-prefix nil)
</pre>
</div>
</div>
</div>

<div id="outline-container-org89e64435" class="outline-3">
<h3 id="org89e64435"><span class="section-number-3">8.7.</span> 特定のファイルを Dropbox 以下にバックアップする&#xa0;&#xa0;&#xa0;<span class="tag"><span class="backup">backup</span></span></h3>
<div class="outline-text-3" id="text-org89e64435">
<p>
複数の端末でEmacsを使うと，稀に端末の環境に依存した設定ファイルが必要になります．それを共有してそのまま使うことはできないないので，所定の場所での同期を避ける必要があります．私の場合は， <code>recentf</code> がそれに該当します．とは言えバックアップしていないのは不安なので，なんとかします．引数にバックアップ対象のファイルリストを渡せます．
</p>

<p>
事前に <code>~/Dropbox/backup</code> の下に， <code>system-name</code> で得られる値のディレクトリを作成する必要があります． <code>my-backup</code> は <a href="./utility.el">./utility.el</a> で実装しています．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-backup-recentf</span> ()
  (<span style="color: #a020f0;">interactive</span>)
  (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">utility</span> nil t)
    (my-backup recentf-save-file) <span style="color: #b22222;">;; </span><span style="color: #b22222;">"~/.emacs.d/recentf"</span>
    (my-backup (expand-file-name <span style="color: #8b2252;">"~/.histfile"</span>))))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"recentf"</span>
  (run-with-idle-timer 60 t 'my-backup-recentf))
</pre>
</div>
</div>
</div>

<div id="outline-container-org9b0e7066" class="outline-3">
<h3 id="org9b0e7066"><span class="section-number-3">8.8.</span> [backup-each-save.el] クラッシュに備える&#xa0;&#xa0;&#xa0;<span class="tag"><span class="backup">backup</span></span></h3>
<div class="outline-text-3" id="text-org9b0e7066">
<p>
直近のファイルを常にバックアップします． <code>backup-dir.el</code> でも良いですが，バックアップの目的が，バッファ編集中に <code>emacs</code> が落ちる時の保険ならば， <code>backup-each-save</code> の方が適切な場合があります．以下の例では，すべてのファイルを保存の度に保存し， <code>emacs</code> 起動後に postpone モードが有効になる時点で7日前までのバックアップファイルをすべて削除するようにしています．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-auto-backup</span> ()
  (<span style="color: #a020f0;">unless</span> (equal (buffer-name) <span style="color: #8b2252;">"recentf"</span>)
    (backup-each-save)))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-backup-each-save-compute-location</span> (filename)
  (<span style="color: #a020f0;">let*</span> ((containing-dir (file-name-directory filename))
         (basename (file-name-nondirectory filename))
         (backup-container
          (format <span style="color: #8b2252;">"%s/%s"</span>
                  backup-each-save-mirror-location
                  <span style="color: #b22222;">;; </span><span style="color: #b22222;">"c:" is not allowed</span>
                  (replace-regexp-in-string <span style="color: #8b2252;">":"</span> <span style="color: #8b2252;">""</span> containing-dir))))
    (<span style="color: #a020f0;">when</span> (not (file-exists-p backup-container))
      (make-directory backup-container t))
    (format <span style="color: #8b2252;">"%s/%s-%s"</span> backup-container basename
            (format-time-string backup-each-save-time-format))))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(backup-each-save my-auto-backup)
                         <span style="color: #8b2252;">"backup-each-save"</span> nil t)
  (add-hook 'after-save-hook #'my-auto-backup)
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">%y-%m-%d_%M-%S &#12391;&#32066;&#12431;&#12427;&#12501;&#12449;&#12452;&#12523;&#12434;&#26412;&#26469;&#12398;&#12513;&#12472;&#12515;&#12540;&#12514;&#12540;&#12489;&#12391;&#38283;&#12367;</span>
  (add-to-list 'auto-mode-alist '(<span style="color: #8b2252;">"-[0-9-]\\{</span><span style="color: #a0522d;">8\\</span><span style="color: #8b2252;">}_[0-9-]\\{</span><span style="color: #a0522d;">5\\</span><span style="color: #8b2252;">}$"</span> nil t))

  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"backup-each-save"</span>
    (<span style="color: #a020f0;">setq</span> backup-each-save-mirror-location <span style="color: #8b2252;">"~/.emacs.d/backup"</span>)
    (<span style="color: #a020f0;">setq</span> backup-each-save-time-format <span style="color: #8b2252;">"%y-%m-%d_%M-%S"</span>) <span style="color: #b22222;">;; </span><span style="color: #b22222;">do not use ":" for w32</span>
    (<span style="color: #a020f0;">setq</span> backup-each-save-size-limit 1048576))

  (<span style="color: #a020f0;">when</span> (eq window-system 'w32)
    (advice-add 'backup-each-save-compute-location <span style="color: #483d8b;">:override</span>
                #'my-backup-each-save-compute-location)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orge2f78ad3" class="outline-3">
<h3 id="orge2f78ad3"><span class="section-number-3">8.9.</span> [dired] ファイラのサポートツール&#xa0;&#xa0;&#xa0;<span class="tag"><span class="dired">dired</span></span></h3>
<div class="outline-text-3" id="text-orge2f78ad3">
<p>
<code>dired.el</code> をリッチに使うツール群です．
</p>

<ul class="org-ul">
<li>gited</li>
<li>dired-x</li>
<li>dired-narrow</li>
<li>dired-du</li>
<li>helm-dired-history or ivy-dired-history</li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">late-init.el</span>
(add-hook 'dired-mode-hook #'my-dired-activate)
(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"dired"</span>
  (<span style="color: #a020f0;">setq</span> dired-listing-switches <span style="color: #8b2252;">"-lha"</span>))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-dired-activate</span> ()
  (<span style="color: #a020f0;">unless</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">init-dired</span> nil t)
    (<span style="color: #ff0000; font-weight: bold;">user-error</span> <span style="color: #8b2252;">"init-dired.el doesn't exist"</span>)))
</pre>
</div>

<p>
明示的に <code>dired</code> を呼ばなくても， <code>ibuffer</code> が <code>dired</code> を読み込むことがわかったので， <code>dired</code> に関係する以下の設定は， <code>init-dired.el</code> に分離しました．下記の設定は，最初に <code>M-x dired</code> を実行したタイミングで読み込みます．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">setq</span> completion-ignored-extensions
      (append completion-ignored-extensions
              '(<span style="color: #8b2252;">"./"</span> <span style="color: #8b2252;">"../"</span> <span style="color: #8b2252;">".xlsx"</span> <span style="color: #8b2252;">".docx"</span> <span style="color: #8b2252;">".pptx"</span> <span style="color: #8b2252;">".DS_Store"</span>)))

<span style="color: #b22222;">;; </span><span style="color: #b22222;">"dired-mode-map"</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">Use build-in `</span><span style="color: #008b8b;">wdired-mode</span><span style="color: #b22222;">'.</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">(define-key dired-mode-map (kbd "R") 'wdired-change-to-wdired-mode)</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">http://elpa.gnu.org/packages/gited.html</span>
(<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">gited</span> nil t)
  (define-key dired-mode-map (kbd <span style="color: #8b2252;">"C-x C-g"</span>) 'gited-list-branches))
<span style="color: #b22222;">;; </span><span style="color: #b22222;">https://github.com/Fuco1/dired-hacks</span>
(<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">dired-narrow</span> nil t)
  (define-key dired-mode-map (kbd <span style="color: #8b2252;">"/"</span>) 'dired-narrow))
(<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">dired-du</span> nil t)
(<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">ivy-dired-history</span> nil t)
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">ivy-dired-history-variable &#12399;&#65292;session.el &#12391;&#26126;&#31034;&#30340;&#12395;&#31649;&#29702;&#20013;&#65294;</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">check session-globals-include</span>
  (define-key dired-mode-map <span style="color: #8b2252;">","</span> 'dired))
(<span style="color: #a020f0;">declare-function</span> dired-extra-startup <span style="color: #8b2252;">"dired-x"</span>)
(<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">dired-x</span> nil t)
  (dired-extra-startup))
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-reveal-in-finder</span> ()
  <span style="color: #8b2252;">"Reveal the current buffer in Finder."</span>
  (<span style="color: #a020f0;">interactive</span>)
  (shell-command-to-string <span style="color: #8b2252;">"open ."</span>))
<span style="color: #b22222;">;; </span><span style="color: #b22222;">dired-x &#12434;&#35501;&#12415;&#36796;&#12435;&#12384;&#12354;&#12392;&#12376;&#12419;&#12394;&#12356;&#12392;&#12384;&#12417;</span>
(define-key dired-mode-map (kbd <span style="color: #8b2252;">"F"</span>) 'my-reveal-in-finder)
<span style="color: #b22222;">;; </span><span style="color: #b22222;">&#19978;&#20301;&#12487;&#12451;&#12524;&#12463;&#12488;&#12522;&#12408;&#12398;&#31227;&#21205;</span>
(define-key dired-mode-map (kbd <span style="color: #8b2252;">"u"</span>) 'dired-up-directory)
<span style="color: #b22222;">;; </span><span style="color: #b22222;">Finder &#12434;&#20351;&#12387;&#12383;&#12501;&#12449;&#12452;&#12523;&#12458;&#12540;&#12503;&#12531;</span>
(define-key dired-mode-map (kbd <span style="color: #8b2252;">"f"</span>) 'ns-open-file-using-panel)

(define-key dired-mode-map
  (kbd <span style="color: #8b2252;">"C-M-p"</span>) (<span style="color: #a020f0;">lambda</span> () (<span style="color: #a020f0;">interactive</span>) (other-window -1)))
(define-key dired-mode-map
  (kbd <span style="color: #8b2252;">"C-M-n"</span>) (<span style="color: #a020f0;">lambda</span> () (<span style="color: #a020f0;">interactive</span>) (other-window 1)))

<span style="color: #b22222;">;; </span><span style="color: #b22222;">https://github.com/xuchunyang/emacs.d</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">type "!" or "X" in dired</span>
(<span style="color: #a020f0;">when</span> (eq system-type 'darwin)
  (<span style="color: #a020f0;">setq</span> dired-guess-shell-alist-user
        (list
         (list (<span style="color: #a020f0;">rx</span> (<span style="color: #a020f0;">and</span> <span style="color: #8b2252;">"."</span>
                        (<span style="color: #a020f0;">or</span>
                         <span style="color: #b22222;">;; </span><span style="color: #b22222;">Videos</span>
                         <span style="color: #8b2252;">"mp4"</span> <span style="color: #8b2252;">"avi"</span> <span style="color: #8b2252;">"mkv"</span> <span style="color: #8b2252;">"rmvb"</span>
                         <span style="color: #b22222;">;; </span><span style="color: #b22222;">Torrent</span>
                         <span style="color: #8b2252;">"torrent"</span>
                         <span style="color: #b22222;">;; </span><span style="color: #b22222;">PDF</span>
                         <span style="color: #8b2252;">"pdf"</span>
                         <span style="color: #b22222;">;; </span><span style="color: #b22222;">Image</span>
                         <span style="color: #8b2252;">"gif"</span> <span style="color: #8b2252;">"png"</span> <span style="color: #8b2252;">"jpg"</span> <span style="color: #8b2252;">"jpeg"</span>)
                        string-end)) <span style="color: #ff0000; font-weight: bold;">"open"</span><span style="color: #ff0000; font-weight: bold;">))))</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">and</span> nil
           (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">hydra</span> nil t)
           (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">dired-recent</span> nil t))

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">(define-key dired-mode-map "h" 'hydra-dired/body)</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">(define-key dired-mode-map "r" 'dired-recent-open)</span>

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">https://github.com/abo-abo/hydra/wiki/Dired</span>
  (defhydra hydra-dired (<span style="color: #483d8b;">:hint</span> nil <span style="color: #483d8b;">:color</span> pink)
            <span style="color: #8b2252;">"</span>
<span style="color: #8b2252;">_+_ mkdir        _v_iew        _m_ark            _(_ details       _i_nsert-subdir</span>
<span style="color: #8b2252;">_C_opy           View _O_ther  _U_nmark all      _)_ omit-mode</span>
<span style="color: #8b2252;">_D_elete         _o_pen other  _u_nmark          _l_ redisplay     _w_ kill-subdir</span>
<span style="color: #8b2252;">_R_ename         _M_ chmod     _t_oggle          _g_ revert buf</span>
<span style="color: #8b2252;">_Y_ rel symlink  _G_ chgrp     _E_xtension mark  _s_ort            _r_ dired-recent-open</span>
<span style="color: #8b2252;">_S_ymlink        ^ ^           _F_ind marked     _._ toggle hydra  _?_ summary</span>
<span style="color: #8b2252;">_A_ find regexp  _Z_ compress  T - tag prefix</span>
<span style="color: #8b2252;">_Q_ repl regexp   [wdired] C-x C-q : edit / C-c C-c : commit / C-c ESC : abort</span>
<span style="color: #8b2252;">"</span>
            <span style="color: #b22222;">;; </span><span style="color: #b22222;">("\\" dired-do-ispell)</span>
            (<span style="color: #8b2252;">"("</span> dired-hide-details-mode)
            (<span style="color: #8b2252;">")"</span> dired-omit-mode)
            (<span style="color: #8b2252;">"+"</span> dired-create-directory)
            <span style="color: #b22222;">;; </span><span style="color: #b22222;">("=" diredp-ediff)         ;; smart diff</span>
            (<span style="color: #8b2252;">"?"</span> dired-summary)
            <span style="color: #b22222;">;; </span><span style="color: #b22222;">("$" diredp-hide-subdir-nomove)</span>
            (<span style="color: #8b2252;">"A"</span> dired-do-find-regexp)
            (<span style="color: #8b2252;">"C"</span> dired-do-copy)        <span style="color: #b22222;">;; </span><span style="color: #b22222;">Copy all marked files</span>
            (<span style="color: #8b2252;">"D"</span> dired-do-delete)
            (<span style="color: #8b2252;">"E"</span> dired-mark-extension)
            <span style="color: #b22222;">;; </span><span style="color: #b22222;">("e" dired-ediff-files)</span>
            (<span style="color: #8b2252;">"F"</span> dired-do-find-marked-files)
            (<span style="color: #8b2252;">"G"</span> dired-do-chgrp)
            (<span style="color: #8b2252;">"g"</span> revert-buffer)        <span style="color: #b22222;">;; </span><span style="color: #b22222;">read all directories again (refresh)</span>
            (<span style="color: #8b2252;">"i"</span> dired-maybe-insert-subdir)
            (<span style="color: #8b2252;">"l"</span> dired-do-redisplay)   <span style="color: #b22222;">;; </span><span style="color: #b22222;">relist the marked or singel directory</span>
            (<span style="color: #8b2252;">"M"</span> dired-do-chmod)
            (<span style="color: #8b2252;">"m"</span> dired-mark)
            (<span style="color: #8b2252;">"O"</span> dired-display-file)
            (<span style="color: #8b2252;">"o"</span> dired-find-file-other-window)
            (<span style="color: #8b2252;">"Q"</span> dired-do-find-regexp-and-replace)
            (<span style="color: #8b2252;">"R"</span> dired-do-rename)
            (<span style="color: #8b2252;">"r"</span> dired-recent-open)
            <span style="color: #b22222;">;; </span><span style="color: #b22222;">("r" dired-do-rsynch)</span>
            (<span style="color: #8b2252;">"S"</span> dired-do-symlink)
            (<span style="color: #8b2252;">"s"</span> dired-sort-toggle-or-edit)
            (<span style="color: #8b2252;">"t"</span> dired-toggle-marks)
            (<span style="color: #8b2252;">"U"</span> dired-unmark-all-marks)
            (<span style="color: #8b2252;">"u"</span> dired-unmark)
            (<span style="color: #8b2252;">"v"</span> dired-view-file)      <span style="color: #b22222;">;; </span><span style="color: #b22222;">q to exit, s to search, = gets line #</span>
            (<span style="color: #8b2252;">"w"</span> dired-kill-subdir)
            (<span style="color: #8b2252;">"Y"</span> dired-do-relsymlink)
            <span style="color: #b22222;">;; </span><span style="color: #b22222;">("z" diredp-compress-this-file)</span>
            (<span style="color: #8b2252;">"Z"</span> dired-do-compress)
            (<span style="color: #8b2252;">"q"</span> nil)
            (<span style="color: #8b2252;">"."</span> nil <span style="color: #483d8b;">:color</span> blue))
  )
</pre>
</div>
</div>
</div>

<div id="outline-container-org7c53511f" class="outline-3">
<h3 id="org7c53511f"><span class="section-number-3">8.10.</span> [dired-recent.el] 訪問したディレクトリの履歴を取る&#xa0;&#xa0;&#xa0;<span class="tag"><span class="dired">dired</span></span></h3>
<div class="outline-text-3" id="text-org7c53511f">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"dired"</span>
  (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">dired-recent</span> nil t))

(<span style="color: #a020f0;">when</span> (autoload-if-found '(dired-recent-open dired-recent-mode)
                         <span style="color: #8b2252;">"dired-recent"</span> nil t)
  (global-set-key (kbd <span style="color: #8b2252;">"C-x C-d"</span>) 'dired-recent-open)
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"dired-recent"</span>
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">(require 'helm-config nil t)</span>
    (dired-recent-mode 1)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orga3cbefa8" class="outline-3">
<h3 id="orga3cbefa8"><span class="section-number-3">8.11.</span> [osx-trash] system-move-file-to-trash を有効にする</h3>
<div class="outline-text-3" id="text-orga3cbefa8">
<p>
<a href="https://github.com/lunaryorn/osx-trash.el">osx-trash</a> は，OSXで <code>system-move-file-to-trash</code> を使えるようにする．単独で使うのはあまり考えられないので，読み込みを <code>dired</code> に紐付けます．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"dired"</span>
  (<span style="color: #a020f0;">setq</span> dired-use-ls-dired nil)
  (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">osx-trash</span> nil t)
    (<span style="color: #a020f0;">setq</span> delete-by-moving-to-trash t)
    (osx-trash-setup)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org6e71b562" class="outline-3">
<h3 id="org6e71b562"><span class="section-number-3">8.12.</span> [undo-fu.el] シンプルな redo を提供してくる</h3>
<div class="outline-text-3" id="text-org6e71b562">
<ul class="org-ul">
<li><a href="https://gitlab.com/ideasman42/emacs-undo-fu">Campbell Barton / emacs-undo-fu · GitLab</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(undo-fu-only-undo undo-fu-only-redo)
                         <span style="color: #8b2252;">"undo-fu"</span> nil t)
  (global-set-key (kbd <span style="color: #8b2252;">"C-/"</span>) 'undo-fu-only-undo)
  (global-set-key (kbd <span style="color: #8b2252;">"C-M-/"</span>) 'undo-fu-only-redo))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgde08dbd8" class="outline-3">
<h3 id="orgde08dbd8"><span class="section-number-3">8.13.</span> [super-save.el] 所定のタイミングでバッファを保存する</h3>
<div class="outline-text-3" id="text-orgde08dbd8">
<ul class="org-ul">
<li><a href="https://github.com/bbatsov/super-save">https://github.com/bbatsov/super-save</a></li>
</ul>

<p>
長らく <code>auto-save-buffers.el</code> のお世話になってきましたが， <code>super-save.el</code> に乗り換えました． <code>super-save.el</code> は，カレントバッファを切り替えるなどの任意のトリガーでバッファを保存したり， <code>auto-save-buffers.el</code> がするように，アイドル時にバッファを保存できます．
</p>

<p>
例外にするバッファ名を指定したり，特定の条件を満たしている場合に例外とするなどをカスタム変数で指定できるのが便利だと思います．
</p>

<p>
ただ， <code>org-agenda</code> のように別ファイルが直接更新された場合に，当該ファイルが自動保存されないので， <code>super-save-command</code> を <code>=my-super-save-buffers-command</code> で置き換えて使っています．このパッケージが本来持っているカレントバッファの変化に常時注目するという特徴が失われてしまいますけども&#x2026;
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-super-save-predicates-p</span> ()
  <span style="color: #8b2252;">"Return nil, if the buffer should not be saved."</span>
  (not
   (<span style="color: #a020f0;">cond</span> ((memq major-mode '(undo-tree-visualizer-mode diff-mode)) t)
         ((<span style="color: #a020f0;">when</span> (eq major-mode 'org-mode)
            <span style="color: #b22222;">;; </span><span style="color: #b22222;">when activating org-capture</span>
            (<span style="color: #a020f0;">or</span> (<span style="color: #a020f0;">bound-and-true-p</span> org-capture-mode)
                (<span style="color: #a020f0;">and</span> (fboundp 'org-entry-get)
                     (equal <span style="color: #8b2252;">""</span> (org-entry-get (point)
                                              <span style="color: #8b2252;">"EXPORT_FILE_NAME"</span>))))) <span style="color: #ff0000; font-weight: bold;">t)</span>
         ((<span style="color: #a020f0;">let</span> ((pt (point)))
            <span style="color: #b22222;">;; </span><span style="color: #b22222;">.gpg &#12391;&#21322;&#35282;&#12473;&#12506;&#12540;&#12473;&#12398;&#24460;&#12429;&#12398;&#12502;&#12522;&#12483;&#12484;&#12391;&#12399;&#33258;&#21205;&#20445;&#23384;&#12375;&#12394;&#12356;&#65294;</span>
            <span style="color: #b22222;">;; </span><span style="color: #b22222;">FIXME &#21322;&#35282;&#12473;&#12506;&#12540;&#12473;</span>
            (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">and</span> (string-match <span style="color: #8b2252;">".gpg"</span> (buffer-name))
                       (not (eq pt 1))
                       (not (eq pt (point-min))))
              (string-match (buffer-substring (- pt 1) pt) <span style="color: #8b2252;">" "</span>))) <span style="color: #ff0000; font-weight: bold;">t))))</span>

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-super-save-buffers-command</span> ()
  <span style="color: #8b2252;">"Save the buffer if needed.</span>
<span style="color: #8b2252;">see https://github.com/bbatsov/super-save/pull/20/files."</span>
  (<span style="color: #a020f0;">save-excursion</span>
    (<span style="color: #a020f0;">dolist</span> (buf (buffer-list))
      (set-buffer buf)
      (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">and</span> buffer-file-name
                 (buffer-modified-p (current-buffer))
                 (file-writable-p buffer-file-name)
                 (<span style="color: #a020f0;">if</span> (file-remote-p buffer-file-name)
                     super-save-remote-files t))
        (save-buffer)))))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">super-save</span> nil t)
  (<span style="color: #a020f0;">setq</span> super-save-auto-save-when-idle t)
  (<span style="color: #a020f0;">setq</span> super-save-idle-duration 5)
  (<span style="color: #a020f0;">setq</span> super-save-exclude '(<span style="color: #8b2252;">"Org Src"</span>))
  (add-to-list 'super-save-predicates
               '(lambda () (my-super-save-predicates-p)) t)
  (advice-add 'super-save-command <span style="color: #483d8b;">:override</span> #'my-super-save-buffers-command)
  (<span style="color: #a020f0;">unless</span> noninteractive
    (super-save-mode 1)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb8c01946" class="outline-3">
<h3 id="orgb8c01946"><span class="section-number-3">8.14.</span> <span class="done DONE">DONE</span> [auto-save-buffers.el] 一定間隔でバッファを保存する&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></h3>
<div class="outline-text-3" id="text-orgb8c01946">
<ul class="org-ul">
<li><a href="http://0xcc.net/misc/auto-save/">http://0xcc.net/misc/auto-save/</a></li>
</ul>

<p>
同じ機能で比較的新しいパッケージに， <a href="https://github.com/ChillarAnand/real-auto-save">real-auto-save.el</a> があります．ただ，私の場合は，以下のようなモードごとの制御がうまくできなかったので移行していません．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">utility.el</span>
<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-ox-hugo-auto-saving-p</span> ()
  (<span style="color: #a020f0;">when</span> (eq major-mode 'org-mode)
    (<span style="color: #a020f0;">or</span> (<span style="color: #a020f0;">bound-and-true-p</span> org-capture-mode) <span style="color: #b22222;">;; </span><span style="color: #b22222;">when activating org-capture</span>
        (<span style="color: #a020f0;">and</span> (fboundp 'org-entry-get)
             (equal <span style="color: #8b2252;">""</span> (org-entry-get (point) <span style="color: #8b2252;">"EXPORT_FILE_NAME"</span>))))))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-auto-save-buffers</span> ()
  (<span style="color: #a020f0;">cond</span> ((memq major-mode '(undo-tree-visualizer-mode diff-mode)) nil)
        ((string-match <span style="color: #8b2252;">"Org Src"</span> (buffer-name)) nil)
        ((<span style="color: #a020f0;">let</span> ((pt (point)))
           <span style="color: #b22222;">;; </span><span style="color: #b22222;">.gpg &#12391;&#21322;&#35282;&#12473;&#12506;&#12540;&#12473;&#12398;&#24460;&#12429;&#12398;&#12502;&#12522;&#12483;&#12484;&#12391;&#12399;&#33258;&#21205;&#20445;&#23384;&#12375;&#12394;&#12356;&#65294;FIXME &#21322;&#35282;&#12473;&#12506;&#12540;&#12473;</span>
           (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">and</span> (string-match <span style="color: #8b2252;">".gpg"</span> (buffer-name))
                      (not (eq pt 1))
                      (not (eq pt (point-min))))
             (string-match (buffer-substring (- pt 1) pt) <span style="color: #8b2252;">" "</span>)))
         nil)
        ((my-ox-hugo-auto-saving-p) nil)
        (t
         (auto-save-buffers))))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">late-init.el</span>
(autoload 'auto-save-buffers <span style="color: #8b2252;">"auto-save-buffers"</span> nil t)
(run-with-idle-timer 1.6 t #'my-auto-save-buffers)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgab837e6a" class="outline-3">
<h3 id="orgab837e6a"><span class="section-number-3">8.15.</span> [session.el] 様々な履歴を保存し復元に利用する</h3>
<div class="outline-text-3" id="text-orgab837e6a">
<p>
<a href="http://emacs-session.sourceforge.net/">http://emacs-session.sourceforge.net/</a>
</p>

<ul class="org-ul">
<li>入力履歴の保持（検索語，表示したバッファ履歴）</li>
<li>保存時のカーソル位置の保持</li>
<li>キルリングの保持</li>
<li>変更が加えられたファイル履歴の保持</li>
<li><code>session-initialize</code> の呼び出しタイミングに注意．前回終了時の状況を保存しているため，他のパッケージの初期化が終った後に呼び出すと，パッケージが想定している初期化を上書きしてしまい，不安定になる． <code>after-init-hook</code> 推奨．</li>
</ul>
<ul class="org-ul">
<li class="off"><code>[&#xa0;]</code> <code>M-x session-save-session</code></li>
</ul>

<p>
session-undo-check を指定していると，保存時ではなくバッファを閉じるときの状態を保持する．
</p>

<p>
Org Mode と併用する場合は， my-org-reveal-session-jump の設定が必須．
</p>

<p>
上記のパッケージだと， <code>session-set-file-name-exclude-regexp</code> が <code>session-file-alist</code> に効かず，除外したはずのファイルのカーソル位置などが記録されてしまうので，それに対処したパッケージを自分用に作って使っています．
</p>

<ul class="org-ul">
<li><a href="https://github.com/takaxp/session">https://github.com/takaxp/session</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(<span style="color: #a020f0;">when</span> (autoload-if-found '(session-initialize)
                         <span style="color: #8b2252;">"session"</span> nil t)
  (<span style="color: #a020f0;">unless</span> (<span style="color: #a020f0;">or</span> noninteractive my-secure-boot)
    (add-hook 'after-init-hook #'session-initialize))
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"session"</span>
    (add-to-list 'session-globals-include 'ivy-dired-history-variable)
    (add-to-list 'session-globals-exclude 'org-mark-ring)
    (<span style="color: #a020f0;">setq</span> session-set-file-name-exclude-regexp <span style="color: #8b2252;">"[/\\]\\.overview</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">|</span><span style="color: #8b2252;">[/\\]\\.session</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">|</span><span style="color: #8b2252;">News[/\\]</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">|</span><span style="color: #8b2252;">[/\\]COMMIT_EDITMSG"</span>)
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">Change save point of session.el</span>
    (<span style="color: #a020f0;">setq</span> session-save-file
          (expand-file-name (concat (getenv <span style="color: #8b2252;">"SYNCROOT"</span>) <span style="color: #8b2252;">"/emacs.d/.session"</span>)))
    (<span style="color: #a020f0;">setq</span> session-initialize '(de-saveplace session keys menus places)
          session-globals-include '((kill-ring 100)
                                    (session-file-alist 100 t)
                                    (file-name-history 200)
                                    ivy-dired-history-variable
                                    search-ring
                                    regexp-search-ring))
    (<span style="color: #a020f0;">setq</span> session-undo-check -1)))
</pre>
</div>

<p>
次はテスト中．orgバッファを開いたらカーソル位置をorg-revealしたいが，time-stampなどと組み合わせたり，org-tree-slideと組み合わせていると，うまくいかない．バッファを表示した時に org-reveal (C-c C-r) を打つのをサボりたいだけなのだが．．．
</p>

<p>
<a href="http://www.emacswiki.org/emacs/EmacsSession">http://www.emacswiki.org/emacs/EmacsSession</a>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(session-initialize)
                         <span style="color: #8b2252;">"session"</span> nil t)
  (add-hook 'after-init-hook #'session-initialize)
  (eval-after-load <span style="color: #8b2252;">"session"</span>
    '(progn
       <span style="color: #b22222;">;; </span><span style="color: #b22222;">For Org-mode</span>
       (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-maybe-reveal</span> ()
         (<span style="color: #a020f0;">interactive</span>)
         (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">and</span> (<span style="color: #a020f0;">or</span> (memq major-mode '(org-mode outline-mode))
                        (<span style="color: #a020f0;">and</span> (boundp 'outline-minor-mominor-de)
                             outline-minor-mode))
                    (outline-invisible-p))
           (<span style="color: #a020f0;">if</span> (eq major-mode 'org-mode)
               (org-reveal)
             (show-subtree))))

       (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-org-reveal-session-jump</span> ()
         (message <span style="color: #8b2252;">"call!"</span>)
         (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">and</span> (eq major-mode 'org-mode)
                    (outline-invisible-p))
           (org-reveal)))

       <span style="color: #b22222;">;; </span><span style="color: #b22222;">C-x C-/</span>
       (add-hook 'session-after-jump-to-last-change-hook
                 #'my-maybe-reveal))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org92404bbd" class="outline-3">
<h3 id="org92404bbd"><span class="section-number-3">8.16.</span> [neotree.el] ディレクトリ情報をツリー表示</h3>
<div class="outline-text-3" id="text-org92404bbd">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">ad:neotree-show</span> ()
  <span style="color: #8b2252;">"Extension to support change frame width when opening neotree."</span>
  (<span style="color: #a020f0;">unless</span> (neo-global--window-exists-p)
    (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">and</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">moom</span> nil t)
               (not my-neo-activated))
      (<span style="color: #a020f0;">setq</span> moom-frame-width-single
            (+ moom-frame-width-single my-neo-adjusted-window-width))
      (<span style="color: #a020f0;">setq</span> moom-frame-width-double
            (+ moom-frame-width-double my-neo-adjusted-window-width)))
    (set-frame-width nil (+ (frame-width) my-neo-adjusted-window-width))
    (<span style="color: #a020f0;">setq</span> my-neo-activated t)))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">ad:neotree-hide</span> ()
  <span style="color: #8b2252;">"Extension to support change frame width when closing neotree."</span>
  (<span style="color: #a020f0;">when</span> (neo-global--window-exists-p)
    (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">and</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">moom</span> nil t)
               my-neo-activated)
      (<span style="color: #a020f0;">setq</span> moom-frame-width-single
            (- moom-frame-width-single my-neo-adjusted-window-width))
      (<span style="color: #a020f0;">setq</span> moom-frame-width-double
            (- moom-frame-width-double my-neo-adjusted-window-width)))
    (set-frame-width nil (- (frame-width) my-neo-adjusted-window-width))
    (<span style="color: #a020f0;">when</span> (&gt; 80 (frame-width)) <span style="color: #b22222;">;; </span><span style="color: #b22222;">fail safe</span>
      (set-frame-width nil 80))
    (<span style="color: #a020f0;">setq</span> my-neo-activated nil)))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(neotree neotree-toggle)
                         <span style="color: #8b2252;">"neotree"</span> nil t)
  (global-set-key (kbd <span style="color: #8b2252;">"C-c n"</span>) #'neotree-toggle)
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"neotree"</span>
    (custom-set-variables
     '(neo-show-hidden-files t)
     '(neo-theme 'arrow)
     '(neo-smart-open t)
     '(neo-window-width 25)
     '(neo-show-hidden-files nil)
     '(neo-window-position 'left))
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">(setq neo-vc-integration '(face char)) ;; It's heavy at 2017-08-31</span>

    <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#12450;&#12452;&#12467;&#12531;&#34920;&#31034;</span>
    (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">all-the-icons-dired</span> nil t)
      (<span style="color: #a020f0;">setq</span> neo-theme (<span style="color: #a020f0;">if</span> (display-graphic-p) 'icons 'arrow)))

    (<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">my-neo-activated</span> nil) <span style="color: #b22222;">;; </span><span style="color: #b22222;">fail save</span>
    (<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">my-neo-adjusted-window-width</span> (+ 3 neo-window-width))
    (advice-add 'neotree-show <span style="color: #483d8b;">:before</span> #'ad:neotree-show)
    (advice-add 'neotree-hide <span style="color: #483d8b;">:before</span> #'ad:neotree-hide)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf2d47943" class="outline-3">
<h3 id="orgf2d47943"><span class="section-number-3">8.17.</span> [helpful.el] リッチなヘルプページ</h3>
<div class="outline-text-3" id="text-orgf2d47943">
<p>
ヘルプの内容を見やすく構造化して表示してくれます．関数や変数のヘルプだけでなく，キーやマクロなども見やすく表示してくれます．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">ad:helpful-at-point</span> ()
  (deactivate-mark))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(helpful-key
                           helpful-function helpful-variable helpful-at-point
                           helpful-symbol)
                         <span style="color: #8b2252;">"helpful"</span> nil t)
  (global-set-key (kbd <span style="color: #8b2252;">"&lt;f1&gt; k"</span>) 'helpful-key)
  (global-set-key (kbd <span style="color: #8b2252;">"&lt;f1&gt; f"</span>) 'helpful-function)
  (global-set-key (kbd <span style="color: #8b2252;">"&lt;f1&gt; v"</span>) 'helpful-variable)
  (global-set-key (kbd <span style="color: #8b2252;">"&lt;f1&gt; m"</span>) 'helpful-macro)
  (global-set-key (kbd <span style="color: #8b2252;">"&lt;f1&gt; @"</span>) 'helpful-at-point)
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"helpful"</span>
    (advice-add 'helpful-at-point <span style="color: #483d8b;">:before</span> #'ad:helpful-at-point)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc08799d2" class="outline-3">
<h3 id="orgc08799d2"><span class="section-number-3">8.18.</span> [facecheck.el] クリックしてfaceをチェック</h3>
<div class="outline-text-3" id="text-orgc08799d2">
<p>
マウスクリックでface情報を表示する．マイナーモードを有効にして使います．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(facecheck-at-point facecheck-mode)
                         <span style="color: #8b2252;">"facecheck"</span> nil t)
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"facecheck"</span>
    (facecheck-mode 1)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org0d952d68" class="outline-3">
<h3 id="org0d952d68"><span class="section-number-3">8.19.</span> [keyfreq.el] コマンドログ</h3>
<div class="outline-text-3" id="text-org0d952d68">
<p>
発行しているコマンドの使用頻度を記録し確認できます．デフォルトで， <code>~/.emacs.keyfreq</code> に情報が記録されます．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">ad:keyfreq-show</span> ()
  <span style="color: #8b2252;">"Extension to make the buffer view-only."</span>
  (<span style="color: #a020f0;">interactive</span>)
  (<span style="color: #a020f0;">if</span> shutup-p
      (shut-up (view-buffer keyfreq-buffer))
    (view-buffer keyfreq-buffer)))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(keyfreq-mode keyfreq-autosave-mode ad:keyfreq-show)
                         <span style="color: #8b2252;">"keyfreq"</span> nil t) <span style="color: #b22222;">;; </span><span style="color: #b22222;">will require 'cl and 'gv(10-20[ms])</span>
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"keyfreq"</span>
    (advice-add 'keyfreq-show <span style="color: #483d8b;">:after</span> #'ad:keyfreq-show)
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">(define-key keyfreq-mode-map (kbd "q")</span>
    <span style="color: #b22222;">;;   </span><span style="color: #b22222;">(lambda () (interactive)</span>
    <span style="color: #b22222;">;;       </span><span style="color: #b22222;">(when (string= (buffer-name) keyfreq-buffer)</span>
    <span style="color: #b22222;">;;         </span><span style="color: #b22222;">(kill-buffer-and-window))))</span>
    (<span style="color: #a020f0;">setq</span> keyfreq-file
          (expand-file-name (concat (getenv <span style="color: #8b2252;">"SYNCROOT"</span>) <span style="color: #8b2252;">"/emacs.d/.keyfreq"</span>)))
    (keyfreq-autosave-mode 1))
  (<span style="color: #a020f0;">unless</span> noninteractive
    (keyfreq-mode 1)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orged77c483" class="outline-3">
<h3 id="orged77c483"><span class="section-number-3">8.20.</span> [disk-usage.el] ディスク利用率を調べる</h3>
<div class="outline-text-3" id="text-orged77c483">
<p>
<code>ncdu</code> コマンドのように，システムのディスク利用率を調べてバッファに一覧表示します．ただ，非同期に対応していないので，普通にシェルで <code>ncdu</code> コマンドを使う方が良い気がします．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(disk-usage)
                         <span style="color: #8b2252;">"disk-usage"</span> nil t)
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"disk-usage"</span>
    (<span style="color: #a020f0;">when</span> (eq system-type 'darwin)
      (custom-set-variables
       '(disk-usage-du-command <span style="color: #8b2252;">"du"</span>)))))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdd1e03ec" class="outline-3">
<h3 id="orgdd1e03ec"><span class="section-number-3">8.21.</span> [uptimes.el] Emacsの起動時間を記録する</h3>
<div class="outline-text-3" id="text-orgdd1e03ec">
<p>
<a href="https://github.com/davep/uptimes.el">davep/uptimes.el: Uptime tracking system for emacs.</a> を使うと，過去数回の起動・稼働・終了履歴がわかります．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span>
(<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">uptimes</span> nil t)
</pre>
</div>

<p>
<code>M-x uptimes</code> すると，以下のような履歴が表示されます．
</p>

<div class="org-src-container">
<pre class="src src-text">Last 10 uptimes

Boot                Endtime             Uptime       This emacs
=================== =================== ============ ==========
2019-04-17 12:28:14 2019-04-17 12:29:37   0.00:01:23 &lt;--
2019-04-17 12:28:18 2019-04-17 12:28:25   0.00:00:06
2019-04-17 11:47:13 2019-04-17 12:10:39   0.00:23:26
2019-04-17 11:13:13 2019-04-17 11:21:05   0.00:07:51

Top 10 uptimes

Boot                Endtime             Uptime       This emacs
=================== =================== ============ ==========
2019-04-17 11:47:13 2019-04-17 12:10:39   0.00:23:26
2019-04-17 11:13:13 2019-04-17 11:21:05   0.00:07:51
2019-04-17 12:28:14 2019-04-17 12:29:37   0.00:01:23 &lt;--
2019-04-17 12:28:18 2019-04-17 12:28:25   0.00:00:06
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfd3c67b9" class="outline-3">
<h3 id="orgfd3c67b9"><span class="section-number-3">8.22.</span> [ag.el] 検索</h3>
<div class="outline-text-3" id="text-orgfd3c67b9">
<p>
検索には <code>The Silver Searcher</code> を使います．あらかじめインストールしておく必要があります．MacPorts の場合，the_silver_searcher の名称で頒布されています． <code>exec-path</code> に <code>/opt/local/bin</code> が含まれていることを確認してください．
</p>

<div class="org-src-container">
<pre class="src src-sh">the_silver_searcher @0.18.1 (textproc)
 A code-searching tool similar to ack, but faster.
</pre>
</div>

<p>
カスタマイズした関数を <code>C-M-f</code> にぶら下げています．helm インタフェースを使う <code>helm-ag</code> や ivy インターフェイスを使う <code>counsel-ag</code> もあります． <code>C-M-f</code> は，本来，S式の移動(<code>forward-sexp</code>)に使われています．
</p>

<p>
最近は， <code>counsel-ag</code> に移行しました．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">if</span> (executable-find <span style="color: #8b2252;">"ag"</span>)
    (<span style="color: #a020f0;">when</span> (autoload-if-found '(my-ag ag)
                             <span style="color: #8b2252;">"ag"</span> nil t)
      (autoload-if-found '(helm-ag) <span style="color: #8b2252;">"helm-ag"</span> nil t)
      (global-set-key (kbd <span style="color: #8b2252;">"C-M-f"</span>) 'my-ag)

      (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"ag"</span>
        (custom-set-variables
         '(ag-highlight-search t)
         '(ag-reuse-buffers t)          <span style="color: #b22222;">;; </span><span style="color: #b22222;">nil: &#21029;&#12454;&#12451;&#12531;&#12489;&#12454;&#12364;&#38283;&#12367;</span>
         '(ag-reuse-window nil))        <span style="color: #b22222;">;; </span><span style="color: #b22222;">nil: &#32080;&#26524;&#12434;&#36984;&#25246;&#26178;&#12395;&#21029;&#12454;&#12451;&#12531;&#12489;&#12454;&#12395;&#32080;&#26524;&#12434;&#20986;&#12377;</span>

        <span style="color: #b22222;">;; </span><span style="color: #b22222;">q &#12391;&#12454;&#12451;&#12531;&#12489;&#12454;&#12434;&#25244;&#12369;&#12427;</span>
        <span style="color: #b22222;">;; </span><span style="color: #b22222;">(define-key ag-mode-map (kbd "q") 'delete-window)</span>
        (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-ag</span> ()
          <span style="color: #8b2252;">"Switch to search result."</span>
          (<span style="color: #a020f0;">interactive</span>)
          (call-interactively 'ag)
          (switch-to-buffer-other-frame <span style="color: #8b2252;">"*ag search*"</span>))))

  (<span style="color: #a020f0;">unless</span> noninteractive
    (message <span style="color: #8b2252;">"--- ag is NOT installed in this system."</span>)))
</pre>
</div>
</div>
</div>
<div id="outline-container-org29c7b6b7" class="outline-3">
<h3 id="org29c7b6b7"><span class="section-number-3">8.23.</span> [counsel-ag.el] 高速全文検索</h3>
<div class="outline-text-3" id="text-org29c7b6b7">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">ad:counsel-ag</span> (f <span style="color: #228b22;">&amp;optional</span> initial-input initial-directory extra-ag-args ag-prompt caller)
  (apply f (<span style="color: #a020f0;">or</span> initial-input
               (<span style="color: #a020f0;">and</span> (not (thing-at-point-looking-at <span style="color: #8b2252;">"^\\*+"</span>))
                    (ivy-thing-at-point)))
         (<span style="color: #a020f0;">unless</span> current-prefix-arg
           (<span style="color: #a020f0;">or</span> initial-directory default-directory))
         extra-ag-args ag-prompt caller))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(counsel-ag)
                         <span style="color: #8b2252;">"counsel"</span> nil t)
  (global-set-key (kbd <span style="color: #8b2252;">"C-M-f"</span>) 'counsel-ag)
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"counsel"</span>
    (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">thingatpt</span> nil t)
    (advice-add 'counsel-ag <span style="color: #483d8b;">:around</span> #'ad:counsel-ag)

    <span style="color: #b22222;">;; </span><span style="color: #b22222;">2&#25991;&#23383;&#12391;&#12418;&#26908;&#32034;&#12364;&#30330;&#21205;&#12377;&#12427;&#12424;&#12358;&#12395;&#12377;&#12427;</span>
    (add-to-list 'ivy-more-chars-alist '(counsel-ag . 2))

    (ivy-add-actions
     'counsel-ag
     '((<span style="color: #8b2252;">"r"</span> my-counsel-ag-in-dir <span style="color: #8b2252;">"search in directory"</span>)))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org24fd7b68" class="outline-3">
<h3 id="org24fd7b68"><span class="section-number-3">8.24.</span> [counsel-fzf.el] 高速ファイル検索</h3>
<div class="outline-text-3" id="text-org24fd7b68">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">ad:counsel-fzf</span> (f <span style="color: #228b22;">&amp;optional</span> initial-input initial-directory fzf-prompt)
  (apply f (<span style="color: #a020f0;">or</span> initial-input
               (<span style="color: #a020f0;">if</span> (thing-at-point-looking-at <span style="color: #8b2252;">"^\\*+"</span>) <span style="color: #b22222;">;; </span><span style="color: #b22222;">org heading &#12434;&#38500;&#22806;</span>
                   nil
                 (ivy-thing-at-point)))
         (<span style="color: #a020f0;">or</span> initial-directory (funcall counsel-fzf-dir-function))
         fzf-prompt))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(counsel-fzf)
                         <span style="color: #8b2252;">"counsel"</span> nil t)
  (global-set-key (kbd <span style="color: #8b2252;">"C-M-z"</span>) 'counsel-fzf)
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"counsel"</span>
    (advice-add 'counsel-fzf <span style="color: #483d8b;">:around</span> #'ad:counsel-fzf)
    (ivy-add-actions
     'counsel-fzf
     '((<span style="color: #8b2252;">"r"</span> my-counsel-fzf-in-dir <span style="color: #8b2252;">"search in directory"</span>)))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org694ee426" class="outline-3">
<h3 id="org694ee426"><span class="section-number-3">8.25.</span> <span class="done DONE">DONE</span> [undo-propose] undo を編集不可モードで辿る&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></h3>
<div class="outline-text-3" id="text-org694ee426">
<p>
最近は <b>undo-fu.el</b> を使っています．
</p>

<ul class="org-ul">
<li><a href="https://github.com/jackkamm/undo-propose-el">jackkamm/undo-propose-el: Navigate the emacs undo history by staging undo's in a temporary buffer</a></li>
</ul>

<p>
<code>undo</code> する時に，バッファに意図しない変更が加わると面倒なことになります．そこで <code>org-capture</code> なキーバインドで動作する <code>undo-propose</code> を使います．
</p>

<p>
<code>undo-propose</code> でモードに入ったら， <code>C-/</code> で <code>undo</code> して，確定するなら <code>C-c C-c</code> ，キャンセルするなら <code>C-c C-k</code> します．オリジナルのバッファを直接変更せず，一時的なバッファで <code>undo</code> してから反映させるのでより安全です．
</p>

<p>
次の設定では，標準の <code>undo</code> をオーバーライドするように <code>undo-propose</code> を使います．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">late-init.el</span>
(<span style="color: #a020f0;">when</span> (autoload-if-found '(undo-propose)
                         <span style="color: #8b2252;">"undo-propose"</span> nil t)

  (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-undo-propose</span> ()
    (<span style="color: #a020f0;">interactive</span>)
    (<span style="color: #a020f0;">if</span> (<span style="color: #a020f0;">or</span> (buffer-narrowed-p)
            (eq major-mode 'org-mode))
        (undo)
      (undo-propose)))

  (global-set-key (kbd <span style="color: #8b2252;">"C-/"</span>) 'my-undo-propose)

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">located here intended to share this command with `</span><span style="color: #008b8b;">undo-tree</span><span style="color: #b22222;">'</span>
  (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-org-reveal-and-focus</span> (<span style="color: #228b22;">&amp;optional</span> _arg)
    <span style="color: #8b2252;">"Reveal a heading and focus on the content."</span>
    (<span style="color: #a020f0;">when</span> (eq major-mode 'org-mode)
      (org-overview)
      (<span style="color: #a020f0;">unless</span> (org-before-first-heading-p)
        (org-reveal)
        (org-cycle-hide-drawers 'all)
        (org-show-entry)
        (show-children)
        (org-show-siblings))))
  (advice-add 'undo <span style="color: #483d8b;">:after</span> #'my-org-reveal-and-focus)

  (<span style="color: #a020f0;">eval-when-compile</span>
    (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">undo-propose</span> nil t)) <span style="color: #b22222;">;; </span><span style="color: #b22222;">for `</span><span style="color: #008b8b;">undo-propose-wrap</span><span style="color: #b22222;">'</span>

  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"undo-propose"</span>
    (add-hook 'undo-propose-entry-hook #'undo) <span style="color: #b22222;">;; </span><span style="color: #b22222;">immediate undo</span>
    (undo-propose-wrap redo)

    (define-key undo-propose-mode-map (kbd <span style="color: #8b2252;">"/"</span>) 'undo)
    (define-key undo-propose-mode-map (kbd <span style="color: #8b2252;">"q"</span>) 'undo-propose-cancel)
    (advice-add 'undo-propose-commit <span style="color: #483d8b;">:after</span> #'my-org-reveal-and-focus)
    (advice-add 'undo-propose-squash-commit <span style="color: #483d8b;">:after</span> #'my-org-reveal-and-focus)

    <span style="color: #b22222;">;; </span><span style="color: #b22222;">Moving coursor in `</span><span style="color: #008b8b;">undo-propose-mode</span><span style="color: #b22222;">' will also commit changes.</span>
    (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-undo-propose-commit</span> ()
      (<span style="color: #a020f0;">when</span> undo-propose-mode
        (undo-propose-commit)))

    (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-undo-propose-autocommit-on</span> ()
      (add-hook 'ah-after-move-cursor-hook 'my-undo-propose-commit))
    (advice-add 'undo-propose <span style="color: #483d8b;">:after</span> #'my-undo-propose-autocommit-on)

    (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-undo-propose-autocommit-off</span> ()
      (remove-hook 'ah-after-move-cursor-hook 'my-undo-propose-commit))
    (add-hook 'undo-propose-done-hook #'my-undo-propose-autocommit-off)

    <span style="color: #b22222;">;; </span><span style="color: #b22222;">SPC and RET in `</span><span style="color: #008b8b;">undo-propose-mode</span><span style="color: #b22222;">' will commit changes.</span>
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">Additionally, the commands will be executed.</span>
    (define-key undo-propose-mode-map (kbd <span style="color: #8b2252;">"SPC"</span>) 'undo-propose-commit)
    (define-key undo-propose-mode-map (kbd <span style="color: #8b2252;">"RET"</span>) 'undo-propose-commit)
    (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-undo-propose-key-through</span> ()
      <span style="color: #8b2252;">"Through SPC and RET."</span>
      (<span style="color: #a020f0;">let</span> ((command (this-command-keys)))
        (<span style="color: #a020f0;">cond</span> ((equal (kbd <span style="color: #8b2252;">"SPC"</span>) command)
               (insert <span style="color: #8b2252;">" "</span>))
              ((equal (kbd <span style="color: #8b2252;">"RET"</span>) command)
               (electric-newline-and-maybe-indent)))))
    (advice-add 'undo-propose-commit <span style="color: #483d8b;">:after</span> #'my-undo-propose-key-through)

    (<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">my-undo-propose-modeline</span> '(<span style="color: #8b2252;">"#FF5d5d"</span> <span style="color: #8b2252;">"#FFFFFF"</span>))
    (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-undo-propose-mode-line</span> ()
      (custom-set-faces
       `(mode-line ((t (<span style="color: #483d8b;">:background</span>
                        ,(nth 0 my-undo-propose-modeline)
                        <span style="color: #483d8b;">:foreground</span>
                        ,(nth 1 my-undo-propose-modeline)))))))

    (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-undo-propose-mode-line-restore</span> ()
      (custom-set-faces '(mode-line ((t nil)))))

    (add-hook 'undo-propose-entry-hook #'my-undo-propose-mode-line)
    (add-hook 'undo-propose-done-hook #'my-undo-propose-mode-line-restore)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org82bd942f" class="outline-3">
<h3 id="org82bd942f"><span class="section-number-3">8.26.</span> <span class="done DONE">DONE</span> [undo-tree] 編集履歴をわかりやすくたどる&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></h3>
<div class="outline-text-3" id="text-org82bd942f">
<p>
最近は <b>undo-fu.el</b> を使っています．
</p>

<p>
Undoのツリーが表示され，履歴をたどれます． <code>C-x u</code> と <code>q</code> に対して，フレームサイズの変更を紐付けています．また， <code>auto-save-buffers</code> が org-files をどんどん保存して記録してしまうので，ツリーを選んでいる時に auto-save-buffers が発動するのを別途抑制しています．加えて， <code>org-tree-slide</code> でナローイングしていると，タイムスタンプが記録される時に履歴が辿れなくなるので， <code>org-tree-slide</code> が有効の時は，タイムスタンプを押させないように別途制限を加えています．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">late-init.el</span>
(<span style="color: #a020f0;">when</span> (autoload-if-found '(my-undo-tree-visualize)
                         <span style="color: #8b2252;">"undo-tree"</span> nil t)
  (global-set-key (kbd <span style="color: #8b2252;">"C-x u"</span>) 'my-undo-tree-visualize)
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"undo-tree"</span>
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">(global-undo-tree-mode)</span>
    (<span style="color: #a020f0;">setq</span> undo-tree-mode-lighter nil) <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#12514;&#12540;&#12489;&#12521;&#12452;&#12531;&#38936;&#22495;&#12434;&#31680;&#32004;</span>

    (<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">my-undo-tree-active</span> nil)
    (<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">my-undo-tree-width</span> 90)

    (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-undo-tree-visualize</span> ()
      (<span style="color: #a020f0;">interactive</span>)
      (undo-tree-mode 1)
      (<span style="color: #a020f0;">if</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">moom</span> nil t)
          (moom-change-frame-width-double)
        (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">and</span> (not my-undo-tree-active)
                   (not (eq buffer-undo-list t)))
          (set-frame-width nil (+ (frame-width) my-undo-tree-width))
          (<span style="color: #a020f0;">setq</span> my-undo-tree-active t)))
      (undo-tree-visualize))

    (define-key undo-tree-map (kbd <span style="color: #8b2252;">"C-x u"</span>) 'my-undo-tree-visualize)

    (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-undo-tree-visualizer-quit</span> ()
      (<span style="color: #a020f0;">interactive</span>)
      (undo-tree-visualizer-quit)
      (<span style="color: #a020f0;">if</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">moom</span> nil t)
          (moom-change-frame-width-single)
        (delete-window)
        (<span style="color: #a020f0;">when</span> my-undo-tree-active
          (set-frame-width nil (- (frame-width) my-undo-tree-width))
          (<span style="color: #a020f0;">setq</span> my-undo-tree-active nil)))
      (<span style="color: #a020f0;">when</span> (&lt; (frame-width) 80)
        (set-frame-width nil 80))
      (undo-tree-mode -1))

    (define-key undo-tree-visualizer-mode-map (kbd <span style="color: #8b2252;">"q"</span>)
      'my-undo-tree-visualizer-quit))

  (advice-add 'undo-tree-undo-1 <span style="color: #483d8b;">:after</span> #'my-org-reveal-and-focus)
  (advice-add 'undo-tree-redo-1 <span style="color: #483d8b;">:after</span> #'my-org-reveal-and-focus))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc47c1e75" class="outline-3">
<h3 id="orgc47c1e75"><span class="section-number-3">8.27.</span> <span class="done DONE">DONE</span> [wakatime-mode.el] WakaTime を利用して作業記録する&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></h3>
<div class="outline-text-3" id="text-orgc47c1e75">
<ol class="org-ol">
<li><a href="https://www.wakati.me/">https://www.wakati.me/</a>（API発行とログGUI表示）</li>
<li><a href="https://github.com/wakatime/wakatime">https://github.com/wakatime/wakatime</a>（ログ記録用スクリプト）</li>
<li><a href="https://github.com/nyuhuhuu/wakatime-mode">https://github.com/nyuhuhuu/wakatime-mode</a>（Emacs用プラグイン）</li>
</ol>

<p>
利用開始前に，ログ表示サイトでルールをカスタマイズしておくとよい．例えば，拡張子が <code>.org</code> なファイルの場合，言語設定を <code>Text</code> にする，という具合に．すると，グラフ表示がわかりやすくなる．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">wakatime-mode</span> nil t)
  (<span style="color: #a020f0;">setq</span> wakatime-api-key <span style="color: #8b2252;">"&lt;insert your own api key&gt;"</span>)
  (<span style="color: #a020f0;">setq</span> wakatime-cli-path <span style="color: #8b2252;">"/Users/taka/Dropbox/emacs.d/bin/wakatime-cli.py"</span>)
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#12377;&#12409;&#12390;&#12398;&#12496;&#12483;&#12501;&#12449;&#12391;&#35370;&#21839;&#26178;&#12395;&#35352;&#37682;&#12434;&#38283;&#22987;</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">(global-wakatime-mode)</span>
    )
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc470d5a3" class="outline-3">
<h3 id="orgc470d5a3"><span class="section-number-3">8.28.</span> <span class="done DONE">DONE</span> [backup-dir.el] バックアップファイルを一箇所に集める&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></h3>
<div class="outline-text-3" id="text-orgc470d5a3">
<p>
<code>backup-each-save</code> を使うようになりました．
</p>

<ul class="org-ul">
<li><a href="http://www.emacswiki.org/emacs/BackupDirectory">http://www.emacswiki.org/emacs/BackupDirectory</a></li>
<li><a href="http://www.northbound-train.com/emacs-hosted/backup-dir.el">http://www.northbound-train.com/emacs-hosted/backup-dir.el</a></li>
<li><a href="http://www.northbound-train.com/emacs.html">http://www.northbound-train.com/emacs.html</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(make-variable-buffer-local 'backup-inhibited)
(<span style="color: #a020f0;">setq</span> backup-files-store-dir <span style="color: #8b2252;">"~/.emacs.d/backup"</span>)
(<span style="color: #a020f0;">unless</span> (file-directory-p backup-files-store-dir)
  (message <span style="color: #8b2252;">"!!! %s does not exist. !!!"</span> backup-files-store-dir)
  (sleep-for 1))
(<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">backup-dir</span> nil t)
  (<span style="color: #a020f0;">when</span> (file-directory-p backup-files-store-dir)
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">backup path</span>
    (<span style="color: #a020f0;">setq</span> bkup-backup-directory-info '((t <span style="color: #8b2252;">"~/.emacs.d/backup"</span> ok-create)))
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">for tramp</span>
    (<span style="color: #a020f0;">setq</span> tramp-bkup-backup-directory-info bkup-backup-directory-info)
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">generation properties</span>
    (<span style="color: #a020f0;">setq</span> delete-old-versions t
          kept-old-versions 0
          kept-new-versions 5
          version-control t)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org8b2fe680" class="outline-3">
<h3 id="org8b2fe680"><span class="section-number-3">8.29.</span> <span class="done DONE">DONE</span> バッファ保存時にバックアップファイルを生成する&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></h3>
<div class="outline-text-3" id="text-org8b2fe680">
<p>
バッファが保存されるとき，必ずバックアップを生成する．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">Backup the buffer whenever the buffer is saved</span>
(global-set-key (kbd <span style="color: #8b2252;">"C-x C-s"</span>)
                (<span style="color: #a020f0;">lambda</span> () (<span style="color: #a020f0;">interactive</span>) (save-buffer 16)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdba35c9f" class="outline-3">
<h3 id="orgdba35c9f"><span class="section-number-3">8.30.</span> <span class="done DONE">DONE</span> ミニバッファの履歴を保存しリストアする&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></h3>
<div class="outline-text-3" id="text-orgdba35c9f">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">savehist</span> nil t)
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#12498;&#12473;&#12488;&#12522;&#12501;&#12449;&#12452;&#12523;&#12434;&#26126;&#31034;&#30340;&#12395;&#25351;&#23450;</span>
  (<span style="color: #a020f0;">setq</span> savehist-file <span style="color: #8b2252;">"~/Dropbox/emacs.d/.history"</span>)
  (savehist-mode 1))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgead91174" class="outline-3">
<h3 id="orgead91174"><span class="section-number-3">8.31.</span> <span class="done DONE">DONE</span> Emacs終了時に開いていたバッファを起動時に復元する&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></h3>
<div class="outline-text-3" id="text-orgead91174">
<p>
Built-in の <a href="http://www.emacswiki.org/emacs/DeskTop">desktop.el</a> を使う．
</p>

<p>
org バッファを CONTENT view で大量に開いていると，再起動が非常に遅くなるので利用を中止した．代替手段として， <code>session.el</code> と <code>recentf</code> の組み合わせがある．最近利用したファイルとそのカーソル位置が保持されるため，最後に訪問していたファイルを比較的簡単に復元できる．頻繁に復元するバッファには，別途キーバインドを割り当てておけば問題ない．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"postpone"</span>
  (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">desktop</span> nil t)
    (<span style="color: #a020f0;">setq</span> desktop-files-not-to-save <span style="color: #8b2252;">"</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">(</span><span style="color: #8b2252;">^/tmp</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">|</span><span style="color: #8b2252;">^/var</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">|</span><span style="color: #8b2252;">^/ssh:</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">)</span><span style="color: #8b2252;">"</span>)
    (<span style="color: #a020f0;">unless</span> noninteractive
      (desktop-save-mode 1))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org63e50e2c" class="outline-3">
<h3 id="org63e50e2c"><span class="section-number-3">8.32.</span> <span class="done DONE">DONE</span> 深夜にバッファを自動整理する&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></h3>
<div class="outline-text-3" id="text-org63e50e2c">
<p>
私は頻繁に再起動する派なので，使っていません．
</p>

<ul class="org-ul">
<li><a href="http://www.emacswiki.org/emacs-zh/CleanBufferList">http://www.emacswiki.org/emacs-zh/CleanBufferList</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">midnight</span> nil t)
  (<span style="color: #a020f0;">setq</span> clean-buffer-list-buffer-names
        (append clean-buffer-list-kill-buffer-names
                '(<span style="color: #8b2252;">"note.txt"</span>)))
  (<span style="color: #a020f0;">setq</span> clean-buffer-list-delay-general 1)
  (<span style="color: #a020f0;">setq</span> clean-buffer-list-delay-special 10))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgf1b8fa63" class="outline-2">
<h2 id="orgf1b8fa63"><span class="section-number-2">9.</span> 開発サポート</h2>
<div class="outline-text-2" id="text-orgf1b8fa63">
</div>
<div id="outline-container-org9f988c12" class="outline-3">
<h3 id="org9f988c12"><span class="section-number-3">9.1.</span> 便利キーバインド</h3>
<div class="outline-text-3" id="text-org9f988c12">
<p>
コメントアウトとコンパイルをすぐ呼べるようにします．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(global-set-key (kbd <span style="color: #8b2252;">"C-;"</span>) 'comment-dwim) <span style="color: #b22222;">;; </span><span style="color: #b22222;">M-; is the defualt</span>
(global-set-key (kbd <span style="color: #8b2252;">"C-c c"</span>) 'compile)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgac7d1689" class="outline-3">
<h3 id="orgac7d1689"><span class="section-number-3">9.2.</span> [gist.el] Gist インターフェイス</h3>
<div class="outline-text-3" id="text-orgac7d1689">
<ul class="org-ul">
<li><a href="https://github.com/defunkt/gist.el">defunkt/gist.el: Yet another Emacs paste mode, this one for Gist.</a></li>
</ul>

<p>
事前に <code>github.user</code> と <code>github.oauth-token</code> を設定します．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(autoload-if-found '(gist-mode) <span style="color: #8b2252;">"gist"</span> nil t)
</pre>
</div>
</div>
</div>

<div id="outline-container-org7baba8dd" class="outline-3">
<h3 id="org7baba8dd"><span class="section-number-3">9.3.</span> [doxymacs.el] Doxygen のコメントを簡単に入力する</h3>
<div class="outline-text-3" id="text-org7baba8dd">
<ul class="org-ul">
<li><a href="http://doxymacs.sourceforge.net/">http://doxymacs.sourceforge.net/</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(doxymacs-mode)
                         <span style="color: #8b2252;">"doxymacs"</span> nil t)
  (add-hook 'c-mode-common-hook #'doxymacs-mode)
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"doxymacs"</span>
    (<span style="color: #a020f0;">setq</span> doxymacs-doxygen-style <span style="color: #8b2252;">"JavaDoc"</span>)
    (add-hook 'font-lock-mode-hook
              (<span style="color: #a020f0;">lambda</span> ()
                  (<span style="color: #a020f0;">when</span> (memq major-mode '(c-mode c++-mode))
                    (doxymacs-font-lock))))
    (define-key doxymacs-mode-map (kbd <span style="color: #8b2252;">"C-c C-s"</span>) 'ff-find-other-file)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org0e27778c" class="outline-3">
<h3 id="org0e27778c"><span class="section-number-3">9.4.</span> [matlab.el] Matlab用の設定</h3>
<div class="outline-text-3" id="text-org0e27778c">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">late-init.el</span>
(<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">and</span> (memq window-system '(mac ns))
           (&gt; emacs-major-version 23))
  (<span style="color: #a020f0;">when</span> (autoload-if-found '(matlab-mode matlab-shell)
                           <span style="color: #8b2252;">"matlab"</span> nil t)
    (<span style="color: #a020f0;">push</span> '(<span style="color: #8b2252;">"\\.m$"</span> . matlab-mode) auto-mode-alist)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org966da7c1" class="outline-3">
<h3 id="org966da7c1"><span class="section-number-3">9.5.</span> [flycheck.el] 構文エラー表示</h3>
<div class="outline-text-3" id="text-org966da7c1">
<ul class="org-ul">
<li>auto-complete より前に hook設定しておくと余計なエラーが出ないようです．</li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">(eval-when-compile</span>
<span style="color: #b22222;">;;   </span><span style="color: #b22222;">(message "Loading dash...")</span>
<span style="color: #b22222;">;;   </span><span style="color: #b22222;">(require 'dash))</span>

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">counsel-flycheck-action</span> (obj <span style="color: #228b22;">&amp;rest</span> _)
  (-when-let* ((err (get-text-property 0 'tabulated-list-id obj))
               (pos (flycheck-error-pos err)) )
    (goto-char (flycheck-error-pos err))))

(<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">counsel-flycheck-history</span> nil <span style="color: #8b2252;">"History for `</span><span style="color: #008b8b;">counsel-flycheck</span><span style="color: #8b2252;">'"</span>)

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">counsel-flycheck</span> ()
  (<span style="color: #a020f0;">interactive</span>)
  (<span style="color: #a020f0;">if</span> (not (<span style="color: #a020f0;">bound-and-true-p</span> flycheck-mode))
      (message <span style="color: #8b2252;">"Flycheck mode is not available or enabled"</span>)
    (ivy-read <span style="color: #8b2252;">"Error: "</span>
              (<span style="color: #a020f0;">let</span> ((source-buffer (current-buffer)))
                (<span style="color: #a020f0;">with-current-buffer</span>
                    (<span style="color: #a020f0;">or</span> (get-buffer flycheck-error-list-buffer)
                        (<span style="color: #a020f0;">progn</span>
                          (<span style="color: #a020f0;">with-current-buffer</span>
                              (get-buffer-create flycheck-error-list-buffer)
                            (flycheck-error-list-mode)
                            (current-buffer))))
                  (flycheck-error-list-set-source source-buffer)
                  (flycheck-error-list-reset-filter)
                  (revert-buffer t t t)
                  (split-string (buffer-string) <span style="color: #8b2252;">"\n"</span> t <span style="color: #8b2252;">" *"</span>)))
              <span style="color: #483d8b;">:action</span> 'counsel-flycheck-action <span style="color: #b22222;">;; </span><span style="color: #b22222;">(lambda (s &amp;rest _))</span>
              <span style="color: #483d8b;">:history</span> 'counsel-flycheck-history
              <span style="color: #483d8b;">:caller</span> 'counsel-flycheck)))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(flycheck-mode)
                         <span style="color: #8b2252;">"flycheck"</span> nil t)
  (<span style="color: #a020f0;">dolist</span> (hook
           '(go-mode-hook
             js2-mode-hook
             c-mode-common-hook
             perl-mode-hook
             python-mode-hook))
    (add-hook hook #'flycheck-mode))

  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"flycheck"</span>
    (<span style="color: #a020f0;">setq</span> flycheck-gcc-language-standard <span style="color: #8b2252;">"c++14"</span>)
    (<span style="color: #a020f0;">setq</span> flycheck-clang-language-standard <span style="color: #8b2252;">"c++14"</span>)
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">TODO: really needed?</span>
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">(when (require 'flycheck-clang-tidy nil t)</span>
    <span style="color: #b22222;">;;   </span><span style="color: #b22222;">(add-hook 'flycheck-mode-hook #'flycheck-clang-tidy-setup))</span>
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">http://qiita.com/senda-akiha/items/cddb02cfdbc0c8c7bc2b</span>
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">(when (require 'flycheck-pos-tip nil t)</span>
    <span style="color: #b22222;">;;   </span><span style="color: #b22222;">'(custom-set-variables</span>
    <span style="color: #b22222;">;;     </span><span style="color: #b22222;">'(flycheck-display-errors-function</span>
    <span style="color: #b22222;">;;       </span><span style="color: #b22222;">#'flycheck-pos-tip-error-messages)))</span>
    ))

<span style="color: #b22222;">;; </span><span style="color: #b22222;">(flycheck-add-next-checker 'javascript-jshint</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">'javascript-gjslint)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org2bf4fb77" class="outline-3">
<h3 id="org2bf4fb77"><span class="section-number-3">9.6.</span> [origami.el] 関数の折りたたみ</h3>
<div class="outline-text-3" id="text-org2bf4fb77">
<ul class="org-ul">
<li><code>hideshowvis.el</code> よりも軽い印象なので，現在は <code>origami.el</code> を使用中．</li>
<li><a href="https://github.com/gregsexton/origami.el">gregsexton/origami.el: A folding minor mode for Emacs</a></li>
<li><a href="https://github.com/zenozeng/yafolding.el">zenozeng/yafolding.el: Yet another folding extension for Emacs</a></li>
<li><a href="https://github.com/tj64/outline-magic/blob/master/outline-magic.el">outline-magic/outline-magic.el at master · tj64/outline-magic</a></li>
<li>後発として <a href="https://github.com/tarsius/bicycle">bicycle.el</a> があります．</li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(origami-mode origami-toggle-node)
                         <span style="color: #8b2252;">"origami"</span> nil t)
  (<span style="color: #a020f0;">dolist</span> (hook '(emacs-lisp-mode-hook c-mode-common-hook yatex-mode-hook))
    (add-hook hook #'origami-mode))

  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"origami"</span>
    (define-key origami-mode-map (kbd <span style="color: #8b2252;">"C-t"</span>) #'origami-toggle-node)
    (define-key origami-mode-map (kbd <span style="color: #8b2252;">"C-u C-t"</span>)
      #'origami-toggle-all-nodes)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org291c6055" class="outline-3">
<h3 id="org291c6055"><span class="section-number-3">9.7.</span> [auto-complete-clang.el] オムニ補完</h3>
<div class="outline-text-3" id="text-org291c6055">
<p>
C++バッファでメソッドを補完対象とする．try-catch を使っている場合， <code>-fcxx-exceptions</code> オプションが必要で，これはプリコンパイルヘッダを生成する時も同じだ．ここ示す設定では， <code>~/.emacs.d/</code> 以下に <code>stdafx.pch</code> を生成する必要があり，以下のコマンドを用いてプリコンパイルヘッダを生成する．ヘッダファイルのパスを適切に与えれば，Boostや自作のライブラリも補完対象に設定できる．
</p>

<p>
現状では，補完直後にデフォルトの引数がすべて書き込まれてしまう．なんかうまいことしたいものだ．
</p>

<div class="org-src-container">
<pre class="src src-sh">clang -cc1 -x c++-header -fcxx-exceptions -std=c++11 -stdlib=libc++ -emit-pch ~/.emacs.d/stdafx.h -o ~/.emacs.d/stdafx.pch -I/opt/local/include -I/opt/local/include/netpbm -I/Users/taka/devel/icp/lib
</pre>
</div>

<p>
以下の設定は，先に <code>auto-complete.el</code> に関する設定を読み込んでいることを前提としている． <code>ac-clang-flags</code> の値は， <code>stdafx.pch</code> の作成で使用したパラメータと合わせないとエラーが生じる可能性があります．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(auto-complete ac-cc-mode-setup)
                         <span style="color: #8b2252;">"auto-complete"</span> nil t)
  (add-hook 'c-mode-common-hook #'ac-cc-mode-setup)
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"auto-complete"</span>
    (<span style="color: #a020f0;">if</span> (not (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">auto-complete-clang</span> nil t))
        (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">ac-cc-mode-setup</span> ()
          (<span style="color: #ff0000; font-weight: bold;">warn</span> <span style="color: #8b2252;">"auto-complete-clang is NOT installed"</span>))
      (<span style="color: #a020f0;">setq</span> ac-clang-executable (executable-find <span style="color: #8b2252;">"clang"</span>))
      <span style="color: #b22222;">;; </span><span style="color: #b22222;">ac-cc-mode-setup &#12398;&#12458;&#12540;&#12496;&#12540;&#12521;&#12452;&#12489;</span>
      <span style="color: #b22222;">;; </span><span style="color: #b22222;">"-w" "-ferror-limit" "1"</span>
      (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">ac-cc-mode-setup</span> ()
        (<span style="color: #a020f0;">setq</span> ac-clang-auto-save t)
        (<span style="color: #a020f0;">setq</span> ac-clang-prefix-header <span style="color: #8b2252;">"~/.emacs.d/stdafx.pch"</span>)
        (<span style="color: #a020f0;">setq</span> ac-clang-flags '(<span style="color: #8b2252;">"-x"</span> <span style="color: #8b2252;">"c++-header"</span> <span style="color: #8b2252;">"-fcxx-exceptions"</span>
                               <span style="color: #8b2252;">"-std=c++14"</span> <span style="color: #8b2252;">"-stdlib=libc++"</span>
                               <span style="color: #8b2252;">"-I/opt/local/include"</span>
                               <span style="color: #8b2252;">"-I/opt/local/include/netpbm"</span>
                               <span style="color: #8b2252;">"-I/Users/taka/devel/icp/lib"</span>))
        (<span style="color: #a020f0;">setq</span> ac-sources '(ac-source-clang
                           ac-source-yasnippet
                           ac-source-gtags))))))
</pre>
</div>

<p>
次のコードを hoge.cpp として保存し， <code>v</code> と <code>t</code> について補完できれば， <code>STL</code> と <code>Boost</code> のプリコンパイルヘッダが有効になっていることを確認できる．
</p>

<blockquote>
<p>
#include &lt;iostream&gt;
#include &lt;vector&gt;
#include &lt;boost/timer.hpp&gt;
</p>

<p>
int main(){
  std::vector&lt;int&gt; v;
  v; // ここ
  boost::timer t;
  cout &lt;&lt; t; // ここ
  return 1;
}
</p>
</blockquote>
</div>

<div id="outline-container-org3d08c27d" class="outline-4">
<h4 id="org3d08c27d"><span class="section-number-4">9.7.1.</span> References</h4>
<div class="outline-text-4" id="text-org3d08c27d">
<ul class="org-ul">
<li><a href="http://d.hatena.ne.jp/kenbell1988/20120428/1335609313">http://d.hatena.ne.jp/kenbell1988/20120428/1335609313</a></li>
<li><a href="http://d.hatena.ne.jp/whitypig/20110306/1299416655">http://d.hatena.ne.jp/whitypig/20110306/1299416655</a></li>
<li><a href="http://d.hatena.ne.jp/yano-htn/?of=30">http://d.hatena.ne.jp/yano-htn/?of=30</a></li>
<li><a href="http://www.nomtats.com/2010/11/auto-completeelemacs.html">http://www.nomtats.com/2010/11/auto-completeelemacs.html</a></li>
<li><a href="http://www.plugmasters.com.br/plugfeed/post/73768/awesome-cc-autocompletion-in-emacs">http://www.plugmasters.com.br/plugfeed/post/73768/awesome-cc-autocompletion-in-emacs</a></li>
</ul>
</div>
</div>
</div>

<div id="outline-container-orgabd9abb3" class="outline-3">
<h3 id="orgabd9abb3"><span class="section-number-3">9.8.</span> [quickrun.el] お手軽ビルド</h3>
<div class="outline-text-3" id="text-orgabd9abb3">
<p>
カレントバッファで編集中のソースコードをビルド・実行して，別バッファに結果を得ます．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(quickrun)
                         <span style="color: #8b2252;">"quickrun"</span> nil t)
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"go-mode"</span>
    (define-key go-mode-map (kbd <span style="color: #8b2252;">"&lt;f5&gt;"</span>) 'quickrun))
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"c++-mode"</span>
    (define-key c++-mode-map (kbd <span style="color: #8b2252;">"&lt;f5&gt;"</span>) 'quickrun))
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"python-mode"</span>
    (define-key python-mode-map (kbd <span style="color: #8b2252;">"&lt;f5&gt;"</span>) 'quickrun))
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"perl-mode"</span>
    (define-key perl-mode-map (kbd <span style="color: #8b2252;">"&lt;f5&gt;"</span>) 'quickrun))
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"gnuplot-mode"</span>
    (define-key gnuplot-mode-map (kbd <span style="color: #8b2252;">"&lt;f5&gt;"</span>) 'quickrun)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org034bbf9f" class="outline-3">
<h3 id="org034bbf9f"><span class="section-number-3">9.9.</span> [ggtags.el] タグジャンプ</h3>
<div class="outline-text-3" id="text-org034bbf9f">
<ul class="org-ul">
<li><a href="http://tasuwo.github.io/blog/2016/03/04/c-c-plus-plus/">EmacsにおけるC,C++の環境を整える - tasuwo blog</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(ggtags-mode)
                         <span style="color: #8b2252;">"ggtags"</span> nil t)
  (<span style="color: #a020f0;">dolist</span> (hook (list 'c-mode-common-hook 'python-mode-hook))
    (add-hook hook (<span style="color: #a020f0;">lambda</span> () (ggtags-mode 1))))

  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"ggtags"</span>
    (<span style="color: #a020f0;">unless</span> (executable-find <span style="color: #8b2252;">"gtags"</span>)
      (message <span style="color: #8b2252;">"--- global is NOT installed in this system."</span>))

    <span style="color: #b22222;">;; </span><span style="color: #b22222;">(setq ggtags-completing-read-function t) ;; nil for helm</span>
    (define-key ggtags-mode-map (kbd <span style="color: #8b2252;">"M-]"</span>) nil)))

(<span style="color: #a020f0;">when</span> (autoload-if-found '(counsel-gtags-mode)
                         <span style="color: #8b2252;">"counsel-gtags"</span> nil t)
  (<span style="color: #a020f0;">dolist</span> (hook '(c-mode-hook c++-mode-hook))
    (add-hook hook 'counsel-gtags-mode))
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"counsel-gtags"</span>
    (custom-set-variables
     '(counsel-gtags-update-interval-second 10))))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(helm-gtags-mode)
                         <span style="color: #8b2252;">"helm-gtags"</span> nil t)
    (add-hook 'c-mode-common-hook #'helm-gtags-mode)
    (add-hook 'python-mode-hook #'helm-gtags-mode)
    (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"helm-gtags"</span>
      (custom-set-variables
       '(helm-gtags-mode-name <span style="color: #8b2252;">""</span>))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org216e9539" class="outline-3">
<h3 id="org216e9539"><span class="section-number-3">9.10.</span> [0xc.el] N進数変換</h3>
<div class="outline-text-3" id="text-org216e9539">
<ul class="org-ul">
<li>実施頻度の高い16進数と10進数の相互変換に重宝します．</li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-decimal-to-hex</span> ()
  (<span style="color: #a020f0;">interactive</span>)
  (0xc-convert 16 (word-at-point)))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-hex-to-decimal</span> ()
  (<span style="color: #a020f0;">interactive</span>)
  (0xc-convert 10 (word-at-point)))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(0xc-convert
                           0xc-convert-point
                           my-decimal-to-hex my-hex-to-decimal)
       <span style="color: #8b2252;">"0xc"</span> nil t)
  (global-set-key (kbd <span style="color: #8b2252;">"C-c f h"</span>) '0xc-convert))
</pre>
</div>
</div>
</div>

<div id="outline-container-orge830f6b0" class="outline-3">
<h3 id="orge830f6b0"><span class="section-number-3">9.11.</span> [hexl.el] バイナリファイルを開く</h3>
<div class="outline-text-3" id="text-orge830f6b0">
<p>
ビルトインの <code>hexl-mode</code> を使います．
</p>

<ul class="org-ul">
<li><a href="https://ayatakesi.github.io/emacs/24.5/Editing-Binary-Files.html">GNU Emacs Manual(Japanese Translation): Editing Binary Files</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(add-hook 'hexl-mode-hook 'view-mode)
(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"hexl"</span>
  (custom-set-variables
   '(hexl-bits 8)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org9ffc2142" class="outline-3">
<h3 id="org9ffc2142"><span class="section-number-3">9.12.</span> [uuid.el] UUID の生成</h3>
<div class="outline-text-3" id="text-org9ffc2142">
<ul class="org-ul">
<li><a href="https://github.com/nicferrier/emacs-uuid">nicferrier/emacs-uuid: The UUID module from the EmacsWiki, initially by someone called James Mastros.</a></li>
</ul>

<p>
新しい <code>UUID</code> を生成してカーソル位置に書き出すように <code>my-uuid-string</code> を定義しています．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-uuid-string</span> ()
  (<span style="color: #a020f0;">interactive</span>)
  (insert (uuid-string)))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(autoload-if-found '(uuid-string my-uuid-string) <span style="color: #8b2252;">"uuid"</span> nil t)
</pre>
</div>
</div>
</div>

<div id="outline-container-orga1d9863f" class="outline-3">
<h3 id="orga1d9863f"><span class="section-number-3">9.13.</span> [package-lint.el] MEPLA登録用Lint</h3>
<div class="outline-text-3" id="text-orga1d9863f">
<p>
MELPAへの登録を目指す emacslisp パッケージの実装で，所定の書式で記述されているかを確認できます． <code>docstring</code> のチェックは， <code>M-x checkdoc</code> でできます．
</p>

<ul class="org-ul">
<li><a href="https://github.com/purcell/package-lint">https://github.com/purcell/package-lint</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(autoload-if-found '(package-lint-current-buffer) <span style="color: #8b2252;">"package-lint"</span> nil t)
</pre>
</div>
</div>
</div>

<div id="outline-container-org7d18b489" class="outline-3">
<h3 id="org7d18b489"><span class="section-number-3">9.14.</span> [projectile.el] ディレクトリ単位でファイル群をプロジェクト扱いする</h3>
<div class="outline-text-3" id="text-org7d18b489">
<ul class="org-ul">
<li>プロジェクト内に限定して検索をかける時に重宝する．</li>
<li>カレントバッファがプロジェクト内のファイルの場合は，タイトルバーにプロジェクト名を出すように設定しています．</li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-projectile-activate</span> ()
  (<span style="color: #a020f0;">interactive</span>)
  (<span style="color: #a020f0;">setq</span> projectile-keymap-prefix (kbd <span style="color: #8b2252;">"C-c p"</span>))
  (projectile-mode 1)
  (remove-hook 'find-file-hook #'my-projectile-activate))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">ad:neotree-dir</span> (path)
  <span style="color: #8b2252;">"Extension to change the frame width automatically."</span>
  (<span style="color: #a020f0;">interactive</span> <span style="color: #8b2252;">"DDirectory: "</span>)
  (<span style="color: #a020f0;">unless</span> (neo-global--window-exists-p)
    (neotree-show))
  (neo-global--open-dir path)
  (neo-global--select-window))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">ad:projectile-visit-project-tags-table</span> ()
  <span style="color: #8b2252;">"Extensions to skip calling `</span><span style="color: #008b8b;">visit-tags-table</span><span style="color: #8b2252;">'."</span>
  nil)

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-counsel-projectile-ag</span> ()
  <span style="color: #8b2252;">"Use `</span><span style="color: #008b8b;">counsel-projectile-ag</span><span style="color: #8b2252;">' in a projectile project except when `</span><span style="color: #008b8b;">dired</span><span style="color: #8b2252;">'.</span>
<span style="color: #8b2252;">Otherwise, use `</span><span style="color: #008b8b;">counsel-ag</span><span style="color: #8b2252;">'."</span>
  (<span style="color: #a020f0;">interactive</span>)
  (<span style="color: #a020f0;">if</span> (<span style="color: #a020f0;">or</span> (<span style="color: #a020f0;">and</span> (eq projectile-require-project-root 'prompt)
               (not (projectile-project-p)))
          (eq major-mode 'dired-mode))
      (counsel-ag)
    (counsel-projectile-ag)))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(projectile-mode)
                         <span style="color: #8b2252;">"projectile"</span> nil t)
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"neotree"</span>
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">(advice-add 'neotree-dir :override #'ad:neotree-dir) ;; FIXME</span>
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">M-x helm-projectile-switch-project (C-c p p)</span>
    (<span style="color: #a020f0;">setq</span> projectile-switch-project-action 'neotree-projectile-action))

  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"projectile"</span>
    (advice-add 'projectile-visit-project-tags-table <span style="color: #483d8b;">:override</span>
                #'ad:projectile-visit-project-tags-table)

    (<span style="color: #a020f0;">setq</span> projectile-mode-line-lighter <span style="color: #8b2252;">""</span>)
    (<span style="color: #a020f0;">setq</span> projectile-dynamic-mode-line nil)
    (<span style="color: #a020f0;">setq</span> projectile-tags-command <span style="color: #8b2252;">"gtags"</span>)
    (<span style="color: #a020f0;">setq</span> projectile-tags-backend 'ggtags)
    (<span style="color: #a020f0;">setq</span> projectile-tags-file-name <span style="color: #8b2252;">"GTAGS"</span>)

    (<span style="color: #a020f0;">setq</span> projectile-use-git-grep t)
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">(setq projectile-mode-line</span>
    <span style="color: #b22222;">;;       </span><span style="color: #b22222;">'(:eval (format " P:%s" (projectile-project-name))))</span>
    (<span style="color: #a020f0;">setq</span> projectile-mode-line <span style="color: #8b2252;">""</span>)

    (<span style="color: #a020f0;">setq</span> icon-title-format
          (<span style="color: #a020f0;">setq</span> frame-title-format
                '((<span style="color: #483d8b;">:eval</span>
                   (<span style="color: #a020f0;">let</span> ((project-name (projectile-project-name)))
                     (<span style="color: #a020f0;">unless</span> (string= <span style="color: #8b2252;">"-"</span> project-name)
                       (format <span style="color: #8b2252;">"(%s) - "</span> project-name))))
                  <span style="color: #8b2252;">"%b"</span>)))

    <span style="color: #b22222;">;; </span><span style="color: #b22222;">counsel-projectile</span>
    (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">counsel-projectile</span> nil t)
      (add-to-list 'counsel-projectile-switch-project-action
                   '(<span style="color: #8b2252;">"z"</span> my-counsel-fzf-in-default-dir
                     <span style="color: #8b2252;">"switch to fzf"</span>) <span style="color: #ff0000; font-weight: bold;">t)</span>
      (add-to-list 'counsel-projectile-find-file-action
                   '(<span style="color: #8b2252;">"z"</span> my-counsel-fzf-in-default-dir
                     <span style="color: #8b2252;">"switch to fzf"</span>) <span style="color: #ff0000; font-weight: bold;">t)</span>

      (<span style="color: #a020f0;">setq</span> projectile-completion-system 'ivy)
      (<span style="color: #a020f0;">setq</span> counsel-projectile-sort-files t) <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#24403;&#35442;&#12503;&#12525;&#12472;&#12455;&#12463;&#12488;&#20869;&#12522;&#12473;&#12488;&#12434;&#12477;&#12540;&#12488;</span>
      (<span style="color: #a020f0;">setq</span> counsel-projectile-sort-projects t) <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#12503;&#12525;&#12472;&#12455;&#12463;&#12488;&#12522;&#12473;&#12488;&#12434;&#12477;&#12540;&#12488;</span>
      (define-key projectile-mode-map (kbd <span style="color: #8b2252;">"C-c p"</span>) 'projectile-command-map)
      (define-key projectile-mode-map (kbd <span style="color: #8b2252;">"C-M-f"</span>) 'my-counsel-projectile-ag)
      (counsel-projectile-mode 1)))

  (<span style="color: #a020f0;">unless</span> noninteractive
    (add-hook 'find-file-hook #'my-projectile-activate)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org1c672519" class="outline-3">
<h3 id="org1c672519"><span class="section-number-3">9.15.</span> [relint.el] elispの正規表現用のlinter</h3>
<div class="outline-text-3" id="text-org1c672519">
<p>
正規表現をチェックしてくれます．
</p>

<ul class="org-ul">
<li><a href="https://github.com/mattiase/relint">mattiase/relint: Elisp regexp lint tool</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(autoload-if-found '(relint-current-buffer) <span style="color: #8b2252;">"relint"</span> nil t)
</pre>
</div>
</div>
</div>

<div id="outline-container-org7d969237" class="outline-3">
<h3 id="org7d969237"><span class="section-number-3">9.16.</span> [magit.el] Gitクライアント</h3>
<div class="outline-text-3" id="text-org7d969237">
<p>
Emacs の中で Git リポジトリを操作できます． <code>magit-repository-directories</code> を設定しておけば，管理しているリポジトリの一覧を表示できます． <code>helm</code> や <code>ivy</code> と連携していれば，絞り込みも簡単です．さらに， <code>M-x magit-list-repositories</code> を実行すれば，各リポジトリのステータス全体を一覧表示できます．ただし，調査対象のリポジトリ数が多ければ，一覧表示に時間がかかります．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">ad:magit-mode-bury-buffer</span> (<span style="color: #228b22;">&amp;optional</span> _bury)
  (<span style="color: #a020f0;">when</span> (fboundp 'dimmer-on)
    (<span style="color: #a020f0;">setq</span> my-dimmer-mode t)
    (dimmer-on)
    (redraw-frame)))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(magit-status ad:magit-mode-bury-buffer)
                         <span style="color: #8b2252;">"magit"</span> nil t)
  (global-set-key (kbd <span style="color: #8b2252;">"C-c m"</span>) 'magit-status)
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"magit"</span>
    (<span style="color: #a020f0;">when</span> (fboundp 'dimmer-off)
      (add-hook 'magit-status-mode-hook 'dimmer-off))
    (<span style="color: #a020f0;">when</span> (fboundp 'magit-mode-bury-buffer)
      (advice-add 'magit-mode-bury-buffer <span style="color: #483d8b;">:before</span> #'ad:magit-mode-bury-buffer))
    (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">and</span> (boundp 'magit-completing-read-function)
               (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">ivy</span> nil t))
      <span style="color: #b22222;">;; </span><span style="color: #b22222;">ivy &#12434;&#20351;&#12358;</span>
      (<span style="color: #a020f0;">setq</span> magit-completing-read-function 'ivy-completing-read))
    (<span style="color: #a020f0;">when</span> (boundp 'magit-repository-directories)
      (<span style="color: #a020f0;">setq</span> magit-repository-directories
            '((<span style="color: #8b2252;">"~/devel/git"</span> . 1)
              (<span style="color: #8b2252;">"~/devel/mygit"</span> . 1))))))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgaa25b74c" class="outline-3">
<h3 id="orgaa25b74c"><span class="section-number-3">9.17.</span> <span class="todo TODO">TODO</span> [EditorConfig] コードスタイルの強制</h3>
<div class="outline-text-3" id="text-orgaa25b74c">
<ul class="org-ul">
<li><a href="http://editorconfig.org/#contributing">EditorConfig</a></li>
<li><a href="https://github.com/editorconfig/editorconfig-emacs#readme">editorconfig/editorconfig-emacs: EditorConfig plugin for emacs</a></li>
<li><a href="https://github.com/10sr/editorconfig-charset-extras-el">10sr/editorconfig-charset-extras-el: Extra EditorConfig Charset Support</a></li>
</ul>


<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-editorconfig-activate</span> ()
  (<span style="color: #a020f0;">if</span> (<span style="color: #a020f0;">and</span> (executable-find <span style="color: #8b2252;">"editorconfig"</span>)
           (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">editorconfig</span> nil t)
           (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">editorconfig-core</span> nil t)  )
      (editorconfig-mode 1)
    (message <span style="color: #8b2252;">"Editorconfig is not installed."</span>))
  (remove-hook 'find-file-hook #'my-editorconfig-activate))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(add-hook 'find-file-hook #'my-editorconfig-activate)
</pre>
</div>

<p>
例えば，次のようなファイルを共有プロジェクトに保存しておきます． <code>.editorconfig</code> として配置します．
</p>

<div class="org-src-container">
<pre class="src src-conf"><span style="color: #a0522d;">root</span> = true

[<span style="color: #228b22;">*</span>]
<span style="color: #a0522d;">charset</span> = utf-8
<span style="color: #a0522d;">end_of_line</span> = lf
<span style="color: #a0522d;">insert_final_newline</span> = true
<span style="color: #a0522d;">indent_style</span> = space
<span style="color: #a0522d;">indent_size</span> = 2
<span style="color: #a0522d;">trim_trailing_whitespace</span> = true
</pre>
</div>
</div>
</div>

<div id="outline-container-orgae4ecac7" class="outline-3">
<h3 id="orgae4ecac7"><span class="section-number-3">9.18.</span> <span class="todo TODO">TODO</span> [cov] カバレッジの状態をフリンジで確認</h3>
<div class="outline-text-3" id="text-orgae4ecac7">
<p>
<code>gcov</code> の結果をフリンジに表示します．
</p>

<ul class="org-ul">
<li><a href="https://github.com/adamniederer/cov">https://github.com/adamniederer/cov</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(autoload-if-found '(cov-mode) <span style="color: #8b2252;">"cov"</span> nil t)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbf790f4d" class="outline-3">
<h3 id="orgbf790f4d"><span class="section-number-3">9.19.</span> <span class="todo TODO">TODO</span> [format-all.el] コード整形</h3>
<div class="outline-text-3" id="text-orgbf790f4d">
<ul class="org-ul">
<li><a href="https://melpa.org/#/format-all">format-all - MELPA</a></li>
</ul>

<p>
様々なプログラミング言語に対して，共通のコード整形のトリガー（ <code>M-x format-all-buffer</code> ）を提供します．整形するために使うフォーマッタは，原則的に言語ごとに異なる外部ツールを呼び出すので，必要に応じてそれらのツールを別途インストールします．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(autoload-if-found '(format-all-mode) <span style="color: #8b2252;">"format-all"</span> nil t)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgac7d24d7" class="outline-3">
<h3 id="orgac7d24d7"><span class="section-number-3">9.20.</span> <span class="todo TODO">TODO</span> [emr.el] リファクタリング</h3>
<div class="outline-text-3" id="text-orgac7d24d7">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"postpone"</span>
  (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">emr</span> nil t)
    (define-key prog-mode-map (kbd <span style="color: #8b2252;">"M-RET"</span>) 'emr-show-refactor-menu)
    (emr-initialize)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org4e23f079" class="outline-3">
<h3 id="org4e23f079"><span class="section-number-3">9.21.</span> <span class="todo TODO">TODO</span> [rmsbolt.el] アセンブリをバッファにリアルタイム表示</h3>
<div class="outline-text-3" id="text-org4e23f079">
<ul class="org-ul">
<li><a href="https://gitlab.com/jgkamat/rmsbolt">https://gitlab.com/jgkamat/rmsbolt</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">late-init.el</span>
(autoload-if-found '(rmsbolt-mode) <span style="color: #8b2252;">"rmsbolt"</span> nil t)
</pre>
</div>
</div>
</div>

<div id="outline-container-org9547f772" class="outline-3">
<h3 id="org9547f772"><span class="section-number-3">9.22.</span> <span class="todo TODO">TODO</span> [semantic-refactor.el] リファクタリングツール</h3>
<div class="outline-text-3" id="text-org9547f772">
<ul class="org-ul">
<li><a href="https://github.com/tuhdo/semantic-refactor">tuhdo/semantic-refactor: Semantic Refactor is a refactoring tool based on Semantic parser framework</a></li>
</ul>
</div>
</div>
<div id="outline-container-orgea32afad" class="outline-3">
<h3 id="orgea32afad"><span class="section-number-3">9.23.</span> <span class="todo TODO">TODO</span> [company.el] 続・自動補完機能</h3>
<div class="outline-text-3" id="text-orgea32afad">
<p>
<code>auto-complete.el</code> がメンテナンスモードに入ったので <code>company</code> に移行しました．
</p>

<p>
<code>company-org-block</code> は，<a href="http://xenodium.com/emacs-org-block-company-completion/">http://xenodium.com/emacs-org-block-company-completion/</a> で公開されている情報でしたが，パッケージ化されて，<a href="https://melpa.org/#/company-org-block">MELPA</a>から入手できるようになりました．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-company-activate</span> ()
  (remove-hook 'emacs-lisp-mode-hook #'my-company-activate)
  (remove-hook 'org-mode-hook #'my-company-activate)
  (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">company</span> nil t))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">ad:company-idle-begin</span> (f buf win tick pos)
  (<span style="color: #a020f0;">unless</span> (<span style="color: #a020f0;">and</span> (boundp 'ns-put-text-p) ns-put-text-p)
    (funcall f buf win tick pos)))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">ad:company-pseudo-tooltip--ujofwd-on-timer</span> (f command)
  (<span style="color: #a020f0;">unless</span> (<span style="color: #a020f0;">and</span> (boundp 'ns-put-text-p) ns-put-text-p)
    (funcall f command)))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(add-hook 'emacs-lisp-mode-hook #'my-company-activate)
(add-hook 'org-mode-hook #'my-company-activate)

(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"company"</span>
  (define-key company-active-map (kbd <span style="color: #8b2252;">"C-n"</span>) 'company-select-next)
  (define-key company-active-map (kbd <span style="color: #8b2252;">"C-p"</span>) 'company-select-previous)
  (define-key company-active-map (kbd <span style="color: #8b2252;">"&lt;tab&gt;"</span>) 'company-complete-selection)
  (define-key company-search-map (kbd <span style="color: #8b2252;">"C-n"</span>) 'company-select-next)
  (define-key company-search-map (kbd <span style="color: #8b2252;">"C-p"</span>) 'company-select-previous)
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">To complete file path, move `</span><span style="color: #008b8b;">company-files</span><span style="color: #b22222;">' to the fist item of the list</span>
  (delq 'company-files company-backends)

  (add-to-list 'company-backends 'company-files)
  (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">company-org-block</span> nil t)
    (<span style="color: #a020f0;">setq</span> company-org-block-edit-style 'inline) <span style="color: #b22222;">;; </span><span style="color: #b22222;">'auto, 'prompt, or 'inline</span>
    (<span style="color: #a020f0;">setq</span> company-org-block-auto-indent nil)
    (add-to-list 'company-backends 'company-org-block))

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#35036;&#23436;&#20505;&#35036;&#12395;&#30058;&#21495;&#12434;&#34920;&#31034;</span>
  (<span style="color: #a020f0;">setq</span> company-show-numbers t)
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#35036;&#23436;&#20505;&#35036;&#12434;&#20986;&#12377;&#12414;&#12391;&#12398;&#29494;&#20104;</span>
  (<span style="color: #a020f0;">setq</span> company-idle-delay 0.8)
  (<span style="color: #a020f0;">setq</span> company-tooltip-idle-delay 0.8)
  (global-company-mode)
  (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">company-quickhelp</span> nil t)
    (company-quickhelp-mode))

  (advice-add 'company-idle-begin <span style="color: #483d8b;">:around</span> #'ad:company-idle-begin)
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">(advice-add 'company-pseudo-tooltip--ujofwd-on-timer :around</span>
  <span style="color: #b22222;">;;             </span><span style="color: #b22222;">#'ad:company-pseudo-tooltip--ujofwd-on-timer)</span>

  (<span style="color: #a020f0;">when</span> (boundp 'mac-ime-before-put-text-hook)
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#35036;&#23436;&#20505;&#35036;&#12364;&#34920;&#31034;&#12373;&#12428;&#12383;&#12479;&#12452;&#12511;&#12531;&#12464;&#12391;&#20837;&#21147;&#12434;&#32154;&#12369;&#12383;&#12425;&#65292;&#35036;&#23436;&#20505;&#35036;&#12434;&#28040;&#12377;&#65294;</span>
    (add-hook 'mac-ime-before-put-text-hook #'company-cancel)))
</pre>
</div>
</div>
</div>
<div id="outline-container-orgdd272f8c" class="outline-3">
<h3 id="orgdd272f8c"><span class="section-number-3">9.24.</span> <span class="todo TODO">TODO</span> [vterm.el] vterm を使う</h3>
<div class="outline-text-3" id="text-orgdd272f8c">
<p>
<code>vterm</code> を使うとバッファをターミナルとして使えます．通常では <code>C-n/C-p</code> でコマンド履歴を辿ってしまうので，実行結果などをコピーして別バッファに貼り付けたい場合は， <code>vterm-copy-mode</code> (C-c C-t) を使えばよいです．
</p>

<p>
macOS の場合は brew で libvterm をインストールすれば， <code>vterm</code> を使えます．
</p>

<ul class="org-ul">
<li><a href="https://github.com/akermu/emacs-libvterm">https://github.com/akermu/emacs-libvterm</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(autoload-if-found '(vterm) <span style="color: #8b2252;">"vterm"</span>  nil t)
</pre>
</div>
</div>
</div>
<div id="outline-container-org09687b9c" class="outline-3">
<h3 id="org09687b9c"><span class="section-number-3">9.25.</span> <span class="done DONE">DONE</span> [auto-complete.el] 自動補完機能&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></h3>
<div class="outline-text-3" id="text-org09687b9c">
<p>
<a href="http://cx4a.org/software/auto-complete/manual.ja.html">http://cx4a.org/software/auto-complete/manual.ja.html</a>
</p>

<ul class="org-ul">
<li>辞書データを使う（ <code>ac-dictionary-directories</code> ）</li>
<li>auto-complete.el, auto-complete-config.el, fuzzy.el, popup.el を使う．</li>
<li><a href="http://cx4a.org/software/auto-complete/manual.ja.html">日本語マニュアル</a></li>
<li>ac-auto-start を 4 にしておけば，3文字までは TAB を yasnippet に渡せる．</li>
</ul>

<p>
Org-mode ユーザにとって <code>TAB</code> は非常に重要なコマンド．そこに <code>auto-complete</code> と <code>yasnippet</code> が <code>TAB</code> を奪いに来るので，住み分けが重要になる．=ac-auto-start= を=4=にすると，&lt;s=TAB= によるソースブロックの短縮入力を <code>yasnippet</code> で実行できる（この目的だけならば=3=を指定してもいい）．&lt;sys などと4文字入力すると，=auto-complete= が動いて &lt;system&gt; などを補完してくれる．もちろん，見出しで <code>TAB</code> を押すときには，ツリーの表示／非表示の切り替えになる．
</p>

<p>
情報源については，<a href="http://cx4a.org/software/auto-complete/manual.ja.html#.E6.A8.99.E6.BA.96.E6.83.85.E5.A0.B1.E6.BA.90">オンラインマニュアル</a>を参照のこと．
</p>

<p>
auto-complete が正しく効いているかは，バッファ内で適当にパスを打ち込んで，補完候補が表示されるかで判定判定できると思います（ <code>/home</code> を入力とか）
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(ac-default-setup ac-org-mode-setup)
                         <span style="color: #8b2252;">"auto-complete"</span> nil t)
  (<span style="color: #a020f0;">dolist</span> (hook
           (list 'org-mode-hook 'python-mode-hook
                 'perl-mode-hook 'objc-mode-hook))
    (add-hook hook #'ac-default-setup))

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">*scratch* &#12496;&#12483;&#12501;&#12449;&#12391;&#12399;&#28961;&#21177;&#21270;</span>
  (add-hook 'lisp-mode-hook
            (<span style="color: #a020f0;">lambda</span> () (<span style="color: #a020f0;">unless</span> (equal <span style="color: #8b2252;">"*scratch*"</span> (buffer-name))
                         (ac-default-setup))))
  (add-hook 'org-mode-hook #'ac-org-mode-setup)

  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"auto-complete"</span>
    (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">auto-complete-config</span> nil t)
    (ac-config-default)
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#36861;&#21152;&#12398;&#12513;&#12472;&#12515;&#12540;&#12514;&#12540;&#12489;&#12434;&#35373;&#23450;</span>
    (add-to-list 'ac-modes 'objc-mode)
    (add-to-list 'ac-modes 'org-mode)
    (add-to-list 'ac-modes 'latex-mode)
    (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">ac-math</span> nil t)

    <span style="color: #b22222;">;; </span><span style="color: #b22222;">ac-modes &#12395;&#12354;&#12427;&#12513;&#12472;&#12515;&#12540;&#12514;&#12540;&#12489;&#12391;&#26377;&#21177;&#12395;&#12377;&#12427;</span>
    <span style="color: #b22222;">;;</span><span style="color: #b22222;">lisp, c, c++, java, perl, cperl, python, makefile, sh, fortran, f90</span>
    (global-auto-complete-mode t)
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#36766;&#26360;</span>
    (add-to-list 'ac-dictionary-directories <span style="color: #8b2252;">"~/.emacs.d/ac-dict"</span>)
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">history</span>
    (<span style="color: #a020f0;">setq</span> ac-comphist-file <span style="color: #8b2252;">"~/Dropbox/config/ac-comphist.dat"</span>)
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">n&#25991;&#23383;&#20197;&#19978;&#12391;&#35036;&#23436;&#34920;&#31034;&#12377;&#12427;&#65288;"&lt;s TAB" &#12398;&#22580;&#21512; yasnippet &#12364;&#21628;&#12400;&#12428;&#12427;&#65289;</span>
    (<span style="color: #a020f0;">setq</span> ac-auto-start 4)
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">n&#31186;&#24460;&#12395;&#12513;&#12491;&#12517;&#12540;&#12434;&#34920;&#31034;</span>
    (<span style="color: #a020f0;">setq</span> ac-auto-show-menu 2.0)
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#12484;&#12540;&#12523;&#12481;&#12483;&#12503;&#12398;&#34920;&#31034;</span>
    (<span style="color: #a020f0;">setq</span> ac-use-quick-help t)
    (<span style="color: #a020f0;">setq</span> ac-quick-help-delay 2.0)
    (<span style="color: #a020f0;">setq</span> ac-quick-help-height 10)
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">C-n/C-p &#12391;&#12513;&#12491;&#12517;&#12540;&#12434;&#12383;&#12393;&#12427;</span>
    (<span style="color: #a020f0;">setq</span> ac-use-menu-map t)
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">TAB &#12391;&#35036;&#23436;&#65288;org-mode &#12391;&#12418;&#21177;&#12367;&#12424;&#12358;&#12395;&#12377;&#12427;&#65289;</span>
    (define-key ac-completing-map [tab] 'ac-complete)
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">RET &#12391;&#12398;&#35036;&#23436;&#12434;&#31105;&#27490;</span>
    (define-key ac-completing-map <span style="color: #8b2252;">"\r"</span> nil)
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#35036;&#23436;&#12513;&#12491;&#12517;&#12540;&#12398;&#34920;&#31034;&#31934;&#24230;&#12434;&#39640;&#12417;&#12427;</span>
    (<span style="color: #a020f0;">setq</span> popup-use-optimized-column-computation nil)
    <span style="color: #b22222;">;;</span><span style="color: #b22222;">(setq ac-candidate-max 10)</span>

    (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">ac-org-mode-setup</span> ()
      <span style="color: #b22222;">;;            </span><span style="color: #b22222;">(message " &gt;&gt; ac-org-mode-setup")</span>
      (<span style="color: #a020f0;">setq</span> ac-sources '(
                         ac-source-abbrev <span style="color: #b22222;">; </span><span style="color: #b22222;">Emacs &#12398;&#30053;&#35486;</span>
                         <span style="color: #b22222;">;; </span><span style="color: #b22222;">ac-source-css-property ; heavy</span>
                         ac-source-dictionary <span style="color: #b22222;">; </span><span style="color: #b22222;">&#36766;&#26360;</span>
                         ac-source-features
                         ac-source-filename
                         ac-source-files-in-current-dir
                         ac-source-functions
                         <span style="color: #b22222;">;; </span><span style="color: #b22222;">ac-source-gtags</span>
                         <span style="color: #b22222;">;; </span><span style="color: #b22222;">ac-source-imenu</span>
                         <span style="color: #b22222;">;; </span><span style="color: #b22222;">ac-source-semantic</span>
                         ac-source-symbols
                         ac-source-variables
                         <span style="color: #b22222;">;; </span><span style="color: #b22222;">ac-source-yasnippet</span>
                         )))

    (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">ac-default-setup</span> ()
      <span style="color: #b22222;">;;            </span><span style="color: #b22222;">(message " &gt;&gt; ac-default-setup")</span>
      <span style="color: #b22222;">;; </span><span style="color: #b22222;">ac-source-words-in-same-mode-buffers</span>
      (<span style="color: #a020f0;">setq</span> ac-sources '(ac-source-filename
                         ac-source-abbrev
                         ac-source-dictionary
                         )))))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgcde881ad" class="outline-3">
<h3 id="orgcde881ad"><span class="section-number-3">9.26.</span> <span class="done DONE">DONE</span> [hideshowvis.el] 関数の表示／非表示&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></h3>
<div class="outline-text-3" id="text-orgcde881ad">
<ul class="org-ul">
<li><a href="http://www.emacswiki.org/emacs/hideshowvis.el">http://www.emacswiki.org/emacs/hideshowvis.el</a></li>
<li>org.el（約2万行）を開くために約2分必要なため，最近は使っていません．</li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">and</span> (memq window-system '(mac ns))
           (&gt; emacs-major-version 23))
  (<span style="color: #a020f0;">when</span> (autoload-if-found '(hideshowvis-enable hideshowvis-minor-mode)
                           <span style="color: #8b2252;">"hideshowvis"</span> nil t)
    (<span style="color: #a020f0;">dolist</span> (hook (list 'perl-mode-hook 'c-mode-common-hook))
      (add-hook hook #'hideshowvis-enable))

    (add-hook 'emacs-lisp-mode-hook
              (<span style="color: #a020f0;">lambda</span> () (<span style="color: #a020f0;">unless</span> (equal <span style="color: #8b2252;">"*scratch*"</span> (buffer-name))
                             (hideshowvis-enable))))

    (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"hideshowvis"</span>
      (define-key hideshowvis-mode-map (kbd <span style="color: #8b2252;">"C-("</span>) 'hs-hide-block)
      (define-key hideshowvis-mode-map (kbd <span style="color: #8b2252;">"C-)"</span>) 'hs-show-block))))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org47616d05" class="outline-2">
<h2 id="org47616d05"><span class="section-number-2">10.</span> Org Mode</h2>
<div class="outline-text-2" id="text-org47616d05">
</div>
<div id="outline-container-orgf66bb6fe" class="outline-3">
<h3 id="orgf66bb6fe"><span class="section-number-3">10.1.</span> 基本設定</h3>
<div class="outline-text-3" id="text-orgf66bb6fe">
<p>
Org Mode は巨大なパッケージなので，設定項目が必然的に増えます．一度に全部を設定しようとせず，必須機能と見た目の設定から入り，興味があり使いたい機能の設定へと徐々に拡張するのが近道です．
</p>

<p>
<code>C-M-o</code> は，本来， <code>split-line</code> にアサインされています．
</p>

<p>
<code>init-org.el</code> として書き出し，遅延読み込みしています．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-org-modules-activate</span> ()
  (<span style="color: #a020f0;">if</span> (<span style="color: #a020f0;">and</span> (<span style="color: #a020f0;">featurep</span> '<span style="color: #008b8b;">org-tempo</span>)
           (<span style="color: #a020f0;">featurep</span> '<span style="color: #008b8b;">org-id</span>))
      (message <span style="color: #8b2252;">"org-modules are previously loaded."</span>)
    (message <span style="color: #8b2252;">"Loading org-modules..."</span>)
    (<span style="color: #a020f0;">setq</span> org-modules my-org-modules) <span style="color: #b22222;">;; </span><span style="color: #b22222;">revert to the original value</span>
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#12514;&#12472;&#12517;&#12540;&#12523;&#12398;&#36861;&#21152;</span>
    (add-to-list 'org-modules 'org-id)
    (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"org-agenda"</span>
      <span style="color: #b22222;">;; </span><span style="color: #b22222;">org-agenda &#12434;&#35501;&#12435;&#12391;&#12375;&#12414;&#12358;&#12398;&#12391; org-mode &#38283;&#22987;&#26178;&#12395;&#12399;&#35501;&#12415;&#36796;&#12414;&#12379;&#12394;&#12356;</span>
      (add-to-list 'org-modules 'org-habit)) <span style="color: #b22222;">;; </span><span style="color: #b22222;">require org and org-agenda</span>
    (<span style="color: #a020f0;">when</span> (version&lt; <span style="color: #8b2252;">"9.1.4"</span> (org-version))
      (add-to-list 'org-modules 'org-tempo))
    (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">ol-bookmark</span> nil t)
      <span style="color: #b22222;">;; </span><span style="color: #b22222;">[[bookmark:hoge][hogehoge]] &#24418;&#24335;&#12398;&#12522;&#12531;&#12463;&#12434;&#26377;&#21177;&#21270;</span>
      (add-to-list 'org-modules 'ol-bookmark)
      (<span style="color: #a020f0;">setq</span> bookmark-save-flag 4) <span style="color: #b22222;">;; </span><span style="color: #b22222;">N&#22238; bookmark &#12434;&#25805;&#20316;&#12375;&#12383;&#12425;&#20445;&#23384;</span>
      <span style="color: #b22222;">;; </span><span style="color: #b22222;">`</span><span style="color: #008b8b;">bookmark-default-file</span><span style="color: #b22222;">' &#12398;&#35501;&#12415;&#36796;&#12415;</span>
      (bookmark-maybe-load-default-file))

    <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#19981;&#24517;&#35201;&#12394;&#12514;&#12472;&#12517;&#12540;&#12523;&#12398;&#35501;&#12415;&#36796;&#12415;&#12434;&#20572;&#27490;&#12377;&#12427;</span>
    (delq 'ol-bbdb org-modules)
    (delq 'ol-irc org-modules)
    (delq 'ol-mhe org-modules)
    (delq 'ol-docview org-modules)
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">Reload</span>
    (org-load-modules-maybe t)
    (org-element-cache-reset 'all) <span style="color: #b22222;">;; </span><span style="color: #b22222;">FIXME use `</span><span style="color: #008b8b;">custom-set-variables</span><span style="color: #b22222;">'</span>
    (message <span style="color: #8b2252;">"Loading org-modules...done"</span>)))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-open-default-org-file</span> ()
  (<span style="color: #a020f0;">interactive</span>)
  (my-show-org-buffer <span style="color: #8b2252;">"next.org"</span>))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">&#12507;&#12540;&#12512;&#12509;&#12472;&#12471;&#12519;&#12531;&#30340;&#12394; Org&#12501;&#12449;&#12452;&#12523;&#12434;&#19968;&#30330;&#12391;&#38283;&#12365;&#12414;&#12377;&#65294;</span>
(global-set-key (kbd <span style="color: #8b2252;">"C-M-o"</span>) #'my-open-default-org-file)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">&#12486;&#12461;&#12473;&#12488;&#12501;&#12449;&#12452;&#12523;&#12434; Org Mode &#12391;&#38283;&#12365;&#12414;&#12377;&#65294;</span>
(<span style="color: #a020f0;">push</span> '(<span style="color: #8b2252;">"\\.txt$"</span> . org-mode) auto-mode-alist)

<span style="color: #b22222;">;; </span><span style="color: #b22222;">Font lock &#12434;&#20351;&#12358;</span>
(add-hook 'org-mode-hook #'turn-on-font-lock)

(global-set-key (kbd <span style="color: #8b2252;">"C-c r"</span>) 'org-capture)
(global-set-key (kbd <span style="color: #8b2252;">"C-c l"</span>) 'org-store-link)
(global-set-key (kbd <span style="color: #8b2252;">"C-c a"</span>) 'org-agenda)

(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"org"</span>
  (<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">my-org-modules</span> org-modules) <span style="color: #b22222;">;; </span><span style="color: #b22222;">Tricky!!</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">(setq org-modules-loaded t) ;; not a good way</span>
  (<span style="color: #a020f0;">setq</span> org-modules nil)
  (<span style="color: #a020f0;">unless</span> noninteractive
    (run-with-idle-timer (+ 8 my-default-loading-delay)
                         nil #'my-org-modules-activate)) <span style="color: #b22222;">;; </span><span style="color: #b22222;">will take 350[ms]</span>

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#12479;&#12452;&#12488;&#12523;&#12434;&#23569;&#12375;&#24375;&#35519;</span>
  (custom-set-faces
   '(org-document-title ((t (<span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"RoyalBlue1"</span> <span style="color: #483d8b;">:bold</span> t <span style="color: #483d8b;">:height</span> 1.2))))
   '(org-document-info ((t (<span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"DodgerBlue1"</span> <span style="color: #483d8b;">:height</span> 1.0)))))

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#38306;&#36899;&#12514;&#12472;&#12517;&#12540;&#12523;&#12398;&#35501;&#12415;&#36796;&#12415;</span>
  (autoload 'org-eldoc-load <span style="color: #8b2252;">"org-eldoc"</span> nil t)
  (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-org-eldoc-load</span> ()
    <span style="color: #8b2252;">"Set up org-eldoc documentation function."</span>
    (<span style="color: #a020f0;">interactive</span>)
    (<span style="color: #a020f0;">add-function</span> <span style="color: #483d8b;">:before-until</span> (local 'eldoc-documentation-function)
                  #'org-eldoc-documentation-function))
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#23569;&#12394;&#12367;&#12392;&#12418; org 9.5 &#12391;&#12399;&#21839;&#38988;&#12364;&#30330;&#29983;&#12375;&#12394;&#12367;&#12394;&#12387;&#12383;&#12398;&#12391;&#65292;advice &#20572;&#27490;&#65294;</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">(advice-add 'org-eldoc-load :override #'my-org-eldoc-load)</span>
  (add-hook 'org-mode-hook #'org-eldoc-load)

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">org &#12501;&#12449;&#12452;&#12523;&#12398;&#38598;&#20013;&#31649;&#29702;</span>
  (<span style="color: #a020f0;">setq</span> org-directory (concat (getenv <span style="color: #8b2252;">"SYNCROOT"</span>) <span style="color: #8b2252;">"/org/"</span>))

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">org-store-link &#12391; heading &#12395;&#33258;&#21205;&#30340;&#12395;&#25407;&#20837;&#12373;&#12428;&#12427; id &#12434;&#20351;&#12358;</span>
  (<span style="color: #a020f0;">setq</span> org-id-link-to-org-use-id t)

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#12450;&#12540;&#12459;&#12452;&#12502;&#12501;&#12449;&#12452;&#12523;&#12398;&#21517;&#31216;&#12434;&#25351;&#23450;</span>
  (<span style="color: #a020f0;">setq</span> org-archive-location <span style="color: #8b2252;">"%s_archive::"</span>)

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#12479;&#12452;&#12512;&#12473;&#12479;&#12531;&#12503;&#12395;&#12424;&#12427;&#12525;&#12464;&#21454;&#38598;&#35373;&#23450; DONE &#26178;&#12395; CLOSED: &#12434;&#35352;&#20837;&#65294;</span>
  (<span style="color: #a020f0;">setq</span> org-log-done 'time) <span style="color: #b22222;">; </span><span style="color: #b22222;">'time &#20197;&#22806;&#12395;&#65292;'(done), '(state) &#12434;&#25351;&#23450;&#12391;&#12365;&#12427;</span>

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#12525;&#12464;&#12434;&#12489;&#12525;&#12450;&#12540;&#12395;&#20837;&#12428;&#12427;</span>
  (<span style="color: #a020f0;">setq</span> org-log-into-drawer t)

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">indent &#12434; electric-indent-mode &#12398;&#25391;&#12427;&#33310;&#12356;&#12395;&#21512;&#12431;&#12379;&#12427;</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">(setq org-adapt-indentation t) ;; t &#12398;&#22580;&#21512;&#65292;&#12489;&#12525;&#12450;&#12364;&#12452;&#12531;&#12487;&#12531;&#12488;&#12373;&#12428;&#12427;&#65294;</span>

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">Set checksum program path for windows</span>
  (<span style="color: #a020f0;">when</span> (eq window-system 'w32)
    (<span style="color: #a020f0;">setq</span> org-mobile-checksum-binary (concat (getenv <span style="color: #8b2252;">"SYNCROOT"</span>) <span style="color: #8b2252;">"/do/cksum.exe"</span>)))

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">Set default table export format</span>
  (<span style="color: #a020f0;">setq</span> org-table-export-default-format <span style="color: #8b2252;">"orgtbl-to-csv"</span>)

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">Toggle inline images display at startup</span>
  (<span style="color: #a020f0;">setq</span> org-startup-with-inline-images t)

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">dvipng</span>
  (<span style="color: #a020f0;">setq</span> org-export-with-LaTeX-fragments t)

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#25968;&#24335;&#12434;&#12495;&#12452;&#12521;&#12452;&#12488;</span>
  (<span style="color: #a020f0;">setq</span> org-highlight-latex-and-related '(latex entities))

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">org&#12496;&#12483;&#12501;&#12449;&#20869;&#12398;&#20840;&#12390;&#12398;&#21205;&#30340;&#12502;&#12525;&#12483;&#12463;&#12434;&#20445;&#23384;&#30452;&#21069;&#12395;&#22793;&#26356;&#12377;&#12427;</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">(add-hook 'before-save-hook #'org-update-all-dblocks)</span>

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#12450;&#12531;&#12480;&#12540;&#12473;&#12467;&#12450;&#12434;&#12456;&#12463;&#12473;&#12509;&#12540;&#12488;&#12375;&#12394;&#12356;&#65288;_{}&#12391;&#26126;&#31034;&#30340;&#12395;&#34920;&#29694;&#12391;&#12365;&#12427;&#65289;</span>
  (<span style="color: #a020f0;">setq</span> org-export-with-sub-superscripts nil)

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">#+options: \n:t &#12392;&#21516;&#12376;</span>
  (<span style="color: #a020f0;">setq</span> org-export-preserve-breaks t)

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#12479;&#12452;&#12510;&#12540;&#12398;&#38899;</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">(lsetq org-clock-sound "");</span>

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">org-clock &#12398;&#35336;&#28204;&#26178;&#38291;&#12434;&#12514;&#12540;&#12489;&#12521;&#12452;&#12531;&#12391;&#12399;&#12394;&#12367;&#12479;&#12452;&#12488;&#12523;&#12395;&#34920;&#31034;&#12377;&#12427;</span>
  (<span style="color: #a020f0;">setq</span> org-clock-clocked-in-display 'frame-title)

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">1&#20998;&#26410;&#28288;&#12399;&#35352;&#37682;&#12375;&#12394;&#12356;</span>
  (<span style="color: #a020f0;">setq</span> org-clock-out-remove-zero-time-clocks t)

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#20877;&#36215;&#21205;&#24460;&#12395; clock &#12434;&#24489;&#24112;&#12373;&#12379;&#12427;&#65288;clock-out &#12391;&#25244;&#12369;&#12394;&#12356;&#38480;&#12426;&#32066;&#20102;&#20013;&#12398;&#26399;&#38291;&#12418;&#35336;&#19978;&#12373;&#12428;&#12390;&#12375;&#12414;&#12358;&#65289;</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">check also org-clock-persist in org-clock.el</span>
  (org-clock-persistence-insinuate)

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">org-clock-out &#26178;&#12395;&#12473;&#12486;&#12540;&#12479;&#12473;&#12434;&#22793;&#12360;&#12427;&#65288;also configure org-todo-keywords&#65289;</span>
  (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-promote-todo-revision</span> (state)
    (<span style="color: #a020f0;">cond</span> ((member state '(<span style="color: #8b2252;">"TODO"</span>)) <span style="color: #8b2252;">"REV1"</span>)
          ((member state '(<span style="color: #8b2252;">"REV1"</span>)) <span style="color: #8b2252;">"REV2"</span>)
          ((member state '(<span style="color: #8b2252;">"REV2"</span>)) <span style="color: #8b2252;">"REV3"</span>)
          (t state)))
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">(setq org-clock-out-switch-to-state #'my-promote-todo-revision)</span>

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">undo &#26178;&#12395; reveal &#12375;&#12390;&#34920;&#31034;&#12434;&#25913;&#21892;&#12377;&#12427;</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">(defun ad:org:undo (&amp;optional _ARG)</span>
  <span style="color: #b22222;">;;   </span><span style="color: #b22222;">(when (and (eq major-mode 'org-mode)</span>
  <span style="color: #b22222;">;;              </span><span style="color: #b22222;">(not (org-before-first-heading-p)))</span>
  <span style="color: #b22222;">;;     </span><span style="color: #b22222;">(org-overview)</span>
  <span style="color: #b22222;">;;     </span><span style="color: #b22222;">(org-reveal)</span>
  <span style="color: #b22222;">;;     </span><span style="color: #b22222;">(org-cycle-hide-drawers 'all)</span>
  <span style="color: #b22222;">;;     </span><span style="color: #b22222;">(org-show-entry)</span>
  <span style="color: #b22222;">;;     </span><span style="color: #b22222;">(show-children)</span>
  <span style="color: #b22222;">;;     </span><span style="color: #b22222;">(org-show-siblings)))</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">(advice-add 'undo :after #'ad:org:undo)</span>

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#38750;&#34920;&#31034;&#29366;&#24907;&#12398;&#38936;&#22495;&#12408;&#12398;&#26360;&#12365;&#36796;&#12415;&#12434;&#38450;&#12368;</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">"Editing in invisible areas is prohibited, make them visible first"</span>
  (<span style="color: #a020f0;">setq</span> org-catch-invisible-edits 'show-and-error)
  (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">ad:org-return</span> (f <span style="color: #228b22;">&amp;optional</span> arg)
    <span style="color: #8b2252;">"An extension for checking invisible editing when you hit the enter."</span>
    (<span style="color: #a020f0;">interactive</span> <span style="color: #8b2252;">"P"</span>)
    (org-check-before-invisible-edit 'insert)
    (apply f arg))
  (advice-add 'org-return <span style="color: #483d8b;">:around</span> #'ad:org-return)

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#12502;&#12522;&#12483;&#12484;&#12395;&#12450;&#12523;&#12501;&#12449;&#12505;&#12483;&#12488;&#12434;&#20351;&#12358;</span>
  (<span style="color: #a020f0;">setq</span> org-list-allow-alphabetical t)

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">- &#12434;&#20778;&#20808;&#65294;&#35242;&#12398;&#12502;&#12522;&#12483;&#12484;&#34920;&#31034;&#12434;&#32153;&#25215;&#12373;&#12379;&#12394;&#12356;</span>
  (<span style="color: #a020f0;">setq</span> org-list-demote-modify-bullet
        '((<span style="color: #8b2252;">"+"</span> . <span style="color: #8b2252;">"-"</span>)
          (<span style="color: #8b2252;">"*"</span> . <span style="color: #8b2252;">"-"</span>)
          (<span style="color: #8b2252;">"1."</span> . <span style="color: #8b2252;">"-"</span>)
          (<span style="color: #8b2252;">"1)"</span> . <span style="color: #8b2252;">"-"</span>)
          (<span style="color: #8b2252;">"A)"</span> . <span style="color: #8b2252;">"-"</span>)
          (<span style="color: #8b2252;">"B)"</span> . <span style="color: #8b2252;">"-"</span>)
          (<span style="color: #8b2252;">"a)"</span> . <span style="color: #8b2252;">"-"</span>)
          (<span style="color: #8b2252;">"b)"</span> . <span style="color: #8b2252;">"-"</span>)
          (<span style="color: #8b2252;">"A."</span> . <span style="color: #8b2252;">"-"</span>)
          (<span style="color: #8b2252;">"B."</span> . <span style="color: #8b2252;">"-"</span>)
          (<span style="color: #8b2252;">"a."</span> . <span style="color: #8b2252;">"-"</span>)
          (<span style="color: #8b2252;">"b."</span> . <span style="color: #8b2252;">"-"</span>)))

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#23436;&#20102;&#12375;&#12383;&#12479;&#12473;&#12463;&#12398;&#37197;&#33394;&#12434;&#22793;&#12360;&#12427;</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">https://fuco1.github.io/2017-05-25-Fontify-done-checkbox-items-in-org-mode.html</span>
  (font-lock-add-keywords
   'org-mode
   `((<span style="color: #8b2252;">"^[ \t]*</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">(?:</span><span style="color: #8b2252;">[-+*]</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">|</span><span style="color: #8b2252;">[0-9]+[).]</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">)</span><span style="color: #8b2252;">[ \t]+</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">(</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">(?:</span><span style="color: #8b2252;">\\[@</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">(?:</span><span style="color: #8b2252;">start:</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">)</span><span style="color: #8b2252;">?[0-9]+\\][ \t]*</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">)</span><span style="color: #8b2252;">?\\[</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">(?:</span><span style="color: #8b2252;">X</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">|</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">(</span><span style="color: #8b2252;">[0-9]+</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">)</span><span style="color: #8b2252;">/\\2</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">)</span><span style="color: #8b2252;">\\][</span><span style="color: #8b2252;">^</span><span style="color: #8b2252;">\n]*\n</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">)</span><span style="color: #8b2252;">"</span>
      1 'org-headline-done prepend))
   'append)

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#12503;&#12525;&#12497;&#12486;&#12451;&#31561;&#12434;&#33258;&#21205;&#30340;&#38281;&#12376;&#12427;&#65294;</span>
  (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-org-hide-drawers</span> ()
    <span style="color: #8b2252;">"Hide all drawers in an org tree."</span>
    (<span style="color: #a020f0;">interactive</span>)
    (<span style="color: #a020f0;">save-excursion</span>
      (beginning-of-line)
      (<span style="color: #a020f0;">unless</span> (looking-at-p org-drawer-regexp)
        (org-cycle-hide-drawers 'subtree))))
  (add-hook 'org-tab-first-hook 'my-org-hide-drawers)

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">CSV&#25351;&#23450;&#12391;&#12486;&#12540;&#12502;&#12523;&#12434;&#20986;&#21147;&#12377;&#12427;&#65294;</span>
  (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-org-table-export</span> ()
    (<span style="color: #a020f0;">interactive</span>)
    (org-table-export nil <span style="color: #8b2252;">"orgtbl-to-csv"</span>))

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#12377;&#12409;&#12390;&#12398;&#12481;&#12455;&#12483;&#12463;&#12508;&#12483;&#12463;&#12473;&#12398; cookies &#12434;&#26356;&#26032;&#12377;&#12427;</span>
  (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-do-org-update-staistics-cookies</span> ()
    (<span style="color: #a020f0;">interactive</span>)
    (message <span style="color: #8b2252;">"Update statistics..."</span>)
    (org-update-statistics-cookies 'all)
    (<span style="color: #a020f0;">let</span> ((inhibit-message t)
          (message-log-max nil))
      (save-buffer))
    (message <span style="color: #8b2252;">"Update statistics...done"</span>))

  (define-key org-mode-map (kbd <span style="color: #8b2252;">"C-c f 2"</span>) 'my-do-org-update-staistics-cookies)

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">C-c &amp; &#12364; yasnippet &#12395;&#12458;&#12540;&#12496;&#12540;&#12521;&#12452;&#12489;&#12373;&#12428;&#12390;&#12356;&#12427;&#12398;&#12434;&#24373;&#12426;&#26367;&#12360;&#12427;</span>
  (define-key org-mode-map (kbd <span style="color: #8b2252;">"C-c 4"</span>) 'org-mark-ring-goto)

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">(org-transpose-element) &#12364;&#21106;&#12426;&#24403;&#12390;&#12425;&#12428;&#12390;&#12356;&#12427;&#12398;&#12391;&#21462;&#12426;&#36820;&#12377;&#65294;</span>
  (org-defkey org-mode-map <span style="color: #8b2252;">"\C-\M-t"</span> 'beginning-of-buffer))

(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"ox"</span>
  (add-to-list 'org-modules 'ox-odt)
  (add-to-list 'org-modules 'ox-org)
  (add-to-list 'org-modules 'ox-json)) <span style="color: #b22222;">;; </span><span style="color: #b22222;">FIXME</span>

(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"org-tempo"</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#31354;&#34892;&#12398;&#12392;&#12365; "&lt;" &#12434;&#12452;&#12531;&#12487;&#12531;&#12488;&#12373;&#12379;&#12394;&#12356;</span>
  (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">ad:org-tempo-complete-tag</span> (f <span style="color: #228b22;">&amp;rest</span> arg)
    (<span style="color: #a020f0;">if</span> (<span style="color: #a020f0;">save-excursion</span>
          (beginning-of-line)
          (looking-at <span style="color: #8b2252;">"&lt;"</span>))
        (<span style="color: #a020f0;">let</span> ((indent-line-function 'ignore))
          (apply f arg))
      (apply f arg)))
  (advice-add 'org-tempo-complete-tag <span style="color: #483d8b;">:around</span> #'ad:org-tempo-complete-tag))
<span style="color: #b22222;">;; </span><span style="color: #b22222;">(Thanks to @conao3)</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">but when using `</span><span style="color: #008b8b;">flet</span><span style="color: #b22222;">', byte-compile will warn a malformed function</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">and using `</span><span style="color: #008b8b;">cl-flet</span><span style="color: #b22222;">' will not provide us the expected result...</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">(when (require 'cl-lib nil t)</span>
<span style="color: #b22222;">;;   </span><span style="color: #b22222;">(defun ad:org-tempo-complete-tag (f &amp;rest arg)</span>
<span style="color: #b22222;">;;     </span><span style="color: #b22222;">(if (save-excursion</span>
<span style="color: #b22222;">;;           </span><span style="color: #b22222;">(beginning-of-line)</span>
<span style="color: #b22222;">;;           </span><span style="color: #b22222;">(looking-at "&lt;"))</span>
<span style="color: #b22222;">;;         </span><span style="color: #b22222;">(cl-flet ((indent-according-to-mode () #'ignore))</span>
<span style="color: #b22222;">;;           </span><span style="color: #b22222;">(apply f arg))</span>
<span style="color: #b22222;">;;       </span><span style="color: #b22222;">(apply f arg)))</span>
<span style="color: #b22222;">;;   </span><span style="color: #b22222;">(advice-add 'org-tempo-complete-tag :around #'ad:org-tempo-complete-tag))</span>

(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"org-tempo"</span>
  (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-org-tempo-add-block</span> (entry)
    <span style="color: #8b2252;">"Add block entry from `</span><span style="color: #008b8b;">org-structure-template-alist</span><span style="color: #8b2252;">'."</span>
    (<span style="color: #a020f0;">let*</span> ((key (format <span style="color: #8b2252;">"&lt;%s"</span> (car entry)))
           (name (cdr entry))
           (special nil)) <span style="color: #b22222;">;; </span><span style="color: #b22222;">FIXED</span>
      (tempo-define-template
       (format <span style="color: #8b2252;">"org-%s"</span> (replace-regexp-in-string <span style="color: #8b2252;">" "</span> <span style="color: #8b2252;">"-"</span> name))
       `(,(format <span style="color: #8b2252;">"#+begin_%s%s"</span> name (<span style="color: #a020f0;">if</span> special <span style="color: #8b2252;">" "</span> <span style="color: #8b2252;">""</span>))
         ,(<span style="color: #a020f0;">when</span> special 'p) '&gt; n '&gt; ,(<span style="color: #a020f0;">unless</span> special 'p) n
         ,(format <span style="color: #8b2252;">"#+end_%s"</span> (car (split-string name <span style="color: #8b2252;">" "</span>)))
         &gt;)
       key
       (format <span style="color: #8b2252;">"Insert a %s block"</span> name)
       'org-tempo-tags)))
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#26356;&#26032;</span>
  (advice-add 'org-tempo-add-block <span style="color: #483d8b;">:override</span> #'my-org-tempo-add-block)
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#21453;&#26144;</span>
  (org-tempo-add-templates))

(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"org-clock"</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">nil or 'history &#12394;&#12425;&#12400;&#65292;org-onit &#12364; org-clock-out &#12434;&#23455;&#34892;&#12377;&#12427;&#65294;</span>
  (<span style="color: #a020f0;">setq</span> org-clock-persist 'history) <span style="color: #b22222;">;; </span><span style="color: #b22222;">{nil, t, 'clock, 'history}</span>
  (<span style="color: #a020f0;">setq</span> org-clock-in-resume t)
  (<span style="color: #a020f0;">setq</span> org-clock-persist-query-resume nil)

  (advice-add 'org-clock-load <span style="color: #483d8b;">:around</span> #'ad:suppress-message)

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#32066;&#20102;&#26178;&#12395; clock &#12434;&#27490;&#12417;&#12427;&#65294;</span>
  (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-org-clock-out-and-save-when-exit</span> ()
    <span style="color: #8b2252;">"Save buffers and stop clocking when kill emacs."</span>
    (<span style="color: #a020f0;">when</span> (org-clocking-p)
      (org-clock-out)
      (save-some-buffers t)))
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">implemented in `</span><span style="color: #008b8b;">org-onit.el</span><span style="color: #b22222;">'. No need to hook this.</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">(add-hook 'kill-emacs-hook #'my-org-clock-out-and-save-when-exit)</span>
  )

(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"org-table"</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#12456;&#12467;&#12540;&#34920;&#31034;&#21069;&#12395;&#20445;&#23384;&#12377;&#12427;</span>
  (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">ad:org-table-field-info</span> (_arg)
    (save-buffer))
  (advice-add 'org-table-field-info <span style="color: #483d8b;">:before</span> #'ad:org-table-field-info))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgebb1fbe4" class="outline-3">
<h3 id="orgebb1fbe4"><span class="section-number-3">10.2.</span> contribution を使う</h3>
<div class="outline-text-3" id="text-orgebb1fbe4">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">setq</span> load-path (append '(<span style="color: #8b2252;">"~/devel/git/org-mode/contrib/lisp"</span>) load-path))
</pre>
</div>
</div>
</div>

<div id="outline-container-org4da0cefd" class="outline-3">
<h3 id="org4da0cefd"><span class="section-number-3">10.3.</span> iCal との連携</h3>
<div class="outline-text-3" id="text-org4da0cefd">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">~/Dropbox/Public &#12399;&#31532;&#19977;&#32773;&#12395;&#25506;&#32034;&#12373;&#12428;&#12427;&#21487;&#33021;&#24615;&#12364;&#12354;&#12427;&#12398;&#12391;&#35201;&#27880;&#24847;</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">default = ~/org.ics</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">C-c C-e i org-export-icalendar-this-file</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">C-c C-e I org-export-icalendar-all-agenda-files</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">C-c C-e c org-export-icalendar-all-combine-agenda-files</span>
(<span style="color: #a020f0;">when</span> (autoload-if-found '(my-ox-icalendar
                           my-async-ox-icalendar my-ox-icalendar-cleanup)
                         <span style="color: #8b2252;">"ox-icalendar"</span> nil t)
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"org"</span>
    (define-key org-mode-map (kbd <span style="color: #8b2252;">"C-c f 1"</span>) 'my-ox-upload-icalendar))

  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"ox-icalendar"</span>
    (<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">org-ical-file-in-orz-server</span> nil) <span style="color: #b22222;">;; </span><span style="color: #b22222;">see private.el</span>

    <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#29983;&#25104;&#12377;&#12427;&#12459;&#12524;&#12531;&#12480;&#12540;&#12501;&#12449;&#12452;&#12523;&#12434;&#25351;&#23450;</span>
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#20197;&#19979;&#12398;&#35373;&#23450;&#12391;&#12399;&#65292;&#12371;&#12398;&#12501;&#12449;&#12452;&#12523;&#12434;&#19968;&#26178;&#12501;&#12449;&#12452;&#12523;&#12392;&#12375;&#12390;&#20351;&#12358;&#65288;&#21066;&#38500;&#12377;&#12427;&#65289;</span>
    (<span style="color: #a020f0;">setq</span> org-icalendar-combined-agenda-file <span style="color: #8b2252;">"~/Desktop/org-ical.ics"</span>)

    <span style="color: #b22222;">;; </span><span style="color: #b22222;">iCal &#12398;&#35500;&#26126;&#25991;</span>
    (<span style="color: #a020f0;">setq</span> org-icalendar-combined-description <span style="color: #8b2252;">"OrgMode&#12398;&#12473;&#12465;&#12472;&#12517;&#12540;&#12523;&#20986;&#21147;"</span>)

    <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#12459;&#12524;&#12531;&#12480;&#12540;&#12395;&#36969;&#20999;&#12394;&#12479;&#12452;&#12512;&#12478;&#12540;&#12531;&#12434;&#35373;&#23450;&#12377;&#12427;&#65288;google &#29992;&#12395;&#12399; nil &#12364;&#24517;&#35201;&#65289;</span>
    (<span style="color: #a020f0;">setq</span> org-icalendar-timezone <span style="color: #8b2252;">"Asia/Tokyo"</span>)

    <span style="color: #b22222;">;; </span><span style="color: #b22222;">DONE &#12395;&#12394;&#12387;&#12383; TODO &#12399;&#12450;&#12472;&#12455;&#12531;&#12480;&#12363;&#12425;&#38500;&#22806;&#12377;&#12427;</span>
    (<span style="color: #a020f0;">setq</span> org-icalendar-include-todo t)

    <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#36890;&#24120;&#12399;&#65292;&lt;&gt;--&lt;&gt; &#12391;&#21306;&#38291;&#20184;&#12365;&#20104;&#23450;&#12434;&#12388;&#12367;&#12427;&#65294;&#38750;&#25913;&#34892;&#20837;&#21147;&#12391;&#26085;&#20184;&#12364;Note&#12395;&#20837;&#12425;&#12394;&#12356;</span>
    (<span style="color: #a020f0;">setq</span> org-icalendar-use-scheduled '(event-if-todo))

    <span style="color: #b22222;">;; </span><span style="color: #b22222;">DL &#20184;&#12365;&#12391;&#32066;&#26085;&#20104;&#23450;&#12395;&#12377;&#12427;&#65306;&#32224;&#12417;&#20999;&#12426;&#26085;&#65288;&#12473;&#12479;&#12531;&#12503;&#12391;&#26178;&#38291;&#12434;&#25351;&#23450;&#12375;&#12394;&#12356;&#12371;&#12392;&#65289;</span>
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">(setq org-icalendar-use-deadline '(event-if-todo event-if-not-todo))</span>
    (<span style="color: #a020f0;">setq</span> org-icalendar-use-deadline '(event-if-todo))

    (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-ox-upload-icalendar</span> ()
      (<span style="color: #a020f0;">interactive</span>)
      (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">and</span> org-ical-file-in-orz-server
                 (eq system-type 'darwin))
        (<span style="color: #a020f0;">if</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">async</span> nil t)
            (my-async-ox-icalendar)
          (my-ox-icalendar))))

    (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-ox-icalendar</span> ()
      (<span style="color: #a020f0;">let</span> ((message-log-max nil)
            (org-agenda-files '(<span style="color: #8b2252;">"~/Dropbox/org/org-ical.org"</span>)))
        <span style="color: #b22222;">;; </span><span style="color: #b22222;">org-icalendar-export-to-ics &#12434;&#20351;&#12358;&#12392;&#12463;&#12522;&#12483;&#12503;&#12508;&#12540;&#12489;&#12364;&#33618;&#12428;&#12427;</span>
        (org-icalendar-combine-agenda-files))
      <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#33258;&#12469;&#12540;&#12496;&#12395;&#12450;&#12483;&#12503;&#12525;&#12540;&#12489;</span>
      (message <span style="color: #8b2252;">"Uploading..."</span>)
      (<span style="color: #a020f0;">if</span> (eq 0 (shell-command
                 (concat <span style="color: #8b2252;">"scp -o ConnectTimeout=5 "</span>
                         org-icalendar-combined-agenda-file <span style="color: #8b2252;">" "</span>
                         org-ical-file-in-orz-server)))
          (message <span style="color: #8b2252;">"Uploading...done"</span>)
        (message <span style="color: #8b2252;">"Uploading...miss!"</span>))
      (my-ox-icalendar-cleanup))

    (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-async-ox-icalendar</span> ()
      (message <span style="color: #8b2252;">"[async] Uploading..."</span>)
      (async-start
       `(<span style="color: #a020f0;">lambda</span> ()
          (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">and</span> (load <span style="color: #8b2252;">"~/.emacs"</span> nil t)
                     (load <span style="color: #8b2252;">"~/.emacs.d/lisp/init-org.el"</span> nil t)
                     (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">org</span> nil t)
                     (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">org-agenda</span> nil t))
            (<span style="color: #a020f0;">setq</span> org-agenda-files '(<span style="color: #8b2252;">"~/Dropbox/org/org-ical.org"</span>))
            (<span style="color: #a020f0;">if</span> (file-exists-p
                 (expand-file-name org-icalendar-combined-agenda-file))
                1
              (<span style="color: #a020f0;">let</span> ((ical (org-icalendar-combine-agenda-files))
                    (result (shell-command
                             (concat <span style="color: #8b2252;">"scp -o ConnectTimeout=5 "</span>
                                     ',org-icalendar-combined-agenda-file <span style="color: #8b2252;">" "</span>
                                     ',org-ical-file-in-orz-server))))
                (my-ox-icalendar-cleanup)
                result))))
       (<span style="color: #a020f0;">lambda</span> (result)
         (<span style="color: #a020f0;">unless</span> (active-minibuffer-window)
           (message (format <span style="color: #8b2252;">"[async] Uploading...%s"</span>
                            (<span style="color: #a020f0;">cond</span> ((eq result 0) <span style="color: #8b2252;">"done"</span>)
                                  ((eq result 1) <span style="color: #8b2252;">"skipped"</span>)
                                  (t <span style="color: #8b2252;">"miss!"</span>))))))))

    (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-ox-icalendar-cleanup</span> ()
      (<span style="color: #a020f0;">interactive</span>)
      (<span style="color: #a020f0;">when</span> (file-exists-p
             (expand-file-name org-icalendar-combined-agenda-file))
        (shell-command-to-string
         (concat <span style="color: #8b2252;">"rm -rf "</span> org-icalendar-combined-agenda-file))))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org739cd53d" class="outline-3">
<h3 id="org739cd53d"><span class="section-number-3">10.4.</span> スピードコマンド</h3>
<div class="outline-text-3" id="text-org739cd53d">
<p>
慣れてくると Org Mode の通常キーバインドでは満足できなくなります．コンテクストに応じて適切なキーバインドを設定するのが Emacs の醍醐味ですから，そういう欲求が出てきたらスピーコマンドの出番です．シングルキーで各ツリーのステータスを変更したり，任意のコマンドを呼び出せます．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"org"</span>
  (<span style="color: #a020f0;">setq</span> org-use-speed-commands t)

  (<span style="color: #a020f0;">when</span> (version&lt; (org-version) <span style="color: #8b2252;">"9.4.6"</span>)
    (<span style="color: #a020f0;">defvaralias</span> '<span style="color: #a0522d;">org-speed-commands</span> 'org-speed-commands-user))

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">"C"(org-shifttab) &#12434;&#12458;&#12540;&#12496;&#12540;&#12521;&#12452;&#12489;</span>
  (add-to-list 'org-speed-commands '(<span style="color: #8b2252;">"C"</span> org-copy-subtree))
  (add-to-list 'org-speed-commands '(<span style="color: #8b2252;">"d"</span> my-done-with-update-list))
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">(add-to-list 'org-speed-commands '("S" call-interactively 'widen))</span>
  (add-to-list 'org-speed-commands
               '(<span style="color: #8b2252;">"D"</span> my-org-todo-complete-no-repeat <span style="color: #8b2252;">"DONE"</span>))
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">(add-to-list 'org-speed-commands '("N" org-shiftmetadown))</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">(add-to-list 'org-speed-commands '("P" org-shiftmetaup))</span>
  (add-to-list 'org-speed-commands '(<span style="color: #8b2252;">"H"</span> my-hugo-export-upload))
  (add-to-list 'org-speed-commands '(<span style="color: #8b2252;">"."</span> my-org-deadline-today))
  (add-to-list 'org-speed-commands '(<span style="color: #8b2252;">"!"</span> my-org-default-property))
  (add-to-list 'org-speed-commands '(<span style="color: #8b2252;">"x"</span> my-org-move-subtree-to-the-last))
  (add-to-list 'org-speed-commands
               '(<span style="color: #8b2252;">"$"</span> call-interactively 'org-archive-subtree))

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">done &#12395;&#12375;&#12390;&#65292;appt&#12434;&#26356;&#26032;&#12377;&#12427;</span>
  (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-done-with-update-list</span> ()
    (<span style="color: #a020f0;">interactive</span>)
    (org-todo <span style="color: #8b2252;">"DONE"</span>)
    (my-org-agenda-to-appt))

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#21608;&#26399;&#12479;&#12463;&#12473;&#12434;&#32066;&#20102;&#12373;&#12379;&#12414;&#12377;&#65294;</span>
  (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-org-todo-complete-no-repeat</span> (<span style="color: #228b22;">&amp;optional</span> ARG)
    (<span style="color: #a020f0;">interactive</span> <span style="color: #8b2252;">"P"</span>)
    (<span style="color: #a020f0;">when</span> (org-get-repeat)
      (org-cancel-repeater))
    (org-todo ARG))

  (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-org-replace-punc-in-buffer</span> ()
    <span style="color: #8b2252;">"Replace \"&#65292;\" and \"&#65294;\" with \"&#12289;\" and \"&#12290;\" in a buffer."</span>
    (<span style="color: #a020f0;">interactive</span>)
    (goto-char (point-min))
    (<span style="color: #a020f0;">while</span> (re-search-forward <span style="color: #8b2252;">"</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">(</span><span style="color: #8b2252;">&#65292;</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">)</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">|</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">(</span><span style="color: #8b2252;">&#65294;</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">)</span><span style="color: #8b2252;">"</span> nil <span style="color: #483d8b;">:noerror</span>)
      (<span style="color: #a020f0;">let</span> ((w (match-string-no-properties 0)))
        (<span style="color: #a020f0;">cond</span> ((equal w <span style="color: #8b2252;">"&#65292;"</span>) (replace-match <span style="color: #8b2252;">"&#12289;"</span>))
              ((equal w <span style="color: #8b2252;">"&#65294;"</span>) (replace-match <span style="color: #8b2252;">"&#12290;"</span>))))))

  (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-org-replace-punc-in-tree</span> ()
    <span style="color: #8b2252;">"Replace \"&#65292;\" and \"&#65294;\" with \"&#12289;\" and \"&#12290;\" in an org tree."</span>
    (<span style="color: #a020f0;">interactive</span>)
    (org-back-to-heading t)
    (<span style="color: #a020f0;">let*</span> ((element (org-element-at-point))
           (begin (org-element-property <span style="color: #483d8b;">:begin</span> element))
           (end (org-element-property <span style="color: #483d8b;">:end</span> element)))
      (<span style="color: #a020f0;">when</span> (eq (org-element-type element) 'headline)
        (goto-char begin)
        (<span style="color: #a020f0;">while</span> (re-search-forward <span style="color: #8b2252;">"</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">(</span><span style="color: #8b2252;">&#65292;</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">)</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">|</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">(</span><span style="color: #8b2252;">&#65294;</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">)</span><span style="color: #8b2252;">"</span> end <span style="color: #483d8b;">:noerror</span>)
          (<span style="color: #a020f0;">let</span> ((w (match-string-no-properties 0)))
            (<span style="color: #a020f0;">cond</span> ((equal w <span style="color: #8b2252;">"&#65292;"</span>) (replace-match <span style="color: #8b2252;">"&#12289;"</span>))
                  ((equal w <span style="color: #8b2252;">"&#65294;"</span>) (replace-match <span style="color: #8b2252;">"&#12290;"</span>)))))
        (goto-char begin))))

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">Hugo &#12398;&#35352;&#20107;&#12434;&#26360;&#12365;&#20986;&#12375;&amp;&#12450;&#12483;&#12503;&#12525;&#12540;&#12489;</span>
  (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-hugo-export-upload</span> ()
    <span style="color: #8b2252;">"Export subtree for Hugo and upload the engty."</span>
    (<span style="color: #a020f0;">when</span> (member (buffer-name) '(<span style="color: #8b2252;">"imadenale.org"</span> <span style="color: #8b2252;">"archive.org"</span>))
      (<span style="color: #a020f0;">if</span> (not (org-entry-is-done-p))
          (message <span style="color: #8b2252;">"The state of the entry is not \"DONE\" yet."</span>)
        (my-org-replace-punc-in-tree)
        (save-buffer)
        <span style="color: #b22222;">;; </span><span style="color: #b22222;">(let ((outfile (org-hugo-export-wim-to-md)))</span>
        <span style="color: #b22222;">;;   </span><span style="color: #b22222;">(sit-for 2)</span>
        <span style="color: #b22222;">;;   </span><span style="color: #b22222;">(when (and outfile</span>
        <span style="color: #b22222;">;;              </span><span style="color: #b22222;">(file-exists-p outfile))</span>
        <span style="color: #b22222;">;;     </span><span style="color: #b22222;">(switch-to-buffer</span>
        <span style="color: #b22222;">;;      </span><span style="color: #b22222;">(find-file-noselect outfile)</span>
        <span style="color: #b22222;">;;      </span><span style="color: #b22222;">(my-org-replace-punc-in-buffer))))</span>
        (org-hugo-export-wim-to-md)
        (<span style="color: #a020f0;">let</span> ((command <span style="color: #8b2252;">"/Users/taka/Dropbox/scripts/push-hugo.sh"</span>)
              (filename (org-entry-get (point) <span style="color: #8b2252;">"EXPORT_FILE_NAME"</span>))
              (exported (format <span style="color: #8b2252;">"[ox-hugo] \"%s\" has been exported."</span>
                                (nth 4 (org-heading-components)))))
          (<span style="color: #a020f0;">when</span> filename
            <span style="color: #b22222;">;; </span><span style="color: #b22222;">(when (file-exists-p (concat outfile ".md"))</span>
            <span style="color: #b22222;">;;   </span><span style="color: #b22222;">(switch-to-buffer</span>
            <span style="color: #b22222;">;;    </span><span style="color: #b22222;">(find-file-noselect (concat outfile ".md"))</span>
            <span style="color: #b22222;">;;    </span><span style="color: #b22222;">(my-org-replace-punc-in-buffer)</span>
            <span style="color: #b22222;">;;    </span><span style="color: #b22222;">(save-buffer)))</span>
            (<span style="color: #a020f0;">save-excursion</span>
              (<span style="color: #a020f0;">save-restriction</span>
                (outline-up-heading 1)
                (<span style="color: #a020f0;">setq</span> filename
                      (concat (nth 4 (org-heading-components)) <span style="color: #8b2252;">"/"</span> filename))
                (<span style="color: #a020f0;">setq</span> command (concat command <span style="color: #8b2252;">" -e "</span> (downcase filename)))))
            (message <span style="color: #8b2252;">"[hugo] %s"</span> command)
            (<span style="color: #a020f0;">if</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">async</span> nil t)
                (<span style="color: #a020f0;">progn</span>
                  (message <span style="color: #8b2252;">"%s\n[async] Uploading..."</span> exported)
                  (async-start
                   `(<span style="color: #a020f0;">lambda</span> () (shell-command-to-string ',command))
                   `(<span style="color: #a020f0;">lambda</span> (result)
                      (message <span style="color: #8b2252;">"%s\n[async] Uploading...%s"</span>
                               ',exported (<span style="color: #a020f0;">when</span> result <span style="color: #8b2252;">"done"</span>) ))))
              (message <span style="color: #8b2252;">"%s\nUploading..."</span> exported)
              (message <span style="color: #8b2252;">"%s"</span> (shell-command-to-string command))
              (message <span style="color: #8b2252;">"%s\nUploading...done"</span> exported)))))))

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#32224;&#20999;&#12434;&#20170;&#26085;&#12395;&#12377;&#12427;&#65294;agenda &#12363;&#12425;&#36215;&#21205;&#12375;&#12383;&#12459;&#12524;&#12531;&#12480;&#12540;&#20869;&#12391;&#12399; "C-." &#12391;OK&#65288;&#27161;&#28310;&#65289;</span>
  (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-org-deadline-today</span> ()
    (<span style="color: #a020f0;">when</span> (org-entry-is-todo-p)
      (<span style="color: #a020f0;">let</span> ((date (org-entry-get (point) <span style="color: #8b2252;">"DEADLINE"</span>))
            (today (format-time-string <span style="color: #8b2252;">"%F"</span>)))
        (org-deadline 'deadline
                      (<span style="color: #a020f0;">if</span> date
                          (format <span style="color: #8b2252;">"&lt;%s%s"</span>
                                  today
                                  (substring date 11 (string-width date)))
                        (format <span style="color: #8b2252;">"&lt;%s&gt;"</span> today))))))

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#29694;&#22312;&#12398;&#12484;&#12522;&#12540;&#12434;&#30067;&#12435;&#12391;&#12363;&#12425;&#21516;&#12376;&#12524;&#12505;&#12523;&#12398;&#26368;&#24460;&#12398;&#35201;&#32032;&#12392;&#12375;&#12390;&#31227;&#21205;&#12377;&#12427;</span>
  (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-org-move-subtree-to-the-last</span> ()
    <span style="color: #8b2252;">"Move the current heading to the last one of the same level."</span>
    (<span style="color: #a020f0;">interactive</span>)
    (<span style="color: #a020f0;">let</span> ((cnt 0) beg)
      (org-back-to-heading)
      (outline-hide-subtree)
      (<span style="color: #a020f0;">setq</span> beg (point))
      (<span style="color: #a020f0;">while</span> (<span style="color: #a020f0;">and</span> (funcall 'org-get-next-sibling)
                  (looking-at org-outline-regexp))
        (<span style="color: #a020f0;">setq</span> cnt (1+ cnt)))
      (goto-char beg)
      (<span style="color: #a020f0;">when</span> (&gt; cnt 0)
        (org-move-subtree-down cnt)
        (goto-char beg)))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org480c9b8b" class="outline-3">
<h3 id="org480c9b8b"><span class="section-number-3">10.5.</span> face 関連</h3>
<div class="outline-text-3" id="text-org480c9b8b">
<p>
Orgバッファは日々のタスク管理で閲覧する頻度が高くと期間が長いです．好みの状態にカスタマイズして使いましょう．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"org"</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">Font lock &#12434;&#20351;&#12358;</span>
  (global-font-lock-mode 1)

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#12454;&#12451;&#12531;&#12489;&#12454;&#12398;&#31471;&#12391;&#25240;&#12426;&#36820;&#12377;</span>
  (<span style="color: #a020f0;">setq</span> org-startup-truncated nil)

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#12469;&#12502;&#12484;&#12522;&#12540;&#20197;&#19979;&#12398; * &#12434;&#30053;&#24335;&#34920;&#31034;&#12377;&#12427;</span>
  (<span style="color: #a020f0;">setq</span> org-hide-leading-stars t)

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">Color setting for TODO keywords</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">Color for priorities</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">(setq org-priority-faces</span>
  <span style="color: #b22222;">;;  </span><span style="color: #b22222;">'(("?A" :foreground "#E01B4C" :background "#FFFFFF" :weight bold)</span>
  <span style="color: #b22222;">;;    </span><span style="color: #b22222;">("?B" :foreground "#1739BF" :background "#FFFFFF" :weight bold)</span>
  <span style="color: #b22222;">;;    </span><span style="color: #b22222;">("?C" :foreground "#575757" :background "#FFFFFF" :weight bold)))</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">Color setting for Tags</span>

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">#CC3333</span>
  (<span style="color: #a020f0;">setq</span> org-todo-keyword-faces
        '((<span style="color: #8b2252;">"FOCUS"</span>    <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#FF0000"</span> <span style="color: #483d8b;">:background</span> <span style="color: #8b2252;">"#FFCC66"</span>)
          (<span style="color: #8b2252;">"BUG"</span>      <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#FF0000"</span> <span style="color: #483d8b;">:background</span> <span style="color: #8b2252;">"#FFCC66"</span>)
          (<span style="color: #8b2252;">"CHECK"</span>    <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#FF9900"</span> <span style="color: #483d8b;">:background</span> <span style="color: #8b2252;">"#FFF0F0"</span> <span style="color: #483d8b;">:underline</span> t)
          (<span style="color: #8b2252;">"ICAL"</span>     <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#33CC66"</span>)
          (<span style="color: #8b2252;">"APPROVED"</span> <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#66CC66"</span>)
          (<span style="color: #8b2252;">"QUESTION"</span> <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#FF0000"</span>)
          (<span style="color: #8b2252;">"WAIT"</span>     <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#CCCCCC"</span> <span style="color: #483d8b;">:background</span> <span style="color: #8b2252;">"#666666"</span>)
          (<span style="color: #8b2252;">"MAIL"</span>     <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#CC3300"</span> <span style="color: #483d8b;">:background</span> <span style="color: #8b2252;">"#FFEE99"</span>)
          (<span style="color: #8b2252;">"PLAN"</span>     <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#FF6600"</span>)
          (<span style="color: #8b2252;">"PLAN2"</span>    <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#FFFFFF"</span> <span style="color: #483d8b;">:background</span> <span style="color: #8b2252;">"#FF6600"</span>)
          (<span style="color: #8b2252;">"REV1"</span>     <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#3366FF"</span>)
          (<span style="color: #8b2252;">"REV2"</span>     <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#3366FF"</span> <span style="color: #483d8b;">:background</span> <span style="color: #8b2252;">"#99CCFF"</span>)
          (<span style="color: #8b2252;">"REV3"</span>     <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#FFFFFF"</span> <span style="color: #483d8b;">:background</span> <span style="color: #8b2252;">"#3366FF"</span>)
          (<span style="color: #8b2252;">"SLEEP"</span>    <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#9999CC"</span>)))

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">(:foreground "#0000FF" :bold t)     ; default. do NOT put this bottom</span>
  (<span style="color: #a020f0;">setq</span> org-tag-faces
        '((<span style="color: #8b2252;">"Achievement"</span> <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#66CC66"</span>)
          (<span style="color: #8b2252;">"Bug"</span>         <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#FF0000"</span>)
          (<span style="color: #8b2252;">"Report"</span>      <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#66CC66"</span>)
          (<span style="color: #8b2252;">"Background"</span>  <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#66CC99"</span>)
          (<span style="color: #8b2252;">"Chore"</span>       <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#6699CC"</span>)
          (<span style="color: #8b2252;">"project"</span>     <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#6666CC"</span>)
          (<span style="color: #8b2252;">"read"</span>        <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#6666CC"</span>)
          (<span style="color: #8b2252;">"book"</span>        <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#6666CC"</span>)
          (<span style="color: #8b2252;">"Doing"</span>       <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#FF0000"</span>)
          (<span style="color: #8b2252;">"Draft"</span>       <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#9933CC"</span>) <span style="color: #b22222;">;; </span><span style="color: #b22222;">Draft(r1,r2,r3)-&gt;Review(1,2)</span>
          (<span style="color: #8b2252;">"Review"</span>      <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#6633CC"</span>)
          (<span style="color: #8b2252;">"Revisit"</span>     <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#6633CC"</span>)
          (<span style="color: #8b2252;">"Redmine"</span>     <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#CC6666"</span>)
          (<span style="color: #8b2252;">"Ongoing"</span>     <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#CC6666"</span>) <span style="color: #b22222;">; </span><span style="color: #b22222;">for non scheduled/reminder</span>
          (<span style="color: #8b2252;">"Template"</span>    <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#66CC66"</span>)
          (<span style="color: #8b2252;">"Repeat"</span>      <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#CC9999"</span>) <span style="color: #b22222;">; </span><span style="color: #b22222;">for interval tasks</span>
          (<span style="color: #8b2252;">"Mag"</span>         <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#9966CC"</span>)
          (<span style="color: #8b2252;">"buy"</span>         <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#9966CC"</span>)
          (<span style="color: #8b2252;">"pay"</span>         <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#CC6699"</span>)
          (<span style="color: #8b2252;">"try"</span>         <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#FF3366"</span>)
          (<span style="color: #8b2252;">"secret"</span>      <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#FF0000"</span>)
          (<span style="color: #8b2252;">"emacs"</span>       <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#6633CC"</span>)
          (<span style="color: #8b2252;">"note"</span>        <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#6633CC"</span>)
          (<span style="color: #8b2252;">"print"</span>       <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#6633CC"</span>)
          (<span style="color: #8b2252;">"study"</span>       <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#6666CC"</span>)
          (<span style="color: #8b2252;">"Implements"</span>  <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#CC9999"</span> <span style="color: #483d8b;">:weight</span> bold)
          (<span style="color: #8b2252;">"Coding"</span>      <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#CC9999"</span>)
          (<span style="color: #8b2252;">"Editing"</span>     <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#CC9999"</span> <span style="color: #483d8b;">:weight</span> bold)
          (<span style="color: #8b2252;">"work"</span>        <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#CC9999"</span> <span style="color: #483d8b;">:weight</span> bold)
          (<span style="color: #8b2252;">"Survey"</span>      <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#CC9999"</span> <span style="color: #483d8b;">:weight</span> bold)
          (<span style="color: #8b2252;">"Home"</span>        <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#CC9999"</span> <span style="color: #483d8b;">:weight</span> bold)
          (<span style="color: #8b2252;">"Open"</span>        <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#CC9999"</span> <span style="color: #483d8b;">:weight</span> bold)
          (<span style="color: #8b2252;">"Blog"</span>        <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#9966CC"</span>)
          (<span style="color: #8b2252;">"story"</span>       <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#FF7D7D"</span>)
          (<span style="color: #8b2252;">"plan"</span>        <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#FF7D7D"</span>)
          (<span style="color: #8b2252;">"Test"</span>        <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#FF0000"</span> <span style="color: #483d8b;">:weight</span> bold)
          (<span style="color: #8b2252;">"attach"</span>      <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#FF0000"</span>)
          (<span style="color: #8b2252;">"drill"</span>       <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#66BB66"</span> <span style="color: #483d8b;">:underline</span> t)
          (<span style="color: #8b2252;">"DEBUG"</span>       <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#FFFFFF"</span> <span style="color: #483d8b;">:background</span> <span style="color: #8b2252;">"#9966CC"</span>)
          (<span style="color: #8b2252;">"EVENT"</span>       <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#FFFFFF"</span> <span style="color: #483d8b;">:background</span> <span style="color: #8b2252;">"#9966CC"</span>)
          (<span style="color: #8b2252;">"Thinking"</span>    <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#FFFFFF"</span> <span style="color: #483d8b;">:background</span> <span style="color: #8b2252;">"#96A9FF"</span>)
          (<span style="color: #8b2252;">"Schedule"</span>    <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#FFFFFF"</span> <span style="color: #483d8b;">:background</span> <span style="color: #8b2252;">"#FF7D7D"</span>)
          (<span style="color: #8b2252;">"INPUT"</span>       <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#FFFFFF"</span> <span style="color: #483d8b;">:background</span> <span style="color: #8b2252;">"#CC6666"</span>)
          (<span style="color: #8b2252;">"OUTPUT"</span>      <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#FFFFFF"</span> <span style="color: #483d8b;">:background</span> <span style="color: #8b2252;">"#66CC99"</span>)
          (<span style="color: #8b2252;">"CYCLE"</span>       <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#FFFFFF"</span> <span style="color: #483d8b;">:background</span> <span style="color: #8b2252;">"#6699CC"</span>)
          (<span style="color: #8b2252;">"weekend"</span>     <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#FFFFFF"</span> <span style="color: #483d8b;">:background</span> <span style="color: #8b2252;">"#CC6666"</span>)
          (<span style="color: #8b2252;">"Log"</span>         <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#008500"</span>))))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdec24da2" class="outline-3">
<h3 id="orgdec24da2"><span class="section-number-3">10.6.</span> TODOキーワードのカスタマイズ</h3>
<div class="outline-text-3" id="text-orgdec24da2">
<p>
キーワードには日本語も使えます．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"org"</span>
  (<span style="color: #a020f0;">setq</span> org-todo-keywords
        '((sequence <span style="color: #8b2252;">"TODO(t)"</span> <span style="color: #8b2252;">"PLAN(p)"</span> <span style="color: #8b2252;">"PLAN2(P)"</span> <span style="color: #8b2252;">"|"</span> <span style="color: #8b2252;">"DONE(d)"</span>)
          (sequence <span style="color: #8b2252;">"FOCUS(f)"</span> <span style="color: #8b2252;">"CHECK(C)"</span> <span style="color: #8b2252;">"ICAL(c)"</span>  <span style="color: #8b2252;">"|"</span> <span style="color: #8b2252;">"DONE(d)"</span>)
          (sequence <span style="color: #8b2252;">"WAIT(w)"</span> <span style="color: #8b2252;">"SLEEP(s)"</span> <span style="color: #8b2252;">"QUESTION(q)"</span> <span style="color: #8b2252;">"|"</span> <span style="color: #8b2252;">"DONE(d)"</span>)
          (sequence <span style="color: #8b2252;">"REV1(1)"</span> <span style="color: #8b2252;">"REV2(2)"</span> <span style="color: #8b2252;">"REV3(3)"</span> <span style="color: #8b2252;">"|"</span> <span style="color: #8b2252;">"APPROVED(a@/!)"</span>)))

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">Global counting of TODO items</span>
  (<span style="color: #a020f0;">setq</span> org-hierarchical-todo-statistics nil)

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">Global counting of checked TODO items</span>
  (<span style="color: #a020f0;">setq</span> org-hierarchical-checkbox-statistics nil)

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">block-update-time</span>
  (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">org-dblock-write:block-update-time</span> (params)
    (<span style="color: #a020f0;">let</span> ((fmt (<span style="color: #a020f0;">or</span> (plist-get params <span style="color: #483d8b;">:format</span>) <span style="color: #8b2252;">"%Y-%m-%d"</span>)))
      (insert <span style="color: #8b2252;">""</span> (format-time-string fmt (current-time))))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org55076fa0" class="outline-3">
<h3 id="org55076fa0"><span class="section-number-3">10.7.</span> ImageMagick を使って様々な画像をインライン表示する</h3>
<div class="outline-text-3" id="text-org55076fa0">
<p>
システムに <code>OpenJPEG</code> と <code>ImageMagick</code> がインストールされていれば，JPEG 2000 などの画像形式もバッファに表示できます．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"org"</span>
  (<span style="color: #a020f0;">setq</span> org-image-actual-width '(256))
  (add-to-list 'image-file-name-extensions <span style="color: #8b2252;">"jp2"</span>)
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">(add-to-list 'image-file-name-extensions "j2c")</span>
  (add-to-list 'image-file-name-extensions <span style="color: #8b2252;">"bmp"</span>)
  (add-to-list 'image-file-name-extensions <span style="color: #8b2252;">"psd"</span>))
</pre>
</div>

<p>
次の例では，同じ画像を2度インライン表示しようと指定ますが，前者は横幅が128ピクセルで表示され，後者は <code>org-image-actual-width</code> で指定した256ピクセルで表示されます．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">#+attr_html: <span style="color: #483d8b;">:width</span> 128
[[~/Desktop/lena_std.jp2]]

[[~/Desktop/lena_std.jp2]]
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(org-toggle-inline-images)
</pre>
</div>
</div>
</div>

<div id="outline-container-org53663ca9" class="outline-3">
<h3 id="org53663ca9"><span class="section-number-3">10.8.</span> README を常に org-mode で開く</h3>
<div class="outline-text-3" id="text-org53663ca9">
<p>
<code>init-org.el</code> として書き出して遅延読み込みしています．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">push</span> '(<span style="color: #8b2252;">"[rR][eE][aA][dD][mM][eE]"</span> . org-mode) auto-mode-alist)
</pre>
</div>
</div>
</div>

<div id="outline-container-org907cb9db" class="outline-3">
<h3 id="org907cb9db"><span class="section-number-3">10.9.</span> ソースブロック等の大文字記述を一括で小文字に変える</h3>
<div class="outline-text-3" id="text-org907cb9db">
<p>
<a href="https://scripter.co/org-keywords-lower-case/">https://scripter.co/org-keywords-lower-case/</a> で紹介されている関数を，ログ出力部分だけ加筆して使っています．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"org"</span>
  (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-lowercase-org-keywords</span> ()
    <span style="color: #8b2252;">"Lower case Org keywords and block identifiers."</span>
    (<span style="color: #a020f0;">interactive</span>)
    (<span style="color: #a020f0;">save-excursion</span>
      (goto-char (point-min))
      (<span style="color: #a020f0;">let</span> ((case-fold-search nil)
            (count 0))
        (<span style="color: #a020f0;">while</span> (re-search-forward
                <span style="color: #8b2252;">"</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">(?1:</span><span style="color: #8b2252;">#\\+[A-Z_]+</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">(?:</span><span style="color: #8b2252;">_[[:alpha:]]+</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">)</span><span style="color: #8b2252;">*</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">)</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">(?:</span><span style="color: #8b2252;">[ :=~&#8217;&#8221;]</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">|</span><span style="color: #8b2252;">$</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">)</span><span style="color: #8b2252;">"</span>
                nil <span style="color: #483d8b;">:noerror</span>)
          (<span style="color: #a020f0;">setq</span> count (1+ count))
          (<span style="color: #a020f0;">let*</span> ((prev (match-string-no-properties 1))
                 (new (downcase prev)))
            (replace-match new <span style="color: #483d8b;">:fixedcase</span> nil nil 1)
            (message <span style="color: #8b2252;">"Updated(%d): %s =&gt; %s"</span> count prev new)))
        (message <span style="color: #8b2252;">"Lower-cased %d matches"</span> count)))))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdae2d9e7" class="outline-3">
<h3 id="orgdae2d9e7"><span class="section-number-3">10.10.</span> イベント通知</h3>
<div class="outline-text-3" id="text-orgdae2d9e7">
<p>
ここでは， <code>terminal-notifier</code> ではなく，事実上，後継アプリと言える <code>alerter</code> を使う設定です．
</p>

<p>
macOS の通知機能を使って，Emacsで発生するイベントをユーザに通知します． <code>org-show-notification-handler</code> に <code>terminal-notifier.app</code> を呼ぶ関数をぶら下げることで， <code>org-notify</code> で簡単に通知機能を使えるようになります． <code>appt-disp-window</code> をカスタマイズすれば， appt を経由して TODOのアイテムも通知されます．
</p>

<p>
独自に追加した <code>ns-default-notification-sound</code> に OSで定められたアラーム音を設定できます．音楽を流したい時は， <code>org-show-notification-handler</code> の引数で指定すると設定できます．
</p>


<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">&#xa0;</th>
<th scope="col" class="org-left">sticky</th>
<th scope="col" class="org-left">sound</th>
<th scope="col" class="org-left">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">pomodoro</td>
<td class="org-left">nil</td>
<td class="org-left">Glass</td>
<td class="org-left">my-pomodoro-notify</td>
</tr>

<tr>
<td class="org-left">org-notify</td>
<td class="org-left">t</td>
<td class="org-left">default</td>
<td class="org-left">my-desktop-notification-handler</td>
</tr>

<tr>
<td class="org-left">daily.org</td>
<td class="org-left">select</td>
<td class="org-left">default</td>
<td class="org-left">my-desktop-notify</td>
</tr>

<tr>
<td class="org-left">appt</td>
<td class="org-left">select</td>
<td class="org-left">Glass/Pop</td>
<td class="org-left">ad:appt-disp-window</td>
</tr>
</tbody>
</table>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">&#xa0;</th>
<th scope="col" class="org-left">Note</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">pomodoro</td>
<td class="org-left">pomodoro loop</td>
</tr>

<tr>
<td class="org-left">org-notify</td>
<td class="org-left">orgからの通知</td>
</tr>

<tr>
<td class="org-left">daily.org</td>
<td class="org-left">Alarms on a table</td>
</tr>

<tr>
<td class="org-left">appt</td>
<td class="org-left">TODO items with deadline</td>
</tr>
</tbody>
</table>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-desktop-notification</span> (title message <span style="color: #228b22;">&amp;optional</span> sticky sound timeout)
  <span style="color: #8b2252;">"Show a message by `</span><span style="color: #008b8b;">alerter</span><span style="color: #8b2252;">' command."</span>
  (<span style="color: #a020f0;">if</span> (equal ns-alerter-command <span style="color: #8b2252;">""</span>)
      (message <span style="color: #8b2252;">"--- ns-alerter-command is \"%s\"."</span> ns-alerter-command)
    (start-process
     <span style="color: #8b2252;">"notification"</span> <span style="color: #8b2252;">"*notification*"</span>
     ns-alerter-command
     <span style="color: #8b2252;">"-title"</span> title
     <span style="color: #8b2252;">"-message"</span> message
     <span style="color: #8b2252;">"-sender"</span> <span style="color: #8b2252;">"org.gnu.Emacs"</span>
     <span style="color: #8b2252;">"-timeout"</span> (format <span style="color: #8b2252;">"%s"</span> (<span style="color: #a020f0;">if</span> sticky 0 (<span style="color: #a020f0;">or</span> timeout 7)))
     <span style="color: #8b2252;">"-sound"</span> (<span style="color: #a020f0;">or</span> sound ns-default-notification-sound))))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-desktop-notification-handler</span> (message)
  (my-desktop-notification <span style="color: #8b2252;">"Message from org-mode"</span> message t))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"org"</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">Select from Preferences: { Funk | Glass | ... | Purr | Pop ... }</span>
  (<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">ns-default-notification-sound</span> <span style="color: #8b2252;">"Pop"</span>)

  (<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">ns-alerter-command</span> (concat (getenv <span style="color: #8b2252;">"HOME"</span>) <span style="color: #8b2252;">"/Dropbox/bin/alerter"</span>)
    <span style="color: #8b2252;">"Path to alerter command. see https://github.com/vjeantet/alerter"</span>)

  (<span style="color: #a020f0;">when</span> (executable-find ns-alerter-command)
    (<span style="color: #a020f0;">setq</span> org-show-notification-handler #'my-desktop-notification-handler)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orga58b21fc" class="outline-3">
<h3 id="orga58b21fc"><span class="section-number-3">10.11.</span> org-mode でアラーム管理</h3>
<div class="outline-text-3" id="text-orga58b21fc">
<p>
<del>（注）Growlnotify の代わりに <code>terminal-notifier</code> を使うこともできます．</del>
</p>

<p>
<span class="timestamp-wrapper"><span class="timestamp">[2018-03-19 Mon]</span></span>: alerter に統一しました．
</p>

<p>
通知アプリと org-mode のバッファを組み合わせてアラームリストを管理しています．アラームをorgバッファに書き込むだけなので，とても楽です．機能としては，特定のorgバッファに，時刻とアラームの内容を表の形式として保存しておくだけで，Emacs が起動している限りにおいて通知アプリがそのアラームをデスクトップに表示してくれます．つまり，アラームリストは org-mode の表で一覧化されているので，管理も楽ですし，見た目もわかりやすいです．
</p>

<p>
アラームとして解釈される表は，オプション，時刻（HH:MM形式），アラーム内容の3列で構成していればOKです．オプションの列にXを入れておくと，通知アプリがStickyモードで動作するので，アラームを見逃しません．
</p>

<p>
アラームは複数登録することができます．不要になったアラームを削除するのは，単純に表から当該の行を削除するだけで済みます．実際のところは，バッファが保存される時にアラームリストの変更が自動的にシステムに反映されるので，余計な作業は不要です．
</p>

<p>
<code>my-set-alarms-from-file</code> は，<a href="https://pxaka.tokyo/wiki/doku.php?id=emacs:utility.el">utility.el</a>に記述した関数です．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">unless</span> noninteractive
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"org"</span>
    (<span style="color: #a020f0;">let</span> ((file <span style="color: #8b2252;">"~/Dropbox/org/db/daily.org"</span>))
      (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">and</span> (file-exists-p file)
                 (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">utility</span> nil t))
        (my-set-alarms-from-file file) <span style="color: #b22222;">;; </span><span style="color: #b22222;">init</span>
        (add-hook 'after-save-hook #'my-update-alarms-from-file))))) <span style="color: #b22222;">;; </span><span style="color: #b22222;">update</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org49e5d185" class="outline-3">
<h3 id="org49e5d185"><span class="section-number-3">10.12.</span> カウントダウンタイマー</h3>
<div class="outline-text-3" id="text-org49e5d185">
<p>
<code>M-x my-countdown-timer</code> で呼び出します．ちょっと時間を測りたい時に使っています．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"org"</span>
  (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-countdown-timer-notify</span> ()
    (<span style="color: #a020f0;">when</span> mode-line-format
      (my-mode-line-off))
    (<span style="color: #a020f0;">when</span> ns-alerter-command
      (<span style="color: #a020f0;">setq</span> org-show-notification-handler #'my-desktop-notification-handler))
    (remove-hook 'org-timer-done-hook #'my-countdown-timer-notify)
    (remove-hook 'org-timer-stop-hook #'my-countdown-timer-notify)
    (my-desktop-notification <span style="color: #8b2252;">"### Expired! ###"</span> <span style="color: #8b2252;">"Time is up!"</span> t <span style="color: #8b2252;">"Glass"</span>))

  (<span style="color: #a020f0;">defalias</span> '<span style="color: #0000ff;">run-timer</span> 'my-countdown-timer)
  (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-countdown-timer</span> ()
    (<span style="color: #a020f0;">interactive</span>)
    (<span style="color: #a020f0;">unless</span> mode-line-format
      (my-mode-line-on))
    (<span style="color: #a020f0;">when</span> (eq org-show-notification-handler #'my-desktop-notification-handler)
      (<span style="color: #a020f0;">setq</span> org-show-notification-handler nil))
    (<span style="color: #a020f0;">with-temp-buffer</span>
      (org-mode)
      (add-hook 'org-timer-done-hook #'my-countdown-timer-notify)
      (add-hook 'org-timer-stop-hook #'my-countdown-timer-notify)
      (org-timer-set-timer))))
</pre>
</div>
</div>
</div>

<div id="outline-container-orga3d0c218" class="outline-3">
<h3 id="orga3d0c218"><span class="section-number-3">10.13.</span> リンクをエコーエリアに表示する</h3>
<div class="outline-text-3" id="text-orga3d0c218">
<p>
<code>eldoc</code> の機能を使うと簡単にできます．
</p>

<ul class="org-ul">
<li><a href="https://pxaka.tokyo/blog/2019/a7ef3cd5-df52-2004-db2b-03d36ef48555/">リンクの内容をeldocで表示 - imadenale</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(org-mode my-load-echo-org-link)
                         <span style="color: #8b2252;">"org"</span> nil t)
  (add-hook 'org-mode-hook #'my-load-echo-org-link)
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"org"</span>
    (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-echo-org-link</span> ()
      (<span style="color: #a020f0;">when</span> (org-in-regexp org-link-bracket-re 1)
        (<span style="color: #a020f0;">let</span> ((link <span style="color: #8b2252;">"Link:"</span>)
              (msg (org-link-unescape (match-string-no-properties 1))))
          (put-text-property 0 (length link) 'face 'minibuffer-prompt link)
          (eldoc-message (format <span style="color: #8b2252;">"%s %s"</span> link msg)))))

    (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-load-echo-org-link</span> ()
      (<span style="color: #a020f0;">add-function</span> <span style="color: #483d8b;">:before-until</span> (local 'eldoc-documentation-function)
                    #'my-echo-org-link)
      <span style="color: #b22222;">;; </span><span style="color: #b22222;">(setq-local eldoc-documentation-function #'my-echo-org-link)</span>
      )))
</pre>
</div>
</div>
</div>

<div id="outline-container-org10cf6a0a" class="outline-3">
<h3 id="org10cf6a0a"><span class="section-number-3">10.14.</span> <span class="todo TODO">TODO</span> HHKBで矢印を使わないように設定する</h3>
<div class="outline-text-3" id="text-org10cf6a0a">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"org"</span>
  (org-defkey org-mode-map (kbd <span style="color: #8b2252;">"M-p"</span>) #'my-org-meta-next)
  (org-defkey org-mode-map (kbd <span style="color: #8b2252;">"M-n"</span>) #'my-org-meta-previous)
  (org-defkey org-mode-map (kbd <span style="color: #8b2252;">"M-b"</span>) #'my-org-meta-backward)
  (org-defkey org-mode-map (kbd <span style="color: #8b2252;">"M-f"</span>) #'my-org-meta-forward))

(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-org-item-has-child-p</span> ()
  <span style="color: #8b2252;">"Return t, if the item has at least a child item."</span>
  (<span style="color: #a020f0;">save-excursion</span>
    (beginning-of-line)
    (org-list-has-child-p (point) (org-list-struct))))

(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-org-heading-has-child-p</span> ()
  <span style="color: #8b2252;">"Return t, if the heading has at least a child heading."</span>
  (<span style="color: #a020f0;">save-excursion</span>
    (org-goto-first-child)))

(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-org-meta-previous</span> ()
  <span style="color: #8b2252;">"Move item or subtree down, otherwise `</span><span style="color: #008b8b;">scroll-up</span><span style="color: #8b2252;">'."</span>
  (<span style="color: #a020f0;">interactive</span>)
  (<span style="color: #a020f0;">cond</span> ((org-at-item-p)
               (call-interactively 'org-move-item-down))
              ((<span style="color: #a020f0;">or</span> (looking-at org-heading-regexp)
             (<span style="color: #a020f0;">and</span> (org-at-heading-p) (eolp)))
               (call-interactively 'org-move-subtree-down))
        ((org-at-table-p)
         (call-interactively 'org-table-move-row))
              (t nil))) <span style="color: #b22222;">;; </span><span style="color: #b22222;">(call-interactively 'scroll-up)</span>

(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-org-meta-next</span> ()
  <span style="color: #8b2252;">"Move item or subtree up, otherwise `</span><span style="color: #008b8b;">scroll-down</span><span style="color: #8b2252;">'."</span>
  (<span style="color: #a020f0;">interactive</span>)
  (<span style="color: #a020f0;">cond</span> ((org-at-item-p)
               (call-interactively 'org-move-item-up))
              ((<span style="color: #a020f0;">or</span> (looking-at org-heading-regexp)
             (<span style="color: #a020f0;">and</span> (org-at-heading-p) (eolp)))
               (call-interactively 'org-move-subtree-up))
        ((org-at-table-p)
         (org-call-with-arg 'org-table-move-row 'up))
              (t nil))) <span style="color: #b22222;">;; </span><span style="color: #b22222;">(call-interactively 'scroll-down))))</span>

(<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">my-org-promote-demote-independently</span> nil)
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-inherit-struct-p</span> ()
  (<span style="color: #a020f0;">and</span> (not my-org-promote-demote-independently)
       (<span style="color: #a020f0;">or</span> (my-org-item-has-child-p) (my-org-heading-has-child-p))))

(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-org-at-meta-fb-p</span> ()
  <span style="color: #8b2252;">"Return t, if the cursor stay at item, heading, or table."</span>
  (<span style="color: #a020f0;">or</span> (org-at-item-p)
      (looking-at org-heading-regexp)
      (<span style="color: #a020f0;">and</span> (org-at-heading-p) (eolp))
      (org-at-table-p)))

(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-org-meta-forward</span> ()
  (<span style="color: #a020f0;">interactive</span>)
  (<span style="color: #a020f0;">if</span> (my-org-at-meta-fb-p)
      (<span style="color: #a020f0;">if</span> (my-inherit-struct-p)
          (org-shiftmetaright)
        (org-metaright)) <span style="color: #b22222;">;; </span><span style="color: #b22222;">FIXME similar check to my-org-at-meta-fb-p</span>
    (<span style="color: #a020f0;">if</span> (<span style="color: #a020f0;">and</span> (fboundp 'syntax-subword-mode)
             syntax-subword-mode)
        (call-interactively 'syntax-subword-forward)
      (forward-word))))

(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-org-meta-backward</span> ()
  (<span style="color: #a020f0;">interactive</span>)
  (<span style="color: #a020f0;">if</span> (my-org-at-meta-fb-p)
      (<span style="color: #a020f0;">if</span> (my-inherit-struct-p)
          (org-shiftmetaleft)
        (org-metaleft)) <span style="color: #b22222;">;; </span><span style="color: #b22222;">FIXME similar check to my-org-at-meta-fb-p</span>
    (<span style="color: #a020f0;">if</span> (<span style="color: #a020f0;">and</span> (fboundp 'syntax-subword-mode)
             syntax-subword-mode)
        (call-interactively 'syntax-subword-backward)
      (backward-word))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org0d2cce2f" class="outline-3">
<h3 id="org0d2cce2f"><span class="section-number-3">10.15.</span> orgmode のテーブルを csv に変換する</h3>
<div class="outline-text-3" id="text-org0d2cce2f">
<p>
標準関数の <code>org-table-export</code> を使えば，テーブルを csv 等の形式で外部出力できます．ただバッファ上で csv に変えたりする関数があると楽なので次の関数を使います．標準関数の一部を再利用しています．
</p>

<p>
<code>M-x org-table-to-format</code> を呼び出すとデフォルトでカンマ区切りに変換してくれます．さらにその情報をコピペできるようにクリップボードに流し込みます．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-org-table-copy-as</span> (<span style="color: #228b22;">&amp;optional</span> format)
  <span style="color: #8b2252;">"Copy converted table."</span>
  (<span style="color: #a020f0;">interactive</span>)
  (<span style="color: #a020f0;">let</span> ((format (<span style="color: #a020f0;">or</span> format
                    (org-entry-get (point) <span style="color: #8b2252;">"TABLE_EXPORT_FORMAT"</span> t)
                    org-table-export-default-format)))
    (<span style="color: #a020f0;">if</span> (string-match <span style="color: #8b2252;">"</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">(</span><span style="color: #8b2252;">[</span><span style="color: #8b2252;">^</span><span style="color: #8b2252;"> \t\r\n]+</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">)</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">(</span><span style="color: #8b2252;"> +.*</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">)</span><span style="color: #8b2252;">?"</span> format)
              (<span style="color: #a020f0;">let</span> ((transform (intern (match-string 1 format)))
                    (params (<span style="color: #a020f0;">and</span> (match-end 2)
                                             (read (concat <span style="color: #8b2252;">"("</span> (match-string 2 format) <span style="color: #8b2252;">")"</span>))))
                    (table (org-table-to-lisp)))
          (<span style="color: #a020f0;">if</span> (not (org-at-table-p))
              (<span style="color: #ff0000; font-weight: bold;">user-error</span> <span style="color: #8b2252;">"The cursor is not at a table"</span>)
                  (<span style="color: #a020f0;">with-temp-buffer</span>
                          (insert (funcall transform table params) <span style="color: #8b2252;">"\n"</span>)
              (clipboard-kill-ring-save (point-min) (point-max)))))
      (<span style="color: #ff0000; font-weight: bold;">user-error</span> <span style="color: #8b2252;">"TABLE_EXPORT_FORMAT invalid"</span>))))

(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-org-table-convert-to</span> (<span style="color: #228b22;">&amp;optional</span> format)
  <span style="color: #8b2252;">"Convert a table to FORMAT.</span>
<span style="color: #8b2252;">If FORMAT is nil, it is set equal to a property value specified</span>
<span style="color: #8b2252;">by \"TABLE_EXPORT_FORMAT\" or `</span><span style="color: #008b8b;">org-table-export-default-format</span><span style="color: #8b2252;">'.</span>
<span style="color: #8b2252;">Converted table is copied to kill ring for further use.</span>
<span style="color: #8b2252;">The core part is extracted from `</span><span style="color: #008b8b;">org-table-export</span><span style="color: #8b2252;">'."</span>
  (<span style="color: #a020f0;">interactive</span>)
  (<span style="color: #a020f0;">let</span> ((format (<span style="color: #a020f0;">or</span> format
                    (org-entry-get (point) <span style="color: #8b2252;">"TABLE_EXPORT_FORMAT"</span> t)
                    org-table-export-default-format)))
    (<span style="color: #a020f0;">if</span> (string-match <span style="color: #8b2252;">"</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">(</span><span style="color: #8b2252;">[</span><span style="color: #8b2252;">^</span><span style="color: #8b2252;"> \t\r\n]+</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">)</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">(</span><span style="color: #8b2252;"> +.*</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">)</span><span style="color: #8b2252;">?"</span> format)
              (<span style="color: #a020f0;">let</span> ((transform (intern (match-string 1 format)))
                    (params (<span style="color: #a020f0;">and</span> (match-end 2)
                                             (read (concat <span style="color: #8b2252;">"("</span> (match-string 2 format) <span style="color: #8b2252;">")"</span>))))
                    (table (org-table-to-lisp)))
          (<span style="color: #a020f0;">if</span> (not (org-at-table-p))
              (<span style="color: #ff0000; font-weight: bold;">user-error</span> <span style="color: #8b2252;">"The cursor is not at a table"</span>)
                  (kill-region (org-table-begin) (org-table-end))
                  (<span style="color: #a020f0;">let</span> ((begin (point)))
                    (insert (funcall transform table params))
                    (clipboard-kill-ring-save begin (point))
              (insert <span style="color: #8b2252;">"\n"</span>))))
      (<span style="color: #ff0000; font-weight: bold;">user-error</span> <span style="color: #8b2252;">"TABLE_EXPORT_FORMAT invalid"</span>))))
</pre>
</div>
</div>
</div>
<div id="outline-container-org5c265a12" class="outline-3">
<h3 id="org5c265a12"><span class="section-number-3">10.16.</span> ソースブロック内で eldoc の発動を抑制する</h3>
<div class="outline-text-3" id="text-org5c265a12">
<p>
org バッファのソースブロックにカーソルがある時には， <code>eldoc</code> が発動しないようにします．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"eldoc"</span>
  (<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">my-eldoc-disable-in-org-block</span> nil)
  (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">ad:eldoc-print-current-symbol-info</span> (f <span style="color: #228b22;">&amp;optional</span> interactive)
    <span style="color: #8b2252;">"Run `</span><span style="color: #008b8b;">eldoc</span><span style="color: #8b2252;">' when the cursor is NOT located in org source block."</span>
    (<span style="color: #a020f0;">interactive</span> '(t))
    (<span style="color: #a020f0;">unless</span> (<span style="color: #a020f0;">or</span> my-eldoc-disable-in-org-block
                (<span style="color: #a020f0;">and</span> (eq major-mode 'org-mode)
                     (eq (car (org-element-at-point)) 'src-block)))
      (funcall f interactive)))
  (advice-add 'eldoc-print-current-symbol-info <span style="color: #483d8b;">:around</span>
              #'ad:eldoc-print-current-symbol-info))
</pre>
</div>
</div>
</div>

<div id="outline-container-org21a5771d" class="outline-3">
<h3 id="org21a5771d"><span class="section-number-3">10.17.</span> 見出しの上で org-reveal する場合の挙動を変える</h3>
<div class="outline-text-3" id="text-org21a5771d">
<p>
通常の <code>org-reveal</code> は，ドロワを展開しませんが，カーソルが見出し上にある時に <code>org-reveal</code> (C-c C-r) を呼ぶ時に，ドロワを展開して内容を表示させるようにします．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">ad:org-reveal</span> (f <span style="color: #228b22;">&amp;optional</span> siblings)
  (<span style="color: #a020f0;">interactive</span> <span style="color: #8b2252;">"P"</span>)
  (<span style="color: #a020f0;">if</span> (org-at-heading-p)
      (org-show-subtree)
    (funcall f siblings)))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(advice-add 'org-reveal <span style="color: #483d8b;">:around</span> #'ad:org-reveal)
</pre>
</div>
</div>
</div>

<div id="outline-container-org1bc48f7e" class="outline-3">
<h3 id="org1bc48f7e"><span class="section-number-3">10.18.</span> <span class="todo TODO">TODO</span> org-emphasis-alist の各要素を個別に配色する</h3>
<div class="outline-text-3" id="text-org1bc48f7e">
<p>
下記で紹介されている設定を軽くカスタマイズして使用しています．
</p>

<ul class="org-ul">
<li><a href="https://protesilaos.com/codelog/2022-01-05-custom-face-org-emphasis-alist/">https://protesilaos.com/codelog/2022-01-05-custom-face-org-emphasis-alist/</a></li>
</ul>

<p>
日本語を <b>入力</b> しています．
日本語を <span class="underline">入力</span> しています．
日本語を <i>入力</i> しています．
日本語を <del>入力</del> しています．
日本語を <code>入力</code> しています．
日本語を <code>入力</code> しています．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"org"</span>
  (custom-set-variables <span style="color: #b22222;">;; </span><span style="color: #b22222;">call org-set-emph-re</span>
   '(org-emphasis-alist '((<span style="color: #8b2252;">"~"</span> org-code verbatim)
                          (<span style="color: #8b2252;">"="</span> org-verbatim verbatim)
                          (<span style="color: #8b2252;">"*"</span> my-org-emphasis-bold)
                          (<span style="color: #8b2252;">"/"</span> my-org-emphasis-italic)
                          (<span style="color: #8b2252;">"_"</span> my-org-emphasis-underline)
                          (<span style="color: #8b2252;">"+"</span> my-org-emphasis-strike-through))))

  (custom-set-faces
   '(org-code
     ((t (<span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"red"</span> <span style="color: #483d8b;">:background</span> <span style="color: #8b2252;">"pink"</span> <span style="color: #483d8b;">:inherit</span> shadow))))
   '(org-verbatim
     ((t (<span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#ff6059"</span> <span style="color: #483d8b;">:background</span> <span style="color: #8b2252;">"PeachPuff"</span> <span style="color: #483d8b;">:inherit</span> shadow)))))

  (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">featurep</span> '<span style="color: #008b8b;">org-extra-emphasis</span>)
    (org-extra-emphasis-update)) <span style="color: #b22222;">;; </span><span style="color: #b22222;">to apply configured `</span><span style="color: #008b8b;">org-emphasis-alist</span><span style="color: #b22222;">'</span>

  (<span style="color: #a020f0;">defface</span> <span style="color: #a0522d;">my-org-emphasis-bold</span>
    '((default <span style="color: #483d8b;">:inherit</span> bold)
      (((class color) (min-colors 88) (background light))
       <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#5b5caf"</span> <span style="color: #483d8b;">:background</span> <span style="color: #8b2252;">"#e6ebfa"</span>) <span style="color: #b22222;">;; </span><span style="color: #b22222;">#a60000 #4E4F97 #c7e9fa</span>
      (((class color) (min-colors 88) (background dark))
       <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#99B2FF"</span>)) <span style="color: #b22222;">;; </span><span style="color: #b22222;">#ff8059 #BCBCDB #6666D6 #879EE2</span>
    <span style="color: #8b2252;">"My bold emphasis for Org."</span>)

  (<span style="color: #a020f0;">defface</span> <span style="color: #a0522d;">my-org-emphasis-italic</span>
    '((default <span style="color: #483d8b;">:inherit</span> italic)
      (((class color) (min-colors 88) (background light))
       <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#005e00"</span> <span style="color: #483d8b;">:background</span> <span style="color: #8b2252;">"#B4EAB4"</span>)
      (((class color) (min-colors 88) (background dark))
       <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#44bc44"</span>))
    <span style="color: #8b2252;">"My italic emphasis for Org."</span>)

  (<span style="color: #a020f0;">defface</span> <span style="color: #a0522d;">my-org-emphasis-underline</span>
    '((default <span style="color: #483d8b;">:inherit</span> underline)
      (((class color) (min-colors 88) (background light))
       <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#813e00"</span>)
      (((class color) (min-colors 88) (background dark))
       <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#d0bc00"</span>))
    <span style="color: #8b2252;">"My underline emphasis for Org."</span>)

  (<span style="color: #a020f0;">defface</span> <span style="color: #a0522d;">my-org-emphasis-strike-through</span>
    '((((class color) (min-colors 88) (background light))
       <span style="color: #483d8b;">:strike-through</span> <span style="color: #8b2252;">"#972500"</span> <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#505050"</span>)
      (((class color) (min-colors 88) (background dark))
       <span style="color: #483d8b;">:strike-through</span> <span style="color: #8b2252;">"#ef8b50"</span> <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#a8a8a8"</span>))
    <span style="color: #8b2252;">"My strike-through emphasis for Org."</span>))
</pre>
</div>
</div>
</div>

<div id="outline-container-org6c2ed02c" class="outline-3">
<h3 id="org6c2ed02c"><span class="section-number-3">10.19.</span> 現在のアイテムをリストの最初・最後に移す</h3>
<div class="outline-text-3" id="text-org6c2ed02c">
<p>
下記の設定では， <code>C-c M-n</code> でリストの末尾に， <code>C-c M-p</code> でリストの先頭に，現在のファイルを移します．カーソルは，移動せさせずに，元の場所に留めます．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"org"</span>
  (define-key org-mode-map (kbd <span style="color: #8b2252;">"C-c M-n"</span>) #'my-org-move-item-end)
  (define-key org-mode-map (kbd <span style="color: #8b2252;">"C-c M-p"</span>) #'my-org-move-item-begin))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-org-move-item-begin</span> ()
  <span style="color: #8b2252;">"Move the current item to the beginning of the list."</span>
  (<span style="color: #a020f0;">interactive</span>)
  (<span style="color: #a020f0;">unless</span> (org-at-item-p) (<span style="color: #ff0000; font-weight: bold;">error</span> <span style="color: #8b2252;">"Not at an item"</span>))
  (<span style="color: #a020f0;">let*</span> ((col (current-column))
         (item (point-at-bol))
         (struct (org-list-struct))
         (prevs (org-list-prevs-alist struct))
         (prev-item (org-list-get-prev-item (point-at-bol) struct prevs)))
    (<span style="color: #a020f0;">unless</span> prev-item
      (<span style="color: #ff0000; font-weight: bold;">user-error</span> <span style="color: #8b2252;">"Cannot move this item further up"</span>))
    (<span style="color: #a020f0;">setq</span> struct (org-list-send-item item 'begin struct))
    (goto-char item)
    (org-list-write-struct struct (org-list-parents-alist struct))
    (org-move-to-column col)))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-org-move-item-end</span> ()
  <span style="color: #8b2252;">"Move the current item to the end of the list."</span>
  (<span style="color: #a020f0;">interactive</span>)
  (<span style="color: #a020f0;">unless</span> (org-at-item-p) (<span style="color: #ff0000; font-weight: bold;">error</span> <span style="color: #8b2252;">"Not at an item"</span>))
  (<span style="color: #a020f0;">let*</span> ((col (current-column))
         (item (point-at-bol))
         (struct (org-list-struct))
         (prevs (org-list-prevs-alist struct))
         (next-item (org-list-get-next-item (point-at-bol) struct prevs)))
    (<span style="color: #a020f0;">unless</span> next-item
      (<span style="color: #ff0000; font-weight: bold;">user-error</span> <span style="color: #8b2252;">"Cannot move this item further down"</span>))
    (<span style="color: #a020f0;">setq</span> struct (org-list-send-item item 'end struct))
    (goto-char item)
    (org-list-write-struct struct (org-list-parents-alist struct))
    (org-move-to-column col)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org30aecedf" class="outline-3">
<h3 id="org30aecedf"><span class="section-number-3">10.20.</span> [org-capture] 高速にメモを取る</h3>
<div class="outline-text-3" id="text-org30aecedf">
<p>
Emacs を起動している限り，いつでもどこでもメモを記録できます．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(org-capture)
                         <span style="color: #8b2252;">"org-capture"</span> nil t)
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"org"</span>
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#12461;&#12515;&#12503;&#12481;&#12515;&#26178;&#12395;&#20316;&#25104;&#26085;&#26178;&#12434;&#12503;&#12525;&#12497;&#12486;&#12451;&#12395;&#20837;&#12428;&#12427;</span>
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">Thanks to https://emacs.stackexchange.com/questions/21291/add-created-timestamp-to-logbook</span>
    (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-org-default-property</span> ()
      <span style="color: #8b2252;">"Set the creation date and org-id."</span>
      (<span style="color: #a020f0;">interactive</span>)
      (my-org-set-created-property)
      (org-id-get-create))
    (<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">my-org-created-property-name</span> <span style="color: #8b2252;">"CREATED"</span>
      <span style="color: #8b2252;">"The name of the org-mode property.</span>
<span style="color: #8b2252;">This user property stores the creation date of the entry"</span>)
    (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-org-set-created-property</span> (<span style="color: #228b22;">&amp;optional</span> active NAME)
      <span style="color: #8b2252;">"Set a property on the entry giving the creation time.</span>

<span style="color: #8b2252;">By default the property is called CREATED. If given the `</span><span style="color: #008b8b;">NAME</span><span style="color: #8b2252;">'</span>
<span style="color: #8b2252;">argument will be used instead. If the property already exists, it</span>
<span style="color: #8b2252;">will not be modified."</span>
      (<span style="color: #a020f0;">interactive</span>)
      (<span style="color: #a020f0;">let*</span> ((created (<span style="color: #a020f0;">or</span> NAME my-org-created-property-name))
             (fmt (<span style="color: #a020f0;">if</span> active <span style="color: #8b2252;">"&lt;%s&gt;"</span> <span style="color: #8b2252;">"[%s]"</span>))
             (now (format fmt (format-time-string <span style="color: #8b2252;">"%Y-%m-%d %a %H:%M"</span>)))
             (field (org-entry-get (point) created nil)))
        (<span style="color: #a020f0;">unless</span> (<span style="color: #a020f0;">or</span> field (equal <span style="color: #8b2252;">""</span> field))
          (org-set-property created now)
          (org-cycle-hide-drawers 'children))))
    (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">ad:org-insert-todo-heading</span> (_arg <span style="color: #228b22;">&amp;optional</span> _force-heading)
      (<span style="color: #a020f0;">unless</span> (org-at-item-checkbox-p)
        (my-org-default-property)))
    (advice-add 'org-insert-todo-heading <span style="color: #483d8b;">:after</span> #'ad:org-insert-todo-heading))

  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"org-capture"</span>
    (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-toggle-org-block-visibility</span> ()
      <span style="color: #8b2252;">"Testing..."</span>
      (<span style="color: #a020f0;">interactive</span>)
      (<span style="color: #a020f0;">when</span> (looking-at org-drawer-regexp)
        (org-flag-drawer                <span style="color: #b22222;">; </span><span style="color: #b22222;">toggle block visibility</span>
         (not (get-char-property (match-end 0) 'invisible)))))

    (add-hook 'org-capture-before-finalize-hook #'my-org-set-created-property)

    <span style="color: #b22222;">;; </span><span style="color: #b22222;">2010-06-13 &#12398;&#24418;&#24335;&#12391;&#12399;&#65292;&#12479;&#12464;&#12392;&#12375;&#12390;&#35469;&#35672;&#12373;&#12428;&#12394;&#12356;</span>
    (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">get-current-date-tags</span> () (format-time-string <span style="color: #8b2252;">"%Y%m%d"</span>))
    (<span style="color: #a020f0;">setq</span> org-default-notes-file (concat org-directory <span style="color: #8b2252;">"next.org"</span>))
    (<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">org-capture-academic-file</span> (concat org-directory <span style="color: #8b2252;">"academic.org"</span>))
    (<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">org-capture-ical-file</span> (concat org-directory <span style="color: #8b2252;">"org-ical.org"</span>))
    (<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">org-capture-buffer-file</span> (concat org-directory <span style="color: #8b2252;">"db/buffer.org"</span>))
    (<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">org-capture-notes-file</span> (concat org-directory <span style="color: #8b2252;">"db/note.org"</span>))
    (<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">org-capture-english-file</span> (concat org-directory <span style="color: #8b2252;">"db/english.org"</span>))
    (<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">org-capture-diary-file</span> (concat org-directory <span style="color: #8b2252;">"log/diary.org"</span>))
    (<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">org-capture-article-file</span> (concat org-directory <span style="color: #8b2252;">"db/article.org"</span>))
    (<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">org-capture-blog-file</span>
      (concat org-directory <span style="color: #8b2252;">"blog/entries/imadenale.org"</span>))

    <span style="color: #b22222;">;; </span><span style="color: #b22222;">see org.pdf:p73</span>
    (<span style="color: #a020f0;">setq</span> org-capture-templates
          `((<span style="color: #8b2252;">"t"</span> <span style="color: #8b2252;">"TODO &#38917;&#30446;&#12434; INBOX &#12395;&#36028;&#12426;&#20184;&#12369;&#12427;"</span> entry
             (file+headline ,org-default-notes-file <span style="color: #8b2252;">"INBOX"</span>) <span style="color: #8b2252;">"** TODO %?\n"</span>)
            (<span style="color: #8b2252;">"a"</span> <span style="color: #8b2252;">"&#35352;&#20107;&#12522;&#12473;&#12488;&#12395;&#12456;&#12531;&#12488;&#12522;&#12540;"</span> entry
             (file+headline ,org-capture-article-file <span style="color: #8b2252;">"INBOX"</span>)
             <span style="color: #8b2252;">"** READ %?\n\t"</span>)
            (<span style="color: #8b2252;">"c"</span> <span style="color: #8b2252;">"&#21516;&#26399;&#12459;&#12524;&#12531;&#12480;&#12540;&#12395;&#12456;&#12531;&#12488;&#12522;&#12540;"</span> entry
             (file+headline ,org-capture-ical-file <span style="color: #8b2252;">"Scheduled"</span>)
             <span style="color: #8b2252;">"** TODO %?\n\t"</span>)
            (<span style="color: #8b2252;">"d"</span> <span style="color: #8b2252;">"Doing&#12479;&#12464;&#20184;&#12365;&#12398;&#12479;&#12473;&#12463;&#12434;Inbox&#12395;&#25237;&#12370;&#12427;"</span> entry
             (file+headline ,org-default-notes-file <span style="color: #8b2252;">"INBOX"</span>)
             <span style="color: #8b2252;">"** TODO %? :Doing:\n  - \n"</span>
             <span style="color: #483d8b;">:clock-in</span> t
             <span style="color: #483d8b;">:clock-keep</span> t)
            (<span style="color: #8b2252;">"l"</span> <span style="color: #8b2252;">"&#26412;&#26085;&#12398;&#12481;&#12455;&#12483;&#12463;&#12522;&#12473;&#12488;"</span> entry
             (file+headline ,org-capture-diary-file <span style="color: #8b2252;">"Today"</span>)
             <span style="color: #8b2252;">"** FOCUS &#26412;&#26085;&#12398;&#12481;&#12455;&#12483;&#12463;&#12522;&#12473;&#12488; %T\n&#65288;&#36215;&#24202;&#26178;&#38291;&#12398;&#35352;&#37682;&#65289;[[http://www.hayaoki-seikatsu.com/users/takaxp/][&#26089;&#36215;&#12365;&#26085;&#35352;]] \n&#65288;&#26397;&#39135;&#65289;\n  - [ ] %?\n&#65288;&#26172;&#39135;&#65289;\n&#65288;&#24112;&#23429;&#65295;&#22805;&#39135;&#65289;\n----\n&#65288;&#30740;&#31350;&#36895;&#22577;&#65289;\n  - [ ] \n"</span>)
            (<span style="color: #8b2252;">"i"</span> <span style="color: #8b2252;">"&#12450;&#12452;&#12487;&#12451;&#12450;&#12434;&#26360;&#12365;&#36796;&#12416;"</span> entry (file+headline ,org-default-notes-file <span style="color: #8b2252;">"INBOX"</span>)
             <span style="color: #8b2252;">"** %?\n  - \n\t%U"</span>)
            (<span style="color: #8b2252;">"b"</span> <span style="color: #8b2252;">"Create new post for imadenale blog"</span> entry
             (file+headline ,org-capture-blog-file ,(format-time-string <span style="color: #8b2252;">"%Y"</span>))
             <span style="color: #8b2252;">"** TODO \n:PROPERTIES:\n:EXPORT_FILE_NAME: %?\n:EXPORT_HUGO_TAGS: \n:EXPORT_HUGO_LASTMOD: \n:EXPORT_HUGO_IMAGES: \n:END:\n{{&lt; tweet user=\"takaxp\" id=\"\" &gt;}}\n"</span>)
            (<span style="color: #8b2252;">"B"</span> <span style="color: #8b2252;">"Create new post for imadenale blog (UUID)"</span> entry
             (file+headline ,org-capture-blog-file ,(format-time-string <span style="color: #8b2252;">"%Y"</span>))
             <span style="color: #8b2252;">"** TODO %?\n:PROPERTIES:\n:EXPORT_FILE_NAME: %(uuid-string)\n:EXPORT_HUGO_TAGS: \n:EXPORT_HUGO_LASTMOD: \n:EXPORT_HUGO_IMAGES: \n:END:\n{{&lt; tweet user=\"takaxp\" id=\"\" &gt;}}\n"</span>)
            <span style="color: #b22222;">;; </span><span style="color: #b22222;">("b" "Bug &#12479;&#12464;&#20184;&#12365;&#12398; TODO &#38917;&#30446;&#12434;&#36028;&#12426;&#20184;&#12369;&#12427;" entry</span>
            <span style="color: #b22222;">;;  </span><span style="color: #b22222;">(file+headline ,org-default-notes-file "INBOX")</span>
            <span style="color: #b22222;">;;  </span><span style="color: #b22222;">"** TODO %? :bug:\n %i\n %a %t")</span>
            (<span style="color: #8b2252;">"T"</span> <span style="color: #8b2252;">"&#26178;&#38291;&#20184;&#12365;&#12456;&#12531;&#12488;&#12522;&#12540;"</span> entry (file+headline ,org-default-notes-file <span style="color: #8b2252;">"INBOX"</span>)
             <span style="color: #8b2252;">"** %? %T--\n"</span>)
            (<span style="color: #8b2252;">"n"</span> <span style="color: #8b2252;">"&#12494;&#12540;&#12488;&#12392;&#12375;&#12390;INBOX&#12395;&#36028;&#12426;&#20184;&#12369;&#12427;"</span> entry
             (file+headline ,org-default-notes-file <span style="color: #8b2252;">"INBOX"</span>)
             <span style="color: #8b2252;">"** %? :note:\n\t%U"</span>)
            (<span style="color: #8b2252;">"D"</span> <span style="color: #8b2252;">"&#12300;&#12489;&#12521;&#12483;&#12459;&#12540;365&#12398;&#37329;&#35328;&#12301;&#12434;&#12494;&#12540;&#12488;&#12377;&#12427;"</span> entry
             (file+headline ,org-capture-notes-file <span style="color: #8b2252;">"The Daily Drucker"</span>)
             <span style="color: #8b2252;">"** &#12300;%?&#12301;\nDrucker) \n  - \n  - \nACTION POINT:\n  - \nQUESTION:\n  - \n"</span>)
            (<span style="color: #8b2252;">"r"</span> ,(concat <span style="color: #8b2252;">"&#30740;&#31350;&#12494;&#12540;&#12488;&#12434; "</span> org-capture-academic-file
                          <span style="color: #8b2252;">" &#12395;&#26360;&#12365;&#36796;&#12416;"</span>)
             entry (file+headline ,org-capture-academic-file <span style="color: #8b2252;">"Survey"</span>)
             <span style="color: #8b2252;">"** %? :note:\n# \n  - \n\t%U"</span>)
            (<span style="color: #8b2252;">"`"</span> ,(concat <span style="color: #8b2252;">"&#12494;&#12540;&#12488;&#12434;&#12496;&#12483;&#12501;&#12449; "</span> org-capture-buffer-file
                          <span style="color: #8b2252;">" &#12395;&#26360;&#12365;&#36796;&#12416;"</span>)
             entry (file+headline ,org-capture-buffer-file <span style="color: #8b2252;">"Buffers"</span>)
             <span style="color: #8b2252;">"** %(get-random-string 16) %U\n\n%?\n\n----"</span>)
            (<span style="color: #8b2252;">"w"</span> ,(concat <span style="color: #8b2252;">"&#33521;&#21336;&#35486;&#12434; "</span> org-capture-english-file
                          <span style="color: #8b2252;">" &#12395;&#26360;&#12365;&#36796;&#12416;"</span>) <span style="color: #ff0000; font-weight: bold;">entry</span>
                          (file+headline ,org-capture-english-file <span style="color: #8b2252;">"WORDS"</span>)
                          <span style="color: #8b2252;">"** %? :%(get-current-date-tags):\n&#12300;&#12301;\n  - "</span>)
            (<span style="color: #8b2252;">"g"</span> ,(concat <span style="color: #8b2252;">"&#33521;&#35486;&#12494;&#12540;&#12488;&#12434; "</span> org-capture-english-file
                          <span style="color: #8b2252;">" &#12395;&#26360;&#12365;&#36796;&#12416;"</span>)
             entry (file+headline ,org-capture-english-file <span style="color: #8b2252;">"GRAMMER"</span>)
             <span style="color: #8b2252;">"** %? :%(get-current-date-tags):\n\n%U"</span>)
            ))))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc3302e41" class="outline-3">
<h3 id="orgc3302e41"><span class="section-number-3">10.21.</span> [org-agenda] タスク／予定管理</h3>
<div class="outline-text-3" id="text-orgc3302e41">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-org-agenda-prepare-buffers</span> ()
  (<span style="color: #a020f0;">unless</span> (<span style="color: #a020f0;">featurep</span> '<span style="color: #008b8b;">org-agenda</span>)
    (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">org-agenda</span> nil t)
      (<span style="color: #a020f0;">unless</span> (<span style="color: #a020f0;">and</span> (<span style="color: #a020f0;">featurep</span> '<span style="color: #008b8b;">org-id</span>)
                   (<span style="color: #a020f0;">featurep</span> '<span style="color: #008b8b;">org-tempo</span>))
        (my-org-modules-activate)) <span style="color: #b22222;">;; </span><span style="color: #b22222;">FIXME</span>
      (<span style="color: #a020f0;">unless</span> (<span style="color: #a020f0;">featurep</span> '<span style="color: #008b8b;">ob-http</span>) (my-org-babel-load-activate)) <span style="color: #b22222;">;; </span><span style="color: #b22222;">FIXME</span>
      (org-agenda-prepare-buffers org-agenda-files)
      (message <span style="color: #8b2252;">"Building agenda buffers...done"</span>))))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-recenter-top-bottom-top</span> ()
  <span style="color: #8b2252;">"Recenter the current line to the top of window."</span>
  (set-window-start (get-buffer-window) (line-beginning-position)))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">`</span><span style="color: #008b8b;">org-agenda-prepare-buffers</span><span style="color: #b22222;">' &#12399;&#37325;&#12356;&#65294;agenda &#23455;&#34892;&#26178;&#12398;&#26368;&#21021;&#12395;&#36208;&#12427;&#12364;&#65292;</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">&#20107;&#21069;&#12395;&#36208;&#12425;&#12379;&#12390;&#12362;&#12367;&#12411;&#12358;&#12364;&#12356;&#12356;&#65294;&#20197;&#19979;&#12398;&#20363;&#12391;&#12399;&#65292;</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">&#36215;&#21205;&#24460;&#65292;&#20309;&#12418;&#12375;&#12394;&#12369;&#12428;&#12400;10&#31186;&#24460;&#12395; org, org-agenda &#12364;&#26377;&#21177;&#12395;&#12394;&#12427;</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">&#36215;&#21205;&#24460;&#65292;org buffer &#12434;&#35370;&#21839;&#12375;&#12390;&#65292;10&#31186;&#24453;&#12388;&#12392;&#65292;org-agenda &#12364;&#26377;&#21177;&#12395;&#12394;&#12427;</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">&#36215;&#21205;&#24460;&#65292;&#30452;&#25509; org-agenda &#12434;&#21481;&#12367;&#22580;&#21512;&#12399;&#37325;&#12356;&#12414;&#12414;&#65288;&#12479;&#12452;&#12510;&#12540;&#36208;&#12387;&#12390;&#12418;&#12473;&#12523;&#12540;&#65289;</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">&#12371;&#12428;&#12434; (with-eval-after-load "org") &#12398;&#20013;&#12395;&#32622;&#12367;&#12392;&#25391;&#12427;&#33310;&#12356;&#12364;&#22793;(2&#22238;&#23455;&#34892;)&#12395;&#12394;&#12427;</span>
(<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">my-org-agenda-pb-timer</span>
  (<span style="color: #a020f0;">unless</span> noninteractive
    (run-with-idle-timer (+ 9 my-default-loading-delay)
                         nil #'my-org-agenda-prepare-buffers)))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"org"</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#12450;&#12472;&#12455;&#12531;&#12480;&#20316;&#25104;&#23550;&#35937;&#65288;&#25351;&#23450;&#12375;&#12394;&#12356;&#12392;agenda&#12364;&#29983;&#25104;&#12373;&#12428;&#12394;&#12356;&#65289;</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#12371;&#12371;&#12434;&#38291;&#36949;&#12358;&#12392;&#65292;MobileOrg, iCal export &#12418;&#12358;&#12414;&#12367;&#12356;&#12363;&#12394;&#12356;</span>
  (<span style="color: #a020f0;">dolist</span> (file (mapcar
                 (<span style="color: #a020f0;">lambda</span> (arg)
                   (concat (getenv <span style="color: #8b2252;">"SYNCROOT"</span>) <span style="color: #8b2252;">"/org/"</span> arg))
                 '(<span style="color: #8b2252;">"org-ical.org"</span> <span style="color: #8b2252;">"next.org"</span> <span style="color: #8b2252;">"db/cooking.org"</span> <span style="color: #8b2252;">"minutes/wg1.org"</span>
                   <span style="color: #8b2252;">"db/daily.org"</span> <span style="color: #8b2252;">"db/trigger.org"</span>  <span style="color: #8b2252;">"academic.org"</span> <span style="color: #8b2252;">"tr/work.org"</span>
                   <span style="color: #8b2252;">"org2ja.org"</span> <span style="color: #8b2252;">"itr.org"</span>)))
    (<span style="color: #a020f0;">when</span> (file-exists-p (expand-file-name file))
      (add-to-list 'org-agenda-files file 'append)))
  (<span style="color: #a020f0;">when</span> (eq system-type 'windows-nt) <span style="color: #b22222;">;; </span><span style="color: #b22222;">FIXME</span>
    (<span style="color: #a020f0;">setq</span> org-agenda-files '(<span style="color: #8b2252;">"~/Dropbox/org/next.org"</span>))))

(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"org-agenda"</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">sorting strategy</span>
  (<span style="color: #a020f0;">setq</span> org-agenda-sorting-strategy
        '((agenda habit-down time-up timestamp-up priority-down category-keep)
          (todo priority-down category-keep)
          (tags priority-down category-keep)
          (search category-keep)))

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">Set the view span as day in an agenda view, the default is week</span>
  (<span style="color: #a020f0;">setq</span> org-agenda-span 'day)

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#12450;&#12472;&#12455;&#12531;&#12480;&#12395;&#35686;&#21578;&#12434;&#34920;&#31034;&#12377;&#12427;&#26399;&#38291;</span>
  (<span style="color: #a020f0;">setq</span> org-deadline-warning-days 0)

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#26178;&#38291;&#24133;&#12364;&#26126;&#31034;&#30340;&#12395;&#25351;&#23450;&#12373;&#12428;&#12394;&#12356;&#22580;&#21512;&#12398;&#12487;&#12501;&#12457;&#12523;&#12488;&#20516;&#65288;&#20998;&#25351;&#23450;&#65289;</span>
  (<span style="color: #a020f0;">setq</span> org-agenda-default-appointment-duration 60)

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#12450;&#12472;&#12455;&#12531;&#12480;&#12499;&#12517;&#12540;&#12391;FOLLOW&#12434;&#35373;&#23450;&#65288;&#33258;&#21205;&#30340;&#12395;&#21029;&#12496;&#12483;&#12501;&#12449;&#12395;&#24403;&#35442;&#12479;&#12473;&#12463;&#12434;&#34920;&#31034;&#65289;</span>
  (<span style="color: #a020f0;">setq</span> org-agenda-start-with-follow-mode t)

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">Customized Time Grid</span>
  (<span style="color: #a020f0;">setq</span> org-agenda-time-grid <span style="color: #b22222;">;; </span><span style="color: #b22222;">Format is changed from 9.1</span>
        '((daily today require-timed)
          (0800 1000 1200 1400 1600 1800 2000 2200 2400)
          <span style="color: #8b2252;">"......"</span>
          <span style="color: #8b2252;">"------------------------"</span>
          ))

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">(setq org-agenda-current-time-string "&lt;  d('- ' &#65394;&#65423;&#65402;&#65402;)")</span>
  (<span style="color: #a020f0;">setq</span> org-agenda-current-time-string <span style="color: #8b2252;">"&lt;&lt;&lt; &#65394;&#65423;&#65402;&#65402;"</span>)
  (<span style="color: #a020f0;">setq</span> org-agenda-timegrid-use-ampm t)

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">org-agenda &#34920;&#31034;&#12398;&#27700;&#24179;&#26041;&#21521;&#12398;&#20887;&#38263;&#12373;&#12434;&#21066;&#28187;</span>
  (<span style="color: #a020f0;">setq</span> org-agenda-prefix-format
        '((agenda  . <span style="color: #8b2252;">"%-9c| %?-12t% s"</span>)
          (todo  . <span style="color: #8b2252;">" %i %-12:c"</span>)
          (tags  . <span style="color: #8b2252;">" %i %-12:c"</span>)
          (search . <span style="color: #8b2252;">" %i %-12:c"</span>)))
  (<span style="color: #a020f0;">setq</span> org-agenda-remove-tags t)
  (<span style="color: #a020f0;">setq</span> org-agenda-scheduled-leaders '(<span style="color: #8b2252;">"[S]"</span> <span style="color: #8b2252;">"S.%2dx:\t"</span>))
  (<span style="color: #a020f0;">setq</span> org-agenda-deadline-leaders '(<span style="color: #8b2252;">"[D]"</span> <span style="color: #8b2252;">"In %3d d.:\t"</span> <span style="color: #8b2252;">"%2d d. ago:\t"</span>))

  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"moom"</span>
    (<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">my-org-tags-column</span> org-tags-column)
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">Expand the frame width temporarily during org-agenda is activated.</span>
    (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-agenda-frame-width</span> ()
      (<span style="color: #a020f0;">let</span> ((width (floor (* 1.2 moom-frame-width-single))))
        (<span style="color: #a020f0;">setq</span> org-tags-column (- org-tags-column (- width 80)))
        <span style="color: #b22222;">;; </span><span style="color: #b22222;">(org-align-tags t)</span>
        (moom-change-frame-width width)))
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">(add-hook 'org-agenda-mode-hook #'my-agenda-frame-width)</span>

    (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">ad:org-agenda--quit</span> (<span style="color: #228b22;">&amp;optional</span> _bury)
      (<span style="color: #a020f0;">setq</span> org-tags-column my-org-tags-column)
      <span style="color: #b22222;">;; </span><span style="color: #b22222;">(org-align-tags t)</span>
      (moom-change-frame-width))
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">(advice-add 'org-agenda--quit :after #'ad:org-agenda--quit)</span>
    )

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#31227;&#21205;&#30452;&#24460;&#12395;agenda&#12496;&#12483;&#12501;&#12449;&#12434;&#38281;&#12376;&#12427;&#65288;&#12484;&#12522;&#12540;&#12398;&#20869;&#23481;&#12399;SPACE&#12391;&#30906;&#35469;&#21487;&#65289;</span>
  (org-defkey org-agenda-mode-map [(tab)]
              (<span style="color: #a020f0;">lambda</span> () (<span style="color: #a020f0;">interactive</span>)
                (org-agenda-goto)
                (<span style="color: #a020f0;">with-current-buffer</span> <span style="color: #8b2252;">"*Org Agenda*"</span>
                  (org-agenda-quit))))

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">agenda &#12450;&#12452;&#12486;&#12512;&#12398;&#20869;&#23481;&#12434;&#21029;&#12496;&#12483;&#12501;&#12449;&#12395;&#34920;&#31034;&#12377;&#12427;&#26178;&#12395;&#65292;&#20869;&#23481;&#12398;&#20840;&#20307;&#12434;&#34920;&#31034;&#12377;&#12427;</span>
  (add-hook 'org-agenda-after-show-hook #'my-recenter-top-bottom-top)

  (custom-set-faces
   <span style="color: #b22222;">;; </span><span style="color: #b22222;">'(org-agenda-clocking ((t (:background "#300020"))))</span>
   '(org-agenda-structure ((t (<span style="color: #483d8b;">:underline</span> t <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#6873ff"</span>))))
   '(org-agenda-date-today ((t (<span style="color: #483d8b;">:weight</span> bold <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#4a6aff"</span>))))
   '(org-agenda-date ((t (<span style="color: #483d8b;">:weight</span> bold <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#6ac214"</span>))))
   '(org-agenda-date-weekend ((t (<span style="color: #483d8b;">:weight</span> bold <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#ff8d1e"</span>))))
   '(org-time-grid ((t (<span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#0a4796"</span>))))
   '(org-warning ((t (<span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#ff431a"</span>))))
   '(org-upcoming-deadline ((t (<span style="color: #483d8b;">:inherit</span> font-lock-keyword-face))))
   )

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#25152;&#23450;&#12398;&#26178;&#21051;&#12395;&#24375;&#21046;&#30340;&#12395;Agenda&#12434;&#34920;&#31034;</span>
  (<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">my-org-agenda-auto-popup-list</span>
    '(<span style="color: #8b2252;">"01:00"</span> <span style="color: #8b2252;">"11:00"</span> <span style="color: #8b2252;">"14:00"</span> <span style="color: #8b2252;">"17:00"</span> <span style="color: #8b2252;">"20:00"</span> <span style="color: #8b2252;">"23:00"</span>))
  (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-popup-agenda</span> ()
    (<span style="color: #a020f0;">interactive</span>)
    (<span style="color: #a020f0;">let</span> ((status use-dialog-box))
      (<span style="color: #a020f0;">setq</span> use-dialog-box nil)
      (<span style="color: #a020f0;">when</span> (y-or-n-p-with-timeout <span style="color: #8b2252;">"Popup agenda now?"</span> 10 nil)
        (org-agenda-list))
      (message <span style="color: #8b2252;">""</span>)
      (<span style="color: #a020f0;">setq</span> use-dialog-box status)))
  (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-popup-agenda-set-timers</span> ()
    (<span style="color: #a020f0;">interactive</span>)
    (cancel-function-timers 'my-popup-agenda)
    (<span style="color: #a020f0;">dolist</span> (triger my-org-agenda-auto-popup-list)
      (<span style="color: #a020f0;">when</span> (future-time-p triger)
        (run-at-time triger nil 'my-popup-agenda))))
  (my-popup-agenda-set-timers)
  (run-at-time <span style="color: #8b2252;">"24:00"</span> nil 'my-popup-agenda-set-timers)

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#12388;&#12356;&#12391;&#12395; calendar.app &#12418;&#23450;&#26399;&#30340;&#12395;&#24375;&#21046;&#36215;&#21205;&#12377;&#12427;</span>
  (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-popup-calendar</span> ()
    (<span style="color: #a020f0;">interactive</span>)
    (<span style="color: #a020f0;">if</span> (<span style="color: #a020f0;">and</span> (eq system-type 'darwin)
             (frame-focus-state))
        (shell-command-to-string <span style="color: #8b2252;">"open -a calendar.app"</span>)
      (message <span style="color: #8b2252;">"--- input focus is currently OUT."</span>)))

  (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-popup-calendar-set-timers</span> ()
    (<span style="color: #a020f0;">interactive</span>)
    (cancel-function-timers 'my-popup-calendar)
    (<span style="color: #a020f0;">dolist</span> (triger my-org-agenda-auto-popup-list)
      (<span style="color: #a020f0;">when</span> (future-time-p triger)
        (run-at-time triger nil 'my-popup-calendar))))

  (<span style="color: #a020f0;">when</span> (memq window-system '(mac ns))
    (my-popup-calendar-set-timers)
    (run-at-time <span style="color: #8b2252;">"24:00"</span> nil 'my-popup-calendar-set-timers))

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">org-agenda &#12391;&#12418; "d" &#25276;&#19979;&#12391; "DONE" &#12395;&#12377;&#12427;</span>
  (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-org-agenda-done</span> ()
    (<span style="color: #a020f0;">interactive</span>)
    (org-agenda-todo <span style="color: #8b2252;">"DONE"</span>)
    (my-org-agenda-to-appt)) <span style="color: #b22222;">;; </span><span style="color: #b22222;">call with async</span>
  (org-defkey org-agenda-mode-map <span style="color: #8b2252;">"d"</span> 'my-org-agenda-done)

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">org-agenda &#12398;&#34920;&#31034;&#39640;&#12373;&#12434; 50% &#12395;&#22266;&#23450;&#12377;&#12427;</span>
  (<span style="color: #a020f0;">setq</span> org-agenda-window-frame-fractions '(0.5 . 0.5)))

<span style="color: #b22222;">;; </span><span style="color: #b22222;">M-x calendar &#12398;&#21205;&#20316;&#12395;&#36817;&#12389;&#12369;&#12427;&#65294;&#12394;&#12362; today &#12408;&#12398;&#31227;&#21205;&#12399;&#65292;"C-." &#12391;&#21487;&#33021;&#65294;</span>
(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"org-keys"</span>
  (org-defkey org-read-date-minibuffer-local-map (kbd <span style="color: #8b2252;">"C-n"</span>)
              (<span style="color: #a020f0;">lambda</span> () (<span style="color: #a020f0;">interactive</span>)
                (org-eval-in-calendar '(calendar-forward-week 1))))
  (org-defkey org-read-date-minibuffer-local-map (kbd <span style="color: #8b2252;">"C-p"</span>)
              (<span style="color: #a020f0;">lambda</span> () (<span style="color: #a020f0;">interactive</span>)
                (org-eval-in-calendar '(calendar-backward-week 1))))
  (org-defkey org-read-date-minibuffer-local-map (kbd <span style="color: #8b2252;">"C-b"</span>)
              (<span style="color: #a020f0;">lambda</span> () (<span style="color: #a020f0;">interactive</span>)
                (org-eval-in-calendar '(calendar-backward-day 1))))
  (org-defkey org-read-date-minibuffer-local-map (kbd <span style="color: #8b2252;">"C-f"</span>)
              (<span style="color: #a020f0;">lambda</span> () (<span style="color: #a020f0;">interactive</span>)
                (org-eval-in-calendar '(calendar-forward-day 1))))
  (org-defkey org-read-date-minibuffer-local-map (kbd <span style="color: #8b2252;">"q"</span>)
              (<span style="color: #a020f0;">lambda</span> () (<span style="color: #a020f0;">interactive</span>)
                (org-eval-in-calendar '(minibuffer-keyboard-quit)))))
</pre>
</div>

<p>
入門者にとって <code>org-agenda</code> は簡単ではないので，無理に使わなくて良いと思います．Org Modeの動作に十分慣れたら戻ってくる程度で十分です．
</p>
</div>
</div>

<div id="outline-container-org735f32e3" class="outline-3">
<h3 id="org735f32e3"><span class="section-number-3">10.22.</span> [org-onit.el] org-clock-in の自動化</h3>
<div class="outline-text-3" id="text-org735f32e3">
<p>
<code>org-onit.el</code> を導入すると，タグを付けるタイミングで自動的に <code>org-clock-in</code> します．タグを取れば <code>org-clock-out</code> が実行されるようになります．
</p>

<ul class="org-ul">
<li><a href="https://github.com/takaxp/org-onit">https://github.com/takaxp/org-onit</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(org-onit-toggle-doing
                           org-onit-mode
                           org-onit-toggle-auto org-clock-goto
                           my-sparse-doing-tree org-onit-clock-in-when-unfold
                           org-clock-goto org-onit-update-options)
                         <span style="color: #8b2252;">"org-onit"</span> nil t)
  (global-set-key (kbd <span style="color: #8b2252;">"C-&lt;f11&gt;"</span>) 'org-clock-goto)

  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"org"</span>
    (add-hook 'org-cycle-hook #'org-onit-clock-in-when-unfold)
    (define-key org-mode-map (kbd <span style="color: #8b2252;">"&lt;f11&gt;"</span>) 'org-onit-toggle-doing)
    (define-key org-mode-map (kbd <span style="color: #8b2252;">"M-&lt;f11&gt;"</span>) 'org-onit-toggle-auto)
    (define-key org-mode-map (kbd <span style="color: #8b2252;">"S-&lt;f11&gt;"</span>) 'org-onit-goto-anchor)

    (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-sparse-doing-tree</span> ()
      (<span style="color: #a020f0;">interactive</span>)
      (org-tags-view nil org-onit-tag)))

  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"org-onit"</span>
    (autoload-if-found '(org-bookmark-jump org-bookmark-make-record)
                       <span style="color: #8b2252;">"org-bookmark-heading"</span> nil t)
    (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">org-plist</span> nil t)
      (add-to-list 'org-plist-dict '(<span style="color: #8b2252;">"OPTIONS_ONIT"</span> org-onit-basic-options)))
    (custom-set-variables
     '(org-onit-basic-options '(<span style="color: #483d8b;">:wakeup</span> nil <span style="color: #483d8b;">:nostate</span> doing <span style="color: #483d8b;">:unfold</span> nil))))

  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"org-clock"</span>
    (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-onit-reveal</span> ()
      <span style="color: #b22222;">;; </span><span style="color: #b22222;">(widen)</span>
      (org-overview)
      (org-reveal)
      (org-cycle-hide-drawers 'all)
      (org-show-entry)
      (show-children)
      (org-show-siblings))
    (add-hook 'org-onit-after-jump-hook #'my-onit-reveal)

    (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-clear-undo-list</span> ()
      (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">and</span> (fboundp 'org-clocking-p)
                 (org-clocking-p))
        (<span style="color: #a020f0;">setq</span> buffer-undo-list nil)))
    (add-hook 'org-clock-in-hook #'my-clear-undo-list) <span style="color: #b22222;">;; </span><span style="color: #b22222;">for testing...</span>

    (<span style="color: #a020f0;">setq</span> org-clock-clocked-in-display 'frame-title) <span style="color: #b22222;">;; </span><span style="color: #b22222;">or 'both</span>
    (<span style="color: #a020f0;">setq</span> org-clock-frame-title-format
          '((<span style="color: #483d8b;">:eval</span> (format <span style="color: #8b2252;">"%s%s |%s|%s"</span>
                           (<span style="color: #a020f0;">if</span> (<span style="color: #a020f0;">and</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">org-clock-today</span> nil t)
                                    org-clock-today-mode)
                               (<span style="color: #a020f0;">if</span> org-clock-today-count-subtree
                                   (format <span style="color: #8b2252;">"%s / %s"</span>
                                           org-clock-today-subtree-time
                                           org-clock-today-buffer-time)
                                 (format <span style="color: #8b2252;">"%s"</span> org-clock-today-buffer-time))
                             <span style="color: #8b2252;">""</span>)
                           (<span style="color: #a020f0;">if</span> org-onit--auto-clocking <span style="color: #8b2252;">" Auto "</span> <span style="color: #8b2252;">""</span>)
                           (org-onit-get-sign)
                           org-mode-line-string))
            <span style="color: #8b2252;">" - %b"</span>))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org20c40e77" class="outline-3">
<h3 id="org20c40e77"><span class="section-number-3">10.23.</span> [orgbox.el] スケジュール追加のわかりやすい入力</h3>
<div class="outline-text-3" id="text-org20c40e77">
<p>
<code>C-c C-s</code> をオーバーライドして <code>orgbox-schedule</code> を実行する．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(orgbox-schedule orgbox-agenda-schedule)
                         <span style="color: #8b2252;">"orgbox"</span> nil t)
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"org"</span>
    (org-defkey org-mode-map (kbd <span style="color: #8b2252;">"C-c C-s"</span>) 'orgbox-schedule))
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"org-agenda"</span>
    (org-defkey org-agenda-mode-map (kbd <span style="color: #8b2252;">"C-c C-s"</span>) 'orgbox-agenda-schedule)))
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">(require 'orgbox nil t)) ;; require org-agenda</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org5790e981" class="outline-3">
<h3 id="org5790e981"><span class="section-number-3">10.24.</span> [appt.el] アラーム設定</h3>
<div class="outline-text-3" id="text-org5790e981">
<ul class="org-ul">
<li>Growl や <a href="https://github.com/julienXX/terminal-notifier/releases">Terminal Notifier</a> と連携していると，Emacsがバックグラウンドにあってもアラームに気づける．</li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(global-set-key (kbd <span style="color: #8b2252;">"C-c f 3"</span>) #'my-org-agenda-to-appt)
(run-at-time <span style="color: #8b2252;">"20 sec"</span> nil #'my-org-agenda-to-appt)
<span style="color: #b22222;">;; </span><span style="color: #b22222;">(with-eval-after-load "org") &#20869;&#12391;&#35373;&#23450;&#12377;&#12427;&#12392;(&#20309;&#25925;&#12363;)&#35079;&#25968;&#22238;&#21628;&#12400;&#12428;&#12390;&#12375;&#12414;&#12358;&#65294;</span>
(run-with-idle-timer 180 t #'my-org-agenda-to-appt)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">org-agenda &#12398;&#20869;&#23481;&#12434;&#12450;&#12521;&#12540;&#12512;&#12395;&#30331;&#37682;&#12377;&#12427;</span>

<span style="color: #b22222;">;; </span><span style="color: #b22222;">&#37325;&#35079;&#23455;&#34892;&#12398;&#25233;&#21046;&#29992;&#12501;&#12521;&#12464;</span>
(<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">my-org-agenda-to-appt-ready</span> t)

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-org-agenda-to-appt</span> (<span style="color: #228b22;">&amp;optional</span> force)
  <span style="color: #8b2252;">"Update `</span><span style="color: #008b8b;">appt-time-mag-list</span><span style="color: #8b2252;">'.  Use `</span><span style="color: #008b8b;">async</span><span style="color: #8b2252;">' if possible."</span>
  (<span style="color: #a020f0;">interactive</span>)
  (<span style="color: #a020f0;">unless</span> (<span style="color: #a020f0;">featurep</span> '<span style="color: #008b8b;">org</span>)
    (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">org</span>))
  (<span style="color: #a020f0;">if</span> (<span style="color: #a020f0;">or</span> (not (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">async</span> nil t))
          (not my-org-agenda-to-appt-async))
      (<span style="color: #a020f0;">unless</span> (active-minibuffer-window)
        (org-agenda-to-appt t '((headline <span style="color: #8b2252;">"TODO"</span>)))
        (appt-check))
    (<span style="color: #a020f0;">when</span> force
      (<span style="color: #a020f0;">setq</span> my-org-agenda-to-appt-ready t))
    (<span style="color: #a020f0;">if</span> (not my-org-agenda-to-appt-ready)
        (message <span style="color: #8b2252;">"[appt] Locked"</span>)
      (<span style="color: #a020f0;">setq</span> my-org-agenda-to-appt-ready nil)
      <span style="color: #b22222;">;; </span><span style="color: #b22222;">(message "-------------------------")</span>
      <span style="color: #b22222;">;; </span><span style="color: #b22222;">(message "parent: %s"</span>
      <span style="color: #b22222;">;;          </span><span style="color: #b22222;">(format-time-string "%H:%M:%S.%3N" (current-time)))</span>
      (async-start
       `(<span style="color: #a020f0;">lambda</span> ()
          (<span style="color: #a020f0;">setq</span> load-path ',load-path)
          (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">org</span>)
          (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">appt</span>)
          (<span style="color: #a020f0;">setq</span> org-agenda-files ',org-agenda-files)
          (org-agenda-to-appt t '((headline <span style="color: #8b2252;">"TODO"</span>)))
          (appt-check) <span style="color: #b22222;">;; </span><span style="color: #b22222;">remove past events</span>
          <span style="color: #b22222;">;; </span><span style="color: #b22222;">Remove tags</span>
          (<span style="color: #a020f0;">let</span> ((msgs appt-time-msg-list))
            (<span style="color: #a020f0;">setq</span> appt-time-msg-list nil)
            (<span style="color: #a020f0;">dolist</span> (msg msgs)
              (add-to-list 'appt-time-msg-list
                           (<span style="color: #a020f0;">let</span> ((match (string-match
                                         org-tag-group-re (nth 1 msg))))
                             (<span style="color: #a020f0;">if</span> match
                                 (list (nth 0 msg)
                                       (org-trim (substring-no-properties
                                                  (nth 1 msg)
                                                  0 match))
                                       (nth 2 msg))
                               msg)
                             ) <span style="color: #ff0000; font-weight: bold;">t))</span>
            <span style="color: #b22222;">;; </span><span style="color: #b22222;">just for sure</span>
            (delq nil appt-time-msg-list)))
       `(<span style="color: #a020f0;">lambda</span> (result)
          <span style="color: #b22222;">;; </span><span style="color: #b22222;">(message "child: %s"</span>
          <span style="color: #b22222;">;;          </span><span style="color: #b22222;">(format-time-string "%H:%M:%S.%3N" (current-time)))</span>
          (<span style="color: #a020f0;">setq</span> appt-time-msg-list result) <span style="color: #b22222;">;; </span><span style="color: #b22222;">nil means No event</span>
          <span style="color: #b22222;">;; </span><span style="color: #b22222;">(my-add-prop-to-appt-time-msg-list)</span>
          (<span style="color: #a020f0;">unless</span> (active-minibuffer-window)
            (<span style="color: #a020f0;">let</span> ((cnt (length appt-time-msg-list))
                  (message-log-max nil))
              (<span style="color: #a020f0;">if</span> (eq cnt 0)
                  (message <span style="color: #8b2252;">"[async] No event to add"</span>)
                (message <span style="color: #8b2252;">"[async] Added %d event%s for today"</span>
                         cnt (<span style="color: #a020f0;">if</span> (&gt; cnt 1) <span style="color: #8b2252;">"s"</span> <span style="color: #8b2252;">""</span>)))))
          (<span style="color: #a020f0;">setq</span> my-org-agenda-to-appt-ready t))))))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(appt ad:appt-display-message
                                ad:appt-disp-window appt-check)
                         <span style="color: #8b2252;">"appt"</span> nil t)
  (<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">my-org-agenda-to-appt-async</span> t)
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"appt"</span>
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#12514;&#12540;&#12489;&#12521;&#12452;&#12531;&#12395;&#27531;&#12426;&#26178;&#38291;&#12434;&#34920;&#31034;&#12375;&#12394;&#12356;</span>
    (<span style="color: #a020f0;">setq</span> appt-display-mode-line nil)

    <span style="color: #b22222;">;; </span><span style="color: #b22222;">window &#12434; &#12501;&#12524;&#12540;&#12512;&#20869;&#12395;&#34920;&#31034;&#12377;&#12427;</span>
    (<span style="color: #a020f0;">setq</span> appt-display-format 'echo)

    <span style="color: #b22222;">;; </span><span style="color: #b22222;">window &#12434;&#32153;&#32154;&#34920;&#31034;&#12377;&#12427;&#26178;&#38291;[s]</span>
    (<span style="color: #a020f0;">setq</span> appt-display-duration 5)

    <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#12499;&#12540;&#12503;&#38899;&#12398;&#26377;&#28961;</span>
    (<span style="color: #a020f0;">setq</span> appt-audible nil)

    <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#20309;&#20998;&#21069;&#12363;&#12425;&#35686;&#21578;&#34920;&#31034;&#12434;&#38283;&#22987;&#12377;&#12427;&#12363;[m]</span>
    (<span style="color: #a020f0;">setq</span> appt-message-warning-time 10)

    <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#35686;&#21578;&#34920;&#31034;&#38283;&#22987;&#12363;&#12425;&#20309;&#20998;&#12372;&#12392;&#12395;&#12522;&#12510;&#12452;&#12531;&#12489;&#12377;&#12427;&#12363;[m]</span>
    (<span style="color: #a020f0;">setq</span> appt-display-interval 1)

    <span style="color: #b22222;">;; </span><span style="color: #b22222;">appt-display-format &#12364; 'echo &#12391;&#12418; appt-disp-window-function &#12434;&#21628;&#12406;</span>
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">Need review</span>
    (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">ad:appt-display-message</span> (string mins)
      <span style="color: #8b2252;">"Display a reminder about an appointment.</span>
<span style="color: #8b2252;">The string STRING describes the appointment, due in integer MINS minutes.</span>
<span style="color: #8b2252;">The arguments may also be lists, where each element relates to a</span>
<span style="color: #8b2252;">separate appointment.  The variable `</span><span style="color: #008b8b;">appt-display-format</span><span style="color: #8b2252;">' controls</span>
<span style="color: #8b2252;">the format of the visible reminder.  If `</span><span style="color: #008b8b;">appt-audible</span><span style="color: #8b2252;">' is non-nil,</span>
<span style="color: #8b2252;">also calls `</span><span style="color: #008b8b;">beep</span><span style="color: #8b2252;">' for an audible reminder."</span>
      (<span style="color: #a020f0;">if</span> appt-audible (beep 1))
      <span style="color: #b22222;">;; </span><span style="color: #b22222;">Backwards compatibility: avoid passing lists to a-d-w-f if not necessary.</span>
      (<span style="color: #a020f0;">and</span> (listp mins)
           (= (length mins) 1)
           (<span style="color: #a020f0;">setq</span> mins (car mins)
                 string (car string)))
      (<span style="color: #a020f0;">cond</span> ((memq appt-display-format '(window echo)) <span style="color: #b22222;">;; </span><span style="color: #b22222;">Modified</span>
             <span style="color: #b22222;">;; </span><span style="color: #b22222;">TODO use calendar-month-abbrev-array rather than %b?</span>
             (<span style="color: #a020f0;">let</span> ((time (format-time-string <span style="color: #8b2252;">"%a %b %e "</span>)))
               (<span style="color: #a020f0;">condition-case</span> err
                   (funcall appt-disp-window-function
                            (<span style="color: #a020f0;">if</span> (listp mins)
                                (mapcar #'number-to-string mins)
                              (number-to-string mins))
                            time string)
                 (wrong-type-argument
                  (<span style="color: #a020f0;">if</span> (not (listp mins))
                      (<span style="color: #ff0000; font-weight: bold;">signal</span> (car err) (cdr err))
                    (message <span style="color: #8b2252;">"Argtype error in `</span><span style="color: #008b8b;">appt-disp-window-function</span><span style="color: #8b2252;">' - \</span>
<span style="color: #8b2252;">update it for multiple appts?"</span>)
                    <span style="color: #b22222;">;; </span><span style="color: #b22222;">Fallback to just displaying the first appt, as we used to.</span>
                    (funcall appt-disp-window-function
                             (number-to-string (car mins)) time
                             (car string))))))
             (run-at-time (format <span style="color: #8b2252;">"%d sec"</span> appt-display-duration)
                          nil
                          appt-delete-window-function))
            ((eq appt-display-format 'echo) <span style="color: #b22222;">;; </span><span style="color: #b22222;">hidden</span>
             (message <span style="color: #8b2252;">"%s"</span> (<span style="color: #a020f0;">if</span> (listp string)
                               (mapconcat #'identity string <span style="color: #8b2252;">"\n"</span>)
                             string)))))

    (advice-add 'appt-display-message <span style="color: #483d8b;">:override</span> #'ad:appt-display-message)

    (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">ad:appt-disp-window</span> (min-to-app _new-time appt-msg)
      <span style="color: #8b2252;">"Extension to support appt-disp-window."</span>
      (<span style="color: #a020f0;">if</span> (string= min-to-app <span style="color: #8b2252;">"0"</span>)
          (my-desktop-notification <span style="color: #8b2252;">"### Expired! ###"</span> appt-msg t <span style="color: #8b2252;">"Glass"</span>)
        (my-desktop-notification
         (concat <span style="color: #8b2252;">"in "</span> min-to-app <span style="color: #8b2252;">" min."</span>) appt-msg nil <span style="color: #8b2252;">"Tink"</span>)))
    (<span style="color: #a020f0;">cond</span>
     ((eq appt-display-format 'echo)
      (<span style="color: #a020f0;">setq</span> appt-disp-window-function 'ad:appt-disp-window))
     ((eq appt-display-format 'window)
      (advice-add 'appt-disp-window <span style="color: #483d8b;">:before</span> #'ad:appt-disp-window))))

  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"ivy"</span>
    (<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">counsel-appt-time-msg-list</span> nil)
    (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">counsel-appt-list</span> ()
      <span style="color: #8b2252;">"Create a list of appt."</span>
      (<span style="color: #a020f0;">setq</span> counsel-appt-time-msg-list nil)
      (<span style="color: #a020f0;">when</span> (boundp 'appt-time-msg-list)
        (<span style="color: #a020f0;">dolist</span> (msg appt-time-msg-list)
          (<span style="color: #a020f0;">when</span> msg
            (add-to-list 'counsel-appt-time-msg-list
                         (substring-no-properties (nth 1 msg)) t))))
      counsel-appt-time-msg-list)

    (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">counsel-appt</span> ()
      <span style="color: #8b2252;">"List active appt."</span>
      (<span style="color: #a020f0;">interactive</span>)
      (ivy-read <span style="color: #8b2252;">"Appt: "</span>
                (counsel-appt-list)
                <span style="color: #483d8b;">:require-match</span> t
                <span style="color: #483d8b;">:caller</span> 'counsel-appt)))

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">(with-eval-after-load "org-agenda"</span>
  <span style="color: #b22222;">;;   </span><span style="color: #b22222;">(unless noninteractive</span>
  <span style="color: #b22222;">;;     </span><span style="color: #b22222;">(appt-activate 1)))</span>

  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"org"</span>
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#12461;&#12515;&#12503;&#12481;&#12515;&#30452;&#24460;&#12395;&#26356;&#26032;</span>
    (add-hook 'org-capture-before-finalize-hook #'my-org-agenda-to-appt)

    <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#12450;&#12472;&#12455;&#12531;&#12480;&#12434;&#38283;&#12356;&#12383;&#12425;&#12539;&#32066;&#20102;&#12375;&#12383;&#12425;&#12450;&#12521;&#12540;&#12512;&#12522;&#12473;&#12488;&#12434;&#26356;&#26032;</span>
    (<span style="color: #a020f0;">unless</span> noninteractive
      (add-hook 'org-agenda-mode-hook #'my-org-agenda-to-appt)
      (add-hook 'org-finalize-agenda-hook #'my-org-agenda-to-appt))

    <span style="color: #b22222;">;; </span><span style="color: #b22222;">org-agenda-to-appt &#12434;&#38750;&#21516;&#26399;&#12391;&#20351;&#12358;&#12383;&#12417;&#12398; advice</span>
    (<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">read-char-default-timeout</span> 10)
    (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">ad:read-char-exclusive</span> (f <span style="color: #228b22;">&amp;optional</span> PROMPT INHERIT-INPUT-METHOD SECONDS)
      (funcall f PROMPT INHERIT-INPUT-METHOD
               (<span style="color: #a020f0;">or</span> SECONDS read-char-default-timeout)))
    (advice-add 'read-char-exclusive <span style="color: #483d8b;">:around</span> #'ad:read-char-exclusive)

    (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">ad:org-check-agenda-file</span> (file)
      <span style="color: #8b2252;">"Make sure FILE exists.  If not, ask user what to do."</span>
      (<span style="color: #a020f0;">let</span> ((read-char-default-timeout 0)) <span style="color: #b22222;">;; </span><span style="color: #b22222;">not nil</span>
        (<span style="color: #a020f0;">unless</span> (file-exists-p file)
          (message <span style="color: #8b2252;">"Non-existent agenda file %s.  [R]emove from list or [A]bort?"</span>
                         (abbreviate-file-name file))
          (<span style="color: #a020f0;">let</span> ((r (downcase (<span style="color: #a020f0;">or</span> (read-char-exclusive) ?r))))
            (<span style="color: #a020f0;">cond</span>
             ((equal r ?r)
                    (org-remove-file file)
                    (<span style="color: #a020f0;">throw</span> '<span style="color: #008b8b;">nextfile</span> t))
             (t (<span style="color: #ff0000; font-weight: bold;">user-error</span> <span style="color: #8b2252;">"Abort"</span>)))))))
    (advice-add 'org-check-agenda-file <span style="color: #483d8b;">:override</span> #'ad:org-check-agenda-file)

    (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-add-prop-to-appt-time-msg-list</span> () <span style="color: #b22222;">;; </span><span style="color: #b22222;">FIXME</span>
      (<span style="color: #a020f0;">let</span> ((msgs appt-time-msg-list))
        (<span style="color: #a020f0;">setq</span> appt-time-msg-list nil)
        (<span style="color: #a020f0;">dolist</span> (msg msgs)
          (add-to-list 'appt-time-msg-list
                       (list (nth 0 msg)
                             (<span style="color: #a020f0;">let</span> ((str (nth 1 msg)))
                               (add-text-properties 6 10 '(org-heading t) str)
                               str)
                             (nth 2 msg))
                       ) <span style="color: #ff0000; font-weight: bold;">t)</span>
        <span style="color: #b22222;">;; </span><span style="color: #b22222;">just for sure</span>
        (delq nil appt-time-msg-list)))
    (<span style="color: #a020f0;">when</span> (eq window-system 'w32)
      (message <span style="color: #8b2252;">"--- my-org-agenda-to-appt-async was changed to nil for w32"</span>)
      (<span style="color: #a020f0;">setq</span> my-org-agenda-to-appt-async nil))

    (<span style="color: #a020f0;">when</span> noninteractive
      (<span style="color: #a020f0;">setq</span> my-org-agenda-to-appt-ready nil)) <span style="color: #b22222;">;; </span><span style="color: #b22222;">FIXME</span>
    ))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf5236175" class="outline-3">
<h3 id="orgf5236175"><span class="section-number-3">10.25.</span> [org-refile] orgツリーの高速移動</h3>
<div class="outline-text-3" id="text-orgf5236175">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"org"</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#12522;&#12501;&#12449;&#12452;&#12523;&#20808;&#12391;&#12469;&#12502;&#12487;&#12451;&#12524;&#12463;&#12488;&#12522;&#12434;&#25351;&#23450;&#12377;&#12427;&#12383;&#12417;&#12395;&#19968;&#37096;&#12501;&#12523;&#12497;&#12473;&#21270;</span>
  (<span style="color: #a020f0;">let</span> ((dir (expand-file-name org-directory)))
    (<span style="color: #a020f0;">setq</span> org-refile-targets
          `((,(concat dir <span style="color: #8b2252;">"next.org"</span>) <span style="color: #483d8b;">:level</span> . 1)
            (,(concat dir <span style="color: #8b2252;">"org-ical.org"</span>) <span style="color: #483d8b;">:level</span> . 1)
            (,(concat dir <span style="color: #8b2252;">"itr.org"</span>) <span style="color: #483d8b;">:level</span> . 1)
            (,(concat dir <span style="color: #8b2252;">"academic.org"</span>) <span style="color: #483d8b;">:level</span> . 1)
            (,(concat dir <span style="color: #8b2252;">"tr/work.org"</span>) <span style="color: #483d8b;">:level</span> . 1)
            (,(concat dir <span style="color: #8b2252;">"minutes/wg1.org"</span>) <span style="color: #483d8b;">:level</span> . 1)
            (,(concat dir <span style="color: #8b2252;">"db/article.org"</span>) <span style="color: #483d8b;">:level</span> . 1)
            (,(concat dir <span style="color: #8b2252;">"db/maybe.org"</span>) <span style="color: #483d8b;">:level</span> . 1)
            (,(concat dir <span style="color: #8b2252;">"db/english.org"</span>) <span style="color: #483d8b;">:level</span> . 1)
            (,(concat dir <span style="color: #8b2252;">"db/money.org"</span>) <span style="color: #483d8b;">:level</span> . 1))))

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#19981;&#35201;&#12394;&#23653;&#27508;&#12364;&#29983;&#25104;&#12373;&#12428;&#12427;&#12398;&#12434;&#25233;&#21046;&#12375;&#65292;&#24120;&#12395;&#26368;&#26032;&#12434;&#20445;&#12388;&#65294;</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">[2/3]&#12398;&#12424;&#12358;&#12394;&#23436;&#20102;&#25968;&#12364;&#35211;&#20986;&#12375;&#12395;&#12354;&#12427;&#26178;&#12395;&#36578;&#36865;&#20808;&#20505;&#35036;&#12364;&#37325;&#35079;&#34920;&#31034;&#12373;&#12428;&#12427;&#12383;&#12417;&#65294;</span>
  (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">ad:org-refile</span> (f <span style="color: #228b22;">&amp;optional</span> arg default-buffer rfloc msg)
    <span style="color: #8b2252;">"Extension to support keeping org-refile-history empty."</span>
    (<span style="color: #a020f0;">save-excursion</span>
      (<span style="color: #a020f0;">save-restriction</span>
        (<span style="color: #a020f0;">let</span> ((l (org-outline-level))
              (b (buffer-name)))
          (apply f arg default-buffer rfloc msg)
          (<span style="color: #a020f0;">if</span> (&gt; l (org-outline-level))
              (outline-backward-same-level 1)
            (outline-up-heading 1))
          (org-update-statistics-cookies nil) <span style="color: #b22222;">;; </span><span style="color: #b22222;">Update in source</span>
          <span style="color: #b22222;">;; </span><span style="color: #b22222;">(org-sort-entries nil ?O)</span>
          (org-refile-goto-last-stored)
          (org-update-parent-todo-statistics) <span style="color: #b22222;">;; </span><span style="color: #b22222;">Update in destination</span>
          (outline-up-heading 1)
          (org-sort-entries nil ?o)
          (<span style="color: #a020f0;">unless</span> (equal b (buffer-name))
            (switch-to-buffer b)))
        (<span style="color: #a020f0;">setq</span> org-refile-history nil)
        (org-refile-cache-clear))))
  (advice-add 'org-refile <span style="color: #483d8b;">:around</span> #'ad:org-refile)

  (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">ad:org-sort-entries</span> (<span style="color: #228b22;">&amp;optional</span> _with-case _sorting-type
                                        _getkey-func _compare-func
                                        _property _interactive?)
    (outline-hide-subtree)
    (org-show-hidden-entry)
    (org-show-children)
    (org-cycle-hide-drawers 'children))
  (advice-add 'org-sort-entries <span style="color: #483d8b;">:after</span> #'ad:org-sort-entries))
</pre>
</div>
</div>
</div>

<div id="outline-container-org49ca5eb9" class="outline-3">
<h3 id="org49ca5eb9"><span class="section-number-3">10.26.</span> [org-babel] Orgバッファでソースコードを扱う</h3>
<div class="outline-text-3" id="text-org49ca5eb9">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-org-babel-load-activate</span> ()
  (<span style="color: #a020f0;">if</span> (<span style="color: #a020f0;">featurep</span> '<span style="color: #008b8b;">ob-http</span>)
      (message <span style="color: #8b2252;">"org-babel language packages are previously loaded."</span>)
    (message <span style="color: #8b2252;">"Loading org-babel language packages..."</span>)
    (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">ob-http</span> nil t)
    (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">ob-gnuplot</span> nil t)
    (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">ob-octave</span> nil t)
    (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">ob-go</span> nil t)
    (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">ob-async</span> nil t)
    (custom-set-variables <span style="color: #b22222;">;; </span><span style="color: #b22222;">will call `</span><span style="color: #008b8b;">org-babel-do-load-languages</span><span style="color: #b22222;">'</span>
     '(org-babel-load-languages '((emacs-lisp . t)
                                  (dot . t)
                                  (C . t)
                                  (ditaa . t)
                                  (perl . t)
                                  (shell . t)
                                  (latex . t)
                                  (sqlite . t)
                                  (R . t)
                                  (python . t))))
    (message <span style="color: #8b2252;">"Loading org-babel language packages...done"</span>)))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"org"</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">will take 200[ms]</span>
  (<span style="color: #a020f0;">unless</span> noninteractive
    (run-with-idle-timer (+ 7 my-default-loading-delay)
                         nil #'my-org-babel-load-activate)))

(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"ob-src"</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#23455;&#35013;&#28168;&#12415;&#12398;&#35328;&#35486;&#12395;&#22909;&#12365;&#12394;&#21517;&#21069;&#12434;&#32016;&#20184;&#12369;&#12427;</span>
  (add-to-list 'org-src-lang-modes '(<span style="color: #8b2252;">"cs"</span> . csharp))
  (add-to-list 'org-src-lang-modes '(<span style="color: #8b2252;">"zsh"</span> . sh)))

(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"ob-core"</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">Suppress showing of "Indentation variables are now local."</span>
  (advice-add 'sh-make-vars-local <span style="color: #483d8b;">:around</span> #'ad:suppress-message)
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">Suppress showing of "Setting up indent for shell type zsh" and</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">"Indentation setup for shell type zsh"</span>
  (advice-add 'sh-set-shell <span style="color: #483d8b;">:around</span> #'ad:suppress-message)

  (<span style="color: #a020f0;">setq</span> org-edit-src-content-indentation 0)
  (<span style="color: #a020f0;">setq</span> org-src-fontify-natively t)
  (<span style="color: #a020f0;">setq</span> org-src-tab-acts-natively t)
  (<span style="color: #a020f0;">setq</span> org-confirm-babel-evaluate nil)
  (<span style="color: #a020f0;">setq</span> org-src-window-setup 'current-window)
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">org-src-window-setup (current-window, other-window, other-frame)</span>

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">ditta</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">(when (and (not noninteractive)</span>
  <span style="color: #b22222;">;;            </span><span style="color: #b22222;">(not (executable-find "ditaa")))</span>
  <span style="color: #b22222;">;;   </span><span style="color: #b22222;">(message "--- ditaa is NOT installed."))</span>

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">(my-org-babel-load-activate)</span>
  )
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc0ed68a2" class="outline-3">
<h3 id="orgc0ed68a2"><span class="section-number-3">10.27.</span> [org-babel] ソースブロックの入力キーをカスタマイズ</h3>
<div class="outline-text-3" id="text-orgc0ed68a2">
<p>
ソースブロックを入力するときは， &lt;+ <code>TAB</code> でテンプレートを高速に入力できます．しかし，利用する言語までは指定できないので，特定の内容について対応するコマンドを割り当てて起きます．以下の例を設定として追加すると， &lt;S+ <code>TAB</code> で <code>emacs-lisp</code> を， &lt;C+ <code>TAB</code> でコメントブロックを指定できます．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"org"</span>
  (add-to-list 'org-structure-template-alist
               (<span style="color: #a020f0;">if</span> (version&lt; <span style="color: #8b2252;">"9.1.4"</span> (org-version))
                   '(<span style="color: #8b2252;">"S"</span> . <span style="color: #8b2252;">"src emacs-lisp"</span>)
                 '(<span style="color: #8b2252;">"S"</span> <span style="color: #8b2252;">"#+begin_src emacs-lisp\n?\n#+END_SRC"</span> <span style="color: #8b2252;">"&lt;src lang=\"emacs-lisp\"&gt;\n\n&lt;/src&gt;"</span>))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org556eb376" class="outline-3">
<h3 id="org556eb376"><span class="section-number-3">10.28.</span> [org-babel] ソースブロックの配色</h3>
<div class="outline-text-3" id="text-org556eb376">
<p>
<code>org-src-block-faces</code>, <code>org-block-begin-line</code>, <code>org-block-end-line</code> をカスタマイズして，配色を変えます．さらに， <code>prettify-symbols-mode</code> を利用して <code>begin_src</code> と <code>end_src</code> の表示を別な文字列に変えます．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"org-src"</span>
  (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-org-src-block-face</span> ()
    (<span style="color: #a020f0;">setq</span> org-src-block-faces
          (<span style="color: #a020f0;">if</span> (eq 'light (frame-parameter nil 'background-mode))
              '((<span style="color: #8b2252;">"emacs-lisp"</span> (<span style="color: #483d8b;">:background</span> <span style="color: #8b2252;">"#F9F9F9"</span> <span style="color: #483d8b;">:extend</span> t))
                (<span style="color: #8b2252;">"conf"</span> (<span style="color: #483d8b;">:background</span> <span style="color: #8b2252;">"#F9F9F9"</span> <span style="color: #483d8b;">:extend</span> t))
                (<span style="color: #8b2252;">"org"</span> (<span style="color: #483d8b;">:background</span> <span style="color: #8b2252;">"#F9F9F9"</span> <span style="color: #483d8b;">:extend</span> t))
                (<span style="color: #8b2252;">"html"</span> (<span style="color: #483d8b;">:background</span> <span style="color: #8b2252;">"#F9F9F9"</span> <span style="color: #483d8b;">:extend</span> t)))
            '((<span style="color: #8b2252;">"emacs-lisp"</span> (<span style="color: #483d8b;">:background</span> <span style="color: #8b2252;">"#383c4c"</span> <span style="color: #483d8b;">:extend</span> t))
              (<span style="color: #8b2252;">"conf"</span> (<span style="color: #483d8b;">:background</span> <span style="color: #8b2252;">"#383c4c"</span> <span style="color: #483d8b;">:extend</span> t))
              (<span style="color: #8b2252;">"org"</span> (<span style="color: #483d8b;">:background</span> <span style="color: #8b2252;">"#383c4c"</span> <span style="color: #483d8b;">:extend</span> t))
              (<span style="color: #8b2252;">"html"</span> (<span style="color: #483d8b;">:background</span> <span style="color: #8b2252;">"#383c4c"</span> <span style="color: #483d8b;">:extend</span> t)))))
    (<span style="color: #a020f0;">dolist</span> (buffer (buffer-list))
      (<span style="color: #a020f0;">with-current-buffer</span> buffer
        (<span style="color: #a020f0;">when</span> (derived-mode-p 'org-mode)
          (font-lock-flush)))))
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">(my-org-src-block-face)</span>
  (add-hook 'ah-after-enable-theme-hook #'my-org-src-block-face)

  (custom-set-faces
   <span style="color: #b22222;">;; </span><span style="color: #b22222;">org-block &#12364;&#21177;&#12363;&#12394;&#12356;(2021-04-13@9.4.4)&#65292;org-src-block-faces &#12391;&#23550;&#24540;</span>
   <span style="color: #b22222;">;; </span><span style="color: #b22222;">'(org-block</span>
   <span style="color: #b22222;">;;   </span><span style="color: #b22222;">((((background dark)) (:background "#383c4c" :extend t)</span>
   <span style="color: #b22222;">;;     </span><span style="color: #b22222;">(t (:background "#F9F9F9" :extend t)))))</span>
   '(org-block-begin-line
     ((((background dark))
       (<span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#669966"</span> <span style="color: #483d8b;">:weight</span> bold)) <span style="color: #b22222;">;; </span><span style="color: #b22222;">:background "#444444"</span>
      (t (<span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#CC3333"</span> <span style="color: #483d8b;">:weight</span> bold)))) <span style="color: #b22222;">;; </span><span style="color: #b22222;">:background "#EFEFEF"</span>
   '(org-block-end-line
     ((((background dark)) (<span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#CC3333"</span> <span style="color: #483d8b;">:weight</span> bold))
      (t (<span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#669966"</span> <span style="color: #483d8b;">:weight</span> bold))))
   <span style="color: #b22222;">;; </span><span style="color: #b22222;">'(org-block-end-line</span>
   <span style="color: #b22222;">;;   </span><span style="color: #b22222;">((((background dark)) (:inherit org-block-begin-line))</span>
   <span style="color: #b22222;">;;    </span><span style="color: #b22222;">(t (:inherit org-block-begin-line))))</span>
   ))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(add-hook 'org-mode-hook 'prettify-symbols-mode)
(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"icons-in-terminal"</span>
  (<span style="color: #a020f0;">setq-default</span> prettify-symbols-alist '((<span style="color: #8b2252;">":PROPERTIES:"</span> . <span style="color: #8b2252;">"&#57798;"</span>) <span style="color: #b22222;">;;  </span><span style="color: #b22222;">&#187;</span>
                                         (<span style="color: #8b2252;">":LOGBOOK:"</span> . <span style="color: #8b2252;">"&#57802;"</span>) <span style="color: #b22222;">;;  </span><span style="color: #b22222;">&#8250;</span>
                                         (<span style="color: #8b2252;">":END:"</span> . <span style="color: #8b2252;">"&#57802;"</span>) <span style="color: #b22222;">;;  </span><span style="color: #b22222;">&#8250; </span>
                                         (<span style="color: #8b2252;">"#+begin_src"</span> . <span style="color: #8b2252;">"&#9640;"</span>) <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#57986;</span>
                                         (<span style="color: #8b2252;">"#+end_src"</span> . <span style="color: #8b2252;">"&#9640;"</span>)
                                         (<span style="color: #8b2252;">"#+RESULTS:"</span> . <span style="color: #8b2252;">"&#57634;"</span>)
                                         (<span style="color: #8b2252;">"[ ]"</span> .  <span style="color: #8b2252;">"&#57710;"</span>) <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#9744; &#58940;</span>
                                         (<span style="color: #8b2252;">"[X]"</span> . <span style="color: #8b2252;">"&#57635;"</span> ) <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#9745; &#58939;</span>
                                         (<span style="color: #8b2252;">"[-]"</span> . <span style="color: #8b2252;">"&#57864;"</span> )))) <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#9746; &#59128; </span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org89c34f23" class="outline-3">
<h3 id="org89c34f23"><span class="section-number-3">10.29.</span> [org-tree-slide] Org Modeでプレゼンテーション</h3>
<div class="outline-text-3" id="text-org89c34f23">
<p>
パワーポイントはもう使わなくてよいのです．
</p>

<ul class="org-ul">
<li><a href="https://pxaka.tokyo/wiki/doku.php?id=emacs:org-tree-slide">https://pxaka.tokyo/wiki/doku.php?id=emacs:org-tree-slide</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(org-tree-slide-mode)
                         <span style="color: #8b2252;">"org-tree-slide"</span> nil t)
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"postpone"</span>
    (global-set-key (kbd <span style="color: #8b2252;">"&lt;f8&gt;"</span>) 'org-tree-slide-mode)
    (global-set-key (kbd <span style="color: #8b2252;">"S-&lt;f8&gt;"</span>) 'org-tree-slide-skip-done-toggle))

  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"org-tree-slide"</span>
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">&lt;f8&gt;/&lt;f9&gt;/&lt;f10&gt;/&lt;f11&gt; are assigned to control org-tree-slide</span>
    (define-key org-tree-slide-mode-map (kbd <span style="color: #8b2252;">"&lt;f9&gt;"</span>)
      'org-tree-slide-move-previous-tree)
    (define-key org-tree-slide-mode-map (kbd <span style="color: #8b2252;">"&lt;f10&gt;"</span>)
      'org-tree-slide-move-next-tree)
    (<span style="color: #a020f0;">unless</span> noninteractive
      (org-tree-slide-narrowing-control-profile))
    (<span style="color: #a020f0;">setq</span> org-tree-slide-modeline-display 'outside)
    (<span style="color: #a020f0;">setq</span> org-tree-slide-skip-outline-level 5)
    (<span style="color: #a020f0;">setq</span> org-tree-slide-skip-done nil)))
</pre>
</div>

<p>
<code>Doing</code> タグのトグルに <code>f11</code> を割り当てたので，コンテンツモードへの切り替えは，異なるキーバインドに変更．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">#+begin_src emacs-lisp <span style="color: #483d8b;">:results</span> silent
(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"org-tree-slide"</span>
  (org-tree-slide-presentation-profile))
#+end_src
</pre>
</div>

<p>
これをプレゼンのヘッダに置いておけば，プロファイルの切り替えに便利です．
</p>
</div>

<div id="outline-container-org2e94f804" class="outline-4">
<h4 id="org2e94f804"><span class="section-number-4">10.29.1.</span> doom-modeline との共存</h4>
<div class="outline-text-4" id="text-org2e94f804">
<p>
<code>doom-modeline</code> では <code>widen</code> を <code>advice</code> で拡張していますが， <code>org-tree-slide</code> から抜ける時に期待された効果が得られず， <code>narrowing</code> 状態を表すアイコンがモードロインに残ってしまいます．そこで <code>org-tree-slide-stop-hook</code> で明示的に処理します．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"org-tree-slide"</span>
  (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">and</span> (eq my-toggle-modeline-global 'doom)
             (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">doom-modeline</span> nil t))
    (add-hook 'org-tree-slide-stop-hook
              #'doom-modeline-update-buffer-file-state-icon)))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org264a37c5" class="outline-3">
<h3 id="org264a37c5"><span class="section-number-3">10.30.</span> [org-tree-slide] クロックインとアウトを自動化する</h3>
<div class="outline-text-3" id="text-org264a37c5">
<p>
特定のファイルを編集している時， <code>org-tree-slide</code> でフォーカスしたら <code>org-clock-in</code> で時間計測を始めて，ナローイングを解く時や次のツリーに移る時に <code>org-clock-out</code> で計測を停止するように設定しています．基本的に <code>org-tree-slide</code> にあるhookに色々とぶら下げるだけです．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"org-tree-slide"</span>
  (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-tree-slide-autoclockin-p</span> ()
    (<span style="color: #a020f0;">save-excursion</span>
      (<span style="color: #a020f0;">save-restriction</span>
        (widen)
        (goto-char (point-min))
        (<span style="color: #a020f0;">let</span> ((keyword <span style="color: #8b2252;">"TREE_SLIDE:"</span>)
              (value <span style="color: #8b2252;">"autoclockin"</span>)
              (result nil))
          (<span style="color: #a020f0;">while</span>
              (<span style="color: #a020f0;">and</span> (re-search-forward (concat <span style="color: #8b2252;">"^#\\+"</span> keyword <span style="color: #8b2252;">"[ \t]*"</span>) nil t)
                   (re-search-forward value (point-at-eol) t))
            (<span style="color: #a020f0;">setq</span> result t))
          result))))

  (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">org-clock</span> nil t)
    (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-org-clock-in</span> ()
      (<span style="color: #a020f0;">unless</span> (<span style="color: #a020f0;">bound-and-true-p</span> doom-modeline-mode)
        (<span style="color: #a020f0;">setq</span> vc-display-status nil)) <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#12514;&#12540;&#12489;&#12521;&#12452;&#12531;&#31680;&#32004;</span>
      (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">and</span> (my-tree-slide-autoclockin-p)
                 (looking-at (concat <span style="color: #8b2252;">"^\\*+ "</span> org-not-done-regexp))
                 (memq (org-outline-level) '(1 2 3 4)))
        (<span style="color: #a020f0;">save-excursion</span>
          (<span style="color: #a020f0;">save-restriction</span>
            (forward-line)
            (<span style="color: #a020f0;">when</span> (org-at-heading-p)
              (newline)))) <span style="color: #b22222;">;; </span><span style="color: #b22222;">FIXME: remove empty line if clock will not be recorded.</span>
        (org-clock-in)))

    (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-org-clock-out</span> ()
      (<span style="color: #a020f0;">setq</span> vc-display-status t) <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#12514;&#12540;&#12489;&#12521;&#12452;&#12531;&#31680;&#32004;&#35299;&#38500;</span>
      (<span style="color: #a020f0;">when</span> (org-clocking-p)
        (org-clock-out)))

    (add-hook 'org-tree-slide-before-move-next-hook #'my-org-clock-out)
    (add-hook 'org-tree-slide-before-move-previous-hook #'my-org-clock-out)
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">(add-hook 'org-tree-slide-before-content-view-hook #'my-org-clock-out)</span>
    (add-hook 'org-tree-slide-stop-hook #'my-org-clock-out)
    (add-hook 'org-tree-slide-after-narrow-hook #'my-org-clock-in)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orga7162e8c" class="outline-3">
<h3 id="orga7162e8c"><span class="section-number-3">10.31.</span> [org-tree-slide] 特定のツリーをプロポーショナルフォントで表示する</h3>
<div class="outline-text-3" id="text-orga7162e8c">
<p>
ツリーのプロパティに，プロポーショナルで表示するか否かの制御フラグを加えます．ツリーにフォーカス時に <code>PROPORTIONAL</code> 指定がプロパティにあると，そのツリーを動的にプロポーショナルフォントでレンダリングします．変更は下位ツリーの全てに継承しています．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(org-tree-slide-mode my-toggle-proportional-font)
                         <span style="color: #8b2252;">"org-tree-slide"</span> nil t)
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"org-tree-slide"</span>
    (<span style="color: #a020f0;">defcustom</span> <span style="color: #a0522d;">use-proportional-font</span> nil
      <span style="color: #8b2252;">"The status of FONT property"</span>
      <span style="color: #483d8b;">:type</span> 'boolean
      <span style="color: #483d8b;">:group</span> 'org-mode)

    (set-face-attribute 'variable-pitch nil
                        <span style="color: #483d8b;">:family</span> <span style="color: #8b2252;">"Verdana"</span>
                        <span style="color: #b22222;">;; </span><span style="color: #b22222;">:family "Comic Sans MS"</span>
                        <span style="color: #483d8b;">:height</span> 125)

    (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-toggle-proportional-font</span> ()
      (<span style="color: #a020f0;">interactive</span>)
      (<span style="color: #a020f0;">setq</span> use-proportional-font (not use-proportional-font))
      (<span style="color: #a020f0;">if</span> use-proportional-font
          (org-entry-put nil <span style="color: #8b2252;">"FONT"</span> <span style="color: #8b2252;">"PROPORTIONAL"</span>)
        (org-delete-property <span style="color: #8b2252;">"FONT"</span>)))

    (add-hook 'org-tree-slide-before-narrow-hook
              (<span style="color: #a020f0;">lambda</span> ()
                  (<span style="color: #a020f0;">if</span> (equal <span style="color: #8b2252;">"PROPORTIONAL"</span>
                             (org-entry-get-with-inheritance <span style="color: #8b2252;">"FONT"</span>))
                      (buffer-face-set 'variable-pitch)
                    (buffer-face-mode 0))))
    (add-hook 'org-tree-slide-stop-hook
              (<span style="color: #a020f0;">lambda</span> ()
                  (buffer-face-mode 0)))))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf5c603e5" class="outline-3">
<h3 id="orgf5c603e5"><span class="section-number-3">10.32.</span> [org-tree-slide] ヘッドラインをリッチにする</h3>
<div class="outline-text-3" id="text-orgf5c603e5">
<p>
<code>org-tree-slide</code> が有効な時だけ <code>org-bullets</code> を有効にして，ヘッドラインをリッチにします．元ネタは， <code>org-beautify-theme.el</code> です．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(org-bullets-mode)
                         <span style="color: #8b2252;">"org-bullets"</span> nil t)
  (add-hook 'org-tree-slide-play-hook (<span style="color: #a020f0;">lambda</span> () (org-bullets-mode 1)))
  (add-hook 'org-tree-slide-stop-hook (<span style="color: #a020f0;">lambda</span> () (org-bullets-mode -1))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org639ece0e" class="outline-3">
<h3 id="org639ece0e"><span class="section-number-3">10.33.</span> [org-tree-slide] 一時的に #+ATTR_ORG などを非表示にする</h3>
<div class="outline-text-3" id="text-org639ece0e">
<p>
プレゼンテーション実行時に，制御コードが記述されている <code>#+ATTR_ORG</code> などの行を非表示（背景と同じ色）にします．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">my-hide-org-meta-line-p</span> nil)
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-hide-org-meta-line</span> ()
  (<span style="color: #a020f0;">interactive</span>)
  (<span style="color: #a020f0;">setq</span> my-hide-org-meta-line-p t)
  (set-face-attribute 'org-meta-line nil
                                        <span style="color: #483d8b;">:foreground</span> (face-attribute 'default <span style="color: #483d8b;">:background</span>)))
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-show-org-meta-line</span> ()
  (<span style="color: #a020f0;">interactive</span>)
  (<span style="color: #a020f0;">setq</span> my-hide-org-meta-line-p nil)
  (set-face-attribute 'org-meta-line nil <span style="color: #483d8b;">:foreground</span> nil))

(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-toggle-org-meta-line</span> ()
  (<span style="color: #a020f0;">interactive</span>)
  (<span style="color: #a020f0;">if</span> my-hide-org-meta-line-p
            (my-show-org-meta-line) (my-hide-org-meta-line)))

(add-hook 'org-tree-slide-play-hook #'my-hide-org-meta-line)
(add-hook 'org-tree-slide-stop-hook #'my-show-org-meta-line)

<span style="color: #b22222;">;; </span><span style="color: #b22222;">Option</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-update-org-meta-line</span> ()
  (<span style="color: #a020f0;">interactive</span>)
  (<span style="color: #a020f0;">when</span> my-hide-org-meta-line-p
    (my-hide-org-meta-line)))
(add-hook 'ah-after-enable-theme-hook #'my-update-org-meta-line)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgae555619" class="outline-3">
<h3 id="orgae555619"><span class="section-number-3">10.34.</span> [calfw-org.el] calfw に org の予定を表示する</h3>
<div class="outline-text-3" id="text-orgae555619">
<p>
org-mode の表のようにフェイスを統一しています． <code>calfw</code> を起動する時に，自動的にフレームサイズを拡大するような独自関数をぶら下げています．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">init-org.el</span>
(<span style="color: #a020f0;">when</span> (autoload-if-found '(my-cfw-open-org-calendar cfw:open-org-calendar)
                         <span style="color: #8b2252;">"calfw-org"</span> <span style="color: #8b2252;">"Rich calendar for org-mode"</span> t)
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"postpone"</span>
    (global-set-key (kbd <span style="color: #8b2252;">"C-c f c w"</span>) 'my-cfw-open-org-calendar))
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"calfw-org"</span>
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">icalendar &#12392;&#12398;&#36899;&#32080;</span>
    (custom-set-variables
     '(cfw:org-icalendars '(<span style="color: #8b2252;">"~/Dropbox/org/org-ical.org"</span>))
     '(cfw:fchar-junction ?+) <span style="color: #b22222;">;; </span><span style="color: #b22222;">org &#12391;&#20351;&#12358;&#34920;&#12395;&#12501;&#12455;&#12452;&#12473;&#12434;&#32113;&#19968;</span>
     '(cfw:fchar-vertical-line ?|)
     '(cfw:fchar-horizontal-line ?-)
     '(cfw:fchar-left-junction ?|)
     '(cfw:fchar-right-junction ?|)
     '(cfw:fchar-top-junction ?+)
     '(cfw:fchar-top-left-corner ?|)
     '(cfw:fchar-top-right-corner ?|))

    (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-org-mark-ring-goto-calfw</span> ()
      (<span style="color: #a020f0;">interactive</span>)
      (org-mark-ring-goto))

    (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-cfw-open-org-calendar</span> ()
      (<span style="color: #a020f0;">interactive</span>)
      (moom-change-frame-width-double)
      (cfw:open-org-calendar))

    (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-cfw-burry-buffer</span> ()
      (<span style="color: #a020f0;">interactive</span>)
      (bury-buffer)
      (moom-change-frame-width-single))

    (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">cfw:org-goto-date</span> ()
      <span style="color: #8b2252;">"Move the cursor to the specified date."</span>
      (<span style="color: #a020f0;">interactive</span>)
      (cfw:navi-goto-date
       (cfw:emacs-to-calendar (org-read-date nil 'to-time))))

    (define-key cfw:calendar-mode-map (kbd <span style="color: #8b2252;">"j"</span>) 'cfw:org-goto-date)
    (define-key cfw:org-schedule-map (kbd <span style="color: #8b2252;">"q"</span>) 'my-cfw-burry-buffer)))

<span style="color: #b22222;">;;         </span><span style="color: #b22222;">(add-hook 'window-configuration-change-hook #'cfw:resize-calendar)</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">(defun cfw:resize-calendar ()</span>
<span style="color: #b22222;">;;   </span><span style="color: #b22222;">(interactive)</span>
<span style="color: #b22222;">;;   </span><span style="color: #b22222;">(when (eq major-mode 'cfw:calendar-mode)</span>
<span style="color: #b22222;">;;     </span><span style="color: #b22222;">(cfw:refresh-calendar-buffer nil)</span>
<span style="color: #b22222;">;;     </span><span style="color: #b22222;">(message "Calendar resized.")))</span>

<span style="color: #b22222;">;; </span><span style="color: #b22222;">(defun open-calfw-agenda-org ()</span>
<span style="color: #b22222;">;;   </span><span style="color: #b22222;">(interactive)</span>
<span style="color: #b22222;">;;   </span><span style="color: #b22222;">(cfw:open-org-calendar))</span>

<span style="color: #b22222;">;; </span><span style="color: #b22222;">(setq org-agenda-custom-commands</span>
<span style="color: #b22222;">;;       </span><span style="color: #b22222;">'(("w" todo "FOCUS")</span>
<span style="color: #b22222;">;;         </span><span style="color: #b22222;">("G" open-calfw-agenda-org "Graphical display in calfw"))))))</span>

</pre>
</div>
</div>
</div>

<div id="outline-container-org02100a39" class="outline-3">
<h3 id="org02100a39"><span class="section-number-3">10.35.</span> [org-odt] ODT形式に出力</h3>
<div class="outline-text-3" id="text-org02100a39">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(ox-odt)
                         <span style="color: #8b2252;">"ox-odt"</span> nil t)
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"ox-odt"</span>
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">(add-to-list 'org-odt-data-dir</span>
    <span style="color: #b22222;">;;              </span><span style="color: #b22222;">(concat (getenv "HOME") "/Dropbox/emacs.d/config/"))</span>
    (<span style="color: #a020f0;">setq</span> org-odt-styles-file
          (concat (getenv <span style="color: #8b2252;">"SYNCROOT"</span>) <span style="color: #8b2252;">"/emacs.d/config/style.odt"</span>))
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">(setq org-odt-content-template-file</span>
    <span style="color: #b22222;">;;       </span><span style="color: #b22222;">(concat (getenv "HOME") "/Dropbox/emacs.d/config/style.ott"))</span>
    (<span style="color: #a020f0;">setq</span> org-odt-preferred-output-format <span style="color: #8b2252;">"pdf"</span>) <span style="color: #b22222;">;; </span><span style="color: #b22222;">docx</span>
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">;; ox-odt.el &#12398; &#33258;&#20316;&#12497;&#12483;&#12481;&#12398;&#22793;&#25968;&#65288;DOCSTRING&#12364;&#35352;&#36848;&#12373;&#12428;&#12390;&#12356;&#12394;&#12356;&#65289;</span>
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">(setq org-odt-apply-custom-punctuation t)</span>
    (<span style="color: #a020f0;">setq</span> org-odt-convert-processes
          '((<span style="color: #8b2252;">"LibreOffice"</span>
             <span style="color: #8b2252;">"/Applications/LibreOffice.app/Contents/MacOS/soffice --headless --convert-to %f%x --outdir %d %i"</span>)
            (<span style="color: #8b2252;">"unoconv"</span> <span style="color: #8b2252;">"unoconv -f %f -o %d %i"</span>)))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org02d2c3de" class="outline-3">
<h3 id="org02d2c3de"><span class="section-number-3">10.36.</span> [ox-twbs] Twitter Bootstrap 互換のHTML出力</h3>
<div class="outline-text-3" id="text-org02d2c3de">
<ul class="org-ul">
<li><a href="https://github.com/marsmining/ox-twbs">marsmining/ox-twbs: Export org-mode docs as HTML compatible with Twitter Bootstrap.</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"ox"</span>
  (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">ox-twbs</span> nil t))
</pre>
</div>

<p>
次のようなファイルを準備して org ファイルのヘッダで指定（ <code>#+setupfile: theme-readtheorg.setup</code> ）するだけで， <a href="https://takaxp.github.io/">https://takaxp.github.io/</a> のような HTML 出力もできます．
</p>

<ul class="org-ul">
<li><a href="https://lists.gnu.org/archive/html/emacs-orgmode/2016-06/msg00119.html">{O} Org HTML export (ReadTheOrg)</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-org" id="orgb8eb8f5"><span style="color: #b22222;"># -*- mode: org; -*-</span>
<span style="color: #b22222;">#+html_head: &lt;link rel="stylesheet" type="text/css" href="<a href="https://www.pirilampo.org/styles/readtheorg/css/htmlize.css&quot;/">https://www.pirilampo.org/styles/readtheorg/css/htmlize.css"/</a>&gt;</span>
<span style="color: #b22222;">#+html_head: &lt;link rel="stylesheet" type="text/css" href="<a href="https://www.pirilampo.org/styles/readtheorg/css/readtheorg.css&quot;/">https://www.pirilampo.org/styles/readtheorg/css/readtheorg.css"/</a>&gt;</span>

<span style="color: #b22222;">#+html_head: &lt;script src="<a href="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js">https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js</a>"&gt;&lt;/script&gt;</span>
<span style="color: #b22222;">#+html_head: &lt;script src="<a href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js">https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js</a>"&gt;&lt;/script&gt;</span>
<span style="color: #b22222;">#+html_head: &lt;script type="text/javascript" src="<a href="https://www.pirilampo.org/styles/lib/js/jquery.stickytableheaders.min.js">https://www.pirilampo.org/styles/lib/js/jquery.stickytableheaders.min.js</a>"&gt;&lt;/script&gt;</span>
<span style="color: #b22222;">#+html_head: &lt;script type="text/javascript" src="<a href="https://www.pirilampo.org/styles/readtheorg/js/readtheorg.js">https://www.pirilampo.org/styles/readtheorg/js/readtheorg.js</a>"&gt;&lt;/script&gt;</span>
</pre>
</div>

<p>
また， <code>(org-html-htmlize-generate-css)</code> を使うとCSSを生成できます．
</p>
</div>
</div>

<div id="outline-container-org5a1cb1a1" class="outline-3">
<h3 id="org5a1cb1a1"><span class="section-number-3">10.37.</span> [org-crypt] ツリーを暗号化する</h3>
<div class="outline-text-3" id="text-org5a1cb1a1">
<p>
<code>M-x org-encrypt-entry</code> でカーソル位置のツリーを暗号化できます．復号は， <code>M-x org-decrypt-entry</code> にて．ただし，バッファのバックアップファイルが生成されていることに気をつけてください．自分の場合は，バックアップファイルは外部ホストに同期されない設定にしてあるので，とりあえず問題なしと考えています．
</p>

<p>
<code>M-x org-encrypt-entries</code> で，特定のタグが付けられたツリーを一括処理することもできますが，私は安全性を考慮して使っていません．
</p>

<p>
なお，実戦投入には十分なテストをしてからの方がよいでしょう．org バッファを外部ホストと同期している場合，転送先のホストでも暗号化／復号ができるかを確認するべきです．他方のホストでツリーにドロワーが付くと，復号できなくなったりします．その時は慌てずにプロパティのドロワーを削除すればOKです．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"org"</span>
  (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">org-crypt</span> nil t)
    (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">epa</span>)
    (<span style="color: #a020f0;">setq</span> org-crypt-key <span style="color: #8b2252;">""</span>) <span style="color: #b22222;">;; </span><span style="color: #b22222;">&lt;insert your key&gt;</span>
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">org-encrypt-entries &#12398;&#24433;&#38911;&#12434;&#21463;&#12369;&#12427;&#12479;&#12464;&#12434;&#25351;&#23450;</span>
    (<span style="color: #a020f0;">setq</span> org-tags-exclude-from-inheritance (<span style="color: #a020f0;">quote</span> (<span style="color: #8b2252;">"secret"</span>)))
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#33258;&#21205;&#20445;&#23384;&#12398;&#30906;&#35469;&#12434;&#28961;&#21177;&#12395;</span>
    (<span style="color: #a020f0;">setq</span> org-crypt-disable-auto-save 'nil)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org01951291" class="outline-3">
<h3 id="org01951291"><span class="section-number-3">10.38.</span> [org-mac-link] 外部アプリから情報を取る</h3>
<div class="outline-text-3" id="text-org01951291">
<p>
<code>org-mac-link</code> を使うと，外部アプリの表示状態をリンクとして取得して，orgバッファに流し込めます．Mac環境用です．簡単な例ではURLで，取得したリンクを <code>C-c C-o</code> で開けばブラウザが起動してリンク先が表示できます．同じ話を，ファインダーで表示しているディレクトリ，メーラーで表示していた特定のメール，PDFビューアで表示していた特定のファイルの特定のページなどで実施できます．対応している外部アプリは，Finder, Mail.app, Outlook, Addressbook, Safari, Firefox, Chrome, そして Skimです．
</p>

<p>
次のように設定すると，org-modeの時に <code>C-c c</code> すればミニバッファにどのアプリからリンク情報を取るか選べます．Chrome には <code>c</code> が当たっているので，ブラウジング中に記になる記事があったらEmacsに切り替えて， <code>C-c c c</code> とすると，URLが自動でバッファに入ります．単なるURLではなく，タイトルで表示されるのでわかりやすいです．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"org"</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">(add-to-list 'org-modules 'org-mac-iCal)</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">(add-to-list 'org-modules 'org-mac-link) ;; includes org-mac-message</span>

  (autoload 'org-mac-link-get-link <span style="color: #8b2252;">"org-mac-link"</span> nil t)
  (define-key org-mode-map (kbd <span style="color: #8b2252;">"C-c c"</span>) 'org-mac-link-get-link)
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"org-mac-link"</span>
    (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">org-mac-iCal</span> nil t)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb3ae0aea" class="outline-3">
<h3 id="orgb3ae0aea"><span class="section-number-3">10.39.</span> [org-download] org バッファにD&amp;Dでファイルを保存</h3>
<div class="outline-text-3" id="text-orgb3ae0aea">
<p>
<code>org-attach</code> とペアで使うのが良いでしょう．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"org-attach"</span>
  (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">org-download</span> nil t)
    (<span style="color: #a020f0;">setq</span> org-download-screenshot-method 'screencapture)
    (<span style="color: #a020f0;">setq</span> org-download-method 'attach)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org97c39f96" class="outline-3">
<h3 id="org97c39f96"><span class="section-number-3">10.40.</span> [org-grep] org ファイルを grep する</h3>
<div class="outline-text-3" id="text-org97c39f96">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(org-grep)
                         <span style="color: #8b2252;">"org-grep"</span> nil t)
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">(with-eval-after-load "postpone"</span>
  <span style="color: #b22222;">;;   </span><span style="color: #b22222;">(global-set-key (kbd "C-M-g") 'org-grep))</span>
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"org-grep"</span>
    (<span style="color: #a020f0;">setq</span> org-grep-extensions '(<span style="color: #8b2252;">".org"</span> <span style="color: #8b2252;">".org_archive"</span>))
    (add-to-list 'org-grep-directories <span style="color: #8b2252;">"~/.emacs.d"</span>)
    (add-to-list 'org-grep-directories <span style="color: #8b2252;">"~/.emacs.d/.cask/package"</span>)

    <span style="color: #b22222;">;; </span><span style="color: #b22222;">"q"&#25276;&#19979;&#12398;&#25369;&#21205;&#12434;&#35519;&#25972;</span>
    (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">ad:org-grep-quit</span> ()
      (<span style="color: #a020f0;">interactive</span>)
      (delete-window))
    (advice-add 'org-grep-quit <span style="color: #483d8b;">:override</span> #'ad:org-grep-quit)

    <span style="color: #b22222;">;; </span><span style="color: #b22222;">for macOS</span>
    (<span style="color: #a020f0;">when</span> (memq window-system '(mac ns))
      (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">org-grep-from-org-shell-command</span> (regexp)
        (<span style="color: #a020f0;">if</span> org-grep-directories
            (concat <span style="color: #8b2252;">"find -E "</span>
                    (<span style="color: #a020f0;">if</span> org-grep-directories
                        (mapconcat #'identity org-grep-directories <span style="color: #8b2252;">" "</span>)
                      org-directory)
                    (<span style="color: #a020f0;">and</span> org-grep-extensions
                         (concat <span style="color: #8b2252;">" -regex '.*("</span>
                                 (mapconcat #'regexp-quote org-grep-extensions
                                            <span style="color: #8b2252;">"|"</span>)
                                 <span style="color: #8b2252;">")$'"</span>))
                    <span style="color: #8b2252;">" -print0 | xargs -0 grep "</span> org-grep-grep-options
                    <span style="color: #8b2252;">" -n -- "</span> (shell-quote-argument regexp))
          <span style="color: #8b2252;">":"</span>)))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org1a7c192b" class="outline-3">
<h3 id="org1a7c192b"><span class="section-number-3">10.41.</span> [ox-reveal] ナイスなHTML5プレゼンテーション出力</h3>
<div class="outline-text-3" id="text-org1a7c192b">
<p>
<code>C-c C-e R</code> エクスポータを呼び出せます．続けて <code>B</code> を押せば，ブラウザで出力後の見た目を確認できます．ただし別途 <a href="https://github.com/hakimel/reveal.js">reveal.js</a> が使える状態にないとダメです． <code>org-reveal-root</code> を設定すれば，clone した reveal.js の場所を指定できます．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"ox"</span>
  (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">and</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">ox-reveal</span> nil t)
             (version&lt; <span style="color: #8b2252;">"9.1.4"</span> (org-version)))
    (<span style="color: #a020f0;">setq</span> org-reveal-note-key-char ?n)))
</pre>
</div>

<p>
それ以外にも <a href="https://github.com/cybercode/org-slides">ox-s5</a>，<a href="https://github.com/coldnew/org-ioslide">org-ioslide</a> があります．
</p>
</div>
</div>

<div id="outline-container-org383ff638" class="outline-3">
<h3 id="org383ff638"><span class="section-number-3">10.42.</span> [org-dashboard] 進捗をプログレスバーで確認</h3>
<div class="outline-text-3" id="text-org383ff638">
<ul class="org-ul">
<li><a href="https://github.com/bard/org-dashboard">https://github.com/bard/org-dashboard</a></li>
<li>日本語だとバーの表示位置がずれるので修正．PR反映済み．</li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">init-org.el</span>
(<span style="color: #a020f0;">when</span> (autoload-if-found '(org-dashboard-display)
                         <span style="color: #8b2252;">"org-dashboard"</span> nil t)
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"org"</span>
    (define-key org-mode-map (kbd <span style="color: #8b2252;">"C-c f y"</span>) 'org-dashboard-display)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfa6df2ce" class="outline-3">
<h3 id="orgfa6df2ce"><span class="section-number-3">10.43.</span> [org-clock-today] 今日の総作業時間をモードラインに表示</h3>
<div class="outline-text-3" id="text-orgfa6df2ce">
<ul class="org-ul">
<li><code>CLOCK_MODELINE_TOTAL</code> を設定するのとは別なアプローチ</li>
<li>clock が動いている時だけモードラインに合計値が表示される</li>
<li><a href="https://github.com/mallt/org-clock-today-mode">mallt/org-clock-today-mode: Emacs minor mode to show the total clocked time of the current day in the mode line</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"org-clock-today"</span>
  (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-print-working-clocks</span> ()
    (<span style="color: #a020f0;">interactive</span>)
    (<span style="color: #a020f0;">let</span> ((clocked-item (org-duration-from-minutes
                         (org-clock-get-clocked-time))))
      (<span style="color: #a020f0;">if</span> org-clock-today-mode
          (message <span style="color: #8b2252;">"Today Subtree %s Total %s | Past %s"</span>
                   org-clock-today--buffer-time
                   org-clock-today--subtree-time
                   clocked-item)
        (message <span style="color: #8b2252;">"Past %s"</span> clocked-item)))))

(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"org-clock"</span>
  (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">ad:org-clock-sum-today</span> (<span style="color: #228b22;">&amp;optional</span> headline-filter)
    <span style="color: #8b2252;">"Sum the times for each subtree for today."</span>
    (<span style="color: #a020f0;">let</span> ((range (org-clock-special-range 'today nil t))) <span style="color: #b22222;">;; </span><span style="color: #b22222;">TZ&#32771;&#24942;</span>
      (org-clock-sum (car range) (cadr range)
                     headline-filter <span style="color: #483d8b;">:org-clock-minutes-today</span>)))
  (advice-add 'org-clock-sum-today <span style="color: #483d8b;">:override</span> #'ad:org-clock-sum-today)

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">using folked package</span>
  (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">org-clock-today</span> nil t)
    (<span style="color: #a020f0;">unless</span> noninteractive
      (<span style="color: #a020f0;">setq</span> org-clock-today-count-subtree t)
      (org-clock-today-mode 1))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org56b60c02" class="outline-3">
<h3 id="org56b60c02"><span class="section-number-3">10.44.</span> [org-random-todo] ランダムにタスクを選ぶ</h3>
<div class="outline-text-3" id="text-org56b60c02">
<ul class="org-ul">
<li>デフォルトで <code>org-agenda-files</code> に登録されたファイルからランダムにタスクを選ぶ</li>
<li>org-random-todo はミニバッファに選択したタスクを表示するだけ．</li>
<li>org-random-todo-goto-current 最後に表示したタスクに移動する．</li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">init-org.el</span>
(autoload-if-found '(org-random-todo org-random-todo-goto-current)
                   <span style="color: #8b2252;">"org-random-todo"</span> nil t)
</pre>
</div>
</div>
</div>

<div id="outline-container-org0cba1e62" class="outline-3">
<h3 id="org0cba1e62"><span class="section-number-3">10.45.</span> [ox-hugo] OrgファイルからHogoの記事をエクスポートする</h3>
<div class="outline-text-3" id="text-org0cba1e62">
<ul class="org-ul">
<li>Org Mode でブログを書いて， <a href="https://gohugo.io/">Hugo</a>で静的サイトに出力します．</li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-add-ox-hugo-lastmod</span> ()
  <span style="color: #8b2252;">"Add `</span><span style="color: #008b8b;">lastmod</span><span style="color: #8b2252;">' property with the current time."</span>
  (<span style="color: #a020f0;">interactive</span>)
  (org-set-property <span style="color: #8b2252;">"EXPORT_HUGO_LASTMOD"</span>
                    (format-time-string <span style="color: #8b2252;">"[%Y-%m-%d %a %H:%M]"</span>)))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">ad:ox-hugo:org-todo</span> (<span style="color: #228b22;">&amp;optional</span> ARG)
  <span style="color: #8b2252;">"Export subtree for Hugo if the TODO status in ARG is changing to DONE."</span>
  (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">and</span> (equal (buffer-name) <span style="color: #8b2252;">"imadenale.org"</span>)
             <span style="color: #b22222;">;; </span><span style="color: #b22222;">FIXME C-c C-t d &#12395;&#21453;&#24540;&#12375;&#12394;&#12356;&#65294;speed command &#12399;OK&#65294;</span>
             (<span style="color: #a020f0;">or</span> (eq ARG 'done)
                 (equal ARG <span style="color: #8b2252;">"DONE"</span>)))
    (org-hugo-export-wim-to-md)
    (message <span style="color: #8b2252;">"[ox-hugo] \"%s\" has been exported."</span>
             (nth 4 (org-heading-components)))
    (<span style="color: #a020f0;">let</span> ((command <span style="color: #8b2252;">"/Users/taka/Dropbox/scripts/push-hugo.sh"</span>))
      (<span style="color: #a020f0;">if</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">async</span> nil t)
          (async-start
           `(<span style="color: #a020f0;">lambda</span> () (shell-command-to-string ',command)))
        (shell-command-to-string command)))))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">see https://ox-hugo.scripter.co/doc/deprecation-notices/#org-hugo-auto-export-feature-now-a-minor-mode</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">(with-eval-after-load "org"</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">No need for latest ox-hugo</span>
<span style="color: #b22222;">;;   </span><span style="color: #b22222;">;; Require ox-hugo-auto-export.el explictly before loading ox-hugo.el</span>
<span style="color: #b22222;">;;   </span><span style="color: #b22222;">(require 'ox-hugo-auto-export nil t))</span>

(<span style="color: #a020f0;">when</span> (autoload-if-found
       '(org-hugo-export-wim-to-md)
       <span style="color: #8b2252;">"ox-hugo"</span> nil t)

  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"ox-hugo"</span>
    (<span style="color: #a020f0;">setq</span> org-hugo-auto-set-lastmod nil) <span style="color: #b22222;">;; </span><span style="color: #b22222;">see my-hugo-export-md</span>
    (<span style="color: #a020f0;">setq</span> org-hugo-suppress-lastmod-period 86400.0) <span style="color: #b22222;">;; </span><span style="color: #b22222;">1 day</span>
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">never copy files to under /static/ directory</span>
    (<span style="color: #a020f0;">setq</span> org-hugo-external-file-extensions-allowed-for-copying nil)

    <span style="color: #b22222;">;; </span><span style="color: #b22222;">see https://pxaka.tokyo/blog/2018/a-link-to-the-original-org-source-file</span>
    (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">org-hugo-get-link-to-orgfile</span> (uri alt)
      <span style="color: #8b2252;">"Return a formatted link to the original Org file.</span>
<span style="color: #8b2252;">To insert the formatted into an org buffer for Hugo, use an appropriate</span>
<span style="color: #8b2252;">macro, e.g. {{{srclink}}}.</span>

<span style="color: #8b2252;">Note that this mechanism is still under consideration."</span>
      (<span style="color: #a020f0;">let</span> ((line (<span style="color: #a020f0;">save-excursion</span>
                    (<span style="color: #a020f0;">save-restriction</span>
                      (org-back-to-heading t)
                      (line-number-at-pos)))))
        (concat <span style="color: #8b2252;">"[["</span> uri (file-name-nondirectory (buffer-file-name))
                <span style="color: #8b2252;">"#L"</span> (format <span style="color: #8b2252;">"%d"</span> line) <span style="color: #8b2252;">"]["</span> alt <span style="color: #8b2252;">"]]"</span>)))
    <span style="color: #b22222;">;;    </span><span style="color: #b22222;">(advice-add 'org-todo :after #'ad:ox-hugo:org-todo)</span>
    ))
</pre>
</div>
</div>
</div>

<div id="outline-container-org32e931e3" class="outline-3">
<h3 id="org32e931e3"><span class="section-number-3">10.46.</span> [ox-html] HTML見出しへのリンクを固定する</h3>
<div class="outline-text-3" id="text-org32e931e3">
<p>
標準の設定でHTMLを出力すると，各見出しへのリンクとして <code>org0123456</code> のようなIDが振られる．しかしそれらのIDは，HTMLを出力するたびに更新されるため，出力したHTMLの見出しをパーマリンクとして使用できない．これを防ぐためには，プロパティで <code>CUSTOM_ID</code> を指定する必要がある．
</p>

<p>
これを簡単にするための補助関数が公開されている．この<a href="https://writequit.org/articles/emacs-org-mode-generate-ids.html">元ネタ</a>を参考に，少し改良して使用している．なお元ネタでは標準の <code>org-id-new</code> を直接利用しているが，以下の実装では， <code>org</code> の後ろにUUIDの先頭8桁が続くように，IDの内容に制限をかけている．
</p>

<p>
<code>my-add-org-ids-to-headlines-in-file</code> は，バッファの保存時点，或いは，HTMLエクスポートが走る直前のタイミングで自動実行させるのがスマートだが，当面は手動で運用する．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"ox-html"</span>
  (<span style="color: #a020f0;">setq</span> org-html-text-markup-alist
        '((bold . <span style="color: #8b2252;">"&lt;b&gt;%s&lt;/b&gt;"</span>)
          (code . <span style="color: #8b2252;">"&lt;code class=\"org-code\"&gt;%s&lt;/code&gt;"</span>)
          (italic . <span style="color: #8b2252;">"&lt;i&gt;%s&lt;/i&gt;"</span>)
          (strike-through . <span style="color: #8b2252;">"&lt;del&gt;%s&lt;/del&gt;"</span>)
          (underline . <span style="color: #8b2252;">"&lt;span class=\"org-underline\"&gt;%s&lt;/span&gt;"</span>)
          (verbatim . <span style="color: #8b2252;">"&lt;code class=\"org-verbatim\"&gt;%s&lt;/code&gt;"</span>))))

(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"org"</span>
  (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-add-custom-id</span> ()
    <span style="color: #8b2252;">"Add \"CUSTOM_ID\" to the current tree if not assigned yet."</span>
    (<span style="color: #a020f0;">interactive</span>)
    (my-org-custom-id-get (point) t))

  (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-get-custom-id</span> ()
    <span style="color: #8b2252;">"Return a part of UUID with an \"org\" prefix.</span>
<span style="color: #8b2252;">e.g. \"org3ca6ef0c\"."</span>
    (<span style="color: #a020f0;">let*</span> ((id (org-id-new <span style="color: #8b2252;">""</span>)))
      (<span style="color: #a020f0;">when</span> (org-uuidgen-p id)
        (downcase (concat <span style="color: #8b2252;">"org"</span>  (substring (org-id-new <span style="color: #8b2252;">""</span>) 0 8))))))

  (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-org-custom-id-get</span> (pom <span style="color: #228b22;">&amp;optional</span> create)
    <span style="color: #8b2252;">"Get the CUSTOM_ID property of the entry at point-or-marker POM.</span>
<span style="color: #8b2252;">If the entry does not have an CUSTOM_ID, the function returns nil.</span>
<span style="color: #8b2252;">However, when CREATE is non nil, create a CUSTOM_ID if none is present</span>
<span style="color: #8b2252;">already.  In any case, the CUSTOM_ID of the entry is returned.</span>

<span style="color: #8b2252;">See https://writequit.org/articles/emacs-org-mode-generate-ids.html"</span>
    (<span style="color: #a020f0;">interactive</span>)
    (<span style="color: #a020f0;">let</span> ((id (org-entry-get nil <span style="color: #8b2252;">"CUSTOM_ID"</span>)))
      (<span style="color: #a020f0;">cond</span>
       ((<span style="color: #a020f0;">and</span> id (stringp id) (string-match <span style="color: #8b2252;">"\\S-"</span> id))
        id)
       (create
        (<span style="color: #a020f0;">setq</span> id (my-get-custom-id))
        (<span style="color: #a020f0;">unless</span> id
          (<span style="color: #ff0000; font-weight: bold;">error</span> <span style="color: #8b2252;">"Invalid ID"</span>))
        (org-entry-put pom <span style="color: #8b2252;">"CUSTOM_ID"</span> id)
        (message <span style="color: #8b2252;">"--- CUSTOM_ID assigned: %s"</span> id)
        (org-id-add-location id (buffer-file-name (buffer-base-buffer)))
        id))))

  <span style="color: #b22222;">;;;</span><span style="color: #b22222;">###autoload</span>
  (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-add-org-ids-to-headlines-in-file</span> ()
    <span style="color: #8b2252;">"Add CUSTOM_ID properties to all headlines in the current file.</span>
<span style="color: #8b2252;">Which do not already have one.  Only adds ids if the</span>
<span style="color: #8b2252;">`</span><span style="color: #008b8b;">auto-id</span><span style="color: #8b2252;">' option is set to `</span><span style="color: #008b8b;">t</span><span style="color: #8b2252;">' in the file somewhere. ie,</span>
<span style="color: #8b2252;">#+options: auto-id:t</span>

<span style="color: #8b2252;">See https://writequit.org/articles/emacs-org-mode-generate-ids.html"</span>
    (<span style="color: #a020f0;">interactive</span>)
    (<span style="color: #a020f0;">save-excursion</span>
      (widen)
      (goto-char (point-min))
      (<span style="color: #a020f0;">when</span> (re-search-forward <span style="color: #8b2252;">"^#\\+options:.*auto-id:t"</span> (point-max) t)
        (org-map-entries
         (<span style="color: #a020f0;">lambda</span> () (my-org-custom-id-get (point) 'create))))))

  (<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">md-link-format</span> <span style="color: #8b2252;">"^!\\[</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">(</span><span style="color: #8b2252;">.+</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">)</span><span style="color: #8b2252;">\\](</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">(</span><span style="color: #8b2252;">.+</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">)</span><span style="color: #8b2252;">)$"</span>)
  (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-convert-md-link-to-html</span> ()
    (<span style="color: #a020f0;">interactive</span>)
    (goto-char (point-min))
    (<span style="color: #a020f0;">while</span> (re-search-forward md-link-format nil <span style="color: #483d8b;">:noerror</span>)
      (<span style="color: #a020f0;">let*</span> ((prev (match-string-no-properties 0))
             (alt (match-string-no-properties 1))
             (src (match-string-no-properties 2))
             (new (concat <span style="color: #8b2252;">"&lt;p&gt;&lt;img src=\""</span> src <span style="color: #8b2252;">"\" alt=\""</span> alt <span style="color: #8b2252;">"\" /&gt;&lt;/p&gt;"</span>)))
        (replace-match new)
        (message <span style="color: #8b2252;">"====\ninput:\t%s\noutput:\t%s"</span> prev new)))
    (message <span style="color: #8b2252;">"--- done."</span>)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orga114da46" class="outline-3">
<h3 id="orga114da46"><span class="section-number-3">10.47.</span> [org-id.el] プロパティに ID を入れる</h3>
<div class="outline-text-3" id="text-orga114da46">
<p>
<code>org.el</code> に付属している <code>org-id.el</code> を使うと，各 heading のプロパティにユニークな id を付与できます．また， <code>org-clock-in</code> で工数計測を開始すると，自動的に付与されます．しかし， heading を不用意にコピペすると，id が重複するので，それらを削除するユーティリティを準備しました．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"org"</span>
  (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-delete-all-id-in-file</span> ()
    (<span style="color: #a020f0;">interactive</span>)
    (goto-char 1)
    (<span style="color: #a020f0;">while</span> (not (eq (point) (point-max)))
      (org-next-visible-heading 1)
      (<span style="color: #a020f0;">let</span> ((id (org-entry-get (point) <span style="color: #8b2252;">"ID"</span>)))
        (<span style="color: #a020f0;">when</span> id
          (message <span style="color: #8b2252;">"ID: %s"</span> id)
          (org-delete-property <span style="color: #8b2252;">"ID"</span>))))
    (message <span style="color: #8b2252;">"--- done."</span>)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org5cc51a8d" class="outline-3">
<h3 id="org5cc51a8d"><span class="section-number-3">10.48.</span> [orglink.el] Orgファイル以外でリンクを使う</h3>
<div class="outline-text-3" id="text-org5cc51a8d">
<p>
指定したモードのバッファで， <code>org mode</code> と同じリンク機能を使えるようにします．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(orglink-mode
                           global-orglink-mode my-orglink-mode-activate)
                         <span style="color: #8b2252;">"orglink"</span> nil t)
  (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-orglink-mode-activate</span> ()
    (orglink-mode 1)
    (<span style="color: #a020f0;">setq</span> orglink-mode-lighter <span style="color: #8b2252;">""</span>)
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#12496;&#12483;&#12501;&#12449;&#12525;&#12540;&#12459;&#12523;&#12395;&#33394;&#12388;&#12369;&#12434;&#28040;&#12377;</span>
    (face-remap-add-relative 'org-link
                             <span style="color: #483d8b;">:underline</span> nil
                             <span style="color: #483d8b;">:inherit</span> font-lock-comment-delimiter-face))

  (<span style="color: #a020f0;">dolist</span> (hook '(emacs-lisp-mode-hook c-mode-common-hook yatex-mode))
    (add-hook hook #'my-orglink-mode-activate))

  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"orglink"</span>
    (delq 'angle orglink-activate-links)
    (define-key orglink-mouse-map (kbd <span style="color: #8b2252;">"C-c C-o"</span>) 'org-open-at-point-global)
    (define-key orglink-mouse-map (kbd <span style="color: #8b2252;">"C-c C-l"</span>) 'org-insert-link)))

<span style="color: #b22222;">;; </span><span style="color: #b22222;">(add-to-list 'orglink-activate-in-modes 'c++-mode)</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">(add-to-list 'orglink-activate-in-modes 'c-mode)</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">(when (require 'orglink nil t)</span>
<span style="color: #b22222;">;;   </span><span style="color: #b22222;">(global-orglink-mode))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org8480b85f" class="outline-3">
<h3 id="org8480b85f"><span class="section-number-3">10.49.</span> [org-trello.el] Trello と双方向同期する</h3>
<div class="outline-text-3" id="text-org8480b85f">
<p>
<a href="https://trello.com/">Trello</a> と特定の org バッファを同期します．コンフリクトを避けるために，明示的に <code>pull</code> と <code>push</code> をする関数を定義して使います．非常に強力で，外出時に簡易的にモバイル端末でタスクを追加したり，ブラウザでグラフィカルにタスクを追加できます．
</p>

<p>
落ち着いてEmacsを使う状況になたら， <code>pull</code> してバッファに反映します． <code>DONE</code> になったタスクや，別な org バッファで管理したいはタスクは， <code>org-refile</code> で移してしまえば良いです．そして，整理ができたら， <code>push</code> して，次のモバイル環境での編集に備えます．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-push-trello-card</span> () (<span style="color: #a020f0;">interactive</span>) (org-trello-sync-card))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-pull-trello-card</span> () (<span style="color: #a020f0;">interactive</span>) (org-trello-sync-card t))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-push-trello</span> () (<span style="color: #a020f0;">interactive</span>) (org-trello-sync-buffer))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-pull-trello</span> () (<span style="color: #a020f0;">interactive</span>) (org-trello-sync-buffer t))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-activate-org-trello</span> ()
  (<span style="color: #a020f0;">let</span> ((filename (buffer-file-name (current-buffer))))
    (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">and</span> filename
               (string= <span style="color: #8b2252;">"trello"</span> (file-name-extension filename))
               (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">org-trello</span> nil t))
      (org-trello-mode))))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">1. TODO/DOING/DONE &#12395; trello &#20596;&#12398;&#12459;&#12540;&#12489;&#12434;&#22793;&#12360;&#12390;&#12362;&#12367;&#65294;</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">2. M-x org-trello-install-key-and-token</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">~/.emacs.d/.trello/&lt;account&gt;.el &#12364;&#20316;&#12425;&#12428;&#12427;</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">3. M-x org-trello-install-board-metadata</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">Trello &#20596;&#12398;&#24773;&#22577;&#12434;&#22522;&#12395;&#12375;&#12390; current-buffer &#12395;&#12503;&#12525;&#12497;&#12486;&#12451;&#12502;&#12525;&#12483;&#12463;&#12364;&#25407;&#20837;&#12373;&#12428;&#12427;</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">4. C-u M-x org-trello-sync-buffer &#12391; pull</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">5. M-x org-trello-sync-buffer &#12391; push</span>
(<span style="color: #a020f0;">when</span> (autoload-if-found '(my-push-trello my-pull-trello my-activate-org-trello)
                         <span style="color: #8b2252;">"org-trello"</span> nil t)
  (<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">org-trello-current-prefix-keybinding</span> nil) <span style="color: #b22222;">;; </span><span style="color: #b22222;">To avoid an error</span>
  (add-to-list 'auto-mode-alist '(<span style="color: #8b2252;">"\\.trello$"</span> . org-mode))
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"org"</span>
    (add-hook 'org-mode-hook #'my-activate-org-trello)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orge01f4572" class="outline-3">
<h3 id="orge01f4572"><span class="section-number-3">10.50.</span> [ox.el] ディスパッチャを水平方向の分割画面に表示</h3>
<div class="outline-text-3" id="text-orge01f4572">
<ul class="org-ul">
<li><a href="https://qiita.com/takaxp/items/017ccc4655877b827551">orgエクスポータのディスパッチャを水平分割画面に表示する - Qiita</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"ox"</span>
  (<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">my-org-export-before-hook</span> nil)
  (<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">my-org-export-after-hook</span> nil)
  (<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">my-org-export-last-buffer</span> nil)

  (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-org-export--post-processing</span> ()
    (<span style="color: #a020f0;">when</span> (eq this-command 'org-export-dispatch)
      (<span style="color: #a020f0;">let</span> ((moom-verbose nil))
        (run-hooks 'my-org-export-after-hook)
        moom-verbose) <span style="color: #b22222;">;; </span><span style="color: #b22222;">to avoid a warning on lexical variable</span>
      (remove-hook 'my-org-export-before-hook 'moom-split-window)
      (remove-hook 'my-org-export-before-hook 'split-window-horizontally)
      (remove-hook 'my-org-export-after-hook 'moom-delete-windows)
      (remove-hook 'my-org-export-after-hook 'delete-window))
    (<span style="color: #a020f0;">when</span> this-command
      (remove-hook 'post-command-hook #'my-org-export--post-processing)))

  (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-org-export-dispatch</span> (f ARG)
    (<span style="color: #a020f0;">cond</span>
     (org-export-dispatch-use-expert-ui
      nil)
     ((eq (frame-width) 80)
      (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">moom</span> nil t)
        (add-hook 'my-org-export-before-hook 'moom-split-window)
        (add-hook 'my-org-export-after-hook 'moom-delete-windows)))
     ((&gt; (frame-width) 160)
      (add-hook 'my-org-export-before-hook 'split-window-horizontally)
      (add-hook 'my-org-export-after-hook 'delete-window)))
    (<span style="color: #a020f0;">when</span> my-org-export-after-hook
      (add-hook 'post-command-hook #'my-org-export--post-processing))
    (run-hooks 'my-org-export-before-hook)
    (apply f ARG))
  (advice-add 'org-export-dispatch <span style="color: #483d8b;">:around</span> #'my-org-export-dispatch)

  (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-org-export-insert-default-template</span> (f <span style="color: #228b22;">&amp;optional</span> backend subtreep)
    (<span style="color: #a020f0;">let</span> ((this-command nil))
      (apply f backend subtreep)))
  (advice-add 'org-export-insert-default-template <span style="color: #483d8b;">:around</span>
              #'my-org-export-insert-default-template)

  (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-org-export-to-buffer</span> (_backend
                                  buffer
                                  <span style="color: #228b22;">&amp;optional</span> _async _subtreep _visible-only
                                  _body-only _ext-plist _post-process)
    (<span style="color: #a020f0;">setq</span> my-org-export-last-buffer buffer))
  (advice-add 'org-export-to-buffer <span style="color: #483d8b;">:after</span> #'my-org-export-to-buffer)

  (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-copy-exported-buffer</span> ()
    (<span style="color: #a020f0;">interactive</span>)
    (<span style="color: #a020f0;">when</span> my-org-export-last-buffer
      (<span style="color: #a020f0;">with-current-buffer</span> my-org-export-last-buffer
        (mark-whole-buffer)
        (kill-ring-save (point-min) (point-max))
        (message <span style="color: #8b2252;">"Copied: %s"</span> my-org-export-last-buffer))
      (<span style="color: #a020f0;">setq</span> my-org-export-last-buffer nil)))
  (add-hook 'my-org-export-after-hook #'my-copy-exported-buffer))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd536a4cc" class="outline-3">
<h3 id="orgd536a4cc"><span class="section-number-3">10.51.</span> <span class="todo TODO">TODO</span> [org-extra-emphasis] 強調表現を拡張する</h3>
<div class="outline-text-3" id="text-orgd536a4cc">
<p>
主にマーカー（黄色や赤色）を導入するために， org mode の強調表現を拡張します． <code>!!</code> で黄色マーキング， <code>!@</code> で文字色を赤色に変更できます．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(autoload 'skewer-html-mode <span style="color: #8b2252;">"skewer-html"</span> nil t)
(<span style="color: #a020f0;">unless</span> noninteractive
  (add-hook 'org-mode-hook 'skewer-html-mode)
  (autoload-if-found '(org-extra-emphasis-mode) <span style="color: #8b2252;">"org-extra-emphasis"</span> nil t))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf5d6500a" class="outline-3">
<h3 id="orgf5d6500a"><span class="section-number-3">10.52.</span> <span class="todo TODO">TODO</span> [org-appear.el] カーソルを置いた時だけマークアップを表示する</h3>
<div class="outline-text-3" id="text-orgf5d6500a">
<p>
太字や強調表示など，所定の記号でマークアップすると face を変えられますが，通常時には記号を表示しないで，カーソルを置いた時だけ表示するようにできます．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-toggle-org-show-emphasis-markers</span> ()
  (<span style="color: #a020f0;">interactive</span>)
  (<span style="color: #a020f0;">setq</span> org-hide-emphasis-markers (not org-hide-emphasis-markers))
  (<span style="color: #a020f0;">dolist</span> (buffer (buffer-list))
    (<span style="color: #a020f0;">with-current-buffer</span> buffer
      (<span style="color: #a020f0;">when</span> (derived-mode-p 'org-mode)
        (font-lock-flush)))))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(org-appear-mode)
                         <span style="color: #8b2252;">"org-appear"</span> nil t)
  (<span style="color: #a020f0;">setq</span> org-hide-emphasis-markers t)
  (add-hook 'org-mode-hook 'org-appear-mode)
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"org-appear"</span>
    (<span style="color: #a020f0;">setq</span> org-appear-trigger 'on-change))) <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#32232;&#38598;&#20013;&#12384;&#12369;&#12510;&#12540;&#12463;&#12450;&#12483;&#12503;&#12434;&#34920;&#31034;&#12391;&#12365;&#12427;</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org992326f6" class="outline-3">
<h3 id="org992326f6"><span class="section-number-3">10.53.</span> <span class="todo TODO">TODO</span> [ob-async] ソースブロックの非同期実行</h3>
<div class="outline-text-3" id="text-org992326f6">
<p>
ソースブロックを非同期に実行します．各ソースブロックで <code>:async</code> を指定するだけで，非同期になります． ただし， <code>ob-python</code> はすでに <code>:async</code> を予約しているので， <code>ob-async</code> のオプションと衝突しないように，処理対象から除外しておきます．
</p>

<p>
<code>ob-async</code> のロードは， <code>my-org-babel-load-activate</code> で実行します．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"ob-async"</span>
  (custom-set-variables
   '(ob-async-no-async-languages-alist '(<span style="color: #8b2252;">"ipython"</span>))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org9cbb15f3" class="outline-3">
<h3 id="org9cbb15f3"><span class="section-number-3">10.54.</span> <span class="todo TODO">TODO</span> [org-tree-slide] BEGIN_SRCとEND_SRCを消して背景色を変える</h3>
<div class="outline-text-3" id="text-org9cbb15f3">
<p>
<code>hide-lines.el</code> を使うことで，プレゼン時に <code>BEGIN_SRC</code> と <code>ENC_SRC</code> を非表示にしてすっきりさせます．さらに，ソースブロックの背景色を変えます（以下の例では， <code>emacs-lisp</code> を言語で指定している場合に限定）．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(org-tree-slide-mode)
                         <span style="color: #8b2252;">"org-tree-slide"</span> nil t)
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"org-tree-slide"</span>
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">FIXME &#35079;&#25968;&#12398;&#12496;&#12483;&#12501;&#12449;&#12391;&#20006;&#34892;&#21205;&#20316;&#12373;&#12379;&#12427;&#12392;&#12362;&#12363;&#12375;&#12367;&#12394;&#12427;&#65294;hide-lines &#12398;&#21839;&#38988;&#65311;</span>
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">prettify-symbols &#12391;&#32622;&#12365;&#25563;&#12360;&#12427;&#12411;&#12358;&#12364;&#33391;&#12356;</span>
    (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">and</span> nil (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">hide-lines</span> nil t))
      (<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">my-org-src-block-faces</span> nil)
      (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-show-headers</span> ()
        (<span style="color: #a020f0;">setq</span> org-src-block-faces 'my-org-src-block-faces)
        (hide-lines-show-all))
      (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-hide-headers</span> ()
        (<span style="color: #a020f0;">setq</span> my-org-src-block-faces 'org-src-block-faces)
        (<span style="color: #a020f0;">setq</span> org-src-block-faces
              '((<span style="color: #8b2252;">"emacs-lisp"</span> (<span style="color: #483d8b;">:background</span> <span style="color: #8b2252;">"cornsilk"</span>))))
        (hide-lines-matching <span style="color: #8b2252;">"#\\+BEGIN_SRC"</span>)
        (hide-lines-matching <span style="color: #8b2252;">"#\\+END_SRC"</span>))
      (add-hook 'org-tree-slide-play-hook #'my-hide-headers)
      (add-hook 'org-tree-slide-stop-hook #'my-show-headers)

      <span style="color: #b22222;">;; </span><span style="color: #b22222;">(defun ad:org-edit-src-code (&amp;optional code edit-buffer-name)</span>
      (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">ad:org-edit-src-code</span> ()
        (<span style="color: #a020f0;">interactive</span>)
        (my-show-headers))
      (advice-add 'org-edit-src-code <span style="color: #483d8b;">:before</span> #'ad:org-edit-src-code)
      <span style="color: #b22222;">;; </span><span style="color: #b22222;">Block &#22806;&#12391;&#21628;&#12400;&#12428;&#12427;&#12392;&#65292;my-show-headers &#12364;&#21628;&#12400;&#12428;&#12390;&#12375;&#12414;&#12358;</span>
      (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">ad:org-edit-src-exit</span> ()
        (<span style="color: #a020f0;">interactive</span>)
        (my-hide-headers))
      (advice-add 'org-edit-src-exit <span style="color: #483d8b;">:after</span> #'ad:org-edit-src-exit))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org3ee441c6" class="outline-3">
<h3 id="org3ee441c6"><span class="section-number-3">10.55.</span> <span class="todo TODO">TODO</span> [org-fstree] ディレクトリ構造を読み取る</h3>
<div class="outline-text-3" id="text-org3ee441c6">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"org"</span>
  (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">org-fstree</span> nil t))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbb452f44" class="outline-3">
<h3 id="orgbb452f44"><span class="section-number-3">10.56.</span> <span class="todo TODO">TODO</span> [ox.el] 出力形式の拡張</h3>
<div class="outline-text-3" id="text-orgbb452f44">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"ox"</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">(setq org-export-default-language "ja")</span>
  (<span style="color: #a020f0;">if</span> (eq system-type 'darwin)
      (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">ox-pandoc</span> nil t)
    (message <span style="color: #8b2252;">"--- pandoc is NOT configured for Windows or Linux."</span>))
  (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">ox-qmd</span> nil t) <span style="color: #b22222;">;; </span><span style="color: #b22222;">Quita-style</span>
  (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">ox-gfm</span> nil t)) <span style="color: #b22222;">;; </span><span style="color: #b22222;">GitHub-style</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org4142d8c3" class="outline-3">
<h3 id="org4142d8c3"><span class="section-number-3">10.57.</span> <span class="todo TODO">TODO</span> Parers3.app からリンクを取得する</h3>
<div class="outline-text-3" id="text-org4142d8c3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"org-mac-link"</span>
  (<span style="color: #a020f0;">defcustom</span> <span style="color: #a0522d;">org-mac-grab-Papers-app-p</span> t
    <span style="color: #8b2252;">"Add menu option [P]apers to grab links from the Papers.app."</span>
    <span style="color: #483d8b;">:tag</span> <span style="color: #8b2252;">"Grab Papers.app links"</span>
    <span style="color: #483d8b;">:group</span> 'org-mac-link
    <span style="color: #483d8b;">:type</span> 'boolean)

  (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">org-mac-papers-insert-frontmost-paper-link</span> ()
    (<span style="color: #a020f0;">interactive</span>)
    (<span style="color: #a020f0;">let</span> ((result (org-mac-papers-get-frontmost-paper-link)))
      (<span style="color: #a020f0;">if</span> result
          (insert result)
        (message <span style="color: #8b2252;">"Please open Papers.app and select a paper."</span>))))

  (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">org-mac-papers-get-frontmost-paper-link</span> ()
    (<span style="color: #a020f0;">interactive</span>)
    (message <span style="color: #8b2252;">"Applescript: Getting Papers link..."</span>)
    (<span style="color: #a020f0;">let</span> ((result (org-as-mac-papers-get-paper-link)))
      (<span style="color: #a020f0;">if</span> (<span style="color: #a020f0;">or</span> (eq result nil) (string= result <span style="color: #8b2252;">""</span>))
          nil
        (org-mac-paste-applescript-links result))))

  (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">org-as-mac-papers-get-paper-link</span> ()
    (do-applescript
     (concat
      <span style="color: #8b2252;">"if application \"Papers\" is running then\n"</span>
      <span style="color: #8b2252;">" tell application \"Papers\" to activate\n"</span>
      <span style="color: #8b2252;">" delay 0.3\n"</span>
      <span style="color: #8b2252;">" set the clipboard to \"\"\n"</span>
      <span style="color: #8b2252;">" tell application \"System Events\" to tell process \"Papers\"\n"</span>
      <span style="color: #8b2252;">"         keystroke \"l\" using {command down, shift down}\n"</span>
      <span style="color: #8b2252;">" end tell\n"</span>
      <span style="color: #8b2252;">" delay 0.2\n"</span>
      <span style="color: #8b2252;">" set aLink to the clipboard\n"</span>
      <span style="color: #8b2252;">" tell application \"System Events\" to tell process \"Papers\"\n"</span>
      <span style="color: #b22222;">;; </span><span style="color: #b22222;">"              keystroke \"c\" using {command down, alt down\}\n"</span>
      <span style="color: #8b2252;">"         keystroke \"m\" using {command down, option down</span><span style="color: #ff0000; font-weight: bold;">\</span><span style="color: #8b2252;">}\n"</span>
      <span style="color: #8b2252;">" end tell\n"</span>
      <span style="color: #8b2252;">" delay 0.2\n"</span>
      <span style="color: #8b2252;">" set aName to the clipboard\n"</span>
      <span style="color: #8b2252;">" tell application \"Emacs\" to activate\n"</span>
      <span style="color: #8b2252;">" return (get aLink) &amp; \"::split::\" &amp; (get aName) as string\n"</span>
      <span style="color: #8b2252;">"else\n"</span>
      <span style="color: #8b2252;">" return\n"</span>
      <span style="color: #8b2252;">"end if\n"</span>)))

  (<span style="color: #a020f0;">when</span> (boundp 'org-mac-link-descriptors)
    (add-to-list 'org-mac-link-descriptors
                 `(<span style="color: #8b2252;">"P"</span> <span style="color: #8b2252;">"apers"</span> org-mac-papers-insert-frontmost-paper-link
                   ,org-mac-grab-Papers-app-p) <span style="color: #ff0000; font-weight: bold;">t)))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org47b1ee67" class="outline-3">
<h3 id="org47b1ee67"><span class="section-number-3">10.58.</span> <span class="todo TODO">TODO</span> Papers3.app のリンクを開けるようにする</h3>
<div class="outline-text-3" id="text-org47b1ee67">
<p>
Papers3.app は，各文献に <code>papers3://</code> で始まるURIを割り当てています．このリンクを org バッファにペーストし， <code>org-open-at-point</code> (C-c C-o) で開けるようにします．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"org"</span>
  (<span style="color: #a020f0;">when</span> (eq system-type 'darwin)
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">Open `</span><span style="color: #008b8b;">papers3://</span><span style="color: #b22222;">' link by C-c C-o.</span>
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">(org-add-link-type will be obsoleted from Org 9.</span>
    (<span style="color: #a020f0;">when</span> (fboundp 'org-link-set-parameters)
      (org-link-set-parameters
       <span style="color: #8b2252;">"papers3"</span>
       <span style="color: #483d8b;">:follow</span> (<span style="color: #a020f0;">lambda</span> (path)
                 (<span style="color: #a020f0;">let</span> ((cmd (concat <span style="color: #8b2252;">"open papers3:"</span> path)))
                   (shell-command-to-string (shell-quote-argument cmd))
                   (message <span style="color: #8b2252;">"%s"</span> cmd)))))))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd14388c1" class="outline-3">
<h3 id="orgd14388c1"><span class="section-number-3">10.59.</span> <span class="todo TODO">TODO</span> [org-attach] 外部ファイルを紐付ける</h3>
<div class="outline-text-3" id="text-orgd14388c1">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(org-attach du-org-attachments)
                         <span style="color: #8b2252;">"org-attach"</span> nil t)
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"org-attach"</span>
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">org-insert-link &#12391;&#28155;&#20184;&#12501;&#12449;&#12452;&#12523;&#12408;&#12398;&#12522;&#12531;&#12463;&#12434;&#12506;&#12540;&#12473;&#12488;&#12391;&#12365;&#12427;&#12424;&#12358;&#12395;&#12377;&#12427;</span>
    (<span style="color: #a020f0;">setq</span> org-attach-store-link-p t)
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#33258;&#21205;&#20184;&#19982;&#12373;&#12428;&#12427;&#12479;&#12464;&#12398;&#21517;&#21069;&#12434;&#22793;&#26356;</span>
    (<span style="color: #a020f0;">setq</span> org-attach-auto-tag <span style="color: #8b2252;">"Attach"</span>)
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">git-annex &#12434;&#20351;&#29992;&#12375;&#12394;&#12356;</span>
    (<span style="color: #a020f0;">setq</span> org-attach-git-annex-cutoff nil)

    (<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">org-attach-directory-absolute</span>
      (concat (getenv <span style="color: #8b2252;">"SYNCROOT"</span>)
              <span style="color: #8b2252;">"/org/"</span>
              (<span style="color: #a020f0;">when</span> (boundp 'org-attach-directory)
                <span style="color: #8b2252;">"data/"</span>)))

    (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">du-org-attachments</span> ()
      <span style="color: #8b2252;">"Show directory size for org-attachments."</span>
      (<span style="color: #a020f0;">interactive</span>)
      (message <span style="color: #8b2252;">"--- %s"</span>
               (chomp (shell-command-to-string
                       (concat <span style="color: #8b2252;">"/usr/bin/du -sh "</span>
                               org-attach-directory-absolute)))))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org1926ab44" class="outline-3">
<h3 id="org1926ab44"><span class="section-number-3">10.60.</span> <span class="todo TODO">TODO</span> [org-recent-headings] 訪問したツリーを記録し簡単に再訪問可能にする</h3>
<div class="outline-text-3" id="text-org1926ab44">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">ad:org-recent-headings-activate</span> ()
  (<span style="color: #a020f0;">interactive</span>)
  (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">org-recent-headings</span> nil t)
    (org-recent-headings-mode 1) <span style="color: #b22222;">;; </span><span style="color: #b22222;">one time activate</span>
    (advice-remove 'org-recent-headings
                   #'ad:org-recent-headings-activate)))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(org-recent-headings org-recent-headings-mode)
                         <span style="color: #8b2252;">"org-recent-headings"</span> nil t)
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">(global-set-key (kbd "C-c f r") 'org-recent-headings-helm)</span>
  (global-set-key (kbd <span style="color: #8b2252;">"C-M-h"</span>) 'org-recent-headings)
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"org-recent-headings"</span>
    (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">ivy</span>)
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#12487;&#12501;&#12457;&#12523;&#12488;&#12384;&#12392; `</span><span style="color: #008b8b;">ivy-string&lt;</span><span style="color: #b22222;">' &#12364;&#20351;&#12431;&#12428;&#12390;&#12375;&#12414;&#12356;&#65292;&#20351;&#29992;&#23653;&#27508;&#12364;&#21453;&#26144;&#12373;&#12428;&#12394;&#12356;&#65294;</span>
    (<span style="color: #a020f0;">setf</span> (alist-get 'org-recent-headings ivy-sort-functions-alist) nil)
    (advice-add 'org-recent-headings <span style="color: #483d8b;">:before</span>
                #'ad:org-recent-headings-activate)
    (<span style="color: #a020f0;">setq</span> org-recent-headings-save-file <span style="color: #8b2252;">"~/.emacs.d/org-recent-headings.dat"</span>)
    (<span style="color: #a020f0;">setq</span> org-recent-headings-use-ids 'when-available)
    (<span style="color: #a020f0;">setq</span> org-recent-headings-show-entry-function
          'org-recent-headings--show-entry-direct) <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#30452;&#25509;&#31227;&#21205;&#12377;&#12427;</span>
    (<span style="color: #a020f0;">setq</span> org-recent-headings-advise-functions
          '(org-cycle
            org-agenda-goto
            org-agenda-show
            org-agenda-show-mouse
            org-show-entry
            org-reveal
            org-refile
            org-tree-to-indirect-buffer
            org-bookmark-jump)))

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">(with-eval-after-load 'ivy</span>
  <span style="color: #b22222;">;;   </span><span style="color: #b22222;">;; Helm, Ivy support was removed from the official package</span>
  <span style="color: #b22222;">;;   </span><span style="color: #b22222;">(defun org-recent-headings-ivy ()</span>
  <span style="color: #b22222;">;;     </span><span style="color: #b22222;">"Choose from recent Org headings with Ivy."</span>
  <span style="color: #b22222;">;;     </span><span style="color: #b22222;">(interactive)</span>
  <span style="color: #b22222;">;;     </span><span style="color: #b22222;">(let ((completing-read-function  #'ivy-completing-read))</span>
  <span style="color: #b22222;">;;       </span><span style="color: #b22222;">(org-recent-headings))))</span>
  )
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfcfd3f34" class="outline-3">
<h3 id="orgfcfd3f34"><span class="section-number-3">10.61.</span> <span class="todo TODO">TODO</span> [orgnav] ツリーの検索インタフェース</h3>
<div class="outline-text-3" id="text-orgfcfd3f34">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(orgnav-search-root)
                         <span style="color: #8b2252;">"orgnav"</span> nil t)
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"org"</span>
    (define-key org-mode-map (kbd <span style="color: #8b2252;">"C-c f n"</span>)
      (<span style="color: #a020f0;">lambda</span> () (<span style="color: #a020f0;">interactive</span>)
        (orgnav-search-root 3 'orgnav--goto-action)))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org5fce13fa" class="outline-3">
<h3 id="org5fce13fa"><span class="section-number-3">10.62.</span> <span class="todo TODO">TODO</span> [toc-org] 目次の挿入</h3>
<div class="outline-text-3" id="text-org5fce13fa">
<ul class="org-ul">
<li>ツリーに TOC タグを付けて，`toc-org-insert-toc'を実行すればOK</li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(autoload-if-found '(toc-org-insert-toc) <span style="color: #8b2252;">"toc-org"</span> nil t)
</pre>
</div>
</div>
</div>

<div id="outline-container-org4ca4749d" class="outline-3">
<h3 id="org4ca4749d"><span class="section-number-3">10.63.</span> <span class="todo TODO">TODO</span> [org-review.el] レビューフローのサポート</h3>
<div class="outline-text-3" id="text-org4ca4749d">
<ul class="org-ul">
<li><a href="https://github.com/brabalan/org-review">https://github.com/brabalan/org-review</a></li>
<li>以下の設定では， <code>org-agenda</code> 使用時に <code>C-c C-r r</code> で発動</li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp"># init-org.el
(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"org-agenda"</span>
  (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">org-review</span> nil t)
    (add-to-list 'org-agenda-custom-commands
                 '((<span style="color: #8b2252;">"r"</span> <span style="color: #8b2252;">"Review projects"</span> tags-todo <span style="color: #8b2252;">"-CANCELLED/"</span>
                    ((org-agenda-overriding-header <span style="color: #8b2252;">"Reviews Scheduled"</span>)
                     (org-agenda-skip-function 'org-review-agenda-skip)
                     (org-agenda-cmp-user-defined 'org-review-compare)
                     (org-agenda-sorting-strategy '(user-defined-down))))))
    (org-defkey org-agenda-mode-map <span style="color: #8b2252;">"\C-c\C-r"</span>
                'org-review-insert-last-review)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org0b29fe80" class="outline-3">
<h3 id="org0b29fe80"><span class="section-number-3">10.64.</span> REV2 [org-screenshot] スクリーンショットを貼り付ける</h3>
<div class="outline-text-3" id="text-org0b29fe80">
<ul class="org-ul">
<li><a href="https://github.com/dfeich/org-screenshot">dfeich/org-screenshot: screenshots integrated with emacs org mode attachments</a></li>
<li>macOSの場合， <code>screencapture</code> コマンドをキャプチャコマンドとして指定し，オプションに <code>-w</code> を付ければ，任意のウィンドウを指定してキャプチャし，それを保存，orgバッファに添付できる．</li>
<li class="on"><code>[X]</code> ファイル名が挿入されない（./.pngになる）</li>
<li class="off"><code>[&#xa0;]</code> org-attach の git ハンドリングと同期していない</li>
</ul>


<div id="org2c59180" class="figure">
<p><img src="data/4B/8A23F1-81EE-445B-8982-54B5FAB13645/screenshot-20180315-164532.png" alt="screenshot-20180315-164532.png" />
</p>
</div>

<p>
（How？）
</p>
<ul class="org-ul">
<li class="on"><code>[X]</code> 所定のウィンドウだけをキャプチャする方法</li>
<li class="on"><code>[X]</code> Emacs バッファを抜いてキャプチャする方法</li>
<li class="on"><code>[X]</code> Emacs だけキャプチャする方法</li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(org-attach-screenshot)
                         <span style="color: #8b2252;">"org-attach-screenshot"</span> nil t)
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"org-attach-screenshot"</span>
    (<span style="color: #a020f0;">when</span> (executable-find <span style="color: #8b2252;">"screencapture"</span>)
      (<span style="color: #a020f0;">setq</span> org-attach-screenshot-command-line <span style="color: #8b2252;">"screencapture -w %f"</span>))
    (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-org-attach-screenshot</span> ()
      (<span style="color: #a020f0;">interactive</span>)
      (org-attach-screenshot t (format-time-string
                                <span style="color: #8b2252;">"screenshot-%Y%m%d-%H%M%S.png"</span>)))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org0f4b6016" class="outline-3">
<h3 id="org0f4b6016"><span class="section-number-3">10.65.</span> <span class="done DONE">DONE</span> [org-autolist] ブリッツの入力を簡単に&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></h3>
<div class="outline-text-3" id="text-org0f4b6016">
<p>
ブリッツの入力や削除を Microsoft Word 的にします．意外と馴染まなかったので不使用です．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(org-autolist-mode)
                         <span style="color: #8b2252;">"org-autolist"</span> nil t)
  (add-hook 'org-mode-hook (<span style="color: #a020f0;">lambda</span> () (org-autolist-mode))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org39530542" class="outline-3">
<h3 id="org39530542"><span class="section-number-3">10.66.</span> <span class="done DONE">DONE</span> [MobileOrg] iOS との連携&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></h3>
<div class="outline-text-3" id="text-org39530542">
<ul class="org-ul">
<li><a href="http://orgmode.org/manual/Setting-up-the-staging-area.html">http://orgmode.org/manual/Setting-up-the-staging-area.html</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"org"</span>
  <span style="color: #b22222;">;;</span><span style="color: #b22222;">(setq org-mobile-files '("~/Dropbox/org/next.org" "1.org" "2.org"))</span>
  (<span style="color: #a020f0;">setq</span> org-mobile-files '(<span style="color: #8b2252;">"~/Dropbox/org/next.org"</span>))
  <span style="color: #b22222;">;;</span><span style="color: #b22222;">(setq org-mobile-force-id-on-agenda-items nil)</span>

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">Set a file to capture data from iOS devices</span>
  (<span style="color: #a020f0;">setq</span> org-mobile-inbox-for-pull (concat org-directory <span style="color: #8b2252;">"captured.org"</span>))

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">Upload location stored org files (index.org will be created)</span>
  (<span style="color: #a020f0;">setq</span> org-mobile-directory <span style="color: #8b2252;">"~/Dropbox/Apps/MobileOrg/"</span>)

  <span style="color: #b22222;">;;; </span><span style="color: #b22222;">Menu to push or pull org files using MobileOrg</span>
  (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">org-mobile-sync</span> ()
    (<span style="color: #a020f0;">interactive</span>)
    (<span style="color: #a020f0;">let</span>
        (org-mobile-sync-type
         (read-from-minibuffer
          <span style="color: #8b2252;">"How do you sync the org files? (pull or push) "</span>))
      (message <span style="color: #8b2252;">"%s"</span> org-mobile-sync-type)
      (<span style="color: #a020f0;">cond</span>
       ((string= <span style="color: #8b2252;">"pull"</span> org-mobile-sync-type) (org-mobile-pull))
       ((string= <span style="color: #8b2252;">"push"</span> org-mobile-sync-type) (org-mobile-push))))))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfb20898b" class="outline-3">
<h3 id="orgfb20898b"><span class="section-number-3">10.67.</span> <span class="done DONE">DONE</span> [org-export-generic] エクスポート機能を拡張する&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></h3>
<div class="outline-text-3" id="text-orgfb20898b">
<p>
<code>org-set-generic-type</code> を使うことで，エクスポート機能を好みに拡張できる．contrib の中の <code>org-export-generic.el</code> が必要なので注意する．
</p>

<p>
（注意）次の設定は古い内容．動かないかもしれません．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"org"</span>
  (org-set-generic-type
   <span style="color: #8b2252;">"textile"</span>
   '(<span style="color: #483d8b;">:file-suffix</span>
     <span style="color: #8b2252;">".textile"</span>
     <span style="color: #483d8b;">:key-binding</span> ?T
     <span style="color: #483d8b;">:title-format</span>    <span style="color: #8b2252;">"Title: %s\n\n"</span>
     <span style="color: #b22222;">;;   </span><span style="color: #b22222;">:date-format     "Date: %s\n"</span>
     <span style="color: #483d8b;">:date-export</span> nil
     <span style="color: #483d8b;">:toc-export</span>      nil
     <span style="color: #483d8b;">:author-export</span>   nil
     <span style="color: #483d8b;">:tags-export</span>     nil
     <span style="color: #483d8b;">:drawers-export</span>  nil
     <span style="color: #483d8b;">:date-export</span>     t
     <span style="color: #483d8b;">:timestamps-export</span>  t
     <span style="color: #483d8b;">:priorities-export</span>  nil
     <span style="color: #483d8b;">:todo-keywords-export</span> t
     <span style="color: #483d8b;">:body-line-fixed-format</span> <span style="color: #8b2252;">"\t%s\n"</span>
                                        <span style="color: #b22222;">;</span><span style="color: #b22222;">:body-list-prefix "\n"</span>
     <span style="color: #483d8b;">:body-list-format</span> <span style="color: #8b2252;">"* %s"</span>
     <span style="color: #483d8b;">:body-list-suffix</span> <span style="color: #8b2252;">"\n"</span>
     <span style="color: #483d8b;">:body-bullet-list-prefix</span> (<span style="color: #8b2252;">"* "</span> <span style="color: #8b2252;">"** "</span> <span style="color: #8b2252;">"*** "</span> <span style="color: #8b2252;">"**** "</span> <span style="color: #8b2252;">"***** "</span>)
     <span style="color: #483d8b;">:body-number-list-format</span> <span style="color: #8b2252;">"# %s"</span>
     <span style="color: #483d8b;">:body-number-list-suffix</span> <span style="color: #8b2252;">"\n"</span>
     <span style="color: #483d8b;">:header-prefix</span> (<span style="color: #8b2252;">""</span> <span style="color: #8b2252;">""</span> <span style="color: #8b2252;">"### "</span> <span style="color: #8b2252;">"#### "</span> <span style="color: #8b2252;">"##### "</span> <span style="color: #8b2252;">"###### "</span>)
     <span style="color: #483d8b;">:body-section-header-prefix</span> (<span style="color: #8b2252;">"h1. "</span> <span style="color: #8b2252;">"h2. "</span> <span style="color: #8b2252;">"h3. "</span> <span style="color: #8b2252;">"h4. "</span> <span style="color: #8b2252;">"h5. "</span> <span style="color: #8b2252;">"h6. "</span>)
     <span style="color: #483d8b;">:body-section-header-format</span> <span style="color: #8b2252;">"%s"</span>
     <span style="color: #483d8b;">:body-section-header-suffix</span> (<span style="color: #8b2252;">"\n\n"</span>)
     <span style="color: #483d8b;">:body-header-section-numbers</span> nil
     <span style="color: #483d8b;">:body-header-section-number-format</span> <span style="color: #8b2252;">"%s) "</span>
     <span style="color: #483d8b;">:body-line-format</span> <span style="color: #8b2252;">"%s\n"</span>
     <span style="color: #483d8b;">:body-newline-paragraph</span> <span style="color: #8b2252;">"\n"</span>
     <span style="color: #483d8b;">:bold-format</span> <span style="color: #8b2252;">"*%s*"</span>
     <span style="color: #483d8b;">:italic-format</span> <span style="color: #8b2252;">"_%s_"</span>
     <span style="color: #483d8b;">:underline-format</span> <span style="color: #8b2252;">"+%s+"</span>
     <span style="color: #483d8b;">:strikethrough-format</span> <span style="color: #8b2252;">"-%s-"</span>
     <span style="color: #483d8b;">:verbatim-format</span> <span style="color: #8b2252;">"`%s`"</span>
     <span style="color: #483d8b;">:code-format</span> <span style="color: #8b2252;">"@%s@"</span>
     <span style="color: #483d8b;">:body-line-wrap</span>   75
     <span style="color: #483d8b;">:blockquote-start</span> <span style="color: #8b2252;">"\n&lt;pre&gt;\n"</span>
     <span style="color: #483d8b;">:blockquote-end</span> <span style="color: #8b2252;">"\n&lt;/pre&gt;\n"</span>
     ))

  (org-set-generic-type
   <span style="color: #8b2252;">"markdown"</span>
   '(<span style="color: #483d8b;">:file-suffix</span>
     <span style="color: #8b2252;">".markdown"</span>
     <span style="color: #483d8b;">:key-binding</span>     ?M
     <span style="color: #483d8b;">:title-format</span>    <span style="color: #8b2252;">"Title: %s\n"</span>
     <span style="color: #483d8b;">:date-format</span>     <span style="color: #8b2252;">"Date: %s\n"</span>
     <span style="color: #483d8b;">:toc-export</span>      nil
     <span style="color: #483d8b;">:author-export</span>   t
     <span style="color: #483d8b;">:tags-export</span>     nil
     <span style="color: #483d8b;">:drawers-export</span>  nil
     <span style="color: #483d8b;">:date-export</span>     t
     <span style="color: #483d8b;">:timestamps-export</span>  t
     <span style="color: #483d8b;">:priorities-export</span>  nil
     <span style="color: #483d8b;">:todo-keywords-export</span> t
     <span style="color: #483d8b;">:body-line-fixed-format</span> <span style="color: #8b2252;">"\t%s\n"</span>
     <span style="color: #b22222;">;;</span><span style="color: #b22222;">:body-list-prefix "\n"</span>
     <span style="color: #483d8b;">:body-list-format</span> <span style="color: #8b2252;">"- %s"</span>
     <span style="color: #483d8b;">:body-list-suffix</span> <span style="color: #8b2252;">"\n"</span>
     <span style="color: #483d8b;">:header-prefix</span> (<span style="color: #8b2252;">""</span> <span style="color: #8b2252;">""</span> <span style="color: #8b2252;">"### "</span> <span style="color: #8b2252;">"#### "</span> <span style="color: #8b2252;">"##### "</span> <span style="color: #8b2252;">"###### "</span>)
     <span style="color: #483d8b;">:body-section-header-prefix</span> (<span style="color: #8b2252;">""</span> <span style="color: #8b2252;">""</span> <span style="color: #8b2252;">"### "</span> <span style="color: #8b2252;">"#### "</span> <span style="color: #8b2252;">"##### "</span> <span style="color: #8b2252;">"###### "</span>)
     <span style="color: #483d8b;">:body-section-header-format</span> <span style="color: #8b2252;">"%s\n"</span>
     <span style="color: #483d8b;">:body-section-header-suffix</span> (?= ?- <span style="color: #8b2252;">""</span>)
     <span style="color: #483d8b;">:body-header-section-numbers</span> nil
     <span style="color: #483d8b;">:body-header-section-number-format</span> <span style="color: #8b2252;">"%s) "</span>
     <span style="color: #483d8b;">:body-line-format</span> <span style="color: #8b2252;">"%s\n"</span>
     <span style="color: #483d8b;">:body-newline-paragraph</span> <span style="color: #8b2252;">"\n"</span>
     <span style="color: #483d8b;">:bold-format</span> <span style="color: #8b2252;">"**%s**"</span>
     <span style="color: #483d8b;">:italic-format</span> <span style="color: #8b2252;">"_%s_"</span>
     <span style="color: #483d8b;">:verbatim-format</span> <span style="color: #8b2252;">"`%s`"</span>
     <span style="color: #483d8b;">:code-format</span> <span style="color: #8b2252;">"`%s`"</span>
     <span style="color: #483d8b;">:body-line-wrap</span>   75
     )))
</pre>
</div>

<p>
<code>org-set-generic-type</code> を <code>.emacs</code> に追記した後， <code>C-c C-e g &lt;key-binding&gt;</code> とすればよい． <code>&lt;key-binding&gt;</code> は <code>org-set-generic-type</code> で設定する値である．2つ目は，Markdown へのエクスポーターである．
</p>
</div>
</div>

<div id="outline-container-org563f7076" class="outline-3">
<h3 id="org563f7076"><span class="section-number-3">10.68.</span> <span class="done DONE">DONE</span> org-mode の latex エクスポート関数をオーバーライド&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></h3>
<div class="outline-text-3" id="text-org563f7076">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;; </span><span style="color: #b22222;">Tex export (org-mode -&gt; tex with beamer class) ;;;;;;;;;;;;;;;;;;;;;;;;;;;;</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">(setq org-export-latex-classes</span>
<span style="color: #b22222;">;;   </span><span style="color: #b22222;">'(("article"</span>
<span style="color: #b22222;">;;      </span><span style="color: #b22222;">"\\documentclass[11pt]{article}</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">\\usepackage[AUTO]{inputenc}</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">\\usepackage[T1]{fontenc}</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">\\usepackage{graphicx}</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">\\usepackage{longtable}</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">\\usepackage{float}</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">\\usepackage{wrapfig}</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">\\usepackage{soul}</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">\\usepackage{amssymb}</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">\\usepackage{hyperref}"</span>
<span style="color: #b22222;">;;      </span><span style="color: #b22222;">("\\section{%s}" . "\\section*{%s}")</span>
<span style="color: #b22222;">;;      </span><span style="color: #b22222;">("\\subsection{%s}" . "\\subsection*{%s}")</span>
<span style="color: #b22222;">;;      </span><span style="color: #b22222;">("\\subsubsection{%s}" . "\\subsubsection*{%s}")</span>
<span style="color: #b22222;">;;      </span><span style="color: #b22222;">("\\paragraph{%s}" . "\\paragraph*{%s}")</span>
<span style="color: #b22222;">;;      </span><span style="color: #b22222;">("\\subparagraph{%s}" . "\\subparagraph*{%s}"))</span>
<span style="color: #b22222;">;;     </span><span style="color: #b22222;">("report"</span>
<span style="color: #b22222;">;;      </span><span style="color: #b22222;">"\\documentclass[11pt]{report}</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">\\usepackage[AUTO]{inputenc}</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">\\usepackage[T1]{fontenc}</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">\\usepackage{graphicx}</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">\\usepackage{longtable}</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">\\usepackage{float}</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">\\usepackage{wrapfig}</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">\\usepackage{soul}</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">\\usepackage{amssymb}</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">\\usepackage{hyperref}"</span>
<span style="color: #b22222;">;;      </span><span style="color: #b22222;">("\\part{%s}" . "\\part*{%s}")</span>
<span style="color: #b22222;">;;      </span><span style="color: #b22222;">("\\chapter{%s}" . "\\chapter*{%s}")</span>
<span style="color: #b22222;">;;      </span><span style="color: #b22222;">("\\section{%s}" . "\\section*{%s}")</span>
<span style="color: #b22222;">;;      </span><span style="color: #b22222;">("\\subsection{%s}" . "\\subsection*{%s}")</span>
<span style="color: #b22222;">;;      </span><span style="color: #b22222;">("\\subsubsection{%s}" . "\\subsubsection*{%s}"))</span>
<span style="color: #b22222;">;;     </span><span style="color: #b22222;">("book"</span>
<span style="color: #b22222;">;;      </span><span style="color: #b22222;">"\\documentclass[11pt]{book}</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">\\usepackage[AUTO]{inputenc}</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">\\usepackage[T1]{fontenc}</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">\\usepackage{graphicx}</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">\\usepackage{longtable}</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">\\usepackage{float}</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">\\usepackage{wrapfig}</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">\\usepackage{soul}</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">\\usepackage{amssymb}</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">\\usepackage{hyperref}"</span>
<span style="color: #b22222;">;;      </span><span style="color: #b22222;">("\\part{%s}" . "\\part*{%s}")</span>
<span style="color: #b22222;">;;      </span><span style="color: #b22222;">("\\chapter{%s}" . "\\chapter*{%s}")</span>
<span style="color: #b22222;">;;      </span><span style="color: #b22222;">("\\section{%s}" . "\\section*{%s}")</span>
<span style="color: #b22222;">;;      </span><span style="color: #b22222;">("\\subsection{%s}" . "\\subsection*{%s}")</span>
<span style="color: #b22222;">;;      </span><span style="color: #b22222;">("\\subsubsection{%s}" . "\\subsubsection*{%s}"))</span>
<span style="color: #b22222;">;;     </span><span style="color: #b22222;">("beamer"</span>
<span style="color: #b22222;">;;      </span><span style="color: #b22222;">"\\documentclass{beamer}</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">\\usepackage[AUTO]{inputenc}</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">\\usepackage{graphicx}</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">\\usepackage{longtable}</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">\\usepackage{float}</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">\\usepackage{wrapfig}</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">\\usepackage{amssymb}</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">\\usepackage{hyperref}"</span>
<span style="color: #b22222;">;;      </span><span style="color: #b22222;">org-beamer-sectioning)))</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org5fd484a3" class="outline-2">
<h2 id="org5fd484a3"><span class="section-number-2">11.</span> フレーム／ウィンドウ制御</h2>
<div class="outline-text-2" id="text-org5fd484a3">
</div>
<div id="outline-container-orgd05fc75a" class="outline-3">
<h3 id="orgd05fc75a"><span class="section-number-3">11.1.</span> 起動時の設定</h3>
<div class="outline-text-3" id="text-orgd05fc75a">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">cond</span>
 ((memq window-system '(mac ns)) <span style="color: #b22222;">;; </span><span style="color: #b22222;">for macOS</span>
  (<span style="color: #a020f0;">setq</span> initial-frame-alist
        (append
         '((alpha . (100 95))
           <span style="color: #b22222;">;; </span><span style="color: #b22222;">(top . 23)</span>
           <span style="color: #b22222;">;; </span><span style="color: #b22222;">(left . 0)</span>
           <span style="color: #b22222;">;; </span><span style="color: #b22222;">(vertical-scroll-bars . nil)</span>
           <span style="color: #b22222;">;; </span><span style="color: #b22222;">(internal-border-width . 20)</span>
           <span style="color: #b22222;">;; </span><span style="color: #b22222;">(outer-border-width . 20)</span>
           <span style="color: #b22222;">;; </span><span style="color: #b22222;">(ns-appearance . nil) ;; 26.1 {light, dark}</span>
           (ns-transparent-titlebar . t)) <span style="color: #b22222;">;; </span><span style="color: #b22222;">26.1</span>
         initial-frame-alist)))

 ((eq window-system 'x) <span style="color: #b22222;">;; </span><span style="color: #b22222;">for Linux</span>
  (<span style="color: #a020f0;">setq</span> initial-frame-alist
        (append
         '((vertical-scroll-bars . nil)
           (top . 0)
           (left . 0)
           (width . 80)
           (height . 38))
         initial-frame-alist)))

 ((eq window-system nil)
  nil)

 (t <span style="color: #b22222;">;; </span><span style="color: #b22222;">for Windows</span>
  (<span style="color: #a020f0;">setq</span> initial-frame-alist
        (append
         '((vertical-scroll-bars . nil)
           (top . 0)
           (left . 0)
           (width . 80)
           (height . 26))
         initial-frame-alist))))

<span style="color: #b22222;">;; </span><span style="color: #b22222;">Apply the initial setting to default</span>
(<span style="color: #a020f0;">setq</span> default-frame-alist initial-frame-alist)
(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"postpone"</span>
  (set-face-foreground 'vertical-border (face-foreground 'default))
  (set-face-background 'vertical-border (face-background 'default)))
<span style="color: #b22222;">;;</span><span style="color: #b22222;">(set-face-background 'fringe (face-background 'default)) ;; 10-20[ms]</span>
(set-face-background 'fringe <span style="color: #8b2252;">"#FFFFFF"</span>) <span style="color: #b22222;">;; </span><span style="color: #b22222;">10-20[ms]</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">&#12459;&#12540;&#12477;&#12523;&#12398;&#33394;</span>
(<span style="color: #a020f0;">defconst</span> <span style="color: #a0522d;">my-cur-color-ime</span> '(<span style="color: #483d8b;">:on</span> <span style="color: #8b2252;">"#FF9300"</span> <span style="color: #483d8b;">:off</span> <span style="color: #8b2252;">"#91C3FF"</span>))
(<span style="color: #a020f0;">defconst</span> <span style="color: #a0522d;">my-cur-type-ime</span> '(<span style="color: #483d8b;">:on</span> (bar . 2) <span style="color: #483d8b;">:off</span> (bar . 2) <span style="color: #483d8b;">:invisible</span> nil))
(<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">my-ime-last</span> nil)

(<span style="color: #a020f0;">if</span> (fboundp 'mac-ime-active-p)
    (<span style="color: #a020f0;">defalias</span> '<span style="color: #0000ff;">my-ime-active-p</span> 'mac-ime-active-p)
  (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-ime-active-p</span> () current-input-method))

(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-ime-on-cursor</span> ()
  (<span style="color: #a020f0;">interactive</span>)
  (<span style="color: #a020f0;">setq</span> cursor-type (plist-get my-cur-type-ime <span style="color: #483d8b;">:on</span>))
  (set-cursor-color (plist-get my-cur-color-ime <span style="color: #483d8b;">:on</span>)))

(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-ime-off-cursor</span> ()
  (<span style="color: #a020f0;">interactive</span>)
  (<span style="color: #a020f0;">setq</span> cursor-type (plist-get my-cur-type-ime <span style="color: #483d8b;">:off</span>))
  (set-cursor-color (plist-get my-cur-color-ime <span style="color: #483d8b;">:off</span>)))

(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-ime-invisible-cursor</span> ()
  (<span style="color: #a020f0;">interactive</span>)
  (<span style="color: #a020f0;">setq</span> cursor-type (plist-get my-cur-type-ime <span style="color: #483d8b;">:invisible</span>)))

(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-apply-cursor-config</span> ()
  (<span style="color: #a020f0;">interactive</span>)
  (<span style="color: #a020f0;">when</span> (display-graphic-p)
    (<span style="color: #a020f0;">if</span> (my-ime-active-p) (my-ime-on-cursor) (my-ime-off-cursor))))

<span style="color: #b22222;">;; </span><span style="color: #b22222;">for init setup</span>
(<span style="color: #a020f0;">setq-default</span> cursor-type (plist-get my-cur-type-ime <span style="color: #483d8b;">:on</span>))
(<span style="color: #a020f0;">unless</span> noninteractive
  (add-hook 'buffer-list-update-hook #'my-apply-cursor-config)
  (my-apply-cursor-config))
(add-hook 'input-method-activate-hook #'my-ime-on-cursor)
(add-hook 'input-method-deactivate-hook #'my-ime-off-cursor)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-ime-on</span> ()
  (<span style="color: #a020f0;">interactive</span>)
  (<span style="color: #a020f0;">if</span> (fboundp 'mac-ime-activate)
      (mac-ime-activate)
        (activate-input-method default-input-method))
  (<span style="color: #a020f0;">setq</span> my-ime-last t))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-ime-off</span> ()
  (<span style="color: #a020f0;">interactive</span>)
  (<span style="color: #a020f0;">if</span> (fboundp 'mac-ime-deactivate)
      (mac-ime-deactivate)
          (deactivate-input-method))
  (<span style="color: #a020f0;">setq</span> my-ime-last nil))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-ime-on-sticky</span> ()
  (<span style="color: #a020f0;">when</span> my-ime-before-action
          (my-ime-on)))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-ime-off-sticky</span> ()
  (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">setq</span> my-ime-before-action (my-ime-active-p))
          (my-ime-off)))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">(defun ad:find-file (FILENAME &amp;optional WILDCARDS)</span>
<span style="color: #b22222;">;;   </span><span style="color: #b22222;">"Extension to find-file as before-find-file-hook."</span>
<span style="color: #b22222;">;;   </span><span style="color: #b22222;">(message "--- ad:findfile")</span>
<span style="color: #b22222;">;;   </span><span style="color: #b22222;">(apply FILENAME WILDCARDS))</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">(advice-add #'find-file :around #'ad:find-file)</span>

<span style="color: #b22222;">;; </span><span style="color: #b22222;">http://tezfm.blogspot.jp/2009/11/cocoa-emacs.html</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">&#12496;&#12483;&#12501;&#12449;&#20999;&#26367;&#26178;&#12395; input method &#12434;&#20999;&#12426;&#26367;&#12360;&#12427;</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">(with-eval-after-load "postpone"</span>
<span style="color: #b22222;">;;   </span><span style="color: #b22222;">(when (and (fboundp 'mac-handle-input-method-change)</span>
<span style="color: #b22222;">;;              </span><span style="color: #b22222;">(require 'cl nil t))</span>
<span style="color: #b22222;">;;     </span><span style="color: #b22222;">(add-hook</span>
<span style="color: #b22222;">;;      </span><span style="color: #b22222;">'post-command-hook</span>
<span style="color: #b22222;">;;      </span><span style="color: #b22222;">(lexical-let ((previous-buffer nil))</span>
<span style="color: #b22222;">;;        </span><span style="color: #b22222;">(message "Change IM %S -&gt; %S" previous-buffer (current-buffer))</span>
<span style="color: #b22222;">;;        </span><span style="color: #b22222;">(lambda ()</span>
<span style="color: #b22222;">;;            </span><span style="color: #b22222;">(unless (eq (current-buffer) previous-buffer)</span>
<span style="color: #b22222;">;;              </span><span style="color: #b22222;">(when (bufferp previous-buffer)</span>
<span style="color: #b22222;">;;                </span><span style="color: #b22222;">(mac-handle-input-method-change))</span>
<span style="color: #b22222;">;;              </span><span style="color: #b22222;">(setq previous-buffer (current-buffer))))))))</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (memq window-system '(ns x))
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#12514;&#12540;&#12489;&#12521;&#12452;&#12531;&#12395;&#12450;&#12452;&#12467;&#12531;&#12434;&#20986;&#12377;</span>
  (make-face 'mode-line-ime-on-face)
  (set-face-attribute 'mode-line-ime-on-face
                      nil <span style="color: #483d8b;">:foreground</span> (plist-get my-cur-color-ime <span style="color: #483d8b;">:on</span>))
  (<span style="color: #a020f0;">when</span> (fboundp 'mac-set-input-method-parameter)
    (mac-set-input-method-parameter
     <span style="color: #8b2252;">"com.google.inputmethod.Japanese.base"</span> 'title
     (concat
            (<span style="color: #a020f0;">if</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">icons-in-terminal</span> nil t)
          (icons-in-terminal-octicon <span style="color: #8b2252;">"keyboard"</span>
                                     <span style="color: #483d8b;">:v-adjust</span> 0.0
                                     <span style="color: #483d8b;">:face</span> 'mode-line-ime-on-face)
        <span style="color: #8b2252;">""</span>) <span style="color: #ff0000; font-weight: bold;">" "</span><span style="color: #ff0000; font-weight: bold;">))) </span><span style="color: #ff0000; font-weight: bold;">;; </span><span style="color: #ff0000; font-weight: bold;">FIXME (the color is NOT changed, patch is wrong?)</span>

  (<span style="color: #a020f0;">declare-function</span> my-ime-on <span style="color: #8b2252;">"init"</span> nil)
  (<span style="color: #a020f0;">declare-function</span> my-ime-off <span style="color: #8b2252;">"init"</span> nil)
  (<span style="color: #a020f0;">declare-function</span> my-ime-active-p <span style="color: #8b2252;">"init"</span> nil)

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">for private patch</span>
  (<span style="color: #a020f0;">when</span> (boundp 'mac-ime-cursor-type)
    (<span style="color: #a020f0;">setq</span> mac-ime-cursor-type (plist-get my-cur-type-ime <span style="color: #483d8b;">:on</span>)))

  (<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">my-ime-last</span> (my-ime-active-p))
  (<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">my-ime-before-action</span> nil)

  (<span style="color: #a020f0;">if</span> (not (fboundp 'mac-ime-active-p))
            (<span style="color: #a020f0;">progn</span>
              <span style="color: #b22222;">;; </span><span style="color: #b22222;">For selected.el</span>
              (add-hook 'activate-mark-hook #'my-ime-off-sticky)
              (add-hook 'deactivate-mark-hook #'my-ime-on-sticky)
              <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#12300;M-x &#12354;&#12301;&#23550;&#31574;</span>
              (add-hook 'minibuffer-setup-hook #'my-ime-off-sticky)
              (add-hook 'minibuffer-exit-hook #'my-ime-on-sticky))
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">For selected.el</span>
    (add-hook 'activate-mark-hook #'mac-ime-deactivate-sticky)
    (add-hook 'deactivate-mark-hook #'mac-ime-activate-sticky)))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">EMP: Emacs Mac Port</span>
(<span style="color: #a020f0;">when</span> (eq window-system 'mac)
  (<span style="color: #a020f0;">when</span> (fboundp 'mac-input-source)
    (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-mac-keyboard-input-source</span> () <span style="color: #b22222;">;; </span><span style="color: #b22222;">Need update</span>
            (<span style="color: #a020f0;">if</span> (string-match <span style="color: #8b2252;">"\\.Roman$"</span> (mac-input-source))
                (<span style="color: #a020f0;">progn</span>
                  (<span style="color: #a020f0;">setq</span> cursor-type (plist-get my-cur-type-ime <span style="color: #483d8b;">:off</span>))
                  (add-to-list 'default-frame-alist
                                           `(cursor-type . ,(plist-get my-cur-type-ime <span style="color: #483d8b;">:off</span>)))
                  (set-cursor-color (plist-get my-cur-color-ime <span style="color: #483d8b;">:off</span>)))
              (<span style="color: #a020f0;">progn</span>
                (<span style="color: #a020f0;">setq</span> cursor-type (plist-get my-cur-type-ime <span style="color: #483d8b;">:on</span>))
                (add-to-list 'default-frame-alist
                                         `(cursor-type . ,(plist-get my-cur-type-ime <span style="color: #483d8b;">:on</span>)))
                (set-cursor-color (plist-get my-cur-color-ime <span style="color: #483d8b;">:on</span>)))))

    (<span style="color: #a020f0;">when</span> (fboundp 'mac-auto-ascii-mode)
            <span style="color: #b22222;">;; </span><span style="color: #b22222;">(mac-auto-ascii-mode 1)</span>
            <span style="color: #b22222;">;; </span><span style="color: #b22222;">IME ON/OFF &#12391;&#12459;&#12540;&#12477;&#12523;&#12398;&#31278;&#21029;&#12420;&#33394;&#12434;&#26367;&#12360;&#12427;</span>
            (add-hook 'mac-selected-keyboard-input-source-change-hook
                            #'my-mac-keyboard-input-source)
            <span style="color: #b22222;">;; </span><span style="color: #b22222;">IME ON &#12398;&#33521;&#35486;&#20837;&#21147;&#65291;&#27770;&#23450;&#24460;&#12391;&#12418;&#12459;&#12540;&#12477;&#12523;&#12398;&#31278;&#21029;&#12420;&#33394;&#12434;&#26367;&#12360;&#12427;</span>
            <span style="color: #b22222;">;; </span><span style="color: #b22222;">(add-hook 'mac-enabled-keyboard-input-sources-change-hook</span>
            <span style="color: #b22222;">;;           </span><span style="color: #b22222;">#'my-mac-keyboard-input-source)</span>
            (<span style="color: #a020f0;">declare-function</span> my-mac-keyboard-input-source <span style="color: #8b2252;">"init"</span> nil)
            (my-mac-keyboard-input-source))))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdffe4e49" class="outline-3">
<h3 id="orgdffe4e49"><span class="section-number-3">11.2.</span> 複数フレーム対応</h3>
<div class="outline-text-3" id="text-orgdffe4e49">
<p>
フレームを複数使う場合の設定です．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">ad:make-frame</span> (<span style="color: #228b22;">&amp;optional</span> _parameters)
  (<span style="color: #a020f0;">when</span> (display-graphic-p)
    (my-theme)
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">(my-apply-cursor-config)</span>
    (<span style="color: #a020f0;">setq-default</span> cursor-type
                  (<span style="color: #a020f0;">if</span> (my-ime-active-p)
                      (plist-get my-cur-type-ime <span style="color: #483d8b;">:on</span>)
                    (plist-get my-cur-type-ime <span style="color: #483d8b;">:off</span>)))
    (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">and</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">moom-font</span> nil t)
               (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">moom</span> nil t))
      (moom-font-resize))))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(global-set-key (kbd <span style="color: #8b2252;">"M-`"</span>) 'other-frame)
(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"frame"</span>
  (advice-add 'make-frame <span style="color: #483d8b;">:after</span> #'ad:make-frame))
</pre>
</div>
</div>
</div>

<div id="outline-container-org5f12ba92" class="outline-3">
<h3 id="org5f12ba92"><span class="section-number-3">11.3.</span> [moom.el] キーボードでフレームの場所を移す</h3>
<div class="outline-text-3" id="text-org5f12ba92">
<p>
(2017-07-30) frame-ctr から moom.el にリネームしました．Moom は，Many Tricks がリリースするソフトウェアで，今後はこのソフトウェアのポーティングを目指します．
</p>

<p>
拙作の <a href="https://github.com/takaxp/moom">moom.el</a> を使います．
</p>

<p>
ビルトインに <code>face-remap</code> があり，アスキーフォントは <code>C-x C--</code> と <code>C-x C-=</code> で拡大縮小を制御できます．以下のキーバインドは，face-remap.el が提供する text-scale-adjust のキーバインドを上書きします． <code>text-scale-adjust</code> をそのまま使っても，日本語フォントが制御されないので，オーバーライドしてしまってもOKだと思います．
</p>

<p>
近しいパッケージに， <code>WindMove</code> と <code>FrameMove</code> がありますが，これらは基本的にカーソルの移動を目的にしています．
</p>

<ul class="org-ul">
<li><a href="https://www.emacswiki.org/emacs/WindMove">{Home} Wind Move</a> (ビルトイン)
<ul class="org-ul">
<li>ウィンドウ間のカーソル移動を改善</li>
</ul></li>
<li><a href="https://www.emacswiki.org/emacs/FrameMove">{Home} Frame Move</a>
<ul class="org-ul">
<li>フレーム間のカーソル移動を改善</li>
</ul></li>
</ul>

<p>
また類似のパッケージに <code>frame-cmds</code> があります．
</p>

<ol class="org-ol">
<li><a href="http://www.emacswiki.org/emacs/download/frame-cmds.el">http://www.emacswiki.org/emacs/download/frame-cmds.el</a></li>
<li><a href="http://www.emacswiki.org/emacs/download/frame-fns.el">http://www.emacswiki.org/emacs/download/frame-fns.el</a></li>
</ol>

<p>
<code>moom-autuloads</code> に必要なコマンドを <del>羅列していますが，</del> <code>melpa</code> でインストールする場合は関係ありません．パッケージ内で autoload 指定してあります． <code>with-eval-after-load</code> の中だけを設定すれば十分です．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">defconst</span> <span style="color: #a0522d;">moom-autoloads</span>
  '(moom-cycle-frame-height
    moom-move-frame-to-edge-top moom-move-frame my-frame-reset
    moom-toggle-frame-maximized moom-move-frame-to-edge-right
    moom-move-frame-to-center moom-move-frame-right moom-move-frame-left
    moom-fill-display-band moom-move-frame-to-edge-right moom-fill-band
    moom-change-frame-width moom-change-frame-width-double
    moom-change-frame-width-single moom-change-frame-width-half-again
    moom-cycle-monitors))

(<span style="color: #a020f0;">when</span> (autoload-if-found moom-autoloads
                         <span style="color: #8b2252;">"moom"</span> nil t)
  (global-set-key (kbd <span style="color: #8b2252;">"C-1"</span>) 'moom-move-frame-to-edge-top)
  (global-set-key (kbd <span style="color: #8b2252;">"C-!"</span>) 'moom-move-frame-to-edge-bottom)
  (global-set-key (kbd <span style="color: #8b2252;">"C-2"</span>) 'moom-cycle-frame-height)
  (global-set-key (kbd <span style="color: #8b2252;">"M-2"</span>) 'moom-move-frame-to-center)
  (global-set-key (kbd <span style="color: #8b2252;">"M-9"</span>) 'moom-cycle-monitors)

  (autoload 'moom-transient-dispatch <span style="color: #8b2252;">"moom-transient"</span> nil t)
  (global-set-key (kbd <span style="color: #8b2252;">"C-c o"</span>) #'moom-transient-dispatch)

  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"moom-transient"</span>
    (moom-transient-hide-cursor)
    (<span style="color: #a020f0;">setq</span> moom-transient-dispatch-sticky nil)
    (advice-add 'moom-transient-dispatch <span style="color: #483d8b;">:after</span> #'my-ime-off)) <span style="color: #b22222;">;; </span><span style="color: #b22222;">FIXME</span>

  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"moom"</span>
    (add-hook 'moom-split-window-hook #'dimmer-permanent-off)
    (add-hook 'moom-delete-window-hook #'dimmer-on)
    (add-hook 'moom-after-select-monitor-hook #'moom-move-frame-to-center)

    <span style="color: #b22222;">;; </span><span style="color: #b22222;">(define-key moom-mode-map (kbd "C-c C-&lt;") 'moom-move-frame-to-edge-left)</span>
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">(define-key moom-mode-map (kbd "C-c C-&gt;") 'moom-move-frame-to-edge-right)</span>

    (custom-set-variables
     '(moom-command-with-centering nil)
     '(moom-lighter <span style="color: #8b2252;">"M"</span>)
     '(moom-verbose t))
    (moom-recommended-keybindings '(all wof))
    (moom-mode 1)
    (my-font-config)))  <span style="color: #b22222;">;; </span><span style="color: #b22222;">this could increase `</span><span style="color: #008b8b;">postpone-pre-init-time</span><span style="color: #b22222;">'.</span>

(<span style="color: #a020f0;">when</span> (autoload-if-found '(moom-font-increase
                           moom-font-decrease
                           moom-font-size-reset moom-font-resize)
                         <span style="color: #8b2252;">"moom-font"</span> nil t)
  (add-hook 'moom-font-after-resize-hook #'moom-move-frame-to-edge-top)
  (add-hook 'moom-font-after-resize-hook #'moom-fill-height)
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"moom-font"</span>
    (custom-set-variables
     '(moom-scaling-gradient (/ (float 50) 30))
     '(moom-font-table
       '((50 30) (49 29) (48 29) (47 28) (46 28) (45 27) (44 26) (43 26)
         (42 25) (41 25) (40 24) (39 23) (38 23) (37 22) (36 22) (35 21)
         (34 20) (33 20) (32 19) (31 19) (30 18) (29 17) (28 17) (27 16)
         (26 16) (25 15) (24 14) (23 14) (22 13) (21 13) (20 12) (19 11)
         (18 11) (17 10) (16 10) (15 9) (14 8) (13 8) (12 7) (11 7) (10 6)
         (9 5) (8 5) (7 4) (6 4) (5 3))))))
</pre>
</div>
</div>

<div id="outline-container-org6e3c20dd" class="outline-4">
<h4 id="org6e3c20dd"><span class="section-number-4">11.3.1.</span> 最大化時にモードラインを消す</h4>
<div class="outline-text-4" id="text-org6e3c20dd">
<p>
バッファの切替時にモードラインの状態を引き継ぐこともできますが，とりあえず想定外にしています．代わりに，必要ならば <code>M-x my-moom-toggle-mode-line</code> で表示可能にしています．
</p>

<p>
マイナーモードとして扱えるようにするには，Bastien氏の記事が参考になります．
</p>

<ul class="org-ul">
<li><a href="https://emacs-doctor.com/emacs-hide-mode-line.html">Emacs mode for hiding the mode-line</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-toggle-modeline-global</span> ()
  (<span style="color: #a020f0;">interactive</span>)
  (<span style="color: #a020f0;">setq</span> my-toggle-modeline-global (not my-toggle-modeline-global))
  (<span style="color: #a020f0;">if</span> my-toggle-modeline-global
      (my-mode-line-on)
    (my-mode-line-off)))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-mode-line-off</span> ()
  <span style="color: #8b2252;">"Turn off mode line."</span>
  (<span style="color: #a020f0;">when</span> (fboundp 'dimmer-on)
    (dimmer-on))
  (<span style="color: #a020f0;">when</span> (fboundp 'pomodoro:visualize-stop)
    (pomodoro:visualize-stop))
  (<span style="color: #a020f0;">when</span> mode-line-format
    (<span style="color: #a020f0;">setq</span> my-mode-line-format mode-line-format))
  (<span style="color: #a020f0;">setq</span> mode-line-format nil))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-mode-line-on</span> ()
  <span style="color: #8b2252;">"Turn on mode line."</span>
  (<span style="color: #a020f0;">when</span> (fboundp 'dimmer-off)
    (dimmer-off))
  (<span style="color: #a020f0;">when</span> (fboundp 'pomodoro:visualize-start)
    (pomodoro:visualize-start))
  (<span style="color: #a020f0;">unless</span> my-mode-line-format
    (<span style="color: #ff0000; font-weight: bold;">error</span> <span style="color: #8b2252;">"Invalid value: %s"</span> my-mode-line-format))
  (<span style="color: #a020f0;">setq</span> mode-line-format my-mode-line-format)
  (redraw-frame))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-toggle-mode-line</span> ()
  <span style="color: #8b2252;">"Toggle mode line."</span>
  (<span style="color: #a020f0;">interactive</span>)
  (<span style="color: #a020f0;">if</span> mode-line-format
      (my-mode-line-off)
    (my-mode-line-on))
  (message <span style="color: #8b2252;">"%s"</span> (<span style="color: #a020f0;">if</span> mode-line-format <span style="color: #8b2252;">"( &#9593; &#9697;&#9593;)&#65346; ON !"</span> <span style="color: #8b2252;">"( &#9593; ^&#9593;)&#65360; OFF!"</span>)))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">ad:moom-toggle-frame-maximized</span> ()
    (<span style="color: #a020f0;">when</span> (eq major-mode 'org-mode)
      (org-redisplay-inline-images))
    (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">and</span> mode-line-format
               (not my-toggle-modeline-global))
      (my-mode-line-off)))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(global-set-key (kbd <span style="color: #8b2252;">"&lt;f12&gt;"</span>) 'my-toggle-mode-line)
(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"moom"</span>
  (advice-add 'moom-toggle-frame-maximized
              <span style="color: #483d8b;">:after</span> #'ad:moom-toggle-frame-maximized))

<span style="color: #b22222;">;; </span><span style="color: #b22222;">(make-variable-buffer-local 'my-mode-line-format)</span>
(<span style="color: #a020f0;">defvar-local</span> <span style="color: #a0522d;">my-mode-line-format</span> nil)
(set-default 'my-mode-line-format mode-line-format)
(<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">my-toggle-modeline-global</span> t)
(<span style="color: #a020f0;">unless</span> (display-graphic-p)
  (<span style="color: #a020f0;">setq</span> my-toggle-modeline-global t)) <span style="color: #b22222;">;; </span><span style="color: #b22222;">Enforce modeline in Terminal</span>

(add-hook 'find-file-hook
          (<span style="color: #a020f0;">lambda</span> () (<span style="color: #a020f0;">unless</span> my-toggle-modeline-global
                       (<span style="color: #a020f0;">if</span> shutup-p
                           (shut-up (my-mode-line-off))
                         (my-mode-line-off))))
          t) <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#20182;&#12398;&#35373;&#23450;&#65288;olivetti.el&#12394;&#12393;&#65289;&#12392;&#12406;&#12388;&#12363;&#12427;&#12398;&#12391;&#26368;&#24460;&#12395;&#36861;&#21152;</span>

<span style="color: #b22222;">;; </span><span style="color: #b22222;">init</span>
(<span style="color: #a020f0;">unless</span> noninteractive
  (my-mode-line-off))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org33fd785f" class="outline-3">
<h3 id="org33fd785f"><span class="section-number-3">11.4.</span> [winner.el] ウィンドウ構成の履歴を辿る</h3>
<div class="outline-text-3" id="text-org33fd785f">
<ul class="org-ul">
<li>ビルトインの <code>winner.el</code> を使います．</li>
</ul>

<p>
ウィンドウ分割状況と各ウィンドウで表示していたバッファの履歴を辿ることができます． <code>winner-undo</code> で直前の状態に戻せます．例えば，誤って <code>C-x 0</code> で分割ウィンドウを閉じた時にも，即座に元の状態に戻すことが可能です．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">ad:winner:delete-window</span> (<span style="color: #228b22;">&amp;optional</span> _window)
  (message <span style="color: #8b2252;">"Undo? M-x winner-undo or type \"C-x g\""</span>))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">unless</span> noninteractive
  (<span style="color: #a020f0;">when</span> (autoload-if-found '(winner-undo)
                           <span style="color: #8b2252;">"winner"</span> nil t)
    (global-set-key (kbd <span style="color: #8b2252;">"C-x g"</span>) 'winner-undo)
    (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"winner"</span>
      (advice-add 'delete-window <span style="color: #483d8b;">:after</span> #'ad:winner:delete-window)
      (define-key winner-mode-map (kbd <span style="color: #8b2252;">"C-("</span>) 'winner-undo)
      (define-key winner-mode-map (kbd <span style="color: #8b2252;">"C-)"</span>) 'winner-redo)
      (winner-mode 1))))
</pre>
</div>
</div>
</div>

<div id="outline-container-orga9be167a" class="outline-3">
<h3 id="orga9be167a"><span class="section-number-3">11.5.</span> <span class="todo TODO">TODO</span> [shackle.el] ポップアップウィンドウの制御&#xa0;&#xa0;&#xa0;<span class="tag"><span class="Ongoing">Ongoing</span></span></h3>
<div class="outline-text-3" id="text-orga9be167a">
<ul class="org-ul">
<li>popwin の後発パッケージ</li>
<li>popwin.el にある <code>dedicated</code> が使えないので，本当に移行するか検討中．
<ul class="org-ul">
<li>ウィンドウからフォーカスが外れた時に自動的にウィンドウを消す機能</li>
</ul></li>
<li>以下の設定では，パッケージ読み込みのトリガーを <code>postpone</code> にひも付け</li>
<li>align がないと，size が効かない？</li>
<li>バッファ名に正規表現を使う時は，regexpが必要．</li>
<li>org関連でディスパッチャとそれを経由するバッファは制御が効かない？</li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-shackle-activate</span> ()
  (shackle-mode 1)
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">(remove-hook 'window-configuration-change-hook #'my-shackle-activate)</span>
  (remove-hook 'find-file-hook #'my-shackle-activate))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(shackle-mode)
                         <span style="color: #8b2252;">"shackle"</span> nil t)

  (<span style="color: #a020f0;">unless</span> noninteractive
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">(add-hook 'window-configuration-change-hook #'my-shackle-activate)</span>
    (add-hook 'find-file-hook #'my-shackle-activate))

  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"shackle"</span>
    (<span style="color: #a020f0;">setq</span> shackle-default-ratio 0.33)
    (<span style="color: #a020f0;">setq</span> shackle-rules
                '((<span style="color: #8b2252;">"*osx-dictionary*"</span> <span style="color: #483d8b;">:align</span> above <span style="color: #483d8b;">:popup</span> t)
                  (<span style="color: #8b2252;">"*wclock*"</span> <span style="color: #483d8b;">:align</span> above <span style="color: #483d8b;">:popup</span> t <span style="color: #483d8b;">:select</span> t)
                  <span style="color: #b22222;">;; </span><span style="color: #b22222;">("*Help*" :align t :select 'above :popup t :size 0.3)</span>
                  (<span style="color: #8b2252;">"*Checkdoc Status*"</span> <span style="color: #483d8b;">:align</span> above <span style="color: #483d8b;">:popup</span> t <span style="color: #483d8b;">:noselect</span> t)))))
</pre>
</div>
</div>

<div id="outline-container-org32b579df" class="outline-4">
<h4 id="org32b579df"><span class="section-number-4">11.5.1.</span> checkdoc.el 用の追加設定</h4>
<div class="outline-text-4" id="text-org32b579df">
<p>
<code>M-x checkdoc</code> 実行時に <code>checkdoc-minor-mode-map</code> に checkdoc のウィンドウを閉じるキーバインドを設定． <code>q</code> または <code>C-g</code> を押下すると，マイナーモードが終了し，設定したキーバインドが無効になる．マイナーモードが有効な間は， <code>q</code> が占有されてバッファに入力できなくなる．その場合は，必要に応じて <code>M-x my-delete-checkdoc-window</code> を実行する．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-delete-checkdoc-window</span> ()
  (<span style="color: #a020f0;">interactive</span>)
  (<span style="color: #a020f0;">let</span> ((checkdoc-window (get-buffer-window <span style="color: #8b2252;">"*Checkdoc Status*"</span>)))
    (<span style="color: #a020f0;">when</span> checkdoc-window
      (delete-window checkdoc-window)))
  (checkdoc-minor-mode -1))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">ad:checkdoc</span> ()
  (<span style="color: #a020f0;">interactive</span>)
  (define-key checkdoc-minor-mode-map (kbd <span style="color: #8b2252;">"q"</span>) 'my-delete-checkdoc-window)
  (define-key checkdoc-minor-mode-map (kbd <span style="color: #8b2252;">"C-g"</span>) 'my-delete-checkdoc-window)
  (checkdoc-minor-mode 1))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"checkdoc"</span>
  (advice-add 'checkdoc <span style="color: #483d8b;">:before</span> #'ad:checkdoc))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgdca5e7c2" class="outline-3">
<h3 id="orgdca5e7c2"><span class="section-number-3">11.6.</span> <span class="todo TODO">TODO</span> [doom-modeline.el] モードラインをリッチにする</h3>
<div class="outline-text-3" id="text-orgdca5e7c2">
<ul class="org-ul">
<li><a href="https://github.com/seagle0128/doom-modeline">seagle0128/doom-modeline: A minimal and modern mode-line</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">ad:doom-modeline-buffer-file-state-icon</span>
    (icon <span style="color: #228b22;">&amp;optional</span> text face height voffset)
  <span style="color: #8b2252;">"Displays an ICON with FACE, HEIGHT and VOFFSET.</span>
<span style="color: #8b2252;">TEXT is the alternative if it is not applicable.</span>
<span style="color: #8b2252;">Uses `</span><span style="color: #008b8b;">all-the-icons-material</span><span style="color: #8b2252;">' to fetch the icon."</span>
  (<span style="color: #a020f0;">if</span> doom-modeline-icon
      (<span style="color: #a020f0;">when</span> icon
        (doom-modeline-icon-material
         icon
         <span style="color: #483d8b;">:face</span> face
         <span style="color: #483d8b;">:height</span> (<span style="color: #a020f0;">or</span> height 0.85) <span style="color: #b22222;">;; </span><span style="color: #b22222;">1.1</span>
         <span style="color: #483d8b;">:v-adjust</span> (<span style="color: #a020f0;">or</span> voffset -0.225))) <span style="color: #b22222;">;; </span><span style="color: #b22222;">-0.225</span>
    (<span style="color: #a020f0;">when</span> text
      (propertize text 'face face))))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"moom"</span>
  (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">and</span> (not noninteractive)
             (eq my-toggle-modeline-global 'doom)
             (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">doom-modeline</span> nil t))
    (custom-set-variables
     '(doom-modeline-buffer-file-name-style 'truncate-except-project)
     '(doom-modeline-bar-width 1)
     '(doom-modeline-height (<span style="color: #a020f0;">let</span> ((font (face-font 'mode-line)))
                              (<span style="color: #a020f0;">if</span> (<span style="color: #a020f0;">and</span> font (fboundp 'font-info))
                                  (floor (* 0.8 <span style="color: #b22222;">;; </span><span style="color: #b22222;">1.0</span>
                                            (* 2 (aref (font-info font) 2))))
                                10)))
     '(doom-modeline-minor-modes t))
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">(declare-function ad:doom-modeline-buffer-file-state-icon "init" nil)</span>
    (advice-add 'doom-modeline-buffer-file-state-icon <span style="color: #483d8b;">:override</span>
                #'ad:doom-modeline-buffer-file-state-icon)
    (size-indication-mode 1)
    (doom-modeline-mode 1)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org4dd0671c" class="outline-3">
<h3 id="org4dd0671c"><span class="section-number-3">11.7.</span> [e2wm.el] 二画面表示&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></h3>
<div class="outline-text-3" id="text-org4dd0671c">
<p>
使用頻度が低くなりました．
</p>

<ol class="org-ol">
<li><a href="http://github.com/kiwanami/emacs-window-manager/raw/master/e2wm.el">http://github.com/kiwanami/emacs-window-manager/raw/master/e2wm.el</a></li>
<li><a href="http://github.com/kiwanami/emacs-window-layout/raw/master/window-layout.el">http://github.com/kiwanami/emacs-window-layout/raw/master/window-layout.el</a></li>
</ol>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(my-e2wm:dp-two e2wm:dp-two e2wm:start-management)
                         <span style="color: #8b2252;">"e2wm"</span> nil t)
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"e2wm"</span>
    (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-e2wm:dp-two</span> ()
      (<span style="color: #a020f0;">interactive</span>)
      (e2wm:dp-two)
      (<span style="color: #a020f0;">setq</span> e2wm:c-two-recipe
            '(- (<span style="color: #483d8b;">:lower-size</span> 10)
                (| left right)
                sub))
      (<span style="color: #a020f0;">setq</span> e2wm:c-two-winfo
            '((<span style="color: #483d8b;">:name</span> left )
              (<span style="color: #483d8b;">:name</span> right )
              (<span style="color: #483d8b;">:name</span> sub <span style="color: #483d8b;">:default-hide</span> t)))

      <span style="color: #b22222;">;; </span><span style="color: #b22222;">left, prev</span>
      (<span style="color: #a020f0;">setq</span> e2wm:c-two-right-default 'left))

    <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#39640;&#12373;&#12434;&#30011;&#38754;&#12398;&#26368;&#22823;&#12395;&#30703;&#27491;</span>
    (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">moom</span> nil t)
      (<span style="color: #a020f0;">setq</span> moom-frame-height-tall (moom-max-frame-height))
      (<span style="color: #a020f0;">setq</span> moom-frame-height-small moom-frame-height-tall))

    <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#24133;&#12434;&#30011;&#38754;&#12398;&#26368;&#22823;&#12395;&#30703;&#27491;</span>
    (add-hook 'e2wm:pre-start-hook
              (<span style="color: #a020f0;">lambda</span> ()
                  (set-frame-width
                   (selected-frame)
                   (/ (- (display-pixel-width) 30) (frame-char-width)))))

    <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#24133;&#12434;&#12487;&#12501;&#12457;&#12523;&#12488;&#20516;&#12395;&#25147;&#12377;</span>
    (add-hook 'e2wm:post-stop-hook
              (<span style="color: #a020f0;">lambda</span> ()
                  (set-frame-width (selected-frame)
                                   moom--frame-width)))

    <span style="color: #b22222;">;; </span><span style="color: #b22222;">To avoid rebooting issue when using desktop.el and recentf.el</span>
    (add-hook 'kill-emacs-hook
              (<span style="color: #a020f0;">lambda</span> ()
                  (<span style="color: #a020f0;">when</span> (fboundp 'e2wm:stop-management)
                    (e2wm:stop-management))))))
<span style="color: #b22222;">;; </span><span style="color: #b22222;">setting for e2wm</span>
(<span style="color: #a020f0;">when</span> (autoload-if-found '(change-frame-double-window
                           change-frame-single-window)
                         <span style="color: #8b2252;">"frame-ctr-e2wm"</span> nil t)
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">Set the frame width single size</span>
  <span style="color: #b22222;">;;  </span><span style="color: #b22222;">C-u C-x - =&gt; e2wm OFF, single size width and double height, move center</span>
  (global-set-key (kbd <span style="color: #8b2252;">"C-x -"</span>) 'change-frame-single-window)
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">Set the frame width double size</span>
  <span style="color: #b22222;">;;  </span><span style="color: #b22222;">C-u C-x = =&gt; e2wm ON, double size width and height, move to the center</span>
  (global-set-key (kbd <span style="color: #8b2252;">"C-x ="</span>) 'change-frame-double-window))
</pre>
</div>
</div>
</div>

<div id="outline-container-org0c556404" class="outline-3">
<h3 id="org0c556404"><span class="section-number-3">11.8.</span> [tabbar-ruler] バッファをタブ切り替え可能に&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></h3>
<div class="outline-text-3" id="text-org0c556404">
<ul class="org-ul">
<li>不要かな</li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">tabbar-ruler</span> nil t)
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">(when (require 'tabbar-ruler nil t)</span>
  (<span style="color: #a020f0;">setq</span> tabbar-ruler-global-tabbar t) <span style="color: #b22222;">; </span><span style="color: #b22222;">If you want tabbar</span>
  (<span style="color: #a020f0;">setq</span> tabbar-ruler-popup-menu t) <span style="color: #b22222;">; </span><span style="color: #b22222;">If you want a popup menu.</span>
  (<span style="color: #a020f0;">setq</span> tabbar-ruler-popup-toolbar t) <span style="color: #b22222;">; </span><span style="color: #b22222;">If you want a popup toolbar</span>
  <span style="color: #b22222;">;;  </span><span style="color: #b22222;">(setq tabbar-ruler-fancy-tab-separator 'round)</span>
  <span style="color: #b22222;">;;  </span><span style="color: #b22222;">(setq tabbar-ruler-fancy-current-tab-separator 'round)</span>
  (<span style="color: #a020f0;">setq</span> tabbar-ruler-invert-deselected nil)
  (<span style="color: #a020f0;">setq</span> tabbar-ruler-modified-symbol t))
</pre>
</div>
</div>
</div>

<div id="outline-container-org6474a498" class="outline-3">
<h3 id="org6474a498"><span class="section-number-3">11.9.</span> [elscreen.el] Emacs バッファをタブ化&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></h3>
<div class="outline-text-3" id="text-org6474a498">
<ul class="org-ul">
<li>cycle-buffer で十分かなと言う感じで不使用になりました．</li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;; </span><span style="color: #b22222;">ElScreen (require apel) ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;</span>
<span style="color: #b22222;">;;; </span><span style="color: #b22222;">Note: change a string in the elscreen.el from "mac" to "ns"</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">2011-10-26: e2wm's perspective (two) mode is more useful for me.</span>
(load <span style="color: #8b2252;">"elscreen"</span> <span style="color: #8b2252;">"ElScreen"</span> t)
</pre>
</div>
</div>
</div>

<div id="outline-container-org750d9aa5" class="outline-3">
<h3 id="org750d9aa5"><span class="section-number-3">11.10.</span> [popwin.el] ポップアップウィンドウの制御&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></h3>
<div class="outline-text-3" id="text-org750d9aa5">
<ul class="org-ul">
<li>現在は緩やかに <code>shackle</code> に移行中です．
<ul class="org-ul">
<li>ただし， <code>dedicated</code> オプションが使えないので，ウィンドウからフォーカスが外れた時に自動的にウィンドウを消すことができません．
<ul class="org-ul">
<li>それぞれに <code>q</code> を実装すれば，近い動作にはできる．</li>
</ul></li>
</ul></li>
<li><a href="https://github.com/m2ym/popwin-el/">https://github.com/m2ym/popwin-el/</a></li>
<li>popwin:display-buffer を autoload してもうまくいかない．</li>
</ul>

<p>
<code>postpone</code> の後に呼んでいるのは，Emacs起動時の単純な高速化対策です．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">for emacs 24.1</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">(setq special-display-function 'popwin:special-display-popup-window)</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">(setq display-buffer-function 'popwin:display-buffer)</span>

<span style="color: #b22222;">;; </span><span style="color: #b22222;">for emacs 24.3</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">(setq special-display-alist 'popwin:special-display-popup-window)</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">(setq display-buffer-alist 'popwin:display-buffer)</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">(push '("*sdic*" :position top) popwin:special-display-config)</span>

(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"postpone"</span>
  (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">popwin</span> nil t)
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">Performed in shackle</span>
    (<span style="color: #a020f0;">push</span> '(<span style="color: #8b2252;">"*Help*"</span> <span style="color: #483d8b;">:height</span> 20 <span style="color: #483d8b;">:position</span> top <span style="color: #483d8b;">:dedicated</span> t)
          popwin:special-display-config)
    (<span style="color: #a020f0;">push</span> '(<span style="color: #8b2252;">"*osx-dictionary*"</span> <span style="color: #483d8b;">:height</span> 20 <span style="color: #483d8b;">:position</span> top <span style="color: #483d8b;">:dedicated</span> t)
          popwin:special-display-config)
    (<span style="color: #a020f0;">push</span> '(<span style="color: #8b2252;">"*wclock*"</span> <span style="color: #483d8b;">:height</span> 10 <span style="color: #483d8b;">:position</span> top <span style="color: #483d8b;">:dedicated</span> t)
          popwin:special-display-config)

    <span style="color: #b22222;">;; </span><span style="color: #b22222;">Checking...</span>
    (<span style="color: #a020f0;">push</span> '(<span style="color: #8b2252;">"*Checkdoc Status*"</span> <span style="color: #483d8b;">:position</span> top <span style="color: #483d8b;">:dedicated</span> t)
          popwin:special-display-config)
    (<span style="color: #a020f0;">push</span> '(<span style="color: #8b2252;">"*frequencies*"</span> <span style="color: #483d8b;">:height</span> 20 <span style="color: #483d8b;">:position</span> bottom <span style="color: #483d8b;">:dedicated</span> t)
          popwin:special-display-config)
    (<span style="color: #a020f0;">push</span> '(<span style="color: #8b2252;">"CAPTURE-next.org"</span> <span style="color: #483d8b;">:height</span> 10 <span style="color: #483d8b;">:position</span> bottom <span style="color: #483d8b;">:noselect</span> t)
          popwin:special-display-config)
    (<span style="color: #a020f0;">push</span> '(<span style="color: #8b2252;">"CAPTURE-org-ical.org"</span><span style="color: #483d8b;">:height</span> 10 <span style="color: #483d8b;">:position</span> bottom <span style="color: #483d8b;">:noselect</span> t)
          popwin:special-display-config)
    (<span style="color: #a020f0;">push</span> '(<span style="color: #8b2252;">"dict-app-result"</span> <span style="color: #483d8b;">:height</span> 20 <span style="color: #483d8b;">:position</span> bottom)
          popwin:special-display-config)
    (<span style="color: #a020f0;">push</span> '(<span style="color: #8b2252;">"*timer*"</span> <span style="color: #483d8b;">:height</span> 20 <span style="color: #483d8b;">:position</span> bottom <span style="color: #483d8b;">:dedicated</span> t)
          popwin:special-display-config)
    (<span style="color: #a020f0;">push</span> '(<span style="color: #8b2252;">"Calendar"</span> <span style="color: #483d8b;">:position</span> top <span style="color: #483d8b;">:dedicated</span> t)
          popwin:special-display-config)
    (<span style="color: #a020f0;">push</span> '(<span style="color: #8b2252;">"*Org Dashboard*"</span> <span style="color: #483d8b;">:position</span> bottom)
          popwin:special-display-config)
    (<span style="color: #a020f0;">push</span> '(<span style="color: #8b2252;">"*Org Select*"</span> <span style="color: #483d8b;">:height</span> 10 <span style="color: #483d8b;">:position</span> bottom)
          popwin:special-display-config)
    (<span style="color: #a020f0;">push</span> '(<span style="color: #8b2252;">"*Org Grep*"</span> <span style="color: #483d8b;">:height</span> 20 <span style="color: #483d8b;">:position</span> bottom <span style="color: #483d8b;">:dedicated</span> t)
          popwin:special-display-config)
    (<span style="color: #a020f0;">push</span> '(<span style="color: #8b2252;">"*Occur*"</span> <span style="color: #483d8b;">:height</span> 10 <span style="color: #483d8b;">:position</span> bottom)
          popwin:special-display-config)
    (<span style="color: #a020f0;">push</span> '(<span style="color: #8b2252;">"*Shell Command Output*"</span> <span style="color: #483d8b;">:height</span> 10 <span style="color: #483d8b;">:position</span> bottom <span style="color: #483d8b;">:dedicated</span> t)
          popwin:special-display-config)
    (<span style="color: #a020f0;">push</span> '(<span style="color: #8b2252;">"*eshell*"</span> <span style="color: #483d8b;">:height</span> 10 <span style="color: #483d8b;">:position</span> bottom)
          popwin:special-display-config)
<span style="color: #b22222;">;;;            </span><span style="color: #b22222;">(undo-tree-visualizer-buffer-name :height 10 :position top)</span>
<span style="color: #b22222;">;;;            </span><span style="color: #b22222;">(undo-tree-diff-buffer-name :height 20 :position bottom)</span>

    <span style="color: #b22222;">;; </span><span style="color: #b22222;">Not performed</span>
    (<span style="color: #a020f0;">push</span> '(<span style="color: #8b2252;">"*Org Agenda*"</span> <span style="color: #483d8b;">:height</span> 10 <span style="color: #483d8b;">:position</span> top)
          popwin:special-display-config))

  (<span style="color: #a020f0;">unless</span> noninteractive
    (popwin-mode 1)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org7a20b311" class="outline-3">
<h3 id="org7a20b311"><span class="section-number-3">11.11.</span> <span class="done DONE">DONE</span> [olivetti.el] ウィンドウを中央寄せで配置&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></h3>
<div class="outline-text-3" id="text-org7a20b311">
<ul class="org-ul">
<li><a href="https://github.com/rnkn/olivetti">rnkn/olivetti: Emacs minor mode for a nice writing environment</a></li>
</ul>

<p>
<code>moom.el</code> を使ってフレームを最大化したり，画面の半分に配置すると，80桁で表示する領域とウィンドウが占める領域の幅が一致しない場合があります．通常は，フレーム内で左寄せに配置されますが， <code>olivetti</code> を使うと，中央寄せにできます．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">late-init.el</span>
(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"moom"</span>
  (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">olivetti</span> nil t)
    (<span style="color: #a020f0;">setq</span> olivetti-lighter nil)
    (<span style="color: #a020f0;">setq-default</span> olivetti-body-width 80)
    (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">ad:turn-on-olivetti-mode</span> ()
      <span style="color: #8b2252;">"Disable `</span><span style="color: #008b8b;">visual-line-mode</span><span style="color: #8b2252;">'."</span>
      (<span style="color: #a020f0;">unless</span> moom--maximized
        (olivetti-mode -1))
      (visual-line-mode -1))
    (advice-add 'turn-on-olivetti-mode <span style="color: #483d8b;">:after</span> #'ad:turn-on-olivetti-mode)
    (add-hook 'find-file-hook #'turn-on-olivetti-mode)
    (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">ad:olivetti:moom-toggle-frame-maximized</span> ()
      (<span style="color: #a020f0;">if</span> moom--maximized
          (turn-on-olivetti-mode)
        (olivetti-mode -1)))
    (advice-add 'moom-toggle-frame-maximized <span style="color: #483d8b;">:after</span>
                #'ad:olivetti:moom-toggle-frame-maximized)))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgf57ce845" class="outline-2">
<h2 id="orgf57ce845"><span class="section-number-2">12.</span> フォント／配色関連</h2>
<div class="outline-text-2" id="text-orgf57ce845">
</div>
<div id="outline-container-orgbbb079d3" class="outline-3">
<h3 id="orgbbb079d3"><span class="section-number-3">12.1.</span> 正規表現を見やすくする</h3>
<div class="outline-text-3" id="text-orgbbb079d3">
<p>
Emacs Lisp の正規表現を色付けします．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(set-face-foreground 'font-lock-regexp-grouping-backslash <span style="color: #8b2252;">"#66CC99"</span>)
(set-face-foreground 'font-lock-regexp-grouping-construct <span style="color: #8b2252;">"#9966CC"</span>)
</pre>
</div>

<p>
Emacs Lisp で正規表現入力をサポートするツールには， <code>M-x re-builder</code> や <code>rx</code> マクロがある．
</p>

<ul class="org-ul">
<li><a href="http://www.emacswiki.org/emacs/ReBuilder">EmacsWiki: Re Builder</a></li>
<li><a href="http://emacswiki.org/emacs/rx">EmacsWiki: rx</a></li>
</ul>
</div>
</div>

<div id="outline-container-orgc98c6fff" class="outline-3">
<h3 id="orgc98c6fff"><span class="section-number-3">12.2.</span> 設定ファイルを見やすくする</h3>
<div class="outline-text-3" id="text-orgc98c6fff">
<p>
<code>generic-x</code> を使うと， <code>/etc/hosts</code> や <code>/etc/apache2.conf</code> に色を付けられる．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-generic-x-activate</span> ()
  (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">generic-x</span> nil t)
  (remove-hook 'find-file-hook #'my-generic-x-activate))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">unless</span> noninteractive
  (add-hook 'find-file-hook #'my-generic-x-activate))
</pre>
</div>
</div>
</div>

<div id="outline-container-org7858d806" class="outline-3">
<h3 id="org7858d806"><span class="section-number-3">12.3.</span> カーソル行に色をつける</h3>
<div class="outline-text-3" id="text-org7858d806">
<ul class="org-ul">
<li>ビルトインの <code>hl-line</code> を使います．</li>
<li><a href="http://murakan.cocolog-nifty.com/blog/2009/01/emacs-tips-1d45.html">http://murakan.cocolog-nifty.com/blog/2009/01/emacs-tips-1d45.html</a></li>
<li><a href="http://www.emacswiki.org/cgi-bin/emacs/highlight-current-line.el">http://www.emacswiki.org/cgi-bin/emacs/highlight-current-line.el</a></li>
</ul>

<p>
色の設定は <code>custom-set-faces</code> で．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-ime-off-hline</span> ()
  (my-hl-line-enable)
  (<span style="color: #a020f0;">let</span> ((dark (eq (frame-parameter nil 'background-mode) 'dark)))
          (set-face-background hl-line-face (<span style="color: #a020f0;">if</span> dark <span style="color: #8b2252;">"#484c5c"</span> <span style="color: #8b2252;">"#DEEDFF"</span>)))
  (run-hooks 'my-ime-off-hline-hook))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-ime-on-hline</span> ()
  (my-hl-line-enable)
  (<span style="color: #a020f0;">let</span> ((dark (eq (frame-parameter nil 'background-mode) 'dark)))
          (set-face-background hl-line-face (<span style="color: #a020f0;">if</span> dark <span style="color: #8b2252;">"#594d5d"</span> <span style="color: #8b2252;">"#fff0de"</span>)))
  (run-hooks 'my-ime-on-hline-hook))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-hl-line-update</span> ()
        (<span style="color: #a020f0;">if</span> (frame-focus-state) (my-hl-line-enable) (my-hl-line-disable)))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-hl-line-disable</span> ()
  <span style="color: #8b2252;">"Disable `</span><span style="color: #008b8b;">hl-line</span><span style="color: #8b2252;">'."</span>
  (hl-line-mode -1))

<span style="color: #b22222;">;; </span><span style="color: #b22222;">(eval-when-compile</span>
<span style="color: #b22222;">;;   </span><span style="color: #b22222;">(message "Loading hl-line...")</span>
<span style="color: #b22222;">;;   </span><span style="color: #b22222;">(require 'hl-line))</span>

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-hl-line-activate</span> ()
  (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">hl-line</span> nil t)
    (add-hook 'ah-after-move-cursor-hook #'my-hl-line-enable))
  (remove-hook 'ah-after-move-cursor-hook #'my-hl-line-activate))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-hl-line-enable</span> () <span style="color: #b22222;">;; </span><span style="color: #b22222;">Hard to move this under utility.el</span>
  <span style="color: #8b2252;">"Enable `</span><span style="color: #008b8b;">hl-line</span><span style="color: #8b2252;">'."</span>
  (<span style="color: #a020f0;">unless</span> (<span style="color: #a020f0;">or</span> hl-line-mode
              (minibufferp)
                                (memq major-mode my-hl-permanent-disabled))
          (hl-line-mode 1))
  (<span style="color: #a020f0;">setq</span> my-hl-disabled-by-timer nil))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(hl-line-mode my-hl-line-enable)
                         <span style="color: #8b2252;">"hl-line"</span> nil t)
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">Tricky!</span>
  (add-hook 'ah-after-move-cursor-hook #'my-hl-line-activate)

  (<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">my-hl-permanent-disabled</span> '(dired-mode vterm-mode)
    <span style="color: #8b2252;">"A list of major modes to disable `</span><span style="color: #008b8b;">hl-line</span><span style="color: #8b2252;">'."</span>)

  (<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">my-ime-off-hline-hook</span> nil)
  (<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">my-ime-on-hline-hook</span> nil)

  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"hl-line"</span>
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#21029;&#12454;&#12451;&#12531;&#12489;&#12454;&#12398;&#21516;&#12376;&#12496;&#12483;&#12501;&#12449;&#12391;&#12418;&#12495;&#12452;&#12521;&#12452;&#12488;&#12377;&#12427;</span>
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">(setq hl-line-sticky-flag t)</span>
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">(unless (version&lt; emacs-version "28.1")</span>
    <span style="color: #b22222;">;;   </span><span style="color: #b22222;">(setq hl-line-sticky-flag nil))</span>

    (<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">my-hl-active-period</span> 120
      <span style="color: #8b2252;">"Disable `</span><span style="color: #008b8b;">hl-line</span><span style="color: #8b2252;">' after this period"</span>)

                (<span style="color: #a020f0;">if</span> (my-ime-active-p) (my-ime-on-hline) (my-ime-off-hline))

    (run-with-idle-timer my-hl-active-period t #'my-hl-line-disable)

    (<span style="color: #a020f0;">if</span> (boundp 'after-focus-change-function)
        (<span style="color: #a020f0;">add-function</span> <span style="color: #483d8b;">:after</span> after-focus-change-function #'my-hl-line-update)
            (add-hook 'focus-in-hook #'my-hl-line-enable)
            (add-hook 'focus-out-hook #'my-hl-line-disable))

    <span style="color: #b22222;">;; </span><span style="color: #b22222;">(add-hook 'minibuffer-setup-hook #'my-hl-line-disable)</span>
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">(add-hook 'minibuffer-exit-hook #'my-hl-line-enable)</span>
    (add-hook 'input-method-activate-hook #'my-ime-on-hline)
    (add-hook 'input-method-deactivate-hook #'my-ime-off-hline)))
</pre>
</div>

<p>
色の変更ではなく，下線に変更したい場合は， <code>(setq hl-line-face 'underline)</code> とする．
</p>
</div>
</div>

<div id="outline-container-org29d5304f" class="outline-3">
<h3 id="org29d5304f"><span class="section-number-3">12.4.</span> カーソルの点滅を制御</h3>
<div class="outline-text-3" id="text-org29d5304f">
<p>
以下の例では，入力が止まってから <code>30</code> 秒後に <code>0.2</code> 秒間隔で点滅します．次に入力が始まるまで，点滅が続きます．
</p>

<p>
<code>postpone</code> の後に呼んでいるのは，Emacs起動時の単純な高速化対策です．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">setq</span> blink-cursor-blinks 0)
(<span style="color: #a020f0;">setq</span> blink-cursor-interval 0.2)
(<span style="color: #a020f0;">setq</span> blink-cursor-delay 30)
(<span style="color: #a020f0;">unless</span> noninteractive
  (blink-cursor-mode 1))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf36a8366" class="outline-3">
<h3 id="orgf36a8366"><span class="section-number-3">12.5.</span> カーソル位置のフォントを確認</h3>
<div class="outline-text-3" id="text-orgf36a8366">
<p>
<code>M-x describe-char</code> すると，カーソル位置のフォントの情報が別バッファに表示されます．
</p>
</div>
</div>

<div id="outline-container-org919a945a" class="outline-3">
<h3 id="org919a945a"><span class="section-number-3">12.6.</span> フォント設定</h3>
<div class="outline-text-3" id="text-org919a945a">
<p>
表のような利用環境に対して，個別に設定を施しています．WindowsとLinuxは安定版のEmacs23で，Macは開発版のCocoaEmacs23です．MacではEmacs24でもうまく表示できています．最近は，<a href="http://mix-mplus-ipa.sourceforge.jp/migu/">Migu 2M</a>を気に入って使っています．
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption class="t-above"><span class="table-number">Table 1:</span> 環境別の使用フォント</caption>

<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">ASCII</td>
<td class="org-left">日本語</td>
</tr>

<tr>
<td class="org-left">Mac</td>
<td class="org-left">Monaco</td>
<td class="org-left">Migu 2M 又は ヒラギノ丸ゴ</td>
</tr>

<tr>
<td class="org-left">Windows</td>
<td class="org-left">Inconsolata</td>
<td class="org-left">メイリオ</td>
</tr>

<tr>
<td class="org-left">Linux</td>
<td class="org-left">Inconsolata</td>
<td class="org-left">MigMix</td>
</tr>
</tbody>
</table>

<ul class="org-ul">
<li><a href="http://d.hatena.ne.jp/setoryohei/20110117/1295336454">http://d.hatena.ne.jp/setoryohei/20110117/1295336454</a></li>
<li><a href="http://users.teilar.gr/~g1951d/">Unicode Fonts for Ancient Scripts</a></li>
</ul>

<p>
遅延設定(postpone.el)にしたことで，体感レベルでGUI生成が高速化しました．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">1) Monaco, Hiragino/Migu 2M : font-size=12, -apple-hiragino=1.2</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">2) Inconsolata, Migu 2M     : font-size=14,</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">3) Inconsolata, Hiragino    : font-size=14, -apple-hiragino=1.0</span>
(<span style="color: #a020f0;">defconst</span> <span style="color: #a0522d;">my-font-size</span> 12)
(<span style="color: #a020f0;">defconst</span> <span style="color: #a0522d;">my-ja-font</span> <span style="color: #8b2252;">"Migu 2M"</span>) <span style="color: #b22222;">;; </span><span style="color: #b22222;">"Hiragino Maru Gothic Pro"</span>
(<span style="color: #a020f0;">defconst</span> <span style="color: #a0522d;">my-ascii-font</span> <span style="color: #8b2252;">"Monaco"</span>) <span style="color: #b22222;">;; </span><span style="color: #b22222;">"Inconsolata", Monaco</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">(defconst my-ja-font "Hiragino Maru Gothic Pro") ;; "Hiragino Maru Gothic Pro"</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">(defconst my-ascii-font "Inconsolata") ;; "Inconsolata", Menlo, "Ricty Diminished"</span>

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-ja-font-setter</span> (spec)
  (set-fontset-font nil 'japanese-jisx0208 spec)
  (set-fontset-font nil 'katakana-jisx0201 spec)
  (set-fontset-font nil 'japanese-jisx0212 spec)
  (set-fontset-font nil '(#x0080 . #x024F) spec)
  (set-fontset-font nil '(#x0370 . #x03FF) spec)
  (set-fontset-font nil 'mule-unicode-0100-24ff spec)
  (set-fontset-font t 'unicode spec nil 'prepend))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-ascii-font-setter</span> (spec)
  (set-fontset-font nil 'ascii spec))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-unicode-font-setter</span> (spec)
  (set-fontset-font t 'unicode spec nil 'prepend))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-all-the-icons-setter</span> ()
  (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">icons-in-terminal</span> nil t)
    (my-unicode-font-setter
     (font-spec <span style="color: #483d8b;">:family</span> (icons-in-terminal-faicon-family)))
    (my-unicode-font-setter
     (font-spec <span style="color: #483d8b;">:family</span> (icons-in-terminal-fileicon-family)))
    (my-unicode-font-setter
     (font-spec <span style="color: #483d8b;">:family</span> (icons-in-terminal-material-family)))
    (my-unicode-font-setter
     (font-spec <span style="color: #483d8b;">:family</span> (icons-in-terminal-octicon-family)))
    (my-unicode-font-setter
     (font-spec <span style="color: #483d8b;">:family</span> (icons-in-terminal-wicon-family)))))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-font-config</span> (<span style="color: #228b22;">&amp;optional</span> size ascii ja)
  <span style="color: #8b2252;">"Font config.</span>
<span style="color: #8b2252;">- SIZE: font size for ASCII and Japanese (default: 12)</span>
<span style="color: #8b2252;">- ASCII: ascii font family (default: \"Monaco\")</span>
<span style="color: #8b2252;">- JA: Japanese font family (default: \"Migu 2M\")</span>
<span style="color: #8b2252;">"</span>
  (<span style="color: #a020f0;">when</span> (memq window-system '(mac ns))
    (<span style="color: #a020f0;">let</span> ((font-size (<span style="color: #a020f0;">or</span> size my-font-size))
          (ascii-font (<span style="color: #a020f0;">or</span> ascii my-ascii-font))
          (ja-font (<span style="color: #a020f0;">or</span> ja my-ja-font)))
      (set-fontset-font t '(#Xe000 . #Xf8ff) <span style="color: #8b2252;">"icons-in-terminal"</span>)
      <span style="color: #b22222;">;;</span><span style="color: #b22222;">(set-fontset-font t '(#Xe0a0 . #Xeea0) "icons-in-terminal")</span>
      (my-ja-font-setter (font-spec <span style="color: #483d8b;">:family</span> ja-font <span style="color: #483d8b;">:size</span> font-size))
      (my-ascii-font-setter (font-spec <span style="color: #483d8b;">:family</span> ascii-font <span style="color: #483d8b;">:size</span> font-size)))))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-setup-font</span> ()
  (<span style="color: #a020f0;">cond</span>
   <span style="color: #b22222;">;; </span><span style="color: #b22222;">CocoaEmacs</span>
   ((memq window-system '(mac ns))
    (<span style="color: #a020f0;">when</span> (&gt;= emacs-major-version 23)

      <span style="color: #b22222;">;; </span><span style="color: #b22222;">Fix ratio provided by set-face-attribute for fonts display</span>
      (<span style="color: #a020f0;">setq</span> face-font-rescale-alist
            '((<span style="color: #8b2252;">"^-apple-hiragino.*"</span> . 1.0) <span style="color: #b22222;">; </span><span style="color: #b22222;">1.2</span>
              (<span style="color: #8b2252;">".*Migu.*"</span> . 1.2)
              (<span style="color: #8b2252;">".*Ricty.*"</span> . 1.0)
              (<span style="color: #8b2252;">".*Inconsolata.*"</span> . 1.0)
              (<span style="color: #8b2252;">".*osaka-bold.*"</span> . 1.0)     <span style="color: #b22222;">; </span><span style="color: #b22222;">1.2</span>
              (<span style="color: #8b2252;">".*osaka-medium.*"</span> . 1.0)   <span style="color: #b22222;">; </span><span style="color: #b22222;">1.0</span>
              (<span style="color: #8b2252;">".*courier-bold-.*-mac-roman"</span> . 1.0) <span style="color: #b22222;">; </span><span style="color: #b22222;">0.9</span>
              <span style="color: #b22222;">;; </span><span style="color: #b22222;">(".*monaco cy-bold-.*-mac-cyrillic" . 1.0)</span>
              <span style="color: #b22222;">;; </span><span style="color: #b22222;">(".*monaco-bold-.*-mac-roman" . 1.0) ; 0.9</span>
              (<span style="color: #8b2252;">"-cdac$"</span> . 1.0))))) <span style="color: #b22222;">; </span><span style="color: #b22222;">1.3</span>
   <span style="color: #b22222;">;; </span><span style="color: #b22222;">(my-font-config) ;; see `</span><span style="color: #008b8b;">my-theme</span><span style="color: #b22222;">'</span>

   ((eq window-system 'ns)
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">Anti aliasing with Quartz 2D</span>
    (<span style="color: #a020f0;">when</span> (boundp 'mac-allow-anti-aliasing)
      (<span style="color: #a020f0;">setq</span> mac-allow-anti-aliasing t)))

   ((eq window-system 'w32) <span style="color: #b22222;">;; </span><span style="color: #b22222;">Windows</span>
    (<span style="color: #a020f0;">let</span> ((font-size 14)
          (font-height 100)
          (ascii-font <span style="color: #8b2252;">"Inconsolata"</span>)
          (ja-font <span style="color: #8b2252;">"Migu 2M"</span>)) <span style="color: #b22222;">;; </span><span style="color: #b22222;">Meiryo UI, &#12513;&#12452;&#12522;&#12458;</span>
      (set-fontset-font t '(#Xe000 . #Xf8ff) <span style="color: #8b2252;">"icons-in-terminal"</span>)
      (my-ja-font-setter
       (font-spec <span style="color: #483d8b;">:family</span> ja-font <span style="color: #483d8b;">:size</span> font-size <span style="color: #483d8b;">:height</span> font-height))
      (my-ascii-font-setter (font-spec <span style="color: #483d8b;">:family</span> ascii-font <span style="color: #483d8b;">:size</span> font-size))
      (<span style="color: #a020f0;">setq</span> face-font-rescale-alist '((<span style="color: #8b2252;">".*Inconsolata.*"</span> . 1.0))))) <span style="color: #b22222;">; </span><span style="color: #b22222;">0.9</span>

   ((eq window-system 'x) <span style="color: #b22222;">; </span><span style="color: #b22222;">for SuSE Linux 12.1</span>
    (<span style="color: #a020f0;">let</span>
        ((font-size 14)
         (font-height 100)
         (ascii-font <span style="color: #8b2252;">"Inconsolata"</span>)
         <span style="color: #b22222;">;; </span><span style="color: #b22222;">(ja-font "MigMix 1M")</span>
         (ja-font <span style="color: #8b2252;">"Migu 2M"</span>))
      (set-fontset-font t '(#Xe000 . #Xf8ff) <span style="color: #8b2252;">"icons-in-terminal"</span>)
      (my-ja-font-setter
       (font-spec <span style="color: #483d8b;">:family</span> ja-font <span style="color: #483d8b;">:size</span> font-size <span style="color: #483d8b;">:height</span> font-height))
      (my-ascii-font-setter (font-spec <span style="color: #483d8b;">:family</span> ascii-font <span style="color: #483d8b;">:size</span> font-size)))
    (<span style="color: #a020f0;">setq</span> face-font-rescale-alist '((<span style="color: #8b2252;">".*Migu.*"</span> . 2.0)
                                    (<span style="color: #8b2252;">".*MigMix.*"</span> . 2.0)
                                    (<span style="color: #8b2252;">".*Inconsolata.*"</span> . 1.0))))) <span style="color: #b22222;">; </span><span style="color: #b22222;">0.9</span>
  )
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(my-setup-font)
</pre>
</div>
</div>

<div id="outline-container-orgb94aa5b3" class="outline-4">
<h4 id="orgb94aa5b3"><span class="section-number-4">12.6.1.</span> フォントのインストール方法</h4>
<div class="outline-text-4" id="text-orgb94aa5b3">
<p>
Linux では次のように処理するだけでよく，意外と簡単．
</p>

<ol class="org-ol">
<li>~/.fonts を作成する</li>
<li>フォントを1.のディレクトリに置く</li>
<li>fc-cache -fv を実行</li>
<li>fc-list でインストールされているかを確認．</li>
</ol>

<p>
なお，Windows では，フォントファイルを右クリックして，インストールを選択するだけでOK．
</p>
</div>
</div>

<div id="outline-container-org66fa6b98" class="outline-4">
<h4 id="org66fa6b98"><span class="section-number-4">12.6.2.</span> フォントチェック用コード</h4>
<div class="outline-text-4" id="text-org66fa6b98">
<p>
サンプルの <a href="http://dl.dropbox.com/u/2440/dokuwiki/font-test.org">orgファイル</a> を作って，見た目をチェックしています．バッファ内の桁数チェックや，ASCIIが漢字の半分の幅になっているかのチェックが楽になります．
</p>
</div>
</div>
</div>

<div id="outline-container-org2bcbc1db" class="outline-3">
<h3 id="org2bcbc1db"><span class="section-number-3">12.7.</span> 行間を制御する</h3>
<div class="outline-text-3" id="text-org2bcbc1db">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-linespacing</span> ()
  (<span style="color: #a020f0;">unless</span> (minibufferp)
    (<span style="color: #a020f0;">setq-local</span> line-spacing 2)))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">set-default &#12391; global &#25351;&#23450;&#12377;&#12427;&#12392;&#65292;&#12511;&#12491;&#12496;&#12483;&#12501;&#12449;&#12398; message &#12391;&#21046;&#24481;&#19981;&#33021;&#12395;&#12394;&#12427;</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">propertize &#12391;&#25313;&#22823;&#12391;&#12365;&#12427;&#12364;&#65292;global &#12398;&#20516;&#20197;&#19979;&#12395;&#32302;&#23567;&#12391;&#12365;&#12394;&#12367;&#12394;&#12427;&#65294;</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">(set-default 'line-spacing 2)</span>
(add-hook 'buffer-list-update-hook #'my-linespacing)
(add-hook 'org-src-mode-hook #'my-linespacing)
(add-hook 'debugger-mode-hook #'my-linespacing)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"org-agenda"</span>
  (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-org-agenda</span> (<span style="color: #228b22;">&amp;optional</span> _arg _org-keys _restriction)
    (my-linespacing))
  (advice-add 'org-agenda <span style="color: #483d8b;">:after</span> #'my-org-agenda)
  (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-org-agenda-redo</span> (<span style="color: #228b22;">&amp;optional</span> _all)
    (my-linespacing))
  (advice-add 'org-agenda-redo <span style="color: #483d8b;">:after</span> #'my-org-agenda-redo))
</pre>
</div>
</div>
</div>

<div id="outline-container-org372b184d" class="outline-3">
<h3 id="org372b184d"><span class="section-number-3">12.8.</span> パッチをカラフルに表示する</h3>
<div class="outline-text-3" id="text-org372b184d">
<p>
Built-in の <a href="http://www.emacswiki.org/emacs/DiffMode">diff-mode.el</a> をカスタマイズします．
</p>

<ul class="org-ul">
<li><a href="http://d.hatena.ne.jp/syohex/20111228/1325086893">http://d.hatena.ne.jp/syohex/20111228/1325086893</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"diff-mode"</span>
  (set-face-attribute 'diff-added nil
                      <span style="color: #483d8b;">:background</span> 'unspecified <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"lime green"</span>
                      <span style="color: #483d8b;">:weight</span> 'normal)

  (set-face-attribute 'diff-removed nil
                      <span style="color: #483d8b;">:background</span> 'unspecified <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"firebrick1"</span>
                      <span style="color: #483d8b;">:weight</span> 'normal)

  (set-face-attribute 'diff-file-header nil
                      <span style="color: #483d8b;">:background</span> 'unspecified <span style="color: #483d8b;">:weight</span> 'extra-bold)

  (set-face-attribute 'diff-hunk-header nil
                      <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"chocolate4"</span>
                      <span style="color: #483d8b;">:background</span> <span style="color: #8b2252;">"white"</span> <span style="color: #483d8b;">:weight</span> 'extra-bold
                      <span style="color: #483d8b;">:inherit</span> nil))
</pre>
</div>
</div>
</div>

<div id="outline-container-org009dc6e3" class="outline-3">
<h3 id="org009dc6e3"><span class="section-number-3">12.9.</span> 背景を黒系色にする</h3>
<div class="outline-text-3" id="text-org009dc6e3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(custom-set-faces
 '(default ((t
             (<span style="color: #483d8b;">:background</span> <span style="color: #8b2252;">"black"</span> <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#55FF55"</span>)
             ))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org6d79c76a" class="outline-3">
<h3 id="org6d79c76a"><span class="section-number-3">12.10.</span> [hl-todo.el] 特定キーワードの配色を変える</h3>
<div class="outline-text-3" id="text-org6d79c76a">
<ul class="org-ul">
<li><a href="https://github.com/tarsius/hl-todo">hl-todo</a> を導入すれば簡単にできます．</li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-hl-todo-reload</span> ()
  (<span style="color: #a020f0;">interactive</span>)
  (global-hl-todo-mode -1)
  (global-hl-todo-mode))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-hl-todo-light-theme</span> ()
  (<span style="color: #a020f0;">setq</span> hl-todo-keyword-faces
        '((<span style="color: #8b2252;">"HOLD"</span> . <span style="color: #8b2252;">"#d0bf8f"</span>)
          (<span style="color: #8b2252;">"TODO"</span> . <span style="color: #8b2252;">"#FF0000"</span>)
          (<span style="color: #8b2252;">"NEXT"</span> . <span style="color: #8b2252;">"#dca3a3"</span>)
          (<span style="color: #8b2252;">"THEM"</span> . <span style="color: #8b2252;">"#dc8cc3"</span>)
          (<span style="color: #8b2252;">"PROG"</span> . <span style="color: #8b2252;">"#7cb8bb"</span>)
          (<span style="color: #8b2252;">"OKAY"</span> . <span style="color: #8b2252;">"#7cb8bb"</span>)
          (<span style="color: #8b2252;">"DONT"</span> . <span style="color: #8b2252;">"#5f7f5f"</span>)
          (<span style="color: #8b2252;">"FAIL"</span> . <span style="color: #8b2252;">"#8c5353"</span>)
          (<span style="color: #8b2252;">"DONE"</span> . <span style="color: #8b2252;">"SeaGreen"</span>)
          (<span style="color: #8b2252;">"NOTE"</span>   . <span style="color: #8b2252;">"#d0bf8f"</span>)
          (<span style="color: #8b2252;">"KLUDGE"</span> . <span style="color: #8b2252;">"#d0bf8f"</span>)
          (<span style="color: #8b2252;">"HACK"</span>   . <span style="color: #8b2252;">"#d0bf8f"</span>)
          (<span style="color: #8b2252;">"TEMP"</span>   . <span style="color: #8b2252;">"#d0bf8f"</span>)
          (<span style="color: #8b2252;">"FIXME"</span>  . <span style="color: #8b2252;">"#3030FF"</span>)
          (<span style="color: #8b2252;">"XXX+"</span>   . <span style="color: #8b2252;">"#cc9393"</span>)
          (<span style="color: #8b2252;">"\\?\\?\\?+"</span> . <span style="color: #8b2252;">"#cc9393"</span>)
          (<span style="color: #8b2252;">"<i class="far fa-hand-point-right"></i>"</span> . <span style="color: #8b2252;">"orange"</span>)
          (<span style="color: #8b2252;">"&#61576;"</span> . <span style="color: #8b2252;">"red"</span>)
          (<span style="color: #8b2252;">"&#61575;"</span> . <span style="color: #8b2252;">"Seagreen3"</span>)))
  (my-hl-todo-reload))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-hl-todo-dark-theme</span> ()
  (<span style="color: #a020f0;">setq</span> hl-todo-keyword-faces
        '((<span style="color: #8b2252;">"HOLD"</span> . <span style="color: #8b2252;">"#d0bf8f"</span>)
          (<span style="color: #8b2252;">"TODO"</span> . <span style="color: #8b2252;">"#cc9393"</span>)
          (<span style="color: #8b2252;">"NEXT"</span> . <span style="color: #8b2252;">"#dca3a3"</span>)
          (<span style="color: #8b2252;">"THEM"</span> . <span style="color: #8b2252;">"#dc8cc3"</span>)
          (<span style="color: #8b2252;">"PROG"</span> . <span style="color: #8b2252;">"#7cb8bb"</span>)
          (<span style="color: #8b2252;">"OKAY"</span> . <span style="color: #8b2252;">"#7cb8bb"</span>)
          (<span style="color: #8b2252;">"DONT"</span> . <span style="color: #8b2252;">"#5f7f5f"</span>)
          (<span style="color: #8b2252;">"FAIL"</span> . <span style="color: #8b2252;">"#8c5353"</span>)
          (<span style="color: #8b2252;">"DONE"</span> . <span style="color: #8b2252;">"#afd8af"</span>)
          (<span style="color: #8b2252;">"NOTE"</span>   . <span style="color: #8b2252;">"#d0bf8f"</span>)
          (<span style="color: #8b2252;">"KLUDGE"</span> . <span style="color: #8b2252;">"#d0bf8f"</span>)
          (<span style="color: #8b2252;">"HACK"</span>   . <span style="color: #8b2252;">"#d0bf8f"</span>)
          (<span style="color: #8b2252;">"TEMP"</span>   . <span style="color: #8b2252;">"#d0bf8f"</span>)
          (<span style="color: #8b2252;">"FIXME"</span>  . <span style="color: #8b2252;">"DodgerBlue1"</span>)
          (<span style="color: #8b2252;">"XXX+"</span>   . <span style="color: #8b2252;">"#cc9393"</span>)
          (<span style="color: #8b2252;">"\\?\\?\\?+"</span> . <span style="color: #8b2252;">"#cc9393"</span>)
          (<span style="color: #8b2252;">"<i class="far fa-hand-point-right"></i>"</span> . <span style="color: #8b2252;">"orange"</span>)
          (<span style="color: #8b2252;">"&#61576;"</span> . <span style="color: #8b2252;">"red"</span>)
          (<span style="color: #8b2252;">"&#61575;"</span> . <span style="color: #8b2252;">"Seagreen3"</span>)))
  (my-hl-todo-reload))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-hl-todo-activate</span> ()
  (global-hl-todo-mode) <span style="color: #b22222;">;; </span><span style="color: #b22222;">FIXME</span>
  (remove-hook 'find-file-hook #'my-hl-todo-activate))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(global-hl-todo-mode)
                         <span style="color: #8b2252;">"hl-todo"</span> nil t)
  (add-hook 'my-light-theme-hook #'my-hl-todo-light-theme)
  (add-hook 'my-dark-theme-hook #'my-hl-todo-dark-theme)
  (add-hook 'find-file-hook #'my-hl-todo-activate))
</pre>
</div>
</div>
</div>

<div id="outline-container-org92d26c4b" class="outline-3">
<h3 id="org92d26c4b"><span class="section-number-3">12.11.</span> 日中と夜中でテーマを切り替える</h3>
<div class="outline-text-3" id="text-org92d26c4b">
<p>
私は使っていませんが，簡単にテーマを切り替えるためのパッケージ(<a href="https://github.com/valignatev/heaven-and-hell">heaven-and-hell</a>)も存在します．また， <a href="https://github.com/purcell/ns-auto-titlebar">ns-auto-titlebar.el</a> を使うことでも同様の効果が得られます．
</p>

<p>
色々なテーマを試してた後に，その状態をダンプするには次のツールが役立ちます．
</p>
<ul class="org-ul">
<li><a href="https://gist.github.com/condotti/2035942">https://gist.github.com/condotti/2035942</a></li>
</ul>

<p>
私が使っているテーマはこちら．
</p>
<ol class="org-ol">
<li><a href="https://gist.github.com/takaxp/f8763df6de734e3aac6834eb6118c0e9">my theme for light</a></li>
<li><a href="https://gist.github.com/takaxp/5a500d953d15d6d2155b120e886dcd52">my theme for dark</a></li>
</ol>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">(declare-function my-daylight-theme "init" nil)</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">(declare-function my-night-theme "init" nil)</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">(declare-function my-terminal-theme "init" nil)</span>
(<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">my-light-theme-hook</span> nil)
(<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">my-dark-theme-hook</span> nil)

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-terminal-theme</span> ()
  (<span style="color: #a020f0;">interactive</span>)
  (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">terminal-theme</span> nil t)
    (mapc 'disable-theme custom-enabled-themes)
    (load-theme 'terminal t)
    (plist-put my-cur-color-ime <span style="color: #483d8b;">:on</span> <span style="color: #8b2252;">"#FF9300"</span>)
    (run-hooks 'my-dark-theme-hook)))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-daylight-theme</span> ()
  (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">daylight-theme</span> nil t)
    (mapc 'disable-theme custom-enabled-themes)
    (load-theme 'daylight t)
    (plist-put my-cur-color-ime <span style="color: #483d8b;">:on</span> <span style="color: #8b2252;">"#FF9300"</span>)
    (<span style="color: #a020f0;">setq</span> default-frame-alist
          (delete (assoc 'ns-appearance default-frame-alist)
                  default-frame-alist))
    (<span style="color: #a020f0;">setq</span> default-frame-alist
          (delete (assoc 'ns-transparent-titlebar default-frame-alist)
                  default-frame-alist))
    (add-to-list 'default-frame-alist '(ns-transparent-titlebar . t))
    (add-to-list 'default-frame-alist '(ns-appearance . light))
    (modify-frame-parameters nil '((ns-transparent-titlebar . t)
                                   (ns-appearance . light)))
    (run-hooks 'my-light-theme-hook)))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-night-theme</span> ()
  (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">night-theme</span> nil t) <span style="color: #b22222;">;; </span><span style="color: #b22222;">atom-one-dark-theme</span>
    (mapc 'disable-theme custom-enabled-themes)
    (load-theme 'night t)
    (plist-put my-cur-color-ime <span style="color: #483d8b;">:on</span> <span style="color: #8b2252;">"RosyBrown"</span>) <span style="color: #b22222;">;; </span><span style="color: #b22222;">#cebcfe</span>
    (<span style="color: #a020f0;">setq</span> default-frame-alist
          (delete (assoc 'ns-appearance default-frame-alist)
                  default-frame-alist))
    (<span style="color: #a020f0;">setq</span> default-frame-alist
          (delete (assoc 'ns-transparent-titlebar default-frame-alist)
                  default-frame-alist))
    (add-to-list 'default-frame-alist '(ns-transparent-titlebar . t))
    (add-to-list 'default-frame-alist '(ns-appearance . dark))
    (modify-frame-parameters nil '((ns-transparent-titlebar . t)
                                   (ns-appearance . dark)))
    (run-hooks 'my-dark-theme-hook)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org7c97dce0" class="outline-3">
<h3 id="org7c97dce0"><span class="section-number-3">12.12.</span> 時間帯を指定して起動時にテーマを切り替える</h3>
<div class="outline-text-3" id="text-org7c97dce0">
<p>
次の例では，19時から翌日の朝5時までの間に夜用のテーマを使っています．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">my-frame-appearance</span> nil) <span style="color: #b22222;">;; </span><span style="color: #b22222;">{nil, 'dark, 'light} see init-env.el</span>

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-theme</span> (<span style="color: #228b22;">&amp;optional</span> type)
  (<span style="color: #a020f0;">interactive</span> <span style="color: #8b2252;">"MType (light or dark): "</span>)
  (<span style="color: #a020f0;">if</span> (display-graphic-p)
      (<span style="color: #a020f0;">let</span> ((theme (<span style="color: #a020f0;">cond</span> ((member type '(<span style="color: #8b2252;">"light"</span> <span style="color: #8b2252;">"l"</span>)) 'light)
                         ((member type '(<span style="color: #8b2252;">"dark"</span> <span style="color: #8b2252;">"d"</span>)) 'dark)
                         (t my-frame-appearance))))
        (<span style="color: #a020f0;">cond</span> ((eq theme 'dark) (my-night-theme))
              ((eq theme 'light) (my-daylight-theme))
              (t (<span style="color: #a020f0;">let</span> ((night-time-in 22)
                       (night-time-out 5))
                   (<span style="color: #a020f0;">if</span> (my-night-time-p
                        (* night-time-in 60) (* night-time-out 60))
                       (my-night-theme)
                     (my-daylight-theme))))))
    (my-terminal-theme))

  (<span style="color: #a020f0;">unless</span> noninteractive
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">remove unintentional colored frame border</span>
    (select-frame-set-input-focus (selected-frame))
    (my-font-config (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">featurep</span> '<span style="color: #008b8b;">moom-font</span>) moom-font--size))
    (my-apply-cursor-config)
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">(when type</span>
    <span style="color: #b22222;">;;   </span><span style="color: #b22222;">(moom-move-frame-to-edge-top)</span>
    <span style="color: #b22222;">;;   </span><span style="color: #b22222;">(moom-fill-height))</span>
    ))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-night-time-p</span> (begin end)
  (<span style="color: #a020f0;">let*</span> ((ch (string-to-number (format-time-string <span style="color: #8b2252;">"%H"</span> (current-time))))
         (cm (string-to-number (format-time-string <span style="color: #8b2252;">"%M"</span> (current-time))))
         (ct (+ cm (* 60 ch))))
    (<span style="color: #a020f0;">if</span> (&gt; begin end)
        (<span style="color: #a020f0;">or</span> (&lt;= begin ct) (&lt;= ct end))
      (<span style="color: #a020f0;">and</span> (&lt;= begin ct) (&lt;= ct end)))))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-update-theme-timers</span> () <span style="color: #b22222;">;; </span><span style="color: #b22222;">FIXME: it makes frame blink</span>
  (my-theme)
  (<span style="color: #a020f0;">dolist</span> (triger '(2 6 10 14 18 22))
    (<span style="color: #a020f0;">let</span> ((tm (format <span style="color: #8b2252;">"%02d:00"</span> triger)))
      (<span style="color: #a020f0;">when</span> (future-time-p tm)
        (run-at-time tm nil #'my-theme)))))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">(declare-function my-font-config "init" nil)</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">This may override or reset font setting</span>
(<span style="color: #a020f0;">unless</span> noninteractive
  (my-theme)
  (run-at-time <span style="color: #8b2252;">"00:00"</span> 86400 #'my-update-theme-timers)
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">(run-at-time "05:00" 86400 'my-theme)</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">(run-at-time "23:00" 86400 'my-theme)</span>
  ) <span style="color: #b22222;">;; </span><span style="color: #b22222;">FIXME: it makes frame blink</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org9ce2fd45" class="outline-3">
<h3 id="org9ce2fd45"><span class="section-number-3">12.13.</span> [rainbow-mode.el] 配色のリアルタイム確認</h3>
<div class="outline-text-3" id="text-org9ce2fd45">
<p>
<code>M-x rainbow-mode</code> とすると，色指定のコードの背景色を，その指定色にリアルタイム変換してくれる．
</p>

<p>
<a href="http://elpa.gnu.org/packages/rainbow-mode.html">http://elpa.gnu.org/packages/rainbow-mode.html</a>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(rainbow-mode)
                         <span style="color: #8b2252;">"rainbow-mode"</span> nil t)
  (<span style="color: #a020f0;">dolist</span> (hook '(emmet-mode-hook emacs-lisp-mode-hook org-mode-hook))
    (add-hook hook #'rainbow-mode)))
</pre>
</div>
</div>

<div id="outline-container-org19538af3" class="outline-4">
<h4 id="org19538af3"><span class="section-number-4">12.13.1.</span> 色一覧</h4>
<div class="outline-text-4" id="text-org19538af3">
<p>
<code>0,3,6,9,C,F</code> の組み合わせ
</p>

<div class="org-src-container">
<pre class="src src-html">
#000000 #000033 #000066 #000099 #0000CC #0000FF
#003300 #003333 #003366 #003399 #0033CC #0033FF
#006600 #006633 #006666 #006699 #0066CC #0066FF
#009900 #009933 #009966 #009999 #0099CC #0099FF
#00CC00 #00CC33 #00CC66 #00CC99 #00CCCC #00CCFF
#00FF00 #00FF33 #00FF66 #00FF99 #00FFCC #00FFFF

#330000 #330033 #330066 #330099 #3300CC #3300FF
#333300 #333333 #333366 #333399 #3333CC #3333FF
#336600 #336633 #336666 #336699 #3366CC #3366FF
#339900 #339933 #339966 #339999 #3399CC #3399FF
#33CC00 #33CC33 #33CC66 #33CC99 #33CCCC #33CCFF
#33FF00 #33FF33 #33FF66 #33FF99 #33FFCC #33FFFF

#660000 #660033 #660066 #660099 #6600CC #6600FF
#663300 #663333 #663366 #663399 #6633CC #6633FF
#666600 #666633 #666666 #666699 #6666CC #6666FF
#669900 #669933 #669966 #669999 #6699CC #6699FF
#66CC00 #66CC33 #66CC66 #66CC99 #66CCCC #66CCFF
#66FF00 #66FF33 #66FF66 #66FF99 #66FFCC #66FFFF

#990000 #990033 #990066 #990099 #9900CC #9900FF
#993300 #993333 #993366 #993399 #9933CC #9933FF
#996600 #996633 #996666 #996699 #9966CC #9966FF
#999900 #999933 #999966 #999999 #9999CC #9999FF
#99CC00 #99CC33 #99CC66 #99CC99 #99CCCC #99CCFF
#99FF00 #99FF33 #99FF66 #99FF99 #99FFCC #99FFFF

#CC0000 #CC0033 #CC0066 #CC0099 #CC00CC #CC00FF
#CC3300 #CC3333 #CC3366 #CC3399 #CC33CC #CC33FF
#CC6600 #CC6633 #CC6666 #CC6699 #CC66CC #CC66FF
#CC9900 #CC9933 #CC9966 #CC9999 #CC99CC #CC99FF
#CCCC00 #CCCC33 #CCCC66 #CCCC99 #CCCCCC #CCCCFF
#CCFF00 #CCFF33 #CCFF66 #CCFF99 #CCFFCC #CCFFFF

#FF0000 #FF0033 #FF0066 #FF0099 #FF00CC #FF00FF
#FF3300 #FF3333 #FF3366 #FF3399 #FF33CC #FF33FF
#FF6600 #FF6633 #FF6666 #FF6699 #FF66CC #FF66FF
#FF9900 #FF9933 #FF9966 #FF9999 #FF99CC #FF99FF
#FFCC00 #FFCC33 #FFCC66 #FFCC99 #FFCCCC #FFCCFF
#FFFF00 #FFFF33 #FFFF66 #FFFF99 #FFFFCC #FFFFFF

</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgcc116051" class="outline-3">
<h3 id="orgcc116051"><span class="section-number-3">12.14.</span> [edit-color-stamp] Qt経由でカラーピッカーを使う</h3>
<div class="outline-text-3" id="text-orgcc116051">
<ul class="org-ul">
<li><a href="https://github.com/sabof/edit-color-stamp">sabof/edit-color-stamp: Edit hex color stamps using a QT, or the internal color picker</a></li>

<li>Macintosh でもちゃんと使えます．</li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(edit-color-stamp)
                         <span style="color: #8b2252;">"edit-color-stamp"</span> nil t)
  (global-set-key (kbd <span style="color: #8b2252;">"C-c f c p"</span>) 'edit-color-stamp)
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"edit-color-stamp"</span>
    (<span style="color: #a020f0;">unless</span> (executable-find <span style="color: #8b2252;">"qt_color_picker"</span>)
      (message <span style="color: #8b2252;">"--- qt_color_picker is NOT installed."</span>))))
</pre>
</div>

<p>
（設定手順）
</p>
<ul class="org-ul">
<li>QT をインストールして， <code>qmake</code> に <code>PATH</code> を通す（例：/usr/local/opt/qt/bin）</li>
<li><code>edit-color-stamp</code> を入手してインストール先のフォルダに移動</li>
<li>さらに， <code>qt_color_picker</code> ディレクトリに移動</li>
<li><p>
<code>qt_color_picker.pro</code> を編集して， "QT +=" に "widgets" を追加して保存する．
</p>
<div class="org-src-container">
<pre class="src src-conf"><span style="color: #a0522d;">QT +</span>= core gui widgets
</pre>
</div></li>
<li><code>qmake qt_color_picker.pro &amp;&amp; make</code> を実行</li>
<li>出来上がった <code>qt_color_picker.app</code> を <code>/Applications/</code> にコピー（移動）</li>
<li><p>
<code>exec-path</code> にパスを通す
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(add-to-list 'exec-path <span style="color: #8b2252;">"/Applications/qt_color_picker.app/Contents/MacOS/"</span>)
</pre>
</div></li>
<li><code>(executable-find "qt_color_picker")</code> でプログラムを呼べることを確認</li>
<li><code>#FFFFFF</code> などの色の上で <code>M-x edit-color-stamp</code> を実行する</li>
<li>カラーピッカーで色を選んで「OK」すれば， <code>#FFFFFF</code> が更新される．</li>
</ul>
</div>
</div>

<div id="outline-container-orge836aa4d" class="outline-3">
<h3 id="orge836aa4d"><span class="section-number-3">12.15.</span> [ivy.el] インターフェイスの配色</h3>
<div class="outline-text-3" id="text-orge836aa4d">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-ivy-format-function-arrow-iit</span> (cands)
  <span style="color: #8b2252;">"Transform CANDS into a string for minibuffer."</span>
  (ivy--format-function-generic
   (<span style="color: #a020f0;">lambda</span> (str)
     (concat (icons-in-terminal-faicon
              <span style="color: #8b2252;">"hand-o-right"</span>
              <span style="color: #483d8b;">:v-adjust</span> -0.1
              <span style="color: #483d8b;">:face</span> 'my-ivy-arrow-visible
              <span style="color: #483d8b;">:height</span> 0.8)
             <span style="color: #8b2252;">" "</span> (ivy--add-face (concat str <span style="color: #8b2252;">"\n"</span>)
                                'ivy-current-match)))
   (<span style="color: #a020f0;">lambda</span> (str)
     (concat (icons-in-terminal-faicon
              <span style="color: #8b2252;">"hand-o-right"</span>
              <span style="color: #483d8b;">:v-adjust</span> -0.1
              <span style="color: #483d8b;">:face</span> 'my-ivy-arrow-invisible
              <span style="color: #483d8b;">:height</span> 0.8)
             <span style="color: #8b2252;">" "</span> (concat str <span style="color: #8b2252;">"\n"</span>)))
   cands
   <span style="color: #8b2252;">""</span>))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-ivy-format-function-arrow-ati</span> (cands)
  <span style="color: #8b2252;">"Transform CANDS into a string for minibuffer."</span>
  (ivy--format-function-generic
   (<span style="color: #a020f0;">lambda</span> (str)
     (concat (all-the-icons-faicon
              <span style="color: #8b2252;">"hand-o-right"</span>
              <span style="color: #483d8b;">:v-adjust</span> -0.2 <span style="color: #483d8b;">:face</span> 'my-ivy-arrow-visible)
             <span style="color: #8b2252;">" "</span> (ivy--add-face str 'ivy-current-match)))
   (<span style="color: #a020f0;">lambda</span> (str)
     (concat (all-the-icons-faicon
              <span style="color: #8b2252;">"hand-o-right"</span> <span style="color: #483d8b;">:face</span> 'my-ivy-arrow-invisible)
             <span style="color: #8b2252;">" "</span> str))
   cands
   <span style="color: #8b2252;">"\n"</span>))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"ivy"</span>
  (custom-set-faces
   '(ivy-current-match
     ((((class color) (background light))
       <span style="color: #483d8b;">:background</span> <span style="color: #8b2252;">"#FFF3F3"</span> <span style="color: #483d8b;">:distant-foreground</span> <span style="color: #8b2252;">"#000000"</span> <span style="color: #483d8b;">:extend</span> t)
      (((class color) (background dark))
       <span style="color: #483d8b;">:background</span> <span style="color: #8b2252;">"#404040"</span> <span style="color: #483d8b;">:distant-foreground</span> <span style="color: #8b2252;">"#abb2bf"</span> <span style="color: #483d8b;">:extend</span> t)))
   '(ivy-minibuffer-match-face-1
     ((((class color) (background light)) <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#666666"</span>)
      (((class color) (background dark)) <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#999999"</span>)))
   '(ivy-minibuffer-match-face-2
     ((((class color) (background light)) <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#c03333"</span> <span style="color: #483d8b;">:underline</span> t)
      (((class color) (background dark)) <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#e04444"</span> <span style="color: #483d8b;">:underline</span> t)))
   '(ivy-minibuffer-match-face-3
     ((((class color) (background light)) <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#8585ff"</span> <span style="color: #483d8b;">:underline</span> t)
      (((class color) (background dark)) <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#7777ff"</span> <span style="color: #483d8b;">:underline</span> t)))
   '(ivy-minibuffer-match-face-4
     ((((class color) (background light)) <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#439943"</span> <span style="color: #483d8b;">:underline</span> t)
      (((class color) (background dark)) <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#33bb33"</span> <span style="color: #483d8b;">:underline</span> t)))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org4b927009" class="outline-3">
<h3 id="org4b927009"><span class="section-number-3">12.16.</span> [ivy.el] 選択行をアイコンで強調</h3>
<div class="outline-text-3" id="text-org4b927009">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"counsel"</span>
<span style="color: #b22222;">;;; </span><span style="color: #b22222;">&#36984;&#25246;&#23550;&#35937;&#12434; "" &#12395;&#12377;&#12427; (requires all-the-icons.el)</span>
  (<span style="color: #a020f0;">defface</span> <span style="color: #a0522d;">my-ivy-arrow-visible</span>
    '((((class color) (background light)) <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"orange"</span>)
      (((class color) (background dark)) <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#EE6363"</span>))
    <span style="color: #8b2252;">"Face used by Ivy for highlighting the arrow."</span>)
  (<span style="color: #a020f0;">defface</span> <span style="color: #a0522d;">my-ivy-arrow-invisible</span>
    '((((class color) (background light)) <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#FFFFFF"</span>)
      (((class color) (background dark)) <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#31343F"</span>))
    <span style="color: #8b2252;">"Face used by Ivy for highlighting the invisible arrow."</span>)

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">Remove the default setting</span>
  (delete '(t . ivy-format-function-default) ivy-format-functions-alist)

  (<span style="color: #a020f0;">if</span> window-system
      (<span style="color: #a020f0;">cond</span> ((<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">icons-in-terminal</span> nil t)
             (add-to-list
              'ivy-format-functions-alist
              '(t . my-ivy-format-function-arrow-iit) t))
            ((<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">all-the-icons</span> nil t)
             (add-to-list
              'ivy-format-functions-alist
              '(t . my-ivy-format-function-arrow-ati) t))
            (t
             (add-to-list
              'ivy-format-functions-alist
              '(t . ivy-format-function-arrow-line) t)))
    (add-to-list
     'ivy-format-functions-alist
     '(t . ivy-format-function-arrow-line) t)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org36a28b28" class="outline-3">
<h3 id="org36a28b28"><span class="section-number-3">12.17.</span> [volatile-highlights] コピペした領域を強調</h3>
<div class="outline-text-3" id="text-org36a28b28">
<p>
コピペ直後の数秒に限定して，コピペした領域をハイライトします．さらに，所定の間隔で表示色を変えることで，ハイライト色が徐々に消えていくようなエフェクトにしています．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">&#12405;&#12431;&#12387;&#12392;&#12456;&#12501;&#12455;&#12463;&#12488;&#12398;&#36861;&#21152;&#65288;&#12506;&#12540;&#12473;&#12488;&#26178;&#12398;&#33394; =&gt; &#12459;&#12540;&#12477;&#12523;&#33394; =&gt; &#26412;&#26469;&#33394;&#65289;</span>
<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-vhl-change-color</span> ()
  (<span style="color: #a020f0;">interactive</span>)
  (<span style="color: #a020f0;">when</span> (boundp 'vhl/.hl-lst)
    (<span style="color: #a020f0;">let</span> ((next 0.2)
          (reset 0.5)
          (colors '(<span style="color: #8b2252;">"#F8D3D7"</span> <span style="color: #8b2252;">"#F2DAE1"</span> <span style="color: #8b2252;">"#EBE0EB"</span> <span style="color: #8b2252;">"#E5E7F5"</span> <span style="color: #8b2252;">"#DEEDFF"</span>)))
      (<span style="color: #a020f0;">dolist</span> (color colors)
        (run-at-time next nil
                     'set-face-attribute
                     'vhl/default-face
                     nil <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#FF3333"</span> <span style="color: #483d8b;">:background</span> color)
        (<span style="color: #a020f0;">setq</span> next (+ 0.05 next)))
      (run-at-time reset nil 'vhl/clear-all))
    (set-face-attribute 'vhl/default-face
                        nil <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#FF3333"</span>
                        <span style="color: #483d8b;">:background</span> <span style="color: #8b2252;">"#FFCDCD"</span>)))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-yank</span> (<span style="color: #228b22;">&amp;optional</span> ARG)
  (<span style="color: #a020f0;">interactive</span>)
  (yank ARG)
  (<span style="color: #a020f0;">when</span> window-system
    (my-vhl-change-color)))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-org-yank</span> ()
  (<span style="color: #a020f0;">interactive</span>)
  (org-yank)
  (<span style="color: #a020f0;">when</span> window-system
    (my-vhl-change-color)))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-vhl-activate</span> (<span style="color: #228b22;">&amp;optional</span> arg)
  (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">volatile-highlights</span> nil t) <span style="color: #b22222;">;; </span><span style="color: #b22222;">will take 40-50[ms]</span>
  (advice-remove 'my-yank #'my-vhl-activate)
  arg)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(volatile-highlights-mode my-vhl-change-color)
                         <span style="color: #8b2252;">"volatile-highlights"</span> nil t)
  (global-set-key (kbd <span style="color: #8b2252;">"M-v"</span>) 'my-yank)
  (global-set-key (kbd <span style="color: #8b2252;">"C-y"</span>) 'my-yank)
  (<span style="color: #a020f0;">when</span> window-system
    (advice-add 'my-yank <span style="color: #483d8b;">:before</span> #'my-vhl-activate))

  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"volatile-highlights"</span>
    (set-face-attribute
     'vhl/default-face nil <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#FF3333"</span> <span style="color: #483d8b;">:background</span> <span style="color: #8b2252;">"#FFCDCD"</span>)
    (volatile-highlights-mode t))

  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"vterm"</span>
    (define-key vterm-mode-map (kbd <span style="color: #8b2252;">"C-y"</span>) 'vterm-yank))

  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"org"</span>
    (define-key org-mode-map (kbd <span style="color: #8b2252;">"C-y"</span>) 'my-org-yank)))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org6794a918" class="outline-2">
<h2 id="org6794a918"><span class="section-number-2">13.</span> 非同期実行</h2>
<div class="outline-text-2" id="text-org6794a918">
</div>

<div id="outline-container-orgc4efbf8e" class="outline-3">
<h3 id="orgc4efbf8e"><span class="section-number-3">13.1.</span> [async] パッケージのインストール状況を確認</h3>
<div class="outline-text-3" id="text-orgc4efbf8e">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">unless</span> noninteractive
  (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">and</span> window-system
             (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">init-async</span> nil t))
    (my-delete-old-backup 3)))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-async-locate-libraries</span> (libraries <span style="color: #228b22;">&amp;optional</span> defer)
  <span style="color: #8b2252;">"Check the library listed in `</span><span style="color: #008b8b;">LIBRARIES</span><span style="color: #8b2252;">'."</span>
  (<span style="color: #a020f0;">if</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">async</span> nil t)
      (async-start
       `(<span style="color: #a020f0;">lambda</span> ()
          (sleep-for (<span style="color: #a020f0;">or</span> ',defer 10))
          (<span style="color: #a020f0;">setq</span> load-path ',load-path)
          (<span style="color: #a020f0;">let</span> ((alist nil))
            (mapc (<span style="color: #a020f0;">lambda</span> (library)
                    (<span style="color: #a020f0;">let</span> ((path (locate-library library)))
                      (<span style="color: #a020f0;">unless</span> path
                        (add-to-list 'alist (format <span style="color: #8b2252;">"%s"</span> library)))))
                  (<span style="color: #a020f0;">if</span> (listp ',libraries)
                      ',libraries
                    (list ',libraries)))
            alist))
       (<span style="color: #a020f0;">lambda</span> (result)
         (<span style="color: #a020f0;">let</span> ((inhibit-message nil)
               (message-log-max 5000))
           (<span style="color: #a020f0;">if</span> result
               (<span style="color: #a020f0;">unless</span> (active-minibuffer-window)
                 (<span style="color: #a020f0;">let</span> ((count 0))
                   (<span style="color: #a020f0;">dolist</span> (r result)
                     (<span style="color: #a020f0;">setq</span> count (1+ count))
                     (message <span style="color: #8b2252;">"&gt;&gt; %s (missing)"</span> r))
                   (message (concat (format <span style="color: #8b2252;">"[async] %s package"</span> count)
                                    (<span style="color: #a020f0;">if</span> (&gt; count 1) <span style="color: #8b2252;">"s are"</span> <span style="color: #8b2252;">" is"</span>)
                                    <span style="color: #8b2252;">" NOT installed."</span>))))
             (message <span style="color: #8b2252;">"[async] Checking packages installation...done"</span>)))))
    (<span style="color: #ff0000; font-weight: bold;">error</span> <span style="color: #8b2252;">"missing async.el"</span>)))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-find-missing-packages</span> (<span style="color: #228b22;">&amp;optional</span> defer)
  (<span style="color: #a020f0;">interactive</span>)
  (my-async-locate-libraries my-required-libraries (<span style="color: #a020f0;">or</span> defer 0)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org9fefe803" class="outline-3">
<h3 id="org9fefe803"><span class="section-number-3">13.2.</span> [async] 古いバックアップファイルを削除</h3>
<div class="outline-text-3" id="text-org9fefe803">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">unless</span> noninteractive
  (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">and</span> window-system
             (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">init-async</span> nil t))
    (<span style="color: #a020f0;">when</span> my-skip-check-autoload-file <span style="color: #b22222;">;; </span><span style="color: #b22222;">see init-env.el</span>
          (my-find-missing-packages 5))))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-delete-old-backup</span> (<span style="color: #228b22;">&amp;optional</span> defer)
  (<span style="color: #a020f0;">if</span> (not (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">async</span> nil t)) <span style="color: #b22222;">;; </span><span style="color: #b22222;">5[ms]</span>
      (recursive-delete-backup-files 7)
    (async-start <span style="color: #b22222;">;; </span><span style="color: #b22222;">do not call this from byte compiled code directory</span>
     `(<span style="color: #a020f0;">lambda</span> ()
        (sleep-for (<span style="color: #a020f0;">or</span> ',defer 5))
        (<span style="color: #a020f0;">when</span> (load (concat (getenv <span style="color: #8b2252;">"HOME"</span>) <span style="color: #8b2252;">"/.emacs"</span>) t)
          (recursive-delete-backup-files 7)
          t))
     (<span style="color: #a020f0;">lambda</span> (result)
       (<span style="color: #a020f0;">if</span> result
           (<span style="color: #a020f0;">let</span> ((inhibit-message nil)
                 (message-log-max 5000))
             (<span style="color: #a020f0;">unless</span> (eval '(active-minibuffer-window))
               (message <span style="color: #8b2252;">"[async] Deleting old backup files...done"</span>)))
         (<span style="color: #ff0000; font-weight: bold;">error</span> <span style="color: #8b2252;">"[async] Failed to delete backup files."</span>))))))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgb8e84b9a" class="outline-2">
<h2 id="orgb8e84b9a"><span class="section-number-2">14.</span> ユーティリティ関数</h2>
<div class="outline-text-2" id="text-orgb8e84b9a">
</div>

<div id="outline-container-orgbfb695e1" class="outline-3">
<h3 id="orgbfb695e1"><span class="section-number-3">14.1.</span> [pomodoro.el] ポモドーロの実践</h3>
<div class="outline-text-3" id="text-orgbfb695e1">
<p>
<a href="https://twitter.com/syohex">@syohex</a> さん謹製の <a href="https://github.com/syohex/emacs-utils/blob/master/pomodoro.el">pomodoro.el</a> に少しカスタマイズしたおれおれ <a href="https://github.com/takaxp/emacs-utils/blob/master/pomodoro.el">pomodoro.el</a> を使っています．以下のように設定すると，ポモドーロの残り時間は表示せず，アイコンだけをモードラインに表示できます．残り時間は <code>M-x pomodoro:mode-line-time-display-toggle</code> すれば，いつでも表示できます．
</p>

<p>
<code>pomodoro:finish-work-hook</code> ， <code>pomodoro:finish-rest-hook</code> ， <code>pomodoro:long-rest-hook</code> にそれぞれ結びつけてあるのは，<a href="http://www.mactechlab.jp/products-report/16673.html">Macのスピーチ機能</a>です．この例では，Kyoko さんが指示を出してくれます．
</p>

<p>
<code>M-x pomodoro:start</code> すると，ポモドーロが始まり，8時間後に <code>pomodoro:stop</code> が呼ばれてポモドーロが終了します．<a href="http://www.pomodorotechnique.com/">pomodoro</a> は機械的に仕事をしたい人にピッタリです．人によっては <a href="http://ja.wikipedia.org/wiki/Getting_Things_Done">GTD</a> よりも取っ付きやすいと思います．
</p>

<p>
なお，Org Mode と組み合わせたい場合は，通知を <code>org-clock-in</code> と <code>org-clock-out</code> に連動させる <a href="https://github.com/lolownia/org-pomodoro">org-pomodoro.el</a> があります．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(pomodoro:start)
                         <span style="color: #8b2252;">"pomodoro"</span> nil t)
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">(with-eval-after-load "postpone"</span>
  <span style="color: #b22222;">;;   </span><span style="color: #b22222;">(when (and (not noninteractive)</span>
  <span style="color: #b22222;">;;              </span><span style="color: #b22222;">(not (boundp 'pomodoro:timer)))</span>
  <span style="color: #b22222;">;;     </span><span style="color: #b22222;">;; &#37325;&#35079;&#36215;&#21205;&#12434;&#22238;&#36991;</span>
  <span style="color: #b22222;">;;     </span><span style="color: #b22222;">(pomodoro:start nil)))</span>

  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"pomodoro"</span>
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#20316;&#26989;&#26178;&#38291;&#32066;&#20102;&#24460;&#12395;&#38283;&#12367;&#12501;&#12449;&#12452;&#12523;&#12434;&#25351;&#23450;&#12375;&#12394;&#12356;</span>
    (<span style="color: #a020f0;">setq</span> pomodoro:file nil)
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#9679;&#12384;&#12369;&#12391;&#34920;&#29694;&#12377;&#12427;&#65288;&#27531;&#12426;&#26178;&#38291;&#34920;&#31034;&#12394;&#12375;&#65289;</span>
    (<span style="color: #a020f0;">setq</span> pomodoro:mode-line-time-display nil)
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#9679;&#12398;&#32622;&#12365;&#25563;&#12360;</span>
    (<span style="color: #a020f0;">setq</span> pomodoro:mode-line-work-sign <span style="color: #8b2252;">"&gt;&gt;"</span>)
    (<span style="color: #a020f0;">setq</span> pomodoro:mode-line-rest-sign <span style="color: #8b2252;">"&lt;&lt;"</span>)
    (<span style="color: #a020f0;">setq</span> pomodoro:mode-line-long-rest-sign <span style="color: #8b2252;">"&lt;&gt;"</span>)
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#38263;&#12356;&#20241;&#25001;&#12395;&#20837;&#12427;&#12414;&#12391;&#12395;&#12509;&#12514;&#12489;&#12540;&#12525;&#12377;&#12427;&#22238;&#25968;</span>
    (<span style="color: #a020f0;">setq</span> pomodoro:iteration-for-long-rest 4)
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#20316;&#26989;&#26178;&#38291;&#38306;&#36899;</span>
    (<span style="color: #a020f0;">setq</span> pomodoro:work-time 25     <span style="color: #b22222;">; </span><span style="color: #b22222;">&#20316;&#26989;&#26178;&#38291;</span>
          pomodoro:rest-time 5      <span style="color: #b22222;">; </span><span style="color: #b22222;">&#20241;&#25001;&#26178;&#38291;</span>
          pomodoro:long-rest-time 30 <span style="color: #b22222;">; </span><span style="color: #b22222;">&#38263;&#12356;&#20241;&#25001;&#26178;&#38291;</span>
          pomodoro:max-iteration 16) <span style="color: #b22222;">; </span><span style="color: #b22222;">&#12509;&#12514;&#12489;&#12540;&#12525;&#12377;&#12427;&#22238;&#25968;</span>
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#12479;&#12452;&#12510;&#12540;&#12398;&#34920;&#31034;&#12434;&#12494;&#12540;&#12510;&#12523;&#12501;&#12455;&#12452;&#12473;&#12395;&#12377;&#12427;</span>
    (set-face-bold-p 'pomodoro:timer-face nil)
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#20316;&#26989;&#20013;&#65288;&#36196;&#65289;&#65292;&#20241;&#25001;&#20013;&#65288;&#38738;&#65289;&#65292;&#38263;&#12356;&#20241;&#25001;&#20013;&#65288;&#32209;&#65289;&#12395;&#12377;&#12427;</span>
    (custom-set-faces
     '(pomodoro:work-face
       ((((background dark)) <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#DB4C46"</span> <span style="color: #483d8b;">:bold</span> t)
        (t (<span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#A130C4"</span> <span style="color: #483d8b;">:bold</span> t)))) <span style="color: #b22222;">;; </span><span style="color: #b22222;">#8248c4 , #956dc4, #9d64c4</span>
     '(pomodoro:rest-face
       ((((background dark)) <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#3869FA"</span> <span style="color: #483d8b;">:bold</span> t)
        (t (<span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#203e6f"</span> <span style="color: #483d8b;">:bold</span> t))))
     '(pomodoro:long-rest-face
       ((((background dark)) <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#008890"</span> <span style="color: #483d8b;">:bold</span> t)
        (t (<span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#1c9b08"</span> <span style="color: #483d8b;">:bold</span> t))))) <span style="color: #b22222;">;; </span><span style="color: #b22222;">00B800</span>

    (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-pomodoro-status</span> ()
      <span style="color: #8b2252;">"Show the current `</span><span style="color: #008b8b;">pomodoro</span><span style="color: #8b2252;">' status in minibuffer when focus-in."</span>
      (<span style="color: #a020f0;">interactive</span>)
      (<span style="color: #a020f0;">when</span> pomodoro:timer
        (<span style="color: #a020f0;">let</span> ((message-log-max nil))
          (message
           (format <span style="color: #8b2252;">"[%d/%s] %s to go "</span>
                   pomodoro:work-count
                   pomodoro:max-iteration
                   (pomodoro:time-to-string pomodoro:remainder-seconds))))))
    (add-hook 'focus-in-hook #'my-pomodoro-status)

    (<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">my-pomodoro-speak</span> nil)
    (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-toggle-pomodoro-speak</span> ()
      (<span style="color: #a020f0;">interactive</span>)
      (<span style="color: #a020f0;">setq</span> my-pomodoro-speak (not my-pomodoro-speak)))

    (<span style="color: #a020f0;">when</span> (memq window-system '(mac ns))
      <span style="color: #b22222;">;; </span><span style="color: #b22222;">Mac &#12518;&#12540;&#12470;&#21521;&#12369;&#65294;Kyoko&#12373;&#12435;&#12395;&#25351;&#31034;&#12375;&#12390;&#12418;&#12425;&#12358;</span>
      (<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">pomodoro:with-speak</span> nil)
      (<span style="color: #a020f0;">when</span> pomodoro:with-speak
        (add-hook 'pomodoro:finish-work-hook
                  (<span style="color: #a020f0;">lambda</span> ()
                    (<span style="color: #a020f0;">let</span> ((script
                           (concat <span style="color: #8b2252;">"say -v Kyoko "</span>
                                   (number-to-string
                                    (floor pomodoro:rest-time))
                                   <span style="color: #8b2252;">"&#20998;&#38291;&#65292;&#20241;&#25001;&#12375;&#12429;"</span>)))
                      (<span style="color: #a020f0;">if</span> my-pomodoro-speak
                          (shell-command-to-string script)
                        (message <span style="color: #8b2252;">"%s"</span> script)))))

        (add-hook 'pomodoro:finish-rest-hook
                  (<span style="color: #a020f0;">lambda</span> ()
                    (<span style="color: #a020f0;">let</span> ((script
                           (concat <span style="color: #8b2252;">"say -v Kyoko "</span>
                                   (number-to-string
                                    (floor pomodoro:work-time))
                                   <span style="color: #8b2252;">"&#20998;&#38291;&#65292;&#20316;&#26989;&#12375;&#12429;"</span>)))
                      (<span style="color: #a020f0;">if</span> my-pomodoro-speak
                          (shell-command-to-string script)
                        (message <span style="color: #8b2252;">"%s"</span> script)))))

        (add-hook 'pomodoro:long-rest-hook
                  (<span style="color: #a020f0;">lambda</span> ()
                    (<span style="color: #a020f0;">let</span> ((script
                           (concat <span style="color: #8b2252;">"say -v Kyoko &#12371;&#12428;&#12363;&#12425;"</span>
                                   (number-to-string
                                    (floor pomodoro:long-rest-time))
                                   <span style="color: #8b2252;">"&#20998;&#38291;&#12398;&#20241;&#25001;&#12391;&#12377;"</span>)))
                      (<span style="color: #a020f0;">if</span> my-pomodoro-speak
                          (shell-command-to-string script)
                        (message <span style="color: #8b2252;">"%s"</span> script))))))

      (<span style="color: #a020f0;">declare-function</span> my-pomodoro-notify <span style="color: #8b2252;">"init"</span> nil)
      (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-pomodoro-notify</span> ()
        (my-desktop-notification
         <span style="color: #8b2252;">"Pomodoro"</span>
         (concat <span style="color: #8b2252;">"&#19977;&#19977; &#65421;(*&#65439;&#8711;&#65439;)&#65417;   Go #"</span>
                 (format <span style="color: #8b2252;">"%s"</span> (1+ pomodoro:work-count))) <span style="color: #ff0000; font-weight: bold;">nil </span><span style="color: #ff0000; font-weight: bold;">"Glass"</span><span style="color: #ff0000; font-weight: bold;">))</span>
      (add-hook 'pomodoro:finish-work-hook #'my-pomodoro-notify))))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc09c0be3" class="outline-3">
<h3 id="orgc09c0be3"><span class="section-number-3">14.2.</span> [pomodoro.el] 続・ポモドーロの実践</h3>
<div class="outline-text-3" id="text-orgc09c0be3">
<p>
さらに，モードラインに出すスタータスを表すサインに動きを付けます．ただ頻繁にモードラインを更新して描画するので，環境によっては動作が重くなるかもしれません．
</p>

<p>
各 interlval の数値を <code>setq</code> で後から変更する場合は，その直後に <code>pomodoro:activate-visual-work-sign</code> もしくは変更する interval に対応する同様の関数を実行してください．モードラインに変更が反映されます．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"pomodoro"</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#36861;&#21152;&#23455;&#35013;</span>
  (<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">pomodoro:update-work-sign-interval</span> 0.17) <span style="color: #b22222;">;; </span><span style="color: #b22222;">work&#29992;&#34920;&#31034;&#38291;&#38548;</span>
  (<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">pomodoro:update-rest-sign-interval</span> 0.21) <span style="color: #b22222;">;; </span><span style="color: #b22222;">rest&#29992;&#34920;&#31034;&#38291;&#38548;</span>
  (<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">pomodoro:update-long-rest-sign-interval</span> 0.36) <span style="color: #b22222;">;; </span><span style="color: #b22222;">long-rest&#29992;&#34920;&#31034;&#38291;&#38548;</span>

  (<span style="color: #a020f0;">setq</span> pomodoro:mode-line-work-sign-list
        '(<span style="color: #8b2252;">"/  "</span> <span style="color: #8b2252;">"// "</span> <span style="color: #8b2252;">"///"</span> <span style="color: #8b2252;">" //"</span> <span style="color: #8b2252;">"  /"</span> <span style="color: #8b2252;">"   "</span> <span style="color: #8b2252;">"   "</span>))
  (<span style="color: #a020f0;">setq</span> pomodoro:mode-line-rest-sign-list
        '(<span style="color: #8b2252;">".  "</span> <span style="color: #8b2252;">".. "</span> <span style="color: #8b2252;">"..."</span> <span style="color: #8b2252;">"..:"</span> <span style="color: #8b2252;">".::"</span> <span style="color: #8b2252;">":::"</span> <span style="color: #8b2252;">":::"</span>
          <span style="color: #8b2252;">"::."</span> <span style="color: #8b2252;">":.."</span> <span style="color: #8b2252;">"..."</span> <span style="color: #8b2252;">" .."</span> <span style="color: #8b2252;">"  ."</span> <span style="color: #8b2252;">"   "</span> <span style="color: #8b2252;">"   "</span>
          <span style="color: #8b2252;">",  "</span> <span style="color: #8b2252;">",, "</span> <span style="color: #8b2252;">",,,"</span> <span style="color: #8b2252;">",,;"</span> <span style="color: #8b2252;">",;;"</span> <span style="color: #8b2252;">";;;"</span> <span style="color: #8b2252;">";;;"</span>
          <span style="color: #8b2252;">";;,"</span> <span style="color: #8b2252;">";,,"</span> <span style="color: #8b2252;">",,,"</span> <span style="color: #8b2252;">" ,,"</span> <span style="color: #8b2252;">"  ,"</span> <span style="color: #8b2252;">"   "</span> <span style="color: #8b2252;">"   "</span>))
  (<span style="color: #a020f0;">setq</span> pomodoro:mode-line-long-rest-sign-list
        '(<span style="color: #8b2252;">"   "</span> <span style="color: #8b2252;">" | "</span> <span style="color: #8b2252;">"|||"</span> <span style="color: #8b2252;">"| |"</span> <span style="color: #8b2252;">"   "</span>))

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">Example.0</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">(setq pomodoro:mode-line-work-sign-list</span>
  <span style="color: #b22222;">;;       </span><span style="color: #b22222;">'("|  " "|| " "|||" " ||" "  |" "   " "   "</span>
  <span style="color: #b22222;">;;         </span><span style="color: #b22222;">"  |" " ||" "|||" "|| " "|  " "   " "   "))</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">(setq pomodoro:mode-line-rest-sign-list</span>
  <span style="color: #b22222;">;;       </span><span style="color: #b22222;">'(".  " ".. " "..." " .." "  ." "   " "   "</span>
  <span style="color: #b22222;">;;         </span><span style="color: #b22222;">"  ." " .." "..." ".. " ".  " "   " "   "))</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">(setq pomodoro:mode-line-long-rest-sign-list</span>
  <span style="color: #b22222;">;;       </span><span style="color: #b22222;">'("   " " | " "|||" "| |" "   "))</span>

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">Example.1</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">(defvar pomodoro:mode-line-work-sign-list</span>
  <span style="color: #b22222;">;;   </span><span style="color: #b22222;">'("&#9601;" "&#9602;" "&#9603;" "&#9604;" "&#9605;" "&#9606;" "&#9607;" "&#9607;" "&#9606;" "&#9605;" "&#9604;" "&#9603;" "&#9602;" "&#9601;" "&#9601;" ))</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">(defvar pomodoro:mode-line-rest-sign-list</span>
  <span style="color: #b22222;">;;   </span><span style="color: #b22222;">pomodoro:mode-line-work-sign-list)</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">(defvar pomodoro:mode-line-long-rest-sign-list</span>
  <span style="color: #b22222;">;;   </span><span style="color: #b22222;">pomodoro:mode-line-work-sign-list)</span>

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">Example.2</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">(defvar pomodoro:mode-line-work-sign-list</span>
  <span style="color: #b22222;">;;   </span><span style="color: #b22222;">'("&gt;   " "&gt;&gt;  " "&gt;&gt;&gt; " "&gt;&gt;&gt;&gt;" " &gt;&gt;&gt;" "  &gt;&gt;" "   &gt;" "    "))</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">(defvar pomodoro:mode-line-rest-sign-list</span>
  <span style="color: #b22222;">;;   </span><span style="color: #b22222;">'("   &lt;" "  &lt;&lt;" " &lt;&lt;&lt;" "&lt;&lt;&lt;&lt;" "&lt;&lt;&lt; " "&lt;&lt;  " "&lt;   " "    "))</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">(defvar pomodoro:mode-line-long-rest-sign-list</span>
  <span style="color: #b22222;">;;   </span><span style="color: #b22222;">'("  &lt;&gt;  " " &lt;&lt;&gt;&gt; " "&lt;&lt;&lt;&gt;&gt;&gt;" "&lt;&lt;  &gt;&gt;" "&lt;    &gt;" "      "))</span>

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">Example.3</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">(setq pomodoro:mode-line-work-sign-list</span>
  <span style="color: #b22222;">;;       </span><span style="color: #b22222;">'("&#9602;&#9601;  &#9601;" "&#9603;&#9602;&#9601;  " "&#9604;&#9603;&#9602;&#9601; " "&#9605;&#9604;&#9603;&#9602;&#9601;" "&#9606;&#9605;&#9604;&#9603;&#9602;" "&#9607;&#9606;&#9605;&#9604;&#9603;" "&#9607;&#9607;&#9606;&#9605;&#9604;" "&#9606;&#9607;&#9607;&#9606;&#9605;"</span>
  <span style="color: #b22222;">;;         </span><span style="color: #b22222;">"&#9605;&#9606;&#9607;&#9607;&#9606;" "&#9604;&#9605;&#9606;&#9607;&#9607;" "&#9603;&#9604;&#9605;&#9606;&#9607;" "&#9602;&#9603;&#9604;&#9605;&#9606;" "&#9601;&#9602;&#9603;&#9604;&#9605;" " &#9601;&#9602;&#9603;&#9604;" "  &#9601;&#9602;&#9603;" "&#9601;  &#9601;&#9602;"))</span>

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">Example.4</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">(defvar pomodoro:mode-line-work-sign-list</span>
  <span style="color: #b22222;">;;   </span><span style="color: #b22222;">'("&#9700;&#9698;&#9700; ^-^; &#9698;&#9700;&#9698;"</span>
  <span style="color: #b22222;">;;     </span><span style="color: #b22222;">"&#9700;&#9698;&#9700; ^-^  &#9698;&#9700;&#9698;"</span>
  <span style="color: #b22222;">;;     </span><span style="color: #b22222;">"&#9700;&#9698;&#9700; ^-^  &#9698;&#9700;&#9698;"</span>
  <span style="color: #b22222;">;;     </span><span style="color: #b22222;">"&#9700;&#9698;&#9700; ^-^  &#9698;&#9700;&#9698;"</span>
  <span style="color: #b22222;">;;     </span><span style="color: #b22222;">"&#9700;&#9698;&#9700; ^-^; &#9698;&#9700;&#9698;"</span>
  <span style="color: #b22222;">;;     </span><span style="color: #b22222;">"&#9700;&#9698;&#9700; ^-^; &#9698;&#9700;&#9698;"</span>
  <span style="color: #b22222;">;;     </span><span style="color: #b22222;">"&#9698;&#9700;&#9698;&#9700; ^-^; &#9698;&#9700;"</span>
  <span style="color: #b22222;">;;     </span><span style="color: #b22222;">"&#9700;&#9698;&#9700;&#9698;&#9700; ^-^; &#9698;"</span>
  <span style="color: #b22222;">;;     </span><span style="color: #b22222;">"&#9698;&#9700;&#9698;&#9700;&#9698;&#9700; ^-^; "</span>
  <span style="color: #b22222;">;;     </span><span style="color: #b22222;">" &#9698;&#9700;&#9698;&#9700;&#9698;&#9700; ^-^;"</span>
  <span style="color: #b22222;">;;     </span><span style="color: #b22222;">"; &#9698;&#9700;&#9698;&#9700;&#9698;&#9700; ^-^"</span>
  <span style="color: #b22222;">;;     </span><span style="color: #b22222;">"^; &#9698;&#9700;&#9698;&#9700;&#9698;&#9700; ^-"</span>
  <span style="color: #b22222;">;;     </span><span style="color: #b22222;">"-^; &#9698;&#9700;&#9698;&#9700;&#9698;&#9700; ^"</span>
  <span style="color: #b22222;">;;     </span><span style="color: #b22222;">"^-^; &#9698;&#9700;&#9698;&#9700;&#9698;&#9700; "</span>
  <span style="color: #b22222;">;;     </span><span style="color: #b22222;">" ^-^; &#9698;&#9700;&#9698;&#9700;&#9698;&#9700;"</span>
  <span style="color: #b22222;">;;     </span><span style="color: #b22222;">"&#9700; ^-^; &#9698;&#9700;&#9698;&#9700;&#9698;"</span>
  <span style="color: #b22222;">;;     </span><span style="color: #b22222;">"&#9698;&#9700; ^-^; &#9698;&#9700;&#9698;&#9700;"));</span>

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#12383;&#12394;&#12371;&#12405;&#27663;: https://twitter.com/mattn_jp/status/987203614199263233</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">(setq pomodoro:mode-line-work-sign-list</span>
  <span style="color: #b22222;">;;   </span><span style="color: #b22222;">'("(&#180;&#65381;_&#65381;`)&#180;&#65381;_&#65381;`)"</span>
  <span style="color: #b22222;">;;     </span><span style="color: #b22222;">" (&#180;&#65381;_&#65381;`)_&#65381;`)  "</span>
  <span style="color: #b22222;">;;     </span><span style="color: #b22222;">"  (&#180;&#65381;_&#65381;`)`)   "</span>
  <span style="color: #b22222;">;;     </span><span style="color: #b22222;">"  ((&#180;&#65381;_&#65381;`)    "</span>
  <span style="color: #b22222;">;;     </span><span style="color: #b22222;">" (&#180;&#65381;(&#180;&#65381;_&#65381;`)  "</span>
  <span style="color: #b22222;">;;     </span><span style="color: #b22222;">" (&#180;&#65381;_(&#180;&#65381;_&#65381;`) "</span>
  <span style="color: #b22222;">;;     </span><span style="color: #b22222;">"(&#180;&#65381;_&#65381;`)&#180;&#65381;_&#65381;`)"</span>
  <span style="color: #b22222;">;;     </span><span style="color: #b22222;">" (&#180;&#65381;_&#65381;`)_&#65381;`)  "</span>
  <span style="color: #b22222;">;;     </span><span style="color: #b22222;">"  (&#180;&#65381;_&#65381;`)`)   "</span>
  <span style="color: #b22222;">;;     </span><span style="color: #b22222;">"  (&#180;&#65381;_&#65381;`))    "</span>
  <span style="color: #b22222;">;;     </span><span style="color: #b22222;">"   ((&#180;&#65381;_&#65381;`)   "</span>
  <span style="color: #b22222;">;;     </span><span style="color: #b22222;">"  (&#180;&#65381;(&#180;&#65381;_&#65381;`) "</span>
  <span style="color: #b22222;">;;     </span><span style="color: #b22222;">" (&#180;&#65381;_(&#180;&#65381;_&#65381;`) "));</span>

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#36215;&#21205;&#12501;&#12521;&#12464;</span>
  (<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">my-pomodoro-visualize</span> t)

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#12479;&#12452;&#12510;&#12540;&#12434;&#35352;&#37682;</span>
  (<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">pomodoro:update-sign-timer</span> nil)

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#21021;&#26399;&#29366;&#24907;&#12434;&#30331;&#37682;</span>
  (<span style="color: #a020f0;">if</span> my-pomodoro-visualize
      (<span style="color: #a020f0;">setq</span> pomodoro:mode-line-work-sign
            (car pomodoro:mode-line-work-sign-list))
    (<span style="color: #a020f0;">setq</span> pomodoro:mode-line-work-sign <span style="color: #8b2252;">""</span>)
    (<span style="color: #a020f0;">setq</span> pomodoro:mode-line-rest-sign <span style="color: #8b2252;">""</span>)
    (<span style="color: #a020f0;">setq</span> pomodoro:mode-line-long-rest-sign <span style="color: #8b2252;">""</span>))

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">utilities</span>
  (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">pomodoro:list-rotate</span> (sign-list)
    (<span style="color: #a020f0;">if</span> (listp sign-list)
        (append (cdr sign-list)
                (list (car sign-list)))
      sign-list))

  (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">pomodoro:activate-visual-sign</span> (sign interval)
    (<span style="color: #a020f0;">when</span> (timerp pomodoro:update-sign-timer)
      (cancel-timer pomodoro:update-sign-timer))
    (<span style="color: #a020f0;">setq</span> pomodoro:update-sign-timer
          (run-at-time t interval sign)))

  (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">pomodoro:visualize-start</span> ()
    (<span style="color: #a020f0;">setq</span> my-pomodoro-visualize t)
    (<span style="color: #a020f0;">cond</span> ((eq pomodoro:current-state 'rest)
           (pomodoro:update-rest-sign)
           (pomodoro:activate-visual-rest-sign))
          ((eq pomodoro:current-state 'long-rest)
           (pomodoro:update-long-rest-sign)
           (pomodoro:activate-visual-long-rest-sign))
          (t
           (pomodoro:update-work-sign)
           (pomodoro:activate-visual-work-sign))))

  (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">pomodoro:visualize-stop</span> ()
    (<span style="color: #a020f0;">setq</span> my-pomodoro-visualize nil)
    (<span style="color: #a020f0;">setq</span> pomodoro:mode-line-work-sign <span style="color: #8b2252;">""</span>)
    (<span style="color: #a020f0;">setq</span> pomodoro:mode-line-rest-sign <span style="color: #8b2252;">""</span>)
    (<span style="color: #a020f0;">setq</span> pomodoro:mode-line-long-rest-sign <span style="color: #8b2252;">""</span>)
    (force-mode-line-update t)
    (<span style="color: #a020f0;">when</span> (timerp pomodoro:update-sign-timer)
      (cancel-timer pomodoro:update-sign-timer)))

  (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">ad:pomodoro:start</span> (f <span style="color: #228b22;">&amp;rest</span> minutes)
    <span style="color: #8b2252;">"Extensions to stop pomodoro and timers"</span>
    (<span style="color: #a020f0;">interactive</span> <span style="color: #8b2252;">"P"</span>)
    (pomodoro:visualize-start)
    (apply f minutes))

  (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">ad:pomodoro:stop</span> (f <span style="color: #228b22;">&amp;rest</span> do-reset)
    <span style="color: #8b2252;">"Extensions to stop pomodoro and timers"</span>
    (<span style="color: #a020f0;">interactive</span>)
    (pomodoro:visualize-stop)
    (<span style="color: #a020f0;">when</span> (timerp pomodoro:timer)
      (apply f do-reset)))

  (<span style="color: #a020f0;">when</span> my-pomodoro-visualize
    (advice-add 'pomodoro:start <span style="color: #483d8b;">:around</span> #'ad:pomodoro:start)
    (advice-add 'pomodoro:stop <span style="color: #483d8b;">:around</span> #'ad:pomodoro:stop))

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">work</span>
  (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">pomodoro:update-work-sign</span> ()
    <span style="color: #8b2252;">"Update pomodoro work-sign on modeline."</span>
    (<span style="color: #a020f0;">when</span> my-pomodoro-visualize
      (<span style="color: #a020f0;">setq</span> pomodoro:mode-line-work-sign
            (car pomodoro:mode-line-work-sign-list))
      (<span style="color: #a020f0;">setq</span> pomodoro:mode-line-work-sign-list
            (pomodoro:list-rotate pomodoro:mode-line-work-sign-list))
      (force-mode-line-update t)))

  (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">pomodoro:activate-visual-work-sign</span> ()
    (pomodoro:activate-visual-sign
     'pomodoro:update-work-sign pomodoro:update-work-sign-interval))

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">rest</span>
  (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">pomodoro:update-rest-sign</span> ()
    <span style="color: #8b2252;">"Update pomodoro rest-sign on modeline."</span>
    (<span style="color: #a020f0;">when</span> my-pomodoro-visualize
      (<span style="color: #a020f0;">setq</span> pomodoro:mode-line-rest-sign
            (car pomodoro:mode-line-rest-sign-list))
      (<span style="color: #a020f0;">setq</span> pomodoro:mode-line-rest-sign-list
            (pomodoro:list-rotate pomodoro:mode-line-rest-sign-list))
      (force-mode-line-update t)))

  (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">pomodoro:activate-visual-rest-sign</span> ()
    (pomodoro:activate-visual-sign
     'pomodoro:update-rest-sign pomodoro:update-rest-sign-interval))

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">long rest</span>
  (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">pomodoro:update-long-rest-sign</span> ()
    <span style="color: #8b2252;">"Update pomodoro long-rest-sign on modeline."</span>
    (<span style="color: #a020f0;">when</span> my-pomodoro-visualize
      (<span style="color: #a020f0;">setq</span> pomodoro:mode-line-long-rest-sign
            (car pomodoro:mode-line-long-rest-sign-list))
      (<span style="color: #a020f0;">setq</span> pomodoro:mode-line-long-rest-sign-list
            (pomodoro:list-rotate pomodoro:mode-line-long-rest-sign-list))
      (force-mode-line-update t)))

  (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">pomodoro:activate-visual-long-rest-sign</span> ()
    (pomodoro:activate-visual-sign
     'pomodoro:update-long-rest-sign pomodoro:update-long-rest-sign-interval))

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#12473;&#12486;&#12540;&#12479;&#12473;&#12364;&#20999;&#12426;&#26367;&#12431;&#12427;&#26178;&#12395;&#34920;&#31034;&#12434;&#20837;&#12428;&#26367;&#12360;&#12427;</span>
  (<span style="color: #a020f0;">when</span> my-pomodoro-visualize
    (add-hook 'pomodoro:finish-rest-hook #'pomodoro:activate-visual-work-sign)
    (add-hook 'pomodoro:finish-work-hook #'pomodoro:activate-visual-rest-sign)
    (add-hook 'pomodoro:long-rest-hook
              #'pomodoro:activate-visual-long-rest-sign)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org98f153af" class="outline-3">
<h3 id="org98f153af"><span class="section-number-3">14.3.</span> [google-this.el] 単語をグーグル検索</h3>
<div class="outline-text-3" id="text-org98f153af">
<p>
カーソル下の単語を検索して，結果をブラウザで受け取ります． <code>google-this</code> を直接呼ぶと検索確認を聞かれるので，すぐに検索するようにカスタマイズします． <code>M-x google-this-word</code> を使うのも手ですが，ハイフンで連結された文字列を拾えないので好みがわかれます．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-google-this</span> ()
  (<span style="color: #a020f0;">interactive</span>)
  (google-this (current-word) t))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(my-google-this google-this google-this-word)
                         <span style="color: #8b2252;">"google-this"</span> nil t)
  (global-set-key (kbd <span style="color: #8b2252;">"C-c f g"</span>) 'my-google-this))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc6fce61d" class="outline-3">
<h3 id="orgc6fce61d"><span class="section-number-3">14.4.</span> [multi-term.el] ターミナル</h3>
<div class="outline-text-3" id="text-orgc6fce61d">
<p>
たまに使いたくなるので一応．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">late-init.el</span>
(<span style="color: #a020f0;">when</span> (autoload-if-found '(multi-term)
                         <span style="color: #8b2252;">"multi-term"</span> nil t)
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"multi-term"</span>
    (setenv <span style="color: #8b2252;">"HOSTTYPE"</span> <span style="color: #8b2252;">"intel-mac"</span>)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org96f7a2a3" class="outline-3">
<h3 id="org96f7a2a3"><span class="section-number-3">14.5.</span> [osx-lib.el] macOS用ユーティリティ&#xa0;&#xa0;&#xa0;<span class="tag"><span class="macOS">macOS</span></span></h3>
<div class="outline-text-3" id="text-org96f7a2a3">
<ul class="org-ul">
<li><a href="https://github.com/raghavgautam/osx-lib">raghavgautam/osx-lib</a></li>
<li>OSXの機能を呼び出すためのツール集</li>
<li><code>osx-lib-say-region</code> を呼び出せば，選択領域を機械音で発声させられます．</li>
<li><code>selected.el</code> と組み合わせると選択後にシングルキーで実施できるのでさらに便利です．</li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(osx-lib-say osx-lib-say-region)
                         <span style="color: #8b2252;">"osx-lib"</span> nil t)
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"osx-lib"</span>
    (custom-set-variables
     '(osx-lib-say-ratio 100)
     '(osx-lib-say-voice <span style="color: #8b2252;">"Samantha"</span>))))
</pre>
</div>

<p>
例えば，カエルの歌の輪唱ができます．以下のソースブロックで <code>C-c C-c</code> を適切なタイミングで押してみてください．
</p>

<div class="org-src-container">
<pre class="src src-org"><span style="color: #b22222;">#+begin_src emacs-lisp :results silent</span>
<span style="color: #7f7f7f;">(</span><span style="color: #a020f0;">setq</span><span style="color: #7f7f7f;"> osx-lib-say-voice </span><span style="color: #8b2252;">"Kyoko"</span><span style="color: #7f7f7f;">) </span><span style="color: #b22222;">;; </span><span style="color: #b22222;">Samantha</span>
<span style="color: #7f7f7f;">(</span><span style="color: #a020f0;">setq</span><span style="color: #7f7f7f;"> osx-lib-say-rate 90) </span><span style="color: #b22222;">;; </span><span style="color: #b22222;">min 90 for Samantha</span>
<span style="color: #7f7f7f;">(</span><span style="color: #a020f0;">setq</span><span style="color: #7f7f7f;"> yourscript </span><span style="color: #8b2252;">"&#12363;&#12360;&#12427;&#12398;&#12358;&#12383;&#12364;&#12288;&#12288;&#12288;&#12288;&#12365;&#12371;&#12360;&#12390;&#12367;&#12427;&#12424;&#12288;&#12288;&#12463;&#12449;&#12288;&#12463;&#12449;&#12288;&#12463;&#12449;&#12288;&#12463;&#12449;&#12288;&#12465;&#12465;&#12465;&#12465;&#12288;&#12465;&#12465;&#12465;&#12465;&#12288;&#12463;&#12449;&#12288;&#12463;&#12449;&#12288;&#12463;&#12449;"</span><span style="color: #7f7f7f;">)</span>
<span style="color: #7f7f7f;">(osx-lib-say yourscript)</span>
<span style="color: #b22222;">#+end_src</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org72d850dc" class="outline-3">
<h3 id="org72d850dc"><span class="section-number-3">14.6.</span> iTerm2 を Emacs から呼び出したい&#xa0;&#xa0;&#xa0;<span class="tag"><span class="macOS">macOS</span></span></h3>
<div class="outline-text-3" id="text-org72d850dc">
<p>
<code>C-M-i</code> を iterm2.app の呼び出しに割り当てます．シェルでの作業はどうも <code>eshell</code> では満足できないので．なお flyspell を使っていると，遅延呼び出しした後にキーバインドを奪われるので，取り返します．
</p>

<p>
<code>cmd-to-open-iterm2</code> の実装は，<a href="./utility.el">./utility.el</a> にあります．
</p>

<p>
なお， <code>C-M-i</code> は本来， <code>backward-button</code> に割り当てられています．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(my-cmd-to-open-iterm2)
                         <span style="color: #8b2252;">"utility"</span> nil t)
  (global-set-key (kbd <span style="color: #8b2252;">"C-M-i"</span>) #'my-cmd-to-open-iterm2)
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"flyspell"</span>
    (define-key flyspell-mode-map (kbd <span style="color: #8b2252;">"C-M-i"</span>) #'my-cmd-to-open-iterm2))
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"org"</span>
    (define-key org-mode-map (kbd <span style="color: #8b2252;">"C-M-i"</span>) #'my-cmd-to-open-iterm2)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org4d91e973" class="outline-3">
<h3 id="org4d91e973"><span class="section-number-3">14.7.</span> [counsel-osx-app.el] macOSのアプリケーションを呼び出す&#xa0;&#xa0;&#xa0;<span class="tag"><span class="macOS">macOS</span></span></h3>
<div class="outline-text-3" id="text-org4d91e973">
<p>
Emacs から OS のアプリケーションを呼び出します． <code>Ivy/Counsel</code> の絞り込みを使います．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(counsel-osx-app)
                         <span style="color: #8b2252;">"counsel-osx-app"</span> nil t)
  (global-set-key (kbd <span style="color: #8b2252;">"C-M-1"</span>) 'counsel-osx-app)
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"counsel-osx-app"</span>
    (custom-set-variables
     '(counsel-osx-app-location
       '(<span style="color: #8b2252;">"/Applications"</span> <span style="color: #8b2252;">"/Applications/Utilities"</span>
         <span style="color: #8b2252;">"/System/Applications"</span>
         <span style="color: #8b2252;">"/System/Applications/Utilities"</span>
         <span style="color: #8b2252;">"/Applications/Microsoft Remote Desktop.localized"</span>)))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org32e35e60" class="outline-3">
<h3 id="org32e35e60"><span class="section-number-3">14.8.</span> カレントバッファのあるディレクトリをターミナルで表示</h3>
<div class="outline-text-3" id="text-org32e35e60">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(global-set-key (kbd <span style="color: #8b2252;">"C-c f t"</span>) 'my-open-current-directory-in-terminal)
</pre>
</div>
</div>
</div>

<div id="outline-container-org2906cf09" class="outline-3">
<h3 id="org2906cf09"><span class="section-number-3">14.9.</span> [gif-screencast.el] ユーザアクションのたびにスクショを取る</h3>
<div class="outline-text-3" id="text-org2906cf09">
<ul class="org-ul">
<li><a href="https://gitlab.com/ambrevar/emacs-gif-screencast">Ambrevar / emacs-gif-screencast · GitLab</a>
<ul class="org-ul">
<li>GitLab に移転しました．</li>
<li><a href="https://github.com/Ambrevar/emacs-gif-screencast">Ambrevar/emacs-gif-screencast: One-frame-per-action GIF recording for optimal quality/size ratio</a></li>
</ul></li>
<li><del>色々と Linux用に設計・前提とされていて，今のところ Mac で使うのはちょっと厳しい．</del>
<ul class="org-ul">
<li>macOS用に追加実装しました．<a href="https://github.com/Ambrevar/emacs-gif-screencast/commit/0ab5f3db2ca0679698a297003cb286e727d12c10#diff-825716ca58bd0ebef62b7ed711446577">本家にマージ</a>されています．</li>
<li>スクショ専門ツールもあります．こちらは <code>import</code> コマンドを利用します．
<ul class="org-ul">
<li><a href="https://github.com/tarsius/frameshot">tarsius/frameshot: Take screenshots of a frame</a></li>
</ul></li>
</ul></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-gif-screencast-opendir-dired</span> ()
  <span style="color: #8b2252;">"Open directories for screenshots and generated GIFs by Dired."</span>
  (<span style="color: #a020f0;">interactive</span>)
  (dired gif-screencast-output-directory)
  (dired gif-screencast-screenshot-directory))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">ad:gif-screencast</span> ()
  (<span style="color: #a020f0;">dolist</span> (hook gif-screencast-additional-normal-hooks)
    (add-hook hook #'gif-screencast-capture)))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">ad:gif-screencast-stop</span> ()
  (<span style="color: #a020f0;">dolist</span> (hook gif-screencast-additional-normal-hooks)
    (remove-hook hook 'gif-screencast-capture)))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">ad:gif-screencast-opendir</span> ()
  <span style="color: #8b2252;">"Open the output directory when screencast is finished."</span>
  (<span style="color: #a020f0;">if</span> (not (eq system-type 'darwin))
      (my-gif-screencast-opendir-dired)
    (shell-command-to-string
     (concat <span style="color: #8b2252;">"open "</span> gif-screencast-screenshot-directory))
    (shell-command-to-string
     (concat <span style="color: #8b2252;">"open "</span> gif-screencast-output-directory))))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">ad:gif-screencast-toggle-pause</span> ()
  (<span style="color: #a020f0;">if</span> (memq 'gif-screencast-capture (default-value 'pre-command-hook))
      (<span style="color: #a020f0;">dolist</span> (hook gif-screencast-additional-normal-hooks)
        (remove-hook hook 'gif-screencast-capture))
    (<span style="color: #a020f0;">dolist</span> (hook gif-screencast-additional-normal-hooks)
      (add-hook hook #'gif-screencast-capture))))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(gif-screencast)
                         <span style="color: #8b2252;">"gif-screencast"</span> nil t)
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"gif-screencast"</span>
    (<span style="color: #a020f0;">setq</span> gif-screencast-want-optimized nil)
    (<span style="color: #a020f0;">setq</span> gif-screencast-args '(<span style="color: #8b2252;">"-x"</span>))
    (<span style="color: #a020f0;">setq</span> gif-screencast-capture-format <span style="color: #8b2252;">"ppm"</span>)

    <span style="color: #b22222;">;; </span><span style="color: #b22222;">Start... M-x gif-screencast</span>
    (define-key gif-screencast-mode-map (kbd <span style="color: #8b2252;">"&lt;f5&gt;"</span>) 'gif-screencast-stop)
    (define-key gif-screencast-mode-map (kbd <span style="color: #8b2252;">"S-&lt;f5&gt;"</span>)
      'gif-screencast-toggle-pause)

    <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#25313;&#24373;</span>
    (<span style="color: #a020f0;">defcustom</span> <span style="color: #a0522d;">gif-screencast-additional-normal-hooks</span> '()
      <span style="color: #8b2252;">"A list of hooks. These hooks activate `</span><span style="color: #008b8b;">gif-screencast-capture</span><span style="color: #8b2252;">'."</span>
      <span style="color: #483d8b;">:group</span> 'gif-screencast
      <span style="color: #483d8b;">:type</span> '(repeat hook))

    (add-to-list 'gif-screencast-additional-normal-hooks
                 'window-size-change-functions) <span style="color: #b22222;">;; </span><span style="color: #b22222;">for which-key.el, as of 26.1</span>
    (add-to-list 'gif-screencast-additional-normal-hooks
                 'window-configuration-change-hook) <span style="color: #b22222;">;; </span><span style="color: #b22222;">for which-key.el</span>
    (add-to-list 'gif-screencast-additional-normal-hooks 'focus-in-hook)
    (add-to-list 'gif-screencast-additional-normal-hooks 'focus-out-hook)
    (add-to-list 'gif-screencast-additional-normal-hooks 'minibuffer-setup-hook)
    (add-to-list 'gif-screencast-additional-normal-hooks 'minibuffer-exit-hook)
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">(add-to-list 'gif-screencast-additional-normal-hooks 'pre-redisplay-functions)</span>
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">pre-redisplay-functions &#12399;&#12420;&#12400;&#12356;&#65294;</span>

    <span style="color: #b22222;">;; </span><span style="color: #b22222;">modification-hooks</span>
    (advice-add 'gif-screencast <span style="color: #483d8b;">:after</span> #'ad:gif-screencast)
    (advice-add 'gif-screencast-stop <span style="color: #483d8b;">:after</span> #'ad:gif-screencast-stop)
    (advice-add 'gif-screencast-stop <span style="color: #483d8b;">:before</span> #'ad:gif-screencast-opendir)
    (advice-add 'gif-screencast-toggle-pause
                <span style="color: #483d8b;">:before</span> #'ad:gif-screencast-toggle-pause)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orged473d8d" class="outline-3">
<h3 id="orged473d8d"><span class="section-number-3">14.10.</span> [utility.el] 自作してテスト中の便利関数群</h3>
<div class="outline-text-3" id="text-orged473d8d">
<p>
関数定義を<a href="https://pxaka.tokyo/wiki/doku.php?id=emacs:utility.el">別ファイル</a>に分離して，Emacs起動の高速化を図っています．各関数を autoload の管理下において，必要なときにロードするように設定しています．
</p>

<p>
なお， <code>C-M--</code> は本来， <code>negative-argument</code> に割り振られています．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(global-set-key (kbd <span style="color: #8b2252;">"C-M--"</span>) 'my-cycle-bullet-at-heading)
<span style="color: #b22222;">;; </span><span style="color: #b22222;">(global-set-key (kbd "&lt;f12&gt;") 'my-open-file-ring)</span>
<span style="color: #b22222;">;;  </span><span style="color: #b22222;">(global-set-key (kbd "C-c t") 'my-date)</span>
(global-set-key (kbd <span style="color: #8b2252;">"C-c f 4"</span>) 'my-window-resizer)
</pre>
</div>
</div>
</div>

<div id="outline-container-org72dab3c6" class="outline-3">
<h3 id="org72dab3c6"><span class="section-number-3">14.11.</span> [manage-minor-mode.el] マイナーモードの視覚的な管理</h3>
<div class="outline-text-3" id="text-org72dab3c6">
<p>
マイナーモードの動作状況を視覚的に確認できます．さらに，モードのON/OFFを指定できます．
</p>

<ul class="org-ul">
<li><a href="http://fukuyama.co/manage-minor-mode">minor-modeを簡単に切り替える manage-minor-mode.el Emacs Lisp - Web学び</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(manage-minor-mode)
                         <span style="color: #8b2252;">"manage-minor-mode"</span> nil t)
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"manage-minor-mode"</span>
    (define-key manage-minor-mode-map (kbd <span style="color: #8b2252;">"q"</span>)
      (<span style="color: #a020f0;">lambda</span> () (<span style="color: #a020f0;">interactive</span>)
          (delete-window (get-buffer-window <span style="color: #8b2252;">"*manage-minor-mode*"</span>))))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org2adaf11c" class="outline-3">
<h3 id="org2adaf11c"><span class="section-number-3">14.12.</span> 検索語を変えずに counsel-fzf に接続する</h3>
<div class="outline-text-3" id="text-org2adaf11c">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-nocand-then-fzf-reset</span> ()
  (<span style="color: #a020f0;">setq</span> my--nocand-then-fzf t))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-nocand-then-fzf</span> (prompt)
  (<span style="color: #a020f0;">when</span> (= ivy--length 0)
    (<span style="color: #a020f0;">if</span> (eq (read-char prompt) ?y) <span style="color: #b22222;">;; </span><span style="color: #b22222;">y-or-n-p is not applicable</span>
        (ivy-exit-with-action
         (<span style="color: #a020f0;">lambda</span> (_x)
           (counsel-fzf ivy-text default-directory)))
      (<span style="color: #a020f0;">setq</span> my--nocand-then-fzf nil))))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">ad:fzf:ivy--insert-prompt</span> ()
  (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">and</span> my--nocand-then-fzf
             (memq (ivy-state-caller ivy-last) my-nocand-then-fzf-commands)
             (= ivy--length 0))
    (<span style="color: #a020f0;">let*</span> ((std-props
            '(front-sticky t rear-nonsticky t field t read-only t))
           (prompt (concat (my-pre-prompt-function)
                           <span style="color: #8b2252;">"Switch to Counsel-fzf? [y/n] "</span>)))
      (set-text-properties 0 (length prompt)
                           `(face minibuffer-prompt ,@std-props) prompt)
      (run-with-idle-timer my-nocand-then-fzf-idle-time
                           nil #'my-nocand-then-fzf prompt))))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"counsel"</span>
<span style="color: #b22222;">;;; </span><span style="color: #b22222;">auto fzf, 0&#20214;&#12498;&#12483;&#12488;&#12398;&#26178;&#65292;1&#22238;&#12384;&#12369;[y/n]&#12391; counsel-fzf &#12395;&#32331;&#12368;&#12363;&#21839;&#12358;</span>
  (<span style="color: #a020f0;">defcustom</span> <span style="color: #a0522d;">my-nocand-then-fzf-commands</span> '(counsel-recentf
                                           counsel-projectile-find-file
                                           counsel-projectile-switch-project)
    <span style="color: #8b2252;">"List of commands for applying extension no candidates then `</span><span style="color: #008b8b;">counsel-fzf</span><span style="color: #8b2252;">'."</span>
    <span style="color: #483d8b;">:group</span> 'ivy
    <span style="color: #483d8b;">:type</span> '(list symbol))

  (<span style="color: #a020f0;">defcustom</span> <span style="color: #a0522d;">my-nocand-then-fzf-idle-time</span> 2.0
    <span style="color: #8b2252;">"Idle time for showing prompt."</span>
    <span style="color: #483d8b;">:group</span> 'ivy
    <span style="color: #483d8b;">:type</span> 'float) <span style="color: #b22222;">;; </span><span style="color: #b22222;">N[s] &#28961;&#24540;&#31572;&#12398;&#26178;[y/n]&#12434;&#20986;&#12377;&#65294;</span>

  (<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">my--nocand-then-fzf</span> t)
  (advice-add 'ivy--insert-prompt <span style="color: #483d8b;">:before</span> #'ad:fzf:ivy--insert-prompt)
  (add-hook 'minibuffer-setup-hook #'my-nocand-then-fzf-reset)
  (add-hook 'minibuffer-exit-hook #'my-nocand-then-fzf-reset))
</pre>
</div>
</div>
</div>

<div id="outline-container-org409d5d63" class="outline-3">
<h3 id="org409d5d63"><span class="section-number-3">14.13.</span> [gitter.el] Gitter にログイン</h3>
<div class="outline-text-3" id="text-org409d5d63">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">late-init.el</span>
(autoload-if-found '(gitter) <span style="color: #8b2252;">"gitter"</span>  nil t)
</pre>
</div>
</div>
</div>

<div id="outline-container-org693f8def" class="outline-3">
<h3 id="org693f8def"><span class="section-number-3">14.14.</span> <span class="todo TODO">TODO</span> [elfeed.el] RSSフィードの管理と閲覧</h3>
<div class="outline-text-3" id="text-org693f8def">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(elfeed elfeed-update elfeed-web-start)
                         <span style="color: #8b2252;">"elfeed"</span> nil t)
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"elfeed"</span>
    (<span style="color: #a020f0;">setq</span> elfeed-db-directory <span style="color: #8b2252;">"~/Dropbox/emacs.d/elfeed"</span>)
    (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">elfeed-org</span> nil t)
      (elfeed-org)
      (<span style="color: #a020f0;">setq</span> rmh-elfeed-org-files (list <span style="color: #8b2252;">"~/Dropbox/org/elfeed.org"</span>)))
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#12371;&#12428;&#12391; elfeed-feeds &#12364;&#26356;&#26032;&#12373;&#12428;&#12427;</span>
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#12381;&#12398;&#24460;&#65292;M-x elfeed, M-x elfeed-update &#12377;&#12427;</span>
    (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">elfeed-web</span> nil t)
      (<span style="color: #a020f0;">setq</span> elfeed-web-data-root (concat my-elget-package-dir <span style="color: #8b2252;">"/web"</span>)))))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc75ab540" class="outline-3">
<h3 id="orgc75ab540"><span class="section-number-3">14.15.</span> <span class="todo TODO">TODO</span> [password-store.el] パスワード管理</h3>
<div class="outline-text-3" id="text-orgc75ab540">
<ul class="org-ul">
<li><a href="http://h12.me/article/password-management">http://h12.me/article/password-management</a></li>
<li><a href="http://www.tricksofthetrades.net/2015/07/04/notes-pass-unix-password-manager/">http://www.tricksofthetrades.net/2015/07/04/notes-pass-unix-password-manager/</a></li>
<li>Add no-tty into ~/.gnupg/gpg.conf if an error occurred.</li>
<li>システムで <code>pass</code> コマンドを使えることが条件</li>
<li><a href="https://github.com/ecraven/ivy-pass">ecraven/ivy-pass: ivy interface for pass</a></li>
<li>うまくいかない時は，まず <code>password-store-executable</code> を確認する．もし nil ならば， <code>exec-path</code> を正しく設定する．</li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">if</span> (not (executable-find <span style="color: #8b2252;">"pass"</span>))
    (message <span style="color: #8b2252;">"--- pass is NOT installed."</span>)
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">(global-set-key (kbd "C-c f p") 'helm-pass)</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">(autoload-if-found '(helm-pass) "helm-pass" nil t)</span>
  (global-set-key (kbd <span style="color: #8b2252;">"C-c f p"</span>) 'ivy-pass)
  (autoload-if-found '(ivy-pass) <span style="color: #8b2252;">"ivy-pass"</span> nil t))
</pre>
</div>

<p>
もしくは， <code>id-manager.el</code> もパスワード管理に利用できる．こちらは特定のコマンドがシステムにインストールされていなくても動く．
</p>

<ul class="org-ul">
<li>The encrypted file is stored as ~/.idm-db.gpg.</li>
<li><a href="http://d.hatena.ne.jp/kiwanami/20110221/1298293727">http://d.hatena.ne.jp/kiwanami/20110221/1298293727</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(id-manager)
                         <span style="color: #8b2252;">"id-manager"</span> nil t)
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"id-manager"</span>
    (setenv <span style="color: #8b2252;">"GPG_AGENT_INFO"</span> nil)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org1141e95f" class="outline-3">
<h3 id="org1141e95f"><span class="section-number-3">14.16.</span> <span class="todo TODO">TODO</span> [network-watch.el] ネットワークインターフェイスの状態を監視</h3>
<div class="outline-text-3" id="text-org1141e95f">
<ul class="org-ul">
<li>プロキシ内での挙動は不明．</li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">last-init.efl</span>
(<span style="color: #a020f0;">when</span> (autoload-if-found '(network-watch-mode
                           network-watch-active-p
                           ad:network-watch-update-lighter)
                         <span style="color: #8b2252;">"network-watch"</span> nil t)
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"network-watch"</span>
    (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">ad:network-watch-update-lighter</span> ()
      <span style="color: #8b2252;">"Return a mode lighter reflecting the current network state."</span>
      (<span style="color: #a020f0;">unless</span> (network-watch-active-p) <span style="color: #8b2252;">" NW&#8595;"</span>))
    (advice-add 'network-watch-update-lighter
                <span style="color: #483d8b;">:override</span> #'ad:network-watch-update-lighter))

  (<span style="color: #a020f0;">unless</span> noninteractive
    (<span style="color: #a020f0;">if</span> shutup-p
        (shut-up (network-watch-mode 1))
      (network-watch-mode 1))))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf14fe89c" class="outline-3">
<h3 id="orgf14fe89c"><span class="section-number-3">14.17.</span> <span class="todo TODO">TODO</span> [circe.el] IRCにログインする</h3>
<div class="outline-text-3" id="text-orgf14fe89c">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(circe) <span style="color: #8b2252;">"circe"</span> nil t)
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"cire"</span>
    (<span style="color: #a020f0;">setq</span> circe-network-options
          '((<span style="color: #8b2252;">"Freenode"</span> <span style="color: #483d8b;">:tls</span> t <span style="color: #483d8b;">:nick</span> <span style="color: #8b2252;">"xxxxxx"</span> <span style="color: #483d8b;">:channels</span> (<span style="color: #8b2252;">"#emacsconf"</span>))))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org71c49002" class="outline-3">
<h3 id="org71c49002"><span class="section-number-3">14.18.</span> <span class="done DONE">DONE</span> [lingr.el] チャットルームに自動参加&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></h3>
<div class="outline-text-3" id="text-org71c49002">
<p>
init.el読書会が毎週土曜日の23時に開催されています．作業に集中していると，ついつい忘れてしまうので，その時間が来たら自動的にログインするように設定しています．ユーザ名とパスワードは，セキュリティを考慮して別なファイルに記載しています．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"># late-init.el
(<span style="color: #a020f0;">when</span> (autoload-if-found '(lingr-login my-lingr-login)
                         <span style="color: #8b2252;">"lingr"</span> nil t)
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"lingr"</span>
    (custom-set-variables
     '(lingr-icon-mode t)
     '(lingr-icon-fix-size 24)
     '(lingr-image-convert-program  (<span style="color: #a020f0;">or</span> (executable-find <span style="color: #8b2252;">"convert"</span>)
                                        lingr-image-convert-program))))

  (<span style="color: #a020f0;">when</span> (future-time-p <span style="color: #8b2252;">"23:00"</span>)
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">do not use `</span><span style="color: #008b8b;">run-at-time</span><span style="color: #b22222;">' at booting since diary-lib.el</span>
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">will be loaded. It requires loading cost.</span>
    (run-at-time <span style="color: #8b2252;">"23:00"</span> nil 'my-lingr-login)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org2be833d3" class="outline-3">
<h3 id="org2be833d3"><span class="section-number-3">14.19.</span> <span class="done DONE">DONE</span> [lingr.el] lingr にログインする&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></h3>
<div class="outline-text-3" id="text-org2be833d3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(lingr-login)
                         <span style="color: #8b2252;">"lingr"</span> nil t)
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"lingr"</span>
    (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-lingr-login</span> ()
      (<span style="color: #a020f0;">when</span> (string= <span style="color: #8b2252;">"Sat"</span> (format-time-string <span style="color: #8b2252;">"%a"</span>))
        (lingr-login)))))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb91a9245" class="outline-3">
<h3 id="orgb91a9245"><span class="section-number-3">14.20.</span> ビルド情報をバッファに表示する</h3>
<div class="outline-text-3" id="text-orgb91a9245">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-print-build-info</span> ()
  (<span style="color: #a020f0;">interactive</span>)
  (switch-to-buffer (get-buffer-create <span style="color: #8b2252;">"*Build info*"</span>))
  (<span style="color: #a020f0;">let</span> ((buffer-read-only nil))
    (erase-buffer)
    (insert
     (format <span style="color: #8b2252;">"GNU Emacs %s\nCommit:\t\t%s\nBranch:\t\t%s\nSystem:\t\t%s\nDate:\t\t\t%s\n"</span>
             emacs-version
             (emacs-repository-get-version)
             (<span style="color: #a020f0;">when</span> (version&lt; <span style="color: #8b2252;">"27.0"</span> emacs-version)
               (emacs-repository-get-branch))
             system-configuration
             (format-time-string <span style="color: #8b2252;">"%Y-%m-%d %T (%Z)"</span> emacs-build-time)))
    (insert (format <span style="color: #8b2252;">"Patch:\t\t%s ns-inline.patch\n"</span>
                    (<span style="color: #a020f0;">if</span> (boundp 'mac-ime--cursor-type) <span style="color: #8b2252;">"with"</span> <span style="color: #8b2252;">"without"</span>)))
    (insert
     (format <span style="color: #8b2252;">"Features:\t%s\n"</span> system-configuration-features))
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">(insert</span>
    <span style="color: #b22222;">;;  </span><span style="color: #b22222;">(format "Options:\t%s\n"  system-configuration-options))</span>
    )
  (view-mode))
</pre>
</div>
</div>
</div>
<div id="outline-container-orgf426bdf4" class="outline-3">
<h3 id="orgf426bdf4"><span class="section-number-3">14.21.</span> macOSのバージョン情報と名前を取得する</h3>
<div class="outline-text-3" id="text-orgf426bdf4">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">https://en.wikipedia.org/wiki/Darwin_(operating_system)</span>
<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">macos-name</span> (version)
  <span style="color: #8b2252;">"Return macOS name according to the VERSION number."</span>
  (<span style="color: #a020f0;">if</span> (stringp version)
      (<span style="color: #a020f0;">cond</span> ((version&lt;= <span style="color: #8b2252;">"21.0"</span> version) <span style="color: #8b2252;">"Monterey"</span>)
                  ((version&lt;= <span style="color: #8b2252;">"20.0"</span> version) <span style="color: #8b2252;">"Big Sur"</span>)
                  ((version&lt;= <span style="color: #8b2252;">"19.0"</span> version) <span style="color: #8b2252;">"Catalina"</span>)
                  ((version&lt;= <span style="color: #8b2252;">"18.0"</span> version) <span style="color: #8b2252;">"Mojave"</span>)
                  ((version&lt;= <span style="color: #8b2252;">"17.0"</span> version) <span style="color: #8b2252;">"High Sierra"</span>)
                  ((version&lt;= <span style="color: #8b2252;">"16.0"</span> version) <span style="color: #8b2252;">"Sierra"</span>)
                  ((version&lt;= <span style="color: #8b2252;">"15.0"</span> version) <span style="color: #8b2252;">"El Capitan"</span>)
                  ((version&lt;= <span style="color: #8b2252;">"14.0"</span> version) <span style="color: #8b2252;">"Yosemite"</span>)
                  ((version&lt;= <span style="color: #8b2252;">"13.0"</span> version) <span style="color: #8b2252;">"Mavericks"</span>)
                  ((version&lt;= <span style="color: #8b2252;">"12.0"</span> version) <span style="color: #8b2252;">"Mountain Lion"</span>)
                  ((version&lt;= <span style="color: #8b2252;">"11.0"</span> version) <span style="color: #8b2252;">"Lion"</span>)
                  ((version&lt;= <span style="color: #8b2252;">"10.0"</span> version) <span style="color: #8b2252;">"Snow Leopard"</span>)
                  ((version&lt;= <span style="color: #8b2252;">"9.0"</span> version) <span style="color: #8b2252;">"Leopard"</span>)
                  ((version&lt;= <span style="color: #8b2252;">"8.0"</span> version) <span style="color: #8b2252;">"Tiger"</span>)
                  ((version&lt;= <span style="color: #8b2252;">"7.0"</span> version) <span style="color: #8b2252;">"Panther"</span>)
                  (t <span style="color: #8b2252;">"undefined"</span>))
    nil))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">macos-version</span> ()
  (<span style="color: #a020f0;">let</span> ((macos-type-version (nth 2 (split-string system-configuration <span style="color: #8b2252;">"-"</span>))))
                (string-match <span style="color: #8b2252;">"darwin</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">(</span><span style="color: #8b2252;">.*</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">)</span><span style="color: #8b2252;">"</span> macos-type-version)
                (match-string 1 macos-type-version)))
</pre>
</div>
</div>
</div>
<div id="outline-container-org62365dfa" class="outline-3">
<h3 id="org62365dfa"><span class="section-number-3">14.22.</span> iTerm2.app を呼び出す関数</h3>
<div class="outline-text-3" id="text-org62365dfa">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-cmd-to-open-iterm2</span> (<span style="color: #228b22;">&amp;optional</span> arg)
  (<span style="color: #a020f0;">interactive</span> <span style="color: #8b2252;">"P"</span>)
  (shell-command-to-string
   (concat <span style="color: #8b2252;">"open -a iTerm.app "</span>
           (<span style="color: #a020f0;">when</span> arg default-directory))))
</pre>
</div>
</div>
</div>
<div id="outline-container-org68ed2087" class="outline-3">
<h3 id="org68ed2087"><span class="section-number-3">14.23.</span> サボっていると Kyoko さんに怒られる</h3>
<div class="outline-text-3" id="text-org68ed2087">
<p>
macOS 用の関数です．別途，Kyoko さんの音声をインストールしておく必要があります．Mavericks だと，Otoya さんも使えます．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">my-kyoko-mad-mode</span> nil)
<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-kyoko-mad-mode-toggle</span> ()
  (<span style="color: #a020f0;">interactive</span>)
  (<span style="color: #a020f0;">setq</span> my-kyoko-mad-mode (not my-kyoko-mad-mode))
  (message (concat <span style="color: #8b2252;">"Kyoko mad mode: "</span>
                   (<span style="color: #a020f0;">if</span> my-kyoko-mad-mode <span style="color: #8b2252;">"ON"</span> <span style="color: #8b2252;">"OFF"</span>))))
<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-kyoko-mad</span> ()
  (<span style="color: #a020f0;">interactive</span>)
  (<span style="color: #a020f0;">when</span> my-kyoko-mad-mode
    (shell-command-to-string
     <span style="color: #8b2252;">"say -v Kyoko &#12362;&#12356;&#12362;&#12414;&#12360;&#65292;&#36938;&#12435;&#12391;&#12394;&#12356;&#12391;&#65292;&#20181;&#20107;&#12375;&#12429;"</span>)))

<span style="color: #b22222;">;; </span><span style="color: #b22222;">She will be mad if you do nothing within 10 min.</span>
(run-with-idle-timer 600 t 'my-kyoko-mad)
</pre>
</div>
</div>
</div>
<div id="outline-container-orgbf8ddfed" class="outline-3">
<h3 id="orgbf8ddfed"><span class="section-number-3">14.24.</span> コンソールでカレントバッファのあるディレクトリに移動する</h3>
<div class="outline-text-3" id="text-orgbf8ddfed">
<p>
Finder で開きたいだけならば， <code>M-!</code> でミニバッファに <code>open .</code> と打ち込むだけです．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">defcustom</span> <span style="color: #a0522d;">open-current-directory-console-program</span> <span style="color: #8b2252;">"iTerm2.app"</span>
  <span style="color: #8b2252;">"Specify a console program"</span>
  <span style="color: #483d8b;">:type</span> 'string
  <span style="color: #483d8b;">:group</span> 'takaxp-mac)

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-open-current-directory-in-terminal</span> ()
  <span style="color: #8b2252;">" Open Current Directory for macOS</span>
<span style="color: #8b2252;">  0) Put this function in your .emacs</span>
<span style="color: #8b2252;">  1) M-x open-current-directory</span>
<span style="color: #8b2252;">  2) Terminal will open automatically</span>
<span style="color: #8b2252;">  3) Type M-v to paste and move to a path to the current directory in Emacs"</span>
  (<span style="color: #a020f0;">interactive</span>)
  (<span style="color: #a020f0;">let</span> ((file-path (buffer-file-name (current-buffer))))
    (<span style="color: #a020f0;">unless</span> (string= file-path nil)
      (<span style="color: #a020f0;">let</span> ((directory
             (substring file-path 0
                        (-
                         (length file-path)
                         (length (buffer-name (current-buffer)))))))
        (message <span style="color: #8b2252;">"%s"</span> directory)
        (shell-command-to-string (concat <span style="color: #8b2252;">"echo cd "</span> directory <span style="color: #8b2252;">" |pbcopy"</span>))
        (shell-command-to-string
         (concat <span style="color: #8b2252;">"open -a "</span> open-current-directory-console-program))))))
</pre>
</div>
</div>
</div>
<div id="outline-container-orgb8c148ec" class="outline-3">
<h3 id="orgb8c148ec"><span class="section-number-3">14.25.</span> ファイルに含まれるテーブルを使って定時にアラートを表示する</h3>
<div class="outline-text-3" id="text-orgb8c148ec">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-update-alarms-from-file</span> ()
  (<span style="color: #a020f0;">interactive</span>)
  (<span style="color: #a020f0;">let</span> ((bname (buffer-name)))
    (<span style="color: #a020f0;">when</span> (string= bname <span style="color: #8b2252;">"daily.org"</span>)
      (my-set-alarms-from-file (concat <span style="color: #8b2252;">"~/Dropbox/org/db/"</span> bname)))))

(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-set-alarms-from-file</span> (file)
  <span style="color: #8b2252;">"Make alarms from org-mode tables. If you have an org-mode file</span>
<span style="color: #8b2252;">     with tables with the following format:</span>
<span style="color: #8b2252;">     |------+-------+--------------------|</span>
<span style="color: #8b2252;">     | Flag |  Time | Content            |</span>
<span style="color: #8b2252;">     |------+-------+--------------------|</span>
<span style="color: #8b2252;">     |      | 07:00 | Wakeup             |</span>
<span style="color: #8b2252;">     |      |       | Read papers        |</span>
<span style="color: #8b2252;">     | X    | 12:00 | Clean up your desk |</span>
<span style="color: #8b2252;">     When it is 7:00 and 12:00, Growl notify with a message which is specified</span>
<span style="color: #8b2252;">     content column from the table. \"Read papers\" will be ignored.</span>
<span style="color: #8b2252;">     \"Clean up your desk\" will be shown by sticky mode"</span>
  (<span style="color: #a020f0;">let</span>
      ((lines (read-line file)))
    (cancel-function-timers 'my-desktop-notify) <span style="color: #b22222;">;; </span><span style="color: #b22222;">clear existing timers</span>
    (<span style="color: #a020f0;">while</span> lines
      (my--set-alarm-from-line (decode-coding-string (car lines) 'utf-8))
      (<span style="color: #a020f0;">setq</span> lines (cdr lines)))))

(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my--set-alarm-from-line</span> (line)
  (<span style="color: #a020f0;">let</span>
      ((hour nil)
       (min nil)
       (current-hour nil)
       (current-min nil)
       (action nil))
    (<span style="color: #a020f0;">when</span> (string-match <span style="color: #8b2252;">"</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">(</span><span style="color: #8b2252;">[0-2]?[0-9]</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">)</span><span style="color: #8b2252;">:</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">(</span><span style="color: #8b2252;">[0-5][0-9]</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">)</span><span style="color: #8b2252;">"</span> line)
      (<span style="color: #a020f0;">setq</span> hour (substring line (match-beginning 1) (match-end 1)))
      (<span style="color: #a020f0;">setq</span> min (substring line (match-beginning 2) (match-end 2)))
      (<span style="color: #a020f0;">when</span> (string-match
             <span style="color: #8b2252;">"</span><span style="color: #ff0000; font-weight: bold;">\</span><span style="color: #8b2252;">|\\s-*</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">(</span><span style="color: #8b2252;">[</span><span style="color: #8b2252;">^</span><span style="color: #ff0000; font-weight: bold;">\</span><span style="color: #8b2252;">|]+[</span><span style="color: #8b2252;">^</span><span style="color: #8b2252;"> ]</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">)</span><span style="color: #8b2252;">\\s-*</span><span style="color: #ff0000; font-weight: bold;">\</span><span style="color: #8b2252;">|"</span> line (match-end 2))
        (<span style="color: #a020f0;">setq</span> action
              (substring line (match-beginning 1) (match-end 1)))))
    (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">and</span> (<span style="color: #a020f0;">and</span> hour min) action)
      <span style="color: #b22222;">;;        </span><span style="color: #b22222;">(message "[%s:%s] =&gt; %s" hour min action)</span>
      (<span style="color: #a020f0;">setq</span> current-hour (format-time-string <span style="color: #8b2252;">"%H"</span> (current-time)))
      (<span style="color: #a020f0;">setq</span> current-min (format-time-string <span style="color: #8b2252;">"%M"</span> (current-time)))
      (<span style="color: #a020f0;">when</span> (&gt; (+ (* (string-to-number hour) 60)
                  (string-to-number min))
               (+ (* (string-to-number current-hour) 60)
                  (string-to-number current-min)))
        (<span style="color: #a020f0;">let</span> ((s nil))
          (<span style="color: #a020f0;">when</span> (string-match <span style="color: #8b2252;">"^</span><span style="color: #ff0000; font-weight: bold;">\</span><span style="color: #8b2252;">|\\s-*X\\s-*</span><span style="color: #ff0000; font-weight: bold;">\</span><span style="color: #8b2252;">|"</span> line)
            (<span style="color: #a020f0;">setq</span> s 'sticky))
          (my--set-notify-macos hour min action s))))))

(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my--set-notify-macos</span> (hour min action sticky)
  <span style="color: #8b2252;">"`</span><span style="color: #008b8b;">alerter</span><span style="color: #8b2252;">' is required."</span>
  (run-at-time (format <span style="color: #8b2252;">"%s:%s"</span> hour min) nil
               'my-desktop-notify
               <span style="color: #8b2252;">"macos"</span> <span style="color: #8b2252;">"Org Mode"</span> hour min action sticky))

(<span style="color: #a020f0;">declare-function</span> my-desktop-notification <span style="color: #8b2252;">"init-org"</span>)

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-desktop-notify</span> (type title hour min action sticky)
  <span style="color: #8b2252;">"An interface to `</span><span style="color: #008b8b;">my-desktop-notification</span><span style="color: #8b2252;">'."</span>
  (<span style="color: #a020f0;">cond</span>
   ((string= type <span style="color: #8b2252;">"macos"</span>)
    (my-desktop-notification
     title (format <span style="color: #8b2252;">"%s:%s %s"</span> hour min action) sticky))))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">read-line</span> (file)
  <span style="color: #8b2252;">"Make a list from a file, which is divided by LF code"</span>
  (<span style="color: #a020f0;">with-temp-buffer</span>
    (insert-file-contents-literally file)
    (split-string
     (buffer-string) <span style="color: #8b2252;">"\n"</span> t)))
</pre>
</div>
</div>
</div>
<div id="outline-container-org33d4f93d" class="outline-3">
<h3 id="org33d4f93d"><span class="section-number-3">14.26.</span> 頻繁に利用するファイルをring形式でたどる</h3>
<div class="outline-text-3" id="text-org33d4f93d">
<p>
<a href="http://d.hatena.ne.jp/rubikitch/20111120/elispbook">http://d.hatena.ne.jp/rubikitch/20111120/elispbook</a>
</p>

<ul class="org-ul">
<li>helm-recentf や counsel-recentf を使うようになり，リングを辿るよりも絞り検索で見つける方が早く感じられるようになりました．そのため使わなくなりました．</li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">my-file-ring</span> nil)

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-make-file-ring</span> (files)
  (<span style="color: #a020f0;">setq</span> my-file-ring (copy-sequence files)))
<span style="color: #b22222;">;;    </span><span style="color: #b22222;">(setf (cdr (last my-file-ring)) my-file-ring))</span>
(my-make-file-ring
 '(<span style="color: #8b2252;">"~/Dropbox/org/tr/work.org"</span> <span style="color: #8b2252;">"~/Dropbox/org/db/daily.org"</span>
   <span style="color: #8b2252;">"~/Dropbox/org/minutes/wg1.org"</span> <span style="color: #8b2252;">"~/Dropbox/org/tr/work.org"</span>
   <span style="color: #8b2252;">"~/Dropbox/org/academic.org"</span> <span style="color: #8b2252;">"~/Dropbox/org/org2ja.org"</span>
   <span style="color: #8b2252;">"~/Dropbox/org/db/article.org"</span> <span style="color: #8b2252;">"~/Dropbox/emacs.d/config/init.org"</span>))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-open-file-ring</span> ()
  (<span style="color: #a020f0;">interactive</span>)
  (find-file (car my-file-ring))
  (<span style="color: #a020f0;">setq</span> my-file-ring
        (append (cdr my-file-ring)
                (list (car my-file-ring)))))

<span style="color: #b22222;">;;    </span><span style="color: #b22222;">(setq my-file-ring (cdr my-file-ring)))</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org31226d9e" class="outline-3">
<h3 id="org31226d9e"><span class="section-number-3">14.27.</span> 引数のorgバッファを開く</h3>
<div class="outline-text-3" id="text-org31226d9e">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-show-org-buffer</span> (file)
  <span style="color: #8b2252;">"Show an org-file on the current buffer."</span>
  (<span style="color: #a020f0;">interactive</span>)
  (<span style="color: #a020f0;">let</span> ((tbuffer (get-buffer file))
        (cbuffer (current-buffer))
        (orgfile (concat (getenv <span style="color: #8b2252;">"SYNCROOT"</span>) <span style="color: #8b2252;">"/org/"</span> file))
        (afile (expand-file-name file))
        (message-log-max nil))
    (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">and</span> (fboundp 'my-org-agenda-to-appt)
               (not (eq cbuffer tbuffer)))
      (my-org-agenda-to-appt 'force))
    (<span style="color: #a020f0;">if</span> (<span style="color: #a020f0;">cond</span> (tbuffer (switch-to-buffer tbuffer))
              ((file-exists-p orgfile) (find-file orgfile))
              ((file-exists-p afile) (find-file afile)))
        (message <span style="color: #8b2252;">"%s"</span> file)
      (message <span style="color: #8b2252;">"No buffer or file is shown."</span>))))
</pre>
</div>
</div>
</div>
<div id="outline-container-org6a1e418a" class="outline-3">
<h3 id="org6a1e418a"><span class="section-number-3">14.28.</span> orgバッファにいつものヘッダを追加する</h3>
<div class="outline-text-3" id="text-org6a1e418a">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">declare-function</span> org-end-of-line <span style="color: #8b2252;">"org"</span>)

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">insert-org-file-header-template</span> ()
  (<span style="color: #a020f0;">interactive</span>)
  (<span style="color: #a020f0;">when</span> (string= major-mode 'org-mode)
    (<span style="color: #a020f0;">let</span> ((title <span style="color: #8b2252;">"#+title:\t\n"</span>)
          (date <span style="color: #8b2252;">"#+date: \t\n"</span>)
          (author <span style="color: #8b2252;">"#+author:\tTakaaki ISHIKAWA <a href="mailto:takaxp%40ieee.org">&lt;takaxp@ieee.org&gt;</a>\n"</span>)
          (option <span style="color: #8b2252;">"#+options:\t\\n:t\n"</span>)
          (other <span style="color: #8b2252;">"\n"</span>))
      (goto-char 0)
      (<span style="color: #a020f0;">save-excursion</span>
        (insert title date author option other))
      (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">org</span> nil t)
        (org-end-of-line)))))
</pre>
</div>
</div>
</div>
<div id="outline-container-org50dc6656" class="outline-3">
<h3 id="org50dc6656"><span class="section-number-3">14.29.</span> orgバッファにPGPヘッダとフッタを書き込む</h3>
<div class="outline-text-3" id="text-org50dc6656">
<p>
PGP MESSAGEで囲われる部分にBASE64化されたコードを書き込んで <code>org-decrypt-entry</code> するための空ツリーを書き込みます．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-insert-empty-pgp-tree</span> ()
  (<span style="color: #a020f0;">interactive</span>)
  (insert <span style="color: #8b2252;">"** TODO hoge\n"</span>)
  (insert <span style="color: #8b2252;">"-----BEGIN PGP MESSAGE-----\n\n-----END PGP MESSAGE-----\n"</span>)
  (forward-line -2))
</pre>
</div>
</div>
</div>
<div id="outline-container-orgf2d1ba3d" class="outline-3">
<h3 id="orgf2d1ba3d"><span class="section-number-3">14.30.</span> orgバッファでPGPを使った自分宛ての暗号化データ生成する</h3>
<div class="outline-text-3" id="text-orgf2d1ba3d">
<p>
下記の関数で生成したツリーの本体をメールで送信すれば，秘密鍵のある端末で復号できます．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-insert-enc2me-pgp-tree</span> ()
  (<span style="color: #a020f0;">interactive</span>)
  (insert <span style="color: #8b2252;">"** TODO share with me\n"</span>)
  (insert <span style="color: #8b2252;">"   :PROPERTIES:\n"</span>)
  (insert <span style="color: #8b2252;">"   :CRYPTKEY: takaxp@ieee.org\n"</span>)
  (insert <span style="color: #8b2252;">"   :END:\n"</span>)
  (insert <span style="color: #8b2252;">"\n"</span>)
  (forward-line -1))
</pre>
</div>
</div>
</div>
<div id="outline-container-org8f57b3f8" class="outline-3">
<h3 id="org8f57b3f8"><span class="section-number-3">14.31.</span> 議事録ひな形を書き入れる</h3>
<div class="outline-text-3" id="text-org8f57b3f8">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">insert-minutes-template</span> ()
  (<span style="color: #a020f0;">interactive</span>)
  (<span style="color: #a020f0;">when</span> (string= major-mode 'org-mode)
    (<span style="color: #a020f0;">let</span> ((date <span style="color: #8b2252;">"&#26085;&#26178;&#65306;\n"</span>)
          (place <span style="color: #8b2252;">"&#22580;&#25152;&#65306;\n"</span>)
          (attendance <span style="color: #8b2252;">"&#20986;&#24109;&#32773;&#65306;\n"</span>)
          (documents <span style="color: #8b2252;">"&#36039;&#26009;&#65306;\n\n"</span>))
      (<span style="color: #a020f0;">save-excursion</span>
        (insert date place attendance documents)))))
</pre>
</div>
</div>
</div>
<div id="outline-container-orgdd9630ad" class="outline-3">
<h3 id="orgdd9630ad"><span class="section-number-3">14.32.</span> ランダムの文字列を取得する</h3>
<div class="outline-text-3" id="text-orgdd9630ad">
<p>
引数で桁数を渡すと，ランダムな数値の文字列を取得できます．org-mode で適当なタイトルのツリーを生成したい時に使っています．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-get-random-string</span> (length)
  <span style="color: #8b2252;">"Get a string contain the length digit number with random selection"</span>
  (<span style="color: #a020f0;">interactive</span>)
  (random t)
  (<span style="color: #a020f0;">cond</span> ((&gt; length 0)
         (<span style="color: #a020f0;">let</span>
             ((count length)
              (string nil)
              (tmp nil))
           (<span style="color: #a020f0;">while</span> (&lt; 0 count)
             (<span style="color: #a020f0;">setq</span> count (1- count))
             (<span style="color: #a020f0;">setq</span> tmp string)
             (<span style="color: #a020f0;">setq</span> string
                   (concat tmp (number-to-string (random 10)))))
           (message <span style="color: #8b2252;">"%s"</span> string)))
        (t <span style="color: #8b2252;">"0"</span>)))
</pre>
</div>
</div>
</div>
<div id="outline-container-org3697f6bd" class="outline-3">
<h3 id="org3697f6bd"><span class="section-number-3">14.33.</span> 行頭に" - "を挿入する&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notinuse">notinuse</span></span></h3>
<div class="outline-text-3" id="text-org3697f6bd">
<p>
<code>my-cycle-bullet-at-heading</code> に移行しました．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-add-itemize-head</span> (arg)
  <span style="color: #8b2252;">"Insert \"- \" at the head of line.</span>
<span style="color: #8b2252;">  If the cursor is already at the head of line, it is NOT returned back to the</span>
<span style="color: #8b2252;">  original position again. Otherwise, the cursor is moved to the right of the</span>
<span style="color: #8b2252;">  inserted string. \"- [ ] \" will be inserted using C-u prefix."</span>
  (<span style="color: #a020f0;">interactive</span> <span style="color: #8b2252;">"P"</span>)
  (<span style="color: #a020f0;">let</span> ((item-string <span style="color: #8b2252;">"- "</span>))
    (<span style="color: #a020f0;">when</span> arg
      (<span style="color: #a020f0;">setq</span> item-string <span style="color: #8b2252;">"- [ ] "</span>))
    (<span style="color: #a020f0;">cond</span> ((= (point) (line-beginning-position))
           (insert item-string))
          (t (<span style="color: #a020f0;">save-excursion</span>
               (move-beginning-of-line 1)
               (insert item-string))))))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-add-itemize-head-checkbox</span> ()
  <span style="color: #8b2252;">"Insert \"- [ ] \" at the head of line.</span>
<span style="color: #8b2252;">  If the cursor is already at the head of line, it is NOT returned back to the</span>
<span style="color: #8b2252;">  original position again. Otherwise, the cursor is moved to the right of the</span>
<span style="color: #8b2252;">  inserted string."</span>
  (<span style="color: #a020f0;">interactive</span>)
  (<span style="color: #a020f0;">let</span> ((item-string <span style="color: #8b2252;">"- [ ] "</span>))
    (<span style="color: #a020f0;">cond</span> ((= (point) (line-beginning-position))
           (insert item-string))
          (t (<span style="color: #a020f0;">save-excursion</span>
               (move-beginning-of-line 1)
               (insert item-string))))))
</pre>
</div>
</div>
</div>
<div id="outline-container-org9aef972b" class="outline-3">
<h3 id="org9aef972b"><span class="section-number-3">14.34.</span> 定期実行関数</h3>
<div class="outline-text-3" id="text-org9aef972b">
<p>
orgバッファからカレンダーを生成し，外部サーバに投げます．また，MobileOrgに最新情報を流しています．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">ox-icalendar-activate</span> nil)

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-ox-icalendar-activate</span> ()
  (<span style="color: #a020f0;">setq</span> ox-icalendar-activate (frame-focus-state)))
(<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"org"</span>
  (<span style="color: #a020f0;">when</span> (eq system-type 'ns)
    (run-with-idle-timer 180 t 'my-reload-ical-export)
    <span style="color: #b22222;">;;    </span><span style="color: #b22222;">(run-with-idle-timer 1000 t 'org-mobile-push)</span>
    (<span style="color: #a020f0;">add-function</span> <span style="color: #483d8b;">:after</span> after-focus-change-function
                  #'my-ox-icalendar-activate)))

(<span style="color: #a020f0;">declare-function</span> my-ox-upload-icalendar <span style="color: #8b2252;">"init.org"</span>)
<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-reload-ical-export</span> ()
  <span style="color: #8b2252;">"Export org files as an iCal format file"</span>
  (<span style="color: #a020f0;">interactive</span>)
  (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">and</span> (string= major-mode 'org-mode)
             ox-icalendar-activate)
    (my-ox-upload-icalendar)))
</pre>
</div>
</div>
</div>
<div id="outline-container-org175a102f" class="outline-3">
<h3 id="org175a102f"><span class="section-number-3">14.35.</span> ブラウザの設定</h3>
<div class="outline-text-3" id="text-org175a102f">
<ul class="org-ul">
<li><a href="http://stackoverflow.com/questions/4506249/how-to-make-emacs-org-mode-open-links-to-sites-in-google-chrome">http://stackoverflow.com/questions/4506249/how-to-make-emacs-org-mode-open-links-to-sites-in-google-chrome</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (autoload-if-found '(browse-url)
                         <span style="color: #8b2252;">"browse-url"</span> nil t)
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"browse-url"</span>
    (<span style="color: #a020f0;">cond</span>
     ((eq window-system 'ns)
      (custom-set-variables
       '(browse-url-generic-program 'google-chrome)))
     ((eq window-system 'mac)
      (custom-set-variables
       '(browse-url-browser-function 'browse-url-generic)
       '(browse-url-generic-program
         <span style="color: #8b2252;">"/Applications/Google Chrome.app/Contents/MacOS/Google Chrome"</span>)
       ))
     (t
      nil))))
<span style="color: #b22222;">;;</span><span style="color: #b22222;">(setq browse-url-browser-function 'browse-url-default-macosx-browser)</span>
<span style="color: #b22222;">;;</span><span style="color: #b22222;">(setq browse-url-browser-function 'browse-url-default-windows-browser)</span>
<span style="color: #b22222;">;;</span><span style="color: #b22222;">(setq browse-url-browser-function 'browse-url-chrome)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orgca3eae6b" class="outline-3">
<h3 id="orgca3eae6b"><span class="section-number-3">14.36.</span> バックアップファイルの削除</h3>
<div class="outline-text-3" id="text-orgca3eae6b">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">find ~/.emacs.d/backup  -type f -name '</span><span style="color: #008b8b;">*15-04-24_*</span><span style="color: #b22222;">' -print0 | while read -r -d '' file; do echo -n " \"$file\""; done | xargs -0</span>

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">recursive-delete-backup-files</span> (days)
  (<span style="color: #a020f0;">if</span> (= days 1)
      1
    (recursive-delete-backup-files (1- days)))
  (delete-backup-files days))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">delete-backup-files</span> (<span style="color: #228b22;">&amp;optional</span> day-shift)
  <span style="color: #8b2252;">"Delete backup files created in yesterday.</span>
<span style="color: #8b2252;">  &gt; find ~/.emacs.d/backup -type f -name '</span><span style="color: #008b8b;">*YY-MM-DD_*</span><span style="color: #8b2252;">' -print0 | xargs -0"</span>
  (<span style="color: #a020f0;">interactive</span>)
  (<span style="color: #a020f0;">unless</span> day-shift
    (<span style="color: #a020f0;">setq</span> day-shift 1))
  (<span style="color: #a020f0;">let*</span> ((backup-dir <span style="color: #8b2252;">"~/.emacs.d/backup"</span>)
         (cmd (concat <span style="color: #8b2252;">"find "</span> backup-dir <span style="color: #8b2252;">"  -type f -name </span><span style="color: #ff0000; font-weight: bold;">\</span><span style="color: #8b2252;">'*"</span>
                      (format-time-string
                       <span style="color: #8b2252;">"%y-%m-%d_"</span>
                       (time-subtract (current-time)
                                      (seconds-to-time
                                       (* day-shift (* 24 3600)))))
                      <span style="color: #8b2252;">"*</span><span style="color: #ff0000; font-weight: bold;">\</span><span style="color: #8b2252;">' -print0 | while read -r -d </span><span style="color: #ff0000; font-weight: bold;">\</span><span style="color: #8b2252;">'</span><span style="color: #ff0000; font-weight: bold;">\</span><span style="color: #8b2252;">' file; "</span>
                      <span style="color: #8b2252;">" do echo -n \" \\\"$file\\\"\"; done | xargs -0"</span>))
         (files (shell-command-to-string cmd)))
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">(message "%s" cmd)</span>
    (<span style="color: #a020f0;">unless</span> (string= (chomp files) <span style="color: #8b2252;">""</span>)
      (message <span style="color: #8b2252;">"%s"</span> (chomp files))
      (<span style="color: #a020f0;">let</span> ((trash (<span style="color: #a020f0;">if</span> (eq system-type 'darwin)
                       <span style="color: #8b2252;">" ~/.Trash"</span> <span style="color: #8b2252;">"~/.local/share/Trash"</span>)))
        (shell-command-to-string (concat <span style="color: #8b2252;">"mv -v "</span> (chomp files) trash))))))
</pre>
</div>
</div>
</div>
<div id="outline-container-org65219005" class="outline-3">
<h3 id="org65219005"><span class="section-number-3">14.37.</span> chomp</h3>
<div class="outline-text-3" id="text-org65219005">
<p>
改行コードを削除した文字列を返す．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">chomp</span> (str)
  <span style="color: #8b2252;">"Chomp leading and tailing whitespace from STR."</span>
  (<span style="color: #a020f0;">while</span> (string-match <span style="color: #8b2252;">"\\`</span><span style="color: #008b8b;">\n+</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">|</span><span style="color: #008b8b;">^\\s-+</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">|</span><span style="color: #008b8b;">\\s-+$</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">|</span><span style="color: #008b8b;">\n+\\</span><span style="color: #8b2252;">'"</span>
                       str)
    (<span style="color: #a020f0;">setq</span> str (replace-match <span style="color: #8b2252;">""</span> t t str)))
  str)
</pre>
</div>
</div>
</div>

<div id="outline-container-org9731a19e" class="outline-3">
<h3 id="org9731a19e"><span class="section-number-3">14.38.</span> 特定のファイルを Dropbox 以下にバックアップする</h3>
<div class="outline-text-3" id="text-org9731a19e">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-backup</span> (files <span style="color: #228b22;">&amp;optional</span> dropbox)
  <span style="color: #8b2252;">"Backup a file to `</span><span style="color: #008b8b;">Dropbox/backup</span><span style="color: #8b2252;">' directory.</span>
<span style="color: #8b2252;">If `</span><span style="color: #008b8b;">dropbox</span><span style="color: #8b2252;">' option is provided then the value is uased as a root directory."</span>
  (<span style="color: #a020f0;">interactive</span> <span style="color: #8b2252;">"P"</span>)
  (<span style="color: #a020f0;">let</span> ((dir (concat (expand-file-name (<span style="color: #a020f0;">or</span> dropbox (getenv <span style="color: #8b2252;">"SYNCROOT"</span>))) <span style="color: #8b2252;">"/backup/"</span> (system-name))))
    (<span style="color: #a020f0;">if</span> (file-directory-p dir)
        (mapc
         (<span style="color: #a020f0;">lambda</span> (file)
           (<span style="color: #a020f0;">if</span> (<span style="color: #a020f0;">and</span> (stringp file)
                    (file-readable-p (<span style="color: #a020f0;">or</span> file (expand-file-name file))))
               (shell-command-to-string
                (concat <span style="color: #8b2252;">"cp -f "</span> file <span style="color: #8b2252;">" "</span> dir <span style="color: #8b2252;">"/"</span>))
             (<span style="color: #ff0000; font-weight: bold;">warn</span> (format <span style="color: #8b2252;">"--- backup failure: %s"</span> file))))
         (<span style="color: #a020f0;">if</span> (listp files)
             files
           (list files)))
      (<span style="color: #ff0000; font-weight: bold;">user-error</span> (format <span style="color: #8b2252;">"--- backup-dir does not exist: %s"</span> dir)))))
</pre>
</div>
</div>
</div>
<div id="outline-container-orgdfad16ba" class="outline-3">
<h3 id="orgdfad16ba"><span class="section-number-3">14.39.</span> ゴミ箱を空にする&#xa0;&#xa0;&#xa0;<span class="tag"><span class="macOS">macOS</span></span></h3>
<div class="outline-text-3" id="text-orgdfad16ba">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">mac:delete-files-in-trash-bin</span> ()
  (<span style="color: #a020f0;">interactive</span>)
  (do-applescript
   (concat
    <span style="color: #8b2252;">"tell application \"Finder\"\n"</span>
    <span style="color: #8b2252;">"set itemCount to count of items in the trash\n"</span>
    <span style="color: #8b2252;">"if itemCount &gt; 0 then\n"</span>
    <span style="color: #8b2252;">"empty the trash\n"</span>
    <span style="color: #8b2252;">"end if\n"</span>
    <span style="color: #8b2252;">"end tell\n"</span>))
  (my-desktop-notification <span style="color: #8b2252;">"Emacs"</span> <span style="color: #8b2252;">"Empty the trash, done."</span>))
</pre>
</div>
</div>
</div>
<div id="outline-container-org4842582b" class="outline-3">
<h3 id="org4842582b"><span class="section-number-3">14.40.</span> 終了シーケンスのデバッグ用関数</h3>
<div class="outline-text-3" id="text-org4842582b">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-kill-emacs</span> ()
    (switch-to-buffer <span style="color: #8b2252;">"*Messages*"</span>)
    (message <span style="color: #8b2252;">"3: %s"</span> kill-emacs-hook)
    (y-or-n-p <span style="color: #8b2252;">"Sure? "</span>))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-kill-emacs-hook-show</span> ()
  <span style="color: #8b2252;">"Test Emacs killing sequence."</span>
  (add-hook 'after-init-hook
            (<span style="color: #a020f0;">lambda</span> () (message <span style="color: #8b2252;">"1: %s"</span> kill-emacs-hook)) t)
  (<span style="color: #a020f0;">with-eval-after-load</span> <span style="color: #8b2252;">"postpone"</span>
    (message <span style="color: #8b2252;">"2: %s"</span> kill-emacs-hook))
  (add-hook 'kill-emacs-hook #'my-kill-emacs))
</pre>
</div>
</div>
</div>
<div id="outline-container-orgeb3d01a8" class="outline-3">
<h3 id="orgeb3d01a8"><span class="section-number-3">14.41.</span> modeline の高さを得る</h3>
<div class="outline-text-3" id="text-orgeb3d01a8">
<p>
ピクセル単位で取得できる．
</p>

<ul class="org-ul">
<li><a href="https://stackoverflow.com/questions/9613026/how-to-get-the-height-of-the-emacs-mode-line">fonts - How to get the height of the emacs mode line? - Stack Overflow</a></li>
</ul>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(- (elt (window-pixel-edges) 3)
   (elt (window-inside-pixel-edges) 3))
</pre>
</div>
</div>
</div>
<div id="outline-container-org4043fe35" class="outline-3">
<h3 id="org4043fe35"><span class="section-number-3">14.42.</span> [package.el] MELPA利用設定</h3>
<div class="outline-text-3" id="text-org4043fe35">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-setup-package-el</span> ()
  <span style="color: #8b2252;">"Setting up for installing packages via built-in package.el.</span>
<span style="color: #8b2252;">Downloaded packages will be stored under ~/.eamcs.d/elpa."</span>
  (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">and</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">package</span> nil t)
             (boundp 'package-archives))
    (<span style="color: #a020f0;">let*</span> ((no-ssl (<span style="color: #a020f0;">and</span> (memq system-type '(windows-nt ms-dos))
                        (not (gnutls-available-p))))
           (proto (<span style="color: #a020f0;">if</span> no-ssl <span style="color: #8b2252;">"http"</span> <span style="color: #8b2252;">"https"</span>)))
      (add-to-list 'package-archives
                   (cons <span style="color: #8b2252;">"melpa"</span> (concat proto <span style="color: #8b2252;">"://melpa.org/packages/"</span>)) t)
      (add-to-list 'package-archives
                   (cons <span style="color: #8b2252;">"takaxp"</span> <span style="color: #8b2252;">"~/devel/git/melpa/packages/"</span>) t))
    (package-initialize)))
</pre>
</div>
</div>
</div>
<div id="outline-container-orgfd51fa6e" class="outline-3">
<h3 id="orgfd51fa6e"><span class="section-number-3">14.43.</span> orgバッファを評価</h3>
<div class="outline-text-3" id="text-orgfd51fa6e">
<p>
org-buffer を評価して Emacs の設定ファイルを生成／読み込みまでを自動化します．この設定では， <code>init.org</code> と <code>utility.org</code> の2つのバッファでのみ評価されるようになっています．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">declare-function</span> org-babel-tangle <span style="color: #8b2252;">"org-babel"</span>)

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-eval-org-buffer</span> ()
  <span style="color: #8b2252;">"Load init.org/utility.org and tangle init.el/utility.el."</span>
  (<span style="color: #a020f0;">interactive</span>)
  (<span style="color: #a020f0;">if</span> (<span style="color: #a020f0;">and</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">org</span> nil t)
           (eq major-mode 'org-mode)
           (member (buffer-name) '(<span style="color: #8b2252;">"init.org"</span> <span style="color: #8b2252;">"utility.org"</span>)))
      (<span style="color: #a020f0;">progn</span>
        (org-babel-tangle)
        (<span style="color: #a020f0;">let</span> ((tangled-file
               (concat (file-name-sans-extension (buffer-file-name)) <span style="color: #8b2252;">".el"</span>)))
          (<span style="color: #a020f0;">when</span> (file-exists-p tangled-file)
            (byte-compile-file tangled-file))))
    (message <span style="color: #8b2252;">"Nothing to do for this buffer."</span>)))
</pre>
</div>
</div>
</div>
<div id="outline-container-orga706f503" class="outline-3">
<h3 id="orga706f503"><span class="section-number-3">14.44.</span> リージョン内のブリッツを操作する(orgmode)</h3>
<div class="outline-text-3" id="text-orga706f503">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">my-org-bullet-re</span>
  <span style="color: #8b2252;">"</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">(</span><span style="color: #8b2252;">^[ \t]*[-\\+\\*][ \t]</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">|</span><span style="color: #8b2252;">^[ \t]*[a-z0-9A-Z]*[\\.)][ \t]</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">)</span><span style="color: #8b2252;">"</span>)

(<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">my-org-bullet-with-checkbox-re</span>
  (concat my-org-bullet-re <span style="color: #8b2252;">"\\[</span><span style="color: #008b8b;">.\\</span><span style="color: #8b2252;">][ \t]+"</span>))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-org-insert-bullet</span> (begin end)
  (<span style="color: #a020f0;">interactive</span> <span style="color: #8b2252;">"r"</span>)
  (<span style="color: #a020f0;">unless</span> mark-active
    (<span style="color: #a020f0;">setq</span> begin (line-beginning-position))
    (<span style="color: #a020f0;">setq</span> end (line-end-position)))
  (<span style="color: #a020f0;">let*</span> ((bullet <span style="color: #8b2252;">"- "</span>)
         (len (string-width bullet)))
    (goto-char begin)
    (<span style="color: #a020f0;">while</span> (<span style="color: #a020f0;">and</span> (re-search-forward (concat <span style="color: #8b2252;">"</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">(</span><span style="color: #8b2252;">^[ \t]*</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">)</span><span style="color: #8b2252;">"</span>) end t)
                (not (looking-at <span style="color: #8b2252;">"[-\\+\\*][ \t]</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">|</span><span style="color: #8b2252;">[a-z0-9A-Z]*[\\.)][ \t]"</span>))
                (not (equal (point) end)))
      (replace-match (concat <span style="color: #8b2252;">"\\1"</span> bullet) nil nil)
      (<span style="color: #a020f0;">setq</span> end (+ end len)))
    (goto-char begin)))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-org-delete-bullet</span> (begin end)
  (<span style="color: #a020f0;">interactive</span> <span style="color: #8b2252;">"r"</span>)
  (<span style="color: #a020f0;">unless</span> mark-active
    (<span style="color: #a020f0;">setq</span> begin (line-beginning-position))
    (<span style="color: #a020f0;">setq</span> end (line-end-position)))
  (goto-char begin)
  (<span style="color: #a020f0;">while</span> (<span style="color: #a020f0;">and</span> (re-search-forward
               <span style="color: #8b2252;">"^[ \t]*</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">(</span><span style="color: #8b2252;">[-\\+\\*][ \t]</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">|</span><span style="color: #8b2252;">[a-z0-9A-Z]*[\\.)][ \t]</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">)</span><span style="color: #8b2252;">"</span> end t)
              (not (looking-at <span style="color: #8b2252;">"\\[</span><span style="color: #008b8b;">.\\</span><span style="color: #8b2252;">][ \t]+"</span>)))
    (<span style="color: #a020f0;">let</span> ((len (- (match-end 0) (match-beginning 0))))
      (replace-match <span style="color: #8b2252;">""</span> nil nil)
      (<span style="color: #a020f0;">setq</span> end (- end len))))
  (goto-char begin))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-org-toggle-checkbox</span> (begin end)
  (<span style="color: #a020f0;">interactive</span> <span style="color: #8b2252;">"r"</span>)
  (<span style="color: #a020f0;">unless</span> mark-active
    (<span style="color: #a020f0;">setq</span> begin (line-beginning-position))
    (<span style="color: #a020f0;">setq</span> end (line-end-position)))
  (goto-char begin)
  (<span style="color: #a020f0;">if</span> (re-search-forward
       my-org-bullet-with-checkbox-re (point-at-eol) t)
      (my-org-delete-checkbox-from-bullet begin end)
    (my-org-insert-checkbox-into-bullet begin end)))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-org-insert-checkbox-into-bullet</span> (begin end)
  (<span style="color: #a020f0;">interactive</span> <span style="color: #8b2252;">"r"</span>)
  (<span style="color: #a020f0;">unless</span> mark-active
    (<span style="color: #a020f0;">setq</span> begin (line-beginning-position))
    (<span style="color: #a020f0;">setq</span> end (line-end-position)))
  (<span style="color: #a020f0;">let*</span> ((checkbox <span style="color: #8b2252;">"[ ] "</span>)
         (len (string-width checkbox)))
    (goto-char begin)
    (<span style="color: #a020f0;">while</span> (<span style="color: #a020f0;">and</span> (re-search-forward my-org-bullet-re end t)
                (not (looking-at <span style="color: #8b2252;">"\\[</span><span style="color: #008b8b;">.\\</span><span style="color: #8b2252;">][ \t]+"</span>)))
      (replace-match (concat <span style="color: #8b2252;">"\\1"</span> checkbox) nil nil)
      (<span style="color: #a020f0;">setq</span> end (+ end len)))
    (goto-char begin)))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-org-delete-checkbox-from-bullet</span> (begin end)
  (<span style="color: #a020f0;">interactive</span> <span style="color: #8b2252;">"r"</span>)
  (<span style="color: #a020f0;">unless</span> mark-active
    (<span style="color: #a020f0;">setq</span> begin (line-beginning-position))
    (<span style="color: #a020f0;">setq</span> end (line-end-position)))
  (<span style="color: #a020f0;">let</span> ((len (string-width <span style="color: #8b2252;">"[ ] "</span>)))
    (goto-char begin)
    (<span style="color: #a020f0;">while</span> (re-search-forward my-org-bullet-with-checkbox-re end t)
      (replace-match <span style="color: #8b2252;">"\\1"</span> nil nil)
      (<span style="color: #a020f0;">setq</span> end (- end len)))
    (goto-char begin)))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-org-insert-bullet-and-checkbox</span> (begin end)
  (<span style="color: #a020f0;">interactive</span> <span style="color: #8b2252;">"r"</span>)
  (<span style="color: #a020f0;">unless</span> mark-active
    (<span style="color: #a020f0;">setq</span> begin (line-beginning-position))
    (<span style="color: #a020f0;">setq</span> end (line-end-position)))
  (<span style="color: #a020f0;">let*</span> ((bullet <span style="color: #8b2252;">"- "</span>)
         (checkbox <span style="color: #8b2252;">"[ ] "</span>)
         (blen (string-width bullet))
         (clen (string-width checkbox)))
    (goto-char begin)
    (<span style="color: #a020f0;">while</span> (<span style="color: #a020f0;">and</span> (re-search-forward (concat <span style="color: #8b2252;">"</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">(</span><span style="color: #8b2252;">^[ \t]*</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">)</span><span style="color: #8b2252;">"</span>) end t)
                (not (looking-at <span style="color: #8b2252;">"[-\\+\\*][ \t]</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">|</span><span style="color: #8b2252;">[a-z0-9A-Z]*[\\.)][ \t]"</span>))
                (not (equal (point) end)))
      (replace-match (concat <span style="color: #8b2252;">"\\1"</span> bullet checkbox) nil nil)
      (<span style="color: #a020f0;">setq</span> end (+ end blen clen)))
    (goto-char begin)))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-org-delete-bullet-and-checkbox</span> (begin end)
  (<span style="color: #a020f0;">interactive</span> <span style="color: #8b2252;">"r"</span>)
  (<span style="color: #a020f0;">unless</span> mark-active
    (<span style="color: #a020f0;">setq</span> begin (line-beginning-position))
    (<span style="color: #a020f0;">setq</span> end (line-end-position)))
  (goto-char begin)
  (<span style="color: #a020f0;">while</span> (re-search-forward my-org-bullet-with-checkbox-re end t)
    (<span style="color: #a020f0;">let</span> ((len (- (match-end 0) (match-beginning 0))))
      (replace-match <span style="color: #8b2252;">""</span> nil nil)
      (<span style="color: #a020f0;">setq</span> end (- end len))))
  (goto-char begin))
</pre>
</div>
</div>
</div>
<div id="outline-container-orgc99664d5" class="outline-3">
<h3 id="orgc99664d5"><span class="section-number-3">14.45.</span> " - "と" - [ ] "をサイクルさせる</h3>
<div class="outline-text-3" id="text-orgc99664d5">
<ul class="org-ul">
<li>空行を含むブリッツ行でないときは，ブリッツ化する．</li>
<li>ブリッツ行の場合は，チェックボックス付きに変更する．</li>
<li>チェックボックス付きブリッツ行の場合は，チェックボックスを取る．</li>
<li>引数付きで呼び出すと，チェックボックスの有無に依らずブリッツを取る．</li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-cycle-bullet-at-heading</span> (arg)
  <span style="color: #8b2252;">"Add a bullet of \" - \" if the line is NOT a bullet line."</span>
  (<span style="color: #a020f0;">interactive</span> <span style="color: #8b2252;">"P"</span>)
  (<span style="color: #a020f0;">save-excursion</span>
    (beginning-of-line)
    (<span style="color: #a020f0;">let</span> ((bullet <span style="color: #8b2252;">"- "</span>)
          (point-at-eol (point-at-eol)))
      (<span style="color: #a020f0;">cond</span>
       ((re-search-forward
         my-org-bullet-with-checkbox-re point-at-eol t)
        (replace-match (<span style="color: #a020f0;">if</span> arg <span style="color: #8b2252;">""</span> <span style="color: #8b2252;">"\\1"</span>) nil nil))
       ((re-search-forward
         <span style="color: #8b2252;">"</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">(</span><span style="color: #8b2252;">^[ \t]*[-\\+\\*][ \t]</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">|</span><span style="color: #8b2252;">^[ \t]*[a-z0-9A-Z]*[\\.)][ \t]</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">)</span><span style="color: #8b2252;">"</span>
         point-at-eol t)
        (replace-match (<span style="color: #a020f0;">if</span> arg <span style="color: #8b2252;">""</span> (concat <span style="color: #8b2252;">"\\1[ ] "</span>)) nil nil))
       ((re-search-forward
         (concat <span style="color: #8b2252;">"</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">(</span><span style="color: #8b2252;">^[ \t]*</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">)</span><span style="color: #8b2252;">"</span>) point-at-eol t)
        (replace-match (concat <span style="color: #8b2252;">"\\1"</span> bullet) nil nil))
       (t nil)))))
</pre>
</div>
</div>
</div>

<div id="outline-container-orga3da97e5" class="outline-3">
<h3 id="orga3da97e5"><span class="section-number-3">14.46.</span> 句読点を変換する</h3>
<div class="outline-text-3" id="text-orga3da97e5">
<p>
普段は「，．」を使っていますが，文章の行き先に応じて「、。」の方が良いことがあるので，一括置換できるコマンドを準備しました．「，．」へ戻すコマンドもご一緒に．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-replace-punctuation-to-normal</span> ()
  (<span style="color: #a020f0;">interactive</span>)
  (my--replace-punctuation 'normal))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-replace-punctuation-to-scientific</span> ()
  (<span style="color: #a020f0;">interactive</span>)
  (my--replace-punctuation 'scientific))

(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my--replace-punctuation</span> (to)
  (<span style="color: #a020f0;">let</span> ((pos (point))
        (source (<span style="color: #a020f0;">cond</span> ((eq to 'normal) <span style="color: #8b2252;">"</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">(</span><span style="color: #8b2252;">&#65292;</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">)</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">|</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">(</span><span style="color: #8b2252;">&#65294;</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">)</span><span style="color: #8b2252;">"</span>)
                      ((eq to 'scientific) <span style="color: #8b2252;">"</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">(</span><span style="color: #8b2252;">&#12289;</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">)</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">|</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">(</span><span style="color: #8b2252;">&#12290;</span><span style="color: #66CC99;">\\</span><span style="color: #9966CC;">)</span><span style="color: #8b2252;">"</span>))))
    (<span style="color: #a020f0;">if</span> (not source)
        (<span style="color: #ff0000; font-weight: bold;">error</span> <span style="color: #8b2252;">"Target punctuation is wrong"</span>)
      (goto-char (point-min))
      (<span style="color: #a020f0;">while</span> (re-search-forward source nil <span style="color: #483d8b;">:noerror</span>)
        (<span style="color: #a020f0;">let</span> ((w (match-string-no-properties 0)))
          (<span style="color: #a020f0;">cond</span> ((equal w <span style="color: #8b2252;">"&#65292;"</span>) (replace-match <span style="color: #8b2252;">"&#12289;"</span>))
                ((equal w <span style="color: #8b2252;">"&#65294;"</span>) (replace-match <span style="color: #8b2252;">"&#12290;"</span>))
                ((equal w <span style="color: #8b2252;">"&#12289;"</span>) (replace-match <span style="color: #8b2252;">"&#65292;"</span>))
                ((equal w <span style="color: #8b2252;">"&#12290;"</span>) (replace-match <span style="color: #8b2252;">"&#65294;"</span>)))))
      (goto-char pos))))
</pre>
</div>
</div>
</div>
<div id="outline-container-orgda007b63" class="outline-3">
<h3 id="orgda007b63"><span class="section-number-3">14.47.</span> <span class="todo TODO">TODO</span> ガベージコレクト情報を表示</h3>
<div class="outline-text-3" id="text-orgda007b63">
<ul class="org-ul">
<li><a href="https://www.reddit.com/r/emacs/comments/ck4zb3/trying_to_understand_emacs_memory_usage_and/">https://www.reddit.com/r/emacs/comments/ck4zb3/trying_to_understand_emacs_memory_usage_and/</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">my-garbage-collect-height</span> max-mini-window-height)

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-garbage-collect-activate</span> ()
  (<span style="color: #a020f0;">setq</span> max-mini-window-height 16)
  (add-hook 'pre-command-hook #'my-garbage-collect-deactivate))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-garbage-collect-deactivate</span> ()
  (<span style="color: #a020f0;">setq</span> max-mini-window-height my-garbage-collect-height)
  (remove-hook 'pre-command-hook #'my-garbage-collect-deactivate))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-garbage-collect</span> ()
  <span style="color: #8b2252;">"Run `</span><span style="color: #008b8b;">garbage-collect</span><span style="color: #8b2252;">' and print stats about memory usage."</span>
  (<span style="color: #a020f0;">interactive</span>)
  (my-garbage-collect-activate)
  (message
   (concat
    (format <span style="color: #8b2252;">"\n%-12s\t%-6s + %-6s = %s\n"</span> <span style="color: #8b2252;">"type"</span> <span style="color: #8b2252;">"used"</span> <span style="color: #8b2252;">"free"</span> <span style="color: #8b2252;">"total"</span>)
    (make-string (frame-width) ?-)
    (<span style="color: #a020f0;">cl-loop</span>
     for (type size used free) in (garbage-collect)
     for used1 = (* used size)
     for free1 = (* (<span style="color: #a020f0;">or</span> free 0) size)
     for total = (file-size-human-readable (+ used1 free1))
     for used2 = (file-size-human-readable used1)
     for free2 = (file-size-human-readable free1)
     concat
     (format <span style="color: #8b2252;">"\n%-12s\t%-6s + %-6s = %s"</span> type used2 free2 total)))))
</pre>
</div>
</div>
</div>
<div id="outline-container-orgfd77df9c" class="outline-3">
<h3 id="orgfd77df9c"><span class="section-number-3">14.48.</span> その他</h3>
<div class="outline-text-3" id="text-orgfd77df9c">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;; </span><span style="color: #b22222;">Test function from GNU Emacs (O'REILLY, P.328)</span>
<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">count-words-buffer</span> ()
  <span style="color: #8b2252;">"Count the number of words in the current buffer"</span>
  (<span style="color: #a020f0;">interactive</span>)
  (<span style="color: #a020f0;">save-excursion</span>
    (<span style="color: #a020f0;">let</span> ((count 0))
      (goto-char (point-min))
      (<span style="color: #a020f0;">while</span> (&lt; (point) (point-max))
        (forward-word 1)
        (<span style="color: #a020f0;">setq</span> count (1+ count)))
      (message <span style="color: #8b2252;">"buffer contains %d words."</span> count))))

<span style="color: #b22222;">;;; </span><span style="color: #b22222;">Test function for AppleScript</span>
<span style="color: #b22222;">;;; </span><span style="color: #b22222;">Cite: http://sakito.jp/emacs/emacsobjectivec.html</span>
<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">do-test-applescript</span> ()
  (<span style="color: #a020f0;">interactive</span>)
  (do-applescript
   (format
    (concat
     <span style="color: #8b2252;">"display dialog \"Hello world!\" \r"</span>))))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">describe-timer</span> ()
  <span style="color: #8b2252;">"see http://masutaka.net/chalow/2009-12-05-1.html"</span>
  (<span style="color: #a020f0;">interactive</span>)
  (pop-to-buffer (get-buffer-create <span style="color: #8b2252;">"*timer*"</span>))
  (view-mode -1)
  (erase-buffer)
  (insert
   (concat <span style="color: #8b2252;">"TIME           FUNCTION ("</span> (format <span style="color: #8b2252;">"%s "</span> (length timer-list)) <span style="color: #8b2252;">"timers)\n"</span>)
   <span style="color: #8b2252;">"-------------- ----------------------\n"</span>)
  (<span style="color: #a020f0;">dolist</span> (timer timer-list)
    (insert
     (concat
      (format-time-string <span style="color: #8b2252;">"%m/%d %T"</span>
                          (list (aref timer 1)
                                (aref timer 2)
                                (aref timer 3)))
      <span style="color: #8b2252;">" "</span>
      (<span style="color: #a020f0;">let</span> ((name (aref timer 5)))
        (<span style="color: #a020f0;">if</span> (symbolp name)
            (symbol-name name)
          <span style="color: #8b2252;">"...undefined..."</span>))
      <span style="color: #8b2252;">"\n"</span>)))
  (view-mode 1))
</pre>
</div>
</div>
</div>
<div id="outline-container-org81ca01d1" class="outline-3">
<h3 id="org81ca01d1"><span class="section-number-3">14.49.</span> 日付などを簡単に挿入する</h3>
<div class="outline-text-3" id="text-org81ca01d1">
<ul class="org-ul">
<li>hydra に移行しました．</li>
<li>戻しました（2021-06-24）</li>
</ul>

<p>
<a href="http://www.fan.gr.jp/~ring/doc/elisp_20/elisp_38.html#SEC608">http://www.fan.gr.jp/~ring/doc/elisp_20/elisp_38.html#SEC608</a>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">(defun insert-formatted-current-date (arg)</span>
<span style="color: #b22222;">;;   </span><span style="color: #b22222;">"Insert a timestamp at the cursor position. C-u will add [] brackets."</span>
<span style="color: #b22222;">;;   </span><span style="color: #b22222;">(interactive "p")</span>
<span style="color: #b22222;">;;   </span><span style="color: #b22222;">(cl-case</span>
<span style="color: #b22222;">;;       </span><span style="color: #b22222;">(4 (if (equal major-mode 'org-mode)</span>
<span style="color: #b22222;">;;              </span><span style="color: #b22222;">(org-time-stamp-inactive)</span>
<span style="color: #b22222;">;;            </span><span style="color: #b22222;">(insert (format-time-string "[%Y-%m-%d]"))))</span>
<span style="color: #b22222;">;;     </span><span style="color: #b22222;">(t (insert (format-time-string "%Y-%m-%d")))))</span>

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">insert-formatted-current-date</span> ()
  <span style="color: #8b2252;">"Insert a timestamp at the cursor position."</span>
  (<span style="color: #a020f0;">interactive</span>)
  (insert (format-time-string <span style="color: #8b2252;">"%Y-%m-%d"</span>)))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">insert-formatted-current-time</span> ()
  (<span style="color: #a020f0;">interactive</span>)
  (insert (format-time-string <span style="color: #8b2252;">"%H:%M"</span>)))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">insert-formatted-signature</span> ()
  (<span style="color: #a020f0;">interactive</span>)
  (insert (concat (format-time-string <span style="color: #8b2252;">"%Y-%m-%d"</span>) <span style="color: #8b2252;">"  "</span> user-full-name
                  <span style="color: #8b2252;">"  &lt;"</span> user-mail-address <span style="color: #8b2252;">"&gt;"</span>)))
</pre>
</div>
</div>

<div id="outline-container-org74fab35b" class="outline-4">
<h4 id="org74fab35b"><span class="section-number-4">14.49.1.</span> キーバインド</h4>
<div class="outline-text-4" id="text-org74fab35b">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(global-set-key (kbd <span style="color: #8b2252;">"C-c 0"</span>) 'insert-formatted-current-date)
(global-set-key (kbd <span style="color: #8b2252;">"C-c 9"</span>) 'insert-formatted-current-time)
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgdf529698" class="outline-3">
<h3 id="orgdf529698"><span class="section-number-3">14.50.</span> XHTMLを利用したガントチャート生成&#xa0;&#xa0;&#xa0;<span class="tag"><span class="obsolete">obsolete</span></span></h3>
<div class="outline-text-3" id="text-orgdf529698">
<p>
最近使っていません．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">defcustom</span> <span style="color: #a0522d;">my-auto-install-batch-list-el-url</span> nil
  <span style="color: #8b2252;">"URL of a auto-install-batch-list.el"</span>
  <span style="color: #483d8b;">:type</span> 'string
  <span style="color: #483d8b;">:group</span> 'takaxp-utility)

<span style="color: #b22222;">;; </span><span style="color: #b22222;">Publish an xml file to show a Gantt Chart</span>
(<span style="color: #a020f0;">defcustom</span> <span style="color: #a0522d;">default-timeline-csv-file</span> nil
  <span style="color: #8b2252;">"source.csv"</span>
  <span style="color: #483d8b;">:type</span> 'string
  <span style="color: #483d8b;">:group</span> 'takaxp-utility)

(<span style="color: #a020f0;">defcustom</span> <span style="color: #a0522d;">default-timeline-xml-business-file</span> nil
  <span style="color: #8b2252;">"XML file for business schedule"</span>
  <span style="color: #483d8b;">:type</span> 'string
  <span style="color: #483d8b;">:group</span> 'takaxp-utility)

(<span style="color: #a020f0;">defcustom</span> <span style="color: #a0522d;">default-timeline-xml-private-file</span> nil
  <span style="color: #8b2252;">"XML file for private schedule"</span>
  <span style="color: #483d8b;">:type</span> 'string
  <span style="color: #483d8b;">:group</span> 'takaxp-utility)

(<span style="color: #a020f0;">defcustom</span> <span style="color: #a0522d;">default-timeline</span> nil
  <span style="color: #8b2252;">"a template index.html"</span>
  <span style="color: #483d8b;">:type</span> 'string
  <span style="color: #483d8b;">:group</span> 'takaxp-utility)

(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">export-timeline-business</span> ()
  <span style="color: #8b2252;">"Export schedule table as an XML source to create an web page"</span>
  (<span style="color: #a020f0;">interactive</span>)
  (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">and</span> default-timeline
             (<span style="color: #a020f0;">and</span> default-timeline-csv-file
                  default-timeline-xml-business-file))
    (shell-command-to-string (concat <span style="color: #8b2252;">"rm -f "</span> default-timeline-csv-file))
    (org-table-export default-timeline-csv-file <span style="color: #8b2252;">"orgtbl-to-csv"</span>)
    (shell-command-to-string (concat <span style="color: #8b2252;">"org2gantt.pl &gt; "</span>
                                     default-timeline-xml-business-file))
    (shell-command-to-string (concat <span style="color: #8b2252;">"open "</span> default-timeline))))

(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">export-timeline-private</span> ()
  <span style="color: #8b2252;">"Export schedule table as an XML source to create an web page"</span>
  (<span style="color: #a020f0;">interactive</span>)
  (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">and</span> default-timeline
             (<span style="color: #a020f0;">and</span> default-timeline-csv-file
                  default-timeline-xml-private-file))
    (shell-command-to-string (concat <span style="color: #8b2252;">"rm -f "</span> default-timeline-csv-file))
    (org-table-export default-timeline-csv-file <span style="color: #8b2252;">"orgtbl-to-csv"</span>)
    (shell-command-to-string (concat <span style="color: #8b2252;">"org2gantt.pl &gt; "</span>
                                     default-timeline-xml-private-file))
    (shell-command-to-string (concat <span style="color: #8b2252;">"open "</span> default-timeline))))

</pre>
</div>
</div>
</div>
<div id="outline-container-org481e7f96" class="outline-3">
<h3 id="org481e7f96"><span class="section-number-3">14.51.</span> Auto-install をセットアップする&#xa0;&#xa0;&#xa0;<span class="tag"><span class="obsolete">obsolete</span></span></h3>
<div class="outline-text-3" id="text-org481e7f96">
<p>
いつも auto-install を使うわけではないので，必要時に <code>init-auto-install</code> を実行してパラメータを設定してから auto-install でパッケージを取得するようにしています．cask+pallet 環境に移行してからは使っていません．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">init-auto-install</span> ()
  <span style="color: #8b2252;">"Setup auto-install.el.</span>
<span style="color: #8b2252;">1. Set my-auto-install-batch-list-el-url</span>
<span style="color: #8b2252;">2. M-x init-auto-install</span>
<span style="color: #8b2252;">3. M-x auto-install-batch hoge"</span>
  (<span style="color: #a020f0;">interactive</span>)
  (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">and</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">auto-install</span> nil t)
             my-auto-install-batch-list-el-url)
    (<span style="color: #a020f0;">setq</span> auto-install-batch-list-el-url my-auto-install-batch-list-el-url)
    (<span style="color: #a020f0;">setq</span> auto-install-directory default-path)
    (<span style="color: #a020f0;">setq</span> auto-install-wget-command <span style="color: #8b2252;">"/opt/local/bin/wget"</span>)
    (auto-install-update-emacswiki-package-name t)
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">compatibility</span>
    (auto-install-compatibility-setup))) <span style="color: #b22222;">; </span><span style="color: #b22222;">for install-elisp users</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org6183f766" class="outline-3">
<h3 id="org6183f766"><span class="section-number-3">14.52.</span> org-buffer を dokuwiki 形式に変換し，kill-ring に格納&#xa0;&#xa0;&#xa0;<span class="tag"><span class="obsolete">obsolete</span></span></h3>
<div class="outline-text-3" id="text-org6183f766">
<p>
外部プログラム<a href="https://gist.github.com/1369417">org2dokuwiki.pl</a>を使います．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">org2dokuwiki-cp-kill-ring</span> ()
  <span style="color: #8b2252;">"Convert the current org-file to dokuwiki text, and copy it to kill-ring."</span>
  (<span style="color: #a020f0;">interactive</span>)
  (<span style="color: #a020f0;">when</span> (eq major-mode 'org-mode)
    (<span style="color: #a020f0;">cond</span> (buffer-file-name
           (kill-new
            (shell-command-to-string
             (concat <span style="color: #8b2252;">"cat "</span> buffer-file-name <span style="color: #8b2252;">"| perl "</span>
                     (expand-file-name <span style="color: #8b2252;">"~/Dropbox/scripts/org2dokuwiki.pl"</span>))))
           (minibuffer-message <span style="color: #8b2252;">"Copying %s ... done"</span> buffer-file-name))
          (t (message <span style="color: #8b2252;">"There is NOT such a file."</span>)))))
</pre>
</div>
</div>
</div>
<div id="outline-container-org5e548445" class="outline-3">
<h3 id="org5e548445"><span class="section-number-3">14.53.</span> ミニバッファに日時を表示&#xa0;&#xa0;&#xa0;<span class="tag"><span class="obsolete">obsolete</span></span></h3>
<div class="outline-text-3" id="text-org5e548445">
<ul class="org-ul">
<li>hydra に移行しました．</li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-date</span> ()
  (<span style="color: #a020f0;">interactive</span>)
  (message <span style="color: #8b2252;">"%s"</span> (concat
                 (format-time-string <span style="color: #8b2252;">"%Y-%m-%d"</span>) <span style="color: #8b2252;">" ("</span>
                 (format-time-string <span style="color: #8b2252;">"%a."</span>) <span style="color: #8b2252;">") "</span>
                 (format-time-string <span style="color: #8b2252;">"W:%W @"</span>)
                 (format-time-string <span style="color: #8b2252;">"%H:%M"</span>))))
</pre>
</div>
</div>
</div>
<div id="outline-container-org1a1d73ca" class="outline-3">
<h3 id="org1a1d73ca"><span class="section-number-3">14.54.</span> UUID をファイル名にして所定のディレクトリにコピー／移動</h3>
<div class="outline-text-3" id="text-org1a1d73ca">
<ul class="org-ul">
<li>すでに org-attach が存在するので用途が微妙に．．．</li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">org-att-global-directory</span> <span style="color: #8b2252;">"~/Dropbox/org/attachment/"</span>)
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">copy-file-with-uuid</span> (input)
  (<span style="color: #a020f0;">interactive</span> <span style="color: #8b2252;">"FFile name: "</span>)
  (<span style="color: #a020f0;">if</span> (file-exists-p input)
      (<span style="color: #a020f0;">let*</span> ((id (org-id-uuid))
             (filename (expand-file-name input))
             (directory (file-name-directory filename))
             (extension (file-name-extension filename))
             (output (concat org-att-global-directory id <span style="color: #8b2252;">"."</span> extension)))
        (copy-file filename output)
        (message <span style="color: #8b2252;">"--- Copied as %s "</span> output)
        output)
    (message <span style="color: #8b2252;">"--- %s does NOT exist."</span> input)
    nil))

(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">rename-file-with-uuid</span> (input)
  (<span style="color: #a020f0;">interactive</span> <span style="color: #8b2252;">"FFile name: "</span>)
  (<span style="color: #a020f0;">if</span> (file-exists-p input)
      (<span style="color: #a020f0;">let*</span> ((id (org-id-uuid))
             (filename (expand-file-name input))
             (directory (file-name-directory filename))
             (extension (file-name-extension filename))
             (output (concat directory id <span style="color: #8b2252;">"."</span> extension)))
        (rename-file filename output)
        (message <span style="color: #8b2252;">"--- Renamed as %s "</span> output)
        output)
    (message <span style="color: #8b2252;">"--- %s does NOT exist."</span> input)
    nil))

(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">org-link-uuid</span> (input <span style="color: #228b22;">&amp;optional</span> overwrite)
  (<span style="color: #a020f0;">interactive</span> <span style="color: #8b2252;">"FFile name: "</span>)
  (<span style="color: #a020f0;">let</span> ((output
         (<span style="color: #a020f0;">if</span> overwrite
             (rename-file-with-uuid input)
           (copy-file-with-uuid input))))
    (<span style="color: #a020f0;">when</span> output
      (insert (concat <span style="color: #8b2252;">"[[file+sys:"</span> output
                      <span style="color: #8b2252;">"]["</span> (file-name-base input) <span style="color: #8b2252;">"]]\n"</span>)))))
</pre>
</div>
</div>
</div>
<div id="outline-container-orgbdeca93a" class="outline-3">
<h3 id="orgbdeca93a"><span class="section-number-3">14.55.</span> byte-compile の警告を抑制する</h3>
<div class="outline-text-3" id="text-orgbdeca93a">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">Avoid warning (for sense-region)</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">Warning: '</span><span style="color: #008b8b;">mapcar</span><span style="color: #b22222;">' called for effect; use '</span><span style="color: #008b8b;">mapc</span><span style="color: #b22222;">' or '</span><span style="color: #008b8b;">dolist</span><span style="color: #b22222;">' insted</span>
(<span style="color: #a020f0;">setq</span> byte-compile-warnings
      '(free-vars unresolved callargs redefine obsolete noruntime
                  cl-functions interactive-only make-local))
</pre>
</div>
</div>
</div>
<div id="outline-container-org8065c996" class="outline-3">
<h3 id="org8065c996"><span class="section-number-3">14.56.</span> 開いているファイルをすべて閉じる</h3>
<div class="outline-text-3" id="text-org8065c996">
<p>
ファイルと dired で開いているディレクトリのバッファを閉じます．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-kill-all-file-buffers</span> ()
  <span style="color: #8b2252;">"Kill all buffers visiting files."</span>
  (<span style="color: #a020f0;">interactive</span>)
  (<span style="color: #a020f0;">dolist</span> (buffer (buffer-list))
    (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">or</span> (<span style="color: #a020f0;">and</span> (buffer-live-p buffer)
                   (buffer-file-name buffer))
              (<span style="color: #a020f0;">and</span> (switch-to-buffer buffer)
                   (eq major-mode 'dired-mode)
                   (file-directory-p (dired-current-directory))))
      (kill-buffer buffer)))
  (scratch-buffer))
</pre>
</div>
</div>
</div>

<div id="outline-container-org32ff042a" class="outline-3">
<h3 id="org32ff042a"><span class="section-number-3">14.57.</span> [window-resizer.el] 分割したウィンドウサイズを変更する</h3>
<div class="outline-text-3" id="text-org32ff042a">
<p>
<a href="http://d.hatena.ne.jp/khiker/20100119/window_resize">http://d.hatena.ne.jp/khiker/20100119/window_resize</a>
</p>

<p>
以下の警告を参考に書き換えた．
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">In my-window-resizer:
utility.el:333:23:Warning: `<span style="color: #008b8b;">last-command-char</span>' is an obsolete variable (as of
    Emacs at least 19.34)<span style="color: #b22222;">; </span><span style="color: #b22222;">use `</span><span style="color: #008b8b;">last-command-event</span><span style="color: #b22222;">' instead.</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-window-resizer</span> ()
  <span style="color: #8b2252;">"Control separated window size and position.</span>
<span style="color: #8b2252;">   Type {j,k,l,m} to adjust windows size."</span>
  (<span style="color: #a020f0;">interactive</span>)
  (<span style="color: #a020f0;">let</span> (
<span style="color: #b22222;">;;        </span><span style="color: #b22222;">(window-obj (selected-window))</span>
<span style="color: #b22222;">;;        </span><span style="color: #b22222;">(current-width (window-width))</span>
<span style="color: #b22222;">;;        </span><span style="color: #b22222;">(current-height (window-height))</span>
        (dx (<span style="color: #a020f0;">if</span> (= (nth 0 (window-edges)) 0) 1
              -1))
        (dy (<span style="color: #a020f0;">if</span> (= (nth 1 (window-edges)) 0) 1
              -1))
        action c)
    (<span style="color: #a020f0;">catch</span> '<span style="color: #008b8b;">end-flag</span>
      (<span style="color: #a020f0;">while</span> t
        (<span style="color: #a020f0;">setq</span> action
              (read-key-sequence-vector (format <span style="color: #8b2252;">"size[%dx%d]"</span>
                                                (window-width)
                                                (window-height))))
        (<span style="color: #a020f0;">setq</span> c (aref action 0))
        (<span style="color: #a020f0;">cond</span> ((= c ?l)
               (enlarge-window-horizontally dx))
              ((= c ?h)
               (shrink-window-horizontally dx))
              ((= c ?j)
               (enlarge-window dy))
              ((= c ?k)
               (shrink-window dy))
              <span style="color: #b22222;">;; </span><span style="color: #b22222;">otherwise</span>
              (t
               (<span style="color: #a020f0;">let</span> ((last-command-event (aref action 0))
                     (command (key-binding action)))
                 (<span style="color: #a020f0;">when</span> command
                   (call-interactively command)))
               (message <span style="color: #8b2252;">"Quit"</span>)
               (<span style="color: #a020f0;">throw</span> '<span style="color: #008b8b;">end-flag</span> t)))))))
</pre>
</div>
</div>
</div>
<div id="outline-container-org54f46ec1" class="outline-3">
<h3 id="org54f46ec1"><span class="section-number-3">14.58.</span> [idle-requie]</h3>
<div class="outline-text-3" id="text-org54f46ec1">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">idle-require</span>)
(idle-require-mode 1)
</pre>
</div>
</div>
</div>
<div id="outline-container-org22e29aa4" class="outline-3">
<h3 id="org22e29aa4"><span class="section-number-3">14.59.</span> [pdf-preview]</h3>
<div class="outline-text-3" id="text-org22e29aa4">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">pdf-preview</span>)
</pre>
</div>
</div>
</div>
<div id="outline-container-orge6a31c57" class="outline-3">
<h3 id="orge6a31c57"><span class="section-number-3">14.60.</span> [EasyPG]</h3>
<div class="outline-text-3" id="text-orge6a31c57">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">epa-setup</span> nil t)
  (epa-file-enable))
</pre>
</div>
</div>
</div>
<div id="outline-container-org1495619c" class="outline-3">
<h3 id="org1495619c"><span class="section-number-3">14.61.</span> [eblook]</h3>
<div class="outline-text-3" id="text-org1495619c">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">eblook</span>
(<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">eblook</span> nil t)
  (autoload 'edict-search-english <span style="color: #8b2252;">"edic"</span>
    <span style="color: #8b2252;">"Search for a translation of an English word"</span> t)
  (autoload 'edict-search-kanji <span style="color: #8b2252;">"edict"</span>
    <span style="color: #8b2252;">"Search for a translation of a Kanji sequence"</span> t)
  (<span style="color: #a020f0;">setq</span> *edict-files* '(<span style="color: #8b2252;">"/Users/taka/Dropbox/Dic/LDOCE4"</span>))
  (<span style="color: #a020f0;">setq</span> *edict-files* '(<span style="color: #8b2252;">"/Users/taka/Downloads/edict/edict"</span>)))
</pre>
</div>
</div>
</div>
<div id="outline-container-org13d9d76f" class="outline-3">
<h3 id="org13d9d76f"><span class="section-number-3">14.62.</span> [iBuffer]</h3>
<div class="outline-text-3" id="text-org13d9d76f">
<p>
iBuffer で list-buffers をオーバーライド（C-x C-b で表示）
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">defalias</span> '<span style="color: #0000ff;">list-buffers</span> 'ibuffer)
</pre>
</div>
</div>
</div>
<div id="outline-container-orgafde656e" class="outline-3">
<h3 id="orgafde656e"><span class="section-number-3">14.63.</span> キーバインド</h3>
<div class="outline-text-3" id="text-orgafde656e">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">Multiple combination</span>
<span style="color: #b22222;">; </span><span style="color: #b22222;">Editing with a rectangle region</span>
(global-set-key (kbd <span style="color: #8b2252;">"C-x r C-SPC"</span>) 'rm-set-mark)
(global-set-key (kbd <span style="color: #8b2252;">"C-x r C-x"</span>) 'rm-exchange-point-and-mark)
(global-set-key (kbd <span style="color: #8b2252;">"C-x r C-w"</span>) 'rm-kill-region)
(global-set-key (kbd <span style="color: #8b2252;">"C-x r M-w"</span>) 'rm-kill-ring-save)
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org362fb2dc" class="outline-2">
<h2 id="org362fb2dc"><span class="section-number-2">15.</span> おわりに</h2>
<div class="outline-text-2" id="text-org362fb2dc">
<p>
以上が，私の <code>init.el</code> とその説明です．
</p>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Takaaki Ishikawa</p>
<p class="date">Created: 2023-09-19 Tue 16:09</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
